commit 692c14d405bb352697b67f36a034d4963e272b66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 8 08:53:32 2014 +0100

    2.99.916 snapshot

commit 84fb3bb65ff917b908a1036540432bfd5525481d
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Sep 8 17:46:18 2014 +1000

    uxa: actually create the randr outputs for hotplug connectors
    
    I somehow lost this chunk in my mst patch I sent.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 001c542618aad25137029dcc28aa520766040964
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 8 07:54:25 2014 +0100

    2.99.915 snapshot

commit db01c9d627412f05f5e5448b5f4c1d3814d522fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 8 07:13:47 2014 +0100

    sna: Fix backlight assertion after only hiding planes
    
    If we only hide the planes, we do not turn off any outputs and so can
    skip resetting the backlight entirely.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da0c9638d7c54b12990531fc478b2dd523ed4db9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 8 07:07:08 2014 +0100

    sna: Fix an unreachable piece of code
    
    It doesn't do anything but the static analyzers at bay.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 908520a7dacade8b6716e7c30549847464a33a81
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Sep 3 10:43:21 2014 +1000

    uxa: add MST support.
    
    This adds MST support to the UXA paths in the driver.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    [ickle: Restore current output naming scheme]

commit b64a8f0e3e850e698a66e93fde36f846b39ea8cb
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Sep 3 10:43:20 2014 +1000

    uxa: drop mode_res caching.
    
    This will cause problems with MST displays which need to update the
    connector list after topology changes.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit aca0bf6387c159a3d54dbbe52dd65fd92df98216
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 7 13:32:12 2014 +0100

    sna/gen2: Fallback to kernel batch w/a rather than incur a stall
    
    If we have no pinned batches available, use the kernel w/a if available
    rather than stall waiting for an active batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57bf3d5f0fb4429b0991ad6f22000348820f5bd1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 7 17:22:31 2014 +0100

    sna: Disable the fb on switching away from X
    
    Currently we turn off the CRTCs when switching away from X in order to
    not leak our framebuffer. With the new drm_plane support, we can simply
    unset the framebuffer, which should be a lighterweight operation than
    disabling the CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c17d3b5d5cdbda510a2b6955c3a171457ecde7e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 7 17:20:29 2014 +0100

    sna: Compute clones on final ordering
    
    The clones are indices into the output arrays, so recompute the clones
    if we reorder the outputs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa10f480c566b8523cdd49b3e23f64b7b9625987
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 3 10:24:19 2014 +0100

    sna: Drop false IGNORE_DAMAGE hint
    
    IGNORE_DAMAGE is used by sna_drawable_use_bo to ignore both CPU/GPU
    damage. It used to only ignore CPU damage, but now is a more general
    hint. However, here we were intending to only say ignore the cpu damage
    that we explicitly discarded anyway.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=81973
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51e364ded28e9a8e02a380c041a2c5784381df35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 3 10:23:18 2014 +0100

    sna: Trace move-to-gpu overrides with extra DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee7ed478a2bb81c923d29106b0b1dfd73161c2fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 3 08:20:03 2014 +0100

    sna: Skip over hotunplugged outputs during CRTC set
    
    These outputs are already marked as disconnected and so should be
    excluded from the CRTC set, but to be safe skip over them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48a33fc379b17eed195875222ad773c911d9dff1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 2 19:08:36 2014 +0100

    sna/trapezoids: Use the corrected trapezoid origin for aligned boxes
    
    The rule for the origin of the CompositeTrapezoids routine is the
    upper-left corner of the first trapezoid. Care must be taken in case the
    trapezoid edge is upside down to consider the upper vertex.
    
    Reported-by: "Jasper St. Pierre" <jstpierre@mecheye.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84333f6213abb28838656d8352fd537ad68e4189
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 2 19:13:16 2014 +0100

    sna: Leave more Pixmap breadcrumbs in DBG
    
    Add the Pixmap id to various DBG messages to make it easier to track
    rendering.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 407817ebb9129f1b946c7ba68e3e05d9540f478c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 1 17:02:44 2014 +0100

    sna: Reject invalid CopyArea based on source clipping earlier
    
    Given a ridiculous CopyArea, say copying from (-32000,-32000), the
    region extents will wrap around when translated before the final clip
    and reject test. To overcome this, do source based rejection earlier
    before the potential underflow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92b37783eb2e9166efd82325f14d05de6a082081
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 1 15:05:05 2014 +0100

    test/README: Add missing trailing characters from cut'n'paste
    
    When copying the command from the terminal I failed to highlight the
    last character.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab01c1211e40f788fb2970ad03930bbaa92e58d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 1 13:37:30 2014 +0100

    sna: Fallback to normal composite if the blt redisplay fails
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21cc987ca8a531e399350564a5af7f551406b8d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 1 07:19:09 2014 +0100

    sna: Only decouple the event once
    
    If the client and drawable destroys are racing, we may trigger the event
    removal twice.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=83183
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c564c04bcde88d730ca111acfb6798bdf0d66da
Author: Jonathan Gray <jsg@jsg.id.au>
Date:   Sun Aug 31 18:48:56 2014 +1000

    configure: check for cpuid.h
    
    Instead of checking for a particular version of GCC check for
    a cpuid.h with __cpuid_count.  This allows cpuid.h to be
    provided for older/different compilers.
    
    Signed-off-by: Jonathan Gray <jsg@jsg.id.au>
    [ickle: Delete the bare and redundant config.h]

commit e8ad453a0ae9d701b41cc026d5d40f55dd4590c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 31 11:45:57 2014 +0100

    intel: Only include sys/mount.h on Linux
    
    We only automount debugfs for Linux, but sys/mount.h on BSD has unmet
    dependencies breaking the build.
    
    Reported-by: Jonathan Gray <jsg@jsg.id.au>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2086965e5c0781e0a3996de89e4dda03c5d42610
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 29 10:37:09 2014 +0100

    gen8: Refresh video render programs
    
    Reported-by: Timo Aaltonen <tjaalton@ubuntu.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=83207
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b822bc8c2c0b47dfc391c86c3e5764f718898dce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 29 10:14:35 2014 +0100

    sna/gen8: Check instead of asserting for a hang whilst setting up video state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f584f83dc8440f0cbec7db3ed8a071d4896c25a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 29 09:52:51 2014 +0100

    tests: Add a couple of gstreamer pipeline hints
    
    Having worked out how to use gstreamer, record the pipelines for
    posterity.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69d584c6acdcd645ee4cc4892e56940d2d4074f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 29 07:26:32 2014 +0100

    sna: Prepare fr changes in dirty tracking api (Prime)
    
    Future commit "pixmap: fix reverse optimus support with multiple heads"
    will allow for tracking within pixmaps (i.e. break the presumption that
    everything starts at offset 0,0 in the target pixmap).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f95d04b75b71ad523eb3e0e3fc9ad711c58ab43b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 27 10:05:07 2014 +0100

    intel-virtual-output: Use snprintf() for simplicity
    
    Third one-line patch to fix copying from the tainted user argument into
    the socket's path buffer. This time, give in and just use snprintf() as
    it guarrantees that it will not write more than 'n' characters and that
    the last is a NUL byte.
    
    Suggested-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 011f04ff8e9aca696e26ecef0e68132a24a9b094
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 26 18:30:17 2014 +0100

    intel-virtual-output: Fix invocation of strncpy()
    
    Somebody (me) confused it with snprintf() and put the string length in
    the wrong location. Also note that strncpy() does not NUL terminate long
    strings.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 016599783cf3e1a3e2362c82c8767a7398048db7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 26 12:44:58 2014 +0100

    intel: Limit read to always fit in the buffer
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Suggested-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e827f80e5c07ac13802a24753b249e05e18a290e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 26 12:42:11 2014 +0100

    intel-virtual-output: Sanity check length on user supplied socket path
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Suggested-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51037706b068b52b7c8984527c209d295e1e3584
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 26 11:43:28 2014 +0100

    sna: Fix attaching to a headless configuration
    
    ADDFB fails with a headless config (as any fb size is invalid).
    Fortunately, with headless we can use any depth we like.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c5229cf8fc642f8b7e091c38bfd27032ee5e48c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 24 16:25:05 2014 +0100

    sna: Make one last gasp at submitting the execbuffer before bailing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d209b03915e4d12ce445d72ac09bb4fe664ba664
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 24 07:05:35 2014 +0100

    configure: Add guards for os.h redefines
    
    os.h redefines a few common libc functions, so check if the host
    provides them first and inform os.h if that is the case.
    
    Suggested-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12c051d5c673d79c16a3a1478c0977799484ca95
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 23 15:33:13 2014 +0100

    sna/dri2: Unhook event from draw list upon client destruction
    
    When the client goes away, we need to free its events. However, we
    have to defer the freeing of any pending event (ones currently routed
    through the kernel) for those we need to remember to decouple the event
    from the Drawable's list before they are freed.
    
    Reported-by: John Lindgren <john.lindgren@aol.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82979
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1bbacf80a9c4e7a259f896064b5cb147c4523f12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 23 15:32:39 2014 +0100

    sna/dri2: Assert event is queued when marked as next pending flip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48000371c9fba8dfa84ffd3228e8f74cc477ddce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 23 15:02:24 2014 +0100

    sna/dri2: Remove the redundant parameter passed to free event
    
    draw is always the same as event->draw, so just use event->draw.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fef2f4dbaeb6e206786d63dafe4156f978a4422d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 22 18:57:32 2014 +0100

    sna: DBG message fix for !xvmc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b2cf5c7ab6e1a4a9aa46b297fb2f90cb09124ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 21 08:17:41 2014 +0100

    sna: Propagate failure from changing backlight value
    
    Especially when we delete the output property halfway through and the
    ChangeProperty routine then attempts to wire it back up...
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82833
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61ec162dc9f4204e26e7786ef26e7abf9ed37ed2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 21 07:21:59 2014 +0100

    backlight: Move the fd out of the select range
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 726f1a38a572a8a6121e5194269fb549c363d9f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 21 07:04:01 2014 +0100

    sna: Only send the bl change notification if the randr_output exists
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5469681b620d9d6ccaf53e92ed31f931cb03b0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 18 14:37:44 2014 +0100

    sna: Be defensive during FreeScreen()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfacb9d8dcd0fd590af3cb9fddc81904ef1e273b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 18 14:37:19 2014 +0100

    sna: Add some DBG warnings for early PreInit failures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02f184e0ef428d9d80fecbaa438a7cbd87c18a91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 18 07:43:21 2014 +0100

    test: Make SHM tests in lowlevel-blt-bench optional
    
    A slightly more complex patch to disable the SHM based tests of
    lowlevel-blt-bench when MIT-SHM support is not available at compile
    time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9058dac3029b0e4f35eaa8ac101d38f3071f3c52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 18 07:23:27 2014 +0100

    test: Only compile lowlevel-blt-bench if we have shm
    
    Since 37ac34c4e4500bfc272222754949edc1dbb8c7e2, lowlevel-blt-bench
    requires SHM support, so only compile it if we detect such during
    configure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16b9447c5178611ce32e10620e62007ba5445918
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 18 07:00:48 2014 +0100

    intel: Only dump debugfs on linux
    
    Other platforms are not going to have the same debug infrastructure, nor
    even the same mount(2).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8e632f396bf4b0473dca0516567d56a29954cf3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:35:34 2014 +0100

    sna: Select appropriate tiling mode for TearFree shadow buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3b093b3c0676d6c9851af2b0c16806140c55258
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:32:48 2014 +0100

    sna: DBG log invalid surface sizes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e59ea828f521e2f1963152a9211c36b8091bf655
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:31:32 2014 +0100

    sna: DBG log all bo allocation failure paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b8f7db5c93b4b687670ad9340fec6a857cd065e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:27:34 2014 +0100

    sna: DBG Log all failure paths in allocating CRTC pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e461427ad3667554a01b5b74525a15d19538a8e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:19:10 2014 +0100

    sna: Add error message to explain modesetting failures due to allocation
    
    Since this is an error path with a major user visible failure (the
    modeset fails), make sure that we log the reason.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72ed21c694aecba1e91089479b2cb5f957548fec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 21:09:12 2014 +0100

    sna: Do not force creation of a linear GPU bo that we don't want
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bb9311e5de8bb39423397213d3de0e0ec4fcbd5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 17:38:49 2014 +0100

    sna: Use a shadow buffer for linear framebuffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f1280bab9c99b15ba835a0094d8b849846d13f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 14 07:37:06 2014 +0100

    sna/dri2: Fix compilation with Xorg-1.12.4
    
    In Xorg-1.12.4 we have DRI2 version 6 (and so triple buffering support
    by Xorg) but we don't yet have Prime. Remove the check for the Prime bug
    in the Xserver for that case.
    
    Reported-by: Axel Rohde
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d974dabc8ac06e76bffe5824caf86fd072c35ed3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 13 07:58:57 2014 +0100

    sna: Relax the square cursor assumption
    
    Internally only use a square cursor, but 845g/865g actually supports
    rectangular cursors (as they have a relaxed cursor height restriction).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec10cef592b7a3d1dc3c4949778e72e8cd156245
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 12 10:52:12 2014 +0100

    sna: Only apply a DPMS change for an enabled CRTC
    
    Mostly paranoia, but we need to validate that the stored mode is valid
    before applying the modeset.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9cc72c2dc7130d3d5731f7e75f35f10302389f08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 12 10:49:20 2014 +0100

    sna: Suppress "switch to mode" messages for internal CRTC applies
    
    We only want to log a mode change when it is initiated by the user. For
    internal updates, such as changing the frame or restoring a mode from
    DPMS, we want to silently apply the current mode.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3138bee8db7db6ebaa10ecdd09c47f899d24c8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 12 09:00:04 2014 +0100

    sna: Separate panel checks from adding default modes
    
    The flags are now separate, so treat them individually.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6554cf0a69f04710b64f3488384fe5cb2748dc35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 11 12:22:17 2014 +0100

    sna: Parse output options early during initialisation
    
    Before we can query whether an option is set, we first need to generate
    the options table. This is done through xf86OutputUseScreenMonitor() so
    make sure it is called as early as possible in the proceedings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e1961e7fc163f3103b2260cca965aefa61fed40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 10 06:51:33 2014 +0100

    sna: Respect monitor option "DefaultModes"
    
    The is a monitor option to allow the user to specify whether to add the
    default modes, use it to determine adding the extra modes for panels.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6e85048b0789162e389ad2b838d417d517d62d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 9 08:02:39 2014 +0100

    sna: Reorder output array to match primary placement for InitialConfiguration
    
    xf86InitialConfiguration() depends upon the order of the outputs for its
    mode selection and expects the Primary output to be listed first.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82205
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c7965f00f85fbe3af69029d3fd1e5e2e079f159
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 9 07:37:58 2014 +0100

    intel: If need be, try mounting debugfs
    
    If we require debugging information from debugfs and we cannot find it,
    silently mount it and dump the information we need.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dea65e8be73b79c50f7ee59c54c4c75cbcff67fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 9 07:12:23 2014 +0100

    intel: Log open clients on master takeover fail
    
    If we fail to claim the DRM device as master, dump /debugfs/.../clients
    so that we can check to see who failed to drop master for us.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d135867c886e98fa0bc5a7a21a1b3d84851daaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 8 14:04:14 2014 +0100

    sna: Update check for static driver data on loading error
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xorg-server/+bug/1354424
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59f0374188e6d2eb2fd18e3dfb517087e09ae13f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 8 10:26:13 2014 +0100

    sna: Restore the clear before pwriting the cursor
    
    Along the legacy phys cursor path, we use a common scratch buffer. As
    this is global, we need to be careful not to trust the cursor local
    dirty tracking and be sure to clear the image before uploading.
    
    Reported-by: Dirk Griesbach
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82337
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afea9ba0790a951c6a00b57d0d71876dd1ce98c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 8 08:17:15 2014 +0100

    Prepare for spurious Xv ABI changes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f69188cb2959abfb2fcd3f81cd4146aa3876bb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 8 07:25:03 2014 +0100

    sna: Clear old cursors when resizing
    
    When changing the stride on a cursor, we have to clear the whole area
    and not just the rectangle outside of our overwritten area.
    
    Reported-by: Jan Alexander Steffens <jan.steffens@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82273
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fab976cef80aad2c573cfc6febeec5ec8e3bab06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 7 14:35:22 2014 +0100

    uxa: Compile fix for Ubuntu 11.04
    
    ../../../src/uxa/intel_uxa.c: In function 'intel_uxa_init':
    ../../../src/uxa/intel_uxa.c:1557:27: error: 'true' undeclared (first use in this function)
    ../../../src/uxa/intel_uxa.c:1557:27: note: each undeclared identifier is reported only once for each function it appears in
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52c1e64692e3e80826e526dd14aec4bee137a19b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 7 11:34:26 2014 +0100

    sna: Flush cursor width changes
    
    The kernel only sees changes in the cursor width when the cursor handle
    is updated. In the cases where we reuse larger bo for smaller cursors,
    make sure we then reset the cursor handle (even though it has not
    changed) so tht the kernel updates its width.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7763a3da89fac7cbe571535eebd999d178c39e83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 7 07:50:54 2014 +0100

    test: Exercise different cursor sizes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 105d478cdd70ac3b38be51c9014b22b7233c241e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 6 09:10:30 2014 +0100

    sna: Enable kernel rotation support by default
    
    The kernel API is now upstream and so we can rely on it not changing.
    Time to use it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f36b7a4aac86f5874c32d8f516ac1f00a6c8d8b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 5 16:38:42 2014 +0100

    intel: Use NOACCEL to avoid a symbol clash on old Xorg
    
    Old Xorg xf86str.h defines NONE preventing us from using it within an
    enum. Use NOACCEL instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5e654cf2afcafbe3732548359771747dac1ce26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 5 16:21:19 2014 +0100

    sna: Set the RandR primary output from the option
    
    If the user specifies the Option "Primary" for a monitor, we need to set
    it as the RandR primary output.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82193

commit 999c8dc700a0573859ec1aaae4500493d01d0c0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 5 15:36:26 2014 +0100

    sna: Add intermediate modes to any output with a scaler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cea47f8cfcd810c103740ec7ee9caeecba1e30f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 5 15:30:11 2014 +0100

    sna: Add DSI to the list of recognised panel connectors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 941ae4c868279c994756a2a476af2cd32afc6d35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 5 10:19:05 2014 +0100

    sna: Add some extra logging for hotplugging of outputs
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=82153
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5926da0ab3339bbfd55a27ac84a8306b8d931181
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 4 16:25:36 2014 +0100

    sna: Mark the current mode as preferred if no other mode is
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab3f1526f19ec405dca8ab3094a626096dc30358
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 4 16:23:00 2014 +0100

    sna: Add the current CRTC mode last
    
    We only want to add the current mode to the modelist if it is not
    already present in the EDID. At the moment, we always add the current
    mode first which causes the list to be reordered. If we add it after
    checking the EDID, then we will not perturb the list.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82068

commit ebd1907304c538bcc27614bc8e2e29f317ffb390
Author: Edward Sheldrake <ejsheldrake@gmail.com>
Date:   Mon Aug 4 18:53:38 2014 +0100

    backlight: Fix regression
    
    The backlight xrandr property is missing unless the backlight level
    was 0 on starting X, regression introduced in
    
    commit f9e7ac7db7b0331131aa1df3a90d4b2692949efa
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jul 23 21:53:31 2014 +0100
    
        backlight: Set structure to safe values when not initialised
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=82146

commit 926631ee4148dbe2c53def01c98d568b80d46d53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 3 18:23:31 2014 +0100

    sna: Restore single CRTC flips
    
    CRTC flips depend upon having a proxy front buffer, so
    
    commit 33a0dd8f0b1e31e501825dc66f7ec2d85b55a7f4
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jul 29 09:11:01 2014 +0100
    
        sna/dri2: Also check for stale buffers before exchanges
    
    was false and disabling every other CRTC flip. However,
    
    commit 70868c7aa881b15b7478f7ee4543fde0268a4ba6
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jul 23 08:37:46 2014 +0100
    
        sna/dri2: Recreate buffer in reuse rather than force recreate
    
    was not the entire story and to prevent unnecessary confusion when
    multiple clients share the same front buffer, we have to force the
    recreation of the back. Do this inside the xchg routine to avoid the
    confusion first fixed by 70868c7aa881b15b7478f7ee4543fde0268a4ba6.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 623fa61090fb288062d68257a5c72d8da1fbfc9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 3 18:08:12 2014 +0100

    sna: Rearrange showing cursors
    
    Just tidying and explaining why cursor show on a particular pipe may be
    skipped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b938573353aab70536d913b2d078181a3c9a1a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 3 18:08:02 2014 +0100

    sna: Add some paranoid asserts around get_window_pixmap()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4de3f9bd79d8e42f9767c9fe44d553cfb749ac65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 3 07:33:35 2014 +0100

    sna: Relax restriction on fenced aperture check
    
    This is done upfront based on the fenced size within the batch, so we do
    not need to assume everything is fenced later on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af60a104acfcc64a63987f93bb77ffa21be1ead1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 2 19:18:29 2014 +0100

    sna: Restrict fencing to only use the low 256MiB
    
    Somce early machines have 512MiB apertures, but we can still only use
    the low 256MiB for fencing. Separate out the mappable restriction checks
    from the fencing in order to further constrain those devices.
    
    Reported-by: Matti Hämäläinen <ccr@tnsp.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d11512406daeaabf2549831505811725e1375e5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 2 19:08:06 2014 +0100

    sna: Remove dead assertion
    
    sna_display.c: In function 'sna_crtc_redisplay':
    sna_display.c:6393:9: error: 'sna_crtc' undeclared (first use in this function)
      assert(sna_crtc);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1a0b9c2e49d03e373695df8828c8d4c6312e5ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 1 12:02:58 2014 +0100

    sna/glyphs: Eliminate an extra conditional from glyphs-to-dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc2de62496061b9d0bace02729765344bd939122
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 1 12:00:05 2014 +0100

    sna/glyphs: Fallback to masked glyphs if rendering to a too wide dst
    
    Fixes regression from
    
    commit 79399ff9264ff23da0ab95131a67d2ac85651b3d
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Mar 24 10:46:57 2014 +0000
    
        sna: Eliminate a few conditionals in glyph fast path
    
    for large pixmaps (such as extended desktops on gen2/gen3).
    
    Bugzilla: https://bugs.archlinux.org/task/40949
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce804875914f52dba5356f8aefec850d411b051a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 31 16:18:02 2014 +0100

    i810: Fix startup after marking GPU screens in the module
    
    Fixes regression from
    
    commit d6830190bc9956f485db6c3420f7a4a79793a693
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jul 23 10:53:40 2014 +0100
    
        sna: Disable all outputs when initializing as a slaved output provider
    
    Reported-by: Tobias Powalowski
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6a60ec606e291323ee0b6e83679ff277a0bd84a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 30 07:42:04 2014 +0100

    sna: Silence a compiler warning
    
    sna_display.c: In function 'sna_crtc_redisplay':
    sna_display.c:6390:19: warning: unused variable 'sna_crtc' [-Wunused-variable]
      struct sna_crtc *sna_crtc = to_sna_crtc(crtc);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33a0dd8f0b1e31e501825dc66f7ec2d85b55a7f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 29 09:11:01 2014 +0100

    sna/dri2: Also check for stale buffers before exchanges
    
    Not impossible after all - usually after a client error.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 376272be367c2712304a16da0f9362ffae5be0a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 29 09:02:36 2014 +0100

    sna: Skip grabbing the main framebuffer id
    
    If we aren't using it, we can forgo obtaining the id.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c66ee5e9793785585d37622b9419fd25c046d14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 29 08:59:44 2014 +0100

    sna: Always clear CRTC overrides when adjusting the mode
    
    It is not necessary to resize before adjusting the CRTC, but if it
    moves the window may no longer be obscuring the CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ceb4028f4d69f4ab2e800d6b98809a998918154
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 27 17:50:29 2014 +0100

    sna: Select the panel native size of the unattached fb size
    
    When creating a framebuffer for an headless system, if there is a panel,
    use its native size rather than 1024x768.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a88795c64123e4084044451d8861838ea904abd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 29 21:11:09 2014 +0100

    sna: Clear cursor image after rotation
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=81886
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02bb0c5bc56df2790ffcd90d47d667dfd63b5407
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 28 21:16:33 2014 +0100

    sna: Fix clear shortcut for transformations
    
    The region needs to be transformed along the clear shortcut when
    redisplaying the CRTC.
    
    Reported-by: Dirk Griesbach
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=81820
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 997a5d28021ece0e81845d0217a1b6feb765e6fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 27 07:15:19 2014 +0100

    configure: Expose no acceleration by default (--with-default-accel=none)
    
    Why? I am not sure, but it seems equally as valid as allowing the switch
    to uxa/glamor as default. The runtime equivalent is Option "AccelMethod".
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cac1548a9c48db4707fc3c885b1ea568ae2fbc54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 24 06:29:54 2014 +0100

    sna: Sort the outputs to provide a stable listing order
    
    Make xrandr look neater by grouping the outputs together by type and
    then by port ordering.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f68d363a236a4bd424dff8a04d177bb5b79df1c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 22:12:33 2014 +0100

    backlight: Remove unused 'original' member from structure
    
    This was accidentally added with no users.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5935c93ce77a5da09aab9b45b1a5710d681c171e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 21:59:20 2014 +0100

    sna: Keep the backlight at the same brightness when switching away
    
    Before VT switching, we disable all the outputs. This has the
    side-effect of disabling the backlight, but commonly the console does
    not set the backlight brightness itself and so we re-enable the
    backlight on its behalf. Rather than set the backlight to max
    brightness, reset it to the last user value, as maximum can be very
    bright!
    
    Reported-by: Mark Kettenis <mark.kettenis@xs4all.nl
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9e7ac7db7b0331131aa1df3a90d4b2692949efa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 21:53:31 2014 +0100

    backlight: Set structure to safe values when not initialised
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc50dff844b97e655483c9eaf0effeec6a9ab4dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 21:43:02 2014 +0100

    sna: Disable rendering with the DRM device whilst away from VT
    
    As root, X gets away with many things, including submitting commands to
    the DRM device whilst it is no longer authorised (i.e. when it has
    relinquished master to another client across a VT switch). In the
    non-root future, if we attempt to use the device whilst unauthorized the
    rendering will be lost and we will mark the device as unusable. So flush
    our render queue to the device around a VT switch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d95e90b7b4bf5d6bae5443f92d77d30f4443f24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 15:45:31 2014 +0100

    2.99.914 snapshot

commit 57f0e65d5186412835f282af59141626e4a87a00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 16:42:46 2014 +0100

    sna/dri2: Compile fix for old xorg/dri2
    
    We have to do conditional compilation as we touch structure members that
    may not exist in older Xserver headers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ed0937640b54246440421114b697f75d1b8c835
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 15:41:29 2014 +0100

    Add automake magic required for libobj/
    
    So libobj/ wasn't included in the tarball, and nor was the compatability
    functions being added to the driver when they were needed. The oddity is
    that using the ./configure script (and thus make distcheck) succeeds. It
    was only when 'autoreconf -fi' was run was the first error encoutered.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reported-by: Tobias Klausmann

commit dcf9ce4a9f16c01f58797e4f899d51e23506aa6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 14:19:44 2014 +0000

    Fix compile failure on old Xorg with XF86_ALLOCATE_GPU_SCREEN
    
    Sigh, a late fix was not compile checked against xorg-1.7.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c5e20716f192f0c38b4edd879d28e11126f7f01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 5 08:47:16 2014 +0100

    2.99.913 snapshot

commit d242965979cf251383a6230dbd65cdc1d9e231ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 14:25:25 2014 +0100

    sna: Skip performing an async flip after fixup
    
    After the first async failure and we fix up the CRTC, ordinary we queue
    a no-op flip in order to queue the event. For async flips, we do not
    want that event so just skip the flip.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4153d4b43004cd90c0d9a7a7db399dac4d30721e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 13:54:19 2014 +0100

    sna/dri2: Tidy freeing the queued frame events
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2b2b6eda009924e5ec6974bb31be9d3749c9cf8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 13:45:27 2014 +0100

    test/dri2: Use the right device node
    
    Use the device node as instructed by Xorg.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65c2376730e86d7502d8c47d49386be5f51e47ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 12:12:03 2014 +0100

    sna: Add a DBG message for slave damage propagation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95c059b330e705ecd0e575e98d8edf5707e84a05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 11:01:07 2014 +0100

    sna: Reorder disabling scanout pixmap when updating slave
    
    The assertion caught that we would unregister an invalid drawable on
    older Xorg.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6830190bc9956f485db6c3420f7a4a79793a693
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 10:53:40 2014 +0100

    sna: Disable all outputs when initializing as a slaved output provider
    
    When we are constructed as a slaved device, we need to disable all
    outputs or else they are not correctly hooked into the master device
    upon startup.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70868c7aa881b15b7478f7ee4543fde0268a4ba6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 23 08:37:46 2014 +0100

    sna/dri2: Recreate buffer in reuse rather than force recreate
    
    By marking the buffer->attachment as invalid we forced the recreation of
    the buffer on the next DRI2GetBuffers. The only small problem with that
    was that the client didn't always immediately call DRI2GetBuffers after
    the invalidation - and if they did a DRI2CopyRegion with its stale
    buffers the unfound attachment would generate a BadValue and kill the
    client. So instead of messing around with the attachment, explicitly
    recreate the buffer if we attempt to reuse a buffer of the wrong size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa5351dbbe0a50080efee35a3d494b3a20b7c9f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 22 09:40:14 2014 +0100

    sna: Ensure errno is set after failure before reporting a modeset failure
    
    A few paths we report a sanity check failure which do not set errno, but
    we then print out the errno as part of our message to the user. Set it
    to a sane value in those cases.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit feba651db8dd61356fb6296b55d46168bd4d7011
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 22 09:15:01 2014 +0100

    sna: Remove %# from DBG messages
    
    LogF doesn't support the 0x-prefix instruction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13e20c7f61d8b21b33c02d8b737cf9c06bf50f17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 22 08:52:10 2014 +0100

    sna: Assert that we do not overwrite an earlier COW entry
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8b0a8fa033848543e0b39566b531fdfdd078087
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 22 08:48:58 2014 +0100

    sna/dri3: Don't forget to add SHM pixmaps to the list of exported DRI3 bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfccacf745d054756661be3edd8898ac6aceb878
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 20 07:29:21 2014 +0100

    sna/video: Bump the maximum size for sprites
    
    A sprite plane is limited by the display engine who's maximum resolution
    has increased since the 2kx2k limitations of 8xx, so let's set it
    correctly to the reported maximum CRTC size (since we have no individual
    query for maximum sprite plane sizes).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9bb2818a7db1c9dc89379996415511b6cff4bb33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 20 07:27:58 2014 +0100

    dri3-test: Print line number for shm failures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ae346e7647fd2c01324f1a6d3b37674e858486d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 18 07:31:25 2014 +0100

    configure: Double check xinerama's headers
    
    Having the pkgconfig present doesn't always necessarily imply the
    headers are installed correctly - just fail over gracefully for xinerama
    and intel-virtual-output
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fac6845820e49dbbea2a625b7bb745d8f9159b56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 18 07:14:19 2014 +0100

    sna/dri2: Protect compsiteext.h include with build check
    
    We shouldn't include calls to the composite extension if it has not been
    built.
    
    Reported-by: Ben Widawsky <ben@bwidawsk.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 923e098f5f830c30b93d6f85d4f812201bdcb206
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 17:10:39 2014 +0100

    sna: Fix compilation with older Xorg
    
    sna_display.c: In function 'sna_crtc_disable_shadow':
    sna_display.c:1375:39: error: dereferencing pointer to incomplete type
       DamageUnregister(&crtc->slave_damage->drawable, crtc->slave_damage);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7026ffe56005bbc36dc37cafc7ebb2a7f09fefdd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 17:04:02 2014 +0100

    sna: Support TearFree on slaved outputs
    
    By always forcing the shadow intermediatory, we can enable TearFree even
    ona slave scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3140d72826b5227f7f7ac9a428faa4bcfd4b377b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 16:14:16 2014 +0100

    backlight: Prevent dereference of potential NULL argv
    
    Adam Sampson spotted that
    
    "It's possible (but not very sensible) to exec a program with an empty
    argument list, so argv[0] is not necessarily a valid pointer. For
    example:
    
    $ cat exec0.c
    
    int main(int argc, char *argv[]) {
        char *empty[1] = { NULL };
        execvp(argv[1], empty);
        perror("execvp");
        return 1;
    }
    $ ./exec0 /usr/libexec/xf86-video-intel-backlight-helper
    Usage: (null) <iface>
    "
    
    He sensibly suggested that we hardcode the program name to avoid the
    NULL dereference. Being the paranoid type, we should also be careful not
    to write to any file descriptors outside of our control (i.e. stderr),
    so disable the messages unless we are debugging.
    
    Reported-by: Adam Sampson
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bcd09ff6eb76bc4df046ece4da29b1455fed8dff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 15:23:46 2014 +0100

    sna: Assert that we never attempt to flip the slave scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 129656e4a82d4bf799e5c1d75d0dcb4480f6eb09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 15:01:06 2014 +0100

    sna/dri2: Disable SwapLimit buffers with buggy prime implementations
    
    If there is a GPU screen, we have to assume that the DRI2 code may pass
    around the wrong pointers to ReuseBufferNotify until the fix is
    released:
    
    commit 4d92fab39c4225e89f2d157a1f559cb0618a6eaa
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 18 11:14:43 2014 +0100
    
        dri2: Use the PrimeScreen when creating/reusing buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a45b2ea11c15f35c36330ff27cb45854a29c2e2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 14:40:51 2014 +0100

    sna: Handle rotated slaved scanouts
    
    As per the usual handling of rotated scanouts with unsupported
    rotations, we stage the drawing onto a backbuffer then rotate onto the
    crtc later. The difference here is that we must read the contents from
    the master pixmap rather than our own screen pixmap.
    
    Spotted was looking at slaved scanouts mistakenly setting the CRTC
    transformed flag.
    
    Reported-by: Tomas Pruzina <pruzinat@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=81383
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 339c9dd0d5206180995731ab22304776e544f2f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 12:54:47 2014 +0100

    sna: Add missing DBG parameters
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62f62f70eda97a3ef18c5144031fdf1cb2b7dad0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 10:06:06 2014 +0100

    sna: Avoid confusing failure to flip and flipping zero CRTC
    
    During the present unflip path we blindly try to restore the original
    mode after a flip failure. However, it confuses flipping zero CRTC with
    a genuine failure. This has the result of undoing a DPMS change (e.g.
    xset dpms force dpms) under a DRI3 compositor.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=81456
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95f08c171ebd9b594112ab006c4460702a22bec1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 09:20:35 2014 +0100

    sna: Busy-wait for the kernel to catch up when flipping
    
    If the kernel reports that it is busy, it has not yet finished
    processing a pending flip and we have multiple CRTC queued, just wait
    for the kernel to clear its backlog before submitting the next flip. On
    the other hand, if we can just overwrite the pending flip results.
    However, the EBUSY may actually be a genuine report by the kernel of an
    error, so check for an invalid CRTC first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a9d3dd8c83749992e643675f16486092f2b00fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 08:53:13 2014 +0100

    sna: Silence valgrind when reading plane properties
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a57b55f0fcfa93b38015535002cb11eeaf1dd3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 17 08:32:14 2014 +0100

    sna: Remove extraneous function wrapping
    
    Since we only have the single callsite for do_page_flip, the wrapper is
    not adding any meaningful information.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f33d44f41ef0f287375b7a6b1c117abff5a23b19
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 16 12:53:02 2014 +0100

    sna: And remove new bogus assertion
    
    We assert that damage is valid as we delete the Pixmap, and so we cannot
    assert that the Pixmap is still valid itself.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd9df24eb5234c96e499063904ab7bd85a332fd8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 16 08:05:34 2014 +0100

    sna: Make the damage check more verbose
    
    Print out the pixmap number and the damage extents for when the
    assertion fails.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34ada63118680bf8ad2ef737fd4a8edfd8246e37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 16 07:19:03 2014 +0100

    sna/gen2+: Remove assertion on draw->type for fills
    
    I overlooked the tiling-fill path passing down a temporary DrawableRec
    into the fill_boxes callback - invalidating the assertion.
    
    Fixes regression from
    commit 43176b9bfafe389c4b9ed676f4e50e3b06f858c4
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 30 21:01:11 2014 +0100
    
        sna/dri2: Pass around the correct DrawableRec for sampling from the foriegn bo
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70461#c62
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4422b1854209a2cdf023c1fbc60834fde2fbc0c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 11 22:23:55 2014 +0100

    sna: Use a stricter test for determining CRTC off before updating the cursor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0523ade28fa0da00d0bd70d8b22d53ed4e49f73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 9 12:10:15 2014 +0100

    sna: Reduce reflections onto rotations
    
    In order to support a wider range of rotation/reflections, perform a
    simple reduction of the requested rotation first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 251bcc32eed37ee10eb14ce2278ecbdcc40a7cde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 10 21:01:57 2014 +0100

    configure: Provide a poor man's replacement for getline()
    
    uClibc is one such library that doesn't implement getline()
    
    Reported-by: Ben Widawsky <benjamin.widawsky@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8587b2fff218537c6ff568ac3ef561f0d39f03ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 8 11:53:13 2014 +0100

    sna: Rewrite rotation setup on top of universal drm planes
    
    The kernel interface has changed slightly since the early proposals. Now
    the rotation property is only on the plane and so we have to lookup the
    primary prime as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f24a9d335273fec20679397abcc3d5405d9613df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 5 14:40:38 2014 +0100

    sna: Fix a couple of DBG messages
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 790e7492bdb5c0c77c53ae769f0d408b04d5c99b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 5 09:46:00 2014 +0100

    test/lowlevel-blt-bench: Add common PDF operators
    
    Applications are starting to use PDF operators, so far I have spotted
    multiply, dodge and lighten.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8fa22964f69d3ec8700f177dd7cb3cbc396a9f35
Author: Matthieu Herrb <matthieu@herrb.eu>
Date:   Fri Jul 4 18:26:09 2014 +0200

    backlight: Fix security issues in handling of the interface path name.
    
    - don't allow '/' in the interface name to avoid escaping the /sys
      hierarchy
    - check snprintf() return value for overflow.
    
    Problems reported by  Adam Sampson. Thanks.
    
    Signed-off-by: Matthieu Herrb <matthieu@herrb.eu>
    Reviewed-by: Reviewed-by: Hans de Goede <hdegoede@redhat.com>

commit 6a64a3ae55ad5f743d2b7a4852b6ca7b54d2a142
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 13:04:02 2014 +0100

    sna: Discard operations to either CPU or GPU bo when overwriting with RenderRectangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c8ab77fcd71b7f96ad7bc379e5c68b3b45a5069
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 12:43:55 2014 +0100

    sna: Tweak number of threads for short areas
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3ccb3f3b2a3cb4c8b51d58d185dd10b85e025eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 12:39:01 2014 +0100

    sna: Convert a clear tile into a solid fill
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e0763088f8e159b414cec5c056cc4c91a34766e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 12:26:43 2014 +0100

    sna: Fix typo s/num_threads/max_threads/
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04ddea075e9e07cf3158594130d5ba7d1f50f7f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 12:14:11 2014 +0100

    sna: Do a quirk early check for short areas before threading
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 228a22fe8db044a18556a9fdb989323274817771
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 12:10:10 2014 +0100

    sna: Disable use of threaded compositor when using threaded renderer
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64bcb91f58fba3956f2c66fa37707b9e496da936
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 11:02:39 2014 +0100

    sna: Utilise existing cached upload for promoting to GPU bo
    
    If we already have a buffer that represents the data on the GPU, we can
    simply use that when we need to promote the pixmap onto the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 821ef20b27f84cc26aec266b0f616a7f39ba9e3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 10:43:35 2014 +0100

    sna: Promote tile pixmaps to GPU when reused
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6407f7380829f822a462100d26bc531aed0fd6f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 10:14:54 2014 +0100

    sna/gen8: Disable the unaligned check
    
    Note sure if this is strictly required -- but at the moment it fails for
    1x1R solids, causing us to skip glyphs. The simulator doesn't complain,
    so just skip the check for now.
    
    Reported-by: Ben Widawsky <ben@bwidawsk.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e64d14d7bc72fe7b150e5427feeb1a163ec600a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 09:55:04 2014 +0100

    sna: Tighten assertions for using upload proxies concurrently with CPU reads
    
    After relaxing some of the rules on when to discard the upload proxies,
    we also need to relax some of the complementary asserts.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e12d5ca26bdfafd7b9cd02c36e6d991f068f29b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 4 09:48:53 2014 +0100

    sna: Prevent creating a GPU bo for an inplace read
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18ae7722dbdf6ab61560962ed6ca8d39f353b1f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 3 18:18:04 2014 +0000

    sna: Wrap xf86DPMSSet
    
    We need to wrap xf86DPMSSet() so that we can reintialize our bookkeeping
    and auxiliary planes after disabling/re-enabling CRTC during DPMS
    operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57d0cc82d851b95d4e3b1821287dd3ffd1cf6e3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 3 09:07:44 2014 +0100

    sna: Clear the cursor reference from the CRTC if the update fails
    
    This should allow it to be restored correctly the next time it gets
    shown.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24c9bac7eb6e17b55044d719bab74d16fd68c450
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 2 21:17:54 2014 +0100

    sna: Limit the size of the tiling object to be smaller than either the originals
    
    When we tile, we do so in order to fit an operation involving two
    objects larger than the aperture. If we then choose an intermediate
    tiling object that is larger than either of those two, the error will
    persist and we will be forced to recuse.
    
    In the worst case, this will provide an upper bound to the recursion.
    
    Reported-by: Bruno Prémont <bonbons@linux-vserver.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 710bb0d37c681f2ffdeaf263b6ee7d9488670bc0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 2 09:16:07 2014 +0000

    test: Create separate SHM segments for ref/out
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87e659b887f4c738cfc91439efdac0d48fd294f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 2 10:47:32 2014 +0000

    sna: Use the threaded compositor for picture conversions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2bf36d54ebdfa2a59bf7ef71134b953628ae5d50
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 2 11:31:54 2014 +0100

    sna/gen6+: Tweak consideration of compositing on BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 732cd11cf0ca813fdc06f9f09fab120ea4e3a7da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 17:54:49 2014 +0100

    sna: Fix typo in LinearFramebuffer handling
    
    Eeek, when not using LinearFramebuffer we still want to create the GPU
    bo: s/,/;/
    
    Reported-by: Ilia Mirkin <imirkin@alum.mit.edu>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5fa463b90c49ebc635d79b1561c94a4857e9cf6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 17:53:56 2014 +0100

    sna: Correct migration flags for initial scanout creation
    
    We want to preserve any contents preloaded (not that there should be
    any...)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b88866aa5ebf813a999e194dec24e9ef2ac4f59d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 16:59:31 2014 +0100

    sna/dri2: Add a DBG option to select copy method
    
    Often when debugging it is useful to force either use of the BLT or 3D
    pipelines for copies.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a10781b70f222f3997928fa979f6292617f79316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 15:11:07 2014 +0100

    sna: Enforce LinearFramebuffer option
    
    This option should only be used for compatibility. Previously this was
    done at a high level, this changes it to enforce the tiling as we apply
    the CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75745cd5861481c5a9a31125d357f339349dd0f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 14:31:32 2014 +0100

    sna/dri2: Use CPU fallback if possible
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02715490db13dcd47c5e4bef713f400838d94b99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 1 13:10:32 2014 +0100

    sna/dri2: Set depth/bpp on scratch DrawableRec
    
    We need to initialise both depth and bitsPerPixel on the drawable struct
    we pass around as they are used for selecting for the format when
    copying.
    
    Reported-by: Vedran Rodic <vrodic@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6e5330857097eb2caafa89d571d12e4bb15f539
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Mon Jun 30 19:24:13 2014 +0100

    intel: Use the i845 info structure for INTEL_I845G_IDS()
    
    I assume the intention was to provide a different structure for each of
    the gen 2 devices.
    
    This doesn't change anything really.
    
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>

commit e1c3e6ce79c73d12c814cfda76dbc0df184902ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 19:56:39 2014 +0100

    sna: Add DBG breadcrumbs before flushes in BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43176b9bfafe389c4b9ed676f4e50e3b06f858c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 21:01:11 2014 +0100

    sna/dri2: Pass around the correct DrawableRec for sampling from the foriegn bo
    
    One day, we will move the width/height/bpp to the bo itself...
    
    Reported-by: Ilia Mirkin <imirkin@alum.mit.edu>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c3399715e316be970c696b8949e3c14e83ea5df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 16:32:45 2014 +0100

    sna/dri2: Apply the paraniod buffer clip in the correct coordinate system
    
    We need to only clip to the extents of the copy in the buffer space -
    which implies that we need to translate the region into that space before
    doing the clip.
    
    Reported-by: Ilia Mirkin <imirkin@alum.mit.edu>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c25fa2216a3674f564a7e35d263a5d405aa97816
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 14:13:13 2014 +0100

    sna: Tweak preference for small GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19a62e088f5202026bdfde7a8af36598b69f8243
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 11:20:54 2014 +0100

    test/lowlevel-blt-bench: Update progress more frequently
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fab3bc70a450d94104c96ddbe7fa6e6ace1bb8f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 11:05:33 2014 +0100

    sna: Reduce assertion when using asynchronous CPU access
    
    If we are not actually accessing the memory through the pointer, we do
    not care if it not currently coherent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ffe8bd4d6e296a0ded0e118aee05aa6cb3051c56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 10:55:20 2014 +0100

    sna: Silence snarky compliers
    
    0 != (void *)0
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05f6183075867d582b7f9f74aec42e632e3d83dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 10:46:00 2014 +0100

    sna: Mollify assert to be consistent with the scanout flush
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e0000688d034535083950b98bc61745dd965352
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 08:44:33 2014 +0100

    test/lowlevel-blt-bench: Exercise masks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37ac34c4e4500bfc272222754949edc1dbb8c7e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 08:44:33 2014 +0100

    test/lowlevel-blt-bench: Exercise SHM pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 901d889dd7397dfa4c291f96af657e4b3433d795
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 30 07:44:25 2014 +0100

    intel-virtual-output: Remove one redundant cleanup on error
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8b0ba0ed5f27e0d671b650d6f4bfe2fd86a0f3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 29 15:25:19 2014 +0100

    intel-virtual-output: Cleanup singleton on failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81889664851e3a2218d1ac5d39ebd2bd3b6a4954
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 29 08:29:36 2014 +0100

    intel-virtual-output: Convert debugging messages to verbosity
    
    Original patch by main.haarp:
    "A verbose switch is quite useful for debugging, it shouldn't require
    editing and recompilation to gain more useful output. I added it."
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80664
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 665d012b8e1b9666e535a3081404406f31b8a3ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 29 09:26:10 2014 +0100

    sna: Ensure CPU bo is synchronized before writing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b906ae742ec96eeef403191d3cdded6a23a70b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 29 07:02:44 2014 +0100

    sna: Update allocation of CPU bo to avoid creating active buffers
    
    Since we now prefer CPU detiling, exactly when we want active/inactive
    buffers is a little more complex - and we also need to take into account
    when we want to use the CPU bo as a render target.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b961d7323369284ea2c3db47d30c27ffe01a9040
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 29 07:00:58 2014 +0100

    sna: Sync CPU bo before writes
    
    Fixes regression from
    
    commit 961139f5878572ebea268a0bbf47caf05af9093f [2.99.912]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 30 09:45:15 2014 +0100
    
        sna: Use manual detiling for downloads
    
    Reported-by: Harald Judt <h.judt@gmx.at>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80560
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53ef9e762a6e7802b3d5f8fba9ac17ff95545c10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 21:07:08 2014 +0100

    sna: Only preferentially upload through the GTT for large transfers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0955f12ae04011593b71817e3151b8fb7c228899
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 17:38:54 2014 +0100

    sna: Prefer linear if below tile_width
    
    Be stricter in order to allow greater use of CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ef966f4c5bae07108ce2720f4da3c3c4e41e1aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:23:29 2014 +0100

    sna/io: Prefer CPU copies on LLC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fc052da5c4246402d2707b3a91efffa7dd81e08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:22:17 2014 +0100

    sna: Don't discard damage for SHM pixmaps
    
    We don't really want to rendering into SHM pixmaps except for copying
    back due to the strict serialisation requirements.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f8b39d24ff15cf3373ac7293f12772ebe16b68b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:21:36 2014 +0100

    sna: Check for a mappable GPU bo before migrating damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cfdaee4a7e45689b0fbbc8c3166d28d69797e759
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:20:00 2014 +0100

    sna: Skip adding damage if it is already contained
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80752fb2794faa581d891b24148eaf51c42afd25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:19:22 2014 +0100

    sna: Tidy calling memcpy_from_tiled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a0176379f0ff290d276adc72d44dfddafd96da5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 14:18:23 2014 +0100

    sna: Micro-optimise unswizzling tiling/detiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24cb50e53c789cb7a05d59ad103dda1c3a009485
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 28 07:05:55 2014 +0100

    sna/trapezoids: Handle mono traps just in case
    
    I disabled a few paths and ended up in an assert that mono trapezoids
    shouldn't get that far...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72c041e57b99367f327c51c50fce2a55d618fc63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 16:26:24 2014 +0100

    uxa: Update Screen Pixmap width/height first
    
    Since commit dd6db82680b05cde4a47116b7096c054f3837e20 [2.99.912]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 9 20:26:19 2014 +0100
    
        uxa: Add DRI3 and miSyncShm support
    
    we verify that the attaching bo meets the constraints required for the
    Pixmap. However, when updating the ScreenPixmap following a resize, we
    did not update the Pixmap size until after we tried to update the bo,
    resulting in a validation failure when shrinking the screen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0584604b53c8676adfa1f8f4d3def22c93ea822f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 16:12:35 2014 +0100

    test: Expand number of sources for basic benchmarking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit edd2b789568b14c29a004a64b6ff82bb6e4e9620
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 16:00:03 2014 +0100

    sna/dri2: DBG compile fixes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6ba93283b20a50ff36758624d2967562b7bdae9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 13:42:37 2014 +0100

    sna/glyphs: Add DBG option for glyph tolerance
    
    And bump it to 3 so that glyph filtering doesn't force us to use the
    mask too often.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee5c74deee77db4292ce197ab7facca422f86021
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 12:56:43 2014 +0100

    sna/glyphs: Add DBG option for forcing glyphs-to-dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ba4ee1fe842e975c94a01f93c6d39c20eadadbe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 27 10:38:59 2014 +0100

    sna: Check source bo is suitable for BLT before doing so
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 157e22cb8e96b0a9ffa7d58625fe2396f6084ff9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 20:19:52 2014 +0100

    sna: Only reuse pinned batches for 830/845
    
    Trying to fly too close to the sun. :(
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80558
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f027b4f628b6d0f4c00f8aba7b27dcf51f91211d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 20:24:05 2014 +0100

    sna/dri2: Slightly improved DBG messages
    
    Missing git add from
    
    commit 2e8c09f3fe468abba9c307ba3d7b2d22908e1172
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 25 22:19:23 2014 +0100
    
        sna/dri2: Hook into ClientGone callback to clear dangling references
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ae5d7d9415a77c76078bc340066df73dce72d27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 20:21:12 2014 +0100

    sna: Tidy selection of a near-miss active buffer.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80560
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cad98eca64224534887efbcd1c60604cd491c35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 12:42:30 2014 +0100

    sna: Fix userptr defines to match i915_drm.h
    
    Now that we are starting to see userptr in the headers, we see that the
    definitions slightly changed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5c7dd24a55f04322d5eec10dc4352d8a8e92b1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 09:25:06 2014 +0100

    sna: Remove scare quotes from hotplug detection "enabled"
    
    Tidy up the log message by improving its formatting, and making it more
    accurate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e8c09f3fe468abba9c307ba3d7b2d22908e1172
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 22:19:23 2014 +0100

    sna/dri2: Hook into ClientGone callback to clear dangling references
    
    As the Window may exist for multiple Clients, we cannot rely on the
    destruction of the Window decoupling all outstanding events and
    preventing chasing a stale Client pointer.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80157
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12a349974b63a47ad55384abe0d7a839af48f31a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 26 06:59:07 2014 +0100

    sna: Make output destroy more defensive
    
    We may never create the properties as it may be ignored or the
    allocation may fail, so we need to be careful when freeing we do not
    stumble over invalid pointers.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355#c28
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ec2164ba4bd3a266949cdb379b6da1090475c08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 18:05:46 2014 +0100

    sna/dri2: Compile fixes for ancient Xorg
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 258f8983daa3a8fe315c440f5e298ae1b02fd678
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 17:20:52 2014 +0100

    sna: Fix uninitialisable variable
    
    sna_render.c: In function 'sna_render_picture_downsample':
    sna_render.c:822: warning: 'priv' may be used uninitialized in this function
    
    introduced in
    
    commit ded05e8abb248664124d2b86f77c27497a252c4e
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 23 22:15:56 2014 +0100
    
        sna: Allow scratch pixmap to allocate linear GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca0d06add926eb17fcec6c031adabb656498d744
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 14:19:33 2014 +0100

    sna: Improve throttling during bo allocation
    
    By controlling how long we may block during buffer allocation, we can
    relax the throttle elsewhere to prevent render lag buildup.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ad1661b870b5b189e52383e45a9b8f570b40501
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 13:21:58 2014 +0100

    sna: Only mark throttle as done after success
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3e4518e84300aeb8e12a0af56c2d66a1df9d8d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 11:18:01 2014 +0100

    sna: Track desired flushes better after starting a new batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85bb55e4a62666fa51af34d08699950be362aa57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 11:45:55 2014 +0100

    intel: Fix weblinks (again)
    
    Julien pointed out that I fail at checking links.
    
    Reported-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff31d49bfa48a74eb9d8cb0afb1e2882ffbc7573
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 11:31:58 2014 +0100

    intel: Fix weblinks
    
    Matti reported a few outdated links to intellinuxgraphics.org, now
    superseded by 01.org.
    
    Reported-by: Matti Hämäläinen <ccr@tnsp.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c1729aab6b49e7d4a3f48516a629b0d23e8591b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 09:00:04 2014 +0100

    sna: Tweak scanout flush
    
    We now distinguish gpu_dirty whilst the bo is not flushed within a batch
    and needs_flush for when it is dirty and still busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26c4e850b8a7d13afc351097ee6f6b2f3f90e2b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 08:18:25 2014 +0100

    sna: Throttle before doing a TearFree buffer replacement
    
    If the client is rendering fast, he may be rendering too fast and
    starting to build up a backlog.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea6b0bb8e1b358d728d80daac936ec6521154302
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 08:05:22 2014 +0100

    sna: And fix the typo...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f4da671b0a570de8734cc668d8e8975c2fdbd90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 08:01:57 2014 +0100

    sna: Disable userptr for bdw
    
    Something fishy is afoot. But let's kill this particularly worrisome
    regression so that we can do a full round of testing.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79053
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 204ec74a61ba0b9628c686b98c48fa1220866c2d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 25 07:31:33 2014 +0100

    sna: Check all connectors for reuse
    
    Do not rely on the MST path being present to indicate a connector that
    may be reused.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80355
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43ad5dbc60e1f50a9cdcfc035bc271f1f28438c2
Author: Rodrigo Vivi <rodrigo.vivi@intel.com>
Date:   Tue Jun 24 03:14:54 2014 -0700

    Add marketing names for Broadwell
    
    Even the unknown/reserved ones will stay with HD Graphics.
    
    v2: Add missing names to intel.man and README files as well. (Chris)
    
    Cc: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>

commit 78053bb84217e842615669dfa2f1e7e971ce9860
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 20:51:54 2014 +0100

    Add reserved PCD IDs for Broadwell
    
    Updating using kernel commit fb7023e0e248a33cb00d0a9cdce0bcedaa1ad284
    Author: Rodrigo Vivi <rodrigo.vivi@intel.com>
    Date:   Tue Jun 10 10:09:52 2014 -0700
    
        drm/i915: BDW: Adding Reserved PCI IDs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74c1cf60a7ce7e79bc727780151f4f233798e5f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 20:49:18 2014 +0100

    sna: Add yet more DBG messages to MST discovery
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca296c18316a3ce1682beefd5daa4702593cd529
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 16:37:52 2014 +0100

    configure: Display our README before the summary
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d14d7efb28c3e323203139b7c1562b1e0bc526f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 16:33:43 2014 +0100

    intel: Add a note about the myriad places we have identifier strings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c7cf7a6bb1c91b59ad326198f3364554e3dfeb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 11:50:55 2014 +0100

    intel: Wait for our expected device node to appear
    
    If the path we want to open for the KMS device is not yet available,
    wait a short while and try again.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80397
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c8829b30ad3acd2e59dac9ffa2aba8aadcada61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 11:35:23 2014 +0100

    sna: Add some more DBG around connector discovery
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 271ed88e517745505c133bd68c40a8566ec8a625
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 11:24:26 2014 +0100

    sna: Ensure serial is not 0 for runtime MST discovery
    
    We reserve serial==0 for the initial setup that is run before RandR is
    configured. After the server is running, we have to take extra steps to
    make the outputs visible to userspace.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92dd13ae8dbddc31d0291dd12683fc7e3f65ffde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 11:04:01 2014 +0100

    sna: Fix the usual "x = y" typos in creating boxes
    
    Fixes regression from
    
    commit 1d74b2e07d125ad95b9db6c9c032e90faf2bfa60
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jun 24 08:58:51 2014 +0100
    
        sna: Decompose self-copy into overlapping/non-overlapping regions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92119ef0939897dd1850b417d04a2ba558aee8ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 10:23:03 2014 +0100

    sna/glyphs: Clip damage to dst
    
    We only check if the hardware will automatically discard writes outside
    of the target pixmap, but we must manually clip the damage before adding
    it to our tracker.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461#c58
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b33be7fbac005eb222302ffbb533ded1cd700953
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 10:17:47 2014 +0100

    sna: Trim composite region against dst clip extents
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f66e25def3431a900068cc1c23a6b1e8322ef046
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 16:14:28 2014 +0100

    intel: Wait for the DRM device to load
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80397
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d74b2e07d125ad95b9db6c9c032e90faf2bfa60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 08:58:51 2014 +0100

    sna: Decompose self-copy into overlapping/non-overlapping regions
    
    We only need to stage the copy for the overlapping portion of the
    self-copy, for the rest we can do in a single pass.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e2cee27c379278b0321fd1db34ed80c439115a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 24 07:34:46 2014 +0100

    sna/dri2: Add a dash more asserts
    
    References: https://bugs.freedesktop.org/attachment.cgi?id=101618
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 706480bde6120f84388a99085ed3d1cc3b759697
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 22:50:23 2014 +0100

    sna: Disable CRTC after MST topology change
    
    In order to disable CRTC after marking outputs as removed after probing
    MST topology updates, we must manually mark the CRTCs as no longer
    enabled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5530cb4165da60f7b929b84d733d5eefcf4ec5fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 15:47:13 2014 +0100

    sna: Silence compiler warning for shadowed variable
    
    sna_display.c: In function 'sna_mode_redisplay':
    sna_display.c:6322:12: warning: declaration of 'fb_id' shadows a global declaration [-Wshadow]
    sna_display.c:223:24: warning: shadowed declaration is here [-Wshadow]
      CC     sna_display_fake.lo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ded05e8abb248664124d2b86f77c27497a252c4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 22:15:56 2014 +0100

    sna: Allow scratch pixmap to allocate linear GPU bo
    
    When allocating a scratch pixmap, we do so in the expectation that
    rendering on the GPU is always preferrable, so even allocate a small
    linear bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c5658b14451239b8e4333702a227d83eed09f96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 14:11:27 2014 +0100

    sna: Promote to full GPU bo after forced migration away from CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25776547bb7d76010f948769c8c08a7f418b15fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 14:02:51 2014 +0100

    sna: Prefer rendering on the CPU to avoid damage migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3c9cbefcb9971900638144286b59112e3cfd404
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 12:27:30 2014 +0100

    sna: Force creation of GPU bo for drawing if need be
    
    Now that we are more eager to transfer to the GPU bo if we expect
    rendering to the CPU bo to be either slow or risk potential corruption,
    we can find ourselves in a recursive loop when we also decide not to
    create the GPU bo. Prevent that by explicitly creating the GPU bo if
    desired.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 827b89fa2d5fca0ffd709c17bcdbfdaf95da918f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 11:44:22 2014 +0100

    sna/gen6+: Initialise src offset before use
    
    Fixes regression from
    
    commit 30348efd57135edee41fccb87133c572b6473aa8
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 23 11:14:25 2014 +0100
    
        sna/gen6+: Avoid adjusting copy coordinates until commited to using them
    
    which assumed that the render state was being zeroed.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6848fb235b1bac84e91d1efde4094540180c4d48
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 11:27:20 2014 +0100

    sna: Fix flushing empty batches
    
    A logic inversion in
    
    commit 1909910fdf89216d18703e50728f4604f75d5d66
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Jun 22 20:19:22 2014 +0100
    
        sna: Inject a batch flush before adding a fresh bo
    
    also applied the injection to when the batch was empty.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461#c48
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60fd6764eba05f51bb83efba5593975cf8d1285b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 11:25:47 2014 +0100

    sna: Handle old busy_ioctl not reporting the active ring
    
    If we have an old kernel, just presume that the bo was last active on the
    render ring.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 30348efd57135edee41fccb87133c572b6473aa8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 11:14:25 2014 +0100

    sna/gen6+: Avoid adjusting copy coordinates until commited to using them
    
    If we need to fallback to the BLT unit, we need to pass it the original
    source/dest coordinates and not our transformed render coordinates. So
    keep the original values intact until we start emitting the render
    operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1e853edee67c3ced43d5e4b1fbd52ca4c92966d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 10:14:09 2014 +0100

    sna/gen4+: Add some more asserts around recreating vertex buffers
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461#c46
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 978790dc52fa9551b3bccbd91988b93988e937df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 09:47:34 2014 +0100

    sna: Allow the CPU bo to be created if GPU rendering is forced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2206eca00e497aff0d79a6e9feae3d9c5070dcc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 09:42:37 2014 +0100

    sna/gen6+: Encourage the compiler to inline a couple of key functions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb4c057620fb0558a77a9b7db538786ffda7cf13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 09:22:13 2014 +0100

    sna: Prefer to render over damage into the GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 416c223861aaeb61c6408e6537315b78e908df43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 09:20:55 2014 +0100

    sna: Do not set CAN_CREATE_GPU flag for untiled allocations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb51ec44f4b6069ab854233d5d0da34eb79f754c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 09:07:13 2014 +0100

    sna: Rename IGNORE_CPU to IGNORE_DAMAGE to better reflect its purpose
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96d2749660e1738847222f2d9dbb7303b7deb5bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 08:18:23 2014 +0100

    sna: Add DBG breadcrumbs to sna_output_discover()
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a33aa554fa3df8ca34012cf1c6ecb11fa69ac7fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 07:42:30 2014 +0100

    sna/gen4+: Add box emitters for the generic vertex paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1909910fdf89216d18703e50728f4604f75d5d66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 22 20:19:22 2014 +0100

    sna: Inject a batch flush before adding a fresh bo
    
    Fresh bo (those without a reservation already defined, ala
    presumed_offset) will cause the kernel to do a full relocation pass. So,
    if possible flush the already correct batch in the hope of trimming the
    amount of checking the kernel has to perform on this new batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83cbbcd816e449402f3d49aeba3c099a20b8bc1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 23 07:29:20 2014 +0100

    sna: Add missing string for DBG
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355#c12
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f22ea4e821a33eccd3a9283d7ab048857008f7e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 22 17:53:59 2014 +0100

    sna: Disable unused CRTC after undock events
    
    If undocking removes output (as the MST topology changes and some
    outputs then become unreachable), we may leave dangling CRTC. This
    confuses us, so disable any enabled but unconnected CRTC after the
    undock event.
    
    Reported-by: Sree Harsha Totakura <freedesktop@h.totakura.in>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355#c5
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dca0f1c2ccf14df38764ed12b971dc491cf22608
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 22 17:53:59 2014 +0100

    sna: Track CRTC mode changes and discard old flips
    
    If we have a pending flip across a modeset we must be careful to drop
    the stale flip_bo after the modeset.
    
    Reported-by: Sree Harsha Totakura <freedesktop@h.totakura.in>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80355#c8
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dae370423ad85b9d9c576277da5a9fb92ab3d3df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 22 11:45:35 2014 +0100

    sna: Clean up CRTC on CloseScreen
    
    We need to do this to stop any stray references escaping through kernel
    events now that we are passing the CRTC through the event.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 923dc207df7b05c138c628983ccaf2493dd63b62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 10:17:11 2014 +0100

    sna: Discard write hint from a couple more move-to-gpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2046a49be59866a16db776ba53a588dbf6c02b12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 21 15:43:32 2014 +0100

    sna: Clear the transform flag on disabling the CRTC
    
    In places, we assume that if the flag is set, we must have an active
    CRTC. However, we were not clearing when disabling the CRTC.
    
    Reported-by: Sree Harsha Totakura <freedesktop@h.totakura.in>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80325
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3d3c0e8e75a963262e4dc463fef60d7e9f1f01a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 20:01:23 2014 +0100

    sna: Avoid blending with the render engine on snoopable bo
    
    This seems slightly weird, as there is nothing to indicate that this
    would generate incorrect results only for snoopable bo. But no many of
    flushes make my pnv box happy, so adjust the placement logic to move the
    blending operation away from the snoopable target. This is sensible for
    reasons of avoiding snoops from the render pipeline anyway.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80253
    Reported-and-tested-by: Matti Hämäläinen <ccr@tnsp.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 219f6bd9e863f9c89cc4168895f89741ce6dbcbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 17:06:55 2014 +0100

    sna: Be more flexible in converting random subsamples to 8x8 tiles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91bc9e42e434abd56ce2e4fc5e08d07376fe8bd3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 16:13:49 2014 +0100

    sna: Mark up const boxes to keep the compiler happy
    
    Pass around const to suppress a few compiler warnings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5c68b4358ce541929681c8c1e0ad3ef8c1dc9ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 14:31:19 2014 +0100

    sna: Feed more operations into the 8x8 BLT tiler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2b90ac969656de35ec86973f66074654b0e9b4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 14:29:43 2014 +0100

    sna: Color patterns for BLT are required to be aligned to 256 byte boundaries
    
    This so far appears to be the most restrictive alignment required, so
    simply increase the upload alignment to 256 bytes.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80033
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d7e7010e33d73a7d99948403b62d859d7a4dfaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 08:28:32 2014 +0100

    test: Increase number of tiled sources
    
    Significantly improve the stress impose upon the tiled BLT operations.
    Also start dumping pngs of the failures.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80033
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db6dfc3227155a4792ba3831681daf16839b14bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 20 07:28:02 2014 +0100

    sna/dri2: Don't decouple front buffer tracking for invalid SwapBuffer calls
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 113a8b9be9dd7ffbc6f7c713bc40561bdf38e8b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 20:39:59 2014 +0100

    sna: Mark upload from SHM segment as read-only
    
    As this may be mapped by the Xserver using a read-only SHM segment, we
    are forced to treat it always as read-only. And this being X, that it is
    using a SHM segment is opaque to the driver. Fantastic middlelayer.
    
    This was incorrectly removed in
    commit e680e54eab6ffa72e5e1eb6cc0e3fe4b235b06a1
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 11 10:48:26 2014 +0100
    
        sna: Ignore setting read-only for temporary userptr maps
    
    Also let's not forget the ShmPutImage -> CopyArea path.
    
    Reported-by: Christoph Haag <haagch.christoph@googlemail.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=78411
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df89b4941130b5ff020c6ef3e244dcf5fec45f2a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 20:39:59 2014 +0100

    sna: Mark upload from SHM segment as read-only
    
    As this may be mapped by the Xserver using a read-only SHM segment, we
    are forced to treat it always as read-only. And this being X, that it is
    using a SHM segment is opaque to the driver. Fantastic middlelayer.
    
    This was incorrectly removed in
    commit e680e54eab6ffa72e5e1eb6cc0e3fe4b235b06a1
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 11 10:48:26 2014 +0100
    
        sna: Ignore setting read-only for temporary userptr maps
    
    Reported-by: Christoph Haag <haagch.christoph@googlemail.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=78411
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b32cf3a3c908bd29496fcf5d190fd0f8c657ae6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 12:29:58 2014 +0100

    sna: Missed fixing y tile offset in last commit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit edeb2ddd170a1817ced45abada53346c5cd8c30b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 11:51:00 2014 +0100

    sna: Use the right pattern origin for tiled 8x8 extraction
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80033
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1752e2d647cdb7cbff0ae7d0f0d0b761b5942965
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 11:14:25 2014 +0100

    sna: Fix up small extents for 8x8 tile construction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f866a20c991d52fd2cf4ce63acc3cd44534ce5be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 10:49:09 2014 +0100

    sna: Wrap pointer access for 8x8 tile construction
    
    The kernel can quite happily send a SIGBUS whenever we read from an bo
    (due to oom), so catch it and handle it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1aab55d594f03e51c3abf1743d00c56ef6d7797
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 09:47:02 2014 +0100

    sna: Always readback shadow damage after replacing the buffer
    
    Instead track what we explicitly want to discard for the next operation,
    so that we don't have to copy back the whole buffer if we have to
    replace the shadow and intend to overwrite it all.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4b930318c68e0e07d677ebc7b4caa27912561db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 19 07:40:16 2014 +0100

    sna/dri2: Replace assertion with code to skip updating the back buffer
    
    After a window resize or redirection, the DRI2BufferPtr become stale but
    it may take a while for the Client to notice and reconfigure. Just
    skip touching stale backbuffers and let the Client catch up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c257c936b42b92827b784cee0b7caa54e6040364
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 22:15:42 2014 +0100

    sna: Fix modulus for partial conversion of tiles to 8x8 patterns
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9489cc6c70abf53d9ca45228b0aa9fb1fc3f9b72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 21:28:11 2014 +0100

    sna: Delete the silly typo
    
    Not checking DAMAGE_IS_ALL() correctly leads to an assertion failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51a0559b120dd0a57a938b300bccefbf1142e495
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 20:55:02 2014 +0100

    sna: Do not treat both src/dst having no clones as being the same
    
    Fixes regression from
    commit 62aaf2ff4f8597067cf387865707baa00ed9a123
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 18 18:41:15 2014 +0100
    
        sna: Skip redundant copies when already cloned
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 377b0e8657aab13dc90134853a03feb95f515567
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 19:59:14 2014 +0100

    sna: Add log breadcrumbs with valgrind
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 273c82a574896885f9f4a78a7463cc4620803624
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 18:47:14 2014 +0100

    sna: Fix DBG compilation
    
    Missed updaing the DBG message in
    
    commit 83c0f034454ef0f474126a3398e5e790ac5ef842
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 18 16:51:46 2014 +0100
    
        sna: Pass desired CRTC viewport for completing single CRTC flips
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80157
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62aaf2ff4f8597067cf387865707baa00ed9a123
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 18:41:15 2014 +0100

    sna: Skip redundant copies when already cloned
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83c0f034454ef0f474126a3398e5e790ac5ef842
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 16:51:46 2014 +0100

    sna: Pass desired CRTC viewport for completing single CRTC flips
    
    We cannot simply compare against the crtc->shadow_bo for all our needs,
    so pass in exactly the setup we want and apply that. In particular this
    is required when flipping away from the single CRTC setup on secondary
    pipes.
    
    Fixes TearFree multi-monitor regression from
    commit 3932e97057fca16615adaefbc1eb25a0d51a1d8b [2.99.912]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 9 08:58:15 2014 +0100
    
        sna/dri2: Allow TearFree flipping to individual CRTC
    
    Reported-by: Leo Wolf <jclw@ymail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80191

commit 7119d394a673f40eb467d040c6febf3749924394
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Wed Jun 18 15:01:37 2014 +0200

    uxa: Mark the output as off before making pipe changes
    
    This is a partial "backport" of commit c6cd10f536, which makes the same
    change for sna, to avoid users still using uxa ending up with a blackscreen
    after plugging in an external monitor.
    
    Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1032978
    Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1103806
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 52af321a11b5672194bc0bad033b0866221bf4c7
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Wed Jun 18 15:01:36 2014 +0200

    uxa: When the output is off, report the cached backlight value
    
    This is a "backport" of commit b545e10c50cb to uxa, so that users who are
    still using uxa, don't end up with a black screen after suspend / resume.
    
    Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1032978
    Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1103806
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 44b5912ffcf8dcf4b4b8d3518dd0b62a284f6ee4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 14:48:33 2014 +0100

    sna/gen8: Fix cleanup after failing to convert channel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21b6e551528fdd939004cfb02a4f192e750a33a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 14:44:09 2014 +0100

    sna/gen8: Fix unaligned() to return true when not aligned
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5b063b8cc23cc43be458cb3b0d1b28652a24951
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 14:34:04 2014 +0100

    sna: Assert that we do not try to mmap a proxy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40bd45fb802366aa013b9089848b67a28bf3b1ee
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Wed Jun 18 14:11:05 2014 +0100

    backlight: Fix compiler error
    
    /usr/include/xorg/os.h around line 579 reads:
    
    extern _X_EXPORT char *
    strndup(const char *str, size_t n);
    
    However strndup is already defined by glibc, and this redefine causes a
    compile error.
    
    This gets triggered because backlight.c does:
    
    Without first doing:
    
    Causing HAVE_STRNDUP to not be defined.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit e52f917a2370026073ed6851161393a69ee94abe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 10:18:26 2014 +0100

    sna: Use nxm tiled blits for small regions of large tiles
    
    If the region we are blitting is either narrow or short, we may be able
    to construct a tiling pattern out of a large pixmap.
    
    In the process, spot a regression due to
    
    commit 542aeca6e67fc64f9133ca3e27ac8eca28af6d25
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jun 17 12:26:30 2014 +0100
    
        sna: Tweak creation 8x8 tiled patterns
    
    which copied too much from the source line.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79888
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b90f6c5aa7359ea6936ae4a7951fcd3bdad05d58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 10:17:02 2014 +0100

    sna: Simplify sna_pixmap_get_source
    
    kgem_bo_upload_image was open-coded, so replace it with a call to the
    common function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ea2dd23ab85dc2d4ad0de326c2176354d61cf20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 10:16:26 2014 +0100

    sna: Add DBG option to disable snoop bo cacheing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2081345843152dadcaa4fbc843b38240d1a3484
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 18 07:37:00 2014 +0100

    sna/dri2: fix invalid DBG string
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80157
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77f1a16f1145e69d69a76f2db4b1c60d9a7a4d53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 23:27:16 2014 +0100

    sna: Set the correct mapping type after calling mmap__async
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80001
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d49f53cc00258e3b1e1a898c02e219b336716002
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 22:23:02 2014 +0100

    sna: Fix computing source bo for BLT operations
    
    If we migrate the pixmap to the GPU, use the GPU bo. This may fix an issue
    where we might end up using the CPU bo in a rare circumstance.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80033
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 475562d713a00e2f60f7ca067d753fd965d71717
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 22:25:05 2014 +0100

    sna: Align some function parameters
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c91fc0aad843ffc2660f6a3bf9b875d190e0b0dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 17:06:05 2014 +0100

    sna: Remove invalid assert
    
    Present and flip fallback may queue self-flips, so the assertion that
    the crtc->flip_bo != crtc->bo is false.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ca25c7b49efa9c83a3ce5b727e5a339a73d8ee0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 14:08:06 2014 +0100

    sna: Cache small pixmaps rather than forcing a large fallback for BLT operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 322e51a3a552d89e5e5ecbb82a9243f134c8d36f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 13:47:32 2014 +0100

    sna: Relax PREFER_GPU so that we don't needless create small GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 542aeca6e67fc64f9133ca3e27ac8eca28af6d25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 12:26:30 2014 +0100

    sna: Tweak creation 8x8 tiled patterns
    
    Avoid reading back from a GTT mmapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ff5cc539bc3f88ab9c05dc67c25aab08cbdf859
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 10:54:39 2014 +0100

    sna/dri2: Fixup failure to do a render copy for DRI2CopyRegion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96d1fe314c4bb4d862b057a440e575bd32d63460
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 08:51:00 2014 +0100

    sna: Add a few missing checks for all-damaged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 30f521c717f7301004e7cb77ba66b840b3f773c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 08:30:55 2014 +0100

    sna: Discard GPU damage for the magic upload proxy
    
    The magic upload proxy is initially considered damaged in both the GPU
    and CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5b94c2d9b29b78432aa72049934e365a2913710
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 17 08:12:42 2014 +0100

    sna/glyphs: DBG compile fix
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4d845bc8f77e4a36064f132720ce462d0bdd5b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 14:25:16 2014 +0100

    sna: Regularly check the cache level on bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09f0fe9b3943ae2ba1e0ebd679ea04177427a8cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 12:53:34 2014 +0100

    sna/dri2: Allow single crtc exchanges to be queued up
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ab99d67990d5834061a10b0bd1dd220d4611248
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 12:51:08 2014 +0100

    uxa: Allocate frontbuffer to meet old fence constaints
    
    libdrm is a little lax and does not allocate sufficient space for us to
    safely use buffers on old gen. So compute the size we want for
    ourselves.
    
    Reported-by: Cem Aydin <cem.aydin@gmx.ch>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=80088
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10cb36e1ddc6f4bf41941b24d6557343aa595a13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 10:33:07 2014 +0100

    sna/glyphs: Add DBG option to force use of the glyph image mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f0fc2ed4cc19c90dd2f519080915ca0c54e1baf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 10:27:16 2014 +0100

    uxa: Add some explanation to why bo were rejected
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=80088
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b82962e58c0959c94f2df1f0ebd9a478b15cb6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 10:13:09 2014 +0100

    sna: Fix logic inversion for final placement in is_gpu_dst()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62102f505cd13840e4c910adbe762b3fb46dfaec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 09:46:54 2014 +0100

    sna: Promote better active buffer reuse
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2877d018d3510e415f273ce955eb5c272c340e7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 09:24:45 2014 +0100

    sna/glyphs: Show number of glyphs in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38434b29f4a7b324704bbb1e772371be3c0e397b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 16 08:03:21 2014 +0100

    sna: Fix some batch DBG
    
    Helps to check for a successful read when we want to show the batch
    after execution.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 243bd26ad31776b2dc45563107e669cf7b45fd91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 15 21:42:10 2014 +0100

    sna: Clear our private hints about front rendering exported bo
    
    Unlike GLXWindows, GLXPixmaps are rendered directly into, without a
    staging copy. Therefore we must treat those carefully when exported and
    clear our hints everytime control passes back to the Client.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79999
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 500e77d765580e8581c95117b941a4daa940c21e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 15 20:55:30 2014 +0100

    sna: Add more DBG to track transitions between CRTC and its shadow or flip bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a6a94630f4fec26bed2aefb25de1a165193ff10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 15 14:04:50 2014 +0100

    test: Add a simple SHM test skeleton
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 981aafe797f25aca4977a22f271d387b7fb4ae63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 21:41:36 2014 +0100

    sna: Enable TearFree by default for systems with PSR
    
    Panel Self-Refresh requires us to avoid frontbuffer rendering in order
    to be power efficient. This is a job for TearFree!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b27837d5372facde0f9f69eb8df664d2798f0911
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 14 06:51:34 2014 +0100

    sna: Fix assertions for discarding upload caches
    
    The upload caches are special, along with having a bo->proxy, they also
    claim to be completely damaged on both the GPU and CPU. Allow that to
    pass through when discarding the proxy.
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla; https://bugs.freedesktop.org/show_bug.cgi?id=79992
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15485602d8451bcf6c2e979ccbd9cdc11111bcce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 20:30:25 2014 +0100

    sna: Use the right is-clipped hint
    
    The region here has yet to be clipped, and so the only valid is-clipped
    hint is from the flags computed from the PolyRect extents. Make sure we
    use those when determining whether it is valid to discard damage.
    
    Fixes regression from
    commit ad0390068832ad4727371902fe41a85a53de1894 [2.99.903]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Sep 24 10:00:03 2013 +0100
    
    	sna: Separate out copy preferrence from operating in place decision
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Tested-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79992
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b082a07a69ba5490fba47766c4f608b1cdf2427e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 18:56:57 2014 +0100

    sna: Only discard the CPU bo if we have a GPU bo to transfer the damage to
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79992
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05fdfe3b2813495ea122471ed6dde340e538aa65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 21:41:16 2014 +0100

    intel-virtual-output: Compile fixes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a92261b22a8c134a48d1491627ac05136563603
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 19:59:16 2014 +0100

    intel-virtual-output: Disable outputs on remote displays upon shutdown
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79994
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c6fa0cdf0cebcd592281e578da7a7f53cbfe186
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 19:29:41 2014 +0100

    intel-virtual-output: Initialise image after clone
    
    As the image inherits its width/height from the clone, we need to set
    those first on the clone.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79994
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79b4e45ebe3a61f9b5937ad226eead9eebce87ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 19:15:08 2014 +0100

    intel-virtual-output: Only call XShmDetach on a valid SHM segment
    
    Saves a couple of extraneous XErrors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8074b6bcfa8c208433574721135faa4d919d32a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 18:37:15 2014 +0100

    intel-virtual-output: Check for an error creating the DRI3 fd
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79994
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a0b9dc3538ef731463fb321852b8802cd04e457
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 16:14:43 2014 +0100

    sna: Refine decision whether to use the GPU or render inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd87aa8f85c4bafa105fd881a0cce45bda6143df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 15:06:13 2014 +0100

    sna: Track the pageflip bo's busyness
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8322e3e5c6ed19e029f365d869c80388863c424d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 13:50:34 2014 +0100

    intel: Check that the fd points to i915 after authorising
    
    The call to GETPARAM requires either a rendernode or authorisation.
    Therefore we can only assert that the fd is a valid i915 handle after
    authorise() and not before.
    
    Reported-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97003b1a2d6c8beb5c4df4bece5a2d5b03b5ae2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 12:32:12 2014 +0100

    sna/gen6+: Prefer the BLT for large overlapping copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87fc78ac4f6bbfa8e9427d392356ee26942bf955
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 10:52:47 2014 +0100

    sna: Try to reuse the current cursor if we fail to update
    
    As a last resort, continue to display the old cursor if we tried and
    failed to create a new cursor.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd381ad96eadb72eb1a983c973a5dd47f547fc8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 09:31:50 2014 +0100

    xvmc: Refactor mutex locking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bccfb768ee14348b6db5b140fdd6df5fdbfcad0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 09:14:47 2014 +0100

    xvmc: Sanitize compile and library flags
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a0cb1049c2fa0586708719210a2d2cffa7a4491
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 09:15:30 2014 +0100

    configure: Fix DRI2 build
    
    One s/DRI2/have_dri2/ too far.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d47a01fce4d3d9c043a45fc034dc436c0af41981
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 08:51:20 2014 +0100

    sna: Reorder ignore_cpu_damage() to avoid asserts
    
    Tricksy asserts making sure that the correct arguments are passed
    around!
    
    Reported-by: Arkadiusz Miskiewicz <arekm@maven.pl
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4d4bd5d92c7e53a7be6fa7fe119e4507af213ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 08:32:34 2014 +0100

    sna/gen8: Allow reads from scanout to be cached
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e743ccef8f19b1226ceb8d6a5ceab65584a620d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 08:27:05 2014 +0100

    sna/gen8: Check for WT support before attempting to use the WT mocs
    
    It appears the kernel has a better idea when WT is supported on which
    gen8 parts. I assumed it was always supported, but experience suggests
    otherwise, so only use WT support when advertised.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79967
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bc669dd4b7e3e5978e95e4131d1f9215afbc041
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 13 07:48:15 2014 +0100

    configure: Allow manual disabling of each DRI level
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ffe067705b524930d243b18e97508219ed26390c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 12 09:52:50 2014 +0100

    sna: Try to use CPU uploads before BLT uploads
    
    As the BLT upload implies a sync (and a likely GPU boost), only do so if
    we cannot do an immediate upload with the CPU, either directly to
    backing memory or through the GTT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93444ea673be0ac11092a13ab3354f886f4aad63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 12 09:26:14 2014 +0100

    sna: Refactor USE_INPLACE debug macro
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abbf6d6b7962650607dc3517939991de56ce8a91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 21:14:00 2014 +0100

    sna/gen8: Clear a couple more push constants
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f9b015d87300810712a0b6f2680249fb0576f90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 19:10:22 2014 +0100

    sna: Remove bogus assertion
    
    The sna_pixmap is cleared afterwards, it does not need to be clear on
    free.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3a0e40310b6c46b2f887bc0d75b11cc06ec8fa0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 18:07:46 2014 +0100

    sna: Fix direction flags for memmove
    
    Under a compositor, the current deltas may invert the sense of the copy
    direction, causing scrolling corruption. Simplify handling those flags
    by making them invariant for the function.
    
    Reported-by: Bruno Prémont <bonbons@linux-vserver.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79843
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55660376d555131348e7efaaec66d6d27ffc1e6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 17:43:33 2014 +0100

    sna: Use the pixmap header creation routine
    
    A few more places could use the common pixmap creator, just remember to
    handle the SHMPixmap complication!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1beaa980ea6a9617f7dd4dc87b881c37cc7a277b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 16:41:22 2014 +0100

    sna/gen6+: On small GT avoid the intermediate copy for overlaps
    
    If the memory bw is constrained on the GPU avoid doing the 2-pass copy
    for overlaps on the render ring, and do the single pass slower BLT copy
    instead - as since it has to transfer less data it will be faster.
    
    Reported-by: Ildar Nurislamov <absorbb@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31467b01e3f5ece0c8f8d4c03b52fc3f238b3d7e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 16:21:13 2014 +0100

    sna/gen6+: Overlapping bo by definition have compatible depths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0dfe7d93de893b3ead6c3be662b3a17d9335c2ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 16:12:26 2014 +0100

    sna: First copy to overlap temporary must be using GXcopy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad076b394028c40fc6cb88c64b72e46702a936b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 15:49:43 2014 +0100

    sna: Remove debugging hunk
    
    Stray hunk in self-copy boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a90160dcecf0a3df21a04b4f467e660f69ddae54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 15:40:25 2014 +0100

    sna: Update damage pointer after the implicit reduction
    
    sna_damage_contains_box() routine implicitly reduces the damage before
    performing its check. This may alter and even destroy the damage entry,
    so pass in the handle so that it can be updated correctly.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9003c6d9602dba682e577ea7ce39990ea378db3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 15:29:59 2014 +0100

    sna: Fix scanout creation routine for old kernels <= 3.11
    
    With an old kernel, we would fail to actually mark the display as part
    of the scanout domain, but proceed to assign it a fb id. This caused our
    asserts to report our bookkeeping error.
    
    Reported-by: Pavel Ondračka <pavel.ondracka@email.cz>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79909
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5705e66a329273c478f6ecd8f41b8f5633095581
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 14:34:33 2014 +0100

    sna: Add some DBG to the memmove path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b41a51e0f54c983ef72bc31125419382d666d48c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 14:22:26 2014 +0100

    sna: Tweak self-copy boxes to hit the GPU more often
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b879de6246d3f2e66e9c7e326db93e5ff390159f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 14:08:31 2014 +0100

    sna: Recheck source bo after migrating dst (in case of src == dst)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21c150a873a77f983fad29b4517844a0b92e0609
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 14:00:04 2014 +0100

    sna: Skip redundant clears
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1a4438f074f9cd5eba946cc1172c419c31b03c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 13:59:46 2014 +0100

    sna/glyphs: Always print some DBG when performing fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 040eccb9b10d0941c7d81fc9c66c259563370f2a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 13:18:33 2014 +0100

    sna: Add some asserts to track redundant damage operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fccfe3a516ab8383dfd99ccd7fe1840c88bbc01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 08:30:59 2014 +0100

    sna/gen8: Check offset alignment before using a userptr for RENDER
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79053
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1217dbc88e0901e4a657ee51e2e3b7d00bb72b77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 17 21:04:15 2014 +0100

    sna: Support efficient cursor updates for old machines
    
    Given a kernel patch to fix coherency of physical objects, we can use a
    more efficient method for updating cursors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee7d2e0a8ef882c1d4e0e77a0148b54dcfbf4236
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 12:00:35 2014 +0100

    sna: MST topologies may change on any hotplug event
    
    As the kernel does not send out an explicit DISCOVER event, we have to
    reinspect every connector after every hotplug event to detect topology
    changes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 782c920b01d5144125f2fe954e29fd7b07a1913e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 8 08:04:58 2014 +0100

    sna: Create a stable output name based on MST topology
    
    In order to provide persistent names for MST devices, which may change
    topology dynamically, the kernel exports a PATH blob. We can then use
    this path to generate the output name, and so reuse existing XID when a
    monitor is plugged back in.
    
    Based on the patch for -modesetting by Dave Airlie.
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e680e54eab6ffa72e5e1eb6cc0e3fe4b235b06a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 10:48:26 2014 +0100

    sna: Ignore setting read-only for temporary userptr maps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9bf6f3fecb3d691937da086a5270334c6c0e69a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 10:35:50 2014 +0100

    sna: Prefer to operate inplace on the GPU rather than stall on the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 277e6ab84bb0c692358a34a76e7962c64efb0362
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 10:12:01 2014 +0100

    sna: Discard TearFree damage before checking for an overwriting upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb9de37daaea45e917fa7f44444a9782070f7333
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 09:29:50 2014 +0100

    sna: Silence compiler warnings for discarding const Region points
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 085141348cfe8386059062a58172855f72d5e5b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 08:39:42 2014 +0100

    sna: Squelch log messages for fb/pixmap tiling in the default case
    
    The output is confusing, so hide it unless it is modified by the user.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53c1faa5093f8a0c969e3ebe9f27ee1ce5137e14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 11 07:59:41 2014 +0100

    sna: Mark the GPU as all damaged when discarding CPU bo during uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2bfa715a9e115921263d572b9f4c496b550a494
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 21:28:32 2014 +0100

    sna/dri2: Check that the window covers the whole CRTC before xchg
    
    Fixes TearFre regression from
    
    commit 3932e97057fca16615adaefbc1eb25a0d51a1d8b [2.99.912]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 9 08:58:15 2014 +0100
    
        sna/dri2: Allow TearFree flipping to individual CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0f32a9d3afed4ea45644723fa1134957b981125
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 16:37:24 2014 +0100

    sna: Cast away compiler warning
    
    sna_display.c: In function 'has_user_backlight_override':
    sna_display.c:595:3: warning: return discards 'const' qualifier from pointer target type [enabled by default]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 216beed6dfcb3a8d6b0b480d0281fcadb0cd3036
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 09:09:30 2014 +0100

    sna: Expand debugging to cover gen8 BLT variations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f19195f7ea317f5601543724c725c4b63fdc3f60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 14:25:42 2014 +0100

    sna: Fix arguments when flipping transformed TearFree outputs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c16b2a125929c9027b62c07d47e9602553153eef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 13:25:57 2014 +0100

    sna: Tidy a few asserts on the state of crtc->flip_bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd6aaec33d8ad70544cc02e061c9c5e68cf83414
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 11:01:38 2014 +0100

    sna: Handle the user passing "Backlight" ""
    
    Allow the user to disable the backlight control by passing the empty
    string in the xorg.conf.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb7b27a705b477ae1b369786eea13fb14506d54a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 09:36:13 2014 +0100

    2.99.912 snapshot

commit 52e2aa0939eee3566e4d6ee3a34f8acd93570530
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 10 08:49:41 2014 +0100

    sna: Queue a flip after fixing up a failed flip
    
    After a flip fails, we try to update the CRTC manually to new fb.
    However, the caller is still expecting to receive an event though the
    drm device to notify when the flips are complete. In order to maintain
    that ABI, we need to queue another flip after the fixup (to the
    currently bound fb).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68ac3039e4170b318952213311534cd213cbaff7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 22:01:05 2014 +0100

    sna: Fix the typo in the last commit
    
    Rewording the sentence and reordering the arguments was a mistake!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fdb8f490441b0ba91fdf530b982cedc2f2acf122
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 21:46:37 2014 +0100

    sna: Add an extra error message before disabling a CRTC
    
    One of the error paths to disable a pipe was lacking a log message.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1154ae1070806b8da1aad29f75c9659f2a403df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 17:04:47 2014 +0100

    configure: Allow disabling control over the backlight
    
    Some OS prefer to control the backlight themselves through another
    daemon and so do not want X interfering.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb2d5e3696b52835770a62a951f7ed7e51291f88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 16:30:15 2014 +0100

    sna: Defer the copy back from the shadow CRTC bo until we allocate the target
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b00a60b41736c399f849217626f246e6e7d1f7eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 15:03:23 2014 +0100

    sna: Fix cut'n'paste DBG error
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8901a99afb7be4f6f377a8e84e62e5d768c8443d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 14:56:02 2014 +0100

    sna/dri2: Avoid trying to flip between bo with different pitches
    
    It could happen that we create front/back buffers with different
    pitches. The kernel refuses to flip between such buffers, and so we will
    hit some fallback paths that try to fix up the failed flips. Circumvent
    such by avoiding the flip.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16574754a99c4472c1c90c426d9c1665a898f1d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 14:54:26 2014 +0100

    sna: Fixup normal flips between different pitches
    
    Apply the manual CRTC fixup in case pageflipping fails. This can happen
    if the pitches between the front and back differ for example.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3932e97057fca16615adaefbc1eb25a0d51a1d8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 08:58:15 2014 +0100

    sna/dri2: Allow TearFree flipping to individual CRTC
    
    Baby step. We first take advantage of TearFree to allow us to redirect a
    single CRTC to the DRI2 frontbuffer and so allow a fullscreen game
    covering a single monitor to avoid expensive blits when running in a
    multi-monitor setup.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af3130cbba8375b9060a3a8cef5b03189d01c419
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 9 13:13:25 2014 +0100

    sna: Do not rely on udev_monitor_receive_device() being non-blocking
    
    The libudev documentation says that is it non-blocking by default, but
    experience shows otherwise.
    
    Reported-by: Sedat Dilek <sedat.dilek@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 981af18190be772b469761bc124b9f46c19d5093
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 16:55:07 2014 +0100

    uxa: Do not FreePixmap(screen->devPrivate)
    
    Prevent the crash caused by
    
    commit 444a1f7a8802999e27ecf5f6eb598df2206f7277
    Author: Brendan King <brendan.king@imgtec.com>
    Date:   Thu Apr 24 11:37:45 2014 +0100
    
        fb: fix screen pixmap leak on server reset
    
        Call FreePixmap() instead of free() to destroy the screen pixmap in
        fbCloseScreen().
    
        Signed-off-by: Frank Binns <frank.binns@imgtec.com>
        Reviewed-by: Keith Packard <keithp@keithp.com>
        Signed-off-by: Keith Packard <keithp@keithp.com>
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86f2cae45048158154eb2b1dbb181c3e1d6a8bf7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 15:18:34 2014 +0100

    sna/dri2: DBG compile fix
    
    Typo in DBG message.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6153141fa6e1328a007efe6862ff2d7b4adaaf83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 14:48:20 2014 +0100

    sna/dri2: Allow xchg to replace the frontbuffer when all outputs are off
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9306a148cbf1a2471540f3301136d57e93197593
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 09:40:19 2014 +0100

    sna/dri2: Use xchg for offscreen drawables where applicable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22cd7c873edd0b641e54e81d643ec6b0ea921f88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 08:46:27 2014 +0100

    sna/dri2: Explicitly drain the pending event queue before swapping
    
    As there may be some latency between the wakeup and the queue, do a
    final check if there is a pending vblank event before we decide whether
    to chain up or perform an immediate flip.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 258e0cda1d69f74736d0e0be014996173e275543
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 08:21:38 2014 +0100

    sna/dri2: Mark frames under construction
    
    As we may recurse into the vblank handler whilst waiting for the
    TearFree shadow, we need to be careful that we do not queue the frame
    from the vblank handler that we are in the process of constructing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb8f3a9b345c75023b49512c2db57527d906db7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 8 07:45:52 2014 +0100

    sna/dri2: Check the xchg against the Pixmap size
    
    As the Window may be resized between the client sending the swap request
    and the xchg being processed, we need to validate the swap against the
    final target not the buffers supplied originally by the client.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc64ba821749ed0a0197a69d9bae81957aceb55f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 7 23:27:49 2014 +0100

    sna: Restore backlight when switching to VT
    
    fbcon doesn't adjust the backlight when it takes over. Therefore if X
    performs a VT switch whilst its outputs are off, fbcon wakes up with no
    backlight and users are unhappy. Make the assumption that whoever takes
    over the VT will set the outputs as it desires, and that the failsafe
    value is to then turn the backlight to full.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67025
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ecd80a3a997b11307445c50621d4e86e241a5b22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 7 14:57:10 2014 +0100

    sna: Fix reporting of TearFree
    
    The switch was moved after we checked whether pageflips are supported,
    but the log message was left in the old location.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 035be60f332e4729fb90261605ef6c06a9d9c903
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 7 13:26:12 2014 +0100

    sna: Release CRTC on VT switch
    
    In order to free up memory and improve our bookkeeping when the X server
    is switched away from the current VT, disable the CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 717e00facd27696c6b8a1a6c343b2f94bfa2b59b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 7 09:07:16 2014 +0100

    sna: Allow TearFree to be enabled by default via configure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcb64b55092ea3da6adf357305d65b58d848db7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 7 08:30:38 2014 +0100

    sna: Fix TearFree for non-compositors
    
    The tearfree code forgot to update the shadow bo, so after the first
    flip it would be rendering to the scanout anyway and flip to itself
    periodically.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c65fab07402a338f015c2b339e996beca783c2bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 22:07:44 2014 +0100

    sna: Fix no relaxed delta path for gen4+
    
    This is for debug purposes only.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a378196fddcf3043257a7e56225060e5e36cfa7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 16:58:45 2014 +0100

    sna: Auto-retire upload proxies
    
    This was disabled in
    
    commit 9f4f855ba37966fb91d31e9081d03cf72affb154
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon May 26 07:06:18 2014 +0100
    
        sna: Implicit release of upload buffers considered bad
    
    as retiring the buffers during the command setup could free one of the
    earlier bo used in the command. But discarding the snooped bo could
    still be advantageous. So restore the automatic discard of upload
    proxies, but make sure we only do between operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Matti Hämäläinen <ccr@tnsp.org>

commit 23840bd329cf4da3a4bdd5a1a466125a95473534
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 16:10:29 2014 +0100

    sna: Only allow the inplace copy to replace a complete overwritten GPU bo
    
    And double check after recreating the new GPU bo that is still mappable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 283ff8cbe4137f46cc027dd6aadc69d0270cb33d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 15:04:25 2014 +0100

    sna: Rearrange scanout_flush checking to avoid potential crash
    
    With a shadow, we may never attach a GPU bo to the frontbuffer, so be
    careful when checking the scanout not to dereference that NULL pointer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 694ff54aca16ccf39e94d505942eb857b3101d7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 13:34:18 2014 +0100

    sna: Report KMS driver version
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ebcef4f2ebe82e9b90589aa4266a9228e2b5fdb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 11:39:57 2014 +0100

    man: Update notes about TearFree
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f943a7d92d0e3a8895ba7d539cfc5e726bcc8b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 6 11:25:47 2014 +0100

    sna/dri2: Restore flush on front buffers after swapping bo
    
    Fallout from commit 8369166349c92a20d9a2e7d0256e63f66fe2682b
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 4 08:29:51 2014 +0100
    
        sna/dri2: Enable immediate buffer exchanges
    
    We set the flush hint too early, as we may need to swap the GPU bo for a
    more appropriate buffer for DRI.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6cd10f536e099277cdc46643725a5a50ea8b525
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 22:43:37 2014 +0100

    sna: Hook up a backlight udev monitor for external changes
    
    Changes to the backlights are notified through uevents. Hooking up a
    udev monitor to listen out for external changes to the backlight (e.g.
    through ACPI function keys, or by the user writing to
    /sys/class/backlight directly) is easier than enabling polling on the
    backlight sysfs file using X's select() mechanism.
    
    Since we listen to backlight changes, we have to be careful not to
    confuse the side-effects of disabling connectors (which may cause either
    ourselves or the kernel to turn off the backlight) with the user value.
    
    Many thanks to Alexander Mezin for the suggestion to use udev for
    tracking the notifications for external changes to the backlight.
    
    Reported-by: Alexander Mezin <mezin.alexander@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79699
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b545e10c50cbb2dd6f9fd53369667bed0d8f1b51
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 15:54:32 2014 +0100

    sna: When the output is off, report the cached backlight value
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0b8720807d9c1994e6db91a607efe4711b0d1ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 15:31:54 2014 +0100

    sna: Inline calls to save/restore backlight around output DPMS
    
    The intertwined logic was a little confusing to read mixed between the
    functions, so inline it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f7775158341c8384da870e06cab200deddf48c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 15:31:27 2014 +0100

    sna: Set initial output DPMS state from kernel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e02fe269dc79ff867d1d2cb3a8673ee2861bd56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 15:49:03 2014 +0100

    sna: Make sure we recompute the vblank interval after reconfiguring the CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51909f37ed6405c38f1c46a4012952be79031994
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 14:54:55 2014 +0100

    sna: Skip marking the CRTC as damaged for TearFree
    
    As we have reorder the application of damage on a TearFree frontbuffer
    to before we attach the CRTC, we do not need to then schedule the update
    afterwards (until it gets drawn by the client).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7efe88a895a692e5f840562a09dac385508db57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 14:50:04 2014 +0100

    sna: Fix DBG compilation
    
    Update the DBG to reflect the new arguments to sna_damage_reduce_all()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9566fc0ccc71bc4fcd6bf83b567a41cc5366f5ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 12:26:23 2014 +0100

    sna: Curry parameters to sna_damage_all()
    
    It is far easily to pass the PixmapPtr into the function and have it
    pluck out the width and height than do so in all callers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1327918f91dce2051b809594db5a3ed555934612
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 5 12:04:29 2014 +0100

    sna: Mark CPU as all damaged when discarding a busy GPU bo
    
    When we discard a GPU bo, we need to make sure that the remaining
    content is marked as only accessible via the CPU shadow pointer.
    
    Regression from commit 65301412ecf2d55ab55a2d7faeaa048d4ee8b1d0
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat May 17 20:59:38 2014 +0100
    
        sna: Discard active GPU buffers before uploading into them
    
    Reported-by: Jan Alexander Steffens <jan.steffens@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79517
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8369166349c92a20d9a2e7d0256e63f66fe2682b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 4 08:29:51 2014 +0100

    sna/dri2: Enable immediate buffer exchanges
    
    The primary benefit of this is avoid the extra blit when using a
    compositor and instead propagate the compositor flip on the frontbuffer
    to the scanout, or equivalently allows a fullscreen game to flip onto
    the scanout without intervention by TearFree.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08148896196443a8582c30b47ff546acca78d69c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 3 15:48:55 2014 +0100

    configure: XORG_DRIVER_CHECK_EXT does not create CFLAGS/LIBS variables
    
    XORG_DRIVER_CHECK_EXT only adds the package name to the list of
    REQUIRED_MODULES (which is later passed to pkg-config). For our optional
    dependencies, we must do a later call to pkg-config to verify the
    package is available and then remember to include the includes with the
    CFLAGS.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c81041e9b42f9df0c86c88c8648dd20ed26d0ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 3 15:39:50 2014 +0100

    configure: Remove xf86driproto from REQUIRED_MODULES
    
    We only depend upon the original DRI1 infrastructure when building i810
    with DRI support. So unless that is true, do not throw an error if the
    legacy protocol is absent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 689ee76a14da7e5f98997ac427f457af840dea3f
Author: Adam Jackson <ajax@redhat.com>
Date:   Tue Jun 3 10:26:46 2014 -0400

    configure: Don't link the driver against libX11
    
    78dc0c04745ad4485b994f67833f4a155749f01d added REQUIRED_MODULES to the
    driver link line for... some reason.  That pulled in the libs from the
    XF86DRI check, which near as I can tell has always been wrong, all of
    the other extension checks just look for the protocol module and
    xextproto doesn't define dri1 protocol in any case.
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>

commit 8297c969ae749ef58d259b2ded2231b928efba43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 3 09:47:27 2014 +0100

    sna: Replace the bo for tiled uploads if not suitable and being replaced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c55d0447dba5bbde5be3903b273e04e3c9d084f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 3 12:43:51 2014 +0100

    sna: Allow replacements to cancel operations between both bo under a Pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a82bfb033448eb61bf8cc7f5358be019f0cc28e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 3 09:28:24 2014 +0100

    sna: Discard unwanted damage when promoting to a full CPU migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4cafd1fbb1a2441a9ba5dac7f2a0e1b3f5957c62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 16:01:10 2014 +0100

    sna: Fix early return in download using the GPU
    
    In commit 961139f5878572ebea268a0bbf47caf05af9093f
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 30 09:45:15 2014 +0100
    
        sna: Use manual detiling for downloads
    
    the code for deciding when to use the GPU was refactored into a new
    function that also performed the transfer, but failed to notice the
    early return.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6a412812c19fe4698752d2589ead4965048b107
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 10:32:11 2014 +0100

    sna: Use CPU mmappings for linear uploads
    
    The other half of the commit that accidentally got included with
    
    commit bb49222a514b1d6041f3d9530a22f5701377118b
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Jun 2 08:25:52 2014 +0100
    
        sna: Add DBG hints for using inplace CPU mmappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 454367f5945dd17a7cfc566b1986654fc976cabe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 09:25:01 2014 +0100

    Only enable the new Cursor API for the next pre-release of Xorg
    
    Make sure we can compile against the pre-release tarballs at the expense
    of an innocuous compile warning if compiled against xserver.git
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff36e1f7546e0ac4d6e831e5cf8d1317792ed7af
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Nov 19 15:20:44 2013 -0800

    uxa: Add Present extension support
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    
    Conflicts:
    	configure.ac
    	src/uxa/intel.h
    	src/uxa/intel_driver.c

commit 14ff08c2827d36f7f08256dc57b84aaf80d17ab4
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Nov 19 23:20:38 2013 -0800

    uxa: Restructure DRM event handling.
    
    This refactors the drm interrupt handling logic quite a bit, both to
    allow for either DRI2 or Present handlers, but also to eliminate
    passing pointers through the kernel. Passing pointers left the kernel
    holding the only reference to some internal X server data structures.
    
    After a server reset, the X server would end up using stale pointers
    stored in those structures. Using simple integers makes it possible to
    empty the queue of pending interrupt data and then ignore the stale
    kernel data.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 7f28b1cfa20eb4fc11c1a9c1e0c0fac7847be72e
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Nov 19 22:58:33 2013 -0800

    uxa: Support 64-bit MSC values. Handle kernel vageries about MSC reporting
    
    The kernel sometimes reports bogus MSC values, especially when
    suspending and resuming the machine. Deal with this by tracking an
    offset to ensure that the MSC seen by applications increases
    monotonically, and at a reasonable pace.
    
    Also, provide a full 64 bits of MSC value by noticing wrapping and
    tracking the high 32-bits of MSC separately.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    
    Conflicts:
    	src/uxa/intel_dri.c

commit dd6db82680b05cde4a47116b7096c054f3837e20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 9 20:26:19 2014 +0100

    uxa: Add DRI3 and miSyncShm support
    
    Based on a patch by Keith Packard.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 975b9798be77b30cbed485583d0ccb48318708f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 08:58:24 2014 +0100

    sna: Add support for Present
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8eb87f84f88ad2df42c6fed1d93df76589a14e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 8 16:25:32 2014 +0100

    sna: Add support for DRI3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fbe8995d51b4643f1cf06c07da8b4b5ac5ae7c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 11:17:35 2014 +0100

    sna: Relax tiling height restrictions
    
    Only force the even-tile-row alignment if we have an old GPU with an old
    kernel that doesn't perform conservative alignment for us (as required).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67b37332bd45dd4cea297107bfdc9df21984fdcd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 20 15:37:13 2014 +0100

    intel-virtual-output: Add DRI3 xfer path
    
    Just as proof-of-principle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9cf6cd9726ed5ba73bb8c38c06f7b5c78706309b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 12:52:18 2014 +0100

    Add rudimentary tests for Present
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ab6734369fbd902a23109f4c3626df9d529891c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 9 11:08:15 2014 +0100

    Add rudimentary tests for DRI3
    
    This is a simple little test to create a pixmap from a local bo, copy it
    to a normal pixmap, then read it back by importing it into anther local
    bo. It tests the fundamental mechanisms of opening a DRI3 render device,
    importing into pixmaps, exporting into /buffers and a read-barrier.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6240d197be1e752c0de26fbf84fc8fa8d55383c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 07:55:03 2014 +0100

    intel: Clear structs for valgrind
    
    When probing the module, clear structs passed into unknown ioctls to
    keep valgrind quiet.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d27c948a4382c4024ce5e76f1ea82103fc8e9d66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 9 13:58:37 2014 +0100

    intel: Add common routines and configure probing for DRI3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a02886a24c8699374a39a9363e72bec0e7bbe30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 21:09:34 2014 +0100

    sna/dri2: Use real async flips
    
    Presuming that we have both kernel support and Xorg support, of course.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c17d704a5baa0c902994f035d3da39d77d31fef3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 21:21:00 2014 +0100

    sna: Enable kernel support for asynchronous flips
    
    If a flip fails, attempt to restore the previous working configuration
    (using a modeset) then disable further flipping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c95a4002d1d27937731c59e84254ccb3b1246ccd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 1 08:44:13 2014 +0100

    sna/dri2: Hide MSC reported as going backwards
    
    OML_sync_control mandates that MSC must be monotonic, so if the kernel
    reports that they go backwards, lie.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1c07c20a371795a8dc4102f83fe542d62d8a4e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 31 21:58:13 2014 +0100

    sna/dri2: Always force the async blits to be immediate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b5f91e14226799ef4ec6461de93fa9193ef2ebc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 31 21:41:45 2014 +0100

    sna/dri2: Decouple spent flip
    
    If the flip is already completed before we finish the previous flip, the
    drawable has been replaced already and we can unchain the flip queue.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ee1940a4ffc1901534fa3bf15adb427527a8c20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 31 13:21:04 2014 +0100

    sna/dri2: Mark queued flip MSC as the one after next
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2df4466adae7f299eac3f7fd3e5f33ee4b22e53f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 13:27:32 2014 +0100

    sna/gen8: Clear all URB push constant allocations
    
    A little paranoia to clear the unused portion of the URB and dedicate it
    to VS entries.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1618d6cfa63e31ebaedadf575dcbdf5b07451bde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 12:14:40 2014 +0100

    sna/gen8: Set GT level
    
    We use the GT level to decide how favourable it is to use the GPU in
    various circumstances, now set it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb49222a514b1d6041f3d9530a22f5701377118b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 08:25:52 2014 +0100

    sna: Add DBG hints for using inplace CPU mmappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 487df2e7b105b996c4d620ec2af6331ebc167f47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 2 08:30:57 2014 +0100

    sna: Silence a DBG compiler warning
    
    kgem.c: In function '_kgem_submit':
    kgem.c:3243:12: warning: ignoring return value of 'write', declared with attribute warn_unused_result [-Wunused-result]
           write(fd, kgem->batch, batch_end*sizeof(uint32_t));
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ffbe0aa1851c35cc2403633ca493e9fc6a471fd4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 18:41:39 2014 +0100

    sna: Reuse the first scanout bo
    
    The path of last resort is meant to reuse the first scanout bo if they
    all busy (since it will be the oldest). It chased a dangling pointer
    instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40fe1f2c09a98ac75b05db3663d29ee1a64ed280
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 18:30:47 2014 +0100

    sna: Do not allow imported buffers to be cached
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc1f9b91ae2c761e4b126daecab13e13ae2534d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 18:11:16 2014 +0100

    sna: Mark all caches for expiration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dac734bb0fb0ae1febfef9a9289cf830a87be1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 10:31:37 2014 +0100

    test: Only compute the masked pixel value if depth!=32
    
    Minor saving for when we use a8r8g8b8.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 961139f5878572ebea268a0bbf47caf05af9093f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 09:45:15 2014 +0100

    sna: Use manual detiling for downloads
    
    If we can CPU mmap the GPU bo, prefer to do so for migration to the CPU
    as this saves an extra serialisation step.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93d3df493d359f76ea710441d891a0333e755fb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 30 22:49:05 2014 +0100

    sna: Unexport kgem_get_unique_id()
    
    This should always be set during bo creation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 792584fa740dbc81b72fd4f4bdf27d65b9c046cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 28 14:00:26 2014 +0100

    sna/dri2: Reorder declarations to compile on old Xorg
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 562c47fc21b9029ebff29b53d2be590df4329264
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 28 12:51:18 2014 +0100

    Silence CLang (almost)
    
    Fix up all the warnings about implicit enum conversions. The
    container_of() macro remains defunct.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6282fc9d0d3b2899be52ca4a43a3d9313e9049a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 28 10:42:58 2014 +0100

    sna/dri2: Fix the continuation mode for old style triple buffering
    
    Otherwise we end up sending too many SwapCompletes back to the client
    and confusing ourselves.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 916354164bcb149e1323a3219d85e7bba6e61e04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 27 20:16:55 2014 +0100

    sna: Fix the depth/format on the temporary shadow Pictures
    
    When scaling the output, we re-render onto the scanout using a call to
    Composite, for which we create temporary Pictures. In most cases, the
    mismatching depth/format goes unnoticed, but along one particular
    fallback path, we use those to create a new Picture but the mismatching
    format results in a segfault.
    
    Reported-by: Matti Hämäläinen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79320
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8360bd74f5b62a27c019c65ed9001cac8bf43ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 27 20:14:02 2014 +0100

    sna: Handle bad picture format/depth mismatches
    
    Scaling the output feed in an invalid picture->format/depth combination
    which causes the fallback downsampling function to explode. Whilst this
    is a bug in the higher layer, we can handle the error anyway.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79320
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93b319cf9a355e8400b864046cdb4cfb56b657a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 13:16:50 2014 +0100

    uxa: Silence the compiler over a couple of unused variables
    
    intel_driver.c: In function 'I830LeaveVT':
    intel_driver.c:1085:24: warning: unused variable 'intel' [-Wunused-variable]
      intel_screen_private *intel = intel_get_screen_private(scrn);
                            ^
    intel_driver.c: In function 'I830EnterVT':
    intel_driver.c:1102:24: warning: unused variable 'intel' [-Wunused-variable]
      intel_screen_private *intel = intel_get_screen_private(scrn);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6ee0679374f8fc80cb34693f80affe6ea676ddb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 14:29:42 2014 +0100

    uxa: Silence compiler for warnings in Cursor API changes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4321e8decd7be9daaa49c6ab4e8bb9bd66faae31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 14:29:42 2014 +0100

    sna: Silence compiler for warnings in Cursor API changes
    
    The API changed again in the RC, so update to keep the compiler quiet.
    At the same time, protect against the ARGB_CURSOR struct changes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a0dc7ed4961d5bda08bb583a7a6a2cc633b27e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 26 08:23:45 2014 +0100

    sna/dri2: Move scanout processing from frame event to global
    
    The scanout is a global property, track it as so. The primary benefit to
    this is it strengthens our assertions that we never hand out an active
    scanout for use as a back buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05f149285b429c7b3f25ac8049477230aaef512c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 25 07:14:53 2014 +0100

    sna/dri2: Defer reallocation of backbuffer until request
    
    If we defer the reallocation of the backbuffer until the client requests
    the set of current buffers (with GetBuffers), then we can often avoid
    allocating the fresh backbuffer as the flip often retires before the
    client is ready.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8d8f754ebf77f17a4666c8f649907bee50313bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 15:52:20 2014 +0100

    sna/dri2: Make the swap-limit transitions more obvious
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f4f855ba37966fb91d31e9081d03cf72affb154
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 26 07:06:18 2014 +0100

    sna: Implicit release of upload buffers considered bad
    
    Currently upload buffers are automatically decoupled when the buffer is
    retired. As retiring can happen during command setup after we have
    selected which bo to render with, this can free the bo we plan to use.
    Which is bad.
    
    Instead of making the release of upload buffers automatic, we manually
    check whether the buffer is idle before use as a source to consider
    scrapping it and replacing it with a real GPU bo. This is likely to keep
    upload buffers alive for longer (limiting reuse between Pixmaps but
    making reuse of the buffer within a Pixmap more likely) which is both
    good and bad. (Good - may improve the content cache, bad - may increase
    the amount of memory used by upload buffers for arbitrary long periods.)
    
    Reported-by: Matti Hämäläinen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79238
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b508d8f3318c42a2a87b7731789b1d03610e9b46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 26 06:54:03 2014 +0100

    sna: Assert that we do not replace active IO buffers
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=79238
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 605fcd9050efc816ac8163e8d626f466d98261c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 13:34:38 2014 +0100

    sna/dri2: Handle allocation failure adding frame events gracefully
    
    Now that we do not preallocate the storage for the chain in the Window
    devPrivates, we need to check for an allocation failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36a4a654da87b22f7ce31d1ca99389cedb57eee8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 12:48:10 2014 +0100

    sna/dri2: Tidy add/remove chain to use the common DRI2 private
    
    The code is more readable directly updating the private rather than
    hiding the pointer chasing through the opaque lookups.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 417997f3892b3a5fe43f5951dbde1476092ec82c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 12:40:10 2014 +0100

    sna/dri2: Handle offscreen Window and Pixmap with CRTC tracking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3781e19cfc3edf61b69617cd60da1e421de8ffc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 11:16:56 2014 +0100

    test/dri2: Restore original configuration after testing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d6106c2893f2783611715960a0f5099ef54b4a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 10:11:10 2014 +0100

    sna/dri2: Combine the DRI2 Window privates together into a single struct
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6c4e72f1a8008818fc0e5c19c9dc147f1794777
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 10:03:39 2014 +0100

    sna/dri2: Free the private CRTC tracker on each window
    
    Remember to clean up our privates when the window is destroyed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43fd06ee7d95db4114ce7b0261685380a48a8708
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 09:03:17 2014 +0100

    sna/dri2: Adjust current msc / target seq between CRTCs
    
    The target_msc supplied by the client is required to be monotonic. Since
    the client does not know which CRTC the window is on, they do not
    control from which pipe we derive the MSC, and so we need to adjust the
    hardware values such that the client only ever sees a monotonic value.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8decdbccdefa87b635d871a8295608961f0d22e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 23 09:13:31 2014 +0100

    test/dri2: Check validity of MSC across CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6613a8fe3908433ee33a167f57a0fae4e785a22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 23:48:20 2014 +0100

    sna/dri2: Queue the flip immediately for the next frame
    
    If we compute that we want to flip on the next frame, queue it
    immediately rather than take a round trip through the kernel and risk
    missing the vblank.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24443c6c897278a8a196bf4a8df9fab4485f38b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 22:47:35 2014 +0100

    sna/dri2: Tidy computation of target sequence
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a767ad2e50a503e2b979c976a502ff358064b820
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 21:18:10 2014 +0100

    sna/dri2: Use the timestamps stored on the CRTC
    
    Now that we store the information for the swap completion on the CRTC,
    we don't need to pass it around inside the frame event.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d80af306677b6d0c52487707bbbcf8de065803b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 13:04:31 2014 +0100

    sna/dri2: Tweak flip continuation
    
    Minor tidying to the returned target_msc and a useful assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d1e9afb60a61bf490a282a16db1c15a9ad7d077
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 12:34:05 2014 +0100

    intel-virtual-output: Probe after claiming virtual output
    
    Rerun a detection cycle after claiming the virtual output so that it is
    hidden again.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=78293
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f0cd87c66a4e373ab9b26626514d43b5f4978e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 10:04:09 2014 +0100

    sna/dri2: DBG fixes
    
    Update the DBG statements to match current code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80dfbaa3c39e1c56aaa9f8951e3bbcc30a9b748d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 22 00:24:07 2014 +0100

    sna/dri2: Move fixed array allocations to per-crtc
    
    Replace the fixed size MAX_PIPES array by moving the vblank handling to
    per-crtc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b21237a1caa369133e6ba972e2ec39feac21bcc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 23:40:36 2014 +0100

    sna/dri2: Maintain sequence calculation in 64bits
    
    Avoid casting down to 32bits at the begining of the calculation to only
    then compare against the full 64bit values later.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c548f231c1d59f578dfb113c549b5b6e015e7c5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 23:35:19 2014 +0100

    sna/dri2: Fix WaitMSC to maintain the vblank counters
    
    Fix WaitMSC to also use 64 bit counters and maintain the last vblank
    notifications.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f237bb6db9724358eca0467362c03dc6a41dc4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 23:02:52 2014 +0100

    sna/dri2: Apply a margin of error to the sequence wrap detection
    
    If we have a queue of events, we may set the msc from a recent vblank
    query only to then process an older vblank event and declare the counter
    wrapped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00d9396f6bf0bbbdfca7cdb1cbdbde8f0b2ad59c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 20:00:56 2014 +0100

    sna: Fix attachment of the default monitor to the first output
    
    Broke during code motion in
    
    commit add84cd8a8dc6d285912d0ea3a3a3e7faa9e0942
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 2 13:21:02 2014 +0100
    
        sna: Perform dynamic connector discovery
    
    Reported-and-tested-by: Jay Little <jaylittle@jaylittle.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=79015
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5168a160a1385c23d275d616f2649d5cae7c15d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 19:16:32 2014 +0100

    sna/dri2: Decouple queued events
    
    Becareful when reaping a chain on a destroyed window as some events may
    be queued ahead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66e14c96d0ddede90e36084a80a97c3f16c2b386
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 18:38:36 2014 +0100

    sna/dri2: Limit pending swaps to 1 when queueing a future blit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf4475d29de589a0d0e71dfb895d19a635f8cc3e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 11:31:29 2014 +0100

    sna/dri2: Tidy conditional use of XORG_CAN_TRIPLE_BUFFER
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b3ea29727075bf2b0d86bbeca7dd78201936913
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 08:26:21 2014 +0100

    sna/dri2: Tidy recording of the last swap sequence number and time
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 183a0728ba52be9d052f5a5f6e6b54c4a9ee8253
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 21 12:41:58 2014 +1000

    uxa: fix getmsc to not fail hard
    
    If some outputs go away we race with this call and apps
    get X errors and fall over. Do what SNA does and don't
    bother trying.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 2dbe76c4925e02b8ec20b986069e2ff38cea5bba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 21 07:38:35 2014 +0100

    sna/dri2: Tidy computation of 64bit ust
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a82f6a7594ee13170aba5bac7fb57cd5550b27ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 20 12:20:38 2014 +0100

    sna/dri2: Client cannot be NULL, so drop the checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c548427e6d3a3fb50acec4b405b9d0ea977d3cc9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 20 16:36:31 2014 +0100

    sna: Only mark the scanout as being busy for writes (not solitary reads)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61df0ffc0be8d934d86ac45c67da910479998cc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 20 12:07:50 2014 +0100

    sna/dri2: Verify that the reference pipe is still active for flipping
    
    We rely on the reference pipe to drive the event wake up. If we issue a
    deferred flip, there is a chance that the user could rearrange the
    screen on another crtc whilst otherwise preserving the screen geometry.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 197ab0cda06c44aa1a2b17bf69ac08612811b107
Author: Dave Airlie <airlied@gmail.com>
Date:   Tue May 20 07:45:14 2014 +0100

    uxa: fix pageflips on 3 head scenarios
    
    While fixing up UXA for MST I eventually fell over this bug.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    [ickle: replace constant with macro to track pipe-dependent code]

commit bfd0e41d5c7b8bff28ff429b26f4c977e4c37d12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 19 12:31:49 2014 +0100

    sna: Fix assertions for combining shadow transforms and TearFree
    
    When the RandR shadow buffer is enabled we set the sna_crtc->transform
    flag. We set the crtc->transform_in_use only when coordinate transforms
    are required - i.e. we may enable the shadow buffer if a CRTC is out of
    bounds, but otherwise has no transformation. That confused the asserts.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a84875c21b7113f55e6ce0c4a1f914524aa3f97
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 16 15:05:31 2014 +0100

    sna: Switch iterators over to real CRTCs only
    
    Many loops only want to walk the real CRTCs, so update the loop bounds
    to be explicit and assert that they are the real ones.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65301412ecf2d55ab55a2d7faeaa048d4ee8b1d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 17 20:59:38 2014 +0100

    sna: Discard active GPU buffers before uploading into them
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5e43058465d33025d99d83927d1ce6a8e103ff9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 16 22:45:45 2014 +0100

    sna: Do not mark an upload as a potential replace if the dst is pinned
    
    This saves us from trying to optimise for an operation that cannot
    happen as we cannot replace the destination buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df297e9fafe1a7de1036f3151f93de67661c2a4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 16 18:20:06 2014 +0100

    sna: Userptr lands upstream, enable.
    
    No longer an optional feature of an experimental kernel!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89e8f2b35bbbcaac23dd1d3fc42e83d8214a9130
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 16 10:14:57 2014 +0100

    sna/dri2: Update the swap type for chained flips
    
    We stash the pending flip mode into the closure, but failed to copy that
    over to the right field when continuing with a chain of flips. The
    impact was that we would fail to issue the required SwapComplete to
    unblock the clients.
    
    Fixes regression from
    commit 96ce362ba40bf9560fb1aa27a6ae5fdd2a8bd428
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue May 13 09:46:45 2014 +0100
    
        sna/dri2: Do not rate-limit vblank=0 swaps
    
    Reported-by: francisbrwn
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e73d51247be5018fe53346f991e2f178c917cb13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 15 23:00:53 2014 +0100

    sna/video: Only migrate the destination window
    
    By using move-area-to-gpu and specifying that we overwrite the target
    area, we can optimize away any needless damage migration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10c18b1a4631ebab5508f4308c73129f2111e964
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 15 21:50:41 2014 +0100

    intel-virtual-output: Mark the source SHMPixmap as writeable
    
    This is fortunately a no-op, as it gets initialized to zero already
    (that is the pixmap is writeable). However, we may as well do the right
    thing...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b21fc65b23fcbb2b9a04eb92e3719d88e2d026dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 15 11:23:16 2014 +0100

    intel: Update PCI IDs for Cherryview
    
    Copied from kernel commit 7d87a7f709650bde4d7d63117f25ee1c095da5dd
    Author: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Date:   Wed Apr 9 18:19:04 2014 +0300
    
        srm/i915/chv: Add Cherryview PCI IDs
    
    and also includes non-functional changes from
    
    commit fd3c269f8ff940cc0fbb3b7f7e84c0572f6f759a
    Author: Zhao Yakui <yakui.zhao@intel.com>
    Date:   Thu Apr 17 10:37:35 2014 +0800
    
        drm/i915: Split the BDW device definition to prepare for dual BSD rings on BDW GT3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2afeef0c3ffeae768198fc08c9f365ccd28b7f5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 15 11:28:48 2014 +0100

    sna: Mark the CHV vsync method as unknown
    
    Similar to the story with Baytrail, vsync is a lost art.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d33e77d58a6f6f23e87943530197f8dc2b076981
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 16 09:59:25 2014 +0100

    sna: Handle driver failures more gracefully
    
    Avoid busy-spinning waiting for the cache to expire after a failure. Try
    to free up any overdue expiration, then if we still fail, we free the
    entire cache. Currently, it would spin over the expiration until all
    items were overdue and then freed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0625185f4772f1c7f8e8d7f265432fd77cdd27fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 12:40:18 2014 +0100

    intel-virtual-output: Make it possible to disable building via configure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c179003b10845b43a7a8958a99b1bf1c6617252c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 16:15:24 2014 +0100

    sna/dri2: Ensure new immediate blits are queued behind outstanding swaps
    
    OML_sync_control:
        If there are multiple outstanding swaps for the same window, at most
        one such swap can be satisfied per increment of MSC.  The order of
        satisfying outstanding swaps of a window must be the order they were
        issued.
    
    The only challenge is to keep both this behaviour and vblank_mode=0
    benchmarking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84d0790453089be5d1034037065df1ea37ad48fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 11:37:51 2014 +0100

    sna: After disabling the TearFree shadow, flush any pending flips
    
    If we complete a flip after resizing and recreating the TearFree shadow,
    we may process the flip completion events whilst the output is only
    partially reconfigured.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68181f0b530934d74f48cb36022c17b29a76cb75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 07:46:43 2014 +0100

    sna/dri2: Carefully check for a completed swap
    
    We have to open-code kgem_bo_is_busy() in order to avoid prematurely
    retiring the rq->bo. The unfortunate outcome here is that the bo may be
    recycled for a new batch before it is finally released from the request.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f76133e71f1a7cb44ed2f98762ba8626f1e85e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 13 12:46:39 2014 +0100

    sna/dri2: Tighten reporting of faked flip events
    
    GetDrawableMSC is specified as returning the frame counter and timestamp
    of the last flip event associated with the drawable, not the current
    hardware timestamp.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96ce362ba40bf9560fb1aa27a6ae5fdd2a8bd428
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 13 09:46:45 2014 +0100

    sna/dri2: Do not rate-limit vblank=0 swaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7316feeda552a88245dadde9dadd9b40b8a4992
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 07:46:00 2014 +0100

    sna: Add some DBG to track rogue requests
    
    In particular allow the pointer cache to be disabled for valgrind.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 692555cc03c3a3632d2eaacdbbe800afdefd9f77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 8 15:22:44 2014 +0100

    sna: Rename DRI2 files, functions and variables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09e26d38e9eca33e27fd0b30524e75814d5d3ad9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 14 08:42:48 2014 +0100

    sna: Avoid promoting SHM Pixmaps for DRI
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7303c6c75df135d2d01f126f240a270ad26201c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 12 09:56:51 2014 +0100

    sna: Check for PRIME scanouts
    
    Query the cache level on imported dma-bufs to see if they need special
    handling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad01e1c8700caeaf0288b72450646d7ebe7cce93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 8 13:02:15 2014 +0100

    sna: Fix another assignment inside an assert
    
    Another recent introduction, spotted by Rinat Ibragimov.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e78a00c5da922024ac64270fae0797d98d1d6e57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 8 06:45:43 2014 +0100

    sna: Add an xorg.conf option for removing unused outputs
    
    Clients are not yet ready for outputs that disappear at runtime, often
    unexpectedly dieing with asynchronous BadOutput errors. A simple
    workaround is to not remove any output just yet - but allow users to opt
    in via xorg.conf, i.e.
    
    Section "Device"
      Option "DeleteUnusedDP12Displays" "true"
    EndSection
    
    The name chosen is to be consistent with the nvidia driver, which did
    MST first and encountered all of these issues first, and has also been
    adopted for -modesetting. If this is combined with persistent output
    naming (i.e. based on DisplayPort branch topology), the number of
    outputs presented to the user should be static.
    
    Instead of removing the outputs, we have to mark them detached instead
    to avoid throwing errors from the kernel.
    
    Based on the patch for -modesetting by Dave Airlie.
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a93157587a82c699e7df76fb482c49569f0686b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 21:20:56 2014 +0100

    sna: Tidy thread handling under valgrind
    
    If valgrind is running, keep it simple and avoid using unknown
    instructions (causing valgrind to die with SIGILL).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efd9e9c3eeb83b9e5725fa642066925d608c059d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 21:19:57 2014 +0100

    sna/dri: Use move-area-to-gpu to handle clipped regions more efficiently
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1385ca9eeb26b0b82b623da619a65036830ccceb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 21:19:32 2014 +0100

    sna: Initialize value read through ioctl to please valgrind
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d516589ba9d0325e57e08d41becff64f81e2d00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 17:49:15 2014 +0100

    sna/dri: Implement TripleBuffering using DRI2SwapLimit
    
    An addition to DRI2 that was overlooked at the time, was the support
    added for having multiple outstanding swap requests in the core. The
    importance of this is that we can then send the SwapComplete reply after
    the pageflip is completed and not before as we currently do to fake
    triple buffering - in clear violation of OML_sync_control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18416b5162e6d6e5415916c55c935b08c980d7f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 13:49:13 2014 +0100

    sna: Don't assign in an assert
    
    That just nullifies the point of the assert in the first place.
    
    Spotted-by: Joakim Tjernlund
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0250a4f4ba5b765fe4e9be585e03c92aa2376402
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 12:40:01 2014 +0100

    sna: Fix bogus assertion about conn->encoder_id
    
    The connector's encoder_id is only set if the output is active.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c410f0cd982cad8de440727b0ad7d9268b89a704
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 11:04:10 2014 +0100

    sna: Set desired mode after rediscover during VT switch
    
    When switching back to the VT, rerun the output discovery (if such an
    event was pending) before we attempt to set the desired modes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c38512e12e879ae8932528a9cac5ffbf4ea138c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 11:01:30 2014 +0100

    sna: Run output discovery before modes query
    
    If we keep the separate discovery uevent, we need to run it first in the
    cases where we get combined discovery+hotplug events.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7aefd003bb65cc52a74dfcfd8af4b67a364343ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 10:13:53 2014 +0100

    sna: Fix unattached outputs for ZaphodHeads
    
    We need to preserve possible_crtcs for the later check that we can use
    the output with the particular ZaphodHead (which owns a CRTC).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5bad6daaaa60fa8970eaf4a1ce485cd4c72c2fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 7 07:53:11 2014 +0100

    intel-virtual-output: Disable remote CRTC using the remote Display!
    
    Reported-by: Kirill Müller <mail@kirill-mueller.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=78293
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 632d3dfe215c38f2dd052625ea8ec34582dfafef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 6 12:24:37 2014 +0100

    sna: Treat encoder id array as invariant
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f62dfd8f518bb4117d395f81b684340dc4f1ede5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 6 07:37:59 2014 +0100

    sna: Allow connectors without an associated encoder
    
    In the future, we may see a setup where connectors are created without
    being attached to a specific encoder, instead associated with multiple
    generic encoders - such as DP MST sink devices. To handle this, we need
    to recheck their active encoder at runtime after branch configuration
    events (or possibly hotplug).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea602f7e10c6319c4213776b49f2ae25739af316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 6 06:58:35 2014 +0100

    sna: Discard the TearFree damage when doing a full CPU migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8d71e029cec5c8d1c7e344331b86d2e27f6bc24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 20:59:24 2014 +0100

    sna: Tidy computation of clone/crtcs for fake outputs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77507909a18b687698f6d4e436ef66d942308fc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 19:43:25 2014 +0100

    intel-virtual-output: Grab the server whilst cleanging up the local output
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56126d00503fd9bc6fe30781ecddb2fb67de817b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 18:17:01 2014 +0100

    sna: Refine hints to allow inplace writes whilst compositing aligned traps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 464ef44ab1d691a4bffecbe88be8182adf9fd4ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 14:49:31 2014 +0100

    intel-virtual-output: Copy existing CRTC information
    
    If we fail to disable the remote output during initialisation, copy the
    current configuration in order to try and keep the bookkeeping in order.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 194f9332d35601178ae3595bc17a3f52f5644cb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 14:29:16 2014 +0100

    intel-virtual-output: Try disabling Panning after disabling CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5279ebf56449a9b9edd28ff23e9c8a20af792795
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 13:06:11 2014 +0100

    intel-virtual-output: Mark ShmPixmap destinations as writeable
    
    In order to prevent a subsequent BadAccess when we try to use it as a
    ShmPixmap, we need to mark the segment as writeable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=78293

commit a93d2d4f910dc66fe7114a4f44bf8098e3f7ae7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 13:03:14 2014 +0100

    intel-virtual-output: Check for errors whilst creating ShmPixmaps
    
    Creating a ShmPixmap may cause an asynchronous BadAccess error, so wrap
    the construction with XSync and check for an error before proceeding.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=78293

commit 45892b3a63613af67e249e9ad006f2b2002570c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 12:41:06 2014 +0100

    intel-virtual-output: Record shm/randr/xinerama queries in DBG log
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c9f216d7ce7c329b1008cb09c9de55396e0e6b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 12:38:51 2014 +0100

    intel-virtual-output: Check error state when disabling CRTC
    
    Only mark an output as disabled if we do successfully disable it. This
    will require a little more work to make sure that such errors are
    cleanly propagated back to the host...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef178f7d6955e12383c64ad9ee706db0e931992e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 09:37:56 2014 +0100

    sna: Fix loop iteration whilst deleting connectors
    
    If we remove a connector/output, we need to not advance the iterator or
    else we skip over an output (as the array is reduces inside the loop).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8fd13a52072c2f8f12f934deaba1ef9ddb16d5f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 5 09:32:59 2014 +0100

    sna: Reorder connector initialisation to avoid leak
    
    If the output was ignored, we would leak the allocations. However, we
    can check the output name after the first GETCONNECTOR/GETENCODER
    request before any allocations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55f567f9d8dd1bbc21acf30f02d394e54ddc8157
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 4 12:13:25 2014 +0100

    sna/dri: Report the last known MSC whilst the pipe is off
    
    From OML_sync_control:
    "The graphics MSC value is incremented once for each screen refresh.
    For a non-interlaced display, this means that the graphics MSC value
    is incremented for each frame."
    
    When the pipe is disabled, return the last known MSC such that the
    reported value is always monotonic and consistent with the pipe when it
    is active again. That also is consistent with OML_sync_control which
    says that the MSC is a vertical refresh counter, and by implication does
    not increase whilst the pipe is off.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 080e9f99857081bca063c67afb7c98854d1f61f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 4 11:59:40 2014 +0100

    sna: Prefer PrimaryOutput for timing signals
    
    If the drawable is even partially on the PrimaryOutput, use that pipe
    for determining synchronisation counters and synchronised updates.
    
    OML_sync_control:
    	"For a multi-monitor system, the monitor used to
    	 determine MSC is screen 0 of <display>."
    
    The PrimaryOutput is the nearest approximation we have to "screen 0". We
    also deviate in handling what hapens when that screen is off, which is
    not mentioned at all in OML_sync_control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 828bd9e250b7d9dd1dc4185c0179237e9b21d8bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 17:13:29 2014 +0100

    sna: Reorder cursor initialisation
    
    It helps to initialise the cursors after we setup one of the values we
    depend on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38f82655e0bc8f26250f56e9a25aedd30b46360c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 12:30:43 2014 +0100

    sna: Remove incorrect cursor assertion
    
    Ideally, we want to assert that we have sufficient stashed cursors to
    allocate for the unused CRTCS, so something like
    assert(num_stash + num_active_cursors >= 0);
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 430152da82f496ac47f33ce1eca65d154af38752
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 16:57:27 2014 +0100

    compat: Add missing wrapper for RegionSubtract
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit add84cd8a8dc6d285912d0ea3a3a3e7faa9e0942
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 13:21:02 2014 +0100

    sna: Perform dynamic connector discovery
    
    One of the side-effects of MST is that we need to support dynamic
    attachment and removal of displays as the branch hierachy changes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3123dec3dfc55fbca32d32eaaa8ac29396b28c49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 10:40:47 2014 +0100

    sna: Do not stash drmModeResPtr
    
    In the near future we will be dealing with dynamic discovery of
    connectors, and so we cannot assume that the mode resources will be
    static for our lifetime. The first step is to not keep that struct
    around, but pull out the useful information and discard it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b072074aa2b08c09a3d920d67f38ae73009ced6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 2 08:27:07 2014 +0100

    sna: Refactor hints for GPU promotion of composite fills
    
    The major change here is not do a full promotion if we are filling
    through a clip region. The original intention was to catch doing the
    initial clear of the background, but it was also triggering for drawing
    rectangular outlines etc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81608b4da5b35993cd2071098235c14920b7236d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 1 13:15:11 2014 +0100

    sna: Do not discard damage when using the CPU to perform BLT spans
    
    The BLT paths are only taken when we know we are overwriting the target
    contents, and so we do not have to worry about reads along those paths.
    However, in terms of migrating the damage for a pixmap, we have to be
    careful in case we do not write to the full area of the composite
    rectangle, in which case we have to treat it as a read to that area and
    migrate the damage.
    
    Regression from
    commit a13781d19defc97af6a279c11a85e33ef825020e [2.20.10]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Aug 19 09:45:12 2012 +0100
    
        sna: Enable BLT composite functions to target CPU buffers
    
        Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    
    Reported-by: Matti Hämäläinen
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 150458c402f2a93e87924dacd3d0e99def512b85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 1 09:42:07 2014 +0100

    sna: Refactor migration DBG code
    
    And add a new DBG option to disable partial-cpu migrations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca57ee723497b07396646e567fd87dfce8d779fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 1 09:15:28 2014 +0100

    sna: Add some DBG for tracing vblanks across modeset/resume
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bcbb2f222c39ab8732bf1daa248c77ce22cc173e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 30 14:43:01 2014 +0100

    sna/dri: Tidy call to vblank ioctl for MSC waiting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4430703619dc6012407ab703f211dc1181ba6ec8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 30 11:10:49 2014 +0100

    sna: Be more lenient and allow tiled uploads to replace CPU buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2fd1a05ac50ac4ba7cf09225f9133a8141aef302
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 29 13:51:33 2014 +0100

    sna/video: Initialise pitch before query
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41a573c15ca1a1e775a2060be117374a5bc6f9b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 29 13:30:14 2014 +0100

    sna: Discard TearFree damage on partial migration
    
    If we are overwriting part of the framebuffer, we know we do not need to
    read that portion back from the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d75501572a4ea95fc126314718468345630723a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 29 13:29:45 2014 +0100

    sna: Preserve cpu hint for compatible mmapping of the GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94e39323772ef6561efcc0620f67cabd2462a0d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 29 09:02:50 2014 +0100

    sna: Recycle physical cursors
    
    A side-effect of the workaround for incoherent physical cursors is that
    we never reused a cursor after disabling. As such moving the cursor off
    the pipe and back on would eventually consume all the preallocated
    structs leading to a segfault.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=78002
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b23011c27736d0ae2b33d8ea147c16b909baa57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 15:59:18 2014 +0100

    sna: Tweaks to cursor DBG logging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4bd452caa335a54076fa003ee616c2efe93bca3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 14:01:43 2014 +0100

    sna: Assert against underflows in BLT command lengths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a993c8aa9e8594c32d5e67329b0dbed0d92c761
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 12:53:00 2014 +0100

    sna: Initialise pointer before use
    
    commit 534a0e6433a37c95f7181f7ce9046a4e7c82532d
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Apr 28 07:53:13 2014 +0100
    
        sna: Factor in destination sizes for choosing intermediate tiling bo size
    
    assumed that the target bo was being initialisation for the tiling
    composite; it was not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0042850494ac16149ba310c910ca08f86c191fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 08:37:11 2014 +0100

    sna: Rearrange final aperture check
    
    If we cross the high water mark, first flush the batch, then check the
    remaining pages to see if they fit into the aperture.
    
    Reported-by: Bruno Prémont
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a685d1d7b63a1589ba0fd09168d4f95d18fcae5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 08:31:59 2014 +0100

    sna: Add a minor DBG for tiled copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e330f3980b7bacad30b25ff144e4162acc854bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 08:15:35 2014 +0100

    sna: Refine fence packing estimates
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 534a0e6433a37c95f7181f7ce9046a4e7c82532d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 28 07:53:13 2014 +0100

    sna: Factor in destination sizes for choosing intermediate tiling bo size
    
    When tiling, factor in the destination usage of the aperture in case
    that reduces the available aperture for the intermediate bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11cc397cb1cded40f7ab43c1add3fd00b97c6bdc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 27 07:55:09 2014 +0100

    sna: Preallocate cursors
    
    We need to avoid all allocations within the signal handlers, so
    preallocate the cursor structs.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77975
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9417f13cc4074ea6e5dad88e054337e93b461a4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 27 07:55:09 2014 +0100

    sna: Preallocate pwrite scratch buffer for old fashioned cursor updates
    
    We need to avoid all allocations within the signal handlers, so
    preallocate the transfer buffer.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77975
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 795cebf053e8457b998522ab7eea80b0819cb46b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 27 07:52:14 2014 +0100

    sna: Replace cursor gen test with feature flag
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b76a1f6fb046353b1e2f553dfcb03978807272d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 27 08:32:17 2014 +0100

    sna: Initialise cursors after checking for KMS
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3c5a524965958b5b11a1195e773d10ac9fc6611
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 14:23:55 2014 +0100

    sna: Tweak use inplace CPU maps for writing
    
    Allow us to write into a GPU bo without any pending CPU damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c872be6cbef3b07dc79fc8f83d719543c0adcdee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 14:23:55 2014 +0100

    sna: INPLACE has early exits in move-to-cpu
    
    We can update the priv->cpu flag more accurately by accounting for the
    early exits for the INPLACE accessors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05cf93287419992208493f5098fc7b089e95b20c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 14:21:39 2014 +0100

    sna: Be more selective of reusing bo for inplace uploads on !LLC
    
    On older architectures, we can only do the inplace upload into a GPU bo
    into a new unused bo (that is still in the GPU domain).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf7efedb32b63901f7e42a90f756899b9ba60e65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 14:20:47 2014 +0100

    sna: Tweak untiled limits
    
    Allow more small pixmaps to use untiled for linear mmappings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fbbfd4dd35c5e5381897b7e5d4c16c1f182ef2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 11:34:06 2014 +0100

    sna/video: Show sprites across all outputs
    
    If an overlay video (using the sprite interface) is visible on multiple
    outputs, we have to create and show a sprite for each.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77802
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3508f809c40bc59d67deb7182807664bc0648639
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 11:46:12 2014 +0100

    sna: Fix assertions for mmapping stolen buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aec3cbb1aba8bae5537534754ea57d21896d591b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 09:17:22 2014 +0100

    sna: Reuse any output not explicitly disconnected
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77768
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ed733d16a6ce35b1426bddd993a360f0a7387a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 23 09:17:01 2014 +0100

    sna: Improve DBG messages for rejecting outputs during initial config
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb5b21e34f6cbe44a249e566471754b45c500e60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 22 21:22:37 2014 +0100

    sna: Apply defense against a rogue call to move a SW cursor
    
    So the sna_set_cursor_postion() assertion was reported to have caught us
    trying to adjust the position of an absent cursor. That should be
    impossible as we should only arrive there if we claim we can support a
    HW cursor and so have a registered cursor. However, changing the
    assertion into a guard is trivial, and preserves peace of mind.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b12bc035fb8ee40bb382e66604e869b729270189
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 22 12:30:29 2014 +0100

    sna: Add a DBG aide to disable hardware execution
    
    Submit a dummy batch so that we still build, submit batches and perform
    relocations, but do not actually invoke the GPU. This can be useful when
    looking at mysterious hardware hangs.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77263
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6bc0e390bcba97f7aacab4d87251867ca309c17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 22 09:41:21 2014 +0100

    sna: Use a global pixman glyph cache
    
    In Zaphod mode, we use a common pool of glyph images but insert them
    individually into a cache for each head. However, we only remove the
    image from the first cache, leaving a stale slot in the second head.
    Upon subsequent reuse of the glyph id, the second head renders garbage.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54707
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b259cbffcfb41a20c8b0cf1c32f6ff3e9872a472
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 20 16:39:37 2014 +0100

    sna: Avoid copying from tiled source for an overwritten fill
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 935ec0abcb3b92b1aad00885be59644bf775f5dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 21 08:20:39 2014 +0100

    uxa: Remove misnomer from ATI logs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08e71e1820d6fcb6829b4ebd360beadc1f250295
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 19 16:27:49 2014 +0100

    sna: Initialise thread->arg
    
    If we launch less than the maximum number of threads, we may read the
    thread->arg value never having set it after a malloc.
    
    ==8207== Conditional jump or move depends on uninitialised value(s)
    ==8207==    at 0xA986B7F: sna_threads_wait (sna_threads.c:216)
    ==8207==    by 0xA986EFE: sna_image_composite (sna_threads.c:350)
    ==8207==    by 0xA93DD0D: sna_composite_fb (sna_composite.c:598)
    ==8207==    by 0xA93E66C: sna_composite (sna_composite.c:742)
    ==8207==    by 0x23A773: damageComposite (damage.c:503)
    ==8207==    by 0x2309A9: ProcRenderComposite (render.c:708)
    ==8207==    by 0x15D86D: Dispatch (dispatch.c:433)
    ==8207==    by 0x161689: dix_main (main.c:294)
    ==8207==    by 0x6FB1B44: (below main) (libc-start.c:287)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58a757b64927d8e27c4ac38cc15f8291037ec905
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 09:28:02 2014 +0100

    sna: Do not reuse physical cursors for the kernel is broken, harder
    
    commit 154f7e9668bffdf565b6914a3a3e5bdfe17aa1b9
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Apr 18 09:28:02 2014 +0100
    
        sna: Do not reuse physical cursors for the kernel is broken
    
    was insufficient as it ended up reusing a stale cursor that was still
    attached, and so after updating the cursor the second pipe found itself
    with a valid cursor. Hey presto, we had a shared physical cursor, once
    again demonstrating the buggy kernel.
    
    This time, disable all cursor reuse except for the once currently
    attached to the pipe - this should prevent all sharing.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77351
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb0ed43cbc6f34bde670ab846e7ba9e7dbf9b660
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 20:55:49 2014 +0100

    sna: Refine detection of when shadow is active during BlockHandler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d9ae02c647f93be58d3f77168752774868008f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 11:43:45 2014 +0100

    sna/video: Provide a fallback path for pwrite failure
    
    Stranger things have happened.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fdc28205d590d560a6f3886189ef974d1d00f2cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 11:34:07 2014 +0100

    sna: Always flush the shadow scanout
    
    When the shadow scanout is active, make sure we call the BlockHandler
    every time, not just when we about to sleep. This is in case we are
    swamped by clients trying to render and forgo the important step of
    ensuring that their output reaches the screen.
    
    Reported-by: Ildar Nurislamov <absorbb@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 924237efbddb167efc7f9f3bde42b32ffc538ee3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 11:33:42 2014 +0100

    sna: Fix some DBG formats
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa56f1062b926b15e554f46eb268a69b43dd8b9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 09:52:26 2014 +0100

    sna/video: Only try to set the color key once
    
    So that we only report the error to the user a single time, and not
    every frame.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 154f7e9668bffdf565b6914a3a3e5bdfe17aa1b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 18 09:28:02 2014 +0100

    sna: Do not reuse physical cursors for the kernel is broken
    
    Big bug in the kernel that prevents the sharing of cursors across pipes
    when they are backed by a phys_obj. To prevent hitting that bug, don't
    do that!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77351
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83f49767f8ed9dd49c40ebc65ed22c288a386edd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 16:27:44 2014 +0100

    sna: Pre-emptively bind framebuffers into the GTT
    
    In order to avoid rendering to the bo and then stalling before we can
    pin it the display plane, bind the framebuffer into the GTT (by using a
    GTT mmap) during the initial allocation.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd0579016be9e0385c0cdd07a9f9e17f93b93a4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 16:27:44 2014 +0100

    sna: Pre-emptively move framebuffers into the DISPLAY cache domain
    
    In order to avoid rendering to the bo and then stalling before we can
    pin it the display plane, allocate bo for fb from uncached and change
    the cache level during the initial allocation.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0472af1f3c6832838b0cfea38e261c908afd04e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 16:31:08 2014 +0100

    sna: Mark partial composite operations upfront
    
    Rather than guess in the backend when we are going to be called for
    multiple boxes, rely on the frontend declaring it correctly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49e72bd4e59085aa940e5af63381c5394ee670ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 11:24:10 2014 +0100

    sna: Discard TearFree readback when overdrawing
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13054a00dadedae6495eb5cdf586b7916b82053e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 10:28:32 2014 +0100

    sna: Fix up cut'n'paste typo in assertion
    
    sna_display.c:3176:43: error: 'struct <anonymous>' has no member named 'rotation'
          assert(cursor->rotation != sna->cursor.rotation);
    
    Reported-by: Ildar Nurislamov
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ed8647aef012d30c602f86fc6f97a0a92d7710f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 15 06:55:26 2014 +0100

    sna: Add a cursor DBG for a failed pwrite update
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb35b397395cff8ff7f5155759f58c1840bfeeb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 14 17:12:37 2014 +0100

    sna: Rearrange cursor reuse to avoid sharing rotations
    
    Try not to steal a rotated cursor that is currently in use, or else we
    may see a brief flash of corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd700c37ee2a68262b1ccfff332dd41ba8599e2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 14 16:48:05 2014 +0100

    sna: Add some bounds checking asserts to damage
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1300640
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ae82134ad14085e80d93592e155978a5056f44a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 11 18:36:16 2014 +0100

    sna: Restrict WHOLE hint to PutImage on a complete Pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6883f5a64498880425d47871323642409282d9ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 11 08:02:49 2014 +0100

    sna: Perform 2-color to ARGB cursor conversion inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2eddc60a5fe1fabefcad93783d58354570132af3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 11 07:52:30 2014 +0100

    sna: Don't redraw cursor if the fg/bg colors do not change
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a79eb2e29a158910785580409c51a585f25876a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 20:41:57 2014 +0100

    sna/gen2: Fix CA/a8 blend factors
    
    This is a revert of
    
    commit 142f8461944b294dbc3fb0a7bf607bccf0bccc1f [2.99.911]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Mar 10 15:20:16 2014 +0000
    
        sna/gen2: Tidy blend factor selection for the source
    
    as that broke glyph rendering in firefox for instance.
    
    Reported-by: Carl Eitsger <4607vrfcr84spd21f08@weg-werf-email.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77201
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25fa4f5bb4c9ed12755edfeec38b9bdc134736f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 23:14:32 2014 +0100

    sna: Don't set cursor bits to an invalid pointer
    
    The xf86Cursor core simply frees it, so it has to be NULL.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b2753f9cc6a1a7ca353f57d78bdf3d52f32864b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 23:11:18 2014 +0100

    sna: Only mark the transform_in_use when required for shadow fb
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4950bc4fea80d44dde798f3f8b5a07eee1555a63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 22:26:42 2014 +0100

    sna: Only reload an active HW cursor
    
    Do not attempt to restore the cursor handle if a SW cursor is currently
    active. In particular, this prevents a crash after modesetting if we
    never had a real cursor (for example output offloading).
    
    Reported-by: Tomas Pruzina <pruzinat@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77283
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e6e7dbc9257a223ab284198e92f263a1a8b5553
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 21:44:35 2014 +0100

    sna: Don't create slave pixmaps for the virtual CRTC
    
    They only exist as placeholders for remote outputs in the framebuffer
    and do not need to take part in actually output offloading, so we can
    forgo creating slave pixmaps and remove the stub function entirely.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f94684db1a694820ff508d8aec77bf19cea86fbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 16:08:48 2014 +0100

    sna: Validate the cursor everytime for hw support
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d364a881effb2fd87f11648b10d126eb18fcb6be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 09:12:02 2014 +0100

    configure: Report which version (lib or module) of glamor is used
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b771b41f0a945fc580d532524cc744b01dd36d5f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 9 15:24:23 2014 -0700

    uxa: Fix load_cursor_argb for the new Xorg ABI.
    
    Returning an undefined value meant we might get sw cursors.

commit d812afc1d4476ba987883fad2ef8b7c002638077
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 9 15:24:22 2014 -0700

    Use fbpict.h instead of defining its prototypes ourselves.
    
    fbpict.h has been an installed header since 2008, shortly after uxa
    landed.  This fixes compiler warnings when other headers happen to
    include fbpict.h.

commit a6919aa980883cf2828dc0cf813f315e3035d0cf
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 9 15:24:21 2014 -0700

    Update for glamor in the 1.16 server.
    
    We should link against the server's copy, insted of using the external
    library.

commit be7c166a017cee3ef8a1b7b290b7fb14b4009314
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 08:22:02 2014 +0100

    sna: Remove defunct Cursor interface on fake CRTC
    
    As we no longer user the xf86Cursor helper, we can forgo filling in stub
    routines for the fake CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d2872dd0830c8858621402328aa1a9322b66ea8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 10 07:35:50 2014 +0100

    sna: Prepare for an upcoming Cursor API change
    
    1.16 now expects load-cursor-argb to return a boolean reporting
    success/failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9a279b2dc8417b6504478ac96514125d6136523
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 22:15:19 2014 +0100

    intel-virtual-output: Fix damage bounds
    
    Sigh. A serious mixup of integer promotion rules and wraparound caused
    the damage computation for small regions to be completely bogus.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0c93a3e53a624beb5d3a15631237ac33b8c92cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 18:51:23 2014 +0100

    intel: If a non-root user starts X, don't release master
    
    SET_MASTER and DROP_MASTER are only available to the root user. If we
    are started as an ordinary user, and we are master by virtue of being
    the first user of the device, never release our fd or master.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dba43d370b984e262f6fe5920b38b433f4bd392b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 16:11:26 2014 +0100

    sna: Use pwrite to update physical cursors
    
    Older hardware uses physical addresses for its cursor, which are
    implemented by the kernel in an incoherent fashion. Maybe with stolen
    support this would be different...
    
    Fixes regression on [845g, 945g] from
    commit 25ca8f136cef9e1bdf06967bf8e78c87b54ffce2
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Mar 27 14:15:30 2014 +0000
    
        sna: Support variable sized cursors
    
    Reported-by: Knut Petersen <Knut_Petersen@t-online.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f14d6cbff3b9766f5fa834282a4eca6636b6fd7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 13:14:37 2014 +0100

    sna: Handle clipped PutImage uploads more carefully
    
    If the upload is clipped, we do not want to apply the WHOLE migration hints.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77178
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 510e5cf3fa4e1db8297be62461b602b13d18d8fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 12:26:53 2014 +0100

    sna: Tweak application of WHOLE hint for uploads
    
    This help with the continuing saga of
    commit 1de1104064b5898cbed37e836901694a381c1266 [2.99.911]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Feb 21 22:43:04 2014 +0000
    
        sna: Use a hint to do whole image uploads inplace
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77178
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f05552cd7a43ea46ac1a37b68b05be2a82abaeb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 11:54:49 2014 +0100

    sna: Add some DBG for whole CPU pixmap migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf4eb827861bf70d4d45a2ffe062d4c05a1564a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 9 10:22:49 2014 +0100

    sna: Restore empty region checking
    
    commit 8ef81d676c52e42a6d9048fd92b2843470b62945
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Apr 7 07:59:42 2014 +0100
    
        sna: Simplify checking for singular damage
    
    overlooked that we were also checking for empty regions as well as
    singular regions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f40d7e91281b74df43f49885472ee352ea4b389
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 8 18:28:46 2014 +0100

    sna: Fix build for older Xorg without OsBlockSIGIO support
    
    OsBlockSIGIO/OsReleaseSIGIO was only introduced in xorg-server-1.13.0,
    so we need a compat layer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5db8717b8d9f089412b9a7529725c9c41e3e44fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 8 18:00:47 2014 +0100

    sna: Refactor 3 similar CPU migration promotion checks into one
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77178
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 617e96f3af861dd797f98d5a74978f9ba595a981
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 8 08:47:05 2014 +0100

    sna: Add more assertions before dereferencing sna_crtc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6b03269d01e61527641639c6fb7b796205e6ed8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 8 08:44:56 2014 +0100

    sna: Continue to reprobe for ZaphodHeads with a mixed up configuration
    
    Fixes regresion from
    commit 35b03b3fe6213eb3e08f05efe3428bd6bc5421d2
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Mar 28 09:14:59 2014 +0000
    
        sna: Virtual CRTCs are last, so break loops early
    
    as the conflicting Zaphod detection requires on searching all potential
    CRTCs without finding the match. By breaking early on the virtual CRTC,
    we concluded that the setup was actually valid, but disabled.
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77156
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf1875139817c5b00d63a743e262c8f3552058ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 7 08:28:55 2014 +0100

    intel-virtual-output: Fixup DBG messages
    
    Use the right variables and it may even compile.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ef81d676c52e42a6d9048fd92b2843470b62945
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 7 07:59:42 2014 +0100

    sna: Simplify checking for singular damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5014b3fddf6c79f5ca01a91eec5ca92184c8829
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 7 07:59:01 2014 +0100

    sna: Avoid double application of pixel widening for degenerate lines
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=77074
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3310ee89c1f1a663de5f5b12b8125809a213996f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 5 12:18:31 2014 +0100

    sna: Avoid discarding damage when applying WHOLE hint to pixmap migration
    
    Once again, we must be careful when promoting from a region to whole
    pixmap migration that we do not discard required damage.
    
    Fixes regression from
    commit 27ac9f574f65cbd535751c925e9b2e2d7c8a6b3a [2.99.911]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Feb 27 08:33:52 2014 +0000
    
        sna: Avoid promoting region-to-whole migration and discarding damage
    
    Reported-by: gedgon@gmail.com
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77063
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e9ff48ddbe61ad2edbaefde7b94c84637a85291
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 5 10:44:48 2014 +0100

    sna/gen8: Shrink 3DSTATE_SAMPLE_PATTERN packet
    
    This is now smaller than originally specified.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 878ed2d6250701e9ccceacb102b5542986976437
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 5 10:43:25 2014 +0100

    sna/gen8: w/a for NULL depth buffer
    
    Instead of using a NULL type depth buffer, it is strongly suggested to
    use a 1x1 16-bit depth buffer instead (with address 0).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02862faeae21bd445d61006c9aeb966fbe6a7670
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 4 16:03:08 2014 +0100

    sna: Remove unitialized use of 'cursor'
    
    The earlier query of cursor (simply to find out the hw size) was
    replaced by an invariant determined when the cursor was first set.
    However, not all uses of cursor->size were fixed.
    
    Fixes regression from
    commit f98b2e164637292c2425f6e6d2c22bd9a2800f8e
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Apr 2 08:36:14 2014 +0100
    
        sna: Prevent signal re-entrancy into cursor update routines
    
    Reported-by: Christoph Haag <haagch.christoph@googlemail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77053
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 938eea6dee0be153fcf007549a50213f6c957305
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 4 15:56:38 2014 +0100

    sna/gen2+: Beware the unattached ShmPixmap
    
    When dereferences priv, make sure it exists first. ShmPixmaps for
    example, may not have one, nor do very small buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 564e4a9878503c880e0cbd09d88b4c246a0267b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 4 14:04:38 2014 +0100

    sna/gen7: Move constants MOCS into chipset specific info blocks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e86e84da1c8049a150eb6b5780526fea57e0f9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 4 12:41:25 2014 +0100

    sna: Precompute OVER/ADD with solids to convert it into a BLT operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31a4c7bc13c5f4560482b450b9ee4788a58930cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 4 10:46:48 2014 +0100

    sna/gen2+: Replace composite sources with solids where possible
    
    If the composite reads entirely from within a large pixmap which is a
    clear color, just replace the source with a solid.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0565852b668832d4988e875bc12e23abb6e1829
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 3 16:27:47 2014 +0100

    sna: Short-circuit repeated clearing to the same color
    
    Spotted in amongst a KDE debug log was a series of clear; copy; repeat
    using Composite().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit baef2201f752da5d0c6322547d925fcbd86c6de4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 2 11:37:17 2014 +0100

    sna: Silence compiler warning
    
    Simplify the dependency logic so that even the compiler can understand
    what is going on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f98b2e164637292c2425f6e6d2c22bd9a2800f8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 2 08:36:14 2014 +0100

    sna: Prevent signal re-entrancy into cursor update routines
    
    As we may need to allocate from within the cursor update, we are prone
    to re-entrancy issues within malloc()/free(). To avoid these we need to
    block SigIO (for pointer updates) whilst in the critical section.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a926d9f68231ac0f2a1f54c7a722979a8ed6e9e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 14:07:41 2014 +0100

    sna: Update tiling flags after reusing inactive VMA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 644c274b2cd398c8236d36423677317cbc82308a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 14:03:49 2014 +0100

    sna: Fix predicate inversion for assertion
    
    The assertion was checking that the invalid condition was true, rather
    than that it never happened. Oops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b97bf7e6e9e315cc77d940e3be97832a326e702
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 13:32:45 2014 +0100

    sna: Use a cheaper check for a replacement operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76380bcc3c23d75575d37c0436369a8014bd5a3e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 12:46:58 2014 +0100

    sna: Allow reassignment of inactive VMA if not mapped into the GTT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4c8a1b180a9d4c1126ee4fe3120128aa560306c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 11:23:45 2014 +0100

    sna: Discard damage tracking for operations to the whole pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f796d4586507a0a6e9ca3608f43448983a3b965
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 11:14:46 2014 +0100

    sna: Promote to the GPU operations that cover the whole pixmap
    
    If the pixmap is already partially on the GPU, and the next operation
    touches the entire pixmap, promote that operation back to the whole GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27c086a89d838fe0060e5ddd0fb2f37434078e4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 10:01:38 2014 +0100

    sna: Regularly check that damage does exceed the pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8a5a5a58786445d393c3d6388904c0975c364a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 31 09:36:05 2014 +0100

    sna: Search cursor cache first
    
    We can reuse the current cursor size rather than determine it every
    time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e892b789c4c6359e4fb2e11f552b3e43a466c49e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 11:34:03 2014 +0000

    sna: Suppress a compiler warning
    
    sna_display.c: In function '__sna_get_cursor':
    sna_display.c:3153:6: warning: assignment from incompatible pointer type [enabled by default]
      src = sna->cursor.ref->bits->argb;
          ^
    sna_display.c:3209:10: warning: comparison of distinct pointer types lacks a cast [enabled by default]
      if (src != sna->cursor.ref->bits->argb)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c0623b5f36cd1a1a2e3280ab2bea35a7899281b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 09:53:49 2014 +0000

    sna: Only transform the temporary cursor coordinates
    
    As we need to recompute them for each CRTC, we need to reset the
    computation each time or else we screw up the coordinates and hide
    the cursors at random.
    
    Breakage from commit 25ca8f136cef9e1bdf06967bf8e78c87b54ffce2
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Mar 27 14:15:30 2014 +0000
    
        sna: Support variable sized cursors
    
    Reported-by: Jan Alexander Steffens <jan.steffens@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=76724
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80792a3f490578735065d9f67ca6ebac00b5bb75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 09:43:34 2014 +0000

    sna: Our cursors are always square.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35b03b3fe6213eb3e08f05efe3428bd6bc5421d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 09:14:59 2014 +0000

    sna: Virtual CRTCs are last, so break loops early
    
    We know that all the virtual CRTCs are at the end of the CRTC array, so
    when we see the first one, we can stop the processing of real CRTCs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 929ac66558be96a039eadd8604d444598259a0aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 08:48:06 2014 +0000

    sna: Cursors are invariant
    
    Once created, a Cursor has a fixed size and content, so avoid upload
    unnecessarily.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26cc3cec982d316b8fe1700eae885ae2767c0110
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 08:40:47 2014 +0000

    sna: drmGetCap is too recent for our supported versions of libdrm
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78805163c5f8a40a649c973ab2a08b682879f16d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 28 08:45:39 2014 +0000

    sna: RefCursor is too recent
    
    Replace RefCursor with the simple refcnt manipulation for compilation
    against older stacks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e07f8e2e625fb34f9ad795ca8fffc9a9e88e25b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 27 23:06:15 2014 +0000

    sna: Fix 2-color to ARGB cursor conversion
    
    It helps to remember to advance through the source/mask images after
    each row.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e501aa667699787daf7dc0dfd22c397a785564ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 27 21:57:39 2014 +0000

    sna: Cursors only need to be cleared when they are shrunk
    
    If we completely overwrite the old contents, we do not need to clear it
    first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c4d6d1ad748fe5301fa88d9c15c19a07c55149f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 27 21:16:31 2014 +0000

    sna: Reorder the cursor cache search
    
    Search for an exact match first, before looking for a cursor we can
    reuse. This should help reuse with multiple rotated screens not stealing
    the others' cursor on every pass.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8be2a438d7a413ba6c64005971ce814b0076fc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 27 21:09:45 2014 +0000

    sna: Clear the surrounding areas of small cursors
    
    If the cursor does not completely fill the size of the hardware cursor,
    we will retain whatever contents already filled that area.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25ca8f136cef9e1bdf06967bf8e78c87b54ffce2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 27 14:15:30 2014 +0000

    sna: Support variable sized cursors
    
    One of the downsides with supporting large cursors is that the full size
    is very rarely used leading to a waste of permanently allocated
    resources. Refactor our cursor handling so that we can allocate fresh
    cursors on the fly that are appropriately sized.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3810cff42bca1badc5844002694a6f582c0f423
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 26 16:15:07 2014 +0000

    sna: Move cursor reload into crtc notify
    
    This only needs to be done once per-screen reconfiguration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6bdd3b39bfddf1369656a6d182303e2058f6eb8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 25 14:44:49 2014 +0000

    sna: Tighten detection of GCs that translate to solid fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 771b86e2a808bd74e7e2c316f8414766c2b267c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 25 10:27:23 2014 +0000

    intel-virtual-output: Add DBG option to force 16 bit transfers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e46c196ecc8ad83f78f4f948b5dcb07906f249c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 26 12:17:37 2014 +0000

    sna: Print probed maximum cursor size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a273b207b94933713b3dfd7edd3f6bb9b3e959b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 25 09:40:40 2014 +0000

    intel-virtual-output: Fix damage iteration over active list
    
    When iterating over the active list to mark the current damage, we need
    to chase the ->active pointer rather than ->next or else we walk the
    wrong list from the wrong starting point.
    
    Reported-by: Kirill Müller <mail@kirill-mueller.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=76271
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfd51e205639b468479985c3c631e5d9c76d5fa7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 25 08:59:58 2014 +0000

    intel-virtual-output: Add a little more DBG around damaging clones
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 278ef8f7bc0c7f63737ad5f5e967ca253c2571cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 25 08:33:46 2014 +0000

    intel-virtual-output: Do not detach with DBG enabled
    
    Since DBG is sent to stdout, we only see it if we do not daemonize
    (which closes stdout).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7addfcbf0f2f609ce2a5b8e9a75ee7efb483531c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 24 12:51:11 2014 +0000

    sna: Remove one conditional from rendering glyphs into a mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3050dbaf74d6a5b5123eea13bc7710efea6257f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 24 12:39:37 2014 +0000

    sna: Consolidate handling of uncacheable glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79399ff9264ff23da0ab95131a67d2ac85651b3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 24 10:46:57 2014 +0000

    sna: Eliminate a few conditionals in glyph fast path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 220accd828c5a0054ae9e3b491a434f7a6c750e0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 20 09:03:31 2014 +0000

    sna: Only enable cursor support if the hw cursor is supported
    
    Under a host, we naturally will not setup the cursor capability, and
    this provides a safeguard in case we have a machine that does not
    support hardware cursors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7cf0676ff868e7d8cdbfb264e5822250b1f59882
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 20 08:51:05 2014 +0000

    intel: Do not close server fds
    
    If we are given an fd by the Xserver, then it is not our responsibility
    to close it during CloseScreen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Hans de Goede <hdegoede@redhat.com>

commit 9f4c121974abcec77e7f920e3258a337260200b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 20 08:48:40 2014 +0000

    intel: Refactor finding device path if unknown
    
    Since we already lookup the device path if we do not know it after
    opening the fd, we can remove the special case along the legacy PCI
    probe path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 582adf067c275a18f55bb43945348b84cb7eb3c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 19 14:57:25 2014 +0000

    2.99.911 snapshot

commit 6802ee00e52515ca886b956f6c0a0e27d708fb31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 19 10:25:05 2014 +0000

    sna: Assert after applying clipping that the draw rectangle is wholly contained
    
    Otherwise we ignore the purpose of applying the clip!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15be6b7c9a89bfdac923d2a27649f539c430366f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 18 16:31:07 2014 +0000

    uxa: Implement minimal flushing for bdw+
    
    Based on the patch by Kenneth Graunke,
    "Several places (such as intel_cache_expire) call intel_emit_batch_flush,
    so it needs to work on Broadwell.  Sometimes the batch is empty, in
    which case current_batch may not yet be BLT_RING.
    
    The PIPE_CONTROL code has not been ported to work on Broadwell, so
    trying to do a render ring flush will hang the GPU.  It also doesn't
    make any sense to do a render ring flush, given that we never use the
    render ring for UXA on Broadwell."
    
    Cc: Kenneth Graunke <kenneth@whitecape.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6446bf96f0cc01e730c240f7ed5c91f5d2292139
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Mar 18 15:16:30 2014 +0100

    intel: Don't close the fd on probe failure if it is server managed
    
    I hit this corner case when testing a single X server spanning both intel
    gfx + an usb display link adapter driven by xf86-video-modesetting.
    
    In this scenario the intel driver gets its platformProbe method called first,
    and if it then closes the server managed fd, the xf86-video-modesetting gets
    EBADFD errors.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 4a6e09c6cdb13773bca5f6831f9f5164008699c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 18 15:52:19 2014 +0000

    uxa: Add support for server managed fds (via intel_device)
    
    Based on the patch by Hans de Goede, this removes the handling of
    drmOpen() and DRM_MASTER from within uxa and instead uses the common
    routines. This reduces the duplicate code from within uxa, and enables
    new features such as server managed fds.
    
    Cc: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc66e663a06f2ce7685eba1fdf9fad01786bcb4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 17 13:46:05 2014 +0000

    sna: Improve guard against loading palettes whilst headless
    
    Whilst hosted, which is very similar to being headless, we do not even
    have the kmode pointer and so checking kmode->count_crtcs is fatal.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28ebbe8fa902a1d3ee4ecbda5041de5e7b68ada7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 17 07:56:39 2014 +0000

    sna: Fix logic inversion in use of imprecise transform conversion
    
    An accidental drop of the if (!is_translation) broke composite copies
    under a transform.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=76244
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57e63221ec0fa304a02beed356549cadb28bcf19
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 19:49:59 2014 +0000

    intel-virtual-output: Minor DBG fixes
    
    Improve the summary after failing to detect MIT-SHM, and fix a DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cc1f005c69786243ac69f6505087071787e6f87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 15:55:41 2014 +0000

    intel-virtual-output: Iterate over remote outputs in the same order as listed
    
    If we walk the output lists in the same order as they are listed by
    RandR, we are more likely to hit favourable priority sorting. E.g. the
    user is likely to setup the outputs in the same order as listed, meaning
    fewer CRTC transitions etc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a55bbe3b598616ef4464e50cb9364c8cdf0b513a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 15:47:20 2014 +0000

    intel-virtual-output: Disable panning before setting mode on CRTC
    
    For whatever reason, presumably to do with the switch between CRTCs, we
    need to disable the panning before setting the mode in order for our
    desired CRTC position to take effect.
    
    Reported-by: Jeff Katz <bugzilla@kraln.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=76146
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5079830bd5f01740c4cbf84888bdf7a93bb2868e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 14:34:48 2014 +0000

    intel-virtual-output: Mode names are freed with ScreenResources
    
    So we have to be careful not to continue to reference the strings after
    they may be freed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c64d2572bafeacae25e9b58c8372ce91858c3832
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 13:08:43 2014 +0000

    sna: Allow some leeway when deciding to discard common translations
    
    Under PictFilterNearest, we can ignore fractional translations (not all
    renderers discard those.) And if we are being approximate, we can loosen
    our tolerance as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b61e6398f0cf94d3c483e30c05ceae4a8383d16c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 11:32:38 2014 +0000

    sna: Ensure we flush SHM pixmaps if rendering to a GPU shadow
    
    Normally, we try to render into the CPU bo of a SHM pixmap. However, under
    the right circumstances we may try to do a series of rendering into the
    GPU bo and then copy it back to the CPU bo. In that case, we need to be
    sure to mark the pixmap as requiring the flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f47f192f2240d19ede0a3a59b7970e4f563f3195
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 09:17:36 2014 +0000

    intel-virtual-output: Include extra debug information for modesets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ad54325e94c4fd144c9fbcba25c3d167b6c5e18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 14 07:42:32 2014 +0000

    intel-virtual-output: Disable remote CRTCs at startup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cbcc1b6190ab733c9ab11543af4a4eb1890225e4
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Mar 6 13:12:32 2014 -0800

    uxa: Enable BLT acceleration on Broadwell.
    
    This supports solid, copy, put_image, and get_image acceleration via the
    BLT engine.  RENDER acceleration (composite) and Xv would be piles of work,
    which is not worth doing since SNA exists, and Glamor is coming.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>

commit c1d7abadbb0009e9f2b9d8d3744d4ae5c13a1c8f
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Mar 6 13:12:31 2014 -0800

    uxa: Remove implicit length from BLT command #defines.
    
    These command packets grew on Gen8.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>

commit 44fe21018330e0ce750ce25be36cc780ccdb78eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 13 08:52:45 2014 +0000

    sna/gen6+: Simplify BLT vs RENDER decisions for fill ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d8ded0dd671fbcbd212e06afbea88a7a56a8f0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 13 08:51:29 2014 +0000

    sna: Nullify extra fill.ops
    
    I forgot that the initial memset(&fill, 0, sizeof(fill)) was no longer
    performed and we rely on explicit initialisation during the setup, so
    add the missing fields.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=76088
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 923b158e5c5dd50f943fe315a058410aeaa76269
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 13 08:14:48 2014 +0000

    intel: Fallback to drmGetDeviceNameFromFd()
    
    If we are not supplied the path, call the libdrm function to search for
    the canonical name for our device.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 202787ffa2bae5b1455137a344dabb9d85ee3aa0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 12 23:57:04 2014 +0000

    sna: Restore asserts that we do not map a freed buffer
    
    The complication comes with stolen bo that we treat as purged (because
    they have no backing storage we can access) and so require an extra
    caveat.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4368a74b1c904625158f0b6baf98ef2a60bb54d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 12 17:37:01 2014 +0000

    sna: Add DBG around using pixman's glyph cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08d73f1a4499cfe7c3121ff2ecdd36729c5f3544
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 12 12:17:55 2014 +0000

    sna: Only couple up a proxy->rq when inserting into the request->buffers list
    
    Otherwise, we may never decouple it again afterwards leading to a
    dangling pointer dereference.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1289923
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f50261539618c30c8470a5795fe5c2440e2318f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 12 10:51:56 2014 +0000

    sna: Simplify code when no 64-bit registers are available in the ISA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20026626d28b304a6156fb2c49752e18f2498de5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 7 13:18:07 2014 +0000

    sna: Missing fixes for using BLT points
    
    On a lone machine I had a vital fix for setting the destination tiling
    bit inside the XY_PIXEL_BLT command. Sadly, I forgot about the fix before
    the patch from another machine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd189c868908c81e7c57abf442ec1659efc2637a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 11:37:01 2014 +0000

    sna/glyphs: Add a smattering of DBG for validating the glyph mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d31569455ca25b7050a240cad58bea492c58194a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 10:46:06 2014 +0000

    sna: Avoid using the wrong pitch for comparing replacement sizes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c5593037f31159532da992ae3b503c3b4a42f8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 10:44:52 2014 +0000

    sna: Assert that the pixmap pitch is initialised before use
    
    This is a sanity check that the pixmap is mapped for use by the CPU
    prior to us actually using it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd1ff3230292a31d366c96b97711d7df97362093
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 10:06:24 2014 +0000

    intel: Protect against a NULL platform device with server fd
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59f2f4885dbead3f2aece668f48c3ac749f724c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 10:00:27 2014 +0000

    intel: Fix versioning of SUPPORTS_SERVER_FD
    
    The current snapshot is 1.15.99.901, which means that the new feature
    will first be available in 1.15.99.902.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78970676e79d462cf99509012db54479ba93c01a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 11 07:33:09 2014 +0000

    sna: Be defensive when applying size restrictions to bo
    
    The assumption that all paths prevalidate the restrictions upon creation
    the bo are false. Some important paths try to force the bo creation in
    order to meet client expectations (e.g. DRI). So we are faced with
    impossible requests which must fail, so make sure we do report those
    failures.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1289049
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d10a5abcbd7c751adc08e24d9f4bdc33596b6f12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 7 19:44:07 2014 +0000

    intel: Supply a fallback guess for the device path
    
    If for some reason we have an fd, but no device path, use the likely
    default path (derived from and validated against the major/minor of the
    open device fd).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28cab948f50b1d67468edbd9c8e10d3d696155f5
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Fri Mar 7 14:13:38 2014 +0100

    intel: Add support for server managed fds
    
    In the post-modern world, the platform device nodes are handed to a
    non-privileged Xserver by systemd/logind. We can then query the core for
    our assigned fd rather than try to open the device for ourselves (which
    would fail when trying to obtain DRM_MASTER status). A consequence is
    that we then do not directly control DRM_MASTER status and must act as a
    delegate of systemd.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit e5f8118bdbc4655d987ab1c52e0a46fa85cc92c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 22:12:39 2014 +0000

    sna: DBG compilation fixups
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ed8570f6aa01fdd4edc3df7585f01083b4a9778
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 16:39:50 2014 +0000

    sna: Pass render hints for migration based on source location
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 955b5de4ba103fb115ec0b45f9b59eb2628ca3dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 16:38:54 2014 +0000

    sna/glyph: Release the pixman glyph cache along the error paths
    
    If we lock the glyph cache and then hit an error, we must make sure we
    release our lock. An easy way would be not to lock when we may err.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1cb0284218aaf248e251ac0d12fee4bcd3c7650
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 15:01:10 2014 +0000

    sna/gen2: Fix build after last minute patch editing
    
    Whoops, the selective editing of the patch left a trailing '{' and
    breaking the build.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 142f8461944b294dbc3fb0a7bf607bccf0bccc1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 15:20:16 2014 +0000

    sna/gen2: Tidy blend factor selection for the source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0075c90d3192ba90ff1ae8a7b04bfc3ff4fccda7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 10 15:17:51 2014 +0000

    sna/gen2: Fix alpha blending with 8bit destination surfaces
    
    On gen2 (like gen3), 8-bit destination surfaces are read into the Green
    channel (and written to from the Green channel). Therefore the expected
    alpha blending must instead be converted to colour blending.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=75818
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0b70ca660416af42be8b3f76f9e38a81dcac464
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 7 08:16:50 2014 +0000

    sna: Unroll finding bbox of points
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 928453b1bc5a059a87fbcdba9156d318a0310073
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 7 08:15:21 2014 +0000

    sna: Emit points using the BLT primitive when appropriate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2b4f2657f8cd503fce4e3b8cc3240d7b45d36ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 5 09:51:24 2014 +0000

    sna/gen8: Correct MOCS settings for render targets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7123410a33f29c67a11f26d17ce8b0dc09cc594
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 3 10:12:11 2014 +0000

    NEWS: Fix dates for 2014
    
    It has come to my attention that between December and January is
    traditionally a New Year.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3bfb4d3c15e6a37aba5d2f5ba92134c5186e3a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 28 08:47:21 2014 +0000

    sna: Reorder writes during thread task decoupling
    
    So that the lockless reads do not see the task complete signal prior to
    marking the task as successful. Otherwise, we falsely detect that the
    thread trapped a signal and kill them all.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37d080929a20bd969749c6c12d1ef4ebe236063f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 27 08:36:40 2014 +0000

    sna: Limit the WHOLE_HINT to large PutImages
    
    The goal here is to predict when we are uploading an entire image though
    multiple PutImage requests. If the image is small enough, then the
    PutImage will be contained within a single request and the damage
    tracking will be accurate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27ac9f574f65cbd535751c925e9b2e2d7c8a6b3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 27 08:33:52 2014 +0000

    sna: Avoid promoting region-to-whole migration and discarding damage
    
    Fixes regression from
    commit 1de1104064b5898cbed37e836901694a381c1266
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Feb 21 22:43:04 2014 +0000
    
        sna: Use a hint to do whole image uploads inplace
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=75549
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff49944928c7399527b11bb0da7699711591c21a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 21:21:46 2014 +0000

    sna: Tighten assertion for tiling blt fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf4683209d11ca7382079feb242cc0c07fefc402
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 20:17:08 2014 +0000

    sna/gen6+: Add missing DBG argument
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4d23ff3b2a75cc5a1c65b6b8464fc639c9f90b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 19:35:40 2014 +0000

    sna: Add DBG for why trapezoids may be preferred inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d316d14283d8af86e4c5020f9974280570a78959
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 19:31:39 2014 +0000

    sna: Include mono/precise hints in trapezoids DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a144baec87b17ead36373a8c5fd80f37be3ac19
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 19:19:11 2014 +0000

    sna: Add a little more DBG to watch the flow of allocated bo sizes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 921e9aff3f8e7c4a33c352241311aeb4df3011fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 18:29:27 2014 +0000

    sna: Avoid signed overflow when printing allocated bytes in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0b6c043c997732559a971a788c24a5a73812df4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 18:22:38 2014 +0000

    sna: Cleanup caches if execbuf fails
    
    One of the failure modes for execbuf is running out of memory - often
    this is reported as a false ENOSPC (thanks shmemfs!). Because of this,
    we should try to resubmit after we purge our caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfef9916124973b5e08f9b32eb1fcfb400ee4e8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 18:12:24 2014 +0000

    sna: Propagate thread signals for extra DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64fc1bb9c87e95ff484ecd11f391b1c0d556d584
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 14:34:05 2014 +0000

    sna: Allow SIGBUS/SEGV to kill the thread
    
    To handle sigtrapping of the threads, we allow the threads to handle
    their async signals and upon hitting the trap, we kill the thread. All
    the rest of the threads are reaped by the main xserver thread
    afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 900499bff962a63e1d9b5f808d1deb65d55754a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 13:58:11 2014 +0000

    sna: Move sigtrap wrapping closer to threaded sw composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aae3bfeb28ca86b416a6a4de71eb23cdb46cf9de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 12:44:16 2014 +0000

    sna: Assert that sigtrap is active
    
    Curiouser and curiouser.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75cff26ebad33aca7ade7aa5a650235a7d42e47c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 10:05:41 2014 +0000

    sna: Apply the dst offset for pixman fills
    
    Along one of the sw blt paths we failed to apply the offset for
    Composite redirection.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73811
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59d471de7fc7581b112f37a68714d0e1f8728dfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 22 08:35:50 2014 +0000

    sna: Handle asynchronous signals from threads
    
    By killing the threads and leaking their allocations - marginally
    preferrable to losing the entire Xserver.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1de1104064b5898cbed37e836901694a381c1266
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 22:43:04 2014 +0000

    sna: Use a hint to do whole image uploads inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c0aacb869bea34620a2b0029ddfa7f2a9513dc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 21:48:36 2014 +0000

    sna: Allow allocation to fail even when debugging
    
    Let the malloc failure propagate rather than assert.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb87b179532a9b533df458f3367fde7fc3d64d0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 21:41:52 2014 +0000

    sna: Wrap inplace trapezoid operators with SIGBUS protection
    
    For the moment, this still leaves open the vexing question of how to
    protect the multi-threaded variants, but it should provide more shelter
    for extreme OOM.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6fc46d63c5b7bc1347d4e03e71df9e6fdbcaaab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 21:21:46 2014 +0000

    sna: Tighten assertion for tiling blt fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be6d218c6888bce41e15a8e4899618b5e6eacd99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 19:43:30 2014 +0000

    sna: Do not attempt fallback configuration without any CRTCs
    
    The fallback xf86InitialConfiguration() is another function that may
    explode if called without any CRTCs attached.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 769a959d84d7e573b11cc1a7d85c122f17dfeea0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 13:43:09 2014 +0000

    sna: Do not register colormaps without any CRTCs
    
    The xserver may crash if we try to setup colormap handling without any
    CRTCs, so don't.
    
    Suggested-by: Dave Airlie <airlied@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b92b1285ce553c4f475c7fb8ac57ba418009682
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 20 19:18:46 2014 +0000

    backlight: Make search routine for device specific backlight common
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caaf52834015c084704cf638f453b1fc3316eaa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 20 07:51:40 2014 +0000

    sna: Query cursor size from the kernel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c91af569ee90a832899c9038badd84921e9a87fc
Author: Mark Kettenis <mark.kettenis@xs4all.nl>
Date:   Tue Feb 18 19:02:14 2014 +0000

    backlight: Build fixes for OpenBSD
    
    Chris would like to humbly apologise for making these changes to the
    OpenBSD code blind, and to thank Mark and Jonathan for their support
    and understanding.

commit ecc20fbcf8d5adb6c3b7d005c01788e35bba9d3c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 18 07:56:07 2014 +0000

    intel-virtual-output: Discard unwanted events from the mouse recorder
    
    X always sends MappingNotify events (there is no way for the client
    to ignore them). In particular, MappingNotify would be sent after a VT
    switch, and this would knock out our ability to track the cursor..
    
    Reported-by: Raul Dias <raul@dias.com.br>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=75115
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e860b3eaedcb5d56745d5bcc9ce720e9a0e9c293
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Feb 17 13:16:54 2014 +0100

    backlight-helper: Simplify reading the level from stdin
    
    Since the helper is a standalone app, the usual xserver rules of not using
    stdio because of signal handling don't apply.
    
    And since the helper does run with elevated rights, it is important to keep
    the code KISS so that it can be audited easily.
    
    This commit replaces the hard to read "raw" read loop with a much simpler
    loop using fgets, improving readability of the code.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit b5229c6e15964e723a7bb99d3c2c20a2fa168e3b
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Feb 17 13:16:53 2014 +0100

    backlight: Drop rights before executing pkexec
    
    Event though we've failed to open the backlight normally, we may still be
    running under a suid-root xserver, so drop any elevated rights before
    executing what we hope will be pkxec.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 27a9dc4ce8fa3ba56f68e04d11a6272348772039
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Feb 17 13:16:52 2014 +0100

    backlight: Use System instead of system when checking for pkexec
    
    Even though we've failed to open the backlight normally, we may still be
    running under a suid-root xserver, so use the servers build in System instead
    of system so as to properly drop root rights.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 06066b7269b5ccf502c27466ad0434adfd9e3866
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Feb 17 13:16:51 2014 +0100

    backlight: Explain better why we support both pkexec and suid root for the helper
    
    Update the comment about trying suid-root first with some explanations of
    why pkexec may be preferable in some cases.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 6b5c2b4515b646db6be0f9307f53651620516521
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 15 21:03:49 2014 +0000

    backlight: tidy use of BACKLIGHT_CLASS
    
    Use string concantenation to simply the sprintf slightly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb7d2b19e2829b00317991fba05352e3ba1a1902
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 15 21:00:57 2014 +0000

    backlight: Reject user overrides on OpenBSD
    
    We only handle the singular wscons OpenBSD interface for backlight, so
    explicitly reject any user requests for something else.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 268842a47f05508fc7e1c69cd21e8e66a000dcde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 15 19:54:30 2014 +0000

    backlight: Amalgamate hardcoded priority tables
    
    Our fallback path for finding the backlight interface uses a hardcoded
    table of known backlight controllers in proirity order. Rather than
    maintain this table twice in the midst of the KMS logic, push it to the
    new set of common backlight routines.
    
    This incorporates bugfixes from SNA to handle unknown backlights, but
    usable, gracefully.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b71f3d8bd4d6773899c1bdc903911cf240e68ead
Author: Jan Alexander Steffens (heftig) <jan.steffens@gmail.com>
Date:   Sat Feb 15 17:53:16 2014 +0100

    Backlight helper build fixes
    
    Don't hardcode $(prefix)/libexec
    
    Fix install hook when DESTDIR is set
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=75028

commit 3d629c91cfa98b75c6685c2a2003e64fd1b612c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 15 14:55:09 2014 +0000

    intel: Add a helper for setting backlight without root rights
    
    Once the xserver stops running as root on kms capabable systems, we will need
    some other way to access the backlight.
    
    The approach taken in this patch moves most of the heavy lifting to a
    helper that runs with root privileges and pipes our requested brightness
    into the sysfs backlight interface. Where required, we use pkexec to
    launch the helper with the elevated privilege.
    
    v2: Amalgamate much more of the duplicate code.
        Keep the daemon and pipe alive for the lifetime of the backlight interface.
        Provide an alternative for systems without PolicyKit.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com> [v1]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a01548ccf192a5b1fa1f4a3e31e1634db39f6b39
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sat Feb 15 00:02:36 2014 +0100

    intel: export fd_set_cloexec / fd_set_nonblock
    
    Allow fd_set_cloexec / fd_set_nonblock to be used outside of intel_device.c.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 5601f8cc330fe88eadfa7238659c5abb223e3b28
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sat Feb 15 00:02:35 2014 +0100

    intel: Fix fd_set_nonblock
    
    O_NONBLOCK is a status flag not a descriptor flag, so F_GETFL / F_SETFL should
    be used to modify it.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>

commit 8eb6335653e6e38228ecf95c3eef82ca2a864e45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 14 19:36:47 2014 +0000

    sna: Inherit the native rotation on initial output probing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f8714335729b4fbbb33d89dbaf0f13aa3d8427b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 14 16:18:34 2014 +0000

    sna: Reorganise native rotation ioctls to compile on old Linux
    
    It is not just the BSDs that lack these ioctls in their userspace
    headers, but everything older than about a year...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 699bde3991624c25d3b731caf7129ed87710b3b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 14 15:11:21 2014 +0000

    sna: Guard use of DRM_MODE_OBJECT type ids
    
    These are not currently exported on OpenBSD and cause the build to fail.
    Hide their use behind an ifdef guard for the time being.
    
    "I noticed the following when trying to compile xf86-video-intel git on OpenBSD:
    
    /usr/users/jsg/src/xf86-video-intel/src/sna/sna_display.c:2106: error: 'DRM_MODE_OBJECT_CRTC' undeclared (first use in this function)
    /usr/users/jsg/src/xf86-video-intel/src/sna/sna_display.c:2106: error: (Each undeclared identifier is reported only once
    /usr/users/jsg/src/xf86-video-intel/src/sna/sna_display.c:2106: error: for each function it appears in.)
    /usr/users/jsg/src/xf86-video-intel/src/sna/sna_display.c:2107: error: 'DRM_MODE_OBJECT_PLANE' undeclared (first use in this function)"
    
    Reported-by: Jonathan Gray
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37dbd669415ac82a79b3699da0450aaf68cb1c4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 14 14:53:14 2014 +0000

    sna: Check that the backlight interface is in sysfs before access
    
    Before we write values into the file, we want to be sure that it is our
    sysfs backlight interface, and not some ordinary file we are about to
    destroy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a893d14cd227454826a9a86cb3ce227d04bc352
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 22:46:22 2014 +0000

    sna: Increase the acceptable screen size range
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d9fcb3f729e3959dd30b7d7859438894b806b34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 22:36:36 2014 +0000

    sna: Filter out requests to create a 0x0 frontbuffer
    
    Attempting to create a 0x0 frontbuffer results in erroneous pixmap
    generation, and is liable to explode at a random point in future, so
    just reject it outright.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1037a1a3f6a8dbde017a28a7b59ef5398c84dba1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 21:36:26 2014 +0000

    sna: Fix comparison of previous BLT commands
    
    After altering the command bits to accommodate Broadwell, we needed to
    fixup the comparison of previous BLT commands to detect overwritten
    commands.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a9f6a9487201e4c80338e771eec28067f044240
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 16:18:43 2014 +0000

    uxa: Check for access to backlight interface
    
    Before attaching properties to any connector, check that we can indeed
    control the backlight through the sysfs interface by doing an access
    check. If the xserver is started without root privileges, we cannot
    write through /sys/class/backlight and so should take care not to
    advertise that we can.
    
    Reported-by: Hans de Geode <hdegeode@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 611490a176d9bfd136f4340f7c31e0e0f0beea4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 16:18:43 2014 +0000

    sna: Check for access to backlight interface
    
    Before attaching properties to any connector, check that we can indeed
    control the backlight through the sysfs interface by doing an access
    check. If the xserver is started without root privileges, we cannot
    write through /sys/class/backlight and so should take care not to
    advertise that we can.
    
    Reported-by: Hans de Geode <hdegeode@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83d17cded854871fd41cd3fcf25f38c9b67a4705
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 12:57:50 2014 +0000

    sna: Clear DPMS tracking on VT switch
    
    Assume the worst and force us to reset the property when we restore
    control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 135da294106f7158bb68eeeb9e6c171bcddd94f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 11:58:15 2014 +0000

    sna: Extend native rotation support to sprites
    
    The sprite plane can be independently rotated to the CRTC primary plane.
    To rotate the sprite plane, we just set a property on the plane similar
    to how we rotate the CRTC, so we can refactor them together to use the
    same routines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e35017e36e45c57ea9847eb5c8466cac3c4d2cc4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 14:46:39 2014 +0000

    sna: Enable coordinate transforms for native CRTC rotation
    
    Otherwise X tells Clients that the cursor is still in the unrotated
    location when it appears rotated on the display.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72e909953c1865f86fbd6325ff807d7c7357af5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 09:46:13 2014 +0000

    Revert "uxa: Do not change DPMS mode on unconnected outputs"
    
    This reverts commit 4497212307dee5e35bc6836201738a2fdb559020.
    
    Unfortunately, this simple fix does not work for UXA as DPMS is used by
    the xserver to turn off CRTCs and outputs. Since UXA does not implement
    CRTC DPMS, this commit causes us to fail to turn off outputs.
    
    The kernel has been fixed up in the meantime and that commit has been
    recommended to be backported to all stable kernels:
    
    commit c9976dcf55c8aaa7037427b239f15e5acfc01a3a
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Sep 29 19:15:07 2013 +0100
    
        drm/i915: Only apply DPMS to the encoder if enabled
    
    so it should be safe for UXA to rely on its old behaviour.
    
    Bugzilla: https://code.google.com/p/chromium/issues/detail?id=341135
    References: https://bugs.freedesktop.org/show_bug.cgi?id=68030
    Suggested-by: Dominik Behr <dbehr@google.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c5ccf5d9d8beb7e8343eb2d07bbf97f53c1a224
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 13 01:06:41 2014 +0000

    sna: Always assign a name to the modes
    
    In some cases, such as querying the mode from the CRTC, we may not have
    a name associated with the mode. However, RandR always expects a valid
    name. To satisfy this requirement, always generate the canonical mode
    name if no other is specified.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70132
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb89bfc73f4103ca6116c8f91970f4bfa491636c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 16:41:51 2014 +0000

    sna/gen5: Flush the render cache between operations
    
    When we change the blend mode between operations, it appears that we
    must flush the render cache or else we risk render corruption. This is
    usually noticeable in rendering of single glyphs.
    
    This was originally fixed for bug 51422, but was reintroduced by
    commit 37eb7343be1aeeb90a860096756603a577df1a77
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Dec 1 09:40:11 2012 +0000
    
        sna/gen5: Inspired by gen4, reorder the flushing
    and the desire to reduce the impact of this w/a.
    
    Reported-by: itumaykin@gmail.com
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74882
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 564a766a6bbe8bcf2480248a54059e7d6727440d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 16:19:25 2014 +0000

    intel-virtual-output: Do not resize the screen whilst all outputs are off
    
    If all the outputs are off, we try to resize the screen to 1x1, which is
    typically illegal. So, just keep the existing screen and xfer buffer for
    next time it is enabled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87b9d9f507885ed98d7249940218631b775d30ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 15:48:20 2014 +0000

    intel-virtual-output: Force an output probe on initial connection to remote display
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dda57f2e28e01ea254cb2aba9e0846b755c4175a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 15:47:00 2014 +0000

    intel-virtual-output: Fix checking for no change in output modes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94e5ca3d5ab33c8e9b86a4f60c712da72df15b3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 15:13:42 2014 +0000

    intel-virtual-output: Always requery modes after OutputNotify
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=74800
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d84940cc9d297df00477c838b4f53883c19a1da4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 14:48:24 2014 +0000

    intel-virtul-output: Double check timestamps
    
    Compare both res->timestamp and res->configTimestamp for changes in
    state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 607737cc47788e2a8896fddfece907a3cfb24f7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 11:33:45 2014 +0000

    sna: Support native primary plane rotations
    
    Use the display hardware for simple rotations, when exported through the
    rotation property on the CRTC.
    
    As the kernel support is not yet merged upstream, the feature is hidden
    behind --enable-rotation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b43630f5525a60e935dbc46e70354bb45444814
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 10:43:46 2014 +0000

    Revert "sna/gen6: Serialise write to DERRMR register using STORE_REGISTER_MEM"
    
    This reverts commit 2a5ad9c015bbb41550536dd3cf4ad18b7f21fd80.
    
    Oops, pushed from the wrong machine and merged in a incomplete bugfix
    branch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb69bd16a30cd0449fa9bb603dacd001e777b5bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 10:34:34 2014 +0000

    sna/gen5: Use the DBG option ALWAYS_FLUSH to force a full flush
    
    When flushing between operations, we can choose between doing a full
    flush to memory, or just a pipeline flush. For debugging it is better to
    do the full flush to rule out cache effects.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77f8d9ca84342b256de1e118edfd14ddae4d593f
Merge: 3fb39d4 27663f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 10:32:50 2014 +0000

    Merge branch 'master' of hsw:/usr/src/xf86-video-intel

commit 27663f31163c22f7dfaf8f5a3e45fa1c93a7d9e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 09:58:06 2014 +0000

    sna/gen5: Add a DBG option to force flushes between operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 834e8078fc1b8d3acba9fa887d6dcdd861e3c15a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 09:50:35 2014 +0000

    sna: Retrieve tiling for fbcon
    
    Yikes, there appear to be tiled fbcon framebuffers on the horizon.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69d4c15d525065374de50d624388252152a36b8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 12 07:56:10 2014 +0000

    sna: Delete redundant branch
    
    The MOVE_READ else branch is repeated immediately below when marking up
    damage for MOVE_WRITE, so remove it for simplicity.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec39adc93a4a127b34704a2012182b5c72b3a9b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 11 23:08:35 2014 +0000

    Record Video ABI version that we configure against
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fb39d477909a433ae67bdfc69ad870ddabee3a7
Merge: 2a5ad9c c02067d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 11 21:57:23 2014 +0000

    Merge branch 'master' of hsw:/usr/src/xf86-video-intel

commit c02067dcf514f19beb0e17b5765826148386e673
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 11 21:21:17 2014 +0000

    sna: Defer move-to-gpu until we need to transfer GPU damage to CPU
    
    When preparing a pixmap for CPU rendering, one of the last steps is to
    copy the outstanding GPU damage back to the CPU. Currently, we flush any
    outstanding pageflips (for TearFree) and in the process accidentally
    destroy the shadow buffer if there is no outstanding GPU damage. Rearrange
    the code to avoid tripping over that by only processing the move-to-gpu if
    we need to touch the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a5ad9c015bbb41550536dd3cf4ad18b7f21fd80
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 11 11:23:37 2014 +0000

    sna/gen6: Serialise write to DERRMR register using STORE_REGISTER_MEM
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5142d1ca3fd877f2ca9277af314f6432580370de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 10 16:42:06 2014 +0000

    sna: Remove damaged region after converting CPU bo to GPU bo
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1267235fd474c5249d45a7015e3d741dc607e57f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 10 16:37:38 2014 +0000

    sna: Check for overwriting damage before applying clear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f99070708ce8f591c31e1e908809a0ce551c13f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 10 14:19:53 2014 +0000

    sna: Clear GPU damage flag for 1x1 writes onto a clear buffer
    
    An optimisation for 1x1 reads of a clear buffer lead to a bug whereby
    the damage for a 1x1 write would not be tracked correctly (conflicting
    full GPU damage vs partial CPU damage).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2fb2cd092dadba40b5ad2da57943c660a0c9bc14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 10 09:35:11 2014 +0000

    2.99.910 snapshot

commit 37d8566ee78c67647b159a96ddb2675d1506b967
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 9 12:28:27 2014 +0000

    sna/gen6: Restore stall dropped when not flushing instead
    
    commit 82e6d41c2f4f343bd1854d3d8ee4b624b5d68971
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Oct 31 13:35:59 2013 +0000
    
        sna/gen6: Tweak flush around CC state changes
    
    Replaced the pipeline stall with a flush - but only when the target was
    dirty. The missing stall however seems to be required as well.
    
    v2: Actually emit the stall for all CC state changes [Ilia Mirkin]
    
    Reported-by: Ilia Mirkin <imirkin@alum.mit.edu>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72375
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 823382d28944a319c207f20ecef25ce1707a8021
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 6 10:13:41 2014 +0000

    sna: And clear drawable->id on reused pixmaps
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=74550
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fc46adb18a8410074c12d6e8979ef01813ebdf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 6 09:24:17 2014 +0000

    uxa: Do not expose TextureVideo Xv adapters when acceleration is disabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1eadd1d0b1c8bcbf11eb7c0e112d1e424b63c25e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 6 09:04:30 2014 +0000

    sna: Add some DBG to clarify the source pixmap (for tiles)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d1a2ef9553c663bb97b56adde6f6b41241ff528
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 6 08:29:20 2014 +0000

    sna: Reset composite offsets when reusing freed pixmaps
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74550
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79d2f96bdfa0d7ae1567bf4b57b4f86aae424f50
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 5 15:30:30 2014 +0000

    sna: Add some DBG around tiled blts
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=74550
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02eceefa2909075aca0ba3df7fdba835079aeb78
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 5 11:41:42 2014 +0000

    sna: Pass read hints from move-to-cpu to wait_for_shadow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de73c5fd1cd4f948b8bd3582ae788f6f855c5b16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 4 20:57:24 2014 +0000

    sna: Tweak assert_bo_retired() to be callable on cached bo
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73406
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0906769c1b92520351729c4d8f2ab684d3ddf2eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 4 17:51:51 2014 +0000

    sna: Rearrange assertion to ease use of substitute cached bo
    
    Since we call kgem_bo_submit() along one path when synchronising a
    cached bo (which is known to be inactive) but still want to keep the
    assertion on the refcnt, simply rearrange the code to only assert on the
    active path.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73406
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc001615ff78df4dab6ee0d5dd966b723326c358
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 4 10:36:21 2014 +0000

    sna/gen4: Disable use of pipecontrol invalidates again
    
    One day, just not today, we may make gen4 work correctly, efficiently and
    fast. Today, we can barely pick one.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6a21f0355447d398a8b857ad046cd27141d4744
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 4 08:51:17 2014 +0000

    sna/glyphs: Reset composite state between switching glyph formats
    
    One path uses the mask channel, the other does not. We cannot rely on
    overwriting all reused state in this case, and so we must clear the
    composite state prior to use each time.
    
    Reported-by: Arkadiusz Miskiewicz <arekm@maven.pl>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74494
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: Arkadiusz Miskiewicz <arekm@maven.pl>

commit 1cbc59a917e7352fc68aa0e26b1575cbd0ceab0d
Author: Edward Sheldrake <ejsheldrake@gmail.com>
Date:   Mon Feb 3 09:34:33 2014 +0000

    sna/gen4,5: Fix setting pipe control cache flush bits
    
    Cache flush bits are on dword 0, not 1, on gen4 and gen5. Also texture
    cache invalidate is only available from Cantiga onwards.

commit 7f08250a8960f90f6bd34de8c4a17870703bfa60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 2 03:52:11 2014 +0000

    sna: Reconstruct damage for the partially replaced discarded CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 853588ad5be9407d2123f6055458ca84e72b8eb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 21:55:09 2014 +0000

    sna: If IGNORE_CPU is not set we must mark the move as MOVE_READ
    
    Logic reversal in discarding CPU damage. An old bug revealed by the more
    aggressive attempts to discard CPU damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b0748c57ee4c38ea98c4b6ca18cb2b99f8f9ed4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 21:54:43 2014 +0000

    sna: Add some more DBG for choosing render targets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed8d4f0ce3bff662d02063528df64d478ac0dc00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 21:38:47 2014 +0000

    sna: Skip discarding CPU bo when using as a render target
    
    The issue with unwanted serialisation does not affect the async
    move-to-cpu of a render target.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26613b046012f0ad968a15ab6bdfa8f6a6652e77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 21:37:41 2014 +0000

    sna: Allow more inplace promotions of CPU to GPU bo
    
    If the CPU bo is wholly damaged, then it makes an ideal candidate for
    simply converting into the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 699b4fd3139d1d6d02911d6c8f193ead3445f613
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 20:13:53 2014 +0000

    sna: Undo region translation before returning
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c4b2ed558bec3b71077fb12cc4e008cccc819fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 17:59:29 2014 +0000

    2.99.909 snapshot

commit 495bf89496a96eff0b2c5b6a95aa29df8d7fbc81
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 18:57:06 2014 +0000

    sna: Apply drawable offsets to partial CPU damage being replaced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ba8d40bf7e4d3e8fa541c001f82aa65f26bed3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 18:13:04 2014 +0000

    sna: Don't discard the GPU prior to using it for stashing CPU damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 534f19dc5a302828fe60d0f4747ad0dc9617e1a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 17:56:58 2014 +0000

    sna: Remark the region as damaged after uploading the rest to the GPU
    
    If we upload outside of the replaced region to the GPU, we need to
    remark the region of operation as dirty.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2814748b91c80c8935ea2f366e954a80bef69bb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 17:37:42 2014 +0000

    sna: Only discard CPU damage for an replacing region
    
    When considering move-region-to-cpu, we need to take into account that
    the region may not replace the whole drawable, in which case we cannot
    simply dispose of an active CPU bo.
    
    Reported-by: Bas Nieuwenhuizen <bas@basnieuwenhuizen.nl>
    Reported-by: Conley Moorhous <conleymoorhous@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74327
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e784832a52686cd29d62bdeac7b1c539c640c5b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 1 16:55:32 2014 +0000

    glamor: Enable Xv support
    
    In addition to the UXA texture paths (which in theory support VSync) and
    direct overlay support, create a textured video paths that utilize the
    glamor acceleration code.
    
    Requested-by: Fabio Pedretti <fabio.ped@libero.it>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74311
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f2e199b6b4ce86ba3922f9f2dea5f6cba053453
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 17:59:30 2014 +0000

    2.99.908 snapshot

commit 1f9a6156e9240a1efa8785ab5bca0a3b1757d08e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 20:02:44 2014 +0000

    sna: remove short-circuit for move-to-CPU when damage covers region
    
    The short-circuit path missed translating the damage from drawable space
    into the pixmap (for Composite setups) which may have resulted in
    corruption. The path was also failing to consider the impact of reusing
    an active CPU bo when it could be discarding the unwanted damage and
    reallocating.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 539b749416b275d84e05e2a5b62d946903aa3d29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 18:02:51 2014 +0000

    sna: Use 24bpp rendering by default for gen2 again
    
    Too many users where unhappy that their software was broken. Too bad the
    same software is also broken at high bit depths as well.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73877
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bdb1a62ce21f3eb5e27e411b78f13ad2aea963a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 16:42:46 2014 +0000

    sna: Balance memory accounting for buffer objects
    
    A couple bugs ended up with CPU bo gradually accumulating whilst the
    overall number of bo vanished.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f934ee78a000815e14e36bd0caa279cb35d07bfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 15:39:23 2014 +0000

    sna: Reorder assignments vs DBG
    
    It helps reading the debug log if what we print is correct.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bdbb928ea38977bd2784f454f35db2ac2c13c34c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 15:03:43 2014 +0000

    sna: Actually reuse pixmap headers for ordinary pixmaps
    
    commit 3dbf17f00e200e864818b0b8ca762183cff9085f [2.99.907]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Dec 3 12:10:01 2013 +0000
    
        sna: Mark up an ordinary pixmap for reuse
    
    started to put the frequently allocated pixmaps into the object cache -
    but as those frequent allocations themselves did not use the cache, the
    cache kept growing.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1272338
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfac4650e621055c5504c1bcf6df6449afa6d8d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 14:28:56 2014 +0000

    sna: Tidy up pixmap header allocations
    
    Refactor some more of the common code, and add some debug tracking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 098a1163e9730b428351fa54e8765261f5350d21
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 31 14:10:36 2014 +0000

    sna: Show the memory debug info again
    
    This needs to be visible whenever we --enable-debug=memory. Make it so,
    and trim it to a single line in the process.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 166e8e9e5d79f64e30230d9520b9f6cafa7dd0d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 30 12:19:04 2014 +0000

    sna: Silence a compiler warning for mismatching const strings
    
    sna_display.c: In function 'preferred_mode':
    sna_display.c:3393:7: warning: assignment discards 'const' qualifier from pointer target type [enabled by default]
      mode = xf86GetOptValString(output->options, OPTION_PREFERRED_MODE);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca2d9e69d08f5438a34dbf55ab058f5c4c3b3650
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 30 12:18:05 2014 +0000

    sna: Suppress warning for freeing a "constant" string
    
    We allocated and own the string, so we can free it!
    
    sna_display.c: In function 'sna_output_get_modes':
    sna_display.c:2314:4: warning: passing argument 1 of 'free' discards 'const' qualifier from pointer target type [enabled by default]
        free(current->name);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ef675159fd83ee393a86220eb4f8c514da8d0e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 30 12:17:02 2014 +0000

    sna: Handle char *backlight_iface
    
    The backlight_iface is a freeable string, in places we were assigning a
    constant string and later freeing it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76e430e92c19ea799547e4e6ae1f389ebc6eaac5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 30 12:13:16 2014 +0000

    sna: Constify GCFunc to quieten the compiler.
    
    We keep a pointer to the old funcs when wrapping, this now needs to be const.
    
    sna_accel.c: In function 'sna_gc_move_to_cpu':
    sna_accel.c:4008:17: warning: assignment discards 'const' qualifier from pointer target type [enabled by default]
      sgc->old_funcs = gc->funcs;
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57445e57d4dfc080620ff0e4f9ec9a63b0feb355
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 16:48:21 2014 +0000

    sna: Fix format specifier typo ('%D') in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 139fc76260ebeb4f4cc04c56b9ebf7f70bed660d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 13:42:50 2014 +0000

    sna: Always clear the domain even only a potential sync
    
    It helps to keep the domain-tracking bookkeeping consistent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d70620d9789da1cf983dac318d9ca9149f11ff20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 13:39:20 2014 +0000

    sna: We can only retire a bo if is not referenced by the current batch
    
    Fixes regression from
    commit 8b0ebebcab21647348f769c25ca0c1d81d169e75
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jan 28 16:30:47 2014 +0000
    
        sna: Be a little more assertive in retiring after set-domain
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74176
    Reported-by: Jan Alexander Steffens <jan.steffens@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 971a5e64f574f09ef43bcca9e0bd02cb0e42aa03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 13:15:43 2014 +0000

    sna: Add assertions for set/get binding
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7df3da10e744d7f168ea3f30b21c434f99beae17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 13:06:08 2014 +0000

    sna/gen4+: Assert that the cached binding location is valid
    
    We can at least check that it is in the right region (i.e. not past
    where the current surface has been allocated from).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=74176
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 001dd080e15157961188c96718669dd1b4d6b939
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 11:15:45 2014 +0000

    sna: Do not use color corrected pixel values for comparing against gc
    
    Dashed zero-width lines devolve into two passes (first to draw the
    foreground dashes, and then to draw the gaps). The code was using the
    pixel value to decide which phase was being drawn -- however the color
    on the gc is not always bit exact (e.g. alpha channel) with the pixel
    value. As a result, we would oft miss drawing anything when rendering
    into the scanout.
    
    Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1059152
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 872468a059e164235527d1501940b2740d3da2ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 05:40:00 2014 +0000

    sna/gen6+: Encourage inplace uploads for Composite
    
    First try using the blt path for a potential inplace upload for a
    simple composite operation copying from a ShmPixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b73a0ea22b43807c0118f4d7e9dcac3f0626463
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 29 05:32:25 2014 +0000

    sna: Skip undamaged TearFree redisplays
    
    If we have not had cause to flush the wait_for_shadow buffer during the
    course of the rendering, then we never wrote to the backbuffer and its
    contents are still identical to the current frontbuffer. So if the
    wait_for_shadow is still flagged as required on the scanout, we know we
    can safely discard the redisplay request.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70905
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f3fc9ec49f0caf53344577896ef9b6468cd3d4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 28 21:56:23 2014 +0000

    Allow selection of glamor as the default acceleration method
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=74162
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2425f03432de9bedeeda14ddbc5742cf7ce22874
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 28 19:17:14 2014 +0000

    sna: Check for a hang after a spurious error return from set-domain-ioctl
    
    set-domain-ioctl should only ever fail for invalid user input, beyond
    the normal signal handling. As such if we do find a spurious error
    return from the kernel, check for a GPU hang.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b0ebebcab21647348f769c25ca0c1d81d169e75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 28 16:30:47 2014 +0000

    sna: Be a little more assertive in retiring after set-domain
    
    After a successful set-domain for writing with the CPU, we know that the
    buffer is idle so remove it from our request tracking. (External clients
    complicate matters in that they may keep the bo active even after our
    set-domain.) On the contrary, because of read-read optimisations a bo
    may still be active after a set-domain for reading by the CPU, in which
    we need to remain conservative in retiring the bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b99c8cbefdd8fec686ad81fbffebb70d43880779
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 28 12:51:00 2014 +0000

    sna: Cancel the backlight change if set-property(DPMS) fails
    
    If the kernel reports an error from setting the DPMS property, we need
    to undo the local changes and propagate back the error to the caller.
    Although the latter is prevented by the RandR API, we can at least
    restore the backlight.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47effa1854e331643302146db238e6b092de8a9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 27 21:48:33 2014 +0000

    sna: Rearrange damage allocation to handle malloc failure more gracefully
    
    If we fail to allocate new damage boxes, first try collescing the
    existing boxes to free up memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad7daf9aae487af13c0578de95652675d4d2ed7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 27 21:20:40 2014 +0000

    sna: Use signal-safe DBG
    
    Otherwise we end up confusing the core Xserver functions when called
    from auxilliary threads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 294180b3bf78f2c0ae2f1197e1c0819d99009356
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 24 14:21:44 2014 +0000

    sna/gen3+: Allow for spill when aligning vertices
    
    We need to flush the batch if we run out of space aligning our vertex
    buffer - but the test must anticipate the space required for the new
    alignment.
    
    Reported-by: Arkadiusz Miskiewicz
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4385724dc49dd090e0a5956e287f80b92ebd70e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 24 11:29:26 2014 +0000

    sna/gen2+: Inspect composite flags to discard unneeded CPU damage
    
    We can now check whether the Composite operation will require existing
    CPU damage and if not discard it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9e9c85fc7b21e231c2532fe1c75b92307e112ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 23 19:04:27 2014 +0000

    sna/gen2,3: Don't set BLT_DST_TILED
    
    This bit only exists for gen4+ so avoid setting it on gen2 and gen3,
    whilst setting it doesn't seem to cause any harm, there is no reason to
    risk it...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6914b3af7f26c7b61e4ee6ea3a6ccda5011fa4da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 23 16:30:07 2014 +0000

    sna: Protect against fake CRTCs during initial probe
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73981
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e916c922ce3913712cd8a9b76ab037840b7f07f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 23 17:30:29 2014 +0000

    sna: Avoid erroneous discarding operations for partial composites
    
    Composite operations were presumed to cover their entire width x height
    area. However, a few paths submit boxes that do not cover the clip
    region and so the optimisation made during prepare to discard completely
    overwritten data is incorrect (and leads to corruption - stale data is
    seen which the client expected to have been overdrawn). So along these
    more unusual paths, we must add a flag to prevent the overzealous
    discard. Notably, xfce4 triggers this as it uses a lot of unantialiased
    trapezoids in its theme drawing.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=69528
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59e769e1b1eede466482a950b242ce81c52b276b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 23 12:57:48 2014 +0000

    glamor: Don't require the glamoregl module to be pre-loaded with xserver >= 1.15
    
    Inspired by (ok, copied from):
    
    xf86-video-ati commit f2a0a5cf6c5a21e2a02280e110a4eb8e6609dace
    Author: Michel Dänzer <michel.daenzer@amd.com>
    Date:   Wed Jan 22 11:04:42 2014 +0900
    
        Don't require the glamoregl module to be pre-loaded with xserver >= 1.15
    
        The issues with loading it on demand have been fixed in xserver 1.15.
    
        Inspired by Jérôme Glisse on IRC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32010ed86bb8f28d3b02e1e54a592d79b92b2b98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 22 16:26:14 2014 +0000

    sna: Assert that the fill box is within bounds
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73811
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29e11e2e6f80f6485ed69ea72e09e8d9b31fd8e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 22:40:11 2014 +0000

    sna: Restore gc->serialNumber correctly after falling back
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73856
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c441079cbd52902d356b652659e2be84726940e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 10:17:03 2014 +0000

    sna: Initialise the TearFree shadow output from the current front buffer
    
    Otherwise we may end up in a sitation where we show stale contents for a
    (sometimes signification) fraction of a second before it is refreshed
    with the correct contents.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73842
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac22dd4292841e27bb6147cf1aa7867f36bb2118
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 17 14:33:26 2014 +0000

    sna/gen4: Add an ALWAYS_FLUSH debugging option
    
    Still gen4 is cursed. This should restore the plateau we reached with
    2.99.907 by forcing a full GPU flush between every operation.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 720d131963b5c4d8f9e63c8852dbc133544ad312
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 10:35:30 2014 +0000

    sna: Drop bogus assert added in recent patches
    
    The intention was to detect if the gc->pCompositeClip still pointed to
    the temporary region. However, the assert failed to accomplish that
    goal.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36b743aa8e246c7361436d93a41a1f844c168a7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 10:00:07 2014 +0000

    sna: Reduce zeal of new gc->pCompositeClip
    
    gc->pCompositeClip starts off NULL, just like sna_gc->priv.
    
    Reported-by: Arkadiusz Miskiewicz
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a757eaa0903139183d16c3437bf86d58e62145e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 09:25:45 2014 +0000

    sna: Fix typo in assertion from previous commit
    
    Sigh. It helps to remember to do compile testing with the right
    configuration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9ebb016833df5b70336c66993a871e850fd0f61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 21 09:05:54 2014 +0000

    sna: More assertions for tracking gc->pCompositeClip
    
    Tracking down who leaves it modified...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7121bf733e9b02248fa0b7bb62a902622dd8f10
Author: Mark Kettenis <mark.kettenis@xs4all.nl>
Date:   Mon Jan 20 22:33:16 2014 +0000

    sna: build fix for OpenBSD
    
    Commit 50a45a1cdd4d8319ba9358974d241069689591c5 introduced the use of
    "struct stat" but doesn't include <sys/stat.h>.  Presumably that leaks
    in trough some other header on Linux, but on OpenBSD compilation fails
    because the struct isn't known.

commit 50f6701aa5ce8be96e216a942880a8db967c7a6a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 20:47:15 2014 +0000

    sna: Include serial numbers in ValidateGC DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c7b183fd21b461f9f18662c3b9d9732b6bef13d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 14:35:55 2014 +0000

    sna: Short-cut the fallback for XCopyArea with depth < 8
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 671658499bf432666a96b31ac96d2c66e2168c4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 14:35:35 2014 +0000

    sna: Add some more DBG output around the clipping in sna_do_copy()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55a933aa29434f23674c851f02dce0ce983a0730
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 13:29:22 2014 +0000

    intel-virtual-output: Tidy some DBG for copying new modes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04ee452439d14e2f8941e989823cb81fb62858e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 12:19:25 2014 +0000

    sna: Increase limit on number of possible outputs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 637e7c2186ccde65bed74dfd28f53a2a808e4101
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 12:33:19 2014 +0000

    intel-virtual-output: Print error events for debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92e9bf82b22ca59ac0009a6a4a641a1056c34bf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 12:25:34 2014 +0000

    intel-virtual-output: Disable remote display if SetCrtcConfig fails
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3138d06893b3380473cfab60ee19e80cb3b61192
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 10:38:23 2014 +0000

    intel-virtual-output: Clone modes onto remote display
    
    If the user adds a mode to the VIRTUAL display and then attempts to use
    it, add that mode to the remote display.
    
    Reported-by: Christoph Bessei <admin@schwarzwald-falke.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73816
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de0797edac67e00b720dcc99d70b8e0f033a90b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 20 09:32:50 2014 +0000

    sna: Yield the processor if the kernel reports EAGAIN
    
    An artifact of our kernel/userspace interaction is that under certain
    circumstances the kernel will report EAGAIN in order for it to have CPU
    time to run its own workqueues before it can process the userspace
    request. We can be cooperative and yield ourselves rather than busy-spin
    waiting for the scheduler to demote us.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50a45a1cdd4d8319ba9358974d241069689591c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 19 15:59:42 2014 +0000

    sna: Use device minor to narrow search for debugfs files
    
    Also vital in case we ever have two Intel GPUs!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d41bbfc97c46b01227f193d7e938390691a8b581
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 19 15:18:44 2014 +0000

    sna: Always emit an error message when an execbuffer fails
    
    So that we are not left with a puzzled user with a mysteriously slow
    machine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7f753ba89c928f141f1feb750733f53130c3bfb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 19 12:52:20 2014 +0000

    sna: Discard pending wait_for_shadow updates before the TearFree flip
    
    Rather than just assert that we have used the pending update in
    wait_for_shadow, discard it first.
    
    Reported-by: Joe Peterson <joe@wildlava.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70905
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 498fcb001358af8f15bd129f8d1edf2530edf412
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 18 22:38:40 2014 +0000

    sna: Refactor common routines for debugfs file dumping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b68c35a11da849a2680ba77bf565038fd8f30dd0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 18 22:21:35 2014 +0000

    sna: Fix typo in debugfs paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9342bc3dfd64b338c0802793f311574323067652
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 18 21:38:59 2014 +0000

    sna: Dump fence registers upon starvation
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73696
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35ea7b2dd5904d5d8f7c355368c82bb12f1b83a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 17 12:55:33 2014 +0000

    intel: Silence a compiler warning (-Wshadow)
    
    intel_device.c: In function 'intel_entity_get_devid':
    intel_device.c:82:32: warning: declaration of 'index' shadows a global declaration [-Wshadow]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f23ab963c4f4ada2051588dfc85264aa2798dbf7
Author: Rinat <ibragimovrinat@mail.ru>
Date:   Fri Jan 17 10:47:44 2014 +0000

    Provide DRI2DriverVDPAU for future compatibility
    
    Since 2010, DRI2 supports multiple driver names. That was added to ease
    selection of appropriate driver by libvdpau. As for today, intel driver
    support only DRI2DriverDRI (== 0), but not DRI2DriverVDPAU (== 1).
    
    Although there is no any hardware-specific VDPAU driver for intel video
    adapters at the moment, it would be easier to use generic drivers like
    libvdpau-va-gl by creating symlink named libvdpau_i965.so.1. That way
    appropriate driver will be selected in run time automatically:
    libvdpau_i965.so.1 on i965 equipped machines, and libvdpau_nvidia.so.1
    on nvidia equipped ones.
    
    [ickle: Whilst I think this is a workaround for a brainfart in libvdpau
    that it defaults to libvdpau_nvidia.so rather than first to
    libdvpau_${DRI2DriverDRI} and then to a hardcoded libvdpau_backend.so,
    I have no better solution, and this does seem in accordance with the
    spec.]
    
    Signed-off-by: Rinat <ibragimovrinat@mail.ru>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73507

commit 5f3ee21a307a4ff4db189bd53e58a70ec01ee6bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 17 08:40:34 2014 +0000

    sna: Nullify pixmap->devPrivate.ptr after promoting CPU bo to GPU
    
    When we convert a CPU bo into a GPU bo, we need to remove any dangling
    shadow pointers we use for devPrivate.ptr. Whilst the bo remains alive
    these are incoherent, but if we ever replace the GPU bo (for example to
    change tiling for DRI2) then the dangling pointer becomes invalid and
    will explode on next use.
    
    Reported-by: Mike Aury <mike.auty@gmail.com>
    Reported-by:  Marti Raudsepp <marti@juffo.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73351
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34192006c65640327bc81e2765f5ef5db3c539e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 17 09:02:55 2014 +0000

    sna: Intensify the move-to-cpu pointer paranoia
    
    Rather than just state that the final pixmap->devPrivate.ptr is
    non-NULL, we can assert that it matches the shadow value.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cea442c0d0d7f1ef95d9d8048668eecbdcbc9a4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 16 22:37:41 2014 +0000

    sna: Cull the DBG spew to stderr
    
    Reduce the logging verbosity of DBG so that it only appears in the
    logfile by default - makes debugging much more pleasant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6db99169a99393a8a669f89682bb8df13a7c5677
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 16 11:20:30 2014 +0000

    sna: Regularly check that the devPrivate.ptr is valid
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 242d7503ddd98c59feda4bcc25e70cac06d3325e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 16 11:08:05 2014 +0000

    sna: Avoid allocating temporary storage for TearFree rotations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 587452a6ad7ac57e37820c72220c4944451315a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 16 10:27:50 2014 +0000

    sna: Make the temporary upload pixmap as having a statically allocated pointer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40beee995e71b1fa4cd146a986f53e03595a4378
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 15 10:07:32 2014 +0000

    sna: Add some more paranoia around dangling pointers
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73351
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a0a1329391cc7d3047fea4b3d968afc7c6099b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 10 21:08:28 2014 +0000

    sna: Handle release of active stolen scanouts
    
    If the scanout is still active we want to defer our release until the
    request is retired.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b351f4a0009ce0eddb5866bd49ac59860a44f522
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 10 12:01:29 2014 +0000

    sna/dri: Handle TearFree vblanks whilst the pipe is off
    
    As an extra complication for handling TearFree is that if we attempt to
    requeue a swap whilst the pipe is off, that fails. As we have recursed
    from the pixmap migration path, we have to abort the blit but still send
    the event back to the client so that they unblock.
    
    Reported-by: Harald Judt <h.judt@gmx.at>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73469
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1694c8ea5c0f2ce1ded2ab25aecfde80da16346
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 9 15:53:42 2014 +0000

    sna: Include the deferred hotplug uevent propagation in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfabdb7ebf5e491da1e74f8b362f9c2f0b6f1ac5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 9 12:34:58 2014 +0000

    sna: Add regular refcnt checks on pixmap bo
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=73406
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2fc9e5f86096dbc2461eaf7e5ad5cf071f8d472
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 8 11:08:47 2014 +0000

    Revert "sna: Remove spurious SAMPLER writemask for gen4"
    
    This reverts commit 4966f8374a068ca2a533e30594bfd333551ffd37.
    
    Not so spurious after all!
    
    Reported-by: Michal Suchanek
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b858c28d04dfd353a99f9d15c39599adbf5cb25f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 7 14:42:41 2014 +0000

    sna/gen4: Tidy URB_FENCE command
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7565a26401e283df94b68019e8093f8104428f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 7 14:05:09 2014 +0000

    sna/gen4: Use PIPE_CONTROL for a smaller hammer
    
    Using MI_FLUSH to break up primitive is overkill when a top-of-pipe
    PIPE_CONTROL will suffice.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d8473c5d9489db439aca73f470bda29a22ebab6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 7 13:43:35 2014 +0000

    sna/gen4: Check for available batch space before restoring state after CA pass
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73348
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b177a5e972a8eed63f99b0cd7b048a1229683f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 20 14:22:05 2013 +0000

    sna/gen4: Reduce flushes between primitive continuations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4966f8374a068ca2a533e30594bfd333551ffd37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 20 14:20:54 2013 +0000

    sna: Remove spurious SAMPLER writemask for gen4
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82fa7ec352426c7e3d5210aac8ea1030232cc0f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 6 14:30:56 2014 +0000

    uxa: Always treat DPMSModeSuspend/Standby similar to DPMSModeOff
    
    As we assume that Suspend, Standby alias to Off and disable the crtc
    when switching to any mode other than On, we need to also perform the
    backlight updates for Suspend,Standby prior to passing the DPMS value
    onto the kernel.
    
    Suggested-by: Alexander Monakov <amonakov@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28a057105b6974803aee0d68c2a71f322095dfde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 6 14:37:09 2014 +0000

    uxa: Disable updating properties upon reading their values
    
    Backport commit e76b08cad2770015346fd4cd757de3bb3b6ff37c
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Oct 15 12:46:09 2013 +0100
    
        sna: Disable updating properties upon reading their values
    
    in order to prevent random screen blanking upon return from DPMS.
    
    Reported-by: Alexander Monakov <amonakov@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73181
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0138b38dfcd933d080f86cfd33664eeb3f5558a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 6 14:30:56 2014 +0000

    sna: Always treat DPMSModeSuspend/Standby similar to DPMSModeOff
    
    As we assume that Suspend, Standby alias to Off and disable the crtc
    when switching to any mode other than On, we need to also perform the
    backlight updates for Suspend,Standby prior to passing the DPMS value
    onto the kernel.
    
    Suggested-by: Alexander Monakov <amonakov@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28810d5b367942c96acbc696f27105259422a0d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 6 14:26:38 2014 +0000

    uxa/dri: Pixmap are offscreen and not attached to any display
    
    As the code current assumes that pixmaps are located at screen origin
    (0,0), it assumes that they are all on the first CRTC. However, since
    they are offscreen, this leads to such complications as attempting to
    emit vsync swapbuffers, and even worse attempting to swap a GLXPixmap
    onto the scanout following a DRI2SwapBuffers.
    
    Reported-by: Alexander Monakov <amonakov@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73282
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d8f78bc95f8dd36693f74365dbc3c442fbbf8a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 2 15:01:38 2014 +0000

    sna/gen7+: Emit invalidate between operations if rendering to source/mask
    
    Fixes regression from
    commit c79cb18407273dc7798618390bd0b7d69b0f80d6 [2.99.907]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Nov 20 11:17:20 2013 +0000
    
        sna/gen7: Try to reduce flushes between primitive continuations
    
    Reported-by: Simon Munton <simon.j.munton@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=73208
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4b88d602640b3e2e46c61928ab194dc9f6b390d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 18 10:33:52 2013 +0000

    2.99.907 snapshot

commit 9289e2c56b7f0cc78c5123691ad96611f0e04bed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 16 11:39:20 2013 +0000

    sna/gen4: Sacrifice performance to workaround render corruption
    
    The long running saga of trying to find an acceptable workaround for the
    gen4 rendering corruption (seems to be a read-write hazard failure inside
    the gpu) is failing, the only w/a found so far is to send a single
    rectangle through the GPU at a time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 660fbdac8da1f43749007f126201681023a677e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 15 10:41:22 2013 +0000

    sna: Remove stale assertion
    
    Now that we do not remove the move-to-gpu for a plain read from the
    TearFree buffer, it is viable to use that buffer as source for cloning.
    So we need to kill the stale assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 989198f3ddc763000702bd1eaeb54002e18a8f04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 15 09:45:24 2013 +0000

    intel-virtual-output: Disable build if timerfd is not present
    
    Otherwise the build breaks on *BSD.
    
    Reported-by: Yuta SATOH <nigoro.gentoo@0x100.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72707
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8e339edd31859820907115c8d618b0fec3ef227
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 15 09:39:54 2013 +0000

    sna: Avoid recursive out-of-order operations in the middle of TearFree
    
    During TearFree, if we have to wait for the shadow flip to complete, we
    run the event handler for the device. This can then cause us to evaluate
    pending completed vblank events, which may in turn then attempt to use
    the shadow bo and recurse into the TearFree handler. Try to prevent this
    and requeue the vblank event.
    
    Reported-by: Pascal de Bruijn <pmjdebruijn@pcode.nl>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72690
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f350a1369b3bd39ba0db8639f036864fe5df2f98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 12 16:49:02 2013 +0000

    sna/gen4+: Drop new assertion that we only finish a vbo after use in this batch
    
    A full vbo might not be discarded and so upon first use in the following
    batch we decided to finish the old vbo and allocate a new. This can
    happen before we even emit any relocations and so the assert is bogus.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c62925ba7f18f55ee34b946bddba84a07b83985
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 11 21:30:06 2013 +0000

    sna: Remove unused variable
    
    sna_display.c: In function 'sna_crtc_redisplay__fallback':
    sna_display.c:4104:19: warning: unused variable 'sna_crtc' [-Wunused-variable]
      struct sna_crtc *sna_crtc = to_sna_crtc(crtc);
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e76f21a4d9d8f5424c257e6e7686d5bb0bb6cf7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 18:56:03 2013 +0100

    intel: Recognise gen8
    
    Assign gen=8 to the Broadwell PCI IDs, no marketing names are known at
    this point in time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7d1c2b8d1883280e7916bb4473ff6436b186950
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 23 08:17:58 2013 +0100

    sna: Enable scanline waits for Broadwell
    
    Broadwell uses the same mechanism as Haswell for vsync.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e017542d10e875260e3eef1b0369f4ea106df0f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 22:11:32 2012 +0000

    sna/gen8: Initial backend for Broadwell
    
    Should match the functionality of the earlier generations, but untuned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 610af0c70e755062b36ba9756fbc4288518b7c35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 11:50:52 2013 +0000

    Update i915_pciids.h
    
    Pulling in changes from:
    
    kernel commit 4d4dead67a4ab1d5de393f15ed5e4e2aa63d3bcf
    Author: Ben Widawsky <benjamin.widawsky@intel.com>
    Date:   Sun Nov 3 16:47:33 2013 -0800
    
        drm/i915/bdw: Add device IDs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 628b68f3a07ee619642521e0992eee81b9edd76f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 10 10:25:56 2013 +0000

    sna/gen2,3: Replace stale bo replacement with simple asserts
    
    The surface creation routines should ensure that the minimum pitch
    alignments are met. However, when rendering to a CPU bo, the pitch is
    not under our control so we need to be more careful.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c91ec29807e96682c2e752744b60c06bf3f02d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 10 12:37:44 2013 +0000

    sna: Set minimum pitch alignment to 8 bytes
    
    This prevents render corruption on gen3 and should not adversely affect
    BLT pitch requirements or other GPUs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ade25f4f95994b565a8ed8eb3811ff7453a8b0e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 9 10:49:56 2013 +0000

    sna: Only discard READ hint for TearFree copy iff it subsumes the pixmap
    
    Remembering that the target window may be smaller than its backing
    pixmap.
    
    Reported-by: Andreas Klauer <Andreas.Klauer@metamorpher.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72430
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a66db75bf370549f438796433f3e3fb5f7f0b2a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 9 10:32:05 2013 +0000

    sna: Fallback gracefully when redisplaying after a GPU hang
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf89fb8b731dd541bde16277c52264ba1e150424
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 8 16:35:27 2013 +0000

    sna: Simplify kgem_bo_can_map()
    
    Remove the attempt to trick us into mapping large bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46256fa5a0ca4230ae7c226781c78c525e2648c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 5 16:12:22 2013 +0000

    sna: Pass MOVE_READ for partial TearFree move-to-gpu
    
    When fixing up a pending shadow pageflip for TearFree, we must tell it
    that it needs to flush the damage for a partial move-to-gpu. Even though
    the current area does not read from the destination, the move-to-gpu
    callback is a global pass, and we need to assume the worst for the
    region outside of the target.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72343
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 693c1343ed29d8779ce3ad5c0e80fbe6d7d0689f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 5 11:09:39 2013 +0000

    sna: OsRegisterSigWrapper was only introduced in 1.6.99.900
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba9a173d81514152cd1dac4f1df765be11a478ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 5 11:06:59 2013 +0000

    configure: Correct closing ']'
    
    Too many closed, too few opened.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 845b03ac110c22cff8b2653e76f6d974a628b776
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 5 11:00:44 2013 +0000

    sna: Compilation fixes for squeeze
    
    Older version of glibc and valgrind require a slight massage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd22abee8f33b20ff6bc7297b0a9ae8708d18727
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 7 22:27:50 2013 +0000

    sna: Update Baytrail VSync logic
    
    My current best guess at the glaring hole in the spec that is
    synchronisation to vertical refresh.
    
    Note that this leaves VSync disabled for BYT for now as it is
    ineffective - but at least it now doesn't hang!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=69869
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c37ab3ddc5910fdf4ed663a8dc620edc9fec931
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 4 11:55:54 2013 +0000

    sna: Print detected GPU first
    
    This should make the GPU identification easier to find in future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 255025d8d342610ddc75f510ea795bf8785f1578
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 4 11:06:08 2013 +0000

    intel: Tidy up driver identification string
    
    Split the identification strings between the older integrated graphic
    chipsets and the more recent integrated processor graphics. This helps
    to emphasis the recent branding and should reduce confusion about which
    processors are supported by the driver.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23f8802857d64212dc8df39da2c1f6f362f9d053
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 15:06:10 2013 +0000

    sna/dri: Always clear the clear hint after pageflipping
    
    commit 3fd116782bb1c05a140f4783e92a8ee6a57143cd
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Sep 23 21:03:07 2013 +0100
    
        sna/dri: Clear the clear hint upon applying DRI damage
    
    missed the short-circuit path for an already all-damaged pixmap - which
    is quite common for the clear pixmaps...
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72194
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0420adfb9d92b691aabef4e0ccba3782417b4bf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 12:10:23 2013 +0000

    sna/gen2,3: Unmap the old GPU bo when replacing due to render target constaints
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dbf17f00e200e864818b0b8ca762183cff9085f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 12:10:01 2013 +0000

    sna: Mark up an ordinary pixmap for reuse
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a353ed151d175a757af6f8d5216bf2370dd3917
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 11:14:53 2013 +0000

    sna: More assertions around tracking mapped state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4274110b78f8962b921f773e67c981b033c3f664
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 11:03:39 2013 +0000

    sna: Clear the clear hint after performing a userptr upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33f3ddd73da5f553accf78ce7e03a76b12f71393
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 3 09:37:37 2013 +0000

    sna: Include Pineview in fence over-allocation checks
    
    When creating the object, we need to take account that fenced regions
    in the aperture are in power-of-two sizes and so can be much larger than
    the actual object. This includes Pineview, which although is more
    relaxed with regards to fence alignment of GPU operations, still imposes
    the same restrictions on the fence registers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a8478dae681212bd7a86640f90e6d47c9393b1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 2 15:48:50 2013 +0000

    sna: Fix stipple offset for drawing into child windows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32b942d0ff4f1d389ac643bfe6b18029d266dc13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 2 10:43:51 2013 +0000

    tests: Exercise stippled fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 463ab7f4faf46f6530423b6b10f2cd1bb6d0aa83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 2 11:08:05 2013 +0000

    sna: Fix tile origin for pattern blits
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=71260
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6889ba38ab2bb050dec3057dbc584619dbe6d2e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 2 14:20:51 2013 +0000

    sna: Drop forced alignment to 64 on pre-gen4 devices
    
    Some linear GPU bo that we create must be naturally aligned, and the
    extra alignment imposed for pure paranoia is counter productive.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49af22ee5533b1afbf30f50fcfd7245f1c8d98bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 2 10:43:51 2013 +0000

    tests: Exercise tiled fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dae8b97151f1d08942ec690dac5a5008901d7d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 29 14:46:54 2013 +0000

    sna: Dump GTT info if we fail to execute a batch due to ENOSPC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2497fc332eafe31a0156ac5f66ec98f77ce0f647
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 22:03:39 2013 +0000

    sna: Fix typo inside DBG message
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd007d9d465b9b3ddbbaf769931ec921a6f5ecb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 21:13:33 2013 +0000

    sna/video: Correct handling of cropped images along packed fast path
    
    In particular, it was offseting the read from the source image, but not
    correcting the length to read - causing a read from beyond the end of
    the source and a segfault.
    
    Reported-by: Jan Engelhardt <jengelh@inai.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b85051ae480499dd8a6a6d07d5ce0feca7b844b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 16:25:52 2013 +0000

    sna: Fallback from partial to full move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit faedf266d7b476954574db2cb1274e677cf42bf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 14:12:56 2013 +0000

    sna: Tidy up an assertion on an uninitialised variable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e382c6ece84f3040b21980a303fe00be667c4e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 14:02:18 2013 +0000

    sna: Harden GetImage for use with very large buffers
    
    That risk causing SIGBUS due to oom.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 569b06abeae9b3dcaa611facdd3ec30c67de765b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 13:14:27 2013 +0000

    sna: Wrap glyph composition with sigtrap handling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 974abd0c3acca7d3b782251d562bf00fd34b395d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 13:03:54 2013 +0000

    sna: Prefer using userptr for PutImage into large GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64f1fbb465bdd092c4ea4aafe10382ebe7b84ecb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 13:03:29 2013 +0000

    sna: Tidy a split conditional in an picture upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1200aae4815cdbc6a4f242c264b2736e6fe0fa12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 28 13:03:06 2013 +0000

    sna: Wrap image upload with sigtrap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fb7c366a58ec9b9cdc0b330e53716ab04b24c96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 27 22:06:27 2013 +0000

    sna: Add a few more refcnt asserts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d65b57cd332ca4435867afa31b6da85481635d52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 27 12:59:25 2013 +0000

    intel-virtual-output: Trim remote framebuffer to fit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd7c556072978822c1110346354acfa3362b012e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 27 12:57:09 2013 +0000

    intel-virtual-output: Workaround mutter always using the same timestamp
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1085e6c93288de2275791ce9c585142870dc0877
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 26 16:13:23 2013 +0000

    sna: Update connector-type-to-string mapping
    
    Add in a couple of newcomers to the connector type and make it easier to
    track updates in future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80d1dee70ba3bdf38e0dd68a39380f4f3d9f22b5
Author: Kirill Müller <kirill.mueller@ivt.baug.ethz.ch>
Date:   Tue Nov 26 11:36:54 2013 +0100

    intel-virtual-output: mute spurious warnings
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=72027

commit 36ac68bedd3b30d7bdf0f40b438b45a7c4dec9e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 26 09:41:42 2013 +0000

    intel-virtual-output: Clone remote EDID for virtual outputs
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=72020
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63a964d6d0cb0e4ffce70d8e1b672dd65fae6703
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 26 08:52:39 2013 +0000

    intel-virtual-output: Correct clip region of rotated outputs in source framebuffer
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71846
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13f3b24babba61e4d8b10661accc032169f04645
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 18:56:49 2013 +0000

    sna: Correct plurization of axis for modesetting log message
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5580df729f4d3b2498a6dae19dac938f06bf602d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 16:55:47 2013 +0000

    intel-virtual-output: Include transforms when computing required fb size
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71846
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ded23af3cdf68ab94446b8774d6bc4d52b21907a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 16:49:58 2013 +0000

    sna: Include reflections when logging mode changes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fa1b0a2c5e5d3e7f25bca5b79925a956253a24f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 16:13:45 2013 +0000

    intel-virtual-output: Tweak DBG messages for copying rotation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98efd7f5d94586f8d7c5b2e9c5515f4b37149b08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 15:33:13 2013 +0000

    sna: Log mode switches on virtual outputs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42f325a87c336211ebb3ebcafc9130eff10cee93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 11:14:15 2013 +0000

    sna: Keep @NOWARNFLAGS@ last
    
    As the last option overrides the earlier options, make sure these
    particular overrides always take effect by adding them last.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c4458e8a30920d065ca5db5d3ca3cc49454b869
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 10:01:00 2013 +0000

    sna/trapezoids: trapezoids_bounds() reports not-empty, so use it
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af4995d74bd3ee3ed8f17c7c04c8d3acaaecebc6
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:57:19 2013 +0000

    sna: Handle failure to disable old plane when switching CRTCs
    
    If we fail to disable the old plane, abort the PutImage and report the
    error.
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 00dcb4f22942b2d40253a7b43105e73e260216cf
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:35 2013 +0100

    uxa: fix order of inline Bool
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 175b8711f8c90e7977aec5564f5c29588fa14469
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:34 2013 +0100

    uxa,legacy: use unsigned for comparition of unsigned
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 7b235c92bbc6c7306ffef8caac5f07448c78d956
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:32 2013 +0100

    sna: Add missing va_end
    
    Put va_end() into error paths
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 318f100d7337955c099fecb86d206c406779fafe
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:31 2013 +0100

    uxa: Avoid relying on an assert and cleanup iterator
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit a110637ef2a37505ee68447cf66763af4cabfc00
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:30 2013 +0100

    Fix indentation for incorrectly shifted statements
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit b419691e277af0881baa7daac17af424dc1337b1
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:29 2013 +0100

    uxa: rename some local variable to not shadow global ones
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 6f066b6714df850c5ea42dbde2296803c5b06da0
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:28 2013 +0100

    uxa: Ensure mask_picture is defined
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit ea18b7780e7d0d7fcd36b656a4fd974fb9d7137d
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:27 2013 +0100

    Cast to use unsigned math
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 34057611c67b751c43d6bd70a7d5993708262cd2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 25 09:36:32 2013 +0000

    Correct type of uevent_handler
    
    xf86AddGeneralHandler returns an opaque pointer, not a function pointer.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2df10e28fa35d29b539dc52c61f710910b75831
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:25 2013 +0100

    Remove uneeded headers
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 41be7e9d490633a65aa1e0c9f76acfb67869288f
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:24 2013 +0100

    config apostrophe
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 2275ef581ee1a1c45a45df40f952779f62fb53ed
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Mon Nov 25 09:09:20 2013 +0100

    Makefile convert @var@ to $(var)
    
    Avoid using @var@ since this could not be easily overwritten through
    'make var=xxx' option which is normally available.
    For Makefile.am users should avoid using @var@.
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>

commit 12e974c7bc8c85dbccd3d9ef91c1315e85bbeb6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 22 17:37:57 2013 +0000

    Revert "intel-virtual-output: Only track the most recent visibility status of the cursor"
    
    This reverts commit abf1a16914d993cc150005879375d4bb17fdccf3.
    
    We need to track visibility over all clones on a display, not just the
    last.
    
    Regression from
    commit abf1a16914d993cc150005879375d4bb17fdccf3 [2.99.906]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Nov 8 17:09:35 2013 +0000
    
        intel-virtual-output: Only track the most recent visibility status of the curso
    
    Reported-by: Kirill Müller <mail@kirill-mueller.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71838
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ee29c4ea3b05e9361635a2ef6e7b92c160d68cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 22 13:34:35 2013 +0000

    uxa,sna: Prevent bo exchange when pinned for non-DRI2 clients
    
    With the advent of DRI3 (and previously with Prime and Glamor) we have
    external clients who rely on the pixmap<->bo mapping being invariant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0021ab2a66fb7c84758ad482f47f023b862360b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 22 12:07:06 2013 +0000

    sna: Tidy up fallback from render composite to blt composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38ef572d68380db407039fe12d62426939030010
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 21 21:52:46 2013 +0000

    sna: XY_SETUP_* expects the dst tiling to be set on gen4+
    
    A few paths failed to set the tiling flag when setting up the BLT
    engine, leaving the engine in a potentially inconsistent state.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71260
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dee2db883954d9ce3560b81f84d5c805edfd3977
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 21 14:48:23 2013 +0000

    sna: Fix typo in sna_blt_fill_begin()
    
    Reported-by: intelgraphics7@gmx-topmail.de
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d9edc9a717cfc6fbdbe468f7e32a68ac674a207
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 20 18:50:40 2013 +0000

    sna: Set supported rotations on virtual outputs
    
    As the virtual outputs are created later, they do not get automatically
    populated with RR properties and we must do that instantiation
    ourselves.
    
    Reported-by: Kirill Müller <mail@kirill-mueller.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71846
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c79cb18407273dc7798618390bd0b7d69b0f80d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 20 11:17:20 2013 +0000

    sna/gen7: Try to reduce flushes between primitive continuations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b14228fafb654fe7d8f8783475aa0c0ba87e4fea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:15:24 2013 +0000

    intel-virtual-output: Check for failure to create a clone
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e6979b67afdd8122a29135d752c6ea84e9af6dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:13:26 2013 +0000

    intel-virtual-output: Fix trivial and unlikely fd leak from bumblebee failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ed5f83fe7ec71faf40147271aef1cf4a5a38329
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:09:35 2013 +0000

    sna: Fix use before assignment
    
    mono.sna was being used the line before it was assigned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9d6f897e6d6dc388de24f7b49ba79bf1f6125c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:03:33 2013 +0000

    sna: Free composite boxes in the unlikely all-invalid path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0782d4e57e4ba33aee30925ad276ee4a1ec15feb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:01:33 2013 +0000

    sna: Correct check for overwriting last BLT fill
    
    Typo crept in from the reloc rework.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31f559820dbde1a028a76b9eeaeb1848aec3cc2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 12:00:08 2013 +0000

    sna/gen4+: Clear redirect bo before falling back to BLT paths
    
    Just in case we later try to take action on the already freed
    redirection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb3ea102ca6b8aa843a10607fa140f5694cc4898
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 19 09:47:15 2013 +0000

    test: Fix compilation of render-trapezoid-image
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71768
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12f4c48d39b939a3a26a1504910b5f16ee6c86b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 18 16:59:08 2013 +0000

    sna/gen7: Rework random GPU flushing
    
    There seems to be no clear rationale for these flushes. They have been
    empirically derived to pass test/render-copyarea and rendercheck,
    without impacting upon a few simple benchmarks.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=68410
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04e4bae02c409853c95f43ba4b2b69e50940ec72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 18 14:16:07 2013 +0000

    sna: Tell valgrind about the returned mode list
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4194100691347ccec4b1863f3f62987d9286707b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 18 12:33:05 2013 +0000

    sna: Process Damage relative to dst->pDrawable not its pixmap->drawable
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=32734
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e99e643ed1f2856109426f791a7615ee122d7c42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 18 12:04:29 2013 +0000

    tests: Avoid dependence on undefined C
    
    Right-shifting by a negative value is undefined.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6924161108214b4e50c25f4168564ead4000430
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 18 11:58:43 2013 +0000

    sna/damage: Tidy up a tail return
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52612185c60605542beb3745a2500ed65a8ffff0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 15 21:20:30 2013 +0000

    sna/damage: Guard against integer overflow before malloc
    
    Check that the multiplication to compute the allocation will not
    overflow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95c3892dd3911ba44ae3170573de1153857b15a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 15 11:55:51 2013 +0000

    sna: Include valgrind leakchecks for --enable-debug=memory
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e9a8c5ae2883ca21d117ac672dd8a55b3429dc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 14 16:14:09 2013 +0000

    sna: Add the missing braces around the conditional block
    
    Fixes regression from
    commit f3225fcb38686f3b9701725bf3a11ecf1c100c3f
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Nov 5 08:38:22 2013 +0000
    
        sna: Be move conservative with tiling sizes for older fenced gen
    
    Reported-by: Jay Little <jaylittle@jaylittle.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71605
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23f47c8b4b4825b9219e1f515015635a7c48ec35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 14 10:17:49 2013 +0000

    tests: Exercise render copies under a mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa5a5684ebada60a1b103624a9b49aa085a406c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 16:25:54 2013 +0000

    sna/gen6+: Only substitute SRC for CLEAR if using the correct source
    
    If the source has not been verified to be clear, then using the SRC
    operator will paint the wrong color.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97e684ab3c887c1992733d0031f0256e9692d452
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 15:28:37 2013 +0000

    sna/gen6+: Improve debug PREFER_RENDER to cover all decision points
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7358ba83a3d4ab37459b4e510704bd0be4438dcd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 15:27:05 2013 +0000

    tests: Add render-composite-solid-mask
    
    Another reference test to exercise simple composite pathways clearly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f08f9cb28efa1b82f196695c66c3ec3a2b63361c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 14:17:51 2013 +0000

    sna: Eliminate a compiler warning for a shadowed variable
    
    sna_driver.c: In function 'sna_load_palette':
    sna_driver.c:86:12: warning: declaration of 'index' shadows a global declaration [-Wshadow]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 501dbf45cd85b0008e599637ad3ca76c044d39d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 14:17:51 2013 +0000

    sna: Eliminate a compiler warning for a shadowed variable
    
    We don't strictly need that local structure, so do without and keep the
    compiler quiet.
    
    sna_driver.c: In function 'fb_supports_depth':
    sna_driver.c:414:23: warning: declaration of 'close' shadows a global declaration [-Wshadow]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7468a6b740af14d95e8f9bacd2e352ec98a9acf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 12 14:43:28 2013 +0000

    2.99.906 snapshot

commit 220a8e8b1425d08af7ac104540be16611279e807
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 13 09:52:14 2013 +0000

    Bump experimental ioctl command numbers
    
    In the meantime a new ioctl has snuck in.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44c585a1d8c3b603a9c79bf7dfecf420575cfb61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 12 18:59:54 2013 +0000

    sna: Discard cached upload proxy when writing to the pixmap via the CPU
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20e318c292a4e1336093dfbc77cb44d099c80050
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 10 10:28:01 2013 +0000

    intel-virtual-output: Manually adjust screen size
    
    When we modify the outputs and end up with a different screen size, we
    need to actually tell the display to resize with an explicit
    XRRSetScreenSize.
    
    Reported-by: Jethro Beekman <freedesktop-bugs@jbeekman.nl>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71441
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04d2cad65dbb07a2f03835a71fb7f5efc0235ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 12 14:36:38 2013 +0000

    Add identification strings for new Atoms
    
    All of the new Atom (Baytrail) products ship with "HD Graphics".
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6bd3011710a3fd4cfe21a3d41a6ec9c929681bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 12 13:15:25 2013 +0000

    sna: Factor available memory into available aperture estimation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4493fb8d21fa013a074f7de66387e92ef23d191a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 12 00:05:11 2013 +0000

    sna: Apply drawable offset to glyph bbox prior to checking for clipping
    
    This is a correction to
    
    commit ec0866e86d365ae3fd9790b1b263d49fc4981220
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Oct 16 22:39:54 2013 +0100
    
        sna/glyphs: Fix computation of extents for long strings
    
    in order for us to correctly detect when we need to clip.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71191
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c489934ed732ed3d5a906939381c62a6bc1c38d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 14:56:22 2013 +0000

    xvmc: Handle allocation failure around batch submission
    
    If we fail to allocate a new batch, just stall and reuse the old one
    rather than crashing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e93449b5492a4fc09401c23f8754655b63959b5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 13:15:07 2013 +0000

    intel-virtual-output: Fix format specifiers for Visual DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31b5ff5889593337bf504dafa116a428bf1ffe9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 12:56:30 2013 +0000

    intel-virtual-output: Fix cut'n'paste DBG error
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29fcc15efabb5b1f7e1e0211da9714cf9e3cbd1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 11:44:17 2013 +0000

    sna: Assert that gc->funcs is never set to NULL
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=71415
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa140ef1e62c349936be5f153e4be7688e129e63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 11:38:46 2013 +0000

    sna: Add a couple more asserts to track a potential NULL gc->pCompositeClip
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=71415
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e81a9cbd68344450a6e82130edfef21dd04ec43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 11 10:47:24 2013 +0000

    intel-virtual-output: Avoid the infinite loop around XPending
    
    XPending() reports if there are any events pending and does not perform
    any dequeuing itself - ergo for a remote display while (XPending()) ;
    becomes an infinite loop should there be an event pending.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=71345
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 922a8bab89c1a5970db61670aaee21e827652bc2
Author: Rémi Cardona <remi@gentoo.org>
Date:   Fri Nov 8 20:14:59 2013 +0100

    configure: Use proper variables set by PKG_CHECK_MODULES
    
    $DRI_CFLAGS does not actually exist. The PKG_CHECK_MODULES call creates
    a $DRI1_CFLAGS variable instead. This doesn't break often because
    "recent" versions of xorg-server.pc indirectly depend on xf86driproto.pc
    thus bringing in the required CFLAGS through $XORG_CFLAGS.
    
    Bugzilla: https://bugs.gentoo.org/show_bug.cgi?id=490342
    Signed-off-by: Rémi Cardona <remi@gentoo.org>

commit 7b0771180dc9bb7276a473db5663f41b5929199b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 10 10:34:06 2013 +0000

    intel-virtual-output: Do not hide the cursor on the local/source display
    
    Whilst we want to take over and hide the cursor on the remote displays,
    on the source we need to not interfere with the host.
    
    Reported-by: Jethro Beekman <freedesktop-bugs@jbeekman.nl>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71439
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3b02a879bd6f29447e20fb5bb51c0a4a48a7928
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 9 11:15:39 2013 +0000

    sna: Assert that we do setup the gc->pCompositeClip upon ValidateGC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ec663bf1c83ea1e470e94b9fb703346fc5bd39e
Merge: d9ecb91 abf1a16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 9 11:06:12 2013 +0000

    Merge branch 'master' of hsw:/usr/src/xf86-video-intel

commit abf1a16914d993cc150005879375d4bb17fdccf3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 17:09:35 2013 +0000

    intel-virtual-output: Only track the most recent visibility status of the cursor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b46d0d327140a1b17066e473d6d61798ffb9871a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 14:04:32 2013 +0000

    intel-virtual-output: Fix forced synchronisation of clones
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa40286e2f12a4757d1b9bcbe1f1d7c5170bd7da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 13:53:48 2013 +0000

    intel-virtual-output: Tighten bad_visual() checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83c33a1f436c947ab3d9289a9c57d92f964e9541
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 13:00:11 2013 +0000

    intel-virtual-output: Disable event tracking after a failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b10c528044840d6c2a6244034fc6c2555476b8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 12:58:06 2013 +0000

    intel-virtual-output: Add DBG for the latest XSync
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 969b064f74e0058a49afa17287184005d1e11402
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 12:54:01 2013 +0000

    intel-virtual-output: Perform an explicit sync
    
    If we fail to track rendering using ShmCompletionEvents and begin to
    drop frames, insert an explicit XSync.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0075ccee2e7bbe46ecbf717817d468cc9248cc4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 12:46:08 2013 +0000

    intel-virtual-output: Check for pending events before skipping draw
    
    Make sure we check if the destination display has caught up before
    skipping a frame.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea4f99c333b181eb21012b5bee60251695e93c8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 12:30:21 2013 +0000

    intel-virtual-output: Add some DBG for bad_visual()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84d667b94a97ad5fde68d730d57a19e1f4241ed5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 8 08:53:55 2013 +0000

    sna: Always schedule upload buffers for retirement after use
    
    Even if they are multiply referenced due to cached references.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9ecb91ef123ee4e88020d0328a8c1fafad30e6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 7 14:58:08 2013 +0000

    sna: Skip an unmappable linear bo when searching through a cache for a GTT mapping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb579a4444146a0736c7bad5edc1f382a32b6bf6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 7 14:54:39 2013 +0000

    sna: Only assert that the bo is small enough to be mmapped
    
    Not that is currently in a position to be mapped without eviction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68cef6cd281572fcfb76a341dc45b7c8e5baffe6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 7 13:09:25 2013 +0000

    sna/gen7: Request secure batches for Haswell vsync
    
    Since commit 8ff8eb2b38dc705f5c86f524c1cd74a811a7b04c
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Sep 9 16:23:04 2013 +0100
    
        sna/hsw: Scanline waits require both DERRMR and forcewake
    
    we have been emitting LRI to enable vsync on the render ring. This
    requires a privileged batch buffer, and whilst we were checking for
    kernel support, we forgot to actually tell the kernel to submit the
    batch with the right privileges.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71328
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b796c33411218aeaf4daaeff41a1bc442b5f945f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 16:24:28 2013 +0000

    sna: Always copy from the tile source
    
    The first step when tiling with an intermediatory is to copy from the
    source bo to the temporary. The alu should only be applied when copying
    from the temporary to the destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ace764501ec7c440eddc1d26670f6fbf29fa648d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 15:42:35 2013 +0000

    sna: Remove erroneous assertion from sna_tiling_blt_composite
    
    We have to rely on the caller only calling us for a PictOpSrc equivalent
    operation as they don't all set op->op.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a9c1e153a9208e8cd7680e478fde18e051beaa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 15:04:24 2013 +0000

    sna: Add a DBG breadcrumb to kgem_bo_convert_to_gpu()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae380a960df6b3a9714d78eb6cb42249764488ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 14:51:42 2013 +0000

    sna: Use tiling BLT fallback for BLT composite operations
    
    This avoid a circuituous route through the render pathways and multiple
    levels of tiling fallbacks to accomplish the same copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7578809ddcb244ad78ebf86359b7ee2a61e27ff6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 13:42:27 2013 +0000

    sna: Trim create flags if tiled sizes are too large
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 073465817f54507ab6b7f801c5dfab2c06f678c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 13:41:39 2013 +0000

    sna: Fences are power-of-two sizes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6b008d69235cbbb572d7d4b33940d2cedd66556
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 11:38:53 2013 +0000

    sna: Fixup unwind checks for future BLT commands
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22b6a331d0a102e8a8b9fcac1d75f8c9e16596b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 09:05:05 2013 +0000

    sna: Clear the execlist if we completely unwind a batch after using 8x8 tiling
    
    Another location, but the right function this time!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3d5b1d8fcb1b65c35827d38bf5b309e433d0907
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 09:40:56 2013 +0000

    sna: Move initialisation of loop counter to common code
    
    It was only being defined in x86-64 and left unitialized for x86-32.
    
    Fixes regression from
    commit 587c4866652e40e1e228b333028114766a6d3b08
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Nov 4 15:10:40 2013 +0000
    
        sna: Promote uint16_t to a full int to avoid overflow in computing w*h in memcpy_xor
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71286
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a31335954b4d244d10e2594ae00e60762536a77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 09:05:05 2013 +0000

    sna: Clear the execlist if we completely unwind a batch after using 8x8 tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef842d2ceee4d1ccf8a0f8a81530dc8be8e18b44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 6 08:56:01 2013 +0000

    sna: Be more pessimistic for tiling sizes on older gen
    
    On the older generation, we have severe alignment penalties for fenced
    regions which dramatically reduce the amount of space we can effectively
    use in a batch. To accommodate this, reduce the tiling step size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2f9019bae5f6f03b5e23da759d3871fc18dd9f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 22:41:06 2013 +0000

    sna: Only operate inplace if no existing CPU damage for a read
    
    With a large object, we try harder to operate inplace (to avoid creating
    a second large CPU bo). This introduced an issue where we tried to read
    from the GPU bo when there was already existing damage in the CPU -
    triggering an assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f901495cdef0ae3b4a328bb98a6bc0ff03ea362
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 21:59:37 2013 +0000

    sna: Trim the overestimate of required aperture space for fence alignment
    
    We can optimistically only require that we waste the largest fence
    region in a batch, as all other fences will then be naturally aligned as
    well. So long as the kernel succeeds in defragmenting the aperture...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 736b496b458d666416ea94f157c05ce78f98a600
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 21:33:18 2013 +0000

    sna: Mark partial move_area_to_gpu with MOVE_READ on promotion to move_to_gpu
    
    When promoting a partial move_area_to_gpu to a full move_to_gpu, we have
    to disable certain optimisations that we try to use if MOVE_READ==0.
    
    Reported-and-tested-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71198
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 723f17ca4f9c120be5fe667bf2c3e35c7ee687be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 18:36:45 2013 +0000

    sna: Submit execution on the bo before changing its caching status
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10b573c5084cabcc1bae70c8d35311fa5ec0a245
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 18:29:46 2013 +0000

    sna: Clear snoop flag after converting from a CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc61705a6e425952de4c81c2320382af07cf948a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 08:49:28 2013 +0000

    sna: Use an inplace exchange for large untiled BO
    
    On older architectures, large BO have to be untiled and so we can reuse
    an existing CPU bo by adjusting its caching mode.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70924
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3225fcb38686f3b9701725bf3a11ecf1c100c3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 5 08:38:22 2013 +0000

    sna: Be move conservative with tiling sizes for older fenced gen
    
    The older generations have stricter requirements for alignment of fenced
    GPU surfaces, so accommodate this by reducing our estimate available
    space for the temporary tile.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93193aaf7d0fc4e3a3b9be1632bfd36331b47d2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 22:14:05 2013 +0000

    test

commit a0d1de962a8107cfcaefd82eb8ffaf3e4da0e130
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 16:45:00 2013 +0000

    sna: Check for loss of state after setting up a fill BLT op
    
    If we install a BLT fill operation early in the drawing sequence (i.e.
    before calling a mi routine), we may lose our state to delayed
    initialisation of sources and so need to subsequently recheck.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcd081ca77c917c7000f8ab4668e5c863381a4f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 15:17:51 2013 +0000

    sna: s/active/busy/ to silence compiler warning
    
    kgem.c: In function 'kgem_check_bo':
    kgem.c:4768:7: warning: declaration of 'active' shadows a global declaration [-Wshadow]
    kgem.c:692:21: warning: shadowed declaration is here [-Wshadow]
    kgem.c: In function 'kgem_check_many_bo_fenced':
    kgem.c:4907:7: warning: declaration of 'active' shadows a global declaration [-Wshadow]
    kgem.c:692:21: warning: shadowed declaration is here [-Wshadow]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 587c4866652e40e1e228b333028114766a6d3b08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 15:10:40 2013 +0000

    sna: Promote uint16_t to a full int to avoid overflow in computing w*h in memcpy_xor
    
    Reported-by: Conley Moorhous <conleymoorhous@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70527
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f6e227ba8127a2ca034271f2a660c24abbe056f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 12:57:01 2013 +0000

    sna: Apply the BLT source offset for individual copies
    
    Following a complex path through multiple layers of indirections and
    tiling fallbacks, resulted in hitting a path where the source offset was
    subsequently ignored. This leads to the operation reading from invalid
    memory (or hitting the assert warning about the same).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70924
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82b646a42f5a6271c8518ad454f1603714276caf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 11:48:04 2013 +0000

    sna: Only use the simple stipple upload path if wholly contained
    
    If the stipple box is outside of the stipple pixmap, we need to
    carefully upload the stipple using the modulus operation.
    
    Buzilla: https://bugs.launchpad.net/bugs/1247785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e678cead11b53699694f5b5cf52ff3ea0e08f637
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 11:47:29 2013 +0000

    sna: Update DBG formats for larger BO offset integers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94f9beb8fbb31c2b6158e492e02ff05c9ebc674f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 11:30:39 2013 +0000

    sna: Remove the replace indirection prior to performing write_boxes
    
    As write_boxes itself decides whether or not to stage the upload into
    the destination bo, we can destroy the temporary allocation along the
    write_boxes fallback path (i.e. after failing to map the destination
    bo).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad3959324c02de2e73e7d1142d42248f7dbb4518
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 11:12:30 2013 +0000

    sna: Only destroy the old GPU after successfully replacing it
    
    Along the sna_replace__xor path we destroyed the priv->gpu_bo twice upon
    successfully replacing it.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70527
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d067e961920e19fda7e9990440ac2be1a2e1760
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 09:34:25 2013 +0000

    sna: Rename the two variants of pwrite so very relative dangers are obvious
    
    Since we extend the write in the cache-aligned routine, it runs the risk
    of reading from beyond the end of the allocation. As such, callers
    should be carefully vetted to make sure that their allocations are
    already cache-aligned (typically page-aligned). To make it obvious that
    this complexity exists, rename the routine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7050c8da56676b60a602dce9abbdb61a7c4fa61e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 4 09:31:05 2013 +0000

    sna: Use the unoptimized pwrite for general buffers
    
    When we call kgem_bo_write() we have less control over the allocation of
    the buffer, and do not ensure it meets the alignment criteria required
    for the cacheline optimisation. So use the simple pwrite routine to
    avoid reading beyond the end of the allocation.
    
    Reported-and-tested-by: Mark Kettenis <mark.kettenis@xs4all.nl>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10023bf8f5a95b4e9f42c05370bc2c103d6a3d3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 3 22:07:22 2013 +0000

    sna: Use fast-path target placement if we are also IGNORE_CPU
    
    If we are ignoring CPU damage, we also need only to check GPU damage
    when considering placement of the target bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08d8a47e7c8b9bcb5bb317be4623161e58e0e0cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 3 19:51:56 2013 +0000

    sna: Wrap staging buffer access with sigtrap handler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a7217b05c232484a80abc7bd67494996dd32057
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 21:45:00 2013 +0000

    sna: Discard bo->exec when unwinding a glyph no-op
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit add663919eb6aca1f5bbb39549d56f481ea0f273
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 21:13:45 2013 +0000

    sna: Eliminate the redundancy between is_mappable/can_map
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d41f847c75c3bce85fda6e7508995b45679944e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 21:01:26 2013 +0000

    sna: Jump to the right escape target when bypassing a self-copy
    
    Another fix for
    
    commit e3f15cbf39696edae9f716bdcfbb7032ec7d7e3f [2.99.905]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Oct 22 15:19:15 2013 +0100
    
        sna: Move gc back to GPU after failure to move it to CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c143ba65cebfad08a32ee28c0dfb4f6635bf94c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 15:12:51 2013 +0000

    sna: Add some more asserts around inactive VMA lists
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c34ea0894e42bf344b0edad62cf2e142840af88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 14:43:49 2013 +0000

    sna: Tweak estimate of maximum usable aperture for strict fencing
    
    Old generations have very strict alignment requirements even for
    unfenced tiled accesses which restricts the amount of aperture space
    available for use, and in the process estimate for the effect of
    framebuffer fragmentation on the mappable aperture.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d507b6b9825cc18f41911727ef2ba9b9593cfe21
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 16:28:02 2012 +0000

    Prepare for changes in the BLT unit on future generations
    
    Adapt the legacy BLT commands in preparation for future changes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9681b1422e4531a19e0117e1b1a97668f6b6a571
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 2 13:11:31 2013 +0000

    sna: Fallback when wedged and trying to use the BLT copy routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6cb84c8d55f2f7cbb087a479c1dbc8bc58e97183
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 1 15:57:56 2013 +0000

    sna: Guard the replace-with-xor fallback path
    
    Before attempting to map the destination for uploading into after a
    failure to use the BLT, we need to recheck that it is indeed mappable.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70924
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5da329735ca79517a326aee002685bf33e8db861
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 1 14:30:14 2013 +0000

    sna: Process all clip boxes when rastering segments
    
    The macro still had buried returns which were no longer valid after the
    translation to handle clipping. They needed to be breaks from the inner
    most loops to the outer clip box instead.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70802
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d93b0ef343a635512c3835c797c469c17a7b584
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 1 12:49:36 2013 +0000

    sna/gen7: Undo overzealous flushing
    
    commit d580a30aaf97687f9669ea72fbc3310c2fea26f1
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Oct 31 15:58:47 2013 +0000
    
        sna/gen7: Flush render cache when changing CC state
    
    ultimately doesn't prevent the issue and in the process adversely
    affects perforamnce.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b1a6f32179f7bff8503c6b8b38351a7cf1d08b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 1 10:48:06 2013 +0000

    sna: Scale uses of aperture_mappable by PAGE_SIZE
    
    After converting aperture_mappable to count in pages, there were a few
    residual users expecting a byte count.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=71117
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d580a30aaf97687f9669ea72fbc3310c2fea26f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 31 15:58:47 2013 +0000

    sna/gen7: Flush render cache when changing CC state
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=68410
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82e6d41c2f4f343bd1854d3d8ee4b624b5d68971
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 31 13:35:59 2013 +0000

    sna/gen6: Tweak flush around CC state changes
    
    In order to fix some font corruption, it appears that we need an extra
    flush in the Sandybridge pipeline when we change the CC stage and the
    render cache is dirty. We previously triggered a full pipeline stall
    for this case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5cdc2bbc9c66d4c8c6fdb1b552c32177d070bf7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 31 10:32:46 2013 +0000

    sna: Tweak deletion of used buffers
    
    Make sure we never unwind a used buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed16e34c00d5eb5ca4ec643f66fedbf1a5112e90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 18:48:10 2013 +0000

    sna: Allow limited recursion within sigtrapped routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 426efd5f4bb311eeec86de40815b6bc2c6914e94
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 18:42:06 2013 +0000

    Revert "sna: Detect and handle mi recursion"
    
    This reverts commit c6b0e3fe0c299488932ba0392847f1faf298d079.

commit ed282456240cc0a7ae9a235ea8aea14a8b8a54ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 13:26:23 2013 +0000

    sna: Assert that the batch is in the correct mode prior to inserting BLT commands
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6b0e3fe0c299488932ba0392847f1faf298d079
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 11:52:05 2013 +0000

    sna: Detect and handle mi recursion
    
    Some of the mi routines recuse back into the generic accel routines and
    so confuse our trapping of SIGBUS. Add extra assertions to pinpoint the
    recursion and unwrap sufficiently to avoid that recursion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d13d52258702f2581ca4f695b69e4dc8f510581
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 10:02:28 2013 +0000

    sna: Queue retirement when placing a BO on the deferred flushing list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59531ba31aa479497cb76b67ea972d1cfa6aec79
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 30 09:55:57 2013 +0000

    sna: Check for wedged after submitting
    
    If we submit prior to an operation, check that we didn't just wedge the
    GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87655e7df4847542db8da6c8b61006c95b936185
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 21:19:02 2013 +0000

    sna: Wrap access of upload buffers with sigtrap
    
    For an extra layer of paranoia, catch any sigbus when trying to upload
    a bitmap, and convert it to a no-op.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e692800055827cf526c7539515c71aecb58bf30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 20:16:06 2013 +0000

    sna/gen7: Refactor BYT vsync using IVB routines
    
    The BYT vsync is closer to the IVB vsync, and using gen6 is just
    erroneous. Apparently. At least that is what is in bspec today.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9352769eee0889dd1c1656829c140384a9e94bcf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 18:27:41 2013 +0000

    sna: Fix assertion checks for fake flushing requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eddd80c44dbb21769cbd100b8cfb0f38d1606e86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 18:00:49 2013 +0000

    sna: Remove an overzealous assert
    
    Testing with a slow gen2 triggers this harmless assertion, so drop it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f36e83d76eb6ef26539fc37ce9ebd08428c48a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 16:59:57 2013 +0000

    sna: Handle deferred retiring of active-buffers
    
    Yikes, the new assertions found cases where we would retain an active
    buffer even though it was still owned by the next batch. Fortunately,
    this should only be a bookkeeping issue rather than lead to corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d26036d40e77e8f40c8d08659f95a8a5dfac07ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 16:20:14 2013 +0000

    sna: Always run the retire_buffers during ring_idle
    
    As we know that we had a request to retire, we know that we may make
    progress retiring active buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72544ad5d11c2563d544ef1f7b25de2b3ab21295
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 14:53:02 2013 +0000

    sna: Perform an explicit retire for old active upload buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d86b36dc41f2e6744a4dea9286634cdf7989fa71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 15:12:17 2013 +0000

    sna: Check for retired upload buffers after checking for an idle ring
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e6aca90c7b0b9edd5873034bcf0f3d8b2a9f065
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 13:50:51 2013 +0000

    sna: asserts bitmap uploads are correct
    
    Place guards around the pointer accesses to verify that they are within
    the bitmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56e3761dec7ea3fc35bda90fbc8b477de70fd144
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 12:46:09 2013 +0000

    sna: Don't attempt to move the GC back to the GPU before it is moved away
    
    Fixes regression from
    
    commit e3f15cbf39696edae9f716bdcfbb7032ec7d7e3f [2.99.905]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Oct 22 15:19:15 2013 +0100
    
        sna: Move gc back to GPU after failure to move it to CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f41bf3de059c4e0a03fb161fb2e78d94be69e3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 29 09:56:10 2013 +0000

    sna: Try harder to complete writes
    
    Expunge our caches if we fail to write into a bo (presuming that
    allocation failure is the likely fixable cause).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76b14a90c16921426154be1d18307e3b12309eea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 20:48:17 2013 +0000

    sna: Quieten a couple of valgrind warnings about unknown ioctls
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54aaf14dbf33b0e81932507b8753a63d1c6c8e77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 13:06:16 2013 +0000

    sna: Tidy RegionNil checks
    
    After computing the clip intersection, we immediately check for the
    empty result, so refactor the check into the common routine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 003f26a571cd0a0eda2499b4ae350c34bdb39b72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 11:29:13 2013 +0000

    sna: And be pessimistic when checking aperture limits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 671e4b44b2b2809e032a3d2a9b45ecf3af547100
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 11:28:01 2013 +0000

    sna: Account for extra guard pages around snooped BO in aperture checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7d1da8ca5e1695b0459f87e85c587b26193e633
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 11:16:29 2013 +0000

    sna: Defer opportunistic flush if all bo are current on the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d69a4f118a729edfb82498501ddb99caf2f3fb93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 10:33:57 2013 +0000

    sna: Leave extra room in the mappable aperture for fence alignment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40d4199f151a39ecebf127cf468b4470d2906f4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 28 10:45:52 2013 +0000

    sna: Use page-count for mappable aperture size
    
    For consistency with the other aperture metrics and correctness when
    passing around required number of pages.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9266e35b42e17293be59cff4c5097f7755112349
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 27 16:45:53 2013 +0000

    sna: Fallthrough to opportunistic flushing after aperture checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e0a01a7a3cf0f473c7ffae9129069086bf2fbe2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 27 15:33:13 2013 +0000

    sna: Handle transient TearFree flip failures
    
    If we get a pageflip fail when trying to do a TearFree update, just
    fallback to a copy (before turning off the display for complete
    failure). The rare tearing copy should mar the user experience far less.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b480e1ec503534310d3875aef81ed191aeb93313
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 15:09:19 2013 +0100

    sna: Trim usuable fenced aperture by unfenced usage
    
    This will overcount buffers that both fenced and unfenced (likely most
    fenced buffers!) but is required to prevent ENOSPC due to alignment
    issues.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64b9f57451501830f8031d1b6ac7289642da032d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 14:27:21 2013 +0100

    sna: Don't assert indirect GPU state
    
    kgem_check_bo_fenced queries whether the GPU is idle, and so its result
    is timing dependent and not suitable for assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0da01aa907d488ae32dfda206ea8a66564bc430
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 14:22:05 2013 +0100

    sna: Remove stale mappings when replacing GPU bo
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70527
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e4d643794975b2ac90d04f1a11c0b8114699559
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 13:20:10 2013 +0100

    sna: Fix overallocation of fences for BLT commands (gen2/3)
    
    Fixes a regression introduced in
    commit 4d2840919fd00e4ae0bf1957f66009f55a01eb7b
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Sep 26 15:30:58 2013 +0100
    
        sna: In desperation, query the actual available aperture space
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da0de7e55a9c1b64f3fb0d7b573bb61b0d2566df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 11:35:39 2013 +0100

    sna: Add a line of DBG for when we discard uploads into CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51c87f9acaa0c4eaaea581092088e1d524396f35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 11:23:21 2013 +0100

    sna/io: Propagate failure to XOR uploads
    
    Similar to the handling required for the normal upload paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51590e55c0187862174a7dd5775915216b3137a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 25 11:03:05 2013 +0100

    sna/io: Wrap the XOR upload paths with SIGBUS handling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0d2f1d4e01c223cd6629245bceb24ae4dda215a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 24 19:45:30 2013 +0100

    man: Mention the new default accel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d87113080d55cadf72c963f99179a2eb9a282e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 24 19:38:53 2013 +0100

    man: State the negative aspects of TearFree
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b6cb1cf45cff2bb4383bd6bf50aec0af8895079
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 24 15:42:12 2013 +0100

    sna: Do not apply drawable offsets to DamageRegionAppend
    
    DamageRegionAppend() will itself apply the drawable offsets, so we need
    to pass it the untransformed region. This also fixes an issue where we
    might fallback without applying any Damage.
    
    Reported-by: Christian Nassau <nassau@nullhomotopie.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32734
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e44b1f5543f6d36c33c743f1ba2143514f8afbf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 24 13:05:16 2013 +0100

    sna: Fix canonical mode name to correctly use asprintf
    
    Whoops. Only the kernel sprintf() accepts NULL as a valid target string,
    not libc's.
    
    Reported-by: Jay Little <jaylittle@jaylittle.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70835
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 638d4f60285709b6efc04cef72d4b530460e3239
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 14:22:14 2013 +0100

    sna: Remove the move-to-gpu shortcircuiting for partial GPU, no CPU damage
    
    Otherwise we may not correctly undo COW or pending move-to-gpu updates.
    
    v2: goto move_to_gpu instead for correcting the damage handling.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70821
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e685e100705c1a5f4ef84b2bc355aa6b6ed0ab18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 24 07:28:18 2013 +0100

    Revert "sna: Remove the move-to-gpu shortcircuiting for partial GPU, no CPU damage"
    
    This reverts commit bccbbf8a68faf7aac274efd289d4916083b1a1e3.

commit bd20791e8e4a9b8aa8e8dfe1cc76e91a471f5c67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 23 16:15:35 2013 +0100

    man: Describe the TearFree option
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b70390b4f824afeed8f1b5a9baf79e33377405cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 23 11:15:28 2013 +0100

    sna: Reset bo after allocation failure during wait-for-shadow
    
    If we fail to allocate an alternate bo to replace the still visible
    scanout bo, we stall and were supposed to continue using the old
    wait->bo. However, we chose to use NULL instead which is going to lead
    to an eventual crash.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 585340f75cb897e1293a887e8ef5a9552ea347cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 23 09:50:24 2013 +0100

    2.99.905 snapshot

commit aff67ada6cd2cb1f8adb5bec27a27fbc0f2884cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 23 08:40:43 2013 +0100

    sna: Tidy opportunistic flushing
    
    Rearrange the common code so that it should be tail-call optimised.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11e8b299e11ff846e1c8090f7cbd34b2af850d85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 17:36:58 2013 +0100

    sna: Flush the pending move-to-gpu upon Pixmap free
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4eb736d61a3b45edb921799b74b3b164b94c174a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 17:35:33 2013 +0100

    sna: Handle pending move-to-gpu for userptr uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9e304a7194c1fd6038c59524d3c03756ea0d09e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 17:34:59 2013 +0100

    sna: Pass the async hint when pushing GPU damage for redisplay
    
    So that we don't accidentally clear any other hints.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c51dd18eade425a7e280203b328b66d278fcba1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 16:59:29 2013 +0100

    sna: Fix inconsistency in has_coherent_ptr assertion
    
    We occasionally will read from an "incoherent" ptr in the belief that
    the clflush hit will be worth it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bccbbf8a68faf7aac274efd289d4916083b1a1e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 14:22:14 2013 +0100

    sna: Remove the move-to-gpu shortcircuiting for partial GPU, no CPU damage
    
    Otherwise we may not correctly undo COW or pending move-to-gpu updates.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c282afb212d1d387d318256f4627385d12e1921
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 13:33:06 2013 +0100

    sna: Make sure CPU damage is flushed to the TearFree shadow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 247ebf86a32b518536a11c2f866b2c885bd55d38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 07:58:03 2013 +0100

    sna: Only force the TearFree exchange before a write
    
    We can read from the current scanout buffer without incurring a visual
    tear, so delay the GPU bo exchange until we see a write to the object.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b78f25d8992e56f83c897c3d2d7dd75cb7dd1d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:54:59 2013 +0100

    xvmc: Handle errors along allocation path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27249537d7a2c0c9f817716d657224175a2d9acb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:35:31 2013 +0100

    sna: Free our CRTC private after failing to create the xf86Crtc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fcda71d753ab5126143f053c47513e9acf5c98b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:32:23 2013 +0100

    sna/trapezoids: Fix inversion of initialisation test for triangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fc95bebe783341aaf0e285ca2e216035378943c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:30:05 2013 +0100

    sna: Ignore overflow in CPU count rather than abort
    
    If there are more processors than we ever expect, good! Just use lots of
    them, rather than none at all.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3f15cbf39696edae9f716bdcfbb7032ec7d7e3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:19:15 2013 +0100

    sna: Move gc back to GPU after failure to move it to CPU
    
    As the failure in gc move-to-cpu occurs late, i.e. after the function
    pointers are updated to point to CPU functions, we need to undo those
    changes, i.e. call move-to-gpu for the GC on failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d18b3956501e53e2ea6b5afcdf9af2f587fbc84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:02:53 2013 +0100

    sna: Discard GPU bo when failing to setup the shared pixmap
    
    If we fail to mmap the pixmap when preparing it for use with prime, be
    sure to throw away the now lost priv->gpu_bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0f31d822a2b10bc30ff2532b5ff87d2f401bc62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 22 15:00:16 2013 +0100

    sna: Free bo along unlikely one-off error path
    
    Add a missing free for a never-hit error.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d788b69fdb5ea73b1d283a89e53b2b19eaa90e6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 23:44:29 2013 +0100

    sna: Enable TearFree rendering for transformed scanouts
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=22969
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa2687bdd5a4c8bc608dac8bb711035f0752a725
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 18:55:23 2013 +0100

    sna: Eliminate the synchronous wait from inside TearFree
    
    Defer the actual wait until the next use of the screen pixmap, and then
    if needed replace the GPU bo with an alternative back buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83c1d1efa1d0d24ebe606065a4305b81fe64b73b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 17:52:05 2013 +0100

    sna: Improve handling of blit fallbacks for untransfomed large scanouts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c562bac64d2ce80667c686a732d0f9cda6277ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 15:31:44 2013 +0100

    sna: Tweak opportunistic flushing to reduce power consumption
    
    When trying to conserve power, reduce the number of small batches we
    emit - trying to maximise GPU efficacy and minimise CPU overhead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11211cd7c06a80c2dbbe07360857486b5b0d3094
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 13:35:24 2013 +0100

    sna: Set the canonical name for the current mode if none match
    
    Always give the mode a name for pretty printing for the user.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d5dfb3e7a6056df7f6af1bcdc789a50ed00b068
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 13:25:01 2013 +0100

    sna: Copy the EDID mode name for the current CRTC mode
    
    As the kernel does not preserve the name and driver type when returning
    the current CRTC mode, we need to reconstruct those from the EDID mode
    when available.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1027ad7c60b9fd229ed196646c88ba7bb72a282
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 11:16:02 2013 +0100

    sna: Fix typo inside an assertion
    
    Use the right dst_priv variable instead of priv!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b87b0c49a5208383e7472b58d36d3a558144496
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 21 11:06:30 2013 +0100

    sna: Suppress log messages for unchanging EDID
    
    Whenever we reprobe an unchanging output and re-read its EDID, we emit a
    useless log message. Previously this was squelched by trying to spot
    when an EDID was unchanged through the use of its blob.id, however we
    need to do a complete check on the contents in case the kernel returns
    us a new EDID with the old id. So make a temporary copy of the current
    EDID data and only squelch the log messages if the new EDID is an exact
    match.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33be42bf509b6d57face6b8d99d72dd5f6c90900
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 20 09:03:47 2013 +0100

    sna: Fix the addition of the current output Mode to the probed lists
    
    We need to add the current mode to the Modes list and not directly to
    the output->probed_modes as that gets overwritten.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1ecadd7b44a8e95522cc4a6e4b908b071709e06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 19 22:38:15 2013 +0100

    sna: Unmap pixmap prior to release GPU bo
    
    As the unmap routine will deference the GPu bo in its debugging code, we
    need to be sure that the pointer is still valid at the time of
    unmapping. Hence unmap before release.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db086d02affe5109202dc9ee06c9e728a3ff0f3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 18 17:30:18 2013 +0100

    sna: Do a quick pass on dirty damage before reduction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eedcac9a2d1e3ab7c6e35135995d960e55dcad54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 18 17:27:27 2013 +0100

    sna: Drop now obsolete assertion
    
    We no longer unconditionally clear the CPU hint when moving to the GPU
    for readonly updates, so we can no longer assert that the priv->cpu ==
    false afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd280a69b500d2187925f67a541e045a7ae24b07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 18 11:12:51 2013 +0100

    sna: Tighten pixmap map assertions
    
    We need to also take account of upload buffers which include an offset
    to the base map. To do so, we also need to stop conflating the cpu hint
    with the current mapping flag.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f81a7f7192a821654bc72a6b34625a6367cb8479
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 18 09:19:14 2013 +0100

    sna/glyphs: Remove glyph_approx_extents
    
    It didn't consider the height of the glyph above the baseline, i.e. it
    was fundamentally flawed. The only thing to do is to make sure that
    glyph_extents() is sufficiently fast never to show up in profiles.
    (Until then QA should spot the ~10% regression.) An alternative would be
    to feed the drawable clip extents to the render engine and avoid manual
    clipping if the clip region covers the whole drawable.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70552
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb1c177eb7fa1745aa452b7a9573c0d0cea2a393
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 18 08:33:58 2013 +0100

    Remove defunct file 'brw_eu_util.c' from git
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 930b2c76c78dabc42749f819cb1f9566a6d870a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 17 17:16:56 2013 +0100

    sna: Check return of source_bo for a potential failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cf2312372ebde4168ae1e66a97d5c6b8daff1c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 17 17:14:13 2013 +0100

    sna: Fix computation of clip boxes for stipple uploads
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=67865
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 621eaba0d5c524878a8803ad285cb9b4b33654a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 17 12:01:02 2013 +0100

    sna: Assert mapped state
    
    When mapped, assert that we point to the expected mapping of the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efe5c737ed20f2a0b14b479b14eccaf1963d5e01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 17 11:32:39 2013 +0100

    sna/dri: Refactor to use the common GPU damage routine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec0866e86d365ae3fd9790b1b263d49fc4981220
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 16 22:39:54 2013 +0100

    sna/glyphs: Fix computation of extents for long strings
    
    And make sure we consider such overflowing strings for correct clipping
    against Windows.
    
    To offset the cost of doing a full extents check (~10% on aa10text), we
    introduce an approximate extents query (~1% on aa10text). The disparity
    should be rare, and should be an overestimate to force redundant
    clipping.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70541
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09121a61b319ce365bfc6f96fb34c52d6eafffdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 16 12:43:43 2013 +0100

    sna: Fix inverted tiled CPU map check in has_coherent_ptr()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2068492fba6201c548b1ee7a6eb5d0459f20d466
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 16 09:52:14 2013 +0100

    sna: Only carry 32/64-bit compat wrapper for drm_mode_get_connector
    
    This is the only structure we care about that has u64 and its size is
    not a multiple of u64s.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a63b4d5a0766a7e98efeff8dd520c58e9a1bea88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 21:53:16 2013 +0100

    sna: Expand packed KMS structs for 64-bit alignment
    
    Pavel Roskin found that with a 32-bit build of the DDX with a 64-bit
    kernel that the call to GETCONNECTOR was overwriting the 4 bytes beyond
    the end of the drm_mode_get_connector structure. This would appear to be
    due to the surreptious padding inserted by the compiler so that the
    structure would be naturally aligned on a 64-bit system. To compenstate
    we need to insert padding between the adjacent 32-bit structures on the
    stack.
    
    As usual, be paranoid and make sure that all the adjacent KMS structs we
    use are padded out to an 64-bit boundary.
    
    Reported-by: Pavel Roskin <proski@gnu.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc072db862372f1424195c0c774d10f148b0fcc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 16:21:41 2013 +0100

    sna: Add DBG along all output init failure paths
    
    Suggested-by: Pavel Roskin <proski@gnu.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8447e50824d26f3c61e665269534062f34380ef6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 14:39:13 2013 +0100

    sna: Allow read-mappings for has_coherent_ptr() assert
    
    The assertion was a little too specific and disallowed us to have a CPU
    read-only mapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f41b0663dc2f6e7b6b190adef4dc27b1c7e8c609
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 14:30:41 2013 +0100

    sna: Speed up inplace copies from SHM pixmaps to GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad5b6a303b44ba0ae9f8df075a7efec92a2e41ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 12:48:27 2013 +0100

    Revert "sna: Preserve the user backlight value for get_property calls"
    
    This reverts commit 41b6b792d8e9c84c0a71a4bd7600e1c42e86b5bd in favour
    of the better fix to not ask RRChangeOutputProperty to reset the known
    hardware values.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e76b08cad2770015346fd4cd757de3bb3b6ff37c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 12:46:09 2013 +0100

    sna: Disable updating properties upon reading their values
    
    When we assign the hardware values to the output properties, we do not
    need to process the set_property callback to write those values back to
    hardware. This callback is triggered by the pending update flag passed
    to RRChangeOutputProperty.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70406
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41b6b792d8e9c84c0a71a4bd7600e1c42e86b5bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 11:23:19 2013 +0100

    sna: Preserve the user backlight value for get_property calls
    
    When querying the current backlight value, be sure not to overwrite the
    last user set value by the call to RRChangeOutputProperty.
    RRChangeOutputProperty calls into set_backlight_property, tricking us
    into believing that the user has set a new backlight value. The result
    is that we end up believing that the user chooses a 0 backlight if she
    should happen to query the property whilst the output is disabled.
    
    Reported-by: reztho@archlinux.us
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70406
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0345cbec97d2848fe5e41043d8ddf4cf5e888c72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 15 10:42:16 2013 +0100

    sna/trapezoids: Initialise force_fallback
    
    Remember to set it initially to false so that we randomly do not start
    using fallbacks.
    
    Fixes regression from
    commit 0cd2c43fa8f3a66d612589ad1163a90e427668ac
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Oct 13 14:46:45 2013 +0100
    
        sna/trapezoids: Use the aligned fast path for fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e952968ed7c6f1ec90752f10a5fb24ae2faa57f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 14 23:16:48 2013 +0100

    sna: Assert that the mode/ring are set when marking active bo
    
    As we use the current ring to encode upon the bo relocs, we need that
    ring to be properly setup prior to performing relocations.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=70461
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f009c13beeb6b156e638975827d06b3cdedb0c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 14 11:54:35 2013 +0100

    sna/gen6: Fix the invert fix
    
    Eek, missed that 8-wide dispatch branch still had the opposite fix that I was
    testing first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8909f7423567a6902320c1a2e83abd501223fb84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 14:39:30 2013 +0100

    sna/gen6+: Fix calculation of 1/z for projective textures
    
    A typo crept in causing the shader to read from the wrong temporaries
    for the invert operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21577742e75165cb2bf34b1cab5bb2c3794c5b49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 14 09:33:52 2013 +0100

    sna: Tighten has_coherent_ptr() assertion
    
    Pass along the flags for read/write direction so that we know whether or
    not we expect the gpu bo to be in the CPU write domain.
    
    Reported-by: Pavel Ondračka <pavel.ondracka@email.cz>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2987a6d5662fb3337f1400a51d016e1c5e21c063
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 18:50:03 2013 +0100

    sna: Fix typo in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cd2c43fa8f3a66d612589ad1163a90e427668ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 14:46:45 2013 +0100

    sna/trapezoids: Use the aligned fast path for fallbacks
    
    Route the fallback methods through the force_fallback aligned fast
    paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87d675061e324934a95412f9fe87a67c219d3fb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 13:39:04 2013 +0100

    sna: Cleanup up unused variables
    
    commit 951f969fa63defbe7cfa52ca97c8985b157bbed0
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Oct 13 12:47:20 2013 +0100
    
        sna: Update DPMS on attached outputs before disabling the CRT
    
    left behind a couple of variables now deceased.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 951f969fa63defbe7cfa52ca97c8985b157bbed0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 12:47:20 2013 +0100

    sna: Update DPMS on attached outputs before disabling the CRTC
    
    We may want to take action such as preserving the current user value of
    the backlight before disabling it whilst forcing a CRTC off. This
    requires us to record that value first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e7d6ddb9b485045b4662af83e048b06aab358aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 11:04:02 2013 +0100

    sna: Cleanup allocation of sna_output after late syscall fail
    
    If the second syscall fails (presumably as a deferred allocation failure
    check), cleanup the allocations made so far before reporting the
    failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9a18c9f38d09c145eb513ca989966dc135c1e9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 10:36:35 2013 +0100

    uxa: Check for allocation failure in i915 video
    
    For a large screen, we have to create a temporary surface for rendering
    the textured video. If this pixmap creation fails we may be left with a
    system memory only pixmap leading to a segfault.
    
    Reported-by: Bas Wijnen <wijnen@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 978b93a20bb2ba647138d0d8954fac60b215f7c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 13 10:34:50 2013 +0100

    uxa: Abort CreateScreenResources after allocation failure
    
    One of UXA's invarients is that the ScreenPixmap is complete (i.e. has
    an intel_pixmap private with a bo attached). If we fail to create that
    private during CreateScreenResources we will die very soon afterwards,
    so just report the failure and shutdown gracefully.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e914dada5595a24b5d0fada7e476cc93570fa7c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 17:14:36 2013 +0100

    configure: Allow manual specification of intel-gen4asm path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e3af6936ea26be57e80e09752a8736c9cfe2566
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 22:16:53 2013 +0100

    sna: Populate bo->size from dma-buf
    
    Recent kernels gained the ability to report the actual size of the
    dma-buf through an lseek. We can use this to set the correct size of the
    bo when available, overriding the guess provided by the caller.
    
    Suggested-by: Kristian Høgsberg <krh@bitplanet.net>
    Suggested-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0bd716425d1514b62565f9a65397cd1cb2ffb3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 16:22:45 2013 +0100

    sna: Sanitize output->crtc before falling back oto xf86InitialConfiguration
    
    During initialisation, we stash the currently attached CRTC id in
    output->crtc. This is fine as ordinarily we would not dereference
    output->crtc until after it had been assigned a real CRTC. However,
    
    commit 6fda305e2f2f991b39d09e67d0b17c8c3d50f9a4
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Oct 9 15:59:42 2013 +0100
    
        sna: Append the current mode to the output list if not found
    
    introduces such an early dereference and causes a crash if we fail to
    probe the KMS configuration (usually due to a user override).
    
    Reported-by: Łukasz Maśko <ed@yen.ipipan.waw.pl>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 700a845cc611f3e499cf0ff01bd99d472d6fd7ac
Author: Daniel Martin <consume.noise@gmail.com>
Date:   Thu Oct 10 15:24:26 2013 +0200

    configure: Add xfixes to X11 pkg check
    
    Add xfixes to the list of PKG_CHECK_MODULES for X11. '-lXfixes' was
    hardcoded in test/Makefile.am before. This could lead to a broken build
    in very rare cases where the build environment has all specified X
    libraries but Xfixes.
    
    Signed-off-by: Daniel Martin <consume.noise@gmail.com>

commit 79f8ff4bbb2f723ec21c150c0775e706bc00a834
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 12:42:12 2013 +0100

    sna/gen4+: Share a few common routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bd9d63a863b88ecd6f72c11468e0940f3bcd9fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 12:35:28 2013 +0100

    sna/gen6+: Share the common routines for ring preferrence
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ddcd8607027c67f8260ffd4eae8543f832885cb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 12:18:31 2013 +0100

    sna/gen6+: Only allow switching to BLT for fills if we have semaphores
    
    An extra caveat to these generations for
    
    commit 97d809c26bec2c0120f2dc0bcfd840379bd996fa
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Oct 10 00:15:55 2013 +0100
    
        sna: Pass usage hint down to render fill routines
    
    is that we don't want to incur ring switch overheads that may overwhelm
    any advantages from using the BLT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c99d44d7f09fc92daf64eee1f6f3300e11e1cf01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 08:32:51 2013 +0100

    sna: Prevent changes in tiling/pitch of existing framebuffers
    
    Reported-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97d809c26bec2c0120f2dc0bcfd840379bd996fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 10 00:15:55 2013 +0100

    sna: Pass usage hint down to render fill routines
    
    For the scanlines emitted for rendering Core drawing primitives, it is
    preferable to use the BLT engine, so pass those hints down.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b16999da214803a026d7246ec4aa62031e82dfc8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 9 23:54:57 2013 +0100

    sna: Upon unwinding operations, also check for exec objects to clear
    
    If we cancel an operation after partially committing it, we may leave
    the batch bookkeeping in an inconsistent state with an exec object with
    a zero-length batch. Ordinarily, this would not be an issue as we could
    pass the extra object to the next batch. However, if we switch rings, we
    need to clear the extra objects as they are currently flagged as being
    on the wrong ring, leading to hilarity.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9ad5b625e8935a3c115760bdd4738d4432542e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 9 17:18:43 2013 +0100

    2.99.904 snapshot

commit d1aa2ac5dddf6b8c8c1333aae415abda9ad72d85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 9 16:22:59 2013 +0100

    sna: Steal the current mode name
    
    Rather than duplicating a string, we can simply transfer ownership from
    the temporary mode to the mode list.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fda305e2f2f991b39d09e67d0b17c8c3d50f9a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 9 15:59:42 2013 +0100

    sna: Append the current mode to the output list if not found
    
    If for some reason the current mode on the CRTC (inherited most likely
    from fastboot) doesn't match any of the modes reported by the output, we
    end up with a stray mode that the client cannot control.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70132
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1cb39d0a86390b7ef704422a5b91f9a012d24a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 9 10:32:02 2013 +0100

    sna/gen3+: Flush vertex buffer after computing resize
    
    Upon aligning the buffer, we may enlarge the vbo to accomodate the
    vertex alignment and push the current index past the end of the buffer.
    Move the space check from before the alignment computation to
    afterwards.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38333443b804b9ac6517a7998551b229dc4d5c6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 8 16:12:06 2013 +0100

    sna: Emit DBG for when we fallback to xf86InitialConfig detection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 082c08789cf9a8c0cc2bf44d0fee579b96c0798f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 8 09:40:34 2013 +0100

    sna: Rework the num_threads refinement to avoid the division
    
    We can replace the division by a multiplication.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06a8ad9690590a605b1564012d062b98c60546a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 23:21:38 2013 +0100

    sna/trapezoids: Recompute num_threads to match range
    
    We need to be careful not to execute threads past the end of the alloted
    buffer by making sure the clip extents correctly align.
    
    Reported-by: Joseph Yasi <joe.yasi@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70204
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1fb4f60671cfb0e461a2e5969ee9d0f0e39d93a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 22:04:22 2013 +0100

    sna: Trim color cache allocation to a single page
    
    Instead trying to allocate 4100 bytes, fix the logic to only require a
    maximum of 4096 bytes in the cache buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55cd67485ff34a28ab8eaa7b1b6958b96c072317
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 14:06:31 2013 +0100

    sna/trapezoids: Only use a single thread to emit rectilinear spans
    
    If the trapezoids are rectilinear, they should hit a fast path through
    the span compositors and so threading them seems pointless. Expect
    possibily for inplace pixman operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55e0f4502657078a666761277bbac56a98b3780c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 11:56:23 2013 +0100

    sna/gen7: Rename debug option ALWAYS_FLUSH to ALWAYS_INVALIDATE
    
    This allows us to distinguish between the texture cache invalidation
    stage versus the opportunistic flushing, and test either.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eda87254937509502efacabaa6029a584f67764e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 11:54:59 2013 +0100

    sna/gen7: Tweak flushing
    
    We pre-emptively flush the render cache before reads as that seems to
    improve performance. Now try not flushing if we don't subsequently need
    to read from the render cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c651848cc3f3baec8fa0bcfc68faebd3e58c069
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 10:30:20 2013 +0100

    sna/trapezoids: Restore overflow check
    
    The range can indeed overflow, so promote the assertion back into a
    check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d462475b7ecca6eb001b521185d2f7286031a8d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 7 10:04:15 2013 +0100

    sna/trapezoids: Fix overstepping vertical edges
    
    Regression from
    
    commit c98b770a87a5ec5ed9dc0aa375ad173b0e98322e
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Oct 4 18:37:01 2013 +0100
    
        sna/trapezoids: Add a precise scan converter
    
    Reported-by: Joseph Yasi <joe.yasi@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70204
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3fe60c15763c02b3b6238c77e6350d478cd8982
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 6 17:27:22 2013 +0100

    sna/gen7: Add a always-stall debug option
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=68410
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7284e7f48b812948b40d67396214f7929c1c00eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 5 23:00:49 2013 +0100

    intel: Filter out the control bit from the device minor
    
    When computing the render node for the device, filter out the potential
    control node.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 524a45da56e2a052ffafa3887891caa90ba39f76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 5 18:42:24 2013 +0100

    compat-api: Map changes of DamageUnregister API in 1.14.99.2
    
    Reported-by: Emmanuel Benisty <benisty.e@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43d616066fc35e6ac2282c0a8c5f9a11aac7b4f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 5 09:48:03 2013 +0100

    sna/trapezoids: Do not pass invalid trapezoids to pixman
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xorg-server/+bug/1197921
    Link: http://lists.x.org/archives/xorg-devel/2013-October/037996.html
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c98b770a87a5ec5ed9dc0aa375ad173b0e98322e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 18:37:01 2013 +0100

    sna/trapezoids: Add a precise scan converter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27ad2fc1dcb2a6177eda7f1319b4f4eccdbea140
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 15:43:43 2013 +0100

    sna: Start splitting the trapezoids megafile into parseable blocks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 898087014c36c757f8d2e0087e63467192a52837
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 16:12:17 2013 +0100

    sna: Fix FillRectangles intersection with complex clip
    
    Lesson 2: Use the right variables.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70137
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20afd7263f65f29128fbbdbd5894a49594cda669
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 16:12:17 2013 +0100

    sna: Tidy up FillRectangles intersection with complex clip
    
    Lesson 1: do not accidentally overwrite the loop count inside the loop.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=70137
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22557b88d3c0bb8f883db7d0d0bf85f1255c65c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 14:14:19 2013 +0100

    sna/dri: Only move the scanout to the flip cache if destroyed
    
    Under certain circumstances, we can retire the pageflip before the
    client has updated its back buffers. This leads us to pre-emptively
    moving the scanout to the cache, when all we need to do (and will do) is
    report the same back buffer back to the client.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 394b2ce51d8378893f14896e600713544d473925
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 14:13:50 2013 +0100

    sna: Add a few more DBG to track refcnts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbf98d8963b53a3c68deb1e2624d1269c8b0d97a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 09:36:49 2013 +0100

    sna/gen5: Replace pipe-control with full MI_FLUSH for required CS stall
    
    It appears that we need top-of-pipe synchronisation for changing of
    certain state, and that the gen5 pipecontrol instruction is
    insufficient. So we have to fall back on the good old MI_FLUSH in order
    to make sure that the GPU invalidates its state correctly.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa439ffee4ea0926b382c0f0fb5d41feae9d0f8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 09:07:30 2013 +0100

    sna: The device fd is marked as non-blocking so beware the busy-wait
    
    During redisplay we wait for the pageflip result. If the fd is marked as
    non-blocking this results in a busy-wait, so insert a poll first to
    remove the busy-wait.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be177465498e35425d36be84bc55b64bf91be84c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 08:40:49 2013 +0100

    intel-virtual-overlay: Error out if no X11 SHM header is defined
    
    Make the error explicit rather than dieing later with unknown constants.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8aed266194ebff1ee2da1b9f3f69b4c6bdc8bed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 4 08:37:48 2013 +0100

    configure: Disable building tools if prerequisite headers not found
    
    After the pkg-config checks, we then probe the headers. If those probes
    fail, we obviously wish to prevent building the tools as the build will
    fail.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0476ee6d0770156098aa633018addfc607c8a99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 14:52:11 2013 +0100

    intel: Allow opening the device only through platform information
    
    Only fail to open the device based on the PCI address, if and only if we
    do not have sufficient platform information to find the correct system
    device.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a47f8683fefc9caa4df914de59929ae99823ca37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 15:58:26 2013 +0100

    intel: Handle fallback probing without match_data
    
    One extreme fallback path through the xf86PlatformProbe results in a
    call without any match data. As we have a device by this point, we can
    simply do a reverse match.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c157a925f258fd4c82cf0c3004e7d0056c1cd70
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 15:35:54 2013 +0100

    intel: Remove dependence upon having PciInfo
    
    After some probing mechanisms, we may end up with a valid device without
    knowing its PCI address a priori. Having a valid device, we can just
    query it for the correct device id, and can safely abort any path that
    requires PCI information that we don't have. (Those paths are not valid
    under such hosting anyway - if it may be required, we could reconstruct
    the address.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4685e79d1163325b78722c84ce173c91c217ac02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 14:42:45 2013 +0100

    intel: And restore PlatformProbe to working order
    
    In the saga of the untested WIP patches for hosted device probing, was
    the failure in logic to detect a valid device during probing. Yikes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58b26055f428fd6a99ffb889caa5e2472352b641
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 14:08:36 2013 +0100

    intel: Querying device attributes must be non-NULL
    
    Check first for a NULL platform device before querying the attributes or
    else suffer a segfault during PCI probing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7d5292e01fb43d93c13c60a3cef16d352307bdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 13:36:46 2013 +0100

    intel: Fix fallout from accident push of ODEV_ATTRIB_FD
    
    This is WIP for passing along a hosted fd. It wasn't meant to be pushed
    along with the bug fix this morning.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit adbf01306a9f42efb26a485a80c3c7f3918a48ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 3 08:29:08 2013 +0100

    sna: Restart timer evaluations if the BlockHandler takes too long
    
    Rather than passing a negative timeout to select, if we detect that we
    expired our timeout during the processing of the BlockHandler, restart.
    
    More worrying is that something in the BlockHandler took longer than 3ms
    to process.
    
    Reported-by: Felipe Contreras <felipe.contreras@gmail.com>
    Link: http://article.gmane.org/gmane.comp.freedesktop.xorg.devel/37388
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b3a5ca603baa611b36f51b800f3969f519bcb3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 2 18:29:38 2013 +0100

    intel: Query platform fd
    
    Under a compositor, we wish to use the pre-authorized fd passed to us by
    the host, stashed away in the platform device.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79785920485d0327d5512db0ed6f81bf4d4eeb90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 2 18:19:44 2013 +0100

    intel: Pass the platform device along to the open routines
    
    This allows us to pass along more metadata along with the platform
    device in future. Currently we pass the device path, but in a hosted
    environment we should be passing along the authorized fd from the host.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db1edf0e10c6d3665d3bb2ffd381b1ba722cad95
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 2 16:17:35 2013 +0100

    configure: Error out if glamor request but UXA is disabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a048f436a0210d076fc844404bf56b8b7fcb4b7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 2 14:59:11 2013 +0100

    sna: Only delete unused io buffers
    
    Before deleting the io buffer, we need to check that it is not active.
    Currently we check that it is not pending use in the current batch, but
    we also need to double check that it does not have outstanding use by
    the GPU. Failing to do so could mean overwriting the data prior to it
    being read by the GPU, a very small race but often hit!
    
    Reported-by: Vedran Rodic <vrodic@gmail.com> # and many others
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66990
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 660e9e14bd49fad75dd2fd73c285e035e2672da4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 2 15:01:53 2013 +0100

    sna: Add a few more asserts around handling of buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c724098f2215ff4f4193bbae3d8e42889701edf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 23:34:02 2013 +0100

    sna/trapezoids: Fix clipping on the far left
    
    Edges that extend past the left hand side of the clip box cannot simply
    be ignored (since they contribute to the scanline to their right, our
    region of interest) but they need to calculated separately rather than
    merged into the first cell.
    
    Reported-by: Pavel Ondračka <pavel.ondracka@email.cz>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=69469
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1cf8d5134d8c6e73135ce368be7d92d49a5e27d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 15:37:20 2013 +0100

    sna: Honour Option "AccelMethod" "none"
    
    If the user requests that acceleration be disabled either through
    AccelMethod or NoAccel, do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d6a9d4a422b351440df3496d3d6cdefa82ce6c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 13:27:19 2013 +0100

    sna: Only reduce Over to Src if the rects do not overlap
    
    Similar to the previous commit, we have to allow overlapping OVER
    rectangles to be drawn one after another.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9bce2303e3e51d2a703154869bb36564aad7921
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 12:39:51 2013 +0100

    sna: Do not reduce overdrawn rectangles for XRenderCompositeRects
    
    The specification is that each is drawn in sequence (so over top of
    earlier rectangles), so do not cheat by using the computed region.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66313
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0532b3cc3c98c255a64692094b9e258201422f85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 12:38:39 2013 +0100

    sna: Unmap cow bo when recreating the source bo
    
    When we destroy the original source and copy it to a new bo, we also
    need to make sure that any mappings of the original bo in the clones are
    undone.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aad53e37a7e6c842ae688df74a06024315e07ba2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 30 12:38:19 2013 +0100

    sna/gen3: Tidy up fallback handling from fill-boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c06e9576aa62290a133cea5158bb979284ac8a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 23:33:23 2013 +0100

    sna: Use the bo allocation cache for converting buffers
    
    Since we have a malloc cache for the bo, we may as well use it when
    converting from an upload buffer to a bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57c799deb01b8a5919f872926cf71f11cb3aee15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 23:33:11 2013 +0100

    sna: Whitespace fixes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81d00c51018464929cdb3755adb334cb9a89d166
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 14:29:06 2013 +0100

    sna: Apply the non-relaxed fencing partial paranoia everywhere
    
    This is required to ensure that the tiled offsets are tile-row aligned.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1232546
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0bb41d16f75901bc18b7024679e2b3a35fc14f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 13:33:26 2013 +0100

    sna/video: The sprite framebuffer also encodes its format
    
    So we need to check whether the cached framebuffer matches the requested
    format, or else recreate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0dd20381364aabede2e1306945abe21d57c1d7b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 11:19:46 2013 +0100

    sna: Resize an existing framebuffer if possible
    
    Sometimes we may have a compatible scanout cached, but of the wrong
    size. Instead of throwing away the memory and creating a new scanout
    from scratch, allow us to just resize the old scanout by destroying and
    recreating its associated framebuffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 902ce98df10c221e136c416f981c3a2730410415
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 11:08:19 2013 +0100

    sna/video: Don't allow caching of yuv scanouts
    
    We only want scanouts capable of being used for the front buffer in our
    cache, so make sure that YUV formatted fb are destroyed upon release.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a7587ca1c076f25eed67751f9a9e26c5dcd1692
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 29 10:57:23 2013 +0100

    sna/video: Discard old video buffers when the frame size changes
    
    Back in the good old days of the overlay, we only needed to care about
    having a frame buffer large enough to hold the data. This changed with
    the sprite interface which encodes the width x height into the
    framebuffer and so we need to be careful when handing back a cached
    buffer that it does indeed match the required dimensions.
    
    Reported-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36d142153b45f4c95d606d14bbbb51d8fdec5d2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 28 18:38:12 2013 +0100

    2.99.903 snapshot

commit 2c67e9da5fc4c47f3f67082bd4adaf80d9e7399f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 28 10:13:25 2013 +0100

    sna: Avoid reads from a GTT mmapped upload buffer
    
    We now allow LLC machines to also use GTT upload buffers, so we need to
    be cache when scanning the cache to look for suitable buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a5f9b2812a04721f9dbd67552a39c278cdde18b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 28 08:12:22 2013 +0100

    sna: OsSigHandler expects 0 on handled
    
    Returning 0 from sigtrap_handler() when we wish to fallback to the core
    OsSigHandler was precisely the wrong thing to do.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2893d2b51653cc254000454ad054cd9f0afb1291
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 27 19:52:30 2013 +0100

    sna: Fix regression in picture extraction
    
    This is a little helper function, that just returns a bool, not the
    error code used by the render backends. Instead the caller tries an
    alternative method of extraction before giving up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c9265ebff496a4d4f974768e264bd65babff97e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 27 10:46:40 2013 +0100

    sna: Only flush the scanout if we successfully upload it to the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47ac44159c0e3ea0c84510f1d58ac140344b5e69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 27 10:19:47 2013 +0100

    sna: Make sure we do not try to upload indirectly if the GPU is wedged
    
    Otherwise we trigger assertions and may end up with corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7206d0bb916fa69690a5f4fdcc5e7e81787c6c16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 27 10:01:34 2013 +0100

    sna: Disable the promotion of large bo as flush
    
    We can rely on our aperture and idleness tracking to appropriate flush
    batches. Marking the large bo as flush interferes with the treatment of
    flush for externally named bo, such as DRI/PRIME.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ac1ac98c28d38b539f465c5ac488d879f1c2ab6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 23:23:47 2013 +0000

    sna: Catch SIGBUS to prevent X death
    
    We know that when we access either a CPU or GTT mmap we are vulernable
    to receiving a SIGBUS. In fact, we can catch these and abort the
    operation preventing X and all of its clients from randomly dieing.
    
    This helps for instance if you try and use a 1GiB frontbuffer on a 2GiB
    machine...
    
    For complete protection, we also need to catch signals for all GTT maps,
    such as VBO and staging buffers. (TBD)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7025956558cfc391b553c9adb39d2a38fe494946
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 16:20:06 2013 +0100

    sna: Mark all large cached buffers as purgeable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 455754ca8d2762c6294e6db6b405da7959ab8a0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 15:41:36 2013 +0100

    sna: Make sure the transformed CRTC box is clipped correctly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec9ffc9e41e05bc6aef10e25ff82bb99b5f92267
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 14:54:18 2013 +0100

    sna: Trigger fallback after intermediate pixmap allocation failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bbfbe229542cc3278fea3c1865f28d65d3c154e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 15:14:29 2013 +0100

    sna/gen4+: Handle very large copies more gracefully
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d2840919fd00e4ae0bf1957f66009f55a01eb7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 15:30:58 2013 +0100

    sna: In desperation, query the actual available aperture space
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf1268838a30cca6a181c7804b0d2640dcf94981
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 14:48:31 2013 +0100

    sna: Drop the REPLACES hint for a pinned target bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50bd37cf7fb811001e79a27b35e5cd0544391cd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 14:09:54 2013 +0100

    sna: Simplify the clearing of a transformed frontbuffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9445af34a091f85d63f40982762fb58b267004d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 11:43:14 2013 +0100

    sna: Remove a bogus assert
    
    We keep active/inactive scanouts in the same cache, so drop the assert
    that they are all inactive - as it is handled a couple of lines later!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17f47afcbc5bbbebd2dfb97f7423514104da750d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 26 11:42:05 2013 +0100

    sna: Eliminate a DBG compile warn for 32-bit builds
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ef851b223253c38e6367efdeff6b4d551cd2b6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 15:07:48 2013 +0100

    sna: Promote self-copies to the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c7df83ca734c3d4206539c65d6f7a5c10537aa6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 15:07:24 2013 +0100

    sna: Micro-optimise copies
    
    Defer the read of the fExpose bit until we need it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7eb40efa79dd9ea720606b94a20179c7dd18e03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 13:54:43 2013 +0100

    sna: Check that the bo exists before attempting to undo it
    
    Fixes a NULL dereference from sna_blt_composite().
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1228677
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a934b2455a7b67d124903ab086a323169f0b4d69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 12:06:56 2013 +0100

    sna: Add a few more asserts around tracking of bo->exec vs bo->request
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 598dae9af99495cb738c6ddbe8602f8fa19dc0df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 10:53:11 2013 +0100

    sna/gen[35]: Remove dead code for choosing between BLT/render composite
    
    For these gen, we always want to use BLT where possible - even if it
    incurs a context switch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a05b1a4aa96f4d4484e7397b8e8d901819a3799
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 25 10:52:17 2013 +0100

    sna/gen6+: Fallback to BLT composite if fallback is forced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5dfe9217f21870c2b3563fb2337254db316eea72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 24 13:48:28 2013 +0100

    sna: Clear CPU damage when uploading partial images inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53b43673efed4d82b6dd498e9b76892e3e5b13e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 24 13:44:59 2013 +0100

    sna: Add some DBG for early flushes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad0390068832ad4727371902fe41a85a53de1894
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 24 10:00:03 2013 +0100

    sna: Separate out copy preferrence from operating in place decision
    
    The two decision trees are no longer identical.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63a81c87b1be3607243aaa0acc4cb669fee02b4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 21:08:13 2013 +0100

    sna/dri: Prevent a NULL dereference in a DBG msg
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fd116782bb1c05a140f4783e92a8ee6a57143cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 21:03:07 2013 +0100

    sna/dri: Clear the clear hint upon applying DRI damage
    
    Otherwise a later call to GetImage will not notice the DRI update if it
    was already clear - and so return a blank image. One example is the use
    of x11vnc replaying xbmc.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=69730
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f54e9d3c43c04be0d405a94ae5a9d8fe8f8d75b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 19:34:25 2013 +0100

    sna: Check OPTION_PREFERRED_MODE rather than M_T_USERPREF
    
    During the intial KMS probe, we do not yet have the list of output
    modes, and in particular do not have the list of user preferred modes.
    So, in order to honour the user preferrence, we need to query for any
    preferred mode on the output from the option list.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Bugzilla: https://bugzilla.novell.com/show_bug.cgi?id=841696

commit 3e276b96cb57050a9aa8ebfb210e3c4b7b2fe137
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 14:15:59 2013 +0100

    sna/video: Add always-on-top to the list of Xv attributes
    
    Otherwise it goes unknown, and not reported by xvinfo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4850bbbccfc86ce36fae103038e91d5034dc517
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 11:54:47 2013 +0100

    sna: Fix cast from u64 to pointer for 32-bit hosts
    
    Missing chunk from
    
    commit 42330fbae862cda9ca17ec62eb0d2e4fb86032b8
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Sep 22 14:39:57 2013 +0100
    
        sna: Track CPU/GTT maps independently
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bee26a8e2eaefdcb2072ce8ba92585d3bf713c82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 09:46:36 2013 +0100

    sna/dri: Sanitize the backbuffer flip cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4f5da7ab9e02c3994fe9668630480f85e706e89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 23 09:45:13 2013 +0100

    sna/dri: Report saner target_msc values for vblank_mode=0
    
    If desired target_msc is 0 report 0 rather than (CARD64)-1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f296872f373d3439b08e055b03584763e6c2ffec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 22 17:29:33 2013 +0100

    sna/dri: Fix SwapbufferWait
    
    A regression from
    
    commit f99e49f7642545f75bac682274767c45c2e6192a
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Sep 17 09:15:40 2013 +0100
    
        intel: Make the option to control VSync and PageFlip explict
    
    which used the inverse meaning of the option to disable waiting on
    swapbuffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42330fbae862cda9ca17ec62eb0d2e4fb86032b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 22 14:39:57 2013 +0100

    sna: Track CPU/GTT maps independently
    
    Now that we use CPU mmaps to read/write to tiled X surfaces, we find
    ourselves frequently switching between CPU and GTT mmaps and so wish to
    cache both.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd130d1b06e8828d7a2471761bac36093b9a2391
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 22 13:11:50 2013 +0100

    intel-virtual-overlay: Grab the server around mode manipulations
    
    Prevent other clients from seeing the intermediate states.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8478e9c44477094e32868e2bb06d8d0077aabe62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 22 10:32:24 2013 +0100

    sna: Both clear PolyGlyph and ImageGlyph are no-ops
    
    For ImageGlyphs, we pre-clear the area hence the bg is always set.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 395f07b1fe950ad09d439a0b9eba1792ba6a245d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 22 10:31:15 2013 +0100

    sna: Undo region translation after failing to begin ImageGlyphs
    
    If we fail the initial tests, we need to undo our translation to the
    region before returning and starting the fallback paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2851b7747bc8e143aa5c6209b8800eeccb629058
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 20 18:20:39 2013 +0000

    sna: ImageGlyphs completely overwrite the destination
    
    So we can use the usual rules for discarding unused reads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27f87a56e9fe8cb0e3f41ddac9b3511d0316b436
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 20 18:18:54 2013 +0000

    sna: Don't set the mapped hint for inplace tiled accesses
    
    The mapped hint is only useful for coherent mappings where it is
    preferable to guide placement of regular operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 799f1e2355999fb8691cffee4033847c1d2c640b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 20 15:51:35 2013 +0000

    sna: Prevent invalid use of set-write-domain on scanouts when debugging
    
    One debugging option forces the use of the write domain when
    synchronising to force a full synchronisation. This trips up an
    assertion to catch when we try to move the scanout into the CPU write
    domain. So don't.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 011636d25be6b42ea1cf76e312d3abdf3855349d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 20 18:57:11 2013 +0100

    intel-virtual-output: Hide the remote cursor on initial connection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4497212307dee5e35bc6836201738a2fdb559020
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 17:03:40 2013 +0100

    uxa: Do not change DPMS mode on unconnected outputs
    
    The operation is in theory redundant, and in the case of Haswell where
    we have multiple outputs aliasing to the same encoder, actually harmful.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68030
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: Stefan Dirsch <sndirsch@suse.de>

commit 63a070a31a3963f836539ee7629d64fe3c9f88c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 17:03:40 2013 +0100

    sna: Do not change DPMS mode on unconnected outputs
    
    The operation is in theory redundant, and in the case of Haswell where
    we have multiple outputs aliasing to the same encoder, actually harmful.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68030
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 011e567e84ce4487dd6e35f4c62682b4cbb66fe9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 16:30:59 2013 +0100

    sna: Add output names to DBG dpms changes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e1abe3cd01e5ea1fcb38c628d3ef81ecc0dae97
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 19 12:07:04 2013 +0100

    sna/gen4: Remove long dead code for forced batch emission between CA passes
    
    Forcing the batch emission on virtually every glyph eats a lot of CPU
    time sending very short commands to the GPU, and is totally unnecessary.
    
    Reported-by: Arkadiusz Miskiewicz <a.miskiewicz@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6316905983fe1fb4828ff1039923327f467306fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 19 11:28:30 2013 +0100

    intel: Fix includes for intel_options
    
    In commit dcf9b5ae1889926007cf8a0efd127e9df3c909de
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Sep 17 22:27:45 2013 +0100
    
        intel: Compile fixes for base install of SLED11.sp3
    
    the includes were juggled around to avoid pulling in xorg-server.h
    outside of the driver. However, missing xorg-server.h leads to subtle
    bugs in the layout of structures, in this case breaking xf86Options.
    
    Reported-by: FBrown <francisbrwn9@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=69555
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afad7dd43d935a4666bff6c2964714209e851221
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 15:34:36 2013 +0100

    sna: Pushed dixPrivateKeyRegistered wrapper into compat-api.h
    
    Move the wrapping out of the main code body and hide it with the others
    in our compatability header.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53574e4f4ffe97f69c31ee74adceb81c8442c365
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 15:28:09 2013 +0100

    sna: Wrap use of dixPrivateKeyRegistered for uevents
    
    SLED11 also requires us to poke around in the privates as it does not
    provide the more recent privates API.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcf9b5ae1889926007cf8a0efd127e9df3c909de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 17 22:27:45 2013 +0100

    intel: Compile fixes for base install of SLED11.sp3
    
    Highlights of that distribution include xorg-xserver-1.6.5, kernel
    3.0.76 and gcc-4.3.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97b443f589fb62ba060f09a371be273549f524d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 11:44:53 2013 +0100

    sna: Fix off-by-one in computation of valid CRTC mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efffc42f227131792920391f9a87238743b2c490
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 18 11:43:24 2013 +0100

    sna: Disable same-edid detection
    
    The kernel is quite able to return the same id for new edid. :(
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 825557ce44b16b59438df31fd6df2ed82462be89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 17 10:12:13 2013 +0100

    sna: Clamp the possible-crtc mask to the real CRTCs
    
    A minor bit of sanitizing of the kernel output.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f99e49f7642545f75bac682274767c45c2e6192a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 17 09:15:40 2013 +0100

    intel: Make the option to control VSync and PageFlip explict
    
    Too often our implementation of vsync or pageflip is buggy, or for some
    other reason it is desired by the user to disable those code paths. Make
    it possible once again by restoring the Options for the user to control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76790db4e6b33a439a6426ec73547904a50047c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 12 14:50:37 2013 +0100

    test: Exercise flips/blit swaps on each pipe
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf4be323e377ab3a2741bf97d8f42fbbc4ccd449
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 12 13:47:18 2013 +0100

    sna: Fix declaration of write intent for can_map__cpu in PutImage
    
    We always are going to write to the image, despite the flag set in
    
    commit fa961ec99a67266687a1934eea24138cf2f7ad19
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Jul 21 18:00:22 2013 +0100
    
        sna: Allow linear inplace uploads along the tiled X PutImage blt paths
    
    which was accidentally conditional on the image not being too large.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fb651cb5f6086121d9ad9182e2374d90470ecce
Author: Ross Burton <ross.burton@intel.com>
Date:   Wed Sep 11 21:28:05 2013 +0100

    test: only build DRI2 tests if DRI2 is enabled
    
    Signed-off-by: Ross Burton <ross.burton@intel.com>

commit 815caa9fc660a4eec15992a52b0f8ff9c3c71c55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 11 10:09:52 2013 +0100

    sna/gen4+: Rebalance creation of vbo during batch flushing
    
    We need to be careful not to copy too much data during the vertex flush
    or else that becomes the rate-limiting step. The goal here is to do the
    early flush to warm up the GPU, then transition to larger batches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d05a69bd74dc02fb1360c9393de905b8842e1fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 11 10:18:51 2013 +0100

    sna/gen4: Always try the BLT composite routines first
    
    Given how fragile the render operations are, taking the hit from
    transitioning from the slow render operations to the comparatively fast
    BLT (when possible) is always worth it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a66d77efa53cff83e9711786c39e8ebff8dd26d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 10 12:29:24 2013 +0100

    sna: Disable use of Y-tiling for gen4
    
    This problematic GPU still seems to like to fallover when faced with
    Y-tiling. It was reserved only for use with glyphs, but even that
    occasionally runs into trouble, so disable all selection of Y-tiling for
    our own use.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1222203
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ff8eb2b38dc705f5c86f524c1cd74a811a7b04c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 9 16:23:04 2013 +0100

    sna/hsw: Scanline waits require both DERRMR and forcewake
    
    Oh my, bspec is missing a few details on how to perform a scanline wait
    on Haswell. But by using the extra steps required for Ivybridge, we can
    successfully send events from the scanout to the BCS ring. Sadly this
    again means that to use vsync on Haswell requires preventing the GPU
    from sleeping whilst it waits for the scanout to advance.
    
    Reported-by: Dan Doel <dan.doel@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=69119
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbe75982457cfe6bb1f7422a517ced32cc74f909
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 9 15:35:42 2013 +0100

    sna/hsw: Fix the event selection for scanline waits on pipe A
    
    Hmm, this should have meant that we never actually waited for a
    scan-line on pipe A. I wonder if it even works...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 144d97046156a3f7785f98c4f7dbed3fd8f5b7af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 9 15:34:41 2013 +0100

    sna/gen6+: Only apply the BLT copy w/a for self-copies
    
    A missing check along the copy_boxes() path to bring the w/a into line
    with the other paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af4215dd7fdf16b9886cff74765d6865bd743ddb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 9 15:02:28 2013 +0100

    sna: Call the new __offset functions in the last commit
    
    Sigh. I added the new functions for the asserts, updated the parameters,
    but forgot to change the actual function themselves.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d5df67b3e4ed5d5b9f1aabf01b5657d4c9eeac7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 9 11:19:19 2013 +0100

    sna: Remember to offset the box before asserting damage
    
    When using sna_copy_boxes__inplace(), we need to remember that the
    region is in destination space, so we need to offset the boxes when
    comparing against the source. The assertion forgot to do so, and so
    failed as soon as it met a little complexity.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 634748486f33658f09c8a7f4508840fad6df85f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 8 23:02:29 2013 +0100

    sna/gen4+: Flush batch if idle on filling vbo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77d74ec777d511df6f5aa484f3b7752f2c0b96ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 8 22:34:09 2013 +0100

    sna/gen6: Prefer the RCS on large GT systems
    
    For SNB, the different between RCS and BCS is more marginal but it is
    slightly in favour of using rendercopy on GT2.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 287727ee223d56705e5792fe0a6c9a99077559e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 8 17:59:10 2013 +0100

    sna/gen7: Prefer the BLT for gt1 systems
    
    On gt1, the BCS is faster than the RCS for all equivalent operations,
    unlike gt2+ where the RCS is faster (but at greater power draw).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f25235a854e211f73cc44821b9a7c2a1a4092155
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 8 16:36:33 2013 +0100

    configure: Only assert DRI2 requirements not met if the DRI2 package is missing
    
    The new error message was added in
    commit ea30967245707ca4825de154e589a83dc605dae0 [2.99.902]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Sep 6 22:54:48 2013 +0000
    
        configure: Disable UXA build without DRI2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ceba648211009a464e46855a52737219ab9b534
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 8 13:51:14 2013 +0100

    intel-virtual-output: Debug option for forcing full redraws
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=68987
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a6517c748c33a73c92ca67cae9bfb00d48d2382
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 7 22:07:04 2013 +0100

    sna: Only update the CRTCs after a resize if master
    
    It appears possible to race the framebuffer resize with a VT switch and
    so end up attempting to update the CRTCs whilst master. The code
    complains, but in reality we can just ignore the requested change until
    we VT switch back and then apply the updates upon restoration of master.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ee7e373f24b0c4604dbf67f7ff82bdb7edc55d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 7 17:27:20 2013 +0100

    sna: Split get_drawable_deltas()
    
    In some cases we know we only have a window, and so may skip a
    conditional.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 218c9901e55e10fb5bc0c2a4caa04b1bee741a25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 7 15:16:51 2013 +0100

    NEWS: Fix release dates, missed the transition to September

commit 58a7611ccfda88c7cbcc62b25b787d6b0fa64081
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 7 08:45:12 2013 +0100

    2.99.902 snapshot

commit 0c697aee9b3767be7d1e04e4e4f9d304f23b188a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 7 08:42:26 2013 +0100

    Revert "sna: Add XMir support"
    
    This reverts commit 42d94356f65972eb7fb8991234a4e9388c4c2031.
    
    Ordered-by: The Management.

commit ea30967245707ca4825de154e589a83dc605dae0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 22:54:48 2013 +0000

    configure: Disable UXA build without DRI2
    
    DRI2 is interwoven into the UXA structs, so simply disable building UXA
    if DRI2 is not available.
    
    Reported-by: Ross Burton <ross@burtonini.com>
    Bugzilla:  https://bugs.freedesktop.org/show_bug.cgi?id=69056
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fdaeec8f2ada82f790dcbd0018215103447a478
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 22:50:06 2013 +0100

    sna: Search /sys/class/power_state for the AC adapter
    
    The adapter names are not uniform, so we need to scan the directory and
    find the entry that corresponds to the Mains power supply. However, the
    acpid does continue to report generic ac_adapter events.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0485cdfb6dc8e51d57406f633d55f8a8ac1a0208
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 20:46:36 2013 +0100

    sna/dri: Only the BackLeft merits special allocation flags
    
    As the BackLeft is the only that couled be flipped, it is the only one
    that may end up as the scanout and so is the only one that should be
    allocated from the scanout cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 489a93e4cc2e14e25339693933dddf4946717f11
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 15:14:46 2013 +0100

    sna/gen6+: Switch to using the BLT more often when off AC
    
    The BLT is more power-efficient for the operations it can handle, so use
    it when possible (following the usual caveats) if we know we only have
    battery power.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2ed1ac7b9807106405bbc2b18159a39c2d407d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 15:07:43 2013 +0100

    sna: Listen to ACPI events for power state notifications
    
    When on-battery, we would prefer to use more power efficient operations.
    For example, the BCS is far more economical to more data around with, but
    it doesn't have quite the same throughput as the hungry RCS. (Not that
    there is any reason why, the BCS is supposed to run at full memory
    speed, unfortunately that is main memory speed and not the caches...)
    
    Note: that X already listens to acpid for video switch notifications, it
    would be useful if we could extend that interface to emit power
    notifications as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56f532db2c9563c6d70da388f987f26530dcd38d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 12:48:06 2013 +0100

    sna: Prefer to reuse CPU bo if it was last active rather than inplace uploads
    
    This helps short-circuit writes followed by immediate reads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7656755c9d5ac83848f924df3f6faa79a2a7955a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 12:18:51 2013 +0100

    sna: Keep the CPU bo around if it was recently active
    
    Rather than always switching over to using the GPU bo and immediately
    discarding the CPU bo, keep it around as we may want to reuse the cached
    data.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a1f2ab84cfbcc1d37ae21de9a0ce6f1b5768e12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 11:43:24 2013 +0100

    sna: Try an inplace CopyArea fallback first
    
    This applies the copy-from-tiled-X GetImage optimistion to the
    ShmGetImage paths - when we don't have userptr available.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b2e11ab3c81e74d37180aeb2bb1fce9bcd3870c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 11:12:28 2013 +0100

    sna: Rechain up SetWindowPixmap upon ScreenPixmap change
    
    Fixes regression from
    commit d2f19d5a1f4d1c9521fb4801c9fb649d19746150 [2.99.901]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Sep 3 19:05:41 2013 +0100
    
        sna: Tidy walking the window tree for updating our pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b1ac5193ead52dc32bf31f851d04600ea81ab1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 11:11:47 2013 +0100

    sna: Include some DBG for the virtual output detection
    
    So we can see it in the logs along with the regular outputs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccd605c492ef3fd657bc40ede3f318e7dddbd7a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 00:33:29 2013 +0100

    intel-virtual-output: Unregister our singleton on a clean shutdown
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c5caaf0a98c88f6d39be9e78f8427f05975cb0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 00:30:53 2013 +0100

    intel-virtual-output: Only wake up for a change in a visible cursor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91b1f77da59ab7951e5d9aa09cbc0d2335d4c62a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 6 00:23:37 2013 +0100

    intel-virtual-output: Make the flush for recreating Damage explicit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3979d11677bb4eb54099b9a8d0a28d4807828223
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 23:28:16 2013 +0100

    intel-virtual-output: Just request Damage BBox
    
    As we ourselves only track the BBox of damage on the virtual outputs, we
    can ask X to amalgamate the damage events as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0baac6bba72638a69b6cb04c74493ee48e253884
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 23:08:40 2013 +0100

    sna/gen6+: Don't request extra caching for use-once upload buffers
    
    As we only use these buffers once, we should not benefit from requesting
    them to be moved into L3/LLC cache - over and above the default
    recommendations we make when creating the buffer. Indeed, this may even
    lead to artefacts if we fail to invalidate those other caches when
    reusing the buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2263f8f26fb3c4fabceac2e192e95c5d26a4d173
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 21:55:49 2013 +0100

    intel-virtual-overlay: Reset damage across modesets
    
    Some versions of the Xserver lose Damage tracking across the modeset,
    causing a loss of damage notifications and repainting to cease on the
    virtual outputs. We can workaround this by reattaching the damage every
    time we receive notification that the local Screen configuration
    changes.
    
    Reported-and-tested-by: Severin Strobl <fd@severin-strobl.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68987
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5dea07c31d4d57d8d9aff68f2a9ffd73e828643f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 21:25:00 2013 +0100

    intel-virtual-output: Reset the damage just prior to reading it back
    
    Slightly more efficient command packing and reduces a damage race
    slightly...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bae41624874fa032c407f4888e7db9a07f8f1d0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 21:23:56 2013 +0100

    intel-virtual-output: We don't need to enable the timer for reconfigure
    
    The timer will be enabled if a reconfiguration actually takes place and
    we mark the damaged region to be redrawn.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9a48bd0a3cd3ca99b29a4038ea16a87771bfe31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 20:52:11 2013 +0100

    intel-virtual-output: Just walk the list of clones attached to the display
    
    Rather searching the entire array of all clones, just walk the presorted
    list from the display.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b57dfc53312d9d7f30bfe45af44036b4c3c03790
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 19:40:07 2013 +0100

    intel-virtual-output: Defer reenabling damage events until after we draw
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12de799598ffbbe056bd4455efefa62d4b081d98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 19:36:13 2013 +0100

    intel-virtual-output: Flush the damage received message back to the local display
    
    After processing the Damage notification, we need to send a message back
    to the Xserver to clear the pending damage before we will be sent more
    events. To make sure that message is sent we need to flush the output,
    as we may never flush the output queue otherwise.
    
    Reported-by: Severin Strobl <fd@severin-strobl.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68987
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ce52e93315afe7fdb33c315705fe22e69eb908c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 18:11:09 2013 +0100

    intel-virtual-output: Track active clones
    
    For the frequent operations, such as moving the cursor or updating
    damage, it is more efficient to walk the list of active outputs (as the
    discrete GPUs support lots of outputs!)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f01c5eae2a3d6efebe9332a8654303356e622bec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 17:48:20 2013 +0100

    intel-virtual-output: Reserve space for the '\0' in the sprintf
    
    Even though we don't use the trailing NUL byte for our comparisons,
    sprintf will write it, so we need make space for it.
    
    Reported-by: Severin Strobl <fd@severin-strobl.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68987
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6bb553b7482de4d52b6914e8eac09f2e6014714
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 5 14:42:18 2013 +0100

    sna: Add a DBG to track calls to SetScreenPixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94bc69d5b9a0380cdd9941183b3b1c8e9beb8da5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 4 13:49:56 2013 +0100

    2.99.901 snapshot

commit 4dfd7674d88a267d0d89c31422f2e6c333ccf176
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 19:48:38 2013 +0000

    intel: Select SNA as the default acceleration method
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42d94356f65972eb7fb8991234a4e9388c4c2031
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 24 01:44:30 2013 +0100

    sna: Add XMir support
    
    With lots of updates by Christopher James Halse Rogers as he updated the
    XMir API - but now supposedly frozen!
    
    "<RAOF> ickle: I think the xmir api should be pretty much stable now,
    barring people coming up with more awesome ways of doing things."
    
    Signed-off-by: Christopher James Halse Rogers <raof@ubuntu.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f906a4de62856df5b2536ce9704750c3530636fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 4 15:08:56 2013 +0100

    sna: WriteThrough support is now upstream
    
    Now that the WriteThrough ABI is upstream, we can rely on runtime
    detection of the current interface.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f49a413aa812e6f41826d6d1099927e1164353b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 4 14:33:15 2013 +0100

    configure: Check for required UMS headers before enabling
    
    Prevents the build failing with i810 if we can not find vgaHW.h
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ecb3c303f8f62f5232f3e49c8df4193ea478be13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 4 12:09:25 2013 +0100

    sna: Fix sna_pixmap_move_area_to_gpu() to return the sna_pixmap
    
    Like it's sibling sna_pixmap_move_to_gpu(), it helps to know the private
    sna_pixmap after the operation rather than just a boolean success/fail
    result, and make it more robust in the process.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad774cf3a299b220f9f2a0bed52c8fa979959426
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 4 11:37:01 2013 +0100

    sna/dri: Refine proposed async swap interface
    
    The latest proposal for passing swap_interval==0 is through the normal
    ScheduleSwap() call, so we can remove the specialised function.
    
    Link: http://lists.x.org/archives/xorg-devel/2013-September/037661.html
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2f19d5a1f4d1c9521fb4801c9fb649d19746150
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 3 19:05:41 2013 +0100

    sna: Tidy walking the window tree for updating our pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47e718bf321f6fe80dc5f797f433b00bc8de91c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 3 17:37:33 2013 +0100

    sna/dri: Handle failure to move the pixmap into the GPU for CopyRegion
    
    It should not fail, except in extreme cicumstances, and even then we shall
    not crash.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c51cd4e9122b7b8ec54c24cdef6d47edc63d1d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 3 17:36:33 2013 +0100

    sna: Mark imported PRIME fd as starting in DOMAIN_NONE
    
    Or rather, do not assume anything about the initial domains.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92b750066834195803c9ad65b94184efa5db6e76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 3 16:25:41 2013 +0100

    sna: Add some more DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efc960b1358d12de6c806a655fabade7278e0651
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 3 01:00:23 2013 +0100

    intel-virtual-output: Clear send flags when doing XSync
    
    When falling back to using XSync rather than XSendEvent it is imperative
    that we remember to clear the flag so that we don't keep on performing
    the synchronous RTT every time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f090044d1de4160777963910df3586bdf0186dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 23:52:52 2013 +0100

    intel-virtual-output: Remember to mark the timer as active when moving the mouse
    
    Otherwise we throttle mouse updates to the next display update...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91aca61c83f0905d1f6446dba56c5f67d91efb6f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 23:27:27 2013 +0100

    intel-virtual-output: Don't clobber the XID inside the ShmSegmentInfo
    
    As there is an XID inside the ShmSegmentInfo we cannot share one between
    both endpoints, or else it gets clobbered and rendering is lost (unless
    by happy coincidence the last XID is available in both Xservers).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d54f0fa16ddb3985ace02544fc2a58926aed7115
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 22:56:03 2013 +0100

    intel-virtual-output: Remove the stray 1
    
    The 'output-is-changed' flags was accidentally initialised to 01 rather
    than 0, causing all attached outputs to be considered to have changed
    everytime.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84b66849fc005365e71a40517c192e0cd178a82b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 22:55:17 2013 +0100

    intel-virtual-output: Don't set the SHM active flag along !SHM composite paths
    
    Otherwise we may end up waiting for an event that will never be sent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13a28f607f0eb4b4906e856c3f75f53446f4f999
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 22:37:23 2013 +0100

    intel-virtual-overlay: Try to shutdown gracefully
    
    Attempt to clean up the VIRTUAL mess when we exit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6e6572ac8f15bfee204cdf6bee4661ee2c6ffbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 22:27:42 2013 +0100

    intel-virtual-output: Fallback to probing GetScreenResources
    
    If the Display doesn't support the more recent non-forced-detection
    GetScreenResources, use the older version instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c5d269f259dd247c04a374467577cd47cc2cc27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 22:07:46 2013 +0100

    intel-virtual-overlay: Keep bumblebeed awake
    
    bumbledeed will shutdown its Xserver when the last connection to it
    closes. For the moment, leak the control socket so that the display
    stays alive. However, we will want to attach to any Xservers created by
    bumblebee as opposed to creating them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8dc27e00ef052c585abaa27c09f564c1548c87b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 21:53:37 2013 +0100

    intel-virtual-overlay: Disable the timer after flushing
    
    As the flush may queue work that causes the timer to be reactivated
    prior to draining the queue, we need to flush first then turn off the
    timer if idle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3558251777ab71b2a505d7acb2edd35d05b0d58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 21:46:35 2013 +0100

    intel-virtual-overlay: Don't do a sibling search if bumblebee is explicitly requested
    
    If either all or bumblee is explicitly requested, don't automatically
    perform the other search.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2f7f85cd20fb3a2bb3dba8c9be7ff21d2a8c049
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 21:41:48 2013 +0100

    intel-virtual-overlay: Fix the bumblebee query parsing
    
    It supplies both a trailing newline, NUL byte and length.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fed6e24996eb0fcfeec19341ce4103e7e7eb2d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 21:19:24 2013 +0100

    intel-virtual-output: Perform pixel type conversion from XfixesCursorImage
    
    For whatever reason, Xfixes uses "unsigned long" in its protocol
    definition for the cursor pixels.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b955622cc25ab12305a572901a8ed0f23896dab3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 20:45:12 2013 +0100

    intel-virtual-ouptput: Filter and rate-limit cursor events
    
    Make sure we are not responding to cursor motion on other screens, by
    checking for our root window.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5af9d69485a241156c343b67a741bc024e3f6edf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 19:50:17 2013 +0100

    intel-virtual-output: Reorder the fds
    
    We can't place the record fd at after the displays as we may wish to
    clone more displays later and use the simplification that they are in a
    linear, contiguous block at the end of the fd array.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88d43dc2aea1ee4b8a3248bf442f5be362b32fbe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 17:30:15 2013 +0100

    intel-virtual-output: Refactor the image resizing code
    
    And add lots of debug and robustness.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b07f16ffeb3152817e9e4f77ca0f2c403fb9040
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 18:10:27 2013 +0100

    intel-virtual-overlay: Fix logic inversion from previous commit
    
    "if (!active == 0)"
    
    Whoops, but keep the debugging that highlighted the error.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 088ff35b3941724c59707cf7971c09f9a15e5ddb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 16:51:57 2013 +0100

    intel-virtual-output: Don't forget to name the mode
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b3669548abf9a3c562b468359d8bee1cc86fb32
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 16:13:38 2013 +0100

    intel-virtual-output: Fallback to Xinerama if RandR is not supported by the target
    
    With Xinerama, we do not support reconfiguration of the target's CRTCs
    but we can still paint!
    
    This will require some more work to try and minimise the incompatibility
    between configuring Randr displays locally and the static arrangement
    remotely. But you can paint!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ee287af222552f4968f7d78ebc748db5bed5963
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 15:42:09 2013 +0100

    intel-virtual-overlay: Prevent buffer overrun reading the XEvent
    
    When calling XNextEvent() you must provide it with space for any event,
    i.e. XEvent, and not be tempted to pass in the specific type you are
    waiting for!
    
    Reported-by: Philipp Adolf
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd5f17ed3adf0c4e7c642f685f61766d12247c0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 15:13:44 2013 +0100

    intel-virtual-output: Decouple the fake mode before deleting
    
    When we install a fake mode on the output, we have to perform a
    round-trip for a reprobe. During that time, some other client (such as
    gnome-shell) will be notify of the change in output status and may
    attempt to configure it. This leaves us unable to delete the mode as it
    is currently active - so first disable the new head and then delete the
    mode.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 529db4d5edf396757f4f10a2b3aac55ad7e0bbc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 13:04:49 2013 +0100

    sna: Check for output->randr_output before dereferencing
    
    As we may call the ->detect() routines during the fallback initial
    probing, we need to handle the case where the output callbacks are
    called before RandR is setup.
    
    Regresion from
    commit 8ecb758697af42e8e68edee0d1945986470a9c04
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Aug 31 19:44:50 2013 +0100
    
        sna: Expand the array of fake outputs if the last is used
    
    Reported-by: Andreas Reis <andreas.reis@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68843
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ac895fccba72c6d4c0e754ab5298ece7dc8632d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 13:03:33 2013 +0100

    sna: Process winSize region
    
    Sometimes the window size is not a simple box, but a full region. In
    which case we do need to process it and not just assert that it is a
    box!
    
    Reported-by: Jiri Slaby <jirislaby@gmai.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 962460c0e1a22c3db9c1a25227eb9f1d1f1542d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 2 12:33:55 2013 +0100

    intel-virtual-output: Probe and automatically enable sibling screens
    
    Look for screens on the same display that we can enable automatically.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5fdbf6f23c2e90235f511714481bc9250f60020
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 17:08:54 2013 +0100

    intel-virtual-output: Add missing whitespace, s/while(1)/while (1)/
    
    No functional changes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8654bd7f6670a55b53ad6a7d0f14fe446124d41a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 17:07:49 2013 +0100

    intel-virtual-output: Restore the lost POLLIN on the timerfd
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f03cafcb5f1a5b5a23006ced78a4db5ff6659fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 16:50:22 2013 +0100

    intel-virtual-output: Refer to the new memory block after realloc
    
    When updating pointers to point into the new memory block after a
    realloc, it helps to pass the new locations around rather than the old.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e6472cfccb66d961efa3acbdbfa4057413cbcaf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 16:44:14 2013 +0100

    intel-virtual-output: Rebuild pointers after realloc
    
    If reallocs gives us a new memory block, we need to update everything
    that pointed into the old blocks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a41acee7282f007ed8e589395597f8aea3b22361
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 13:56:18 2013 +0100

    intel-virtual-output: Register as a singleton
    
    If the user tries to use multiple commands to combine multiple displays,
    reroute those to the first instance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f75e95f26a48929e5b996a825be8a222c07aa6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 11:49:18 2013 +0100

    intel-virtual-output: Fix overun with the record Display connection
    
    When converting to the auto-extending arrays, I forgot to include room
    for the extra connection for the recording Display. By using an
    explicit variable within the global state it is a little more clear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89dc44ae4550162fe12ce0dd68c5e7f072558fc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 11:46:26 2013 +0100

    intel-virtual-output: Prevent cloning the same output twice
    
    And prevent cloning the localhost! The caveat is that the transport
    string (Display name) must match, so it still would be possible to
    connect to the same display with different transports (local sockets and
    TCP sockets for socket) and so cause confusion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1d277db9b94b7145347130e564fc3d5713ecd0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 1 00:45:51 2013 +0100

    intel-virtual-output: Manage multiple destination CRTCs
    
    Don't try to assign all the remote outputs to the same crtc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47b7e334c1c66f4649b09e08bd93fb112399d1d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 22:39:18 2013 +0100

    intel-virtual-output: Try to hide races with gnome-shell
    
    As we try to create VirtualHeads, gnome-shell tries to enable them.
    Leading to a lot of flashing and extraneous modes appearing. Without
    being able to grab the screen configuration for the duration of our
    pruning, there does not seem much we can do other than try and squelch
    the worst of the errors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7228bd391049be2d07c27dcf88edc2d5bff70898
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 21:50:55 2013 +0100

    intel-virtual-output: Clone all outputs on the remote display
    
    Now that we allocate VirtualHeads on the fly, we can query the list of
    available outputs on the target display and clone them all, rather than
    manually passingthe  list of outputs to clone.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 028412faa7bb1d276e1dcdbe485c920acf73a719
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 20:58:48 2013 +0100

    intel-virtual-output: Third time lucky for computing the correct stride?
    
    Aligning a 16-bpp image to a 32-byte boundary is tricky, apparently. Or
    at least I make it look so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ecb758697af42e8e68edee0d1945986470a9c04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 19:44:50 2013 +0100

    sna: Expand the array of fake outputs if the last is used
    
    Always maintain one spare so that we can reconfigure for any number of
    desired outputs on the fly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57904e8d3d1deef33dd5515f3179b4d60c912712
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 18:58:07 2013 +0100

    intel-virtual-output: Fix calculation of image stride to include bitmap unit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9742ff3ae1696b7a2cc2be1849aedd8894914af4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 18:22:58 2013 +0100

    intel-virtual-output: use depth-16 transfers for remote hosts or low bpp targets
    
    Avoid up-converting to a depth-24 image and wasting extra bandwidth if
    either end-point is only using depth-16.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6509e46ecac968d177789cd4731e7721bb62f35a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 17:08:11 2013 +0100

    intel-virtual-output: use XRender for format conversion if required
    
    Support rendering between mixed depths by using Render to stage the
    transfer into our x8r8g8b8 image. An improvement would be to use the gcd
    intermediate depth so we don't waste bw unecessarily.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ead32f4a1498c2f7b7c74856e97f9e602ed7a274
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 16:13:14 2013 +0100

    configure; Remember to disable building the tools
    
    If we find that the headers for the tools are not available on the
    system, simply disable building them as they are not essential features
    of the driver.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8067255dc9185e85b110254ffbea4d9682d3aa2d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 30 20:24:41 2013 +0100

    tools: Add intel-virtual-output to extend the local desktop with remote outputs
    
    Based on the original implementation (hybrid-screenclone) by
    Tomáš Janoušek, and Bumblebee integration by Kevin Puetz.
    
    intel-virtual-output utilizes local VirtualHeads to present a contiguous
    desktop to the local display manager, but maps the drawing on those
    outputs to the remote display, and provides bidirectional RandR proxy so
    that you can resize the remote display and configure it within your
    desktop. The remote display should also send hotplug events back to the
    local desktop, for reconfiguration on the fly.
    
    Ideally the remote display is a discrete GPU on the same host so that we
    can use local Shared Memory transport and avoid sending data over the
    wire (though it will work in that setup). Ideally you would have userptr
    support to provide zero-copy rendering between the GPUs, or have dma-buf
    (in which case you would be using PRIME). For remote rendering, no
    compression is done so this fares worse than VNC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbf5751b5bc69e2515018a73540d1fb6dddc4502
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 31 00:25:16 2013 +0100

    sna: Open the device non-blocking
    
    This is essential to prevent deadlocks when running with ZaphodHeads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82dbe3ff81a9f3775f8588c919062317d1cd60a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 30 20:23:57 2013 +0100

    sna: Mark fake outputs as disconnected until a user applies a mode
    
    Hide the fake outputs until they are instantiated by a user.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d99249c580cfb062a05ce1da446410741eb1223
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 30 03:03:58 2013 +0100

    sna: Protect against unattached pixmaps when peeking inside for a GPU bo
    
    Prevent a NULL dereference for the small system pixmaps. Introduced with
    
    commit f22d7f68b8b1bd5caf5ae831fca63eb1e6957520
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Aug 28 14:24:33 2013 +0100
    
        sna/gen6+: Improve ring stickyness for BLT composite ops
    
    Reported-by: Sami Farin <hvtaifwkbgefbaei@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=68728
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 314cfd7353c8c1acd961fdfc8eadbc0d55fa0f01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 29 21:30:28 2013 +0100

    sna/dri: Correct the target_msc for immediate double-buffering
    
    We also need to correctly offset the current_msc for the normal
    pageflip, so rearrange the code flow so that we only do the calculation
    of target_msc once.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68d139388a2a037347fa5c838391e67e006793ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 29 23:00:05 2013 +0100

    sna: Allow user specification of number of VirtualHeads
    
    Previously, we instantiated a fake output in case we had a machine with
    no output. (For certain server-class products.) The Bumblee project were
    also doing something very similar in order to fake an extended desktop
    on the Intel igfx and copy portions onto a discrete GPU. (The preferred
    method for doing this upstream is through the use of PRIME). As the code
    is very similar, we can support both use-cases simultaneously.
    
    This adds the option:
    
    Section "Device"
      Driver "intel"
      Option "VirtualHeads" "<count>"
    EndSection
    
    to allow the user to specify an additional set of fake outputs, which
    can then be controlled using xrandr.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92a43caab96e7f49c541fb999b75925914d9981a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 28 14:51:09 2013 +0100

    sna/gen6+: Don't force a ring switch for likely TLB misses if already busy
    
    If the target is already on the render ring, don't force the switch away.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f22d7f68b8b1bd5caf5ae831fca63eb1e6957520
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 28 14:24:33 2013 +0100

    sna/gen6+: Improve ring stickyness for BLT composite ops
    
    Rearrange the tests so that we check both src/dst for which rings they
    are currently on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c451a471fbe1553c0273f3bd12f3c1a42f7ce193
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 27 19:06:52 2013 +0100

    sna/video: Copy the ClipRegion for the sprite
    
    A cut'n'paste error dropped the clip region copy, resulting in the
    port not being set on the window instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit feae741b38445f323cc1ae08f290192c7033f0f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 27 18:57:54 2013 +0100

    sna/video: Update sprite destination colorkey command
    
    The final version that was upstreamed differed from the original version
    we implemented. The final version allows for both destination/source
    colorkeying, but left the ddx out of date.
    
    Reported-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6997c4c2bde319fdf73ead8a9c9965f6548545eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 26 22:07:49 2013 +0100

    sna: Promote no COWs assertion to a condition check before operating inplace
    
    We can arrive there with a COW and wanting to a CPU mapping, which is
    unfortunate and requires the indirect path instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b267e52a0892ddb7b4a73e9b06555efe9e0b778
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 26 21:58:57 2013 +0100

    sna: Fix ordering of assert vs the state it checks
    
    It helps to set the state we want to check before actually checking that
    we set it!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e98cc0b1ce69a7ebc6b6ef4b916d05b9f73efe0b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 25 23:05:32 2013 +0100

    sna: Make sure we assert our Master status before copying the fbcon
    
    Being able to read back the fbcon handle as a non-Master process is an
    information leak that will be fixed. We should already be Master by
    this point by virtue of the sequence in which we obtain the device fd.
    However, to be pedagogically correct, call drmSetMaster() before the
    fbcon copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f62173af1af84e398a92fbe5ae67aa3f20f67060
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 25 14:12:15 2013 +0100

    sna/gen7: Combine a couple of pipe-flushes
    
    Reduce the number of pipe-controls we emit by combining one of the
    frequent flushes with a stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1dbbe69ada3323a82ebd672e9ef47a0d95911c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 25 11:26:46 2013 +0100

    sna: Make SetScreenPixmap do as it says
    
    Make sna_set_screen_pixmap() a little more complete and remove the
    assertion that the caller manages sna->front. This should make the
    function easier to reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 097c2567939f2063749acf0bc768df7bb002d535
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 25 10:49:57 2013 +0100

    sna: Add a few more checks for a hosted Xserver before walking CRTC lists
    
    If we are hosted, we do not own the CRTC configuration, and deferencing
    the private data structures believing them to be ours, only leads to
    disaster.
    
    Based on patches by Christopher James Halse Rogers.
    
    Reported-by: Christopher James Halse Rogers <raof@ubuntu.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7e6e9b83ce029e81767de35124b84914ad7d54b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 25 00:55:19 2013 +0100

    sna/dri: Prefer the source ring
    
    When copying from the DRI client onto the scanout, we return the source
    buffer back to the client afterwards. Therefore if we force the source
    to switch rings, we incur a double ring switch from the client to us and
    back. If we force the dst to switch rings, it will likely be then
    correct for all subsequent copies as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4ca1953189d39741bcce659da0d6adcc548ab71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 24 15:09:06 2013 +0100

    sna: Fix reversed logic and loss of trust in the host
    
    The test for a hosted Xserver was backwards in
    
    commit 306c72cffbd8cd88e93871ee21fa85101198c1ac
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Aug 24 14:02:23 2013 +0100
    
        sna: Trust the preferred-depth returned by the host
    
    so we failed to load the driver instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3716345bf45bff785d0786774400eb47e1678caa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 24 14:04:51 2013 +0100

    sna: Don't restrict the frontbuffer to be scanout capable if hosted
    
    Since we won't be binding it to a framebuffer, we don't care if it is
    incompatible.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 306c72cffbd8cd88e93871ee21fa85101198c1ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 24 14:02:23 2013 +0100

    sna: Trust the preferred-depth returned by the host
    
    As we are not master and will not be binding the fb, it is irrelevant as
    to whether our render buffer is actually bindable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7690346248fd8d3460cc07f018827ff55b85d19d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 24 14:00:34 2013 +0100

    sna: Don't copy fbcon if hosted
    
    When hosted, we have no idea what the right initial contents should be
    as we are independent of the CRTC and so the existing fb is irrelevant.
    Plus, not actually being master will cause the attempt to read back the
    bound framebuffer to fail...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b0d69e76c50155ea404f0e8a97d60a3f710c8a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 23 18:53:34 2013 +0100

    intel: Add experimental rendernode support
    
    Render nodes allow clients full access to off-screen rendering and GPU
    offload, without assuming any master responsiblities (for device and
    display management). As they have a more limited interface, they can be
    used in a more permissive manner.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 846436c1a26b2c8a9d787ec707edb075fac57ee0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 23 16:25:08 2013 +0100

    sna/dri: Make async blits async again
    
    Fixes the regression introduced in
    commit 6f5fd772c7ca656b86394a0f036d4e0cf5b33d8e [2.21.13]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 25 08:29:55 2013 +0100
    
        sna/dri: Discard the strict checking for stale bo before performing a blit
    
    which added the sync request flag along the explicit async blit path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc4e81726d03399bfbbba79d2e76556836f03bd2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 23 02:25:34 2013 +0100

    sna/video: Disable the existing sprite when switching CRTCs
    
    After starting a new video on another CRTC, disable the old one as we
    currently only track the single video port. However, showing a video
    split across multiple CRTCs would be a useful extension in the future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 509e7aaf8446f568e133e1b450ea13f73e9b366b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 23 02:10:11 2013 +0100

    sna/gen7: Prefer the render ring for more operations
    
    As we get more well-endowed GPUs with ever more execution units, it
    becomes advantageous to do even basic copies through the render ring.
    However, the extra performance comes at a cost - higher power usage. To
    mitigate this, we apply a heuristic of only allowing a switch over to
    the render ring if the render ring is already active with an early
    request (in addition to the usual stall avoidance and general
    performance heuristics).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f57ce6ef9ca735d5cb428b2f12f1f9413a70506a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 21 12:20:29 2013 +0100

    2.21.15 release

commit ed40a7c3de3bbb178278c05907e59239712b98b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 18 14:33:44 2013 +0100

    sna/gen6+: Tweak semaphore avoidance for composite operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4486ae2d829781e32652bce84c08e63ee1960bf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 18 10:11:49 2013 +0100

    sna: Do not force use of the CPU bo if replacing a busy GPU bo
    
    To minimise waiting for the SHM pixmap afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1cbf13bb1ad7432d681ef7cbbc17bcf2d23c554
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 17 23:37:57 2013 +0100

    sna/video: Initialise the UV offsets to 0 for packed formats
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db41bec0fd4dc8eec1f44a988f1c5a531594604f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 17 23:33:17 2013 +0100

    sna/video: Return the planar offset calculations to the planar branch
    
    They where accidentally move the packed branch in
    commit 85e89f2121bad96d34ff8df9456e2fbaa9ff7881
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Aug 16 21:11:33 2013 +0100
    
        sna/video: YUV420 is not supported by sprites, replace it with a RGB passthrough
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fed9ca236a0b5bbd7f1d137aa4ef9c2caf26719c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 22:43:26 2013 +0100

    sna/video: Turn off passthrough if given a zero name
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18e274425d728baa62445dc091cae6b1eab94a89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 21:58:29 2013 +0100

    sna: Make sure that external scanouts are immediately discarded
    
    An issue with passthrough Xv buffers is that they end up in the scanout
    cache and potentially reused instead of being immediately discarded.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6692077aca2dcb7754b23b6404ff2db2f70228dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 21:55:16 2013 +0100

    sna/video: Keep a ref to the passthrough overlay bo
    
    Otherwise we will destroy it at the end of the frame whilst it is still
    meant to be shown. Not normally an issue as the next frame is show
    before it vanishes, but is if the image is shown for an extended period
    of time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8c9b2c85256c870f9677a590f190856826c821c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 21:47:25 2013 +0100

    sna/video: Mark the sprite color key as changed when disabling
    
    Otherwise we will forgot to send the command to turn off the colorkey.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85e89f2121bad96d34ff8df9456e2fbaa9ff7881
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 21:11:33 2013 +0100

    sna/video: YUV420 is not supported by sprites, replace it with a RGB passthrough
    
    As YUV420 is not supported by any of the current sprite implementations
    drop it. Instead implement some RGB passthroughs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c610d37dae7e025027fd09a6889bf94853af8b8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 18:22:45 2013 +0100

    sna/video: Expose an attribute to keep the overlay always on top
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a6bd55da90382459db072bffbd4aa36d18f9a17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 15:38:18 2013 +0100

    sna/video: Don't assert on a client error, return BadAlloc
    
    If the client sends a BO that is too small to satifsy the PutImage, then
    reject with BadAlloc rather than die with an assert.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb35a0b19a4a1c9ac4e2bb552a61057c215ce890
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 16 08:47:16 2013 +0100

    uxa: Restore the lost copyright block after splitting i965_reg.h from i915_reg.h
    
    Reported-by: "Lim, Siew Hoon" <siew.hoon.lim@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 445f205a18f7548aa97b04379ff66a4fafb3f79c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 15 00:28:25 2013 +0100

    sna: Clip the tiled copy during framebuffer resize
    
    If we use the BLT for copies, then we need to supply correctly clipped
    coordinates.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6bd897157b34e3b80dea68fa615d0fba08238486
Author: Sedat Dilek <sedat.dilek@gmail.com>
Date:   Wed Aug 14 10:01:13 2013 +0200

    Correct misspelled caching
    
    Signed-off-by: Sedat Dilek <sedat.dilek@gmail.com>

commit 5d29daa7df72d9a96e044d0706f3014811389629
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 14 18:16:22 2013 +0100

    sna: Make sure the frontbuffer exists before doing pitch checks
    
    An unusual path to be sure, to call sna_crtc_set_mode_major before we
    create a GPU bo for the scanout - but might be possible after a GPU
    hang, or it appears after trying to set a 0x0 mode. At any rate, make
    sure the GPU bo exists before dereferencing.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xorg-server/+bug/1212344
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0f90a4c79799780592c004c846a963aad5f28e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 14 18:12:15 2013 +0100

    sna: Rename sna_pixmap_get_bo()
    
    Mark how dangerous this function is by giving it a __ prefix.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2be9118e882f59591dc0fb9b98ec25494f020bb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 14 17:48:13 2013 +0100

    sna: Tile the old image onto the new framebuffer when enlarging
    
    This improves the transition from going from a mirrored fbcon
    framebuffer to an extended mode.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 394978867edf3746c285491db6be41abfe325d87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 14 08:38:52 2013 +0100

    sna: Check that we successfully install the required hosting midlayer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d818c0a36919add462c05d01a64b297f693fa69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 14 08:34:46 2013 +0100

    sna: unwrap old modesetting API whilst hosted
    
    If we are hosted, then we do not have our own modesetting backend and
    calling it results in fireworks. So leave the old modesetting entry
    points for the hosting midlayer to control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 504b18b079e0a12a9d18b46418411805ef1d8377
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 13 11:01:03 2013 +0100

    sna: Fix the assertions for the composite fb path
    
    Having updated the offsets for the dst, we also need to update the
    assertions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5840bfe285e3fd9dc550cbe5fa87437870c92038
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Aug 12 19:31:53 2013 +0200

    Link the driver against pixman

commit b2df6cc8f0bcac6311f2b1d0c008add9b7d05787
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Aug 12 14:45:04 2013 +0200

    configure: use CPPFLAGS for xaa.h check, not CFLAGS
    
    CFLAGS aren't passed to the preprocessor, which then can't find the
    header.
    
    Signed-off-by: Julien Cristau <jcristau@debian.org>

commit d661332de946c356c10a75e29a48f2c2e3599fec
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Aug 12 14:38:22 2013 +0200

    Check for struct sysinfo as well as <sys/sysinfo.h>
    
    Non-linux glibc systems have the latter but not the former.
    
    Signed-off-by: Julien Cristau <jcristau@debian.org>

commit 5775731b6489c63212914163f51b7a576df70658
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 22:24:47 2013 +0100

    sna/glyphs: Do not attempt to release the negative cache lookup
    
    Following
    
    commit 021c59f6243c51871f664e5fdd43aa00a809033a
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Aug 10 13:15:48 2013 +0000
    
        sna/glyphs: Micro-optimise glyph drawing
    
    we need to be careful during sna_glyph_release() that the atlas points
    into the glyph cache before releasing it. Fortunately caught by an
    assertion.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8da8c88e999d74fb110dddd497f03854adc089cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 13:12:21 2013 +0100

    intel: Check for HW_SKIP_CONSOLE before use
    
    For the older xserver.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4abc9c317b1f79f3f3d687fcf2d255b4d7416c2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 13:10:05 2013 +0100

    configure: Correct the spelling of XORG_TESTSET_CFLAGS
    
    Reported-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce666270c8861e039a06718cc3e9093d63d15187
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 13:07:03 2013 +0100

    sna: Fix use of obsolete this_atlas in a DBG message
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3cb8b209d0515c54e1126f8ed6adf3cf7fbf3bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 13:05:00 2013 +0100

    configure: Fix reversed check for XORG_TESTSET_CFLAG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9645e71cb2580adb78bea1cfa70dfc3f66630834
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 11:28:03 2013 +0100

    sna: Reorder composite fallback migration to handle src==dst || mask==dst
    
    Order is important when moving and marking damaged regions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8dfc5b3f4ffeec93e52a5319b5a3118edf0e94e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 12 10:33:41 2013 +0100

    sna: Fix destination offset along memcpy composite fallback fastback
    
    The application of dst_x|y was incorrect, and so the drawing could end
    up in the wrong location for a window.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66990
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d48a43ed956ff21d779aff1a11a0f7bf6b65bcb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 11 11:49:04 2013 +0100

    sna/gen7: Refine ring selection
    
    Don't force us to select BLT too early if we allow ring switching. As
    the RENDER ring benefits from more cacheing over time (e.g. HSW:GT3e) it
    becomes much more preferable to use it over the BLT. Since we already
    have the logic to decide if ring switching is possible/preferred, relax
    the initial checks on where the current activity is to allow switching
    between batches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f3999f38c71689298ac44e5b64830f754199740
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 10 19:44:00 2013 +0100

    sna: Avoid confusing conflicting CRTC probes vs a DRM race
    
    Only bail we fail to find the CRTC for this output amongst the allowed
    set for this ZaphodHead - but allow us to find an invalid CRTC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6cd366b79ad15be608f829e884b4880c311cf58b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 10 17:55:07 2013 +0000

    sna: Remove the redundant clearing of kgem at startup
    
    struct kgem is contained within a cleared superstruct.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b364305b16d79e32592235004872d38406ce8e9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 10 13:41:46 2013 +0000

    sna/glyphs: Micro-optimise glyphs-to-dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 021c59f6243c51871f664e5fdd43aa00a809033a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 10 13:15:48 2013 +0000

    sna/glyphs: Micro-optimise glyph drawing
    
    When you don't have many cycles to play with, every one counts.
    
    Here we make sure we cache negative lookups for large glyphs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d5483c253a9a29f54f2eed9b40623c8e9de6c22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 10 08:59:33 2013 +0100

    sna: Tune pixmap_inplace() not to use a pinned busy GPU bo for replacement
    
    Obviously we can only replace the bo if it is not pinned and so just
    incur a stall when we could have instead rerouted the rendering through
    its CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de379943b49b94cc065fd55ad7ca1067e1802a31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 16:37:29 2013 +0100

    sna: Allow LLC to reuse any active write buffer
    
    The inplace write distinction is not important on LLC, so pick any
    buffer that is on the GPU and available for reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 821b34f5db2936394e8969b15c1cdd5144acf6e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 14:55:09 2013 +0100

    sna: Squelch a "valid" mode without a dotclock
    
    There is yet another race in drm initialisation where X is starting long
    before the drm device is completely ready, and is being told that the
    output has a valid mode, but with bogus settings. Ignore it, and hope it
    comes to its senses later on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6b5c3f009585151eb772dfc2526843c7cee82b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 11:34:39 2013 +0100

    intel: Disable incompatible features whilst hosted
    
    Start adding the infrastructure to disable direct hardware access if X
    is being run under a system compositor (aka "hosted").
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab445c23079a76eaa2a7d499ec4755599012bd2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 10:39:22 2013 +0100

    sna: Rewrite the can-mmap-cpu test to handle stolen unclaimed bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1d3d1f8c677b938362eee8b9f4e81f5463bc16a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 10:07:59 2013 +0100

    sna: Check for EINVAL after mmapping
    
    I want to catch this error as it happens to see which (stolen) bo is
    being erroneously mmapped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 039a64e89e0323bd02eec24fba21a3924ee5cc31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 9 09:13:10 2013 +0100

    configure: Only use XORG_TESTSET_CFLAG if defined
    
    Repairs the build for f16 which has an older version of xorg-macros.
    Fortunately, as it doesn't define XORG_TESTSET_CFLAG it also doesn't use
    it generate noisy output.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31b4110b5119ad1643f3e75c5e23a44c4ceb30fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 22:25:57 2013 +0100

    sna: Use create2 to allocate a DISPLAY bo even if we have not enough stolen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f82c1a451a2d5763d9cf53b48f55200f7716966
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 22:05:34 2013 +0100

    sna: Always reuse scanout bo where possible
    
    When looking for an inactive scanout and all are busy, select the oldest
    for reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd7e653e1ee009e225b0bbf60dcaebc9b0fa2788
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 22:03:16 2013 +0100

    sna: Avoid leaking stolen framebuffer bo
    
    Framebuffers created from stolen bo were not being released and so the
    kernel would keep the fb and bo alive, causing the memory to be
    remain unreusable whilst X lived and us to leak all available stolen
    memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 097669cd728e612bf3e3c531b83892e37481ee7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 20:44:24 2013 +0100

    sna/dri: Do not create a scanout-capable buffer if not flipping
    
    Avoid paying the penalty of creating an uncached buffer if we never
    intend to flip to it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cbf1f97d5dadbf569c7d26e78899bda95b28b16d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 19:43:24 2013 +0100

    configure: Include the experimental features in the configuration summary
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcac4f7f2b8d06cf2451609739ea342e5e3bfd5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 8 14:52:26 2013 +0100

    sna: Only use the experimental create2 if we support DISPLAY cacheing as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6add09791a44d9b3af79d50f52e6913c46341a8
Author: Raul Fernandes <rgfernandes@gmail.com>
Date:   Thu Aug 8 09:26:59 2013 +0100

    Micro-optimise box intersections
    
    We can shave a few instructions off the routine by incrementally
    performing the "is-empty" check as soon as we compute the intersection
    in each dimension.

commit c01c66bca2c64ae2d77233b6ccdca26431ee51b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 7 10:35:04 2013 +0100

    sna: Update experimental create2 struct definition
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6004870d53221caf05a330fcfc8a72e68b2b8898
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Aug 6 13:03:18 2013 +1000

    configure.ac: fix dri enabled with kms only picked
    
    Otherwise we'd fail saying DRI1 wasn't possible, when that
    is exactly what we asked for.
    
    [ickle: The breakage was introduced with
    
    commit bd6ffd1ad2f903215d2c631252e742a0f6893054 [2.21.14]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Jul 27 15:33:19 2013 +0100
    
        configure: Print a summary of compilation options
    
    which modified the search to only take place if UMS was enabled, but
    missed mollifying the resulting error.]
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit a875ba39bea4a951e8cf1450ba9722b7cda95943
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 5 16:15:48 2013 +0100

    sna: Rename the attribute macro __packed__ to avoid clang barfing
    
    Using __packed__ as shorthand for ___attribute__(__packed__) confuses
    clang as. (I guess to it expands (__packed__) which gcc skips.) As
    clang also uses packed in its builtins, we have to find a compromise,
    and so tightly_packed wins for being a more verbose description without
    the dangerous leading underscores.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2536ad044b259eb3ce3e7b1ccf2c59ab3fe37d06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 4 12:50:41 2013 +0100

    sna: Tweak threading thresholds
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cdd57c804706bcf558d16d3370c1880ef482af1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 4 11:43:54 2013 +0100

    sna/trapezoids: Some minor DBG to investigate threaded rendering
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f7e20d812ef46fa0cba492e06a8f9f5a326d3c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 4 12:26:36 2013 +0100

    sna: Define fast function attribute for old gcc or other compilers
    
    Also written by Mark Kettenis and reported by Sedat Dilek.
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cd154039ab02799dc972d93c415e762226df1aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 4 10:30:14 2013 +0100

    2.21.14 release

commit a5bf389908934aa4f9493a4a35b18e4aec9c8103
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 3 14:54:31 2013 +0100

    sna: Mark the entire userptr proxy chain as flush/non-reusable
    
    Fixes cache bookkeepping when mixing userptr uploads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5287660aafe45859c07874c22dca99c1ff5e555a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 2 13:18:12 2013 +0100

    sna: Reserve relocation entries for the deferred VBO
    
    Whilst we reserved exec entry slots for the deferred VBO, there were no
    relocation spaces reserved. So if we submitted a render command followed
    by a multitude of BLT copies, we could then overrun the relocation array
    when adding the deferred vbo to the batch.
    
    Reported-by: Danny <moondrake@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67504
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f04b6f33f05f8a24698f934a23462269b84917d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 1 14:49:36 2013 +0100

    sna/dri: Disable TripleBuffering by default for compositors
    
    Ideally, the method of swapping is something that the applications have
    control over, along with how to synchronise to the vertical refresh.
    Whilst triple buffering is good to reduce jitter for games (at the cost of
    an extra frame of latency, usually considered a good tradeoff), it
    prevents the applications from accurately controlling the presentation
    of animations. One vocal critique is Owen Taylor, who demands accurate
    swap control for smooth animations in gnome-shell. For example,
    
    http://blog.fishsoup.net/2012/11/28/avoiding-jitter-in-composited-frame-display/
    
    In lieu of application control, just apply a quirk for the compositor.
    Everyone else will just have to wait for DRI3.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ae07158c3550b418d3596cacda33a64ee653790
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 1 11:01:14 2013 +0100

    sna: Add a few more details to the log for mode switching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 246911d742569eed6675698c1e51032ba50917d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 1 10:52:44 2013 +0100

    sna: Don't force inline string-ops for the general memcpy_blt routine
    
    As we need optimal copy code for the general case, where unlike
    swizzling the run lengths are not known before hand, we need to call the
    arch specific routines from glibc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8174c56c3ad6f1b0e6cd432c888f3eaca91159b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 1 09:19:17 2013 +0100

    sna/glyphs: Allow glyphs-to-dst to discard CA masks for a8 glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5e3b66c27e8960a39ba0fc9108e04a67e1c2d98
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Wed Jul 31 18:50:51 2013 +0100

    uxa/display: Keep the EDID blob around for the lifetime of an output
    
    xf86InterpretEDID() doesn't copy the EDID raw data in xf86MonPtr but
    just stores the given pointer. The DDX driver needs to make sure that
    data stays valid.
    
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>

commit 278ee155d572d3132d27823bb69995a8cc61c2c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 31 17:01:47 2013 +0100

    sna: Relax readback constraint for CPU mappings of scanouts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfe25b8110fc4d4761b57e3ec07b8467890b90a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 31 11:00:21 2013 +0100

    sna: Fix interaction between WT mapping of scanouts and allocating from stolen
    
    If we allocate the scanout from stolen, we cannot then access it via the
    CPU - so prevent the mapping in those cases.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 493763301e995d02cb838d14348da46dd26444af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 17:38:23 2013 +0100

    sna: Allow CPU access to scanouts if WT cached
    
    On Iris, we may store the framebuffer in the eLLC/LLC and mark it as
    being Write-Through cached. This means that we can treat it as being
    cached for read accesses (either by the GPU or CPU), but must be careful
    to still not write directly to the scanout with the CPU (only the GPU
    writes are cached and coherent with the display).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cdbc097796b24ab42b60c49d9885a35573c96a89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 16:42:54 2013 +0100

    sna/gen7: Set appropriate constants for Haswell GT3
    
    GT3 has twice the number of cores and URB as GT2, and so we can use
    more threads and URB entries.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a390c77dc83909c9a05161d91678a87dd6a0d34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 14:07:45 2013 +0100

    sna/gen4: Hide an unused function
    
    Whilst we are force flushing vertexes we are not using the threaded
    emitter, so simply hide it from the compiler to prevent it warning about
    the unused function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3eea6e61e15a147165400c81eab82a14a9ce2fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 13:22:54 2013 +0100

    Suppress misleading warnings for -Wmaybe-uninitialized
    
    All the curent reports by gcc are false positives. Instead we have better
    static analysis tools at our disposal and valgrind.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 208282d31657f2b718e151397d16b307cdf8f77b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 13:19:27 2013 +0100

    Suppress a bunch of compiler warnings for using constant strings
    
    We want these allocated in ro memory even if the antique API complains.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e3445a330340c1aa2ca5a13d838344438336749
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 30 11:17:52 2013 +0100

    sna/dri: Tidy up applying damage to the Pixmap when copying regions
    
    Now that we are doing a true move-to-gpu first, we can drop the hacks
    from damage().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c507f621c932393a8b87912f71a86e29a8c1c190
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 23:54:31 2013 +0100

    sna: Suppress a few harmless warnings
    
    Mostly of the only used in debugging path variety.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf7d36455fc43e88697f4fb8fd865f3259ba0d1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 23:49:08 2013 +0100

    intel: Suppress some extremely noisy warnings
    
    Warning about redundant declarations within the xorg headers hides
    genuine warnings in our own code - disable them until the headers are
    cleaned up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7465ece29c9ae665a5a9f5bdac764a19062786e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 21:55:29 2013 +0100

    sna: Cleanup along all error paths in sna_pre_init()
    
    Only one out of a dozen error paths actually freed the locally allocated
    memory, oops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5751b9f1f5beb943db8cb5d260379ae39eb18db4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 14:44:51 2013 +0100

    sna/dri: Prevent stale DRI buffers from a NULL dereference
    
    If the DRI buffer is stale, the drawable may have been recreated and no
    longer be associated with DRI. In this case, the pixmap may not be on
    the GPU, so just subsitute the client's old bo and hope the it catches
    up and does a GetBuffers in the near future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8619db7224f5c3ec417a1d00a68e981549366adc
Author: Egbert Eich <eich@freedesktop.org>
Date:   Mon Jul 29 13:52:54 2013 +0200

    Add support for the dell backlight interface
    
    Signed-off-by: Egbert Eich <eich@freedesktop.org>
    [ickle: Add the failsafe to sna as well.]

commit c9d89499806779cd6c62d5d6d34df76279cc5abd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 11:51:39 2013 +0100

    sna: Composite region is already in dst drawable space
    
    So do not offset it again when processing the fallback composite
    operation.
    
    Regression from commit 6921abd81017c9ed7f3b2413784068fbc609a0ea
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 18 16:21:27 2013 +0100
    
        sna: Add a fast path for the most common fallback for CPU-CPU blits
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66990
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cb75950a90c28690f78fd3bf93ff8e23e5d543a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 29 11:03:43 2013 +0100

    uxa: Fix incorrect include path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1dd79c225cedf5614a77e5db9f9d9700bf957bb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 24 14:06:05 2013 +0100

    sna: Restore driver info upon FreeScreen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0826907dd7844c03080421d79e5f927b1245833
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 18:32:47 2013 +0100

    sna: Fix limit on stipples to only use immediate operands for <= 32 dwords
    
    The check was still based on bytes after the len had been converted to
    dwords.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5e9decc963e01d6e558355af97314c502e314000
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 16:42:14 2013 +0100

    uxa: Add the missing include to silence the compiler warning
    
    Silence compiler warning for no prior declaration of intel_init_scrn().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f97b55d283e2fc333e93c88b18d5f3412f87c67b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 16:31:57 2013 +0100

    intel: Remove the unused SDV PCI IDs
    
    As a first step towards working out what to do with the remaining
    used-once PCI IDs, delete the used-never ones.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 679416f9a5e949e6f15a5e8712921731a1750cbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 15:45:29 2013 +0100

    sna: Allow PutImage to utilise userptr for busy targets
    
    Typically, PutImage is not a performance critical path since ShmPutImage
    uses CopyArea and so PutImage is relegated to small one off transfers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd6ffd1ad2f903215d2c631252e742a0f6893054
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 27 15:33:19 2013 +0100

    configure: Print a summary of compilation options
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d92b5ddcff03a593270d060187b56ee2aa8e09b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 12:10:23 2013 +0100

    sna/gen7: Prefer GPU spans for Baytrail as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b68f1741fe360b0ba10421866aed8fffeea44e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 12:09:49 2013 +0100

    sna/gen7: Use ivb/byt/hsw shorthand for generation checking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e2a1c27b7d7cd5b305fb092a27ef57ba266aebd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 15:38:20 2013 +0100

    sna/gen7: Rename Valleyview to Baytrail
    
    The codename changed midcycle - along more rational lines (all the chips
    within the platform are now part of the Baytrail family rather than
    different codenames for each).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d10c32d650df36019d55cfc2e31d7641be4032d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 15:37:24 2013 +0100

    sna/gen7: Set appropriate thread counts for Valleyview^Baytrail
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a84a9fcb5e1218f685e4469dbe00f8f29cc36bf5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 10:41:00 2013 +0100

    intel: Remove the unused bridge PCI-IDs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8afb5438f3479df39752cbda680c13d80f81f42f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 10:25:36 2013 +0100

    intel: Always define the PCI-IDs
    
    If the macros conflict with another definition on the system, that is
    actually a useful warning in this case as it means there exists a typo
    somewhere.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a12c352b56e742b8f8aca4d8ca9efa26f268817b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 10:14:11 2013 +0100

    intel: Remove some unused macros
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e94f66c951ae9e0d4304cf8005537a147bda5d79
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 10:07:23 2013 +0100

    intel: Move some backend specific macros out of the common header
    
    All the IS_GEN/IS_DEVICE are only used by the UXA backend, so move them
    to its headers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04d5c33b9677fc920ad58522f93d832a42de4744
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 10:19:43 2013 +0100

    uxa: Colocate architecture source files with backend implementation sources
    
    i.e. move the toplevel uxa/*.[ch] into src/uxa/*.[ch]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45d4e8dcf9aee37015b1ee026997ed4dabdf112e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 09:35:06 2013 +0100

    uxa: Clear up the common intel directory
    
    Move all the UXA backend specifc files into their own subdirectory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab28526ea43728fb675448515e1519a970fb5f56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 21:55:21 2013 +0100

    intel: Only print the unique chipset names
    
    When printing out the list of supported chipsets, remove the (many
    times) repeated names as they are very confusing and obscure the product
    name you may be searching for.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fd37e644d9c662776aff14cd51a27b7e52472de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 22:10:43 2013 +0100

    intel: Replace the codename in the user facing string for unknown Haswell parts
    
    For these parts we do not yet known the correct marketing name, so
    replace our use of the codename with the generic term.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7567c99ee93f560cde33842cffa26a1ad6677600
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 21:40:02 2013 +0100

    intel: Set the correct marketing names for Ironlake, Sandybridge and Ivybridge
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17873be335aea223e93170c9ba6819ab6877b86b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 21:37:05 2013 +0100

    intel: Remove the SDV from the list of identified chipsets
    
    These devices are not for retail and so have no marketing names.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c6871684b0006a89be6760db99fda9b47790226
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 23:19:02 2013 +0100

    intel: Cross-check an unnamed chipset against the list of known PCI-IDs
    
    If we recognise the PCI-ID but do not have a marketing name for it, it
    means we are deliberating ignoring it - presumably because it is an
    engineering sample. In this case, we do not want to print out a warning
    into the logfile so replace the "Unknown chipset" with some info
    about the future product.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6bcb7ae20b92e48b8a2fa096c0e33b6b97b1b30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 21:22:25 2013 +0100

    intel: Source our PCI IDs table from the copy in the kernel
    
    Rather than duplicating the information we already use in the kernel, we
    can reuse the pci-id tables so long as we apply a little fuzz.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb8484da487008df8b69beb8086167bc272e85bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 27 16:28:22 2013 +0100

    2.21.13 release

commit 95e172b365365e9189dd863f1033bc6ea036a713
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 28 12:25:16 2013 +0100

    sna/dri: correct DBG typo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c51cb32b6edbfc9b95cbb5e72a13ac42fdc745ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 27 16:28:45 2013 +0100

    test/dri2: We do not require the GLX includes
    
    Drop the GLX includes as they are not needed and obviously break if the
    GLX are not present on the system (and we fail to check during
    configure).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4dbdd28ae05839645912f8aeb5100f6d05f11a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 26 15:49:00 2013 +0100

    sna: Try the indirect upload if we elect to use a mmap and it fails
    
    This allows us to avoid the occassional kernel bug if mmap() fails and
    the upload is possible via our indirect upload paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f5fd772c7ca656b86394a0f036d4e0cf5b33d8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 25 08:29:55 2013 +0100

    sna/dri: Discard the strict checking for stale bo before performing a blit
    
    Instead of checking that the DRI2Buffers match up with the current
    DRI2Drawable, clip the area that is being copied to the minimum extents
    of the Drawable, source and destination buffers. This ensures that we
    never read nor write beyond the extents of the allocated or visible
    regions.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67210
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67305
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef2a45731ef55b9fbafe5da67e0251b9b871bda9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 24 19:44:15 2013 +0100

    sna/dri: Restore the comparison of bottom-right extents to the pixmap origin
    
    This reverts a portion of commit 6d80bd6a73 so that we do not compare an
    offset redirected window against its outer frame (e.g. glxgears in a
    300x300 under unity sits within a much larger ~330x330 frame).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=67210
    Reported-by: Joseph Yasi <joe.yasi@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42862298bc4d8588433abc8ac3b1ff65ec20e30d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 24 10:15:09 2013 +0100

    sna: Remove bogus comment concerning sna_enter_vt
    
    This bogus comment confused both Chris Halse Rogers and myself.
    
    Suggested-by: Christopher James Halse Rogers <raof@ubuntu.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d80bd6a7311926f258cd92f0b22e8d03022b62b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 24 09:03:45 2013 +0100

    sna/dri: Cleanup validation of blit extents
    
    Prompted by a suggestion by Haihao, clarify the intent behind checking
    the incoming maximum blit extents against the recorded sizes of the
    attached bo. Due to the asynchronous nature of DRI2 invalidation, it is
    possible for the DRI2 buffer to be stale and for its bo to be smaller
    than required for the client's blit.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=67210
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: haihao <haihao.xiang@intel.com>

commit 74dd10d252df2d826b6db5da7e53bd7c5d76dec0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 23 09:37:15 2013 +0100

    sna/gen5: The cached value of the pipelined pointers key requires 32-bits
    
    Storing only the low 16-bits of the key for the pipelined state meant
    that we forced an update with every new drawing op - with the side
    effect of flushing the render cache.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67157
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8c7834e1d4d31097d0dd2c931d7662b5314a9b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 22:03:17 2013 +0100

    configure: Supply a default value for dridriverdir
    
    Rather than fail to load DRI2 if not found.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d94f030c6af64f82d495a835a3b962480c068e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 22:01:22 2013 +0100

    configure: Fix enabling of DRI2
    
    After setting it to false, we then need to set DRI2 to true after we
    detect the headers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0498e0c38d0b04d89020e61c13b250150ec19c3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 19:20:16 2013 +0100

    sna: Fix DBG compilation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8cd5b5ff6f6e78260fb57f4b8171682d857e880
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 18:47:36 2013 +0100

    configure: Use --enable-dri to control both DRI/DRI2 enabling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e2a1be13914e9ba13aaca06576a4f0e0f6e8fb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 19:34:32 2013 +0100

    sna: Bail if we fail to find the attached CRTC during probing
    
    In a Zaphod configuration, the set of CRTCs available for an output is
    limited, and if that set does not match with the already established
    linkage, our quick probe function will select no mode. However, since
    the output is already on, the user definitely would like to continue
    using it, so fallback to InitialConfiguratio to select an appropriate
    mode.
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67176
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b1a5024df96070bab70744ad7e7d78a41fb0f72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 22 10:51:05 2013 +0100

    sna/gen5: Rework the flush after blend state changes
    
    QA complained that the full flush to memory was too much of a
    performance hit, so let's try a lighter weight non-stalling pipe flush
    without.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=67157
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2737aaab77cc6233826077b90d001fe45efc376c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 21 20:42:37 2013 +0100

    sna: Missing git add to fix typo in assert() from last commit
    
    I915_TILING != I915_TILING_Y
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa961ec99a67266687a1934eea24138cf2f7ad19
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 21 18:00:22 2013 +0100

    sna: Allow linear inplace uploads along the tiled X PutImage blt paths
    
    Mostly for symmetry with GetImage, this in theory just bypasses a lot of
    intermedate state checking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff705331da62729e302fb882755a88d756d9c233
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 21 09:47:35 2013 +0100

    sna: Unwind BLT setup if we don't emit any ops
    
    Often we may find that the BLT operations we wish to do after a
    XY_BLT_SETUP are either completely clipped out or transparent and so do
    not generate any subsequent commands. This leaves us with many unused
    XY_SETUP_BLT.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=61477
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c78403cb56841f342692b97bb53e995c3ff6b9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 21:55:16 2013 +0100

    sna: Remember to apply drawable offsets for composite memcpy
    
    Yet another missing chunk from
    commit 6921abd81017c9ed7f3b2413784068fbc609a0ea
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 18 16:21:27 2013 +0100
    
        sna: Add a fast path for the most common fallback for CPU-CPU blits
    
    I had the composite offsets, but not the normal window offsets!
    
    Reported-by: F.Brown <francisbrwn9@gmail.com>
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67124
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=67064
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9823ec2a9f81b2e1c78eb91b695847535b0d0af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 20:54:58 2013 +0100

    sna: Release cloned pixmap when updating tearfree scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b27b1654145c62493614dd7545dcd9fe6936750e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 20:04:00 2013 +0100

    sna: Relax assertion that CPU syncs are performed on reffed objects
    
    Along some paths, we use a CPU mapping on a temporary object that never
    gets a user ref - so the assertion is bogus. A lesson I keep forgetting.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f39d9ed0929f83e65dde8da8f03fae6ba8264e4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 18:08:22 2013 +0100

    sna: Correct typo in checking src extents before performing memcpy
    
    A regression in
    commit 6921abd81017c9ed7f3b2413784068fbc609a0ea
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 18 16:21:27 2013 +0100
    
        sna: Add a fast path for the most common fallback for CPU-CPU blits
    
    And add the full set of assertions to validate the memcpy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f915d4a224eb686ad18b62ca0258e056b4a483cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 15:26:04 2013 +0100

    sna: Inform the upper layers that we turn the CRTC on after a modeset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f52a89046999c02ed778777eff8e2eb62662d90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 12:16:23 2013 +0100

    sna: Fix application of composite offsets along PutImage fallback path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a998a8a34961ccdcec14369486ae3332009a1276
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 02:01:25 2013 +0100

    sna: Tidy fast source clip processing for sna_do_copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65a09436e6aef9fe0518e322f92e601d5d3f46c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 20 00:20:09 2013 +0100

    sna/dri: Fix the strict blitting check not to assume the dst is the front buffer
    
    In order to allow the case for copying onto a target other than the
    front buffer, such as the fake front buffer for example.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e386ba86ea487a2db62d80a0e60f176e052d6406
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 15:22:08 2013 +0100

    sna: Perform an explicit check against the region extents
    
    RegionNotEmpty() is only valid if we only use the Region API, and as we
    mix direct operations on the region extents, we need to also do our own
    final check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de472d95affcad0f87685782d29a41fa2a0cada6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 15:13:50 2013 +0100

    sna: Check for bpp>=8 before attempting to use memcpy_blt fastpath
    
    Fixes regression in
    commit 6921abd81017c9ed7f3b2413784068fbc609a0ea
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 18 16:21:27 2013 +0100
    
        sna: Add a fast path for the most common fallback for CPU-CPU blits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4aa0288f16f03723a7aaa30967809d10fdb15a27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 14:10:02 2013 +0100

    sna: Return true from get_drawable_deltas() if the pixmap is offset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6921abd81017c9ed7f3b2413784068fbc609a0ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 16:21:27 2013 +0100

    sna: Add a fast path for the most common fallback for CPU-CPU blits
    
    This path will mostly be upload for individual glyph uploads, for which
    the malloc overhead is significant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4da830864983ffe482388e4e4cfee02d106c895e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 15:05:04 2013 +0100

    sna: Remove the duplicated pimxap migration for the composite fb path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d56f0eb84cc80fa5497c06a7967650aa20ebe51
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 14:49:41 2013 +0100

    sna: DBG controls to turn off unwinding partial bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 494f4bdcb00dc54f84e503b49fd85c8965f7f9ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 14:19:16 2013 +0100

    sna: Allow operation inplace when wedged
    
    There are times, such as rendering into the scanout, where continuing to
    use the GTT is preferrable even when wedged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb058de4e617d7e5058674859993ec635a8d779e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 13:37:12 2013 +0100

    sna: Treat a source with a CPU bo as being attached.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4723a730f4dc2d007577f43fe232c49b305c2695
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 13:26:36 2013 +0100

    sna: Discard overwritten operations before doing a BLT composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2f32373815e166fc6dceb477139ff2ef27db0ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 12:33:10 2013 +0100

    sna: Tidy a few DBG regarding cached uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b37a167d9caa7868427cb88b2480f3b64e96cc9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 10:51:42 2013 +0100

    sna: Only IGNORE_CPU for blt composite operations if the size is known
    
    Some operations we do not know the true extents and so check the whole
    drawable when considering placement. In this case, the drawing may only
    partially cover the drawable and so we can not simply ignore existing CPU
    damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d62f7c483a999c24c744c0d257c8524f6fd5d32
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 18 22:00:24 2013 +0100

    sna: Also do exposure checking after source clipping in sna_do_copy
    
    Hopefully a final regression from:
    
    commit 07926bfe507071a3d46a2ec13bb86a36bc225761
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jul 11 15:28:55 2013 +0100
    
        sna: Remove the temporary region allocation from sna_do_copy
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=67055
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c8c4626908987e1bb5b16c49bc16dabac7d89dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 11:55:09 2013 +0100

    sna/dri: Return early is the DRI2CopyRegion is not attached to the GPU
    
    This can happen if the DRI client passes in a stale DRI2Drawable - that
    is the Drawable now references a new Pixmap which the client has not run
    DRI2GetBuffers against.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5036fb15983a1d3547eaab381c18b3edf4310b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 11:51:40 2013 +0100

    sna/dri: Reject invalid DRI2Drawables if STRICT_BLIT is defined
    
    Simply reject any attempts to copy using stale references (i.e. the
    DRI2Drawable has changed structure but the client hasn't yet noticed).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a45714c9a5ba5cd35fbbee2a49f540fe9164cdfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 11:21:28 2013 +0100

    sna/dri: Rearrange some more DBG to come before its assertion
    
    Again, useful to know what the assertion fails with.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9831b50b58c36af3d2dd196b3abbfaa8e9a22c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 19 10:59:03 2013 +0100

    sna/dri: Expose the refcnts in DBG before we hit the assertions
    
    Useful to try and explain some failures.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c8b15d321044d4a81cb187cc5e1ac094eb82367
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 20:58:33 2013 +0100

    sna: Wrap cpuid.h
    
    More our ifdef out of line from the main code into a header file, where
    we can also apply a little bit of synatic sugar.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08cacc265da8c1213d8bf1107168e37d38a3641d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 14:22:16 2013 +0100

    sna: Guard cpuid for use only with gcc-4.4 and later
    
    Since __cpuid_count() was only introduced into gcc-4.4, we obviously
    cannot use it with earlier versions or with compilers that do not
    provide compatible interfaces.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa5f14b3400614531aa88eb6b70b64bd1f47974d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 14:12:29 2013 +0100

    sna: Ensure that buffer_size is a power-of-two for use in ALIGN
    
    ALIGN() expects it alignment argument to be a power of two. As buffer
    size depended upon cache_size, which is not always a power of two,
    issues could arise with unexpected buffer sizes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a764a6e69b23f644957cf3e4e98868464f458758
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 10:51:56 2013 +0100

    sna: Fix typo in computing box intersection
    
    Comparing y2 against y1 for the intersection was a silly typo,
    especially as the routine for computing the intersection already
    existed.
    
    Fixes regression in commit 34c9b759fbab8d548108e954d55de38c6f5bec31
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jul 16 19:39:37 2013 +0100
    
        sna: Note that borderClip region may be more than a singular box
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66991
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f76a2bf319f59d463a1f96974b03d7c651847dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 10:22:17 2013 +0100

    sna: Fall back to /proc/cpuinfo parsing if cpuid cache size probe fails
    
    Older hardware does not support cache size probing via cpuid4, so we
    need to implement the older algorithm which requires a table based
    lookup. (And in hindsight, why I thought cache probing via cpuid to be
    quite hairy.) For the moment, just use the value found in /proc/cpuinfo.
    
    Reported-by: Oscar Dario Trujillo Tejada <oscardt19@gmail.com>
    Reported-by: Ferry Toth <ftoth@telfort.nl>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f3071c6c91c3907cb0fecf2f69a995feefe7956
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 09:02:19 2013 +0100

    sna: Set a minimum size for tiled IO
    
    And assert that we never ask for a zero-sized upload.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0952e7e04167d7b2284fc794ed9fb30afebdaf52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 17 08:24:19 2013 +0100

    sna: Include linear GTT maps when deciding whether a bo is mappable
    
    If the linear bo is still in the CPU domain, we can map it through the
    CPU with no penalty, so treat it as mappable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34c9b759fbab8d548108e954d55de38c6f5bec31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 16 19:39:37 2013 +0100

    sna: Note that borderClip region may be more than a singular box
    
    If the child is obscured, then borderClip will contain a list of valid
    boxes rather a singular extents. I thought this was covered by the
    clipList, but I was wrong.
    
    Reported-by: Jesse Barnes <jbarnes@virtuousgeek.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66970
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1323abcc2eb19df81a000d4a37af6949801a9076
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 16 09:02:01 2013 +0100

    sna: Make the assumption bpp>=8 explicit inside the bo size calculation
    
    Use an assert to document that we have a few rounding issues if bpp < 8.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a447c514b3193897e0d3ec4b3cf75f346d7438e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 16 08:58:21 2013 +0100

    sna: Create a pixmap in ordinary system memory for depth=1 uploads
    
    Since we will not sample depth=1 pixmaps from the GPU, we may as well
    directly allocate these in system memory and avoid tickling the upload
    cache. This then avoids an issue within the size calculation code which
    makes the assumption that bpp>=8.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 884dd896e4e959e5a284a6f70da9e5cde1bbb7e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 15 10:59:39 2013 +0100

    sna: Change message context to PROBED for initial configuration
    
    Since we are retreiving the hw values rather than choosing a default for
    ourselves, it is more consistent to use PROBED rather than INFO for our
    message.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8677a971bdbeb8e472b74385780c41c7a51c522
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 15 10:24:53 2013 +0100

    sna/gen4: Allow rendering to Y-tiled surfaces
    
    We no longer seem to be hitting the same random hangs, so presumably
    another w/a is taking effect.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e83e7e60f41cb29132d5eef60af16b65b1b3cd4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 14 09:31:39 2013 +0100

    2.21.12 release

commit 0230ef72cbb2d3bcf7157548ddd52a71c0c771c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 12 23:57:42 2013 +0100

    sna: Skip copying to the intermediate target if we will completely overwrite it
    
    Occasionally when forced to use an intermediate destination surface, we
    know that we will completely overwrite the contents of the surface and
    so we can forgo the initial copy from the target.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b16eaefb38b4a6efe50a397e68793ab9a1cb2ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 12 23:22:59 2013 +0100

    sna: Avoid integer overflow when computing the tiled extents
    
    When stepping over the tiles, beware that the step may overflow the
    int16_t region extents, so use an int for the calculation.
    
    Reported-by: Andrew Woodward
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1200766
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 835ceccb27afa18704c34dc3283476340f999317
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 12 23:20:56 2013 +0100

    sna/gen5: Add some more DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39f1954f667bf20cd0c25dfa5fb5267a3f9eb113
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 11 21:57:02 2013 +0100

    sna: Replace parsing of /proc/cpuinfo with parsing of cpuid
    
    Courtesy of a patch from Chad Versace via Ben Widawsky, actually digging
    through CPUID for the cache info looks quite easy in comparison to the
    fragile approach of parsing a linux specific file that may or may not be
    available.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c604d1426cc11f9799044710acf1ef7d226d2604
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 11 16:40:51 2013 +0100

    sna: Remove the duplicated open-coding of SetScreenPixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07926bfe507071a3d46a2ec13bb86a36bc225761
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 11 15:28:55 2013 +0100

    sna: Remove the temporary region allocation from sna_do_copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 519d0007d4add23b14b5a9fd83cf4a1b68c63d03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 10 18:24:36 2013 +0100

    sna: Remove incorrect asserts for checking CPU mappings (after remapping)
    
    These assertions were checking that the previous state prior to
    performing the new mapping was consistent. Given that the checks were
    occurring after the update in mapping, the asserts were bogus.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a18f4ba9033cec3cc435c29878b12ceef1defc1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 10 11:56:50 2013 +0100

    sna: Ofast was introduced with gcc-4.6
    
    Thomas Jones reported that the build was failing with gcc-4.5 due to the
    memcpy routines requesting an unsupported optimisation mode (-Ofast) and
    supplied this patch to only enable Ofast for gcc-4.6+
    
    Reported-by: Thomas Jones <thomas.jones@utoronto.ca>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccf0fdd56dc6efd30e425209d753ed4f90562d76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 9 20:41:51 2013 +0100

    sna: Only flush after the BLT operation if we have more than 2 distinct bo
    
    In order to preserve the optimisation of discarding incomplete batches,
    we don't always want to immediately submit the batch after inserting the
    first command. As we currently only cancel a batch if it only touches
    the bo being discarded, we can skip the immediate flush if it only
    accesses one bo and maybe be able to use the undo optimisation later.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d935912d9c13ec8cf4f641c55846714d4e9ba929
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 9 20:38:32 2013 +0100

    sna: Free the source reference after performing a BLT composite
    
    Fixes regression from
    commit 8751c0f5ad202850bdd56dbb4eedb211c023cf23
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Jul 5 17:55:10 2013 +0100
    
        sna: Flush blt copies if no operations pending
    
    Reported-by: Andreas Reis <andreas.reis@gmail.com>
    Reported-by: Mike Lothian <mike@fireburn.co.uk>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66742
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b202008f8f6470f256d3b9000a9f78b6ca8d932b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 5 13:50:34 2013 +0100

    sna: Experiment with a new ioctl to create buffers from stolen memory
    
    If there is stolen memory reserved by the BIOS, we want to utilize it in
    preference to regular system memory. However, given the caveat that it
    is not suitable for CPU access, rules out most use cases - but it is a
    good match for framebuffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbb585b9d2510efa9f8432bc25842fa14a8e495e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 7 09:17:58 2013 +0100

    sna/gen4: Remove custom max flush vertices w/a from video path
    
    This should now be superseded by using the common w/a.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a59eadf8165bd70780ac16220456c6196ac3ff1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 7 09:13:49 2013 +0100

    sna/gen4: Remove the glyph mask hack and tune the flush w/a
    
    Remove the hack from the glyph path to force the use of an auxiliary
    channel, and reduce the maximum amount of inflight vertices until we can
    then render glyphs with no corruption (at least in my test case).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9c1833c30421e1461f6b03b858bbc187068eb0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 7 08:58:52 2013 +0100

    sna/gen4: Tighten FORCE_FLUSH w/a to spot amalgamation of primitives
    
    Inspect whether this rectangle will be added to the previous primitive
    and so charge it against the current number of inflight rectangles.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 368c909b29758f996dbbdbec4d471df23f60bc04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 6 22:27:44 2013 +0100

    sna/gen4: Restore the flush-every-vertex w/a
    
    This is an abhorrent workaround for some internal GPU brokenness. A
    slight refinement since earlier times is the recognition that 16 is a
    magic number limiting the maximum number of inflight rectangles through
    the GPU.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1fbf47ec1bed888c1b7c8dcbeb01d8e067727c82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 6 18:30:47 2013 +0100

    sna: Tune inplace hints for CPU operations with GPU targets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5aaab9ea0310d48bb1a1ca20308d1c9721a9de3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 6 15:10:22 2013 +0100

    sna: Relax assertion that the source of the cloned pixmap cannot be mapped
    
    I was being overzealous at the time of making the COW and trying to be
    sure that we would never write through a mapping. Then I started to
    allow clones to be mapped (for reads) and missed relaxing this assertion.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8751c0f5ad202850bdd56dbb4eedb211c023cf23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 5 17:55:10 2013 +0100

    sna: Flush blt copies if no operations pending
    
    More work to try and keep the GPU busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5529ea61b5e12e0c2d9fda817948ca0a4cab212
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 4 21:39:33 2013 +0100

    sna: Use a stack allocated PixmapRec for the fbcon copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea508c177c961ba2f00129476a22a32ff3ea6f1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 4 20:19:20 2013 +0100

    sna: Set 1024x768 fb in absence of any connected devices
    
    No actual initial configration magic is required, all we need to do is
    set the initial framebuffer size with no connected outputs and leave it
    to the core to select CompatOutput() the like.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d36c9542d2bd707838a87c451bf76f091aaf5cba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 4 10:45:09 2013 +0100

    sna: Fix gamma query to not request uninitialized values
    
    Oops, surprising that ebf4517a0b had any positive effect.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59fa53707eed18e5cc151bd2ce05a2dcdd325630
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 4 08:51:58 2013 +0100

    sna: Set the initial gamma from the attached monitor configuration
    
    Fixes a missed configuration option from
    commit 8a6a21bff86100144ba7960fc32a299ac54ada83 [2.21.11]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 26 13:29:48 2013 +0100
    
        sna: Use the existing configuration for initial modes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebf4517a0bb510e406795c169aa21b7cc615ed31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 3 22:44:46 2013 +0100

    sna: Always read back the gamma, even for a inactive CRTC
    
    Even if the CRTC is inactive, we still need to initialise the gamma
    tables.
    
    Reported-and-tested-by: Timo Kamph <timo@kamph.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66563
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4def5ecf6ebc2c6dc05e60d4595fa3dd4b7e38d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 3 21:56:54 2013 +0100

    sna: Tidy up the user override enums
    
    Since we have a second place dependent upon the hidden ordering of the
    output options, simplify by copying the complete enum block from
    hw/xfree86/modes/xf86Crtc.c
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5adca344b2f95cf2f2b2b3fabf6c99c39b64f25f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 3 21:45:11 2013 +0100

    sna: Fix configuration user overrides on xorg-server < 1.14.99.1
    
    Marty Jack found that the enums for the user overrides were off by one
    (his xorg conf was no longer being applied). This is because I had
    missed the introduction of ZoomModes in 1.14.99 increasing all the
    important enum values by one.
    
    Reported-by: Marty Jack <marty19@comcast.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1445a62da8a08acd8a732176d085fd098f68cec3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 3 12:59:31 2013 +0100

    intel: Add an option for forced rediscovery of output status on startup
    
    Specifying
      Section "Device"
        Option "ReprobeOutputs" "true"
      EndSection
    will restore the old behaviour of scanning each output on startup and
    picking a spanning mode.
    
    The behaviour was changed in
    commit 8a6a21bff86100144ba7960fc32a299ac54ada83 [2.21.11]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jun 26 13:29:48 2013 +0100
    
        sna: Use the existing configuration for initial modes
    
    Please do notify us of any circumstances that force you to use this
    flag.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66494
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ecff61d369d9f67c6e28d407941f35ed6195156
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 3 12:45:10 2013 +0100

    intel: Retire Option "RelaxedFencing"
    
    The kernel bugs have long since been fixed and should have been
    propagated to all stable kernels long ago. Now there should be no need
    to workaround those bugs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c957f4171791447f1869f11fd724dbe92e6a8b91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 23:59:02 2013 +0100

    sna: Try harder to do the BLT upload along the fallback path
    
    Only in the !fallback path will we try using the render pipeline after
    the blt, in which case we can try using render rather than forcing a
    stall. In the fallback path, we are going to incur stalls and readbacks,
    anyway so ignore them when considering blt.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 158095ff2b2d38f54ca91d2a728f919cd705ff62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 23:17:32 2013 +0100

    sna/gen2: Fix alpha replication in the copy pipeline
    
    When copying into an a8 surface we need to replicate the result into the
    green channel. It helps to tell the GPU from where to source the value
    to be replicated.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b0d36c63817c08990b8ae4efd60df4a11619e0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 23:16:54 2013 +0100

    sna: Assorted DBG
    
    This DBG was useful for narrowing down the issue in the next patch...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 103672869c64a1e42022069f413478c256c0ee00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 20:52:23 2013 +0100

    sna: Add the condition that 855gm cannot GTT map Y-tiled surfaces
    
    We had the check in a couple of places, but missed a key one that
    decided whether or not to perform a GTT mapping of a bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9aa665ae33c3ac54b8896e6f8373dfda2637e392
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 15:53:38 2013 +0100

    sna: Only preserve the real fbcon upon first starting X
    
    We only want to preserve the plymouthd splash screen for flicker free
    start up, a subsequent regeneration should be cleared instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21e29e95265331f8a33cd676c2d3124007643135
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 15:25:46 2013 +0100

    sna: Simplify validation of active CRTCs
    
    Atter a modeset or KMS takeover, we do a quick readback of the kernel
    state in order to verify that it matches our expectations. If we find
    that a foreign framebuffer is attached, or no mode if set on the output,
    we then turn off that connection and release any resources associated
    with that pipe. This patch tries to reduce the number of superfluous
    requests to turn off a connection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67a6a4bfd9cd1a861911e76096923bfc652189e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 14:27:03 2013 +0100

    sna: Hook into crtc_notify rather than ModeSet
    
    ModeSet is called after updating each CRTC, unlike crtc_notify which is
    called after applying all changes. The last is what we need as if we are
    called too early we detect that the next CRTC doesn't match our
    expectations and so we disable it, right before applying the desired
    mode.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66494
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c361b449cc3ec15819883afc220aad8823c0072d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 09:49:48 2013 +0100

    sna: Include connector status in the initial probe
    
    We cannot simply rely on connector->encoder->crtc status as with the
    introduction of Haswell or SDVO we may have multiple connectors using the
    same encoder. So we need to explictly check the connector status first,
    before determining if the output is connected to an active encoder and
    CRTC.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66488
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 282507af8e932e49b31d5f20958a61c137df590d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 2 09:34:57 2013 +0100

    intel: Move the validation of the KMS device into the open routine
    
    Currently we leak the fd should we open the device node and decide that
    is not a GEM/KMS kernel driver. The simplest way to perform the cleanup
    upon failure is to move the checking for GEM/KMS into the device open
    routine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24a7bec7faa7dcc4393ef7f66939ae0fb8acdf36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 22:43:02 2013 +0100

    sna: Minor tweaks to make DBG compile again
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad0afda3fe4f5e408e3610d8b76fdc7d1af33138
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 22:26:29 2013 +0100

    sna: Fix checking the dirty boxes
    
    I forgot how insane the data structure for the list of dirty boxes
    attached to the damage is. It is neither a simple list, nor does not store
    the count of boxes within each chunk.
    
    Fixes regression from
    commit 9026bb954646c0425360c2236e26c79d097142cd [2.21.11]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Jun 28 15:59:17 2013 +0100
    
        sna: Inspect the dirty boxes when querying whether damage contains a rectangle
    
    A side effect is that we now make sure that there is an upper bound to
    the amount of searching we do for the no-reduce fast path.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66430
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c8a33a72e29261d6bf5a6c160765cbafa4d0b88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 17:41:41 2013 +0100

    sna: Allow scanouts to be untiled if need be
    
    Fixes regression from
    commit 77fa8ab08b441934218ddb8f690be1a919f0ec64 [2.21.11]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Jun 25 22:25:25 2013 +0100
    
        sna: Free just-allocated bo if we fail to set-tiling on CREATE_EXACT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9cb6756ce16491e42c6e21bc74a5f7de5432510f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 17:27:17 2013 +0100

    sna: Always create the clear Picture
    
    As we unconditionally use it irrespective of whether we then call
    accelerated code paths or not.
    
    Fixes regression from
    commit dc18eaa585c36c8e5f5b4ec405a976a835fd2ac3 [2.20.10]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Aug 12 10:34:10 2012 +0100
    
        sna: Make the failure to create render caches non-fatal
    
    in the event we need to start with a hung GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6c6ae71bedce43ff6617179c015c303cbaee9ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 17:00:17 2013 +0100

    sna: Make sure we are consistent in applying USE_INPLACE debug option
    
    A few new paths were missing the debug check, and clarify a few indirect
    uses by performing the explicit check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cce2351056eda1282a521b96f90ba12436e86492
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 16:13:47 2013 +0100

    sna: Debug options for forcing mmap syncs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7aff6beb37c91df85c46372d44ae4a5fefae5ae8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 17:57:49 2013 +0100

    sna: Improve the message about where to find the hang state
    
    Search the few canonical locations for our hang state so that we can be
    more explicit to the user about what to include.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0e84e6686be390ef204117525d4a5c6aebbbe07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 16:49:50 2013 +0100

    sna: Mark an inplace getimage as preferring the CPU mapping afterwards
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e648c1f39cc17d39eff077639f23687894724b7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 15:27:38 2013 +0100

    sna: Assert that we do not have overlapping damage
    
    Double check that the results of the box query match with the slow
    queries.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c6cc0c9edb8f1ebcc8be5edb78c9d858dce1965
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 15:04:58 2013 +0100

    sna: Check whether the query box is contained within the damage
    
    We can improve our query for whether the rectangle of interest is within
    the damage by checking whether the damage extents contains the entire
    box rather than just checking for an overlap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64cb923588df0547880009bbeaeecb7ac3ee8ecf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 14:30:21 2013 +0100

    sna: Experiment with cpu mappings for migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12c013d25ed0c08f748b0a7250cbcef1cded26b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 1 13:28:57 2013 +0100

    sna: Do not use userptr for GetImage on unsupported architectures
    
    If the system cannot blt to a CPU buffer, we should even attempt to do
    so for GetImage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d9163983ea2e960c0a7b55266fcc532b9c6e382
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 30 15:26:57 2013 +0100

    2.21.11 release

commit 5005bd2d52ab64cbeae099d512d0b65be6c4abaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 30 15:02:19 2013 +0100

    intel: Fix failure code for reporting !drmCheckModesetingSupported
    
    The new function returns the fd, not a Bool, so the error code must now
    be -1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8738d7b4cc1c624d4390ef9ce7426ba457d7dd3
Author: Jonathan Gray <jsg@jsg.id.au>
Date:   Sun Jun 30 19:37:45 2013 +1000

    intel: replace direct ioctl use with drm{Set, Drop}Master
    
    Use drmSetMaster/drmDropMaster instead of calling the ioctls
    directly.  Fixes compilation on OpenBSD where these ioctls
    aren't defined.
    
    Signed-off-by: Jonathan Gray <jsg@jsg.id.au>

commit 40301e6d03f6e8d2d2d01e6bb9f1754a7e543a08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 30 11:12:34 2013 +0100

    sna: Store the path used to open the device and pass to DRI
    
    Avoid having to search the device tree once again in order to simply
    recover the path we used to open the device.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17da58f904e75d434aaf71e297e15d41153ba954
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 30 11:01:49 2013 +0100

    sna: Replace conflicting drmDropMaster
    
    Calling drmDropMaster twice along the CloseScreen path is not a good
    idea.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a787da7e888da7e9943be94bd1cb177fe1495ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 29 21:57:20 2013 +0100

    sna: Allow tiled memcpy on i386
    
    With the split into per-swizzle functions, and with the forced
    optimisation levels, it appears that i386 doesn't suffer so badly and
    the tiled memcpy are a viable method.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d9941a7c003587c0bd732fb8b21fee5cefa6f87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 29 21:56:13 2013 +0100

    sna: Add the Ofast option to the critical memcpy routines
    
    Always enable gcc to fully optimize the core memcpy routines (provided
    that optimisations are not entirely disabled, for instance for
    debugging).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84c190db33142f3c1ec347ec0bf87f77ce132d36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 29 19:06:40 2013 +0100

    sna: Fix get_image_inplace to use the pixmap offset
    
    The inplace routine assumed that the region to be read was already in
    pixmap coordinates. Making it so makes the code easier, so do it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7d246ba6f750ee080c38ccc5603d01fcf7fce92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 29 16:31:34 2013 +0100

    sna: Move the clone discard into free-gpu
    
    Rather than peppering the discard manually before the call to free the
    GPU bo, always discard the COW when we actually free the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ab2a3acf71b5204c399c7649e5601c93a99f25f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 29 15:04:09 2013 +0100

    sna: Improve checks for coherent access through CPU mappings
    
    Refactor the CPU mapping tests to a single function, and remember to
    test for a pending GPU write (i.e. bo->exec).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9026bb954646c0425360c2236e26c79d097142cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 15:59:17 2013 +0100

    sna: Inspect the dirty boxes when querying whether damage contains a rectangle
    
    This helps in the cases where we have subtracted a small number of
    rectangles from an all-damage pixmap (such as a number of successive
    GetImage, PutImage operations). The danger is that we end up searching a
    long list of dirty boxes - maybe just search the first chunk if that
    becomes noticeable?
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d635e05c9dd26a397ccf958be091b56d1075e923
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 19:24:06 2013 +0100

    sna: Promote assert(!priv->mapped) along migration paths
    
    With the advent of the more permissive mapping schemes and finer damage
    tracking, we are more liable to have pixmaps mapped and so can reach the
    upload path with the pixmap still mapped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d40500851a7c6d857b17258e4989ddf7401cfbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 15:12:13 2013 +0100

    sna: Add asserts around applying clears
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3ad737ef9d33e924b206741949d59224bfef566
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 15:33:54 2013 +0100

    sna: Use inplace CPU mapping readback for GetImage on linear buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 626b5e541663f838475eaef2c1bc3ae4d4848165
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 14:24:10 2013 +0100

    sna: Add debug control for disabling accelerated GetImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2356579cdff36adf58fb69894f646a6e63053a15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 13:18:00 2013 +0100

    sna: Assert that the kernel tiling mode matches our bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e979d32bb71fef7341ceb9c2b2e80c6dfa50a7b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 10:59:23 2013 +0100

    sna/gen2+: Consider precision in render operation placement
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66297
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 541f816815e392db9e798d2f940029d82a6b2e0b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 10:14:16 2013 +0100

    sna: Markup when a gradient is opaque
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34e6366f2a61c145445056e5fc6c483999c0402c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 10:03:47 2013 +0100

    sna/blt: Remove a pair of leftover asserts
    
    As the variable they were inspecting was removed, the asserts are now
    breaking the debug build.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c93a0cf41cbfe88b18e9e69bd97bd75cf2404bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 00:35:14 2013 +0100

    sna: Compensate redirect drawing subrectangle inside an offset pixmap
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66249
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e33fbd6d7ff2a9efcc14974a05b5e1eb01bbce34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 28 08:53:32 2013 +0100

    sna/blt: Refine op placement logic for handling current source location
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48b5ac11a0737f65de2e6290308bd37017cc29a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 21:39:30 2013 +0100

    intel: Use fcntl to try and set CLOEXEC if the open(O_CLOEXEC) fails
    
    As suggested by Arkadiusz Miskiewicz.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b3e5c211451ac07bd96cd997ac714bcbe1809b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 21:08:05 2013 +0100

    intel: #ifdef O_CLOEXEC for compilation on squeeze
    
    If the system doesn't support O_CLOEXEC, then we simply can't use it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caf43fcadb0fcb3d342543f1e7dd78ee2314a627
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 16:52:21 2013 +0100

    sna: Enable memcpy_from_tiled for the IO paths
    
    Should you ever need to read back from a tiled surface and for whatever
    reason do not have a CPU bo to accelerate the operation, maybe we could
    use the manual tiling instead (as it is useful elsewhere).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5e85e495e55e2537d305b7bebacdf6f97b66199
Author: Roy.Li <rongqing.li@windriver.com>
Date:   Thu Jun 27 14:10:14 2013 +0800

    uxa: fix the compilation error with xorg-xserver <= 1.10
    
    struct _Screen has no canDoBGNoneRoot when ABI_VIDEODRV_VERSION is less than 10.0
    
    Signed-off-by: Roy.Li <rongqing.li@windriver.com>

commit 41715af4d009bfcb351946ddaa3a3ea3767a1429
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 16:36:52 2013 +0100

    configure: SNA supports the old Xorgs
    
    So allow it to be compiled by default for older Xorgs as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ce487617445c81f0178823de8896a2b73bbaaf1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 16:08:43 2013 +0100

    sna: Trim the large object threshold
    
    Be kinder to smaller machines by lowering the threshold at which treat
    an object as huge and worthy of avoiding duplication.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31467e18d2ccdc42b0601b43b581524859de1373
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 16:07:36 2013 +0100

    sna: Prefer operating inplace with a very large GPU bo
    
    As we strive to only keep one copy when working with very large objects,
    so try operating inplace on a mapping for CPU operations with a large
    GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b615ce97ec43ea8fe02e995244c757138abcb2de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 10:45:22 2013 +0100

    sna: Add a fast path for reading back from tiled X bo
    
    This is lower latency than the double copy incurred for first moving the
    bo to the CPU and then copying it back - but due to the less efficient
    tiled memcpy, it has lower throughput. So x11perf -shmget500 suffers
    (by about 30%) but real world applications improve by about 2x.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6493c8c65f93ad2554c2512a07ba640e966fd026
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 10:45:13 2013 +0100

    sna: Implement memcpy_from_tiled functions (for X-tiling only atm)
    
    To provide symmetry with the ability to write into an X-tiled mapping of
    a bo, we add the memcpy_from_tiled to be able to read back from the same
    bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60d716b53993b08a2a00c22f523c575e62e0a18d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 14:11:00 2013 +0100

    sna: Add the probed CRTC mode to the list of output modes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 263e87d5e1915e6c40fa8bc1b325a36f21f92b30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 13:57:22 2013 +0100

    sna: Set the current mode when initialising CRTCs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f2f439c9cfdd394ad2b9a125db51e2dba7d3ff7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 12:58:58 2013 +0100

    sna: Fake the output physical width/height from the CRTC size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5124f35168c0cc162cf5e8bcaafdf756945f6ca9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 12:32:24 2013 +0100

    sna: Support operations inplace on CPU mappings of a region
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18ee5c20d5f8f1752b89f2377e9b9c3f1c140d53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 11:49:33 2013 +0100

    sna: We can read from cloned pixmaps inplace - so long as we don't write
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36993618b4c5d4fa1fde7800eaaa711b074bd623
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 10:48:23 2013 +0100

    sna: Tweak ordering of userptr temporary mappings for uploads
    
    There are a few more circumstances where the temporary mapping is
    beneficial, such as pixmaps that are only shadow copies or operations
    that require reads on the destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6ad9861f00a3166fd89a7c43d602a4c2a5bde24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 10:59:06 2013 +0100

    sna: Fix DBG printing of can_upload_tiled_x()
    
    The function changed it parameters, this DBG caller did not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 591981a36c333cdf08a91f28fb9670a62b95d31a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 10:02:28 2013 +0100

    sna: Refactor freeing gpu_bo in manual tiled upload
    
    Use the common function so that we correctly check for pinned GPU bo,
    and adjust the hints afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f6dcc15c8d6ea726a10ef5df18536f8c769291e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 27 09:27:57 2013 +0100

    sna: Detect and handle cloned pixels for manual tiled uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7be3df2fe632bbc8e4f09709cf3cf7a5ef61015
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 17:01:37 2013 +0100

    sna: Se the default gamma if left uninitialized by the driver
    
    Due to a bug in i915.ko the gamma ramp is left uninitialised...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 491f4fab21df97af1dae92eaf30e76ff62920fb2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 15:15:17 2013 +0100

    sna: Correct typo s/\j/\n/
    
    When is a newline, not a newline? When it is ajar.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a40dd0ed6db35c891710199cc9d18345ab53b397
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 14:50:19 2013 +0100

    sna: Explicitly initialise the probed transform for a CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 01ce3ef9f12d3b6541e166f22e1ae67033237159
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 14:26:22 2013 +0100

    sna: Set RR_Rotate_0 instead of 0 as desired initial rotation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5651254c3c152daf1ed79073779c1bed6ed0a9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 14:18:49 2013 +0100

    sna: Fallback to xf86InitialConfiguration if nothing is connected
    
    Use the default mechanism for picking a fallback output and mode if
    nothing is connected at X startup.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a6a21bff86100144ba7960fc32a299ac54ada83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 13:29:48 2013 +0100

    sna: Use the existing configuration for initial modes
    
    After checking for user overrides (preferred output modes, rotation and
    placement), copy the current CRTC configuration from the kernel into the
    desired modes. This should enable X to start without introducing any extra
    flicker.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 362b0dc6a3b1692b752d8f250075ccc81debfca3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 12:04:46 2013 +0100

    sna/gen4+: Fix determination of intermediate extents
    
    Complete logic fail for finding the bounding box of the boxes to be
    copied.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66168
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2212468315f383d09ea17c2edac8666bdb862bc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 26 11:26:29 2013 +0100

    sna: Avoid allocating a temporary if using rendercpy tiles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc5b9a96194583c67705d7d05afc3e04e97e3338
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 22:58:31 2013 +0100

    sna: Clear mapped state after performing manual tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f33abee370bb1ce60bca91f29affc62d06b0bad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 22:43:48 2013 +0100

    sna: Do not force creation of CPU maps on !llc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77fa8ab08b441934218ddb8f690be1a919f0ec64
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 22:25:25 2013 +0100

    sna: Free just-allocated bo if we fail to set-tiling on CREATE_EXACT
    
    If the caller requires an exactly constructed bo, abandon the attempt if
    we cannot set the tiling as specified.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 273716029e5318f1670e7111be2085c950995d42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 21:35:09 2013 +0100

    sna: Rearrange tiled x upload so that damage accumulation is last
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e033a28bcb37867f3c947475714e1ef45c868825
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 21:12:23 2013 +0100

    sna: Optimize clears to white
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b77c334a26c55d3028971897dcba21407a7a4743
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 19:08:30 2013 +0100

    sna: Do not perform tiling inplace if the destination is busy
    
    Rather than waiting on the GPU stall, just use the standard mechanisms to
    queue the uploads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b0cdf28b884755cb842d3303fc0dd9bec62ab24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 18:09:36 2013 +0100

    sna: Be explicit when creating tiled-x pixmaps for manual tiling uplaods
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98feba417c87dce020df6a6ed157e3546591d8e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 18:35:45 2013 +0100

    sna: Drop master when closing the screen
    
    As we reacquire master when initialisation the next gen of the server,
    to keep the reference counting consistent we need to release our master
    reference on CloseScreen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit febfd388235fbe566a505d7d83733305cf344850
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 18:05:28 2013 +0100

    intel: Use the correct errno value for reporting the drmSetVersion failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e2c448a77ab9dce4807b159708290cd7ad26b5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 25 14:22:28 2013 +0100

    sna: Don't flag IGNORE_CPU for partial overwritten blocks
    
    As we set the flags for the migration extents, but only operate upon the
    boxes in the region, we need to be careful to be sure to migrate data
    outside of the boxes overwritten.
    
    Fixes regression from
    commit 94cbe7bf7b7acc9a7f2cb56c5e275af028f3cdc8 [2.21.10]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jun 20 19:40:44 2013 +0100
    
        sna: Mark overwriting CopyArea as not needing the dst damage
    
    If we start passing around regions rather than extents, we coud do
    finergrained migration decision.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55244
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27ebef515ebc034b9b41a0f3d26ad7e6f966305e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 24 13:31:25 2013 +0100

    Add the nickle utility scripts to the tarball
    
    So that the tarball matches the git checkout.
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c88d911d4209a8ede5ec705ad925383c69182977
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 24 14:30:00 2013 +0100

    sna: Initialise gc->ops->PolyPoint for miWideDash
    
    The miWideDash may also call PolyPoint rather than emit spans, so make
    sure that we correctly prepare sna_poly_point before calling mi*.
    
    Reported-by: Tobias Brodel <toby.jamesjoy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66104
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72e8ab2b8f7aabee3bd891f08c64f5b2587da8e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 24 11:46:38 2013 +0100

    sna: Remove unused brw_eu_debug.c
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ca4ae441c61b1f425453cc443bb1d4d10d25aaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 23:41:57 2013 +0100

    sna: Check for a request to create an inactive scanout
    
    The combination is just about valid and used along some odd paths, so
    replace the assertion with a regular checks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b459ab9eeba4c865f15f0b3e28af318948b4adbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 23:00:55 2013 +0100

    sna: Move the reset bo to the right list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77ddadf0ec6b867a0638660bf06c82ad31577795
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 22:01:12 2013 +0100

    sna: Clear 'clear' hint upon uploading into tiled
    
    Fixes regression from
    commit 53c113c3cc2f8527debc185f0819139ca8637637 [2.21.10]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Jun 21 19:27:24 2013 +0100
    
        sna: Allow PutImage to write inplace using manual tiling
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=66059
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3de043d2de4aa11a85c56faf1658ec4c4699da2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 21:30:56 2013 +0100

    sna: Discard proxy upload buffers before overwritting for PutImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d68d24dc3727dcc281bc9b45bc605874f3a3c4f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 19:08:32 2013 +0100

    sna: Discard overwritten incomplete operations before migrating
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60dbd5a5b6cd56b7a33eac3afebe2d94ac8579c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 18:51:38 2013 +0100

    sna: Document swizzling for DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd375da5caf34f93a4e87670bb0c70fec5b4c55c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 17:06:11 2013 +0100

    sna: Allow tiled uploads to accumulate damage
    
    And for the upload to create the bo as required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0e383363e8707c132a8a1748757d84120a99b31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 10:55:21 2013 +0100

    sna/gen5: Elide the forced flush after a drawrect
    
    Presume that the non-pipelined drawrect is sufficient to serialise
    operations to the render cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16fb786bd0791986fcac8b11a7e182090c5b6249
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 23 09:00:17 2013 +0100

    sna/gen5: Force a write flush when changing blend modes
    
    Otherwise it appears that the hardware will readback from memory
    bypassing its render cache after a change of modes. There is probably a
    lot more subtly to it than this, but this appears to be a good first
    approximation.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9eabe28a4046b33772bcfe109346179b81294420
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 22 17:37:19 2013 +0100

    Tidy version query for i915.ko
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ec0378b64e88923ba1c4eba043488685aa3a795
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 22 17:30:02 2013 +0100

    sna: Only open the /dev/dri/cardX device once
    
    Merge the device open in the main driver with the probing so that we can
    open the path explicitly passed in by the PlatformProbe and keep that fd
    around for the main driver and so avoid a later search.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41badce186fe0f6e8f49e30b6c1c251027161e35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 22 16:34:20 2013 +0100

    sna: Add reference counting to drmMaster for Zaphod
    
    With Zaphod enabled, we will try to acquire/release the drmMaster
    several times on each enter/leave VT. This obviously flags an error (and
    drops the master too early), so track the number of references we still
    hold for drmMaster.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=66041
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81b35092c39bf6d9851ac37da4b20358405cf314
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 22 09:22:45 2013 +0100

    2.21.10 release

commit 5189ba727fe48990f00d5787c53d7b15fa1838a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 22 13:39:47 2013 +0100

    sna: Refine the self-cow copy hack to reduce collateral damage
    
    Sergio Callegari found a case in LibreOffice that copied cloned pixmaps
    onto each other and then modified one of the pair. This was triggering
    the hack put in to speed up firefox scrolling, unfortunately.
    
    Reported-by: Sergio Callegari <sergio.callegari@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=65665
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62e42de300275a668a326357d454062221714fe8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 21 21:00:23 2013 +0100

    sna: Determine swizzling once during initialisation and choose memcpy_to_tiled_x
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53c113c3cc2f8527debc185f0819139ca8637637
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 21 19:27:24 2013 +0100

    sna: Allow PutImage to write inplace using manual tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48028a7c923fa0d66b01e8e94d4f0742866f78ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 21 14:29:43 2013 +0100

    sna: Inspect availablity of render before prefering to use the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71fc83401ec8c560a89a284805e849954ea18ee4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 21 14:28:38 2013 +0100

    sna: Check if we may want to simply upload for a CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e90e522199c4d6b479554073acb33e9d82fb8cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 21 14:27:42 2013 +0100

    sna: Fix inspection of transfer extents for deciding transport
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94cbe7bf7b7acc9a7f2cb56c5e275af028f3cdc8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 20 19:40:44 2013 +0100

    sna: Mark overwriting CopyArea as not needing the dst damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3d1118bbee1172f72c946163a37ca4ad5feecce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 20 19:34:18 2013 +0100

    sna: Promote the CopyArea to the GPU if it subsumes the CPU damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 186ac909ad2099f834e7b2c513a02cd4d041327c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 20 15:32:30 2013 +0100

    sna: Fix tiled scanout limits for Valleyview
    
    It appears that Valleyview shares the same scanout limits as gen4.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 112fc5f370f8daf267d7241ca2d669194abaa183
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 19:53:14 2013 +0100

    sna: Tidy a redundant conditional for CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba642d9ff86fcf8b0b758d65565e3b5b6293b667
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 16:27:36 2013 +0100

    sna: Fix the pitch limits for gen3 scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06679c1433cfb21ba925584700e2e97439fdf64a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 16:16:14 2013 +0100

    Revert "sna: Apply scanout stride limits to tiling selection"
    
    This reverts commit cc08f6e0ef54744434fe0fd6d76348ee6099a62d.
    
    Prefer to keep the frontbuffer as tiled, and use an per-crtc pixmap in
    case the frontbuffer is not suitable as the framebuffer.

commit f165d2e21358703c5f4ed302a4a57219db482a59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 16:15:32 2013 +0100

    sna: Switch to a per-crtc pixmap if the pitch exceeds scanout limitations
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=65099
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc08f6e0ef54744434fe0fd6d76348ee6099a62d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 15:50:01 2013 +0100

    sna: Apply scanout stride limits to tiling selection
    
    gen4 has a restricted DSPSTRIDE limit for tiled surfaces lower than the
    maximum supported size of the CRTC. So we need to double check
    whether tiling the scanout is supported before attempting to allocate a
    tiled scanout.
    
    Reported-by: Paul Donohue <freedesktop-bugs@PaulSD.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65099
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f95ed64a11339b801d655ee173f37e01727a4a87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 19 14:47:46 2013 +0100

    sna: Assert that the scanout fits within the allocated buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6132400365f8f467d838ed26002e74412e1c7298
Author: Jonathan Gray <jsg@jsg.id.au>
Date:   Wed Jun 19 11:30:24 2013 +0100

    configure: test for librt (clock_gettime)
    
    clock_gettime() is in libc not librt on OpenBSD so check
    to see if linking librt is required.
    
    Signed-off-by: Jonathan Gray <jsg@jsg.id.au>

commit f567f19b37d00131cda749e31c6d2dc8b52a1d62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 18 22:17:11 2013 +0100

    sna: Allow wedged pixmaps to be accessed via GTT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3695c3c6b7bc13b5e642c9d92648e8228411bed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 18 09:41:20 2013 +0100

    sna: Specialise mi calls to PolyFillRect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40329e34b9ac65d930757d53283b7d8f4066c3a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 15 13:25:39 2013 +0100

    sna: Add extra assertions to sanity check CPU access is coherent
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abb522e07a2c3bf39e2587ddedc4bb8ac955c536
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 18 09:01:49 2013 +0100

    sna: Do not sync after a failed mapping
    
    The domain update should be a redundant operation, causing needless
    extra transitions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6086abca13efdeaf9b24c9fbe425546cbe2cfb12
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 17 22:44:58 2013 +0100

    sna: Try falling back through an upload if inplace mapping fails
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a86b217934a9a16843ac17b38cd5b61393f65aa0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 18 09:45:08 2013 +0100

    sna: Mark the base bo as unreusable for temporary mappings
    
    Update required after forcing unaligned userptr to use proxies.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca913e8f1e4b113af3a30cca50679436df23bef1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 17 22:44:20 2013 +0100

    sna: Unwrap proxies for subpage offset SHM pixmaps during sync
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d54049808daafed12cf99ff6a1a7395136ab1dc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 12 19:13:12 2013 +0100

    sna: Refactor scanout flushing
    
    In preparation for extending the kernel interface to be more explicit
    about when we need to flush a direct write to the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ebcf94736926d4c7bb5ba1627be0a62b15c1663
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 15 12:27:19 2013 +0100

    sna: Be explicit in not marking an upload buffer as being on the cpu
    
    Since the upload buffer is special in that it simultaneously exists on
    both the CPU and GPU, we need to be extremely careful in marking the cpu
    hint flag and asserting it. In particular, the new stricter assert was
    firing in the CompositeTrapezoids fallback path.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cafa33a522ac634d465f24d0a1607516e65a0828
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 13 22:51:42 2013 +0100

    sna/gen3+: Remove redundant clearing of clear hint in video playback
    
    The clear hint is correctly updated when performing the move-to-gpu and
    so it is being superfluously repeated by the callers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45ca894bce73e199d679b9f147c52ada59e40ccb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 13 16:47:10 2013 +0100

    sna: Tighten a few asserts on pixmap migration
    
    Tracking to track down where the CPU hint may be set to true but the
    pixmap remain entirely damaged on the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f340f90f4b2f269d6308d0bd31fbc2a5f579608
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 13 16:08:49 2013 +0100

    sna/gen7: Set sampler swizzle for video sources
    
    Otherwise the sampler on Haswell will just read all zeros when trying to
    playback a video.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65699
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f20be82563176c45a31a9676b68a3455566bc67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 13 11:18:42 2013 +0100

    sna/gen2+: Promote a conditional dirty into an assertion
    
    If the target bo is not bound when we start to emit the composite state
    for the operation, we are screwed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6655cc1d9735a8433994c762583753b12e2125b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 12 18:44:27 2013 +0100

    sna: Do not enlarge the read back region if there is already CPU damage
    
    We enlarge the read back into to minimise the number of times we have to
    migrate pixmap data. However, if we then enlarge the read so that it
    overwrites CPU dirty data, then we can introduce corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f180b89db412c5fa9fe95c8f6634be33a1d8581
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 12 14:23:32 2013 +0100

    sna/video: Free the private video (adaptor/port) arrays upon CloseScreen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04ea469d4f30f9bb25561f3d04f1463999c8d928
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 12 14:20:10 2013 +0100

    sna/video: Catch allocation failure whilst setting up the TexturedAdaptor
    
    Missing NULL check for calloc of the port private array.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc8f2def5461c75fce6d648036a61186fd00d23f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 12 08:34:48 2013 +0100

    sna: Allow the throttling to be woken by SIGINT
    
    Rather than completely starve X from handling input events and raising
    the spectre of miEQ overflow, stop throttling upon SIGINT. We will have
    waited a small period of time (~100ms) for the GPU to catch up, and will
    do so again in the near future. This also preserves the hang detection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15b92c98755c709f41e59baeb206e5a3e56e3178
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 11 14:23:57 2013 +0100

    sna: Make sure the source is coherent on the CPU before uploading
    
    Similar to 7d91051c, but along the render path rather than CopyArea.
    
    Makes the presumption that for the upload path the region is stored on
    the CPU explicit.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=61628
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1392f296a3fc94bb64abe4c3370c2f3cd52bef9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 11 15:10:06 2013 +0100

    sna: Mollify an assert to allow us to call busy_ioctl on a GTT write
    
    The code was being careful in making sure that only a BO with an
    outstanding GPU write was being flushed. We need to relax that
    assertion to allow us to call busy_ioctl after only GTT writes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d91051c50210560dbd93a9e36f30d9f74ce9133
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 11 14:23:57 2013 +0100

    sna: Make sure the source is coherent on the CPU before uploading
    
    Makes the presumption that for the upload path the region is stored on
    the CPU explicit.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=61628
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e2db4b88f741ca6cd4312c6c5242261c5de4d06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 11 00:49:35 2013 +0100

    sna: Tidy batch submission around CRTC updates
    
    A few places we were redundantly submitting the same bo, and in others
    doing more work than necessary.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9439a56170c4732b340137d306933a742ee6ae9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 10 22:56:20 2013 +0100

    sna: Move the GTT dirty tracking from the pixmap to the bo
    
    This allows us to more accurately track when the GTT is dirty. However,
    the only danger is that we may prematurely flush the scanout and clear
    the dirty bit and not preserve the flush timer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f0c5a49538d9995926b8dbda85c8e6d99496f17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 10 22:48:03 2013 +0100

    sna: s/bo->dirty/bo->gpu_dirty/ to avoid later confusion
    
    The next step is to introduce bo->gtt_dirty.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b44307753655fac985404c519a54ca65da323900
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 10 21:34:52 2013 +0100

    sna: Make sure all sna_write_boxes* flag the GTT is dirty
    
    Better would be to start passing in the sna_pixmap so that we can mark
    the GTT as dirty in a single location, and only if we do indeed then do
    a GTT update or pwrite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 005075de9d20fe7c2b9a6e184c912559929710ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 10 14:50:47 2013 +0100

    sna: Keep the cached EDID if it hasn't changed
    
    Rather than reparsing the EDID each time we probe the modes, if the
    property hasn't changed keep it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d760c9b32776bf2f1acde9256388769a9c5a398
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 5 12:52:11 2013 +0100

    sna: Streamline connector probing
    
    This is a tidy up in preparation for a more controversial patch. In the
    meantime, take advantage of information that remains static over the
    lifetime of our connectors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b584162e387187a7cdb7f46a3a151e00e7d3de58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 7 16:32:40 2013 +0100

    sna: Set the needs_flush flag on the bo when the scanout is dirty
    
    Since the call to the busy_ioctl is predicated on whether the bo needs
    to be flushed by us, therefore when forcing the call to the busy_ioctl
    to flush the GTT we need to mark it as requiring needs_flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7151e437df4437df35a67ae125607e665c66353c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 7 16:09:18 2013 +0100

    sna: Track when we write directly to bo through the GTT
    
    In the future, we may need to explicitly flush GTT writes to the
    scanout, so add the infrastructure to do so now.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79145b70a7bda2941059ce7e630f84e2b24b465a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 7 15:33:51 2013 +0100

    sna/dri: Check rather than assert for a change in back/front sizes
    
    The DRI2 midlayer may, or may not, recreate the back buffer after a
    pixmap change. The result is that the back buffer may or may not be
    flagged as unsuitable for flipping, so be paranoid and double check.
    (This behaviour was first introduced in 1.9.0 and looks to be removed
    again in 1.15.0)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f91643cde954c23633c6f91940f7216796b949c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 7 14:50:55 2013 +0100

    sna/dri: Fix transcription error in commit ab47433b20
    
    Reversed a predicate causing it to fail to blit when it had a
    drawable (and worse dereferencing a NULL pointer) instead of terminating
    when the Drawable was gone.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e85271e516f811c60f440de61995cc5baf469a47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 7 13:35:48 2013 +0100

    sna/dri: Do not decouple the flip after chaining up a blit
    
    Fixes regression from previous patch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab47433b20a623bf790acfbf2005a8782d177f64
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 23:15:14 2013 +0100

    sna/video: Select vsync by default based on "SwapbuffersWait"
    
    To be strictly identical to the DRI code, we should override the user
    when the option is set. However, this a baby step for simple bug
    testing.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1176647
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e1e18aca214a8705270972131a1800c81bc3b4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 21:40:30 2013 +0100

    sna/video: Fixup formats to select visuals
    
    Fixes regression from
    commit 195a51353c3af7bd253227da5f759f06cea01f73 [2.21.8]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Apr 9 19:13:46 2013 +0100
    
    	sna/video: Convert to a pure Xv backend
    
    Reported-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65479
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0869acc0a6a5b92f5528049d2bd5ec62121ba114
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 21:21:24 2013 +0100

    sna/dri: Make the fallback blit async again
    
    Previously it was async, and is likely to be anyway as the pageflip
    failed due to the change in output. To be safe, once again request that
    the copy does not stall the GPU upon the scanline window.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b52c852aaf42dde3a7f29c065e4d5230eac7a64
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 16:40:01 2013 +0100

    sna/dri: Handle fast double flips across mode changes
    
    The tricky nature of the double flip is that there is no SwapComplete
    pending and so we must avoid calling it under such circumstances.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0da5cc23b18d4e2473a3b6a571fb49d08bb1dd2d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 14:11:50 2013 +0100

    sna: Fix format specifier for mismatching int/long in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2770655371954413c750b030c9a7135baee302d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 12:04:23 2013 +0100

    2.21.9 release

commit d3345cd269dc75999b35f3286d21059974dcb24b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 6 12:18:32 2013 +0100

    sna: Only emit an error for terminal mmap failures
    
    If we repeat the mmap, keep quiet. Only emit the ErrorF in case even the
    repeated attempts to mmap the bo fail.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70fa080d02bff9742523cea52c875d9447a78bfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 5 23:32:01 2013 +0100

    sna: Include the GT details in the backend name for a chipset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45c09bfe58c37bbf7965af25bdd4fa5c37c0908f
Author: Rodrigo Vivi <rodrigo.vivi@gmail.com>
Date:   Wed Jun 5 13:07:13 2013 -0300

    Add more correct names for Haswell.
    
    As we find out more of the final product names for Haswell chipsets, we
    need to update the user visible identification strings.
    
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@gmail.com>

commit a9f9fb8e44bb0bdbd004da1fce986585ebcafd28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 5 09:48:19 2013 +0100

    sna/video: Fix redundant initialisation of video->clip
    
    It will be created before use anyway, but this silences a compiler
    warning.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d0ae71f1d667759ed4cfd2b7e793a08b8e3702c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 5 09:12:48 2013 +0100

    sna: Do not conflate ignoring an output with an allocation failure
    
    If the user explicitly ignores an output through xorg.conf, then
    xf86OutputCreate returns NULL. This is not to be confused with an
    allocation error that also returns NULL. The latter is terminal, the
    former is desired.
    
    Fixes regression from commit a9acc8dbb436e1e523e7d7c0f3c41946a2d0f245
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu May 30 12:09:52 2013 +0100
    
        sna: Cleanup up error reporting after failure to init KMS interface
    
    Reported-by: David Rosca <nowrep@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65381
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6dacaddb6a28670a52cead4b62c056a8acde8f3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 3 15:34:37 2013 +0100

    sna: Always populate the CPU features string
    
    So that we don't print random contents of the stack on ancient 32-bit
    CPUs with no extended instruction sets.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1186800
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a88c01c3737a3570628600b1ab51938f82e226d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 3 14:14:09 2013 +0100

    sna: Make copying the glyph size more compact
    
    The assembly was ugly with an unwarranted AGU stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66ad4d6f3c990bd40d816b4a22122bbf64786e4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 2 12:13:46 2013 +0100

    sna/dri: Undo any COW before performing a copy with DRI2CopyRegion
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65250
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a8ff7861c50b2f8698a968a011d5d833c7d5975
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 2 12:13:28 2013 +0100

    sna: Add some more DBG hints to copy-on-write cloning
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4ad7b14ca71b95af83864b05793ea357f48bb88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 1 16:58:15 2013 +0100

    sna: Prevent adding damage to an already all-damaged GPU bo
    
    Keep the bookkeeping straight after propagating the source clear colour:
    commit 810a0ce2f89ba6b343b5043963626c0f2d50fb22 [2.21.7]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 10 12:02:10 2013 +0100
    
        sna: Propagate clear color when replacing by a CopyArea
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65247
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be84b6929705584f30b63d6e613ff3d8e6e3dc1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 1 16:51:38 2013 +0100

    sna/dri: Reorder assert not to fail on a pageflip deferred to after a modeset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e11b520bbdb1af7e977db7fdef2d4c41242d56f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 30 15:34:08 2013 +0100

    sna: Compile fix for non-debug builds
    
    sna_display.c: In function 'get_fb':
    sna_display.c:181:3: warning: implicit declaration of function 'assert_scanout' [-Wimplicit-function-declaration]
    sna_display.c:181:3: warning: nested extern declaration of 'assert_scanout' [-Wnested-externs]
    
    * sigh
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a9975729c665cd09a33e33eab608350aaee8160
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 30 14:15:23 2013 +0100

    sna: Restore GPU promotion for large fills
    
    Fix another regression from
    commit ef9dc6fae585d5616446eedc1e6e91173f4064c1 [2.21.7]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon May 20 11:08:51 2013 +0100
    
        sna: Undo a few more overwritten operations upon a bo
    
    The REPLACES predicate was meant to complement the existing tests, not
    be compulsory.
    
    Found whilst investigating why performance seemed to have dropped off in
    Phoronix's benchmarks.
    
    Reported-by: Michael Larabel <michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08b33ba8f12bb4bc425ca1bc40e2660e446e2c65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 30 14:57:56 2013 +0100

    sna: Assert that an existing scanout is the desired size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9acc8dbb436e1e523e7d7c0f3c41946a2d0f245
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 30 12:09:52 2013 +0100

    sna: Cleanup up error reporting after failure to init KMS interface
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4fcb0e7d24a104afb642dd8819e67ffcaafbfb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 30 12:02:44 2013 +0100

    sna: Report allocations failures during Screen initialisation
    
    Just abort instead of trying to limp on if we fail to even allocate
    memory during initialisation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f7c8087db6af58109e791763fe33582a1559646
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 29 12:25:37 2013 +0100

    sna: Log which outputs are being configured during a modeset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc1e0702b25e647cb423851fb7228989fec28bd6
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed May 29 11:25:28 2013 +0100

    sna: fixup up possible_clones kms->X impedance mismatch
    
    We need to be a notch more careful with remapping the possible clones
    mask from the kernel:
    - SDVO and Haswell DDI have multiple connectors mapping to the same encoder.
    - The connector list can be reordered compared to the encoder list.
      This is used to move eDP/LVDS to the front.
    
    Also add even more debug output.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit b7aa05e44b1f88284183c1c73bb074dd5dce74cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 28 23:01:30 2013 +0100

    sna: Sanity check that CRTC / output combination is valid
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b507796679529b14c99e8937870561cd8eebebb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 28 12:13:02 2013 +0100

    Add the known marketing names for the performance Haswell parts
    
    Start filling in the names for the parts that have been announced, the
    Iris branded Haswell GT3 parts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3169768ddf8c8977d2ace3675611b5ec6eba7ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 28 12:02:56 2013 +0100

    sna: Make the backend identifier more informative
    
    This is useful, for example, with the multiple gen7 variants.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0839e3316a02380cd64d354ee0ec9d4c2b8eecf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 28 11:18:14 2013 +0100

    sna: Call mode update after disabling outputs upon VT switch
    
    Perform a second sanity check that all the outputs we expect to be
    active remain so following the cleanup after VT switching.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d64f596b895071ea253481c97275bf551c013e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 27 21:13:40 2013 +0100

    test: Add an easily visible tearing test for video playback
    
    Contributed by Matti Hamalainen.

commit f38d037b94aacdccb2aaa058bbe48d1c8079d604
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 27 21:07:20 2013 +0100

    sna/video: Correct interpretation of 'sync'
    
    The 'sync' parameter past along XvPutImage is not a request for us to
    perform the operation synchronised to the vblank, rather a hint that the
    client wishes the operation to be synchronous. In Xorg, this is
    implemented as an immediate ShmCompletion event so make sure we flush
    the operation to hw in this case.
    
    Fixes regression from
    commit 195a51353c3af7bd253227da5f759f06cea01f73 [2.21.8]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Apr 9 19:13:46 2013 +0100
    
        sna/video: Convert to a pure Xv backend
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=65048
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e7d0ad15bafc4624f8c2ccf73c08ead5cc6fd6a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 27 13:41:13 2013 +0100

    2.21.8 release

commit 51103d8637ba34a0d5f3507e196f54333aa765bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 25 15:53:11 2013 +0100

    sna: Free the released COW reference when uncloning
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Reported-by: David Gow <david@ingeniumdigital.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=64978
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fce4292ab7216a1c610ffc57aa6763e05b458904
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 15:15:13 2013 +0100

    sna: Fix cut'n'paste compile error from previous commit
    
    Always check for outstanding diff before pushing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2e139923dd000f13602e51d94bc8a265b5e234f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 15:08:13 2013 +0100

    sna: Log when the framebuffer changes size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 820f97ede7a38015a781de72cc265b0b65f86415
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 14:38:06 2013 +0100

    sna: Reorder cleanup of flush list and CPU bo to silence an assertion
    
    Keep the bookkeeping in order.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79e98ea6448f666d1a6dcca19bfe0e84fb62dd46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 13:08:26 2013 +0100

    sna: Reenable COW support
    
    Accidentally left it disabled whilst testing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6c35e58c1bb94ccfa04723db76d7164d5772f11
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 12:43:16 2013 +0100

    sna: Do not undo a bo if we may fallback
    
    If we undo the pending operations to a bo, then fallback we cause
    corruption. For example, see wine and its 1-bit rendering.
    
    Fixes regression from
    commit 07a4400fffe4f83df3debe62abd2c37b45f8f0c0 [2.21.7]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 10 11:59:59 2013 +0100
    
        sna: Attempt to discard overwritten operations before CopyArea
    
    Also we need to be more careful and consider alu when marking the
    operation as 'replaces'.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 818702d3dc48964e4fd11afe8f2fce431ae913c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 12:15:42 2013 +0100

    sna: Discard COW before migrating CPU damage to the GPU
    
    At that point, the GPU bo will no longer be a clone of the source and so
    we need to decouple it and make ourselves a fresh copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b9723767612702f4cfa2f73ffced83c46eccddf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 11:46:36 2013 +0100

    sna: Do make a clone of a GPU bo that is itself a cache
    
    As we do not attempt to undo the cache status upon the clone.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbe2b5896ec2cd00a456236467b221c9fafdd2f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 12:03:41 2013 +0100

    sna: Correct assertion for reusing COW
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2005b273e10f2b946f79c602b55a7bf585c936de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 24 11:02:20 2013 +0100

    sna: Check for NULL damage before dereferencing
    
    Fixes regression from
    commit 16a64649e9c440ab9457467fe04be25719a73e7c [2.21.7]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri May 10 15:48:58 2013 +0100
    
        sna: Basic copy-on-write support for cloning pixmaps
    
    Reported-by: Axel Rohde
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee7ea10148b7843091c3fa103f9f4476979f8b68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 23 12:55:21 2013 +0100

    sna: Only flags the PolyFillRect as REPLACES if it is unclipped
    
    Otherwise we discard a fill operation that is required to initialise the
    pixmap before drawing commences.
    
    Fixes regression from
    commit ef9dc6fae585d5616446eedc1e6e91173f4064c1 [2.21.7]
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon May 20 11:08:51 2013 +0100
    
        sna: Undo a few more overwritten operations upon a bo
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=64841
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87295b1ef85505689ce326137c2794230fb3f35f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 22 09:43:16 2013 +0100

    sna: Remove the overzealous assert
    
    IGNORE_CPU is sometimes only set when there is CPU damage to ignore...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2e0454f2df4289521b24de41fb41c68f7abf0ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 22 08:58:51 2013 +0100

    sna: Fix DBG typo and so fix build with --enable-debug
    
    s/hint/flags/ -- used the wrong variable name in an assert and upset the
    compiler.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abe85adda51c58d3f3b9c5dea6cec4b13a65cdcd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 21 13:39:35 2013 +0100

    sna: Warn about the consequences of disabling tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 195a51353c3af7bd253227da5f759f06cea01f73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 19:13:46 2013 +0100

    sna/video: Convert to a pure Xv backend
    
    This is to enable feature work which requires access to Client state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e42637050275945200797538a34c13c90b295cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 21 11:13:03 2013 +0100

    sna: Re-enable read-read optimisations
    
    Coacher is optimistic that the issue is no longer reproducible on his
    machine - and whilst I do not understand the root cause, I am confident
    that the kernel code is correct as is our use.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=61628
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e65ee10dfd7155230ac18a6d24a67b68336dc973
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 21 11:01:50 2013 +0100

    2.21.7 release

commit ef9dc6fae585d5616446eedc1e6e91173f4064c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 20 11:08:51 2013 +0100

    sna: Undo a few more overwritten operations upon a bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6c30d1d4df6bcdfa075bd29da7c8aabee20774c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 12:11:34 2013 +0100

    sna: Clear the cow_list when discarding the clone upon pixmap destroy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21f17455650d52848467290f609c678e85b8ceab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 11:46:16 2013 +0100

    sna: Add the missing ref(bo) when undoing the source clone
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee166ca856ac02ca8900b9ff44ed3899add2c72a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 11:30:03 2013 +0100

    sna: Undo the clone when replacing the DRI pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d31fe771b423a3768cbd05db994d49e941369e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 11:14:34 2013 +0100

    sna: Transfer ownership of the cloned bo to the pixmaps
    
    Fix the leak from the previous commit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d9315873e02d4acc5ddffc698dbf8984cbd5c42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 10:51:44 2013 +0100

    sna: Avoid replacing pinned bo when undoing a clone
    
    Otherwise we end up cloning the scanout only to leave it dangling if the
    client copies the from the front-buffer and then writes to it.
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=64675
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3efe143e367acfa2ff38c63388d24a8d06331944
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 17 10:30:51 2013 +0100

    sna: Clear mapped hints upon cloning a pair of pixmaps
    
    Once cloned, we do not want to use inplace operations and instead force
    a copy. However, if we do not relinquish the hints when copying across
    the bo, then those hints become stale and lead to corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f57a65c35268f215c17f1a02b3af50a6678ce3c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 14 16:15:57 2013 +0100

    sna: Correct assertions to allow discarding of cpu hint for inplace ops
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb0969e6a5c2bddcd0499d81c0c241003f8b07ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 14 15:22:59 2013 +0100

    sna: Assert that the mapping is released before closing the GEM handle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16a64649e9c440ab9457467fe04be25719a73e7c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 10 15:48:58 2013 +0100

    sna: Basic copy-on-write support for cloning pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d89b2647dc0b72d6fa6ff89065acd3776b04cd3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 10 18:17:24 2013 +0100

    sna: Propagate clears when using the BLT composite routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 810a0ce2f89ba6b343b5043963626c0f2d50fb22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 10 12:02:10 2013 +0100

    sna: Propagate clear color when replacing by a CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07a4400fffe4f83df3debe62abd2c37b45f8f0c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 10 11:59:59 2013 +0100

    sna: Attempt to discard overwritten operations before CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ee42de066e4629f78e254c27d07dc33e16dbc02
Author: Rodrigo Vivi <rodrigo.vivi@gmail.com>
Date:   Mon May 13 17:56:30 2013 -0300

    Adding more reserved PCI IDs for Haswell.
    
    As Chris mentioned there is a tendency for us to find out more
    PCI IDs only when users report. So let's add all new reserved Haswell IDs.
    I didn't have better names for this reserved ids and didn't want to use rsvd1
    and rsvd2 groups, so I decided to use "B" and "E" that stands for the last
    id digit.
    
    Cc: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@gmail.com>

commit ee96de8b1e7e4a305ee31c0ece1d9d38df8328f9
Author: Rodrigo Vivi <rodrigo.vivi@gmail.com>
Date:   Mon May 13 17:56:29 2013 -0300

    Fix Haswell GT3 names.
    
    When publishing first HSW ids we weren't allowed to use "GT3" codname.
    But this is the correct codname and Mesa is using it already.
    So to avoid people getting confused why in Mesa it is called GT3 and here
    it is called GT2_PLUS let's fix this name in a standard and correct way.
    
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@gmail.com>

commit 979d2f8d0038aa621e1c75200b10a3819e024a66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 22 18:00:32 2013 +0100

    sna/gen4: Tidy testing for an active vertex buffer id
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ba63307058337af5a120ad01c93b423a3e422eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 22 17:43:21 2013 +0100

    sna/gen4: Drop unused gen parameter to SF state setup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2217f6356b53263b6ce8f92b5c29c0614d4ef2a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 9 13:46:11 2013 +0100

    sna/trapezoids: Fix the determination of the trapezoid origin
    
    "src-x and src-y register the pattern to
    the floor of the top x and y coordinate of the left edge of the
    first trapezoid,"
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1178020
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e98df06fa9d218a6139730140a83a1940b05980
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 9 13:45:38 2013 +0100

    sna: Add more debugging to unaligned trapezoids
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d62ec25937ad296114bf890a7a5ac11ff03508c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 9 13:44:24 2013 +0100

    sna/gen7: Add DBG for channel setup for render source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit debdcd6a09464251324238ccbd935a6ade265d94
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 9 13:43:57 2013 +0100

    sna: Add DBG statements for choice of spans vertex emitter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6e4088dcb261d89fa0065eb7d9b62eada049dbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 9 11:30:05 2013 +0100

    sna: Handle cached upload buffers for partial migration to GPU
    
    Since the extended use of move_area_to_gpu for partial migration of
    render sources, we exposed the lack of handling of upload caches along
    that path.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 262ee1ef1e98cb84fa0af6e679c8cd61dc93f008
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 7 10:35:53 2013 +0100

    sna: Do not attempt to clean an active scanout
    
    For simplicity, skip buffers that are still in use by the batch - they
    will be removed later.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5637c173f85a5bb9a77572e4c070e0d612e6f49d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 1 15:14:55 2013 +0100

    sna: Be careful not to preemptively upload portions of a SHM pixmap
    
    Only upload the portion of the pixmap being used for this rendering
    operation, as outside of that may remain undefined and to be written by
    the client before a future operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca4a32c20d4c1f91552c02b9008ae16435b92d71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 1 10:18:23 2013 +0100

    sna: Page align requests to userptr
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab576a42650d8a743dd91108f774c220d866de95
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 27 12:06:30 2013 +0100

    Add all reserved PCI-IDs for Haswell
    
    There is a tendency for a product to ship based on a 'reserved' PCI-ID
    prior to us being notified about it. In other words, the first we find
    out about such a product is when customers start complaining about their
    shiny new hardware not being supported...
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=63701
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7dfb359677027310f4617b49f3da2321727a076f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 26 13:20:36 2013 +0100

    uxa/dri: Fix compile error for unknown 'bool'
    
    It appears that it is only accidentally pulled in on some systems, but
    not all.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=63957
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8eaafdb43998b5cdefb20b8098c558fa5decb115
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 24 15:48:14 2013 +0100

    sna: Prevent accessing an uninitialised region in move_area_to_gpu()
    
    If we skip the migration, we need to avoid using the unitialiased
    region. There is no bad consequence as both branches of the if are
    no-ops, but it does silence the static checkers and should make the
    predicate cheaper.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4871f1dac3d3c8d81101ef0f29eb69099ff2dcf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 18 09:51:39 2013 +0100

    sna: Rephrase initialisation without a specific backend
    
    "generic" sounds more impressive than "no"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6668f68054cb33e0cd3425f5403d14092a4a17f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 17 15:32:49 2013 +0100

    Revert "xgvevent"
    
    This reverts commit ddd75d6539dcf692cb76747cd63d1f301180f18a.
    
    This is a WIP patch, not ready for upstream. The danger of mixing topic
    branches.

commit 1bf0d869ae07ffc5b9cd79904b421cd37997ae8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 17 15:24:10 2013 +0100

    Prefer i830_dri.so for gen2 chipsets
    
    Probe for i830_dri.so and, if it exists, use that driver in preference
    to i915_dri.so for DRI (i.e. GL clients). This was suggested in the
    context of distributions supplying i915g as the main DRI driver for
    gen3, in which case we need to provide a separate DRI driver for gen2.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ddd75d6539dcf692cb76747cd63d1f301180f18a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 19:13:46 2013 +0100

    xgvevent

commit ddd3cc4ed6ac9b69f178147b49628b7a7f3f3104
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 16 11:55:23 2013 +0100

    sna: Add VALGRIND_CFLAGS whilst compiling with --enable-valgrind
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0b6ae2cfb811a8c234634c878800ca1fb95703f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 15 11:42:20 2013 +0100

    sna: Only release the scanout cache whilst DRM_MASTER
    
    If we try to release the framebuffers whilst not DRM_MASTER, the
    operation will fail and we will leak the buffers. So do not bother
    during the normal expiration to clean the scanout cache if vt switched
    away.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d68270ca84dc01a930c2ed0c05cecfac88c8cc4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 12 14:48:04 2013 +0100

    sna/xvmc: silence a compiler warning
    
    sna_video_hwmc.c: In function 'create_context':
    sna_video_hwmc.c:95: warning: assignment from incompatible pointer type
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a64490c794e2e98c77e0c7f9cec6778fd1e06465
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 12 14:28:18 2013 +0100

    sna: Add missing ';'
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9dae6f9f1f169c228929185a8bd94e82afe92574
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 12 11:01:08 2013 +0100

    sna: Flush the scanout cache after resizing the display
    
    And ensure that any new scanout allocations make the requested size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97fc1d4c5bd268f331aaa9f7144e4fe40837fbb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 12 10:23:43 2013 +0100

    sna/gen5: Force a MI_FLUSH between using the BLT and RENDER engines
    
    There is a workaround that says the first RENDER command following use of
    the BLT should be a non-pipelined command. To be safe, emit a MI_FLUSH
    before setting up the invariants.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1168066
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aff14a23f98b1230a9053a1b8434f5cc9f766d14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 12 09:49:47 2013 +0100

    sna: Refine assertion about the existence of CPU damage when GPU damaged
    
    One particular buffer type is quite cunning and simultaneously sets both
    CPU/GPU as all damaged (the upload buffer) so be aware when making bold
    assertions.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afe61281d8f92d6eb841e2522ab18e0d2fe73773
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 10 12:13:37 2013 +0100

    sna/gen7: Cache our kernels in L3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caf3118f90bad7f88f5f08e49177a1696bf97ccb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 10 12:16:34 2013 +0100

    sna: Align uploads to start on page boundaries
    
    This reduces the number of loops and restarts required in the kernel.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 092e30de8a3476ab99446264edaf9b250a41736b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 20:43:19 2013 +0100

    sna/xvmc: Wrap each output adaptor
    
    Each of the overlay, sprite and textured video can support XvMC
    passthrough, so we need to setup an XvMC adaptor for each of our Xv
    adaptors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 540802595fee7f8b2c73e74c2b44e9a21f6471ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 10 10:33:48 2013 +0100

    sna: Suppress hotplug events whilst VT switched away
    
    Whilst we are not DRM master, not only is another server in control of
    the outputs and responding to the udev event, we ourselves cannot
    change modes and just cause contention upon the DRM device. Instead
    inform userspace of the change as soon as we are DRM master again and
    back in control.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7afe2b45556f07b7e3a36e36da5a6d1c60366c25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 20:57:23 2013 +0100

    sna: Add a DBG option for testing userptr more thoroughly
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbe081061a2790e0e6e6a4065af313df0d1d6a84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 09:52:13 2013 +0100

    sna: Document fence limits for gen4+
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f1367d611b91008ba28a8c99a6b98a3e84449dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 09:18:41 2013 +0100

    sna/video: Textured video passthrough no longer relies upon XvMC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21294eaaf16a1e35fefe0f45a237826d38dc62eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 9 09:10:33 2013 +0100

    sna/video: Expand passthrough support for overlay planes
    
    The passthrough is actually a generic, albeit private, mechanism that
    anything can use to pass along a GEM handle for use with Xv.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86efddd9e4b921fcfc1a4b7492ba9174b84de64c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 8 10:54:56 2013 +0100

    sna: Remove assertions for mapped GPU bo if priv->cpu after GPU bo creation
    
    The condition that we have a mapped GPU bo iff priv->cpu is only true if
    we have a GPU bo at the time of using the CPU -- if we create the GPU bo
    during move_to_gpu, then that assertion is bogus.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 678279eb373310f1a71a3d74e5a500b343e98830
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 6 15:58:50 2013 +0100

    2.21.6 release

commit 5332d5a7e055042233e279385bfe1388adfe15fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 6 15:42:23 2013 +0100

    configure: Allow valgrind support to be manually enabled
    
    Irrespective of the DDX debug settings, some people wish to run Xorg
    under valgrind and so prefer to have the cleaner output by making the
    DDX valgrind aware.
    
    (Actually Maarten wants valgrind support enabled by default...)
    
    Suggested-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 091cf6f0477824c5826547c02394752b6dc944ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 6 09:30:57 2013 +0100

    sna: Improve assertions to detect rogue priv->cpu status
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a43aa81e27e8a651fde8a4761fd14bd8824d90c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 4 10:53:55 2013 +0100

    sna: Restore bo->flush status for large bo
    
    Since we started discarding the flush flags on cached bo (in order to
    prevent DRI flush states leaking), we failed to preserve the flush flag
    for large bo (which uses it to keep batches trim and other hints).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed3dab44a717a1a88470228b5e33f20de1e4ad0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 2 15:20:52 2013 +0100

    sna: Adjust userptr structure for implicit padding
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e2fc5aee035c3059ca33dbcafc71dc5988d6b09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 2 14:29:29 2013 +0100

    sna: Relax scanline waits on HSW to be emittable from either ring
    
    My overzealous reading of the bspec lead me to the conclusion that the
    MI_LOAD_SCANLINES command was only available on the blitter ring. This
    is false, thankfully, and allows us to do vsync'ed Xv.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a36fdcee769195d5c6e642e84a8976114e7c6de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 2 11:01:53 2013 +0100

    sna/gen4: Kill stray debugging ErrorF from previous commit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d7e16addb2fb5f35936aafe8e16685a91d30f59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 2 10:58:52 2013 +0100

    sna/gen4: Break the Video rendering loop into 16 rectangle chunks
    
    If we feed more than 16 rectangles into the video rendering pipeline,
    the GPU goes crazy and starts emitting corruption. Lalalala.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1162046
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f09aa788d79d36688bcfdd3b49b92367590c5f16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 2 10:01:21 2013 +0100

    DRI2GetMSC: Do not send a bogus ust for when the drawable is not displayed
    
    According to the opengl glx_sync_control spec, the Unadjusted System Time
    (or UST) is a 64-bit monotonically increasing counter that is available
    throughout the system:
    http://www.opengl.org/registry/specs/OML/glx_sync_control.txt
    
    Therefore, sending 0, even in this corner case, is out of spec. However,
    we cannot just return FALSE here as that triggers a BadDrawable error to
    be sent, and as is often the case mishandled, to the client. This results
    in a certain compositor terminating, for example.
    
    As an alternative we can use the monotonic system timestamp which in
    theory should also be monotonic with the previous and subsequent vblank
    times.
    
    Based on a patch by Daniel Kurtz.
    
    Reported-by: Daniel Kurtz <djkurtz@chromium.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4af622edfc18af523e1fa9063379f68374e19b04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 1 22:44:13 2013 +0100

    sna: Try to eliminate pending operations to the bo being replaced
    
    When we are replacing a bo with fresh data, we can drop pending
    operations to it and thereby reduce the complexity of the replacement.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef0038d358e613381e03c077e06a87fc49108d87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 1 22:43:48 2013 +0100

    sna: Allow the compiler to inline memcpy for the bitblt routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43181692f752f0a552d2e2c76d8379fe16e521cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 28 15:41:38 2013 +0000

    sna/gen7: Refine is_gt2() for Haswell versus Ivybridge
    
    The two similar chipsets do not use the same PCI-ID encoding schema.
    
    Fixes regression from
    commit 235a3981ea9759317b392302a2b2b8f4fafab410
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Mar 26 20:37:14 2013 +0000
    
        sna/gen7: Use GT2 values for GT2 variants
    
    Reported-by: zaverel@free.fr
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96c10bdff95a3f8a68c6623446655c4c3dbf738a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 27 22:10:37 2013 +0000

    sna/gen7: Resist the temptation to overprogram the number of PS threads for HSW
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19dfa72c28c6dc677dbfec3a538d4481985195e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 27 16:56:10 2013 +0000

    sna/gen4+: Set read-write allocation mode for the target render cache
    
    As we often first clear the destination before performing a blend, we
    get a performance boost if that first write populates the render cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9b8c2039d1be17af8c56364341fc3e10795f200
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 27 14:49:15 2013 +0000

    sna/gen7: Fix MOCS for Haswell
    
    The memory attributes changed slightly, and in particular there is now
    an explicit uncached setting - which of course happened to be the value
    currently selected.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04b28021409bc179f6705802f3ccacb1e3c48cc5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 21:53:04 2013 +0000

    sna/gen7: Restore render acceleration for VLV power-on board
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2054f43e4332e9d0ed61a0d643a1390dffff8d96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 20:38:52 2013 +0000

    sna/gen7: Prefer spans for GT2 desktop variants
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 235a3981ea9759317b392302a2b2b8f4fafab410
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 20:37:14 2013 +0000

    sna/gen7: Use GT2 values for GT2 variants
    
    The check was only testing for GT2+ and excluding the normal GT2
    devices. See also
    
    commit ce9f0448367ea6a90490a28150bfdc0a76500129
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Feb 8 16:01:54 2013 +0000
    
        sna/gen6: Use GT2 settings for both GT2 and GT2+
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dddb01005274376c8cdc5eecad36d4e0723004a
Author: Mark Kettenis <kettenis@openbsd.org>
Date:   Tue Mar 26 20:50:53 2013 +0100

    sna: Use a more portable way to determine total RAM size
    
    The sysinfo function is Linux-specific.  sysconf(_SC_PHYS_PAGES), while
    not truly portable, is available on many more systems, including Linux,
    Solaris, NetBSD, FreeBSD and OpenBSD.  So use that instead.  Verified
    that this results in the same value as the sysinfo call on a handful of
    Linux systems.
    
    Signed-off-by: Mark Kettenis <kettenis@openbsd.org>

commit e63390df52117e1d3ca9d23a736e9995bc734765
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 16:32:13 2013 +0000

    sna: Add extra '()' around bitwise &/&& for CPU feature detection
    
    By popular demand.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d6f4078c1e405749ff688058ef76c287ab36201
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 16:28:26 2013 +0000

    sna/gen4+: Reorder code to compile on squeeze
    
    Remember to only use sse4_2, avx2 in their restricted sections that
    check for compiler support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b479504c82bd81c0b93de0e6529eae928eea3bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 16:12:30 2013 +0000

    sna: Check for OS support of AVX/AVX2 before use
    
    If the OS has not initialised support for the extended instructions,
    then their use may result in general protection faults.
    
    Based on code by Thiago Macieira.
    
    Reported-by: Arjan van de Ven <arjan@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9620f419076202ebc89b4c7f1c06374fb2554f28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 15:44:42 2013 +0000

    sna: Fix AVX2 detection
    
    It requires use of the cpuid feature eax=7:ecx=0, so it requires the
    extended version of __cpuid  to pass in the subfeature.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da2bd82b0e10f8a263f7ab4fb49b440349d97ace
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 15:13:32 2013 +0000

    sna/gen4+: Add a couple more advanced SSE variants for composite vertices
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86bcf4a9f5dff98eab076df5872c3c412c0c13af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 15:13:08 2013 +0000

    sna: AVX2 is in the ebx result of cpuid
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5be4210b7e8b4a895a70ba617fda45d2e0188f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 26 09:05:48 2013 +0000

    sna: Trim removed fields from execbuffer2 for OpenBSD support
    
    Reported-by: Mark Kettenis <kettenis@openbsd.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 761ab4124e00b3dbab15abe69a9b29d9c3d0da0d
Author: Mark Kettenis <kettenis@openbsd.org>
Date:   Mon Mar 25 22:40:35 2013 +0100

    sna: Fix OpenBSD backlight control implementation
    
    Fix cut'n'paste error such that this actually compiles.
    
    Signed-off-by: Mark Kettenis <kettenis@openbsd.org>

commit 0a9b136ec43c860e6e6e651efea0330ac36a4ea5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 25 15:34:41 2013 +0000

    Remove the GeneralSocket upon CloseScreen
    
    Be neat and tidy in case we are shutdown but the server is not
    regenerated (e.g. a hot-unplug).
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b20924f22a14f69651dcf471c48f8a44d8ad42f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 23 23:08:02 2013 +0000

    sna: Convert out-of-bounds sample to CLEAR
    
    If asked to perform pixelformat conversion of a sample that resides
    outside the valid area, we can simply substitute CLEAR.
    
    Bugzila: http://bugs.freedesktop.org/show_bug.cgi?id=62681
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6582387e7d601272a92c3aaeb656de5ce1ffe75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 23 10:22:41 2013 +0000

    sna: Fix an assertion to check the correct bo
    
    After syncing the GPU bo for use, that's what we should test as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88b6b80c2a5191717f0baeb22cdb70ee8c993e09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 22 13:36:16 2013 +0000

    sna: Fix assertions that the pixmap points into the CPU bo for fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccd6b7e402e731c73163b132a80ae29ae2911613
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 22 11:28:01 2013 +0000

    sna: Add backlight control implementation
    
    Based on the previous patch by Mark Kettenis <kettenis@openbsd.org>

commit 364e02c7998813643bc81f25ba077a764872d49e
Author: Mark Kettenis <kettenis@openbsd.org>
Date:   Fri Mar 22 11:23:11 2013 +0100

    uxa: Add OpenBSD backlight control implementation
    
    Signed-off-by: Mark Kettenis <kettenis@openbsd.org>

commit 8d75b2ece1de1c95047c5dc5a569348abd0e6325
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 22 09:51:46 2013 +0000

    sna: Fix computation of clip extents for stippling
    
    The clip extents for the stippled BLT missed applying the drawable
    offset to the lower-right corner, so inevitably every operation ended up
    being clipped.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=62618
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f8e86800345d19785eae2dd2099dd7d61a7a3b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 21 22:48:06 2013 +0000

    sna/dri: Disable assertion and associated bookkeeping
    
    Due to long standing ignored bugs in DRI2, we have to accept breakage
    in the driver.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=62614
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4adebfed415cf58599b22e873f32e7ce2eaa6542
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 21 08:53:12 2013 +0000

    2.21.5 release

commit 1aca872ee51e10908dcc4979596ae69732e9a02a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 19 08:26:01 2013 +0000

    sna: Haswell reintroduces MI_LOAD_SCAN_LINES
    
    Better late than never? Interestingly only available from the BLT ring,
    which makes accurate waiting for XVideo (which must use the render ring)
    impossible in the current form - we need to render to a temporary then
    do a vsynced blit in this case.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1156679
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f132452da14fd09a2a3926cc9c034cb2e8c2f1a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 19 07:57:30 2013 +0000

    sna: Ignore vsync waits on tiny scanline ranges
    
    If the update is only a couple of lines tall, any tear will not be
    visible - so just ignore programming the wait into the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 308f0208de59620190dd3cb65b3243d2e8a7bd87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 18 15:04:22 2013 +0000

    sna: Reset operation state between glyphs
    
    We are not resetting sufficient state between operations as we presume
    that all callers of Composite() currently pass in a blank state. In the
    long run, we want to remove that burden and do a minimal initialisation.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1156387
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a37d57f9633bbd29f308239c1cd956767b277c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 18 15:00:01 2013 +0000

    sna: Add a pair of sanity checks before creating the redirection target
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28371a34fa83f70a7af3c8d3bfd6c7cef9e35073
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 18 14:49:58 2013 +0000

    sna: Skip processing an all-clipped-out glyph
    
    Along the slow path, skip all processing of glyphs that are not visible.
    This is important as the slow path handles the per-glyph redirection
    case, which is much more expensive.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16dac417c8049d65b3641e0f662865772faad61f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 17 21:56:56 2013 +0000

    sna/dri: Fix stale Pixmap detection
    
    NB the back buffer is not associated with the Drawable and so has no
    pixmap field set. Hence comparing the front->pixmap against the
    back->pixmap was always rejecting the blit. All we can check is that
    front->pixmap corresponds with the current Drawable and so reject stale
    configuration.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85213d5d450eec5696496128c1acecb5ca13c53b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 17 21:42:48 2013 +0000

    sna: Don't remove the flush flag for userptr bo
    
    This flag is far too overload with meaning, but for now this prevents us
    attempting to call free() on a SHM segment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5b901a635a9c8c74017682d17cfcd93031907b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 16 10:54:51 2013 +0000

    sna/dri: Clear flush flag upon bo destroy
    
    Fixes sanity checks that we do not leak the flushing status, nor
    invoke an operation upon an unflushed bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45d20e9a65bec8d962a4ec20ee35079935f71b91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 22:09:38 2013 +0000

    sna: Add an LLC path for creating snoopable buffers
    
    As with LLC we do not actually need to track snoopable as a separate
    cache state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94cb10c3f2b9bbb6ae3c76faebe9fc88691224a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 22:02:09 2013 +0000

    sna/gen5+: Add missing float casts in computation of scaled src offsets
    
    Without the casts, the division ends up as 0 rather than the fractional
    offset into the texture.
    
    The casts were missed in the claimed fix:
    
    commit 89038ddb96aabc4bc1f04402b2aca0ce546e8bf3
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Feb 28 14:35:54 2013 +0000
    
        sna/video: Correct scaling of source offsets
    
    Reported-by: Roman Elshin <roman.elshin@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=62343
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dad50881d545da665191c6681f2acd0ebc3ddbfc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 14:53:13 2013 +0000

    sna: Consider placement hints when choosing userptr read path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11e2802528aed4ef9ffc8b75045c72ac641e54b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 14:42:25 2013 +0000

    sna: Add handle info to sync DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20832494be06da9ebc4801647521f95e092188fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 14:03:00 2013 +0000

    sna: Use userptr downloads for incomplete GPU damaged pixmaps
    
    If the pixmap is not wholly damaged, but still contains the region to be
    read, then use userptr (if available).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92023f39a9c8897e5a978f44b7970773b118f628
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 14 09:42:37 2013 +0000

    sna: Add a few more assertions to track userptr through the caches
    
    i.e. make sure they don't end up in any caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80401f4fe54142c16ea7578b587529610b68cb67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 13 11:01:45 2013 +0000

    sna/trapezoids: Minimally replace points for TriFan
    
    The realisation dawns that it wasn't the ordering of points within the
    triangle, but simply that I was replacing the wrong one.

commit 716723d655a6ee11b090642b759e2542ad712c17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 13 10:51:03 2013 +0000

    sna/trapezoids: Correct ordering of points within TriFran
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49374f2155f0c8c80b1c54e968d510d55df49221
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 20:12:51 2013 +0000

    sna/gen4: Tweak compilation flags to avoid mixed settings across functions
    
    Confusing gcc with different flags for supposedly inlined functions is
    not a good idea.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=62198
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee0ed88a09bc2f8ebe49b1d7f7e209a73e02fee0
Author: Aaron Plattner <aplattner@nvidia.com>
Date:   Tue Mar 12 12:45:58 2013 -0700

    uxa: don't crash when freeing an uninitialized screen
    
    When intel_scrn_create creates a screen, it sets scrn->driverPrivate to
    (void *)(match_data | 1).  Normally, this is read by I830PreInit and then
    replaced with a pointer to the intel_screen_private structure.  However, it's
    possible for the server to delete the screen before initializing it, which leads
    to a crash in I830FreeScreen when it tries to interpret the unaligned match_data
    pointer as a pointer to a intel_screen_private.
    
    Fix this by checking the low bit of the pointer and skipping the teardown code
    if it's set.
    
    Signed-off-by: Aaron Plattner <aplattner@nvidia.com>

commit b1952e79021759927361d284b157713a651a10b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 19:58:28 2013 +0000

    sna/gen3: Tweak code generation for gen3_emit_composite_primitive_constant__sse2
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=62198
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f320e6908f24ff356303c8905c78ac290e24c2e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 19:53:20 2013 +0000

    sna/gen3: Tweak code generation for gen3_emit_composite_primitive_identity_gradient__sse2
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=62198
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1d0ca266cc67df65c81a9dbb9cc83027ff240ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 19:03:44 2013 +0000

    sna/gen3: Reduce another use of transforms
    
    Prefer the slightly cheaper _sna_get_transformed_scaled().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50374fb4947e6682b6c8aced639b422110b6ec98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 18:39:07 2013 +0000

    uxa/glamor: Prevent a crash when trying to load a misconfigured glamor
    
    Glamor requires that glamoregl is explicitly loaded via Section "Module"
    or else it currently crashes.
    
    Based on a patch by Michel Dänzer for xf86-video-ati.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c79a189b6f06a58ddbd92427b6c57a0bdfb1e16c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 15:57:17 2013 +0000

    sna: Missing git-add for 09862a85eba243b
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a31831bce86745205369faaa297064770f4350f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 15:26:28 2013 +0000

    sna: Improve asserts that the CPU bo is not busy after synchronisation
    
    Taking into account that we may not do a full synchronisation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09862a85eba243babde9ca721ca6521566f5c082
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 15:12:59 2013 +0000

    sna: Mark redirect proxies with a unique id
    
    This helps gen3 in particular as it uses the unique_id field of a bo to
    detect changes in render target.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f8fba31d7317248e0d4710ef5553dc1f9593314
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 12 10:12:12 2013 +0000

    sna: Apply the source offset to the transform when fixing up gradients
    
    Otherwise pixman will apply the source transform to the offsets.
    
    Reported-by: Ognian Tenchev <drJeckyll@Jeckyll.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=62198
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b143fcb2bdeec9abd1c1d2a9dbe707cb9165b65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 18:11:27 2013 +0000

    sna: Improve sna_copy_boxes DBG by printing the bo handles
    
    The handles of the bo are easier to track through the DBG as they are
    more often printed than then their addresses.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44d3ffdf534eb1c24ab729b9af31f09a86b82256
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 17:14:39 2013 +0000

    sna: Only allocate addition space if we need pixel data
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b500e30d5dbcf91542c2831ebd3c48b28a01bf28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 17:14:07 2013 +0000

    sna: Mark the userptr as a CPU mapping
    
    This helps clarify some recent asserts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17a99f0743836997aa8e4f7eafc0ea4978244f44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 16:41:16 2013 +0000

    sna/dri: Free the event on the impossible error path
    
    Just in case we end up with bogus data, don't leak.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d097d5140857fad209ee5c2c8b5461aac54e81e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 16:39:11 2013 +0000

    sna/dri: Free chained swaps upon CloseWindow
    
    The assumption that the chained swaps are freed after the next vblank
    turns out to be wrong, and in effect we would leak the bo if we
    happened to submit the final swap faster than vrefresh and close the
    window before the vblank.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f6a9927952e25aa2a1628e66295f0903dcf865c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 14:40:52 2013 +0000

    sna/dri: Reorder assert to avoid NULL dereference
    
    Only try to dereference chain->draw after the check to see if it was
    already destroyed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cffdd1eed0ca344142c165788ce7a31b80f1f55f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 14:16:27 2013 +0000

    test: Try to exercise races between DRI2SwapBuffers and CloseWindow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fb7be0a0d4bf027ed254399b6b538e979f525f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 10 14:34:39 2013 +0000

    2.21.4 release

commit 25a63b32c7b549ffb3c7f14de4bf2731d044eb39
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 11 10:42:08 2013 +0000

    sna: Tighten checking for coherent maps
    
    Remember all the special cases where we can use a CPU mmap as a
    temporary substitute for a GTT mapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 210d474a96d3adf7338b49ee2c234893b54bbb2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 10 16:40:35 2013 +0000

    sna: Tweak CPU mappings to be only used if a read is required
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35f50a98fde7a4ebe6871bd23475948a2a530633
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 10 15:51:45 2013 +0000

    sna/dri: Flatten _sna_dri_destroy_buffer()
    
    One level of indentation can be trivially removed with an earlier return.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b81ee116d36845e55f71be2db391f93c1b681d5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 10 14:15:46 2013 +0000

    sna/dri: Add a couple more basic assertions
    
    To catch bad reference counting and loss of flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93ecd5606eaf2e1db2b844f39bb04d77fa53cf8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 8 23:38:12 2013 +0000

    sna: Only shrink the maximum GPU size to fit into cache
    
    That is be very careful that we do not enlarge it past the aperture size
    on early gen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78c756120db2e5e174925a92c0a0bba3ff70860c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 8 16:39:21 2013 +0000

    sna/gen4: Initialise a pair of unimportant variables
    
    Should never actually affect any results.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcd52d0c186e8b17569335338232298fbbea2b2d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 23:03:52 2013 +0000

    sna: Fallback if we cannot fit the tiling copy into the aperture
    
    If we cannot fit the source/destination and a tile into the aperture,
    then we cannot perform the copy and must do it using the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50d0ea02b3908156534fc00def55cfca30bbfecc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 22:58:21 2013 +0000

    sna: Trim tile sizes to fit aperture constraints
    
    This is especially important with gen2 where we have no unmappable GTT
    to utilise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd1c14b172b0794f744b304f59b4fc78f0d6f8d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 10:16:19 2013 +0000

    sna: Remove the unused output and crtc lists
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b8fc8715598e7bf756ccfa99a6da59bab48c2a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 10:12:14 2013 +0000

    sna: Disambiguate sna_crtc_resize()
    
    sna_crtc_resize() operates upon the whole configuration rather than a
    single crtc like the other sna_crtc_* so rename it to make it distinct.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f1c2b3b8bb062a4574e5114b09a33b7e4f0c811
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 09:40:06 2013 +0000

    sna: Supply a fake pipe to run completely headless
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2aacfbaa5143568906e88e489c72f4ebf065a4ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 09:10:32 2013 +0000

    sna: Return early if there are no outputs to setup
    
    Instead of reporting failure, just try to run headless.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b84db39edb6ebce965c1354dc5994bf0a70cea92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 7 09:07:19 2013 +0000

    intel: Relax the has-kms test slightly
    
    Do not rely on a fully populated set of CRTCs, but merely note that the
    GETRESOURCES ioctl returns an error if KMS is not enabled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6a59bee3bf5f42147f75a714f2b9aa26590329e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 6 19:01:50 2013 +0000

    sna: Disable read-read optimisations
    
    There is still a lurking issue, so punt on the optimisation for now.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=61628
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a7577902ee3a1286ea2a74a79aaeff6c72a6f18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 6 11:22:40 2013 +0000

    sna: Lighten the wakeup handler slightly
    
    As the wakeup handler is called more frequently, we want to avoid any of
    the more heavyweight processing. So trim the wakeup handler down to the
    check to see if the GPU is idle and so we should immediately flush what
    we have currently queued.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 779fc0b20c382e572eb41d3cbf3d639e4eb77874
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 22:29:54 2013 +0000

    sna: Typo ('unsuported') in DBG messages
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e67aece46301ebb77d5fce7ac687a03713956fef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 21:43:20 2013 +0000

    sna: Assert that the pixmap is not pinned before releasing the GPU bo
    
    Nothing suspicious in this set, just an extra dab of paranoia.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc5f81901f1b4451e4187b97f65a8be4c03b2494
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 15:53:24 2013 +0000

    sna: The GPU bo submit is still required before mapping for inplace operations
    
    As we may choose to force the stall as we would be doing a read-back in
    any event...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43e3886c6de3ab89e3629c98287ede77ae2f6876
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 15:32:35 2013 +0000

    sna: Use drawable_gc_flags() to select placement for PolyArc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99b30203ba1c26d89d869691a743488a5dc32935
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 13:45:45 2013 +0000

    sna: Fix deference of just nullified GPU bo in previous commit
    
    One last minute refactor too far, combining the too if(priv->gpu_bo)
    blocks forgot that the first block tried to free gpu_bo...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d31dc1343d59f8ef8876e1dc8ddfec9c6be1a602
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 13:30:37 2013 +0000

    sna: Refactor the is-mappable test for inplace operations
    
    By moving the test into the common function for creating a mappable GPU
    bo, we can also consider recreating that bo when desirable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fa9234c7061be3cff9a65aac0702f4c3caac40d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 11:34:49 2013 +0000

    sna: Prefer GPU for self-copies when undamaged on the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60ec35b8d25ecfabf1744ea7bc81109d7f2a90e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 11:14:37 2013 +0000

    sna: Be explicit when checking for an idle bo after CPU synchronisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad4901a0354efaed65bb15ef33561df067d300b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 5 09:23:07 2013 +0000

    sna: Ensure that the tearfree swap is unmapped afterwards
    
    After swapping the bo for the screen pixmap, we need to make sure that
    we don't chase any dangling pointers.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1133490
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 007a95d62fc998b3a558bb80310c82256d00b0bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 4 13:52:04 2013 +0000

    sna: Drop a local variable only used to hold a constant
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4be725333c11804a45c80a4bc45852e81ea57ed5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 4 11:55:16 2013 +0000

    sna: Ensure we do not attempt to operate inplace on a very large pixmap
    
    Otherwise we will fail to map it into the GTT. In theory, this should
    just result in the same fallback paths, but pushing that knowledge up
    further should help us make better decisions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad05039cc83b40cf45c8221d69506d6c88c27a86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 4 10:11:22 2013 +0000

    sna/gen3: Always prefer BLT for copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59f030dd27eff5fbf9ddcd22faa3087bc9c5ff54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 4 10:10:39 2013 +0000

    sna/gen3: Perform alpha-fixup upon copy sources
    
    This is required for copying from depth-15 surfaces onto other depths.
    
    Reported-by: Reinis Danne
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48a733a35a2de36664a42384d066c06f54cf2ad7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 15:32:23 2013 +0000

    sna: Only destroy the cached CLEAR picture if it exists
    
    Reported-by: Reinis Danne
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2583232773f1fa505e0676f07b029b29b90c8ea7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 15:25:01 2013 +0000

    sna: Nullify cache pointers upon server regen
    
    To make sure we don't chase dangling pointers on the next pass.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4dec895b69c2e545b142a3646646e13f7fb06507
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 14:44:13 2013 +0000

    sna/gen3: Correct typo in assertion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 862601c05e9788d1416173b730a5d4b6acabf374
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 14:00:18 2013 +0000

    sna/gen3: Add some debug around rendercopies of the fbcon
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 995abb46754eba7524afcb852159a31ea19add82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 12:12:56 2013 +0000

    sna: CPUID return ISA features in ecx/edx
    
    Whereas we were wrongly looking in eax.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=61733
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9f2b5152f988d4b15f773354f3fadaff02cd3d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 11:10:51 2013 +0000

    sna: Undo preferred depth for gen3
    
    Mesa is buggy. Qt is buggy. Everything is buggy.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=61441
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef5edbf61686388126e62ce360a66dd8652b2493
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 3 09:29:53 2013 +0000

    sna: Probe for kernel support of framebuffer formats
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1135403
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd313a8d5d1363929bebac83f81e347b4a9e70f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 2 22:52:15 2013 +0000

    sna/dri: Guard against failed batch submission
    
    Avoid dereferencing a NULL bo if we do not submit a batch for the copy
    operation.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=61708
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4df4e03b147694c65196651f5c13e7199f74579
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 2 22:46:57 2013 +0000

    sna: Eliminate a few used-once local variables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae3531c3a1d72a73b25c5563b4db029f051262cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 23:46:07 2013 +0000

    Fix Haswell CRW PCI-IDs
    
    As we missed the PCI-ID for the CRW GT1 variant, we would not have enabled
    render support for those particular Haswell machines.
    
    Reported-by: Kenneth Graunke <kenneth@whitecape.org>

commit fef6cdae9ebd217843bab2f65c87b59f8a9f782e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 15:58:42 2013 +0000

    sna: Chain up CloseScreen
    
    Remember to call into the chained CloseScreen destructors!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56608
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c2dedaa4df2522d6a1725c09e9700c5d753ac93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 15:49:57 2013 +0000

    sna: Assert that inplace operations are done on coherent maps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8296412b88b1ab4ea48572707408f7eeb52c8fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 15:42:38 2013 +0000

    sna: Assert that when caching a pixmap header the pScreen match
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 904af323914e05830f17621a78b6e55b371ae5fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 15:34:45 2013 +0000

    sna: Assert that we do not resurrect stale pixmap across a server regen
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56608
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4164de5ccb82068e2858a90b2cd44eef82b6037
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 12:13:47 2013 +0000

    sna: Assert that the ScrnInfo and ScreenPtr relationship is correct
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56608
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d97c192a33473df3c9036147a4716783a86d742
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 11:59:49 2013 +0000

    sna: Move some conditional code out-of-line
    
    Just to reduce the number of ifdefs, one at a time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4174c7bb14ea3428d86dc327950e76d0589e0cc4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 09:21:03 2013 +0000

    sna: Use depth-15 rather than depth-16 for reduced bw devices
    
    Keeping the number of bits identical between the RGB channels helps
    prevent discoloration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e05d2e481434084291503efdb84c944a560d8c29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 1 09:08:19 2013 +0000

    sna: Track number of pixmaps allocated whilst counting bo leaks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89038ddb96aabc4bc1f04402b2aca0ce546e8bf3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 28 14:35:54 2013 +0000

    sna/video: Correct scaling of source offsets
    
    When applying pan and zoom to a mismatched video, it would inevitably
    miscompute the origin and scale factors.
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=61610
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0a2faefdefbea63669dfeb49f7e701196ab5631
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 22:26:19 2013 +0000

    sna: Fix syntax for __get_cpuid()
    
    It is a function not a macro like cpuid() and takes pointers to its
    arguments!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfc1fda87f442890919100473b819240f9c30c44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 22:19:06 2013 +0000

    sna/dri: Fix use of uninitialised pipe along error path
    
    > sna_dri.c:2018:6: warning: variable 'pipe' is used uninitialized
    > whenever 'if' condition is true [-Wsometimes-uninitialized]
    >         if (get_private(front)->pixmap != get_drawable_pixmap(draw))
    >             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    > sna_dri.c:2150:42: note: uninitialized use occurs here
    >         DRI2SwapComplete(client, draw, 0, 0, 0, pipe, func, data);
    
    Reported-by: Sedat Dilek <sedat.dilek@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f08ad3f8ef1ac3a38a92f793fa1cbc1d2d443095
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 17:46:55 2013 +0000

    sna: Prettify GCC version detection in headers
    
    And fixup a basic error in the process.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8aea4ae127f92c07e3ce86b6d2afaa207a6cdce9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 17:38:46 2013 +0000

    sna: Improve compatibility of cpuid.h detection
    
    Reported-by: Sedat Dilek <sedat.dilek@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c27307219b5a5c1f73dcde9d0b2beed5810bd7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 14:58:35 2013 +0000

    sna: Remove the trailing '.' from the previous commit
    
    Good Maarten for reporting the bug, bad Maarten for silently fixing up my
    mistakes when testing! Thanks to Colin Walter and his tinderbox.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8a0acd615042bee7bdf49c364a4815ade6b9a61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 27 13:26:18 2013 +0000

    sna: Migrate dirty tracking across ScreenPixmap updates
    
    Otherwise chaos ensues:
    
    Invalid read of size 8
    ==8647==    at 0x8477BC1: has_offload_slaves.isra.38 (sna_accel.c:14402)
    ==8647==    by 0x84958E7: sna_accel_block_handler (sna_accel.c:13729)
    ==8647==    by 0x164B13: BlockHandler (dixutils.c:387)
    ==8647==    by 0x2B5273: WaitForSomething (WaitFor.c:210)
    ==8647==    by 0x160790: Dispatch (dispatch.c:357)
    ==8647==    by 0x14F549: main (main.c:298)
    ==8647==  Address 0xf3383e8 is 24 bytes inside a block of size 152 free'd
    ==8647==    at 0x4C2BA6C: free (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==8647==    by 0x2403DF: damageDestroyPixmap (damage.c:1549)
    ==8647==    by 0x1FFD88: XvDestroyPixmap (xvmain.c:372)
    ==8647==    by 0x1FE789: ShmDestroyPixmap (shm.c:273)
    ==8647==    by 0x8507C24: _sna_dri_destroy_buffer (sna_dri.c:448)
    ==8647==    by 0x289986: do_get_buffers (dri2.c:521)
    ==8647==    by 0x289C0F: DRI2GetBuffersWithFormat (dri2.c:690)
    ==8647==    by 0x28B68F: ProcDRI2Dispatch (dri2ext.c:306)
    ==8647==    by 0x160A40: Dispatch (dispatch.c:428)
    ==8647==    by 0x14F549: main (main.c:298)
    ==8647==
    ==8647== Invalid read of size 8
    ==8647==    at 0x8477BCA: has_offload_slaves.isra.38 (regionstr.h:74)
    ==8647==    by 0x84958E7: sna_accel_block_handler (sna_accel.c:13729)
    ==8647==    by 0x164B13: BlockHandler (dixutils.c:387)
    ==8647==    by 0x2B5273: WaitForSomething (WaitFor.c:210)
    ==8647==    by 0x160790: Dispatch (dispatch.c:357)
    ==8647==    by 0x14F549: main (main.c:298)
    ==8647==  Address 0xdfdfdfdfdfdfdfe7 is not stack'd, malloc'd or (recently) free'd
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11b72628cb54ab0b78a0969fa8fabb591f6cf93f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 19:08:58 2013 +0000

    sna/gen2: Add SSE2 fast paths for vertex emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2597c89d023beceddd65e99fa595741f2400218
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 18:44:45 2013 +0000

    sna: Force GCC to use the SSE unit for SSE2 routines
    
    Merely hinting that it was preferred by using sse+387 was not enough
    for GCC to emit the faster SSE2 code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a18ce0f642fa347b61e4ca501bd2f747338a2975
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 18:44:35 2013 +0000

    sna: Flatten the glyph emitters
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bb06b02e67435354778fe87a3e0429fe3750c23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 18:12:06 2013 +0000

    sna/gen3: Expand the number of SSE2 routines for basic composite ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 417c3f9b8c6b9a50dc1af440c53e94d2c6401251
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 17:41:57 2013 +0000

    sna/trapezoids: Add a pair of unlikely hints for forced box emission
    
    Overflowing the buffer is unlikely, so pass the hint on to the compiler.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa7e11a1a451c54d5cbff9a6c242075b08c590ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 15:07:12 2013 +0000

    sna: Improve handling of migrated userptr bo
    
    Superficially fixes gimp-2.9
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32d8908337d45b9598ce07bc46b633ed5e0c7070
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:42:03 2013 +0000

    sna: Flatten unaligned box emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa358fad8c934e6962976ecfdc5e5ebc9d1ad83c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:37:24 2013 +0000

    sna: Bump required GCC for sse2
    
    gcc-4.4.5 (on squeeze) triggers an ICE when using target(sse2).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08747292b717fcea84ce3adc455b0161e5517e84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:28:05 2013 +0000

    sna: Conditionally compile sse2 routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c63ddd9f14588bcec8275e2a64e56cc5b661a5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:28:05 2013 +0000

    sna: Conditionally compile sse4_2 routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc885d350ec53d08e0d4d529bb938bf2568d61ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:28:05 2013 +0000

    sna: Conditionally compile avx routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cdebf3b72467f63a35888f38cd83658575fcf10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 11:06:45 2013 +0000

    sna/gen4: Cluster ISA
    
    Otherwise we seem to confuse the poor little compiler. This should also
    make it easier to use CPP to turn off blocks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8272d849c0895d6fa66ccca972899f56dab71cc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 10:53:20 2013 +0000

    sna/gen4+: All associated CPUs have sse2 at least
    
    So mark up the basic functions as SSE2 in case we are compiling for
    32-bit only.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76d46201d7b7abc7c0b6bced9c6fadaf47ad9134
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 10:49:42 2013 +0000

    sna: Only use the GPU bo after migrating
    
    If we choose not to migrate the damage to the GPU bo, then it will be
    incoherent. This just flattens the logic out as priv->gpu_bo should be
    NULL here anyway.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1068bf7024d8a6650de020e95efdedcbfd7d3c5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 10:14:03 2013 +0000

    sna: Mention if compiled as 64bit as part of the CPU feature detection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27c71027b1d76979460ef15bba8e8671e3286a24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 10:00:29 2013 +0000

    sna: Ignore SSE4a - not an Intel ISA!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a6f3989ba2075c322cdf6e33f829f4d5a885be0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 09:59:34 2013 +0000

    sna/gen3: Allow conditional use of SSE2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13461a18b1605feb17304d52136d100df50ca296
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 09:41:14 2013 +0000

    sna: Print detected CPU features
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 528dbf9ebb2688f476ef283be59d0f2232159dcb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 08:15:47 2013 +0000

    sna: Fix build on older GCC for cpuid()
    
    We need to double check that the features we look for are supported by
    the compiler before doing so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49d9c5e9d48d043a8366b6471128c999b5e887b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 00:27:12 2013 +0000

    sna: Reverse inverted assertions
    
    Oops, the assertions that we had sufficient free space was inverted.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94b95cc2fc63457903a7b7b6eaa09bc27f25750c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 26 00:02:16 2013 +0000

    sna/gen4+: Begin specialising vertex programs for ISA
    
    Allow use of advanced ISA when available by detecting support at
    runtime. This initial work just uses GCC to emit varying ISA, future
    work could use hand written code for these hot spots.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f095678125b25aeae80d838729a7f89d09007e10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 25 23:14:12 2013 +0000

    test: Correct ignore path for async.avi
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa045d80ec0d3366745d1671b9f667cec587d804
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 25 23:13:23 2013 +0000

    sna: Detect available instruction sets at runtime
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56fd91fc830d7a210e3a0e70ab41261a1f5baa83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 25 15:18:46 2013 +0000

    sna/gen3+: Restart vertex space checks after lock contention
    
    If we end up contending for the vertex lock, we need to double check
    there is sufficient vertex space left for us.
    
    Bugzill: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1124576
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b12f0da0bedb7faf0c96e44ca2d02baec807ad51
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 25 15:18:46 2013 +0000

    sna/gen3+: Assert that nbox is not 0
    
    Various assertions to track down a potential programming error.
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1124576
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f9646f5beecca2972ef0299b5c7469008cb6fe4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 25 14:36:32 2013 +0000

    sna/trapezoids: Instruct the compiler to flatten the callees whilst rasterising
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 421910ca572a044170af69a90bb934f114a62168
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 24 21:58:30 2013 +0000

    sna/gen3: Factor out the per-vertex divide for gradients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a19da0ea517127052ae49cdd6441e8b6077ca523
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 24 11:22:01 2013 +0000

    sna: Reduce DefaultDepth to 16 on older chipsets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7bba8512c6db5f58448b513d1f4290938b0abd3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 23 10:56:08 2013 +0000

    sna: Tidy a call to set the gamma before setting up a CRTC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2aaf4ed3333231cf8cadcf6362743593026cd19
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Feb 22 14:44:09 2013 -0800

    Refuse to load driver for depth-8 X server.
    
    The driver is not functional at this depth, so tell the user as much and
    bail out.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31375
    
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit cbd8f16ea0e3b1b7eae57edfe343a332ae42373c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 21:09:52 2013 +0000

    sna: Refuse to create larger than max temporary upload bo
    
    The maximum size is determined by available RAM, if we exceed it we
    greatly increase the risk of swap thrashing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a264792772512528a4d6138e09b4ee1ace7f322
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 20:13:58 2013 +0000

    sna: Retire before looking for a large 2D buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 630b114f1ceaf9fb1e35f3aac8c3161119ba5af9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 20:08:36 2013 +0000

    sna: Allow search_linear_cache() to reuse large buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d87a0b4c3bc7f1a33edee79e3ed09871461422ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 20:07:56 2013 +0000

    sna: Allow picture fixup in channel format if not changing RGB depth
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b129b434f98b9d875e44af206f6901de9bf28334
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 12:10:20 2013 +0000

    sna: Optimise mmap of GPU bo for read-read operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19bd005056a2083de64753681b96716996e4237d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 12:05:04 2013 +0000

    sna: Avoid migrating and making the GPU bo busy prior to mmapping it
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1131134
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afb77ffadedf6c6f9321dde1d650004714accdc4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 10:48:06 2013 +0000

    sna/gen7: Skip CLEAR_PARAMS for the null depthbuffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a7262e5308c9ab416ed87226ed27a9fc84f0ef9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 22 10:30:49 2013 +0000

    sna/gen7: Only a pipeline stall is required for the CA pass
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0c83b77d0226cbaf6115eed5d0e2cc8a40ac51d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 21 19:37:51 2013 +0000

    sna/dri: Eradicate the DRI2 name exchange mechanism
    
    Thinking about the compositor <-> server <-> client inter-exchange
    demonstrates that we cannot prevent the client rendering into the
    source texture being show by the compositor. That is a subject for DRI3.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6172ff3e350dbfbcd122a911d7fa366ff5d268bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 21 15:34:47 2013 +0000

    sna: Always enable the solid-cache and gradient-cache
    
    Figuring out when it might not be used is simply too error prone.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7a96df9b0872867c823dc945add5be04d51c30a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 20 18:46:01 2013 +0000

    sna: Honour LinearFramebuffer
    
    The Option was untested, and unsurprisingly was broken.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2442c74b8d41018f260f1da13f3fe5d2795792f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 20 10:53:57 2013 +0000

    2.21.3 release

commit 2cab7e80eb6955a7f8ea051633f6975a12248b69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 20 12:36:22 2013 +0000

    sna/trapezoids: Clamp cells to valid range
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 14de90b251dd8a6ff106e989580ef01cf5c2944d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 20 12:00:54 2013 +0000

    sna/trapezoids: Embed a few cells into the stack
    
    Avoid an allocation in the common case where the set of trapezoids is
    fairly narrow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3eca4ea1a5d8ce04598b8d42e93e0dcb93e42e9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 20 11:20:54 2013 +0000

    sna/trapezoids: Perform the cell allocation upfront
    
    As we know the maximum extents of the trapezoids, we know the maximum
    number of cells we will need and so can preallocate them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9df5e48c582e5c4edffdece75b5395c230a50b09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 19 10:08:29 2013 +0000

    sna/video: Only setup XvMC if we first setup Xv
    
    Under certain circumstances, XvScreenInit can indeed fail, so do not
    bother with creatin XvMC (as it triggers internal assertions if it
    cannot find our adaptor amongst Xv's).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6588c48077600a3e015b6d37b101393a806ae1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 19 08:59:12 2013 +0000

    test: Add generated vsync.avi to gitignore

commit 1e2fd66ade6bdbf1e6011f3d59e423fada3f12f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 19 08:57:47 2013 +0000

    sna: Assert that the GPU damage is NULL before destroy a proxy
    
    If the GPU bo is a proxy, then it really is a pointer into a upload
    buffer for CPU data. In these cases, there should never be any GPU
    damage lying around.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d90a123db7ac99cf017167bf89df31c635df7e1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 18 20:06:45 2013 +0000

    sna: Assert that the gpu_bo exists if it is entirely damaged
    
    This should help catch the error slightly earlier.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a03aba6f7f55577e29c6a3267528e2614016222d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 18 16:12:14 2013 +0000

    sna: A couple more assertions that we forcibly attach pixmaps correctly
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f16d854264ea923303b79379266bd789fd9dd4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 18 14:30:55 2013 +0000

    sna/dri: Prevent swapping a decoupled DRI2Buffer
    
    If the DRI2Buffer is no longer valid for the Drawable, for example the
    window had just been reparent, just complete the swap without triggering
    any assertions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3ba758a0186c9abc6c0583f52775ea714165134
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Thu Feb 14 14:20:19 2013 +0000

    uxa/gen7: Don't use a message register to store vl
    
    Turns out the "new" assembler that uses mesa's opcode emission hits the
    path that automatically transforms MRF registers into GRF ones in the
    exa_wm_src_projective shader.
    
    The diff with the new assembler is:
    
    $ intel-gen4disasm -g7 -
    -   { 0x00600041, 0x208077be, 0x008d03c0, 0x008d0180 },
    +   { 0x00600041, 0x2e8077bd, 0x008d03c0, 0x008d0180 },
    mul(8)      m4<1>F          g30<8,8,1>F     g12<8,8,1>F     { align1 };
    mul(8)      g116<1>F        g30<8,8,1>F     g12<8,8,1>F     { align1 };
    
    Of course, message registers are no more in gen7, so the shader is
    trying to do something shaddy (ahem!).
    
    Instead of using m4, let's make exa_wm_src_projective use g68 for v (aka
    vl) which makes sense since:
    
    1/ vh is g69
    2/ exa_wm_src_affine uses g68 for vl already
    
    This commit changes the generated assembly, here's the decoded diff:
    
    $ intel-gen4disasm -g7 -
    -   { 0x00600041, 0x208077be, 0x008d03c0, 0x008d0180 },
    +   { 0x00600041, 0x288077bd, 0x008d03c0, 0x008d0180 },
    mul(8)      m4<1>F          g30<8,8,1>F     g12<8,8,1>F     { align1 };
    mul(8)      g68<1>F         g30<8,8,1>F     g12<8,8,1>F     { align1 };
    
    Cc: Kenneth Graunke <kenneth@whitecape.org>
    Reported-by: Xiang, Haihao <haihao.xiang@intel.com>
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>

commit 43ba22ef4a4142f334e9ae2d926250988ecbe8bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 17 09:25:38 2013 +0000

    Confirm that i915.ko has KMS enabled before binding to the device
    
    If the kernel has the module, but the KMS module option is not enabled,
    we cannot function. So after checking to see if the i915.ko is bound,
    then querying whether it provides any KMS resources. If it has no CRTCs
    attached, then we need to failover to the VESA/fbdev drivers. Note that
    this should have been detected by drmCheckModesettingSupported()
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=60987
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a5943e2374a674067e0c48b0fe8a1f2eeff2177
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 15 12:05:14 2013 +0000

    NEWS: Xserver 1.6 was not packaged in Xorg 7.7
    
    I misinterpreted Sedat Dilek's advice on how to fix my confusing
    changelog, so drop the Xorg 7.7 confusion and just refer to the version
    of Xserver the driver is first compatible with.

commit 15e1050ea505c40a288ec197d817d3c6d51693d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 14 21:59:36 2013 +0000

    NEWS: Fix a couple of typos and factual errors
    
    Sedat Dilek corrected my spelling and pointed out that what is known as
    Xorg 1.6 in the log file is actually better known as releases of
    Xserver 1.6 and Xorg 7.7.

commit 86e025a1842f3c2f319676818b1f4624cd94ebc5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 13 22:05:34 2013 +0000

    sna/gen4: Restore nonrectiinear spans workaround
    
    Instead of relying on the macro, the intention was simply to use the
    prefer_gpu hint. However, I dropped it whilst refactoring ideas from
    later generations. So restore both the debug control to force spans as
    well as the intended workaround.
    
    Reported-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2a64dbdfceac985d235c4873f52013633d6cfd8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 13 17:15:46 2013 +0000

    sna: Avoid stalling on a SHM upload when otherwise idle
    
    Fixes regresion from
    
    commit 09ea1f4402b3bd0e411b90eb5575b3ff066d7356
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Jan 10 16:26:24 2013 +0000
    
        sna: Prefer to use the GPU for copies from SHM onto tiled destinations
    
    As the stalls on IVB 64-bit machines at least greatly offset the
    benefits. As those earlier measurements were made on the same IVB
    machine but running in 32-bit mode, I need to double-check whether or
    not this is another 32-bit peculiarity.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4bf51ec7bcc7818fbee8643a88aebee0362691b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 13 16:32:18 2013 +0000

    Revert "sna: Avoid promoting SHM CPU bo to GPU to maintain coherence with SHM clients"
    
    This reverts commit f743cd5734ca502aa8bdb0e1327fe84d6ce82755.

commit 9861423a76402c260724a752ada293a03ce1a79b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 13 15:11:45 2013 +0000

    sna/dri: Fix typo limiting gen4 to TILING_X depth buffers
    
    Fixes regression from
    
    commit 98b312e579385e6e4adf6bf0abe20f8ca84592af
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jan 23 20:51:35 2013 +0000
    
        sna/dri: Stop feeding I915_TILING_Y to mesa i915c
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=60178
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38a3506aa1c9c2e07125b54fc319b6de89febff9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 13 14:09:38 2013 +0000

    sna: Handle scanouts still active at the time of destruction
    
    Basically remove the bogus assert, and reorder the list to
    preferentially reuse the still active scanouts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b82d93162b9e127c6d055d5007e75fcc31f4af8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 12 21:53:38 2013 +0000

    sna/dri: Validate that the scanout flag is set
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04e4805f57fdf0581e5e75c29c275c15c79852a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 12 21:52:35 2013 +0000

    sna: Prefer inplace readback if the GPU doesn't support cacheable BLTs
    
    As we must perform the GTT reads anyway, first see if we can copy
    directly to the destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c569d22d2d243badc15d5dbcc09e6759f4ff01a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 12 20:15:33 2013 +0000

    sna: Only use the inplace read fallback if we have no CPU bo support
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeaed0b7810e9c794749a4f59c72790063cddc86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 12 19:30:44 2013 +0000

    sna/dri: Assert that we are not passed deceased DRI2Buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fb165b02d47634ccf9fb72ab6fb4d65b89f78d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 22:15:17 2013 +0000

    sna/dri: Assert that the old scanout is clear before overwriting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2667b821e193c0badf16420f82f8a99a93c27a46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 22:06:00 2013 +0000

    sna/dri: Update flush status for tear-free exported GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4442045df9164651702b166e0de2bfd25e8a76f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 21:16:19 2013 +0000

    sna/dri: Harden the replacement of the back buffer against alloc failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75406775b83ca5c320e4bc2d2dbd8f1eb0d1677d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 13:00:13 2013 +0000

    NEWS: Fix marketing name for 945gm
    
    The GMA3100 was the desktop G31/G33 which whilst almost identical to the
    GMA950, notably does not require the extra unfenced alignment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b116a1d023ad7cc148d91f268dbf71452dbd9dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 12:36:43 2013 +0000

    sna: Fix inaccurate use of __attribute__((const))
    
    'const' is only allowed to use the function parameters and not allowed
    to access global memory - that includes not allowed to deference its
    arguments...
    
    Thanks to Jiri Slaby for spotting my mistake.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47657e5355103b2e61da6f059c560e63fe13b0ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 12:31:18 2013 +0000

    sna/dri: Ignore a compiler barf breaking an assertion
    
    Manual confirmation with gdb says all is fine and things work again
    after printing the variables responsible. The curious reader is welcome
    to read the disassembly to find where the compiler goofed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3540554e5a74ccd2ca746482700a9f5657954227
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 11:14:17 2013 +0000

    sna/dri: Couple up the flush pixmap after checking for allocation failures
    
    Tidy up the error path not to leave the GPU bo pinned and marked for
    flushing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58b61bcd02467d2b08b2dd194ab6884437b83fa6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 11:05:02 2013 +0000

    sna/dri: Tighten the assertions that we have one DRI2Buffer per Pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a13f806ae28459a5cf671ccbf9cc8725f541a4ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 10:50:20 2013 +0000

    sna: Assert that we do not destroy a GPU bo for an active DRI pixmap
    
    This is an extra paranoid check that the bo is still pinned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2eb2db83280ae45b8df8a3b6e488b6a1404391a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 10:47:13 2013 +0000

    sna: Avoid stalling for changing cache levels on an active scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 696347a6260f3741ad3e6238db0fd285384bb753
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 11 09:58:58 2013 +0000

    sna/dri: Only clear the GPU bo flush flag when the last export is destroyed
    
    Add various assertions around DRI to be sure that we don't change the
    GPU bo for a pixmap that does not match our flush bookkeeping. Then be
    more careful during the DRI2Buffer destroy that we don't accidentally
    remove the flush flag from a shared bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 301aebfa71143fb610eb7b816376a8c1f3e07208
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 18:01:33 2013 +0000

    configure: Add -lX11 required to link the legacy libI810XvMC.so
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65c320e677b8ab4d745568b33f381d5865bf8b73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 14:20:59 2013 +0000

    2.21.2 release

commit 0d75b19979b1ac14353765e2bb84c6a466129109
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 15:47:53 2013 +0000

    sna: Restore glyphs with xorg-1.12
    
    That simple and innocuous build fix for xorg-1.13 bizarrely causes
    missing glyphs with earlier Xorgs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fd0d8873a5a5c4f77904cab0b9909ca941b5dae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 14:29:29 2013 +0000

    NEWS: fix bug url
    
    The dangers of cutting and pasting from git log.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 617fadf3acf7bf75fb203c1e85fd0ddb98b3dbb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 14:20:59 2013 +0000

    2.21.1 release

commit 3169a4e53cf39cc3d5c18ac6add909aa3a58de7e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 11:57:14 2013 +0000

    sna: Reorder some includes so that compat-api.h comes after the headers it wraps
    
    Fixes the build in cases where the compat-api.h was defining macros to
    subvert the real functions found in the xorg includes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71fbad64c5cfe6832a03815bece4c89d15253e1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 10 10:54:17 2013 +0000

    configure: Fix typo in checking for libdrm_intel
    
    The package name is libdrm_intel not libdrm_intel-1, an obvious
    cut'n'paste error from testing for pixman-1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cbdfb54d1fcfed7745111e861e19b7bbac243cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 9 19:15:20 2013 +0000

    sna: Backport to squeeze - Xorg-1.6, pixman-0.16, libdrm-2.4.21
    
    The principle change is to switch to the old Privates API and undo the
    Region renames.
    
    The downside is that this ignores the critical bugfixes made to the
    xserver since xorg-1.6 - but I assume that whoever wants to run the
    latest hardware on the old xservers is also backporting those stability
    fixes...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42a6b25817985e22e7d462be87fbd97973d96a29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 9 15:30:58 2013 +0000

    sna: Fix alignment of the base of partial buffers for pre-G33 chipsets
    
    The older chipsets have much more restrictive alignment rules for the
    base address of tiled but unfenced objects.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1120108
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80044e54634d0836694d5aa6f98ce22fe38d367f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 9 09:57:26 2013 +0000

    sna: Promote to GPU is only partially damaged on the CPU but busy on the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d18cb72a94fad0ee99ab361c21d643c927d29c35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 8 22:31:19 2013 +0000

    sna: Randomly perturb 'wedged' to hunt for faults
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce9f0448367ea6a90490a28150bfdc0a76500129
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 8 16:01:54 2013 +0000

    sna/gen6: Use GT2 settings for both GT2 and GT2+
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae5399aaf9ef57d33e8fd957e8a96964897c09b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 8 11:31:21 2013 +0000

    sna: Force the fallback path for unaccelerated randr damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c69b4389abc324533a9a311c17a667bf8a1e1673
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 22:54:37 2013 +0000

    sna/gen4: Split the have_render flag in separate prefer_gpu hints
    
    The idea is to implement more fine-grained checks as we may want
    different heuristics for desktops with GT1s than for mobile GT2s, etc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bec99de812ce6a1bbc2c8e4cfd05f4f74c560ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 8 00:53:10 2013 +0000

    sna: Remove the bogus assertions on buffer domains
    
    Just a few lines earlier we already have the correct assertion that the
    buffer was not in the GPU domain, so had these two been correct, they
    would have still been redundant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d1d3c6e6102ff20fbff74ec6b3b2e94ee757015
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 14:47:07 2013 +0000

    sna: Fixup an invalid assertion
    
    We may choose to operate inplace on a buffer last used by the CPU if we
    are discarding all the existing damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c405dba367bdca51221bd2464213199783dc18fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 13:41:42 2013 +0000

    sna: Also assert that the GPU is not wedged before continuing a batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit feeff6fcefccdca5335fea55c2fdbf8a4004c175
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 13:33:58 2013 +0000

    sna: Force GTT readback if the GPU is wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a272971d5971a56f57dde00dceb082d0b142c8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 17:59:10 2013 +0000

    sna: Allow inplace uploads to utilise GTT on LLC machines
    
    Rather than arbitrarily disable the fallback paths for LLC, allow it to
    utilise any available GTT buffers for inplace uploads. The best
    explanation so far is that with the streaming is that we are trashing
    the LLC. On other machines, the difference is in the noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc8a2c30c4f6bb9ce751b6717a3a2feaea0d6d4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 10:42:58 2013 +0000

    sna: Only try the SRC fixup into the buffer if it is CPU mapped
    
    On one particular machine, this operation is behaving as if it is
    reading back UC memory during the explicit write-only composite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 889ed28f52bccdbc54692ea075f95f9635a8d58a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 7 10:42:21 2013 +0000

    sna: Correctly align used buffers to the following page boundary
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 974b6a97d78dadf09be8a2c4f61020f15d80d558
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 17:02:27 2013 +0000

    sna: Fallback to non-LLC paths after an allocation failure for an LLC buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c8084ef04cb0a7da064fb1e13c8ef7dae528b1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 16:39:31 2013 +0000

    intel: Becareful not to match UMS against future generations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be241fb25ed0a8d41a642ea811253207f88d0962
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 16:38:12 2013 +0000

    sna: Free the handle after pwrite buffer allocation failure
    
    Having just allocated the handle, we need to free it if we then fail to
    allocate memory for the buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b3b25f0be33d3af3ccecfb3193fc2d365445fdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 16:37:21 2013 +0000

    sna: Flush our caches if we fail to mmap an object
    
    The likely cause for a mmap failure is that we hold too many objects
    open or have exhausted our address space. In both cases, we need to trim
    our caches before continuing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit daba1ae3e7f0532cc53d9a5178778dbaec203052
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 16:17:36 2013 +0000

    sna: Correctly handle failure to CPU map a new allocation
    
    If we fail to CPU map, we want to fallback to just using pwrite with
    normal memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0adb0b5e1ebcf3ddfeddae99d96912ec4c090832
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 16:02:30 2013 +0000

    sna: Handle mapped buffer allocation failure for LLC
    
    The presumption was that if we had LLC we would have allocated the
    buffer by that point - however, it was remotely possible to have fallen
    through and so we need to handle those cases.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4cff22afae598f41adf36cd149223d1f7dd6b6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 15:15:36 2013 +0000

    sna: Relax the buffer size assertion to only be larger than required
    
    Not all paths request alloc pages, a few just request sufficient pages
    for the original size. So we can only assert that condition is
    satisfied.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bc593c732a2f1ccd1bdabc071c709a44222db61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 15:11:00 2013 +0000

    sna: Make sure we always replace io buffers before inserting into the cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f72158919098dd5684d1c56d1ba643cc3be2c7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 15:10:23 2013 +0000

    configure: XvMC support is optional, so make failure to find xcb non-fatal

commit cd6d8f9b9df02934ebfff76cb40410c8ce3887dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 6 10:37:50 2013 +0000

    xvmc: Add the complementary XCB_CFLAGS
    
    After splitting the xvmc dependences into xcb and non-xcb, we then also
    have to add the xcb CFLAGS to build libIntelXVmc.la
    
    Reported-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b96ee47ad97943c3dccd40d9570e29002dc3d85f
Author: Paul Menzel <paulepanter@users.sourceforge.net>
Date:   Sun Feb 3 13:33:08 2013 +0100

    configure.ac: Split out XCB libraries from `XVMCLIB` into `XCB`
    
    Building the package under Debian Sid/unstable, `dh_shlibdeps` informs
    that `libI810XvMC.so.1.0.0` does not need to be linked against
    `libX11-xcb.so.1`, `libxcb-dri2.so.0`, `libxcb-util.so.0` or
    `libxcb.so.1` [1].
    
            $ debuild -b -us -uc
            […]
            make[1]: Entering directory `/src/xserver-xorg-video-intel'
            dh_shlibdeps -- --warnings=6
            dpkg-shlibdeps: Warnung: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 sollte nicht gegen libX11-xcb.so.1 gelinkt werden (es verwendet keines der Bibliotheks-Symbole)
            dpkg-shlibdeps: Warnung: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 sollte nicht gegen libxcb-dri2.so.0 gelinkt werden (es verwendet keines der Bibliotheks-Symbole)
            dpkg-shlibdeps: Warnung: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 sollte nicht gegen libxcb-util.so.0 gelinkt werden (es verwendet keines der Bibliotheks-Symbole)
            dpkg-shlibdeps: Warnung: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 sollte nicht gegen libxcb.so.1 gelinkt werden (es verwendet keines der Bibliotheks-Symbole)
            make[1]: Leaving directory `/src/xserver-xorg-video-intel'
            […]
    
    Moving `x11-xcb`, `xcb-dri2` and `xcb-aux` from `XVMCLIBS` into `XCB`
    and adding `XCB_LIBS` only to the `LIBADD` variables of `libIntelXvMC`
    makes the warnings go away and the libraries are still built without any
    issues.
    
            make[1]: Entering directory `/src/xserver-xorg-video-intel'
            dh_shlibdeps -- --warnings=6
            make[1]: Leaving directory `/src/xserver-xorg-video-intel'
               dh_installdeb -O--builddirectory=build/
               dh_xsf_substvars -O--builddirectory=build/
               dh_gencontrol -O--builddirectory=build/
            dpkg-gencontrol: Warnung: Feld Depends von Paket xserver-xorg-video-intel-dbg: unbekannte Substitutionsvariable ${shlibs:Depends}
               dh_md5sums -O--builddirectory=build/
               dh_builddeb -O--builddirectory=build/
            dpkg-deb: Paket »xserver-xorg-video-intel« wird in »../xserver-xorg-video-intel_2.19.0-6.1_i386.deb« gebaut.
            dpkg-deb: Paket »xserver-xorg-video-intel-dbg« wird in »../xserver-xorg-video-intel-dbg_2.19.0-6.1_i386.deb« gebaut.
             dpkg-genchanges -b >../xserver-xorg-video-intel_2.19.0-6.1_i386.changes
            dpkg-genchanges: rein binärer Upload - es ist kein Quellcode hinzugefügt
             dpkg-source --after-build xserver-xorg-video-intel
            dpkg-buildpackage: Binärpaket(e) hochzuladen (keine Quellen enthalten)
            Now running lintian...
            W: xserver-xorg-video-intel: hardening-no-relro usr/lib/libI810XvMC.so.1.0.0
            W: xserver-xorg-video-intel: hardening-no-fortify-functions usr/lib/libI810XvMC.so.1.0.0
            W: xserver-xorg-video-intel: hardening-no-relro usr/lib/libIntelXvMC.so.1.0.0
            W: xserver-xorg-video-intel: hardening-no-fortify-functions usr/lib/libIntelXvMC.so.1.0.0
            W: xserver-xorg-video-intel: hardening-no-relro usr/lib/xorg/modules/drivers/intel_drv.so
            W: xserver-xorg-video-intel: hardening-no-fortify-functions usr/lib/xorg/modules/drivers/intel_drv.so
            N: 1 tag overridden (1 warning)
            Finished running lintian.
    
    The modules were originally added with the following commit present
    since tag 2.10.0.
    
            commit 3e8f2eae3a586aa29be4858698e666e0ec778cea
            Author: Eric Anholt <eric@anholt.net>
            Date:   Thu Oct 15 13:48:56 2009 -0700
    
                XVMC: Use XCB DRI2 instead of cargo-culting our own copy of Xlib stuff. (v2)
    
    [1] https://buildd.debian.org/status/fetch.php?pkg=xserver-xorg-video-intel&arch=i386&ver=2%3A2.19.0-6&stamp=1347825458
    
    Signed-off-by: Paul Menzel <paulepanter@users.sourceforge.net>

commit 93770c709aa7d3719b7c717040b16c8f82d5c207
Author: Paul Menzel <paulepanter@users.sourceforge.net>
Date:   Tue Jan 22 10:47:22 2013 +0100

    NEWS: Fix a typo: a*n* inadvertent

commit a8cfddd280b5220f23565b21c91f3f7dd10bbe91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 22:06:03 2013 +0000

    sna: Tidy buffer allocation size assertions
    
    Rather than perilously update a local variable with the allocated size,
    just use the size of the bo in the assertion that is large enough to
    satisfy the allocation request.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82dc91e8c24a1fbbf03dcf89a3955319b3399ea0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 21:50:43 2013 +0000

    test: Add a very basic blt benchmark
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c80a0337ec12b6baab5aab380503e672e925677
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 14:56:10 2013 +0000

    sna: ValleyView uses the same scanline registers as SandyBridge
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c45e3fe456d211afc6ba69878b413a72ef5d0bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 14:45:39 2013 +0000

    intel: add more ValleyView PCI IDs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6101d9d71a86a579ff9771d456b234a38bd80b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 11:02:30 2013 +0000

    man: Fix a typo s/debuging/debugging/
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f33c90f7ada238683433d05492434120d06ea1fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 19:34:56 2013 +0000

    NEWS: Trivial typo s/utilile/utilise/

commit 6346c844525c2b3a82c16fe10485b901a2b5ddbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 10:17:45 2013 +0000

    sna/gen4: Remove old single-thread SF w/a
    
    The alternative of disabling GPU spans seems to be far more effective.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1565917f10d9fb3c7e2e7e273173c38c364b9861
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 5 10:11:14 2013 +0000

    sna/gen4: Disable non-rectilinear GPU span compositing
    
    This seems to be the primary victim of the render corruption, so disable
    until the root cause is fixed.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37bc822190f36be7b021167ba4d306bbcd97957b
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Fri Jan 18 14:13:08 2013 +0000

    build: Make generation of gen code depend on intel-gen4asm
    
    This way, when a new intel-gen4asm is available (because one just hacked
    on it and has installed a new version for instance) the shaders will be
    recompiled. This helps catching regressions, testing the latest changes
    in the assembler haven't broken too many things.
    
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18f8d2291fbb53ac993b926c247ca981e1e5207b
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Fri Jan 18 14:13:07 2013 +0000

    build: Use $(AM_V_GEN) to silence the assembly of gen programs
    
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eea535b7e2a35ec4dfa50550b674d4212676d2ee
Author: Damien Lespiau <damien.lespiau@intel.com>
Date:   Fri Jan 18 14:13:06 2013 +0000

    build: Make autoreconf honour ACLOCAL_FLAGS
    
    When running autoreconf, it's possible to give flags to the underlying
    aclocal by declaring a ACLOCAL_AMFLAGS variable in the top level
    Makefile.am.
    
    Putting ${ACLOCAL_FLAGS} there allows the user to set an environment
    variable up before running autogen.sh and pull in the right directories
    to look for m4 macros, say an up-to-date version of the xorg-util macros.
    
    Signed-off-by: Damien Lespiau <damien.lespiau@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9640640ab02d5de630e903116c1b104752f8b604
Author: Paul Menzel <paulepanter@users.sourceforge.net>
Date:   Sat Feb 2 11:44:54 2013 +0100

    configure.ac: Do not include `xext` and `xfixes` in `XVMCLIB`
    
    Building the package under Debian Sid/unstable, `dh_shlibdeps` informs
    that `libIntelXvMC.so.1.0.0` does not need to be linked against
    `libXext.so.6` or `libXfixes.so.3` [1].
    
            $ debuild -b -us -uc
            […]
            make[1]: Entering directory `/build/buildd-xserver-xorg-video-intel_2.19.0-6-i386-9thLfo/xserver-xorg-video-intel-2.19.0'
            dh_shlibdeps -- --warnings=6
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libIntelXvMC.so.1.0.0 should not be linked against libXext.so.6 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libIntelXvMC.so.1.0.0 should not be linked against libXfixes.so.3 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libXext.so.6 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libXfixes.so.3 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libX11-xcb.so.1 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libxcb-dri2.so.0 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libxcb-util.so.0 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 should not be linked against libxcb.so.1 (it uses none of the library's symbols)
            dpkg-shlibdeps: warning: package could avoid a useless dependency if debian/xserver-xorg-video-intel/usr/lib/libIntelXvMC.so.1.0.0 debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 were not linked against libXext.so.6 (they use none of the library's symbols)
            dpkg-shlibdeps: warning: package could avoid a useless dependency if debian/xserver-xorg-video-intel/usr/lib/libIntelXvMC.so.1.0.0 debian/xserver-xorg-video-intel/usr/lib/libI810XvMC.so.1.0.0 were not linked against libXfixes.so.3 (they use none of the library's symbols)
            make[1]: Leaving directory `/build/buildd-xserver-xorg-video-intel_2.19.0-6-i386-9thLfo/xserver-xorg-video-intel-2.19.0'
               dh_installdeb -a -O--builddirectory=build/
            […]
    
    Not populating `XVMCLIB` with `xext` and `xfixes` makes the warning go
    away and the libraries are still built without any issues.
    
    [1] https://buildd.debian.org/status/fetch.php?pkg=xserver-xorg-video-intel&arch=i386&ver=2%3A2.19.0-6&stamp=1347825458
    
    Signed-off-by: Paul Menzel <paulepanter@users.sourceforge.net>

commit 9807bba950078d86a25b91064ecfebaa0ee459e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 18:25:48 2013 +0000

    sna: Drop bogus refcnt assertion during kgem_bo_retire()
    
    As we may call it kgem_bo_sync(), during preparation of the upload
    buffer which in turn may operate on an object straight out of the snoop
    cache and hence not yet referenced (or in some cases, ever).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5561f13498066922b54af04cc71549322ce0e3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 18:05:35 2013 +0000

    sna: Do not add the INPLACE hint if we have the ASYNC hint set
    
    If the caller is preparing to use the GPU to rendering into the CPU bo,
    it will request an ASYNC migration. In those cases, we do not want to
    substitute it with an INPLACE operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3ff1cb9d7f788002337b1e6c4c81c58112b85b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 13:46:33 2013 +0000

    2.21.0 release

commit 008f8230a7c47f1249eb51e53b3abf158f2a42bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 01:54:52 2013 +0000

    sna: Assert that if we have GPU damage we have a GPU bo
    
    Scatter the asserts around the migration points to catch where this
    invariant may be untrue.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf0576f87102b1535268691e7e29661b0f9ee73b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 1 00:19:21 2013 +0000

    sna/video: Correct computation of planar frame size
    
    The total frame size is less than 3 times the subsampled chroma planes
    due to the additional alignment bytes.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1104180
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 268285d9a64fc47fe81fe5bfbfbd1890dad53e1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 21:57:41 2013 +0000

    sna/gen3+: Flush vertex threads before touching global state
    
    We need to be careful not just when finishing the current vbo to
    synchronize with the sharing threads, but also before we emit the batch
    state that no other thread will try and do the same.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1239e012ae6d4f00ce73f32d7244905a601170ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 19:18:17 2013 +0000

    sna: Make sure the needs_flush is always accompanied by a tracking request
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9712f49fddc8be939f77c25fcb907873af44619f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 18:08:05 2013 +0000

    sna: Remove stale assertion
    
    Now the reset is meant to restablish 'rq' if the bo was busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd7df0004cf6e423d2ae6c0cf83a84e0031161b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 17:32:57 2013 +0000

    sna: Pass width/height to composite for rotated displays
    
    This is essential to handle displays that are too large to be rendered
    normally via the 3D pipeline and so that the bounds of the fixup region
    are known.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=60124
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38376b56cfe0dfc603bce48e37432622ef9a0135
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 17:29:10 2013 +0000

    sna: Remember to move scanouts to the scanout cache after retiring
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a08de1f02577aef0da289108270c1b35e5d9703
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 16:39:47 2013 +0000

    sna: After removing the bo from a batch, check whether it is still busy
    
    If we transfer a bo to the current batch, then subsequently discard it,
    we lose the information about its current active state. Try to recover
    this information, by querying the kernel and adding it to the flushing
    list if necessary.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fff0686342f8ec3b3f3510340e073defdf2fb73f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 12:40:21 2013 +0000

    sna/traps: Thread the fallback rectilinear compositor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 839542d219bd919c99398d514c1d194d18b78eff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 12:08:52 2013 +0000

    sna/traps: Allow inplace compositing for non-GPU buffers and rectilinear traps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e329e04b10c88afb40f2fd8fdad5b24b9f7dfc15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 11:33:37 2013 +0000

    sna/traps: Translate the extents for the rasterization threads
    
    The single-threaded code used the pre-computed width/height and only
    required the origin from the bounds. However, the threads need to
    allocate memory for themselves based on the computed bounds, and so it
    helps if those bounds are then correct (rather than only the top-left
    being in local space with the bottom-right in global coordinates).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 033f75e5bd94e226e719f87ed4e0091845384679
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 01:38:01 2013 +0000

    sna: Stage retirement through the flushing list
    
    If the kernel replies that a bo is still busy, stage its retirement
    through the flushing list to be certain that we never stall on a
    subsequent write.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f5711e62cc4c8ca15782376c4047174299e2db0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 01:21:08 2013 +0000

    sna: Disable dangerous assertions that depend upon external state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42529336fd92d39a5a5eceb07f2838d4be50fa8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 31 00:58:51 2013 +0000

    sna: Prevent falling back to swrast if source is on the GPU
    
    Currently if the dst is wholly contained within the CPU, then we try to
    continue to operate on the GPU. However, if we have FORCE_GPU set, it
    means that one of the sources for the operation resides on the GPU, and
    that would require a readback in order to perform the operation on the
    CPU. Hence, if we try to use a CPU bo and fail, convert back to using
    the GPU bo if forced.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2d06c407e1c2cbbf3f7f6c4989710a799cd43d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 21:17:42 2013 +0000

    sna: Improve DBG output for damaged slave outputs
    
    After computing the intersection of the damage with the slave, give the
    region extents.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8867aa6a46c33fd2abf3b3f0b1d6115bad6c8017
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 21:15:55 2013 +0000

    sna/dri: Handle change of BackBuffer across a pending flip
    
    If we encounter a delayed flip with a different back buffer than the
    current, simply update the info rather than bug out.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a31fd03bd4c87c48dc3ca15e3082e29348224b8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 17:26:28 2013 +0000

    sna: Add a bunch of assertions to make sure we do not misplace scanouts
    
    As scanouts are uncached, they need to be treated carefully and
    decontaminated before being placed in the general cache. So double check
    that no bo in those caches are still marked as a scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f1b862282ddb4545987fb9f0a45b528b7b7b5ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 15:44:53 2013 +0000

    sna: Pass the correct WRITE hint when migrating for rendering into the CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5011ed2e729d46fe3cff5454e15a0fd16441f7e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 15:44:22 2013 +0000

    sna: Only discard the clear hint when writing inplace to the GPU pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6312f58014c0bb4afa56855be1e9becc3e3cc3d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 15:43:05 2013 +0000

    sna: Don't force a migration from CPU rendering for a DRI2 flushed pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60a3b370aea0cf9ffb4947a73984c877b4695d4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 15:41:51 2013 +0000

    sna: Retire the bo after a set-domain(CPU,0)
    
    Having relaxed the earlier assertion because the kernel is wrong, we can
    now retire for READ-READ optimisations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78ad5a742f40c2311bfe90997aebedeb998464e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 15:40:06 2013 +0000

    sna: Relax assertion the the kernel considers the bo idle when we call retire
    
    All the callers have explicitly changed the domain upon the bo before
    calling kgem_bo_retire(), so we still get the occasional sporadic
    failure as kgem_busy() reports true. Kill the assertion for now.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83bcd310d279758542e366348f808d7ca0f6d0bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 13:18:21 2013 +0000

    sna: Prefer to use snooped buffers for readbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 496f3ff04453524639a52a3b9dfcb8e198e5e597
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 12:21:33 2013 +0000

    uxa: Harden against failures to submit batchbuffers
    
    If we fail to submit a batchbuffer, the driver is broken and likely to
    continue to fail to render. Give up, and fallback to swrast so that the
    session remains usable.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=59771
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04d48fee713e7bbc9cdf4f09855f6663a4bdc59f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 11:46:20 2013 +0000

    sna: Fix errors found from asserts in a66c5f9ed51e
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc8b191ef6f5030d17a3b6497d1fd7556756c1ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 09:04:10 2013 +0000

    sna: Return early if the Drawable box exactly matches one CRTC
    
    If we are trying to find the best coverage, then by definition if the
    drawable is an exact match for one CRTC, we can stop looking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de28027ffc649920268ae6fdd64146f08310e8a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 08:42:48 2013 +0000

    sna/dri: Make sure we discard the existing mappings when swapping GPU bo
    
    If the GPU bo is currently mapped to the Pixmap, we need to be sure to
    invalidate that mapping if we swap the GPU bo (for SwapBuffers). If we
    forget, we leave a dangling pointer to chase.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=60042
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf9b9ac3186299ab2418c55e73e19c81e5f615a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 08:40:53 2013 +0000

    sna: Only discard the mapping prior to the actual read when uploading
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a66c5f9ed51e1dcfc2ab03339795b73617629196
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 30 08:22:00 2013 +0000

    sna: Before replacing the devPrivate.ptr assert it is not already mapped
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fdd28419adee7145d3925cff2704143a324e9d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 29 22:26:15 2013 +0000

    sna: Only migrate the sample box if using the BLT engine for a composite
    
    Modify the presumption that if we are using a core operation on a shadow
    pixmap, then we are likely to continue migrating that pixmap back and
    forth.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c3b0f11d718d915e502582e9fadd5c0577640db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 29 22:24:30 2013 +0000

    sna: Verify that we always add the SHM CPU bo to the flush list when using
    
    As we need to synchronize that bo before the next reply, we need to keep
    track of it whenever it is active on the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f743cd5734ca502aa8bdb0e1327fe84d6ce82755
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 29 18:04:40 2013 +0000

    sna: Avoid promoting SHM CPU bo to GPU to maintain coherence with SHM clients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9383c5efe9ace34970abddc5e3c84c32505b537f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 29 17:24:24 2013 +0000

    sna/gen3+: Fix a DBG for composite_boxes()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b02a1ea5573b6f0b58a037dd4788c04c296f7ff3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 29 09:28:33 2013 +0000

    sna: Add GT1/GT2 thread counts for Haswell
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1dc2d9ede5c7f330ebadf85d987559c8a6cb1c6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 28 23:14:57 2013 +0000

    sna: Add some more paranoia that we correctly map before fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63c71bcd96202e6da44d6776d119a82f0c06d386
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 27 23:17:13 2013 +0000

    sna: Fix typo in vertex count for threaded source span emitter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0d26ca9312695d05c29503a3f892e7f2c5816dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 27 21:07:03 2013 +0000

    sna: Replace the forced vertex finish with just a wait
    
    When completing a batch mid-operation, we need to wait upon the other
    threads to complete their writes so that memory is coherent before
    submitting the work to the GPU. This was achieved by forcing the finish,
    but all that from that is the wait, which makes the handling of threads
    much explicit and removes the unnecessary vbo refresh.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0c3170c1092d01b4937f352a3962854785ee549
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 27 19:09:38 2013 +0000

    sna: Add the pixmap to the flushing list when creating for inplace CPU writes
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73f574945f2cac14f9bafa6395e2c4dbb16fcf5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 27 16:02:52 2013 +0000

    sna: Disable all signals in the render threads
    
    X uses them (SIGIO especially) for input handling, and gets rightfully
    confused if it finds itself in a different thread.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a7bf70365980809d0f02190f2f620a957ff1ba8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 26 23:03:33 2013 +0000

    sna: Enable threaded rasterisation for non-antialiased geometry
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8178cff5718e69e14d3953a7f754d7585a06838f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 26 14:41:04 2013 +0000

    sna: Begin sketching out a threaded rasteriser for spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ffb3f50b3b4601401da76e2848e059ab63231f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 25 10:45:39 2013 +0000

    sna: Spawn threads to rasterize trapezoids through pixman
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ec2f3a8bac96acc55c8fdb432b97d026abaafb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 23:10:39 2013 +0000

    sna: Spawn threads to composite trapezoids inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 427b7311fe1b66d54518bae45e9fa149bda8a6e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 22:25:46 2013 +0000

    sna: Perform the last threaded composite operation directly
    
    The point of the refactor was to execute the last stage of the composite
    in the master thread, so do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 326dcd75f2202b1af29e986f5efb6b1e133217cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 20:58:53 2013 +0000

    sna: Parse cpuinfo to determine the actual number of physical cores/caches
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f597b647180c1e7bf83693060f244926191b7462
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 18:45:35 2013 +0000

    sna: Tidy construction of data for threaded composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1643c97f8f7b49738b649b5f7d1e574d689d167e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 18:24:02 2013 +0000

    sna: Use threads for simple mask generation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d60128c55e8f5f69476d42c20f2fd62ccc0f411e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 15:41:29 2013 +0000

    sna/dri: Compensate clipExtents for drawable offset
    
    The clipExtents is in screen coordinates whereas we just want to confirm
    that the maximum pixel to be copied lies with the DRI2 buffer, which is
    relative to the drawable.
    
    Reported-by: Matthieu Baerts <matttbe@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=59806
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 264b3b72500c5af74d124a214347d45c9cb90a1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 15:06:12 2013 +0000

    sna: Refactor to use a common fbComposite fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ecfbea9d1f83b2de62bee0f58299e7a90c741d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 24 14:46:03 2013 +0000

    sna: Experiment with a threaded renderer for fallback compositing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 778dba90cfc4e801a975bd661c56a565ce60524b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 21:32:29 2013 +0000

    sna/dri: Don't contribute missed frames to the target_msc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50b41cb485ffb38e6bf705a3a62840bb78af669b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 21:16:49 2013 +0000

    sna/dri: Only reject DRI2 buffers that are too small for the request blit
    
    The goal is to reject stale DRI2 buffers that are smaller than the
    target due to not-yet-handled ConfigureNotify, but not to reject
    blitting from Windows that are larger than the frontbuffer.
    
    Fixes a regression from the overzealous
    commit b27ecf3059bc066ef59f2a71c1d8d8f0ffec7191
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Nov 12 14:06:06 2012 +0000
    
        sna/dri: Prevent scheduling a swap on stale buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98b312e579385e6e4adf6bf0abe20f8ca84592af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 20:51:35 2013 +0000

    sna/dri: Stop feeding I915_TILING_Y to mesa i915c
    
    Only i915g handles Y-tiling, and we can't differentiate between the two
    types of clients.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31796400915a06fc789088b7dcfcecd6ea91e195
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 19:37:23 2013 +0000

    sna: Clean up WAIT_FOR_EVENT on gen2/3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea8148b24d48db4f46205817db8a55dd6ea1a4b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 17:47:12 2013 +0000

    sna/dri: Prefer to use the BLT ring for vsync'ed copies on IVB+
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c3a87a2d4261cbd66602812637328a04787f510
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 17:35:50 2013 +0000

    sna/gen6: Correct the event definition for secondary pipes for MI_WAIT_FOR_EVENT
    
    It helps to wait upon the event we program and enable.
    
    References: https://bugzilla.kernel.org/show_bug.cgi
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88753c5a8c6c9acf086d81828260adf330eebb1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 23 17:35:50 2013 +0000

    sna/gen7: Correct the event definition for secondary pipes for MI_WAIT_FOR_EVENT
    
    It helps to wait upon the event we program and enable.
    
    References: https://bugzilla.kernel.org/show_bug.cgi
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d92d8ec562cb1e6b9dca28074adca670734233c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 22 09:24:04 2013 +0000

    sna: Extend rectangular PolyLines to cover corner pixels on ccw paths
    
    Reported-by: Joe Peterson <joe@skyrush.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55484
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8817e24a9d97110a961c3803290e38ff5cbfc9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 22 09:06:50 2013 +0000

    sna/gen7: Fix inversion of bool return code from CA pass
    
    As we inverted the predicate, we no longer restored the original
    operation after performing a CA pass - glyph would randomly become
    white.
    
    Reported-by: Jiri Slaby<jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10f549332e315cfe2cc86aadab94a95ae6757c34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 21 16:48:34 2013 +0000

    sna: Free a non-reusable bo if it expires on the flushing list
    
    Still no sure just how the bo ends up there, but as there seems to be
    the occasional malinger, just free it.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7f0df27edb20b052ad39beb26a0b1924f432618
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 21 16:34:09 2013 +0000

    sna: Use the maximum backlight value if we fail to read the current value
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46a3a68e60a1d0a598ec8ece81088a4e6491de55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 21 16:29:30 2013 +0000

    sna: Assert that if marked as a scanout it is indeed bound.
    
    On further review, the invariant must have been violated earlier, so
    make the assert earlier.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0507d55dd1bc8fedae524a410a9e7b53f1dad920
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 21 16:24:49 2013 +0000

    sna: Only add bound scanouts to the scanout list
    
    If we never used the bo as an actual scanout it will never have had been
    moved to the uncached domain and so we can return it back to the system
    cache.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a0bc67ba57cf698e100df617474669ed5d036d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 21 11:41:38 2013 +0000

    sna: New execbuffer flags for lut-handle and fast-relocs are upstream
    
    Now the flags are upstream, we can rely on runtime tests as the
    interface is now frozen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 208ca91a31182e8ddad36e6a735c725362cbd071
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 18:02:41 2013 +0000

    sna/gen7: Place the vsync commands in the same cacheline
    
    Do as told; both the LRI and WAIT_FOR_EVENT need to be in the same
    cacheline for an unspecified reason.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a3e3abfe9b624af2354c5a69778aee3024fe46c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 17:48:31 2013 +0000

    sna/gen7: Offset start/end scanlines by one
    
    The hardware needs to be programmed with the line before the desired
    scanline, wrapping around as required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6a64f872bfd026aa1ba1bd44b1298918c819849
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 16:59:58 2013 +0000

    sna/gen3+: Remove bogus assertion that the vbo in included before finish
    
    If we are carrying over a nearly full vbo from one batch to the next, we
    may indeed finish it prior to writing any new primitives and so the
    assert is truly bogus.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5de919336fc1ba1c4116e18ba0560cdb7b0589f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 16:36:17 2013 +0000

    sna/gen6: Tweak programming scanline values
    
    The documentation says that both start/end scanline need to be the line
    before the desired value, and so to program the first scanline we need
    to set it to the last scanline. The docs also say that the lower 3 bits
    are ignored, so tweaked the values programmed accordingly with an extra
    check that the window is not reduced to 0.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f9ac4e8a17e9d60bbb55c46929c37e92181d804
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 15:53:32 2013 +0000

    sna/gen3+: And restore non-CA compositing state after the CA pass
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 650c9d5ce80afc1d4c8d9f77f6679f085fa4dc9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 14:58:42 2013 +0000

    sna/gen3+: Reset vertex relocation state after discarding the batch
    
    Fixes a regression from commit a6ecb6d31d8c543f38fca0be6b0ec82e59dcd8d2
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jan 16 09:14:40 2013 +0000
    
        sna: Discard the batch if we are discarding the only buffer in it
    
    as we may keep a stale relocation for the vertex buffer alive if we
    attempt to clear the bo using the render engine before discarding it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 492952e0d6362a046a666956afdf8f9bc0f2b7e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 14:55:06 2013 +0000

    sna/gen3+: Handle flushing vbo for CA glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b52c921204df6b2486717fcef05b4a1993aa1071
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 14:02:07 2013 +0000

    sna: Adapt error detection and handling for invalid batchbuffers
    
    Allow the DDX to continue even if the kernel rejects our batchbuffers by
    disabling hw acceleration - just extends the existing hang detection to
    also handle the driver producing garbage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8215a278f20d34819536edbda05a108a860fefb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 12:36:07 2013 +0000

    sna/gen3: Always close the vertices for a batch, even if the vbo is empty
    
    In the case where we emit a no-op, we may not attempt to finish binding
    the vbo as it is considered empty. This leaves a stray relocation for
    the next batch, and also causes it to believe that it has a vbo bound
    already.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a88a9b9a59fa2d5fd427fa6e1f74fb9844379264
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 12:06:09 2013 +0000

    2.20.19 release

commit 7822bbacbece6fcb2e12863cd6c7a53ab614c37c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 11:43:49 2013 +0000

    test: Add script to generate source file for testing vsync
    
    Courtesy of an original script by Mark Schreiber,
    https://bugs.freedesktop.org/show_bug.cgi?id=59606

commit 9329d8755981989ccbe66df6085fbab7c809a2c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 10:14:21 2013 +0000

    sna: Make DEBUG_SYNC a configure option
    
    As it is advisable to combined the synchronous rendering debug option
    with other debugging options, it is more convenient to make it into a
    configure option: --enable-debug=sync
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9263f192e2f85dd961bc1c4e9ca8180db874517
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 20 01:39:12 2013 +0000

    sna: Apply DEBUG_SYNC prior to emitting error report
    
    This is handy for the case where the batch triggers a GPU hang rather
    than being rejected by the kernel.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42ab789cce8423d99864776c6d5ba759c4129b54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 18 13:56:53 2013 +0000

    sna: Clear the non-intersecting damage after skipping the slave update
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 828a3a80aa3f0692e7be2831d58bccf02e2c481d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 18 13:16:23 2013 +0000

    uxa: Clip dirty region to slave pixmap before appending damage
    
    Fixes regression from
    
    commit c789d06cf8a0debc67058d7be1483f5b542e2baa
    Author: Dave Airlie <airlied@redhat.com>
    Date:   Mon Jan 7 13:57:21 2013 +1000
    
        intel: fixup damage posting to be done correctly around slave pixmap
    
    which causes the entire slave scanout to be readback from uncached
    memory every time a pixel is modified.
    
    Reported-by: Stephen Liang <inteldriver@angrywalls.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=59539
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e17eaf540b614cdcb8f7349dd01852c3afc5ab05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 18 13:09:36 2013 +0000

    sna: Replace double negative '!RegionNotEmpty' with the equivalent RegionNil
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2de43a0164ba5364ffd7cb48f0bccc9873e87332
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 18 12:01:54 2013 +0000

    sna: Skip an empty slave update
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38de17f80d780bf219fc3c4018ad9cc8808ba50f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 18 10:16:42 2013 +0000

    sna: Remove bogus assertion invalidated by 'read-read' sync
    
    If we perform a read-read synchronisation, the kernel may still believe
    that the bo is busy as it remains on the active lists being read by the
    GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f68ac60ae37cc72503ec40691d1ae43a476f8e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 20:00:34 2013 +0000

    sna/dri: Explicitly flag sync copies for the backends
    
    As gen6/7 need to prevent ring switching and perform a rendercopy if we
    need to perform a vsync'ed copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ee00c408d8142cfaf4202393c2364c9ae73cb6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 13:09:47 2013 +0000

    sna/trapezoids: Fix horizontal offset for inplace operation
    
    Remember that for an inplace operation we are not dealing with an a8
    mask, but rather a x8r8g8b8 surface and so need to step accordingly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d749f93ea52161e59da1adca1a22e96ba293551
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 12:28:18 2013 +0000

    sna: Drop the MOVE_WHOLE_HINT for PutImage
    
    It is not as clearly beneficial as for GetImage, as for example toolkits
    may only push the shadows around a window.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc643ef753bcfb69685f1eb10828d0c8f830c30e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 12:27:55 2013 +0000

    sna: Apply read-only synchronization hints for move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18035a21e147788bea03ab2175ca03ae951701ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 11:52:10 2013 +0000

    sna: Remove the confusion of the pixmap->undamaged
    
    This was to track a pixmap that had been used for migration (i.e had in
    the past been used for mixed rendering). It is no longer used so remove
    it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46141d277f326ae78f7b0e927a500e0eb1987f1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 10:16:24 2013 +0000

    sna: Consider fill style for XPolyRectangle
    
    The rectangle outline is not always solid...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5c8d38afaba04281157bafe212e93f010ae00f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 17 10:10:54 2013 +0000

    sna: Refactor to remove a goto from sna_put_zpixmap_blt()
    
    The complexity of the function has been moved to move-to-cpu so we can
    take further advantage of the simplified logic in put_zpixmap to clean
    up the code by removing an unwanted goto.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9552438caa4d295c99a9b8821cf2644739861c6a
Author: Colin Walters <walters@verbum.org>
Date:   Wed Jan 4 17:37:06 2012 -0500

    autogen.sh: Implement GNOME Build API
    
    http://people.gnome.org/~walters/docs/build-api.txt
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>

commit 87d773249af18ae8722aacb7306b0eee51a90dbc
Author: Adam Jackson <ajax@redhat.com>
Date:   Wed Jan 16 13:18:23 2013 -0500

    configure: Drop AM_MAINTAINER_MODE
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>

commit dbf1cfec9cd4e9efe7650f2940c92b4e51214288
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 12:20:48 2013 +0000

    2.20.18 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47caffc50b5cdd288ad868fa9a697f0d4e2d28dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 10:49:24 2013 +0000

    sna: Restrict upload buffers to reduce sampler TLB misses
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab36300a22222086b94857f356612106ffbeb480
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 09:17:59 2013 +0000

    sna: Correct DBG to refer to the actual tiling mode forced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6ecb6d31d8c543f38fca0be6b0ec82e59dcd8d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 09:14:40 2013 +0000

    sna: Discard the batch if we are discarding the only buffer in it
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26db2438e34feb8f28444bf7418869b4ecd870da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 09:00:21 2013 +0000

    sna: Fix computation of large object sizes to prevent overflow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54c1d97d5ab325874e1c7b2639e58111d7a6b93f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 16 09:00:04 2013 +0000

    sna: Add DBG for when we add the inplace hint
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 588c5aa6bca441d7c9305fe2fcf268e89b6b617d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 22:21:56 2013 +0000

    sna: Revert use of a separate CAN_CREATE_SMALL flag
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af85ffdec7047efa452d6bab3a0ee3889dd4f046
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 20:37:11 2013 +0000

    sna: Avoid serialising on an move-to-cpu for an async operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d70be85dc723168a481c1955444afd951c4817bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 20:16:45 2013 +0000

    sna: Assert that we never try to mix INPLACE / ASYNC hints for move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1287c3a24c277cb42930d8af2943b9f7b016f31d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 18:59:15 2013 +0000

    sna: Specialise sna_get_image_blt for clears to avoid sync readback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da4972eec57e662b98a7abced6338ceb8a533a48
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 18:34:07 2013 +0000

    sna/trapezoids: Avoid the multiply for an opaque source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f968c8c991cff751459939bdb42e14255f529b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 18:41:00 2013 +0000

    sna: Add DBG to use_shm_bo()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af63fab5047a43716c5df875ddc50f7c877f8a83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 18:21:11 2013 +0000

    sna: Hint that a copy from a SHM bo will likely be the last in a batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1be436409222c00ff66c6d747487b77f1037b27a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 18:20:29 2013 +0000

    sna: Pass the async hint for the upload into the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2113f7f440dd2f10e80f0bb3bd5cd155f7e19098
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 09:33:03 2013 +0000

    sna: Free the SHM pixmaps after b266ae6f6f
    
    Since b266ae6f6f protected the static allocations from being reaped in
    the normal course of events, we need to penetrate those defenses in
    order to finally free the SHM mappings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 441c481630a5cf09a7eb26d5db80b1e60cb2b10f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 01:26:19 2013 +0000

    sna: Mark uploads with async hints when appropriate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6abd442279fd32d1ce9b33a72eabbeb922316151
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 15 00:15:23 2013 +0000

    sna: Avoid allocating an active CPU bo unnecessarily
    
    If we will not write back the GPU damage to the bo as we intend to
    overwrite it for the next operation, we can forgo allocating the active
    CPU bo and skip the synchronisation overhead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f235c74cd661970c76e152777e9a2c314a368a56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 14 15:49:42 2013 +0000

    sna: Tweak considering of last-cpu placement for inplace regions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70c5e41b519e44e620948d683d3b1111494d2f48
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 14 15:03:59 2013 +0000

    sna: Limit temporary userptr uploads to large busy targets or LLC machines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf860da1c78244036c59edf934b312cc1367e8aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 14 12:50:54 2013 +0000

    sna: Apply PutImage optimisations to move-to-cpu
    
    We can replace the custom heuristics for PutImage by applying them to
    the common path, where hopefully they are equally valid.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4ad4477815abe31b1a2323673da86a6def2f246
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 14 13:12:46 2013 +0000

    sna: Use userptr to accelerate GetImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cc04a8e24f02248b6382c9bc354ea15c42b17b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 17:34:03 2013 +0000

    sna: Initialize src_bo to detect allocation failure
    
    sna_accel.c: In function 'sna_put_image':
    sna_accel.c:3730:18: warning: 'src_bo' may be used uninitialized in this
    function [-Wmaybe-uninitialized]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f04b0b98d7f861ff58b82c99d33b7eacfcda5f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 17:31:15 2013 +0000

    sna: Check size against aperture before attempting to perform the GTT mapping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a7db06c62228acc6d1c03e800c7afa84e886f5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 13:45:18 2013 +0000

    sna: Add a compile flag for measuring impact of userptr uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bcc212dc7a939505a678f97f6700eee99204249f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 13:36:09 2013 +0000

    sna: Use the pixmap size (not drawable) to determine replacement
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32f43f618d9b11ea44b3e01a95ac3f239a731ad2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 13:23:24 2013 +0000

    sna: Allow large image uploads to utilize temporary mappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf2b2e2f91208412c8b74a95859def501514be43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 12:24:44 2013 +0000

    sna: Allow creation of a CPU map for pixmaps if needed
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b266ae6f6f8fb4c494ece532ae4621055e66beb2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 11:30:07 2013 +0000

    sna: Relax limitation on not mapping GPU bo with shadow pointers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2d82161436e489f23637d793c737bc6950a62b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 13 10:17:33 2013 +0000

    sna: Correct a few assertions after enabling read-only mappings
    
    As these do not flush the active state if we have read-read mappings, we
    need to be careful with our asserts concerning the busy flag.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab01fd696e1137ddfb9a85ae68c15c05900f0e8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 12 09:17:03 2013 +0000

    sna: Experiment with a CPU mapping for certain fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03d392cd1d87e17129c42e4d822d3d1749edb02e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 12 08:51:52 2013 +0000

    sna: Tweak max object sizes to take account of aperture restrictions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d111c464bfbae57bb7141872810c88b88f30c087
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 12 08:15:13 2013 +0000

    sna: After a size check, double check the batch before flushing
    
    As we may fail the size check with an empty batch and a pair of large
    bo, we need to check before submitting that batch in order to not run
    afoul of our internal sanity checks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec77a07b41f1062b941774f3782b51d21e7824dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 11 11:40:57 2013 +0000

    sna/dri: Prefer to preserve the ring of the destination bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42f1026e11527cb62b4522b44e71a4e72582a876
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 11 11:40:16 2013 +0000

    sna: Reorder struct kgem_bo to move related data into the same cacheline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aead71051ed757e7565d395c858bf8ab8f0b0ff6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 11 01:30:43 2013 +0000

    sna: Disable memcpy_to_tiled_x() uploads on 32-bit systems
    
    It's far too slow due to the register starved instruction set producing
    attrocious code and the extra overhead in the kernel for managing memory
    mappings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 220970b1a484e283e2bbb44f79df613ce1ee1146
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 19:43:05 2013 +0000

    sna: Also prefer to use the GPU for uploads into a tiled bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 672e59851c427c63f43cde7dfd1688a72100e3b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 19:35:29 2013 +0000

    sna: Prefer userptr if copying to a tiled bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 441ef916ae6569c88b3d6abaf7fea4d69be49d76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 19:14:21 2013 +0000

    intel: Throttle harder
    
    Filling the rings is a very unpleasant user experience, so cap the
    number of batches we allow to be inflight at any one time.
    
    Interestingly, as also found with SNA, throttling can improve
    performance by reducing RSS. However, typically throughput is improved
    (at the expense of latency) by oversubscribing work to the GPU and a
    10-20% slowdown is commonplace for cairo-traces. Notably, x11perf is
    less affected and in particular application level benchmarks show no
    change.
    
    Note that this exposes another bug in libdrm-intel 2.4.40 on gen2/3.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a37d56f338c5fae832d5eeea1283b6dbde827678
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 16:28:24 2013 +0000

    sna: Use some surplus bits to back our temporary pixman_image_t
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09ea1f4402b3bd0e411b90eb5575b3ff066d7356
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 16:26:24 2013 +0000

    sna: Prefer to use the GPU for copies from SHM onto tiled destinations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c63147a3c33fd26f5c04a8648881659b4a90df06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 15:15:15 2013 +0000

    sna: Allow CPU bo to copy to GPU bo if the device is idle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2933e7595838c28081810d4959ca1e005a0419e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 13:07:19 2013 +0000

    sna: Ignore the last pixmap cpu setting if overwritting all damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 934ea64f7ff080b00d00c50ba94f63247d7bb130
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 13:06:06 2013 +0000

    sna: With a GPU bo and a shm source, do not fall all the way back
    
    The normal source upload into GPU bo knows a few more tricks that we may
    want to apply first before copying into the shadow of the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a8edfe4076ee08558c76eddbb68426e4563888c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 03:31:37 2013 +0000

    sna: Make sure all outputs are disabled if no CompatOutput is defined
    
    If we have to fallback and the configuration is wonky, make sure that
    all known outputs are disabled as we takeover the console.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5449e16c0c2b6ca5af4acf42703164b9d2b2d822
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 10 02:54:41 2013 +0000

    sna: Open-code xf86CompatOutput() to avoid invalid pointers
    
    config->compat_output needs to be sanitized during device initialization
    or we may dereference an invalid xf86OutputPtr.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8881a14200580db731ca6902b289b08989aaa61e
Author: Mickaël THOMAS <mickael9@gmail.com>
Date:   Mon Jan 7 20:47:51 2013 +0100

    Set initial value for backlight_active_level
    
    If the "Backlight" option is set, backlight_active_level is not set which
    results in a default value of 0, causing a black screen upon starting Xorg.

commit b8c9598294eaa16e0d1578ad98896f6ec5ba37cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 7 13:57:21 2013 +1000

    sna: fixup damage posting to be done correctly around slave pixmap
    
    Copied from commit c789d06cf8a0debc67058d7be1483f5b542e2baa
    Author: Dave Airlie <airlied@redhat.com>
    Date:   Mon Jan 7 13:57:21 2013 +1000
    
    This fixes the damage posting to happen in the correct ordering,
    not sure if this fixes anything, but it should make things more consistent.

commit c789d06cf8a0debc67058d7be1483f5b542e2baa
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Jan 7 13:57:21 2013 +1000

    intel: fixup damage posting to be done correctly around slave pixmap
    
    This fixes the damage posting to happen in the correct ordering,
    not sure if this fixes anything, but it should make things more consistent.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 5891c89ff2be277d1a833d4bc092b65184c1f3d6
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Jan 7 13:54:47 2013 +1000

    intel: drop pointless error printf in the slave pixmap sync code.
    
    This is left over and spams logs, get rid.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 27550e81482229007fa9e0e9769fdd20f3616b23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 17:29:19 2013 +0000

    sna/dri: Transfer the DRI2 reference to the new TearFree pixmap
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=58814
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a5e4fb725da2eb25cf7f476290c02e9880a4efc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 17:08:56 2013 +0000

    sna: Only disable upon a failed pageflip after at least one pipe flips
    
    If we have yet to update a pipe for a pageflip, then the state remains
    consistent and we can fallback to a blit without disabling any pipes. If
    we fail after flipping a pipe, then unless we disable an output the
    state becomes inconsistent (the pipes disagree on what the attached fb
    is).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd66ba8e5666a1ce7da0ddc226d074f591e1fa22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 16:13:56 2013 +0000

    sna: Try to create userptr with the unsync'ed flag set first
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9051f43fa3c8d011921ac6ff75b763280f26d98f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 15:20:14 2013 +0000

    sna/gen4+: Handle solids passed to the general texcoord emitter
    
    The general texcoord emitter does handle solids (for the case of a
    transformed mask) and so we need to be careful to setup the
    VERTEX_ELEMENTS accordingly.
    
    Fixes regression from
    commit 2559cfcc4cbc1d0d84b048565cad3bfee61df8da
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Jan 2 10:22:14 2013 +0000
    
        sna/gen4+: Specialise linear vertex emissio
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4af910e8be92e0ca241ce1e93e322c712dcbe340
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 13:43:55 2013 +0000

    sna/gen4+: Trim the redundant float from the fill vertices
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3244e4b23397f54ca76876dd76ebea9a0abd357e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 6 13:24:23 2013 +0000

    Revert "sna/gen4+: Backport tight vertex packing for simple renderblits"
    
    This reverts commit 8ff76fad1fadc5e309f9a12c30f883460a432049 and
    commit 48e4dc4bd4b2980f0f804f572d0e3fc1bb4bc21e.
    
    I forgot gen4 and gen5 do not have the 'non-normalized' bit in their
    sampler states.

commit d3be77f87916e38af717bafaf2000becd5180d76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 5 18:07:50 2013 +0000

    sna/trapezoids: filter out cancelling edges upon insertion to edge-list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b4a2f52c47a24c297312d51f9a8299c9a54a697
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 5 17:21:34 2013 +0000

    sna/trapezoids: filter out zero-length runs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59a7b8b32c694735942fd7e42c1382d91004b0b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 4 18:22:14 2013 +0000

    sna: Clear up the caches after handling a request allocation failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c31a9fc210221ba8e7922bec80c15ec39cab7bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 4 18:11:12 2013 +0000

    sna: Embed the pre-allocation of the static request into the device
    
    So that in the cache where we are driving multiple independent screens
    each having their own device, we do not share the global reserved
    request in the event of an allocation failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5b3cfb0ad1cc5e66c99035f526946bf41011e13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 3 23:33:44 2013 +0000

    sna: Flush the batch prior to referencing work from another ring
    
    In the case where the kernel is inserting semaphores to serialise work
    between rings, we want to only delay the surface that is coming from the
    other ring and not interfere with work already queued.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea2da97773d858001f98adc880f24b9671c51b2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 3 16:47:14 2013 +0000

    sna: Convert allocation request from bytes to num_pages when shrinking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2bd6e4dcd43bb0d836f12232050e73ce1510bb0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 3 16:38:33 2013 +0000

    sna: Add a pair of asserts to validate fls()/cache_bucket()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9d2730974a869f15eac599ca865b50a9a9658d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 3 15:20:45 2013 +0000

    sna: Also recognise __i386__ for fls asm
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69dde74a003ba0168ceca1558a4cb69097421b92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 3 15:20:23 2013 +0000

    sna: Fix off-by-one in C version of fls
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc702cdf534a4694a64408428e8933497a7fc06e
Author: Matt Turner <mattst88@gmail.com>
Date:   Wed Jan 2 16:07:54 2013 +0000

    sna: Rewrite __fls without dependence upon x86 assembly
    
    The asm() prevents SNA from compiling on ia64.
    
    Fixes https://bugs.gentoo.org/show_bug.cgi?id=448570

commit bc67bdcec832f4302951f2789456666dee2f496c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 2 13:47:51 2013 +0000

    sna/gen6+: Fine tune placement of DRI copies
    
    Avoid offsetting the overhead of the render copy only to be penalised by
    the overhead of the semaphore. So compromise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2559cfcc4cbc1d0d84b048565cad3bfee61df8da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 2 10:22:14 2013 +0000

    sna/gen4+: Specialise linear vertex emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0996ed85fd8bd79f41f28908733b85566f9e2b69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 22:53:26 2013 +0000

    sna/gen2+: Precompute the affine transformation scale factors
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d36cae801f1dcb06d4f93f2f27cc9b9de73e89c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 21:03:06 2013 +0000

    sna/gen4+: Tidy special handling of 2s2s vertex elements
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8582c6f0bbe1bf01324b46933ff2f50c65f2a82d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 20:53:12 2013 +0000

    sna/gen6+: Remove vestigial CC viewport state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24264af2912f9abae5aff2a6fb5a50383d9e33be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 20:39:23 2013 +0000

    sna: Fast path inplace addition of solid trapezoids
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9a9f9b02978cb2d73c38163827eb7141ebed16c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 16:40:28 2013 +0000

    sna: Micro-optimise glyph_valid()
    
    Note that this requires fixing up the glyph->info if the xserver didn't
    create a GlyphPicture.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 372c14aae8f4fd2c5865b9d23cd825dcbc33765f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 15:49:12 2013 +0000

    sna: Remove some obsolete Options
    
    Throttling and delayed-flush are now redundant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65924da91da4bb617df1bb0a7c3e9d4aa475b6b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 11:40:15 2013 +0000

    sna: Tidy compat interfaces
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a35d9287397031c95ebd9dc53b68e33e7dcf092
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 11:12:02 2013 +0000

    sna/gen2: Always try to use the BLT pipeline first
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1457fbd8a169ee19c8e625ea4e779180eb4b070
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 1 10:49:27 2013 +0000

    sna/gen2: Tidy a pair of vertex emitters
    
    Switch to the new inline scaled transforms.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48a5797c0f227204d0723de0ef34b046964c571e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 31 17:30:40 2012 +0000

    sna/gen4: Tweak single-thread SF w/a for solids
    
    Allow multiple threads for the rare case of compositing with a solid
    color.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4f6ba6b47c41645a40e314f14047ba0b5f93a01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 31 14:06:36 2012 +0000

    sna/gen6+: Hint that we prefer to use the BLT with uncached scanouts
    
    Once again balancing the trade-off of faster smaller copies with the BLT
    versus the faster larger copies the RENDER ring.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e87e7ddfe0c21e0fb6b3c2cb940a40aa7d4e061
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 31 14:03:16 2012 +0000

    sna/dri: Use the default choice of backend for copying the region
    
    Notably, if everything is idle, using the BLT is a win as we can emit
    them so much faster than a rendercopy, and as the target is uncached we
    do not benefit as much from the rendercache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7988bf77f5a106a48b6e39b6eaf60ef2f8bec11
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 30 14:50:49 2012 +0000

    sna/dri: Fix triple buffering to not penalise missed frames
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 736b89504a32239a0c7dfb5961c1b8292dd744bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 30 10:32:18 2012 +0000

    uxa: Align surface allocations to even tile rows
    
    Align surface sizes to an even number of tile rows to cater for sampler
    prefetch. If we read beyond the last page we may catch the PTE in a
    state of flux and trigger a GPU hang. Also detected by enabling invalid
    PTE access checking.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56916
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55984
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43336c632beb5d599ec0fc614434b88ef7a26422
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 29 16:47:53 2012 +0000

    sna: Seed the solid color cache with an invalid value to prevent false hits
    
    After flushing, we *do* need to make sure we cannot hit a false lookup
    via the last cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6050382095c3bc4f78bc4ff9e9c6086e58d6b28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 29 16:41:03 2012 +0000

    sna/dri: Gracefully handle failures from pageflip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c2ece369177ea6c3fd2f254b2554ceadf5590de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 29 15:53:23 2012 +0000

    sna/gen4+: Try using the BLT before doing a tiled copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09ca8feb3455c979e799ddf26daae8f2de2813e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 29 15:42:02 2012 +0000

    sna: Move the primary color cache into the alpha cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c56c9b1da9e078bd5b7ff4ebc5d8b23f593d500
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 29 14:14:41 2012 +0000

    sna: Allow a flush to occur before batching a flush-bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f53fb389c001f68134f514e30e25e91de41fb9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 22:58:02 2012 +0000

    sna: DBG compile fixes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dba83dacd2ccbb2ac23b205ce2a872a889fa30bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 19:23:36 2012 +0000

    sna/gen3: Use inline transform+scale function
    
    So as to avoid reading back from the vbo (which may be wc mapped).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0fca544b0602bc4ed2f68e8d260e0a3745b4bad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 18:52:44 2012 +0000

    sna/gen4+: Check for a spare exec slot for an outstanding vbo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6e850b626f4bb44876c683d596ea38f8f6c30ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 17:14:52 2012 +0000

    sna/gen4+: Trim an extraneous coordinate from solid composite emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fdc9923447538ed65bf9ffa189d7290ce804730
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 17:14:52 2012 +0000

    sna/gen4+: Trim an extraneous coordinate from solid span emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fdd6d222bc92b3e385f5d62f5e03dfd86f290e45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 17:08:00 2012 +0000

    sna/gen4+: Tidy emit_spans_affine()
    
    gcc produced abysmal code for the inlined emission, so hand unroll it
    for sanity.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d222d4d21e6e3af5316728e0da49a014e9fea21
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 17:08:00 2012 +0000

    sna/gen4+: Tidy emit_spans_solid()
    
    gcc produced abysmal code for the inlined emission, so hand unroll it
    for sanity.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4528f68eff33a5c2f9c1d884e9b3f7228053e0f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 16:45:50 2012 +0000

    sna: Only allocate a busy CPU bo for a GPU readback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99fdd1a1c6aa52688c2c821a90f86700b7ee34b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 16:33:59 2012 +0000

    sna: Mark kgem_bo_retire() as static
    
    The exported function is not used, so mark it static and strengthen the
    assertions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 548d284b8cf8cc2b311efe3287e0ae956738189a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 28 14:49:38 2012 +0000

    sna: Skip copying fbcon if we are already on the scanout
    
    If we are already the scanout, then there is little point copying to
    ourselves... Should be paranoia.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 583efd4ba067a0a4319e43ebc18dd81ed9c8db0a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 27 17:59:59 2012 +0000

    sna: Sanity check config->compat_output
    
    In a headless setup this may be left initialised to -1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7725df8aa1b3eab97618311e3f24769a318bd804
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 27 14:01:59 2012 +0000

    sna/gen2,3: Remove gen-specific vertex_offset
    
    Remove the duplication of vertex_offset in favour of the common
    vertex_offset.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46af1ff126f3fb1f9470b0cbb19c7c2b09d5b92a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 27 00:40:08 2012 +0000

    sna/gen6+: Tidy up ring preferences
    
    Remove a few duplicated tests.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd5b653aa2c5fe2e062533db35c83a40c1952ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 27 09:54:35 2012 +0000

    sna: Do not try and set a 0x0 mode
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 861c2362dd38d7d43fe7ffb181cb197199a1c570
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 26 14:12:42 2012 +0000

    sna/gen6+: Tweak to only consider active ring on destination
    
    Otherwise we decide to use BLT when hitting the render/sampler cache
    is preferrable for a source bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9b6aa3aaf784f9149e091a646673ddf341cd7ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 26 13:05:52 2012 +0000

    sna: Explicitly track self-relocation entries
    
    Avoid having to walk the full relocation array for the few entries that
    need to be updated for the batch buffer offset.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90b1b220ee7a3c543301956b01c54a4a04632db4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 26 12:51:58 2012 +0000

    2.20.17 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52fd223fc970118cbdcb31f9574414debc905e9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 21:36:30 2012 +0000

    sna/video: Initialise alignment for video ports > 0
    
    We repeatedly set the alignment value on the first port, rather than
    once for each.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3793ccf7804cfc870b46c623dfeefbe0c381c1d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 14:48:07 2012 +0000

    sna: Remove assertions that the pixmap is wholly defined when uploading
    
    As the user may only write to a portion of a pixmap (thus only creating
    a small amount of damage) and then attempt to use the whole as a source,
    we run the risk of triggering an assertion that the whole was defined.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07dde33a4f51941b4f612823ea6ea7ca01a6efbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 14:35:32 2012 +0000

    sna: Remove a pair of stale assertions
    
    For gen2-5, it does not matter what mode the batch is in when we
    insert the scanline wait. With the more aggressive batch flushing, and
    relaxed assigned of mode for those generations, we are likely to see
    that the batch is idle when we go to insert the waits.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bdd0cca4e1192df0038621925c4e6243ba419a81
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 14:20:23 2012 +0000

    sna: Refactor test for a rotation matrix
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 347c5a7b33729f1bedd408d2ef24756d51b66f1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 10:40:47 2012 +0000

    sna/dri: Refactor get_current_msc between blit/flip paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a67d3f808fcc7c8c51553b1703e8312f28b87a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 10:21:06 2012 +0000

    sna/dri: Set the correct current_msc for the no readback path
    
    If we are asked to render immediately, then in order to pass the tests
    when comparing it to target, we need to set the current_msc to the
    ultimate future value, -1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48e4dc4bd4b2980f0f804f572d0e3fc1bb4bc21e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 21:54:25 2012 +0000

    sna/gen4: Backport tight vertex packing of renderblits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08d2b073692836aa22f65f8ba30db5d14550c03e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 21:30:32 2012 +0000

    sna/gen4: Backport more recent state tracking tweaks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ff76fad1fadc5e309f9a12c30f883460a432049
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 20:57:40 2012 +0000

    sna/gen5: Backport tight vertex packing for simple renderblits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9144c951915a1e0c1899a72161f9f0f1ab9b9ac4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 21 09:44:52 2012 +0000

    sna/dri: Avoid querying the current-msc with swapbbufers wait disabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84c327e17f68c4a56fcb76be1f45ab6d35291b5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 19:44:46 2012 +0000

    sna/video: Assert that the frame is initialised
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d750219925cb3199ebc6751cdbd2862dfb4cdfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 19:34:41 2012 +0000

    uxa/dri: Correct the destination of the blit after chained flip is broken
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca5c028c2b4d9bf02002acd484054fe427ea8d09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 19:31:44 2012 +0000

    glamor: Release the drawable after passing to glamor_push_pixels
    
    An unlikely path, but a double prepare instead of a prepare/finish.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de2de36049e2958a60f63fadffe8f54de8da1e56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 19:29:31 2012 +0000

    sna: Check the correct variable for a failed allocation
    
    Having already checked 'dst' and just allocated 'src', that is who we
    should be checking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit deb908fda74541fba649349db279715b05d0554e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 19:22:32 2012 +0000

    intel: ODEV_ATTRIB_PATH is no longer printed, so kill the temporary variable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f84ecfc3cd7dfe7f43ff99a6498d2ceccd90225
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 12:00:00 2012 +0000

    sna/gen4+: Amalgamate all the gen4-7 vertex buffer emission
    
    Having reduced all the vb code for these generations to the same set of
    routines, we can refactor them into a single set of functions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f4ede0ef8f8a8d07e11781ad05617ecdfcd3faf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 19 20:39:10 2012 +0000

    sna: Do not throttle before move-to-cpu
    
    The idea being that when creating a surface to perform inplace
    rasterisation, we won't be using the GPU for a while and so give it time
    to naturally throttle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5deba2832dc42072d9abaeaa7934bc0e1b28b3ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 19 20:03:33 2012 +0000

    sna: Ignore throttling during vertex close
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f91a24fdba517c8e9df5a074db2c789fbf066bb3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 20 09:46:32 2012 +0000

    sna/video: Remove XvMCScreenInitProc
    
    The symbols disappears without warning in xorg-1.14
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=58552
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee99511846a0f10abeeba8d25d8fb5bf59621b02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 19 18:02:50 2012 +0000

    sna/gen4+: Tweak preference of GPU placement for spans
    
    If the CPU bo is busy, make sure we do not stall for an inplace
    operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfd96b092db5e4e0fc2446752deafd1156cf37b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 20:54:33 2012 +0000

    sna/video: Fix presentation of cropped sprites
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2df1b1abf0728f28d2803a096f945779cbe7c70b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 16:07:26 2012 +0000

    sna/video: Fix up copying cropped textured video packed data
    
    Simply ignore the cropping and copy the whole plane rather than
    complicate the computation of the packed destination pixels.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d523fa824dcb1987557164d048711c1745de378
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 16:07:26 2012 +0000

    sna/video: Fix up destination offset for copying cropped textured video planes
    
    Oh fun. Textured video expects the source content to be relative to the
    origin, whereas overlay video expects the source at the origin.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bb4573fcc2cf1b8b6bff5d885a2fa81200d2fd7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 15:48:21 2012 +0000

    sna/video: Fix up the image size for copying
    
    Yikes, setting image.x2 == image.x1 meant no data was copied whilst the
    video was clipped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 551b400377ddc5eb1e89b8b5827a42e810c8d23d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 15:14:00 2012 +0000

    sna/video: Amalgamate the computation of source vs dest offsets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d96a226cc59c641c10153ae3a086a5138c852423
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 14:26:18 2012 +0000

    sna/video: Fix adjustment of drawable vs source origin wrt to clip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79cb6304e983514dd754065e65e2381a903f9bd6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 13:49:59 2012 +0000

    sna/xvmc: Clean up to avoid crash'n'burn
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d26082303f3f4006ce4974d402c560613081b23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 10:54:28 2012 +0000

    sna: Prefer the GPU once again for PolyPoint
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e0a2d300633122d6d0f6f82ff110f513b4e64d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 18 10:27:04 2012 +0000

    sna/gen7: Mark the ring switch before checking bo
    
    As we may do a batch submission due to the change of mode.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f522fbe7c98ffad86126c3666b2d9f7e616480b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 23:04:25 2012 +0000

    sna: Refine check for an unset context switch
    
    So it appears that we end up performing a context switch on an empty
    batch, but already has a mode. This is caught later, too late, by
    assertions. However, we can change the guards slightly to prevent those
    assertions without altering the code too greatly. And I can then think
    how to detect where we are setting a mode on the batch but doing no
    work - which is likely masking a bigger bug.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c50cf4809816dbbd93d54f589a79b0dab996180
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 22:27:14 2012 +0000

    sna: Untangle the confusion of caching large LLC bo
    
    We only use a single cache for very large buffers, so we need to be
    careful that we set the tiling on them. More so, we need to take extra
    care when allocating large CPU bo from that cache to be sure that they
    are untiled and the flags are true.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e474abea7cf761e78e777db07b41ec99c0b6f59f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 15:38:04 2012 +0000

    sna: Promote pinned-batches to run-time detection
    
    Now that the feature has been committed upstream, we can rely on the
    runtime detection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d7e3a9123cf41d2dd97c0a8a0d461c189064822
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 12:34:05 2012 +0000

    uxa: Fix copy'n'paste of false not FALSE
    
    Bugzilla; https://bugs.freedesktop.org/show_bug.cgi?id=58406
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a4d1136bd09bfd4d2657c0b1b64d553eeb6ed4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 09:41:47 2012 +0000

    sna/video: Pass along the video source offset
    
    Fortunately nobody had yet noticed that all videos were assumed to play
    with a matching src/dst origin.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfe9d18f9f97a77ceeb410307010424c789c8bd1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 17 01:06:57 2012 +0000

    sna: Limit the default upload buffer size to half the cpu cache
    
    This seems to help with small slow caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b0572503eab235bc7eff20d369241330c41e630
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 23:04:55 2012 +0000

    sna: Enable support for opting out of the kernel CS workaround
    
    Keeping a set of pinned batches in userspace is considerably faster as
    we can avoid the blit overhead. However, combining the two approaches
    yields even greater performance, as fast as without either w/a, and yet
    stable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 805f78addf3ffb36c736df680806cf722b18fea9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 22:04:54 2012 +0000

    sna: Try to reuse pinned batches by inspecting the kernel busy status
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1aec676810c4a4c180b342d9a83254e08dd55da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 17:37:32 2012 +0000

    sna: Precompute the base set of batch-flags
    
    This is to make it easier to extend in future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7ac12003bd0c7d85fa47d43ee2734b222d84a61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 15:28:24 2012 +0000

    sna: Only flush at the low fence wm if idle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4580bbeac0051417cb03f272112b0cfe697e31b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 15:00:21 2012 +0000

    intel: Support debugging through AccelMethod
    
    Ease debugging by allowing all acceleration or render acceleration to be
    disabled through AccelMethod:
    
    Option "AccelMethod" "off" -> disable all acceleration
    Option "AccelMethod" "blt" -> disable render acceleration (only use BLT)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58770b7d6401d2d81f7fee1c8c0e788d44149712
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 14:59:03 2012 +0000

    man: Describe Option "AccelMethod"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83609af3681fad58af88387077bf7ce0c001a1da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 16 10:53:26 2012 +0000

    sna: Tweak the idle SHM CopyArea path to also replace a busy GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6490585f65bde487da7bc41fa5cb1c5a028d0bf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 23:26:30 2012 +0000

    sna: Do not force use of the GPU for a copy from a SHM pixmap
    
    As we will undoubtably flush and sync upon the SHM request very shortly
    afterwards, we only want to use the GPU for the SHM upload iff it is
    currently busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a08f091875f2f0f49697ba9852077094b3a704b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 22:53:44 2012 +0000

    sna/gen6+: Tweak prefer-blt-bo
    
    Split the decision between where it is imperative to use the BLT to
    avoid TLB misses and the second case where it is merely preferential to
    witch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac9ef1fc606e87b48baa47be22bf828dcfe6659f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 20:49:56 2012 +0000

    sna/gen6+: Keep the bo on its current ring
    
    Track the most recent ring each bo is executed on, and prefer to keep it
    on that ring for the next operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15ccb7148d15d776a661c1b8c5b9b2360fcae4ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 20:07:56 2012 +0000

    sna/gen6+: Apply the is_scanout to the key not value in the binding cache
    
    Oops, we never managed to reuse the cached location of the target
    surface as we entered it into the cache with the wrong key.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fde25b08922d97ca0d4a69c654bf690edbd53b3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 18:59:53 2012 +0000

    sna/trapezoids: Add another inline hint
    
    cell_list_alloc() is only called from one place, and the compiler should
    already be inlining it - but does not appear to be. Hint harder.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a21c8b351052be9c32c5669264fb05a8510c957
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 17:56:27 2012 +0000

    sna: Include shm hint in render placement
    
    The goal is to reduce the preference of rendering to a SHM pixmap - only
    if it is already active, will we consider continuing to use it on the
    GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a467102a9539c7f4fa8d0700ecdcaba49d77b3f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 10:00:48 2012 +0000

    2.20.16 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0f8c823b6cafdfdd064c09d58174f946e290541
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 09:28:04 2012 +0000

    sna/dri: Fallback to a blit after a failed flip
    
    ...rather than force the exchange.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c71a8e08abce74b269687d3a6c1edd7f9d643d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 15 09:27:07 2012 +0000

    sna/dri: Honour TripleBuffer Option
    
    In case anyone ever wants to disable the default.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6593ad3fecb3d044ee5ca161176d8ecaa0b4126a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 14 23:48:00 2012 +0000

    sna/dri: Store and check size of front/back bo attached to a DRI2 drawable
    
    So that we can prevent feeding back a stale bo when the DRI2 client
    tries to swap an old buffer.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57212
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9df9585cb00958b42461b3139bb7aec32090a869
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 14 15:37:56 2012 +0000

    sna: Reduce fence watermarks
    
    Further restrict the amount of fenced bo we try to fit into the batch to
    make it easier for the kernel to accommodate the request.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d3ba44e448c152a570cc469d289ab057fa7be5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 14 12:47:46 2012 +0000

    sna/gen2+: Experiment with not forcing migration to GPU after CPU rasterisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d867fd01cb0060342102a79600daf43e3dc44a07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 14 13:10:54 2012 +0000

    sna/gen3: Don't combine primitives if beginning a ca 2-pass
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ca503dac2ea6c036e7ebe878b41923541daf225
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 14 12:49:14 2012 +0000

    sna/gen3: Remove stray setting of vertex_start
    
    It is always done at the beginning of vertex emission.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f76f100e8033497620ee46548df45afff41064a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 23:12:42 2012 +0000

    sna/gen2: Reorder reuse_source() to avoid NULL dereference for solids
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 044a54c23384756a5dc1895473abf34f7abb3d83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 23:05:30 2012 +0000

    sna/gen2: Initialise channel->is_affine for solid
    
    In case we hit a path were we avoid reusing the source for the mask and
    leave is_affine unset for a solid mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29afd0dc8e893cc4110ee0d70546775dae86ddb3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 22:53:18 2012 +0000

    sna/gen2: Assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d2abe1e3daac74747535d88dff34b024b87bbe9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 22:09:37 2012 +0000

    sna/gen3: Remove incorrect optimisation of an opaque source for CA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d428dbf7ad7c246acb1c301b73b9df4a1309de03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 14:53:50 2012 +0000

    sna/gen2: Program solid mask using the DIFFUSE component
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e7311516da81ab45484b291ec668503c5ded0bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 14:40:25 2012 +0000

    sna/gen2: Align surface sizes to an even tile
    
    Makes this 855gm much happier.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e646047a563598948206167765eaaf4192cfd77f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 14:23:54 2012 +0000

    sna: Fix up BLT overwrite detection to use target_handle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f96439e39a4bf4b127af9ccfdc09d061caff9bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 13:15:52 2012 +0000

    sna: Fix typo for 830/845 gen
    
    Must remember, its octal not decimal.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f631a56bcb3ff1ce1942b828325a157cef1e0880
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 13 00:55:45 2012 +0000

    sna: Only flush the batch after an actual relocation
    
    As we may write preparatory instructions into the batch before checking
    for a flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74bbf20e6e652cba55d6d0bc17066f4112f8548c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 21:56:22 2012 +0000

    sna: Improve the initialisation failure path for pinned batches
    
    Simplify the later checks by always populating the lists with a single,
    albeit unpinned, bo in the case we fail to create pinned batches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52c8c9218c8f28fb049b02214d833912a803f911
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 21:19:02 2012 +0000

    sna: Fix the error path in kgem_init_pinned_batches() to use the right iter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7f7dd61fd07dbf938fc6ba711de07986d35ce1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 19:43:19 2012 +0000

    sna: Pin some batches to avoid CS incoherence on 830/845
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=26345
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b154d0dc404a152e1283a013a78be06b8d734867
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 18:34:54 2012 +0000

    sna/gen2: STIPPLE requires an argument
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9001263b32efde1361555432914d9ac3ee780511
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 12:03:40 2012 +0000

    sna/gen3+: Use nearest for unscaled videos
    
    If the output is unscaled, then we do not require pixel interpolation
    (and planar formats are exactly subsampled).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=58185
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2dbe7d91a7f15a3a9ddad696c5088ca98898fca2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 12 09:50:34 2012 +0000

    sna/gen4: Use the single-threaded SF w/a for spans as well
    
    Fixes the flickering seen in the fishtank demo, for example.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2502218a9340044bb660be68f059971119077e29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 11 17:47:09 2012 +0000

    sna/dri: Fix handling of current_msc > target_msc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39d6c65f437d7877c1647b7ecf45e76daabc76a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 11 15:30:54 2012 +0000

    sna/dri: Query current msc before use
    
    Might be worth caching the last-known-value so we can skip the query for
    an old swap request.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 162e9a2bfc693db186aa481551cf76b3dc5ee55c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 23:11:48 2012 +0000

    sna/dri: Disable name exchanges for SwapBuffers
    
    The DRI2 protocol is inherently racy. Fortuituously, this can be swept
    under the carpet by forcing the serialisation between the DRI2 clients
    by using a blit for the SwapBuffers.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=58005
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c2287c735f990a98b39d00f28168d7a5df25aba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 20:09:22 2012 +0000

    sna/dri: Only special case 'divisor && msc-passed' for immediate flipping
    
    As Jesse pointed out, it is legal for the client to request that the
    flip be some frame in the future even with no divisor.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ab29a1688cd313768d928e87e145570f35b4a70
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Dec 10 14:55:32 2012 -0800

    dri2: don't schedule a flip prematurely at ScheduleSwap time
    
    If divisor is 0 but the current MSC is behind the target, we shouldn't
    schedule a flip (which will occur at the next vblank) or we'll end up
    displaying it early and returning the wrong timestamp.
    
    Preserve the optimization though by allowing us to schedule a flip if
    both the divisor is 0 and the current MSC is equal to or ahead of the
    target; this avoids a round trip through the kernel.
    
    Reported-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 986e13a56a8544d5b32dbcaacbc0ee9cf5d47e27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 17:29:08 2012 +0000

    sna: Try installing a fallback config on VT enter in case full desiredMode fails
    
    This can happen naturally for 3-pipe config on Ivybridge or if the
    outputs are rearranged whilst we slept. Instead of failing to change the
    display on the VT, install at least a fb on the CompatOutput so that
    hopefully the DE can take over, or give some control to the user.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c3b82f207bc8cf697646d3324cb4103da3b7856
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 16:20:52 2012 +0000

    sna: Avoid reusing the same 'busy' bit for two different meanings.
    
    Oops, I thought the 'busy' bit was now used and apparently forgot it is
    used to control the periodic flushing...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1b479a3404e6b52a23e0443c36d0682cbaf3c2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 11:16:04 2012 +0000

    sna: Compromise and only flush a split batch if writing to scanout
    
    A compromise between not flushing quick enough and flushing too often,
    hopefully.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e9120d73c6f0c0e06b617da91cc2edce4434bc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 10 11:05:16 2012 +0000

    sna: Immediately flush a split batch
    
    If we submit a batch early (for example if the GPU is idle), then submit
    whatever else the client drew immediately upon completion of its
    blockhandler. This is required to prevent flashing due to visible delay
    between the clear at the start of the cycle and then the overdraw later.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51718
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa8c5d8201006397bb32ed6bc28618f9aa77a68a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 22:08:08 2012 +0000

    sna/sprite: Add a DBG to report whether the kernel supports sprites
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25c0d440dee45c03f5e45b8e0e45071c0c32f507
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 9 12:11:53 2012 +0000

    sna: Move source to CPU prior to referencing for inplace trapezoids
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56825
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e82fcc8d243b7ffe1a3d3249a5cdb5fd068093f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 9 11:19:13 2012 +0000

    sna/gen4+: Refine test for preferring GPU spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8f622726a4463b419d032b379576cfb3bc492df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 9 09:26:03 2012 +0000

    sna: Replace remaining kgem_is_idle() with kgem_ring_is_idle()
    
    Further experimentation...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e4e10935d2815fb62aeaedbfffe10aad115ec0b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 8 22:39:32 2012 +0000

    sna: Flush upon change of target if GPU is idle
    
    The aim is to improve GPU concurrency by keeping it busy. The possible
    complication is that we incur more overhead due to small batches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cef11795f627a393d4254845b0a19eefbf6c782c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 7 17:40:37 2012 +0000

    sna: Convert the ring from BLT/3D to the internal index for kgem_ring_is_idle()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52405b2aed492dc7f76fbf082122842f621e7c06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 7 17:24:42 2012 +0000

    sna: Only inspect the target ring for busyness
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b7bbb2a23b03bac63f864c33f47fab88dedbf67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 7 16:43:32 2012 +0000

    sna: Only flush before adding fresh surfaces to the batch
    
    Previously, before every operation we would look to see if the GPU was
    idle and we were running under a DRI compositor. If the GPU was idle, we
    would flush the batch in the hope that we reduce the cost of the context
    switch and copy from the compositor (by completing the work earlier).
    However, we would complete the work far too earlier and as a result
    would need to flush the batch before every single operation resulting in
    extra overhead and reduced performance. For example, the gtkperf
    circles benchmark under gnome-shell/compiz would be 2x slower on
    Ivybridge.
    
    Reported-by: Michael Larabel <michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65a8c23ca1bc8e2ebd087027a30358704d4bf11c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 7 14:56:18 2012 +0000

    sna: Only flush at the low apeture watermark if idle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4bfc5e90f54be1b0997dec9e81796d67b376a01f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 8 23:42:10 2012 +0000

    sna: Mark proxies as dirty on first relocation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d2fa5731b7ecfe34a8af809e45bcd3b0b70c890
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 22:15:09 2012 +0000

    Remove the default log message
    
    Breaks compilation with xorg-1.13
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f4d4afa629bd18be89d7270e6178a865cf9586e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 17:08:15 2012 +0000

    Fix compilation of UMS probe following 13f47008ec
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d733f7d1f1dc343ac34c4a27ac99d71fc0572bc2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 16:55:00 2012 +0000

    sna/gen4+: Add common glyph-to-dst emitters
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13f47008ec411609968c40b8ec34dd495f14c50b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 6 14:05:33 2012 +0000

    Refactor the common probe methods for scrn construction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0040eb84c9187476a75202ebb251dd74354e4fc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 5 09:25:17 2012 +0000

    sna: Don't disable CPU bo if supported on unknown hw
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 14069f48645867a735ebdccb1e27a62364643c38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 5 09:24:02 2012 +0000

    sna: Assume that future hardware only gets more flexible
    
    E.g. that BLT can always write to cacheable memory, inflexible fences
    are a thing of the past, etc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b82bfcb54a6af0d1ee17806ef94d9da504cad606
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 4 17:26:47 2012 +0000

    sna/gen6+: Cache the scanout targets separately to avoid override PTE caching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 626dd1324dd2c5b14ca4aff598b5eb1e45550e69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 4 12:52:50 2012 +0000

    sna/gen4: Workaround render corruption with multiple SF threads
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57410
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbdb8fabfbade3f19fd8af3524468b5e6668bb66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 4 12:37:23 2012 +0000

    sna/gen4: Special case solids through the general vertex emitter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a17354d5ce6aeeab3f6e42aba63fce06ad18c526
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 4 12:01:26 2012 +0000

    sna/gen4: Remove unused CC viewport
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9afb9cb614d2ad44330eed03b3f577a35184a88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 4 11:14:58 2012 +0000

    sna/gen4: Avoid emitting URB_FENCE across a cache-line
    
    Old erratum.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08c30c48bdd0db500498bd9617c15f37bacd8de9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 3 13:23:33 2012 +0000

    sna: Tidy addition of fake GTF modes for panels
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f675eeaeade4728af566891b2afbe5b44fbdc2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 3 10:47:35 2012 +0000

    2.20.15 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37eb7343be1aeeb90a860096756603a577df1a77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 1 09:40:11 2012 +0000

    sna/gen5: Inspired by gen4, reorder the flushing
    
    This may not be totally safe, but it is a nicer explanation for random
    single character corruption.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8a99428c14c8aed2082853cc60d0f98a1fa2d86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 1 09:44:49 2012 +0000

    sna/dri: Unknown generations are given the max value and presume i965_dri.so
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 382bb7bf77fca412fdefd7c304f395d1fe9483b5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 16:24:30 2012 +0000

    sna/gen6+: Only apply the BLT w/a for self-copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1aee8acacfe5869a072d9f20f3b8290b16683260
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 12:17:25 2012 +0000

    sna: Unify gen4 acceleration again
    
    After disabling render-to-Y, 965g seems just as happy with the new code
    paths as g4x.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d6dd9c5a7eeb1f879525430ad89ab74d427e469
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 12:12:49 2012 +0000

    Convert generation counter to octal
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 131600020638ef15166361214cd5e1a0c08c2ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 11:43:56 2012 +0000

    sna: Prevent gen4 from rendering to I915_TILING_Y
    
    It always seems to end up in a hang...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee4d1873ff504c2150b51d13864164b02b85dd53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 09:52:49 2012 +0000

    sna/g4x: And remove one more flush point
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b6c1a30723b1d13e9bd3df0b59a8d75639c89be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 09:27:57 2012 +0000

    sna: Increase tiling alignment to an even tile
    
    Seems to help g4x.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6aeb6fdf75fa322d8f5ffe393337d8195d7a6a62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 30 09:03:53 2012 +0000

    sna/g4x: Remove the flush before the pipelined pointer changes
    
    This one appears unneeded. Hopefully.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8be2c6695509809c0ab0c5c014e11dc733f73006
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 29 19:56:15 2012 +0000

    sna/g4x: Emit the flush prior to changing pipelined state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d5d55702bb8eced32d5b8cb3c0cd125fd99d6dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 28 15:46:29 2012 +0000

    sna/gen6+: Override PTE cacheability bits for reads
    
    This is primarily useful for enabling the render cache for reads from
    scanouts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ed87945c9e83fefcbda053b616856658bf2ac8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 28 11:05:40 2012 +0000

    sna/gen5+: Disable max-vbo address
    
    As we do not use this feature, disable it and save the relocation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2c9e9da639a134577485f83e0f66f54e2371b98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 27 11:32:11 2012 +0000

    sna/blt: Avoid clobbering common state before converting to a BLT
    
    In case we need to continue on with the render operation, we need to
    preserve the existing state.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=57601
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e06d19a00f5a5a05369deeb3c5ae15b282c0f92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 26 15:30:09 2012 +0000

    sna: Disable shadow tracking upon regen
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56608
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52255
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d21ed3a6aba5ae227cc5ecd164f3c18bc48c69af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 26 10:34:28 2012 +0000

    sna: Use a single execobject flag to mark read/write domains
    
    Slight modification to the proposed API to only pass the simplified
    domain tracking now performed by the kernel.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a904ce839933d57176e013cdad147533c33ca2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 26 08:48:31 2012 +0000

    2.20.14 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1367e3f9ef5f606c8927cbde441a2ea41fa6d025
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 25 00:24:45 2012 +0000

    sna: Exploit the alpha-fixup of the BLT for texture format conversions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d6399f97cf7cb91dcf89e9a5cd1243f761e4314
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 25 00:05:44 2012 +0000

    sna: Transform a simple repeat pattern into range of the BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39f1e228b74e98d3d87157cf093fc56ca31e6b13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 24 20:16:29 2012 +0000

    sna: Make GPU idle more consistent during wakeup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40b6121746c55153de444ccb753df80706ff3a69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 18:21:41 2012 +0000

    sna/g4x: Refine the w/a for the broken sf shader
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0b906b09697b5fe7a5be2fdc52abd9b1c73f96d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 18:01:25 2012 +0000

    sna/g4x: Use the render pipeline more often for composite operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54d8968da5ae39bfbcad511322926931bce2bda3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 17:47:49 2012 +0000

    sna/gen4: Revert changes to 965g[m]
    
    The changes tested on g45/gm45 prove to be highly unstable on 965gm,
    suggesting a radical difference in the nature of the bugs between the
    two generations. In theory, g4x has additional features that could be
    exploited over and above gen4 which may prove interesting in the future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d560296561f68c3ac841345c0f4ce2c8e7381156
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 16:35:06 2012 +0000

    sna/gen4: Don't force a flush for the dirty target if the we do not read back
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4023b2044757a9a67d564be0c8adf4885973a6e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 15:42:18 2012 +0000

    sna/gen4: Force composite(WHITE, glyph) for building the glyphstring mask
    
    For reasons that are not apparent, if we don't composite with
    source/mask for the glyph strings, there appears to be some cache
    corruption. About as bizarre as the rest of gen4 idiosynacracies.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f74b62755c6e41097c23cc506984859e556a3415
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 14:59:42 2012 +0000

    sna/gen4: Set composite op before testing for a BLT compatible op
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c922eb52cadb867a0a15929e5a214c84a5992f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 14:19:59 2012 +0000

    sna/gen4: Pass the mask channel explicitly rather than through a dummy mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e68efa8ec66b4c89e9816bfa15067b398da5e3e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 14:04:51 2012 +0000

    sna/gen4: Reduce the flush before performing the CA pass
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43aff6708fe97aa2fae0e30f98fc7cd9d7311b75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 13:37:44 2012 +0000

    sna/gen4: Update render fill routines to use the dummy mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 352910712266202ef017066891ec383fd037fc4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 13:29:01 2012 +0000

    sna/gen4: Move the flush from inside the spans to emit_state()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 217f3e835b99002669999f818afa0d5c3a1cc852
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 12:32:14 2012 +0000

    sna/gen4: Backport the more efficient composite box emitters
    
    Now that we aren't flushing after every single rectangle, we can strive
    for a little efficiency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3145e3f8146e7d864d32aec49c44c04d619e56a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 23 12:28:21 2012 +0000

    sna/gen4: Use a dummy white mask to avoid the flush w/a when compositing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65d530b59b957cc5f303ae819baad8075a555ac0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 22 08:18:38 2012 +0000

    Revert "uxa: Refactor early-exit paths of uxa_try_driver_composite()."
    
    This reverts commit fa5c573455cf63090dbb6d167d4e5f1cb23daf72 as it
    causes a SIGSEGV.
    
    Reported-by: lu hua <huax.lu@intel.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57389

commit d3a49f36395d737698616fe8ba9da7b74cd2d89a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 18:41:00 2012 +0000

    sna/gen3+: Clear the render.vbo when replacing it for vertex upload
    
    As we may trigger a flush and a retire when searching for a vertex
    buffer for the new vertices, we need to be careful to decouple the
    destroyed vbo in order to avoid a use-after-free when inspecting the
    state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c57a52a1f46e8401429955d8c96fd5095c9012a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 18:17:31 2012 +0000

    sna: Assert that we do not replace a GPU bo with a proxy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8da12a00ee653510e1f1a6fecb28dbb36faa8400
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 17:28:46 2012 +0000

    sna: Skip uploading unintialiased pixmap data
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0696ea4bd601ed823dbded03eaef6f316df2a5e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 17:25:33 2012 +0000

    sna: Add the missing assertion for !proxy
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee72375ecd4f6d6e756bc361fa512b6675309540
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 17:08:53 2012 +0000

    sna: Do not migrate uninitialised pixmaps
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44dad490140d85a4c0dcb916030c36a838670c01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 16:22:35 2012 +0000

    sna: Do not dispose of a shadow pixmap
    
    Fixes regression from 2249e9edc37811c07e2807d6b4def05585b44c22
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c627a05247690891062a2c0c1c8f7bbc0273104
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 16:03:02 2012 +0000

    sna: Remove the kgem_bo_is_mappable refcnt assertion from freed paths
    
    A few callers of kgem_bo_is_mappable operate on freed bo, and so need to
    avoid the assert(bo->refcnt).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0c48c7a5aca4d24936efbeaefc7674ada2ef87f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 14:46:45 2012 +0000

    sna: Add a few refcnt assertions
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0884777c33d20dbc329b98ad0db5ffb0df93ac8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 14:31:44 2012 +0000

    sna: Fix bogus assertion from 03fb9ded43
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2249e9edc37811c07e2807d6b4def05585b44c22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 13:05:36 2012 +0000

    sna: Dispose of local copy for render sources
    
    If we transfer the pixmap to the GPU to use as a render source, presume
    that we will not need to then touch the local copy (at least for a
    while) and so return that memory to the system.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 736bb0f7058bf05ef48cdfe6a30d880de817aff9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 21 12:16:46 2012 +0000

    sna: Tighten a couple of assertions for damage with use_bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03fb9ded43f9bf8b73f99d5b3a8dc592fe22b523
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 20 21:13:07 2012 +0000

    sna: Assert that we do not create a proxy with existent GPU damage
    
    References: http://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ab1d1f94e502e5fde87e7c171f3502f8a55f22b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 20 18:42:58 2012 +0000

    sna/dri: Queue a vblank-continuation after flip-completion
    
    If a vblank request was delayed due to a pending flip, we need to make
    sure that we then queue it after that flip or else progress ceases.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56423
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57156
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a7a76b359f73a4c4bcda0d88004f4dd5e94a186
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 20 16:05:32 2012 +0000

    sna/dri: Avoid a NULL dereference inside a DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa5c573455cf63090dbb6d167d4e5f1cb23daf72
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Nov 17 13:11:13 2012 -0800

    uxa: Refactor early-exit paths of uxa_try_driver_composite().
    
    Saves 200b of code at -O2.

commit edefb64d2b1c95b0b678cb222273ab64b2e6db2a
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Nov 17 13:11:12 2012 -0800

    uxa: Work around uninitialized-value warning.
    
    The compiler isn't noticing that localDst only diverges from pDst when
    the _copy variables have also been set.

commit 18b2e2a82724407196001ca853bd83150c66c5bd
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Nov 17 13:11:10 2012 -0800

    uxa: Add printf attribute to intel_debug_fallback().
    
    Shuts up a bunch of warnings with xorg's shared warning flags, and
    should give us more informative warnings in our code.

commit 2d1e267e662505ca0dd318765464a24739dc5bd8
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Nov 17 13:11:09 2012 -0800

    uxa/dri: Factor out the repeated swap fallback code.

commit cd2f373da7a14e004c999f9f0efaf88c785d3d3f
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Nov 17 13:11:08 2012 -0800

    configure.ac: Fix bad syntax for test calls

commit b8c01d9bd7ce5656706ebebd16e5a8c5ca0ba487
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 19 15:20:10 2012 +0000

    sna/dri: Add an assert that the cached DRI2 buffer is pinned for DRI
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84b1a02fa9fde02366e0384044526982e70d0e8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 19 13:41:28 2012 +0000

    sna/dri: Avoid setting off-delay after a failed flip (use-after-free)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4dd1103a55406bcd65f137c668701074a5c41b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 18 12:21:49 2012 +0000

    sna/gen6+: Tweak prefer-blt to offset latency when in rc6
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cb8544dc16d4c1e9ae7f1ee74ee26c7501a9ed7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 18 12:13:46 2012 +0000

    Remove useless indirection of intel_chipsets
    
    Once upon a time this was used to hide a compiler warning about a
    pointer mismatch, now the compiler still warns about the cast, making
    the indirect moot.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8509e474f57533fc6afcf213165f4c8633631fb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 16 23:02:44 2012 +0000

    sna/dri: Clear the last-used-cpu flag when performing CopyRegion
    
    Keeps the internal bookkeeping intact after the small bypass.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 866ed4a26cbbb29ef3845b0aa56383c4d951c65a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 15 15:13:14 2012 +0000

    sna/dri: Add a couple of more asserts to track injection of a rogue bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2897cb0136ffec83365c7530ed544b562cac478
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 13 12:43:44 2012 +0000

    sna/gen4,5: Fix the opacity shader to use the right vertex attribute
    
    Reported-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57054
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 440eaa049756e5266f3bd80e2751f1fd0d5f9890
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 13 12:42:58 2012 +0000

    sna/gen4: Tidy emission of opacity vertex attribute
    
    Just make it more consistent between the various emitters
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6d2bb961517623d46aa6944307cb998ee125459
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 13 10:05:56 2012 +0000

    sna/gen4: Do not prefer inplace non-rectilinear spans
    
    As gen4 requires the per-rectangle vertex flush, emitting spans on the
    GPU is inefficient and so we prefer to composite the mask instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae293609c7400cd3c753ed3762772264c4741df5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 13 10:21:29 2012 +0000

    sna/gen4: Always initialise redirect
    
    Do not assume the caller cleared the composite-op structure for us.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2954f15e2bcb590a90c2cb6077c0843ee25a4413
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 13 09:46:19 2012 +0000

    sna: Specialise the decision for inplace xor uploads
    
    Fixes a regression from
    
    commit 0be1d964713ca407f029278a8256d02d925dc9da
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Tue Sep 11 21:48:24 2012 +0100
    
        sna: Use inplace X tiling for LLC uploads
    
    which introduced the ability to swizzle into CPU maps, but also
    convinced the xorg path to the same - which for large images blows up.
    
    Reported-by: Michael Laß <bevan@bi-co.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=57031
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66eb0adffa63ef8ece7621ba90dc96af91549612
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 12 14:45:56 2012 +0000

    sna/dri: Apply the can_blit() check for CopyRegion
    
    CopyRegion() also needs to check for stale bo in case the pixmap
    dimensions have changed size and so may cause out-of-bounds read/writes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b27ecf3059bc066ef59f2a71c1d8d8f0ffec7191
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 12 14:06:06 2012 +0000

    sna/dri: Prevent scheduling a swap on stale buffers
    
    If the screen has been reconfigured and the DRI client tries to swap the
    old buffers (having not processed the invalidate event and retrieved the
    current names), quietly drop the request. If we try to obey the request,
    we will end up attaching a back buffer that is the wrong size to the
    scanout...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34aa1e3b2702a55799a5655a3ba10bce4cc2065a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 12 11:22:53 2012 +0000

    sna: Compile against ancient libdrm
    
    We need to trim the sprite video overlays if the prototypes are not
    known.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f1afde57dca27e6542b0b8e7c87750f3d6367bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 11 16:16:20 2012 +0000

    2.20.13 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b16219a19f48b52dda91f26fcbbbbeda056589ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 11 11:05:35 2012 +0000

    sna: Filter out the full-damage marker when undoing redirection
    
    ==25902== Invalid read of size 4
    ==25902==    at 0x4980E13: _list_del (intel_list.h:218)
    ==25902==    by 0x4980EAB: list_del (intel_list.h:240)
    ==25902==    by 0x4981F4B: free_list (sna_damage.c:403)
    ==25902==    by 0x4985131: __sna_damage_destroy (sna_damage.c:1467)
    ==25902==    by 0x49A5276: sna_render_composite_redirect_done (sna_render.c:1921)
    ==25902==    by 0x49C68FC: gen2_render_composite_done (gen2_render.c:1136)
    ==25902==    by 0x497F90F: sna_composite (sna_composite.c:567)
    ==25902==    by 0x4994725: glyphs_via_mask (sna_glyphs.c:1139)
    ==25902==    by 0x4995FB7: sna_glyphs (sna_glyphs.c:1688)
    ==25902==    by 0x8150EB4: ??? (in /usr/bin/Xorg)
    ==25902==    by 0x813CA38: CompositeGlyphs (in /usr/bin/Xorg)
    ==25902==    by 0x8146DE1: ??? (in /usr/bin/Xorg)
    ==25902==  Address 0x7c079ac2 is not stack'd, malloc'd or (recently) free'd
    
    Reported-by: bonbons67@internet.lu
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69acbb77e8aad3370d5e8d9a9e067c54872d7082
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 11 10:49:59 2012 +0000

    sna: Fix printing of uninitialied value in DBG
    
    ==25902== Use of uninitialised value of size 4
    ==25902==    at 0x423098E: _itoa_word (_itoa.c:196)
    ==25902==    by 0x4233F7F: vfprintf (vfprintf.c:1602)
    ==25902==    by 0x42FAFAD: __vsnprintf_chk (vsnprintf_chk.c:65)
    ==25902==    by 0x81DBE8E: Xvscnprintf (in /usr/bin/Xorg)
    ==25902==    by 0x81DC8FB: LogVMessageVerb (in /usr/bin/Xorg)
    ==25902==    by 0x81DCA62: LogVWrite (in /usr/bin/Xorg)
    ==25902==    by 0x81DCA9B: VErrorF (in /usr/bin/Xorg)
    ==25902==    by 0x81DC333: ErrorF (in /usr/bin/Xorg)
    ==25902==    by 0x49B2FA8: trapezoid_span_inplace__x8r8g8b8 (sna_trapezoids.c:5069)
    ==25902==    by 0x49B3407: trapezoid_span_inplace (sna_trapezoids.c:5166)
    ==25902==    by 0x49B4C96: sna_composite_trapezoids (sna_trapezoids.c:5619)
    
    Reported-by: bonbons67@internet.lu
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66e4c8ff40ab8cf722efa4293bb17b0d8f2dfa88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 11 09:40:09 2012 +0000

    sna: Flush pending rendering before enabling an output
    
    This is to prevent falling in the trap of the rendering being delayed
    until the next client renders some new content.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94dd0b9ee9f55e7c09b8c0ee18939fa69ce66da2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 10 16:52:09 2012 +0000

    sna/gen2: Fix use of uninitialised redirection
    
    ==29553== Invalid read of size 4
    ==29553==    at 0x4980E1B: _list_del (intel_list.h:218)
    ==29553==    by 0x4980EB3: list_del (intel_list.h:240)
    ==29553==    by 0x4981F53: free_list (sna_damage.c:403)
    ==29553==    by 0x4985139: __sna_damage_destroy (sna_damage.c:1467)
    ==29553==    by 0x49A527E: sna_render_composite_redirect_done (sna_render.c:1921)
    ==29553==    by 0x49C6904: gen2_render_composite_done (gen2_render.c:1136)
    ==29553==    by 0x497F917: sna_composite (sna_composite.c:567)
    ==29553==    by 0x8150C41: ??? (in /usr/bin/Xorg)
    ==29553==    by 0x8142F13: CompositePicture (in /usr/bin/Xorg)
    ==29553==    by 0x8145F58: ??? (in /usr/bin/Xorg)
    ==29553==    by 0x81436F2: ??? (in /usr/bin/Xorg)
    ==29553==    by 0x807965C: ??? (in /usr/bin/Xorg)
    ==29553==  Address 0x9407e188 is not stack'd, malloc'd or (recently) free'd
    
    Reported-by: bonbons67@internet.lu
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f1c30818c9d782b066147448bbcc9ac95ac834f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 10 16:52:09 2012 +0000

    sna: Fix use of uninitialised value in DBG
    
    ==29553== Use of uninitialised value of size 4
    ==29553==    at 0x4230964: _itoa_word (_itoa.c:195)
    ==29553==    by 0x4233F7F: vfprintf (vfprintf.c:1602)
    ==29553==    by 0x42FAFAD: __vsnprintf_chk (vsnprintf_chk.c:65)
    ==29553==    by 0x81DBE8E: Xvscnprintf (in /usr/bin/Xorg)
    ==29553==    by 0x81DC8FB: LogVMessageVerb (in /usr/bin/Xorg)
    ==29553==    by 0x81DCA62: LogVWrite (in /usr/bin/Xorg)
    ==29553==    by 0x81DCA9B: VErrorF (in /usr/bin/Xorg)
    ==29553==    by 0x81DC333: ErrorF (in /usr/bin/Xorg)
    ==29553==    by 0x49434F0: kgem_create_buffer (kgem.c:4887)
    ==29553==    by 0x4943B09: kgem_create_buffer_2d (kgem.c:4969)
    ==29553==    by 0x4943E19: kgem_upload_source_image (kgem.c:5021)
    ==29553==    by 0x49A0567: upload (sna_render.c:505)
    ==29553==
    
    Reported-by: bonbons67@internet.lu
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc2b13c9c05e57dc5004d93b56f332ea95f0a4ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 10 11:50:15 2012 +0000

    sna: Specify read/write domains for no-relocation fastpath
    
    On review (read triggering BUGs), we do need to supply the domain tracking
    of the buffers that is being replaced from the relocation path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c4a2bcc3d63ecc02e3a940e38e9a416b51ad0c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 10 12:34:52 2012 +0000

    sna: Allow snooped buffers to be retained (and reused) between batches
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5d79b202dd448e61ab6ffce26fe9cbf9051d770
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 10 10:30:04 2012 +0000

    sna/gen2: Add a modicum of fallback DBG
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56785
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27327633138dce159ca2e91fe5eac1565bd45e1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 9 17:08:01 2012 +0000

    sna/gen4: Only 965gm suffers the !snoop restriction
    
    So fixup the bogus assertion for g4x
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d3b5ea135fd8f16da2cbfb98041e32c7001a38f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 9 15:31:03 2012 +0000

    xvmc: Use DRMINTEL_LIBS instead of hardcoding -ldrm_intel
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f040b97b01495aa43f7771ebb8ca5c0d44038bc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 8 23:42:10 2012 +0000

    sna: Mark no-reloc write buffers
    
    If we bypass the relocation processing, we also then bypass the
    pending-write analysis, so we need to supply those to the kernel
    ourselves (to maintain gpu-cpu coherency).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85ba7e96268dbb8da4bb34078333695a451c6570
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 8 15:56:13 2012 +0000

    sna: Experiment with using reloc.handle as an index into the execbuffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93d8dddbb92431d6e2c48a17b71cac9f7047902e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 8 09:41:21 2012 +0000

    sna: Set the known offset for the batch as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 120fa0ef8d04f5e82e5f7a0636033d3d96efa1e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 7 17:41:20 2012 +0000

    sna: Support a fast no relocation changed path
    
    x11perf -copywinwin10 on gm45 with c2d L9400:
      before: 553,000 op/s
      after:  565,000 op/s
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7d2fcf47a9569d0944097a8be60ca3be72b42f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 8 08:55:25 2012 +0000

    Remove reliance on hard-coded DRI name
    
    This provides for using the existing DDX with future DRI drivers which
    may break from the traditional names - but only with the help of the
    user/packager. This scheme needs to be replaced with a robust mechanism
    for driver loading if AIGLX and co are to be kept.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cefce9c81585b73db7620e08fcf60c89a8204873
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 6 17:26:34 2012 +0000

    sna: Abandon kernels that do not support execbuffer2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2245838c15b54d72557de8facb7cc15d59624ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 6 16:32:32 2012 +0000

    sna/gen4: opacity spans requires the per-rectangle flush w/a
    
    Note that this is worsened, but not caused, by:
    
    commit e1a63de8991a6586b83c06bcb3369208871cf43d
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Fri Nov 2 09:10:32 2012 +0000
    
        sna/gen4+: Prefer GPU spans if the destination is active
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0540ebff083974688c863e08203e3d71a297340
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 6 16:00:42 2012 +0000

    sna/gen4: Remove a couple of old, now redundant, w/a flushes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aaaa6c356456a4bab595c6e6485893c538064e37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 6 14:34:51 2012 +0000

    sna/gen4: Flush after pipelined pointer updates (inverted logic!)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28bda6707d979bca29dbea04e932819de204d920
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 5 22:30:29 2012 +0000

    sna: Prevent use-after-free during partial move-to-gpu
    
    As we reuse the input parameter 'box' to hold the array of boxes that
    need to be migrated, we need to be careful that we do not later confuse
    it with the original input parameter. Otherwise,
    
    ==1315== Invalid read of size 2
    ==1315==    at 0x928B091: box_inplace (sna.h:506)
    ==1315==    by 0x9292278: sna_pixmap_move_area_to_gpu (sna_accel.c:2554)
    ==1315==    by 0x9292C14: sna_drawable_use_bo (sna_accel.c:2774)
    ==1315==    by 0x9356C01: gen7_composite_set_target (gen7_render.c:2448)
    ==1315==    by 0x9357AA2: gen7_render_composite (gen7_render.c:2800)
    ==1315==    by 0x92DB12E: glyphs_to_dst (sna_glyphs.c:552)
    ==1315==    by 0x92DEA8D: sna_glyphs (sna_glyphs.c:1664)
    ==1315==    by 0x4F920E: damageGlyphs (in /tmp/Xorg)
    ==1315==    by 0x4F2FF6: ProcRenderCompositeGlyphs (in /tmp/Xorg)
    ==1315==    by 0x437260: Dispatch (in /tmp/Xorg)
    ==1315==    by 0x426466: main (in /tmp/Xorg)
    ==1315==  Address 0xd637054 is 20 bytes inside a block of size 208,464 free'd
    ==1315==    at 0x4C2A2FC: free (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==1315==    by 0x92CCFCD: __sna_damage_destroy (sna_damage.c:1469)
    ==1315==    by 0x928AD74: sna_damage_destroy (sna_damage.h:284)
    ==1315==    by 0x9291CB2: sna_pixmap_move_area_to_gpu (sna_accel.c:2470)
    ==1315==    by 0x9292C14: sna_drawable_use_bo (sna_accel.c:2774)
    ==1315==    by 0x9356C01: gen7_composite_set_target (gen7_render.c:2448)
    ==1315==    by 0x9357AA2: gen7_render_composite (gen7_render.c:2800)
    ==1315==    by 0x92DB12E: glyphs_to_dst (sna_glyphs.c:552)
    ==1315==    by 0x92DEA8D: sna_glyphs (sna_glyphs.c:1664)
    ==1315==    by 0x4F920E: damageGlyphs (in /tmp/Xorg)
    ==1315==    by 0x4F2FF6: ProcRenderCompositeGlyphs (in /tmp/Xorg)
    ==1315==    by 0x437260: Dispatch (in /tmp/Xorg)
    
    Reported-by: Matti Ruohonen <kiesus@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56591
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e62b0cbf958d1ad95e4522973253a1ae5c1a4da9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 2 15:54:20 2012 +0000

    sna: Add a small delay during startup if another master is still active
    
    There exists a race with plymouthd that can cause the drm device to
    reject us as the rightful master, and so cause X to fail to load. Try
    waiting for a couple of seconds for whatever it was to close before
    giving in.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1a63de8991a6586b83c06bcb3369208871cf43d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 2 09:10:32 2012 +0000

    sna/gen4+: Prefer GPU spans if the destination is active
    
    Trying to avoid using the inplace scanline rasteriser for large shapes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72bcd8f85c98502b13a67d9c606371afe513584c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 1 09:30:18 2012 +0000

    sna: Try to reduce ping-pong migration for intermixed render/legacy code paths
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56591
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e363906a5ef15e1eb0a387cfb6b3445ac185b9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 22:58:59 2012 +0000

    sna: Set a valid box when checking for GPU bo for BLT composite ops
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b924831e445615b82a53b10e1849720e933eddfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 22:55:56 2012 +0000

    sna: Preserve mode if flushing before a scanline wait
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 678f9586807071bef813bb69d451f14d2fcbcc04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 11:26:18 2012 +0000

    sna: assert that the source is not the GTT mapping when uploading
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 783b8048a6d1a9fd0a73ebf7768ae17dc0b21900
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 11:16:09 2012 +0000

    sna: Prefer to use the GPU for uploads if continuing on the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74c912880c302889f38fe5898c8038a0ba20e5db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 10:57:54 2012 +0000

    sna: Fix a typo in a DBG
    
    Reported-by: Matti Ruohonen <kiesus@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f48a821aa73cb40a51baafc6cd2b063f1f91d864
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 10:53:47 2012 +0000

    sna: Add a few DBG tracepoints to screen init/fini
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf81d552c4be039fbcf3272387828b1a8b3fbdb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 31 08:50:44 2012 +0000

    sna: Clamp the drawable box to prevent int16 overflow
    
    And assert that the box is valid when migrating.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56591
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31eb704b2ad7c861ec4e61fb9de0e9592fc6d269
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 26 13:57:30 2012 +0100

    sna: Ensure that the trap is clipped if it ends within the boundary pixel
    
    Reported-and-tested-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56395
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef431b2d35c1bf4d77bbcc73688951d22f6aa135
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 25 10:15:39 2012 +0100

    uxa: Drain the DRM event queue before server regeneration
    
    Adam Jackson notes that what appeared to be my paranoid ramblings in SNA
    actually served a purpose - it prevents a server crash following
    server regen if an indirect client happened to be running at the time
    (e.g. LIBGL_INDIRECT_ALWAYS=1 glxgears).
    
    Reported-by: Adam Jackson <ajax@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efb8ff16491ecfb4d9c0c6a718684310d949d8d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 24 22:56:20 2012 +0100

    sna: Add missing ValidatePicture() for flattening alphamaps
    
    Reported-by: Armands Liepins <armandsl@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56367
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a489142c8e6a4828348cc9afbd0f430d3b1e2d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 23 23:43:50 2012 +0100

    sna: Disable RandR hotplug events if Xinerama is enabled
    
    Since RandR itself is disabled if Xinerama is enabled, for example with
    ZaphodHeads, calling RRGetInfo() upon a hotplug event generates an
    assertion.
    
    Reported-by: Stephen Liang <inteldriver@angrywalls.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55260
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d87c2756db1af6e4af15864ab0f44d1454079236
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 23 15:50:56 2012 +0100

    sna: Beware 16-bit overflow when computing sample areas
    
    Reported-by: Ognian Tenchev <drJeckyll@Jeckyll.net>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56324
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7f48684cdebc24128a5fa5678614af3deb14b3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 23 15:17:56 2012 +0100

    sna: Only disallow hw sprite scaling on Haswell
    
    Earlier chips (Ironlake, Sandybridge and Ivybridge) have integrated
    sprite scalers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c3ea9cf6900855502fcd56214a1b9e180265ff5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 22 22:35:17 2012 +0100

    sna: Update DRI buffer if attached to the framebuffer for TearFree flips
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4dfc83359d006a4e410e3280003b49683309afc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 22 14:56:01 2012 +0100

    sna: Tidy udev install/remove and add a couple of lines of DBG
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55260
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d9687d49c9869b2e88d408e5f451c9a1f8f3389
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 22 13:41:54 2012 +0100

    sna: Refactor the common code to enable a timer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb729788872ccb429ddde8a9a4281b1933243096
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 21 14:36:48 2012 +0100

    sna: Only query the system time if we are processing timers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0d6a75f02eb97e5c80a4345ae5c68e9a81d49b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 21 14:32:14 2012 +0100

    sna: Use the FLUSH_TIMER as the only wakeup timer source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bc829c39a203c17053eb728412f698a429ad9fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 21 14:24:01 2012 +0100

    sna: Remove the unused inactive eviction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fa6e4aa2daee99ff5f6efc11232de22100bac80
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 21 12:48:06 2012 +0100

    intel: Sanity check that the platform probes points to a i915.ko GEM device
    
    References: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1069031
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6eed98fcfea54d50a282ac71ee654645551ae11
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 21 10:46:14 2012 +0100

    sna: Mark the to-be-damaged region first, then Process afterwards
    
    Damage is processed in two phases, with the actual Damage being appended
    before the operation is performed so that a copy can be made before
    modification (e.g. software cursors).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60e4e009f90543bfd57f6a4e51ebc5b32b4af33b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 20 17:59:45 2012 +0100

    sna: Move the source region to the CPU for a self-copy fallback CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ff8b1ba543508f3b209f2ade7655c3aa34d546d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 20 16:23:26 2012 +0100

    2.20.12 release
    
    How embarrassing! My fault for rushing :(
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 695b2ce2d32bde191080129b55f9bf8a9d48ee77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 20 16:19:21 2012 +0100

    uxa: Fixup drm_intel_bo_disable_reuse() typo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2083e253b3d1ecc218ab1e523e4026ddd4561112
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 20 16:07:11 2012 +0100

    2.20.11 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc0ba65f5efe217f2ab5e920255d2133d7c9e5e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 20 09:29:10 2012 +0100

    uxa: Disable bo reuse after binding to a scanout
    
    On gen6+, bo are expected to be LLC by default. However, as using the bo
    for the scanout causes it to be moved into the uncached domain, this
    assumption is then false and we should release the bo back to the system
    rather than spread the uncached buffers around. The most common
    allocator of scanouts is for pageflipping which are already non-reusable
    due to the DRI2 export, so there should actually be little impact.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4c32af48b0c92a48131090886a6a6b6c45dbe34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 19 16:29:19 2012 +0100

    sna: Clear the damage along with the BO when forcing the stall for inplace BLT
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56180
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 299232bdb69c8c2b6231905e0f45e9cfe74fe09a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 19 15:02:00 2012 +0100

    sna: Reorder final checks for using the BO and setting the damage pointer
    
    When we return NULL from sna_drawable_use_bo(), the expectation is that
    the damage pointer is also NULL. However, one SHM path leaked.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=56180
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 257abfdabe39629fb458ed65fab11283f7518dc4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 23:34:22 2012 +0100

    sna/gen4: Presume we need a flush upon state change similar to gen5+
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55627
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8238c672984e31ae655353d6412e3395a9cdfbe6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 22:16:29 2012 +0100

    sna: secure batches accepted upstream, so simply use runtime detection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 540666a0a81c7daedbd47830d0932df5e57ec903
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 16:59:05 2012 +0100

    sna/overlay: Move bo out of GTT domain after binding to overlay plane
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 891bae4aa91e85542dcbe38f6ee92141e3efc801
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 11:29:10 2012 +0100

    sna: Use the secure batches to program scanline waits on gen6+
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41be80a8cae1eb0e294392e5033511bfdf2895c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 11:25:52 2012 +0100

    sna: Enable support for SECURE batch buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba6c82cd9d8089354b90632ca8edbb35cc09b9c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 17 13:54:51 2012 +0100

    sna/dri: Defensively check for GTT mmap failure during fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7927f9a351ead1a5593bc91e465706bdd889bb8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 16 17:56:30 2012 +0100

    sna/gen7: Filter BLEND flags for CA glyphs
    
    Fixes regression from commit c51aaa731e5cffc892e59730194ad7c98789b02b
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu Oct 11 11:36:00 2012 +0100
    
        sna/gen7: Replace bogus state tracking assertion
    
    The assumption being that we only used the encoded flags for determining
    the composite state is false for the magic CA pass.
    
    Reported-by: Oleksij Rempel <bug-track@fisher-privat.net>
    Reported-by: Eyal Lotem <eyal.lotem@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=56037
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ad4aa195571fe214ccffa55e123507f1be66243
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 16 11:59:28 2012 +0100

    sna: Drop fake tiled CPU mapping
    
    The only path where this is correct already handles it as the special
    case that it is, everywhere else it just nonsense.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b42d81b63f5b6a571faffaadd42c74adce40128a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 14 09:15:38 2012 +0100

    2.20.10 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 877e9c57c788cb3d4db1e96e519b26ca5d542465
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 12 17:57:28 2012 +0100

    sna/overlay: Trim suggested BestSize to fit within the overlay constraints
    
    As the maximum reported image sizes are for the source image, we should
    be careful not to recommend the application use an output Window larger
    than can be handled by the overlay hardware. So shrink it to fit, whilst
    preserving the aspect ratio.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ec41590c9d142a77a2fdcfcd9a762aca99d9d86
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Thu Oct 11 18:10:17 2012 -0300

    Fix possible_clones computation for shared encoders between outputs
    
    Libdrm's possible_clones is a mask of encoders. Xorg's possible_clones
    is a mask of outputs, so we just can't do the following:
    
      output->possible_clones = kencoder->possible_clones;
    
    This is a problem on Haswell because, at least with the current
    patches floating on the mailing list, there is more than one connector
    per encoder.
    
    This patch writes the code to properly translate libdrm's encoder mask
    into Xorg's output mask.
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b92a5a3062d73666279e17ac2d711314bcd8dfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 11 12:16:03 2012 +0100

    sna: Correct a bogus assertion after inplace PutImage
    
    If we are forced to use the GPU bo as the target because the CPU bo is
    busy, the priv->cpu flag is likely to remain set, so we need to clear it
    rather than fail the assertion that is false.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c51aaa731e5cffc892e59730194ad7c98789b02b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 11 11:36:00 2012 +0100

    sna/gen7: Replace bogus state tracking assertion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a56fa2fb4aad172be905c3abeefd987804553809
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 11 10:55:34 2012 +0100

    sna: Rearrange switch to suppress a compiler warning in sna_copy_plane_blt()
    
    Hide the impossible default case so that static analyzers are not
    confused.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94a98d1c472ce0fc7601421a2bcfbd0524d2bc93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 11 08:42:21 2012 +0100

    sna: Limit available space for gen2
    
    Since pre-g33 chipsets impose massive alignment restrictions on objects
    within the aperture we need to further restrict the amount of available
    space to be sure we have sufficient room to accommodate the alignment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3ae85dd01952ecff7b780e30a43571146aa61ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 10 17:27:38 2012 +0100

    sna: Use high/low watermarks for fenced aperture counting
    
    This helps with fitting larger operations into the small apertures of
    gen2, which due to the lax accounting could trigger ENOSPC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dadffd0061e2b14db397608e3cedfe9c76e546c8
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Oct 11 14:30:29 2012 +1000

    intel: fix fullscreen damage posting on pageflip
    
    While playing with MPX and sw cursor I noticed page flips won't
    end up misrendering some bits, so the sw cursor was replacing the
    bits on the wrong pixmap.
    
    Fix the damage handling to be correct and append damage before swapping
    the pointers and process damage after.
    
    This fixes misrendering with MPX cursors under a fullscreen compositor,
    that pageflips.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    [ickle: The secret is that damage is sometimes reported before the
    rendering in DamageRegionAppend, and sometimes afterwards in
    DamageRegionProcessPending. For instance, the software cursor operates
    prior to being rendered over.]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1ea19a3edaac6e1e5d240b75b7c5fdcfea0e0a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 10 23:20:13 2012 +0100

    sna: Prevent sign-extension when manipulating strides
    
    Reported-by: Prit Laes <plaes@plaes.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55823
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d73f5b5bb1a81421f1fdc3ac3b460a8ad90be0ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 9 19:41:10 2012 +0100

    sna/gen6+: Initialize the damage for fill-boxes
    
    In case we need to redirect the rendering for a large render target, we
    need to initialize the damage pointer.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: ttps://bugs.freedesktop.org/show_bug.cgi?id=55812
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae6ae91baa0574a7a23ab76afac5e2d827c49c20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 9 18:36:59 2012 +0100

    sna: Check the map exists before trying to release it
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: ttps://bugs.freedesktop.org/show_bug.cgi?id=55812
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bbfa88a8691f6c1b2903090c3cd3159126ef563
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 9 17:26:39 2012 +0100

    sna: Also check the bg rrop for reads when deciding upon fallback placement
    
    Reported-and-tested-by: chr.ohm@gmx.net
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55810
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8a005d1f984382272ad10cabd88c0422d4e76e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 9 00:23:24 2012 +0100

    sna: Pass the region, not its pointer, when moving the GC to the CPU
    
    Fortunately, the sgc->region was not used along that particular fallback
    path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb5205a86da09b344dbc20598655e917c263125c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 8 09:12:33 2012 +0100

    sna/gen5: Flush pipelined ops when changing state
    
    When is a pipelined operation, not pipelined? That is the mystery posed
    by our hardware!
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bed64c998df538046d77eeea90598f48077dab5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 8 00:13:03 2012 +0100

    sna: Fix check_reloc_and_exec typo
    
    Garbage xorg includes hiding genuine compiler warnings ftl once again.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ac3776be85d857a57ce7b742e52cd6091d2befb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 22:41:25 2012 +0100

    sna: Check that we have sufficient space for a copy when replacing a fill
    
    Reported-by: Timo Kamph <timo@kamph.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55700
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a5d5b9ae5771d81da16222582acedb1557386c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 22:41:02 2012 +0100

    sna: Check that for batch overflows after advancing a BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b41ecda69f2e6c9f8adf79dd24ded45740bcc015
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 22:39:36 2012 +0100

    sna: Only reduce the maximum batch size for old kernels
    
    Be careful we not increase the batch size to span multiple pages on 865g!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ca7f8be5bcfec3c50c43bd485f0c57b931f8206
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 22:39:10 2012 +0100

    sna/gen2: Count the number of dwords required for the invariant
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d2dba0ba70c2b217a777243e8a89f7a5c5349a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 10:46:19 2012 +0100

    Use path for intel-gen4asm derived from pkg-config
    
    As we use pkg-config to determine whether to use intel-gen4asm, we
    should also use it to locate the right version of intel-gen4asm to use.
    This allows the user to install the assembler in a non-standard path for
    cross-builds and similar.
    
    Reported-by: Josh Tripplet <josh@freedesktop.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55646
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 249051d90fb0ab0bea5561a04ee2a5d0a2238ff1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 09:33:06 2012 +0100

    sna/gen2: And the other compile failure
    
    Typing on Sunday before coffee is a very bad idea.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d11a15f04dfaf8ba236d7255c52e67d8602ab806
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 09:30:38 2012 +0100

    sna/gen2: Compile fix
    
    Be careful when cutting and pasting assertions!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2a26adc8e7b02aea204101f207f740bbde62414
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 7 08:59:32 2012 +0100

    sna/gen2: Add a couple of assertions to track down a batch overflow
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55700
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3680aa4976407886eb4be9878d5296d5a1fadccf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 5 12:33:32 2012 +0100

    sna: Do not create an unsnooped CPU mapping for readbacks
    
    Otherwise we notice that we have a CPU mmap during read synchronized and
    presume that we need not take any further action. However...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d717a67ff4a59d0c2cc108cedbecdc20b4c9fb97
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 5 10:27:26 2012 +0100

    configure: Make rebuilding of the gen4 assembly files explicit
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55646
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b74a2dc5270094810ec0cf8039fd3b3ab0815b5
Author: Josh Triplett <josh@joshtriplett.org>
Date:   Thu Oct 4 17:48:24 2012 -0700

    Fix out-of-tree builds with intel-gen4asm installed
    
    The make rules to compile shaders with intel-gen4asm referenced the .g4a
    source files without using $(srcdir), which broke out-of-tree builds.
    Reference .g4a source files via $(srcdir), and add $(srcdir) to m4's
    include path, fixing out-of-tree builds.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55645
    Signed-off-by: Josh Triplett <josh@joshtriplett.org>

commit 07a46333477898cfc2020ba5da9a6a7a866b21a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 5 10:17:45 2012 +0100

    sna: Refactor the fallback CopyArea to use the common region computation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ad3a2d839f8e2f5b02f883e2b4131d4c0901fb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 15:14:08 2012 +0100

    sna/gen2: Tidy DBG code for disabling composite operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6054f8e1120d499f70e7bd4809b3fc6994792bcb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 14:40:59 2012 +0100

    sna: Remove another sna_pixmap->cpu assertion that was not true
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit acf354d7fb575c468e86a5935cad095015ccadb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 14:35:14 2012 +0100

    sna: Propagate failures from compositing glyph masks
    
    So that we can fallback correctly. This is primarily using for debugging
    failure paths...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7ad655359b746917deeac3efb9eb843465cf4b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 13:52:55 2012 +0100

    sna/gen2: Prevent using the GTT maps with I915_TILING_Y on 855gm
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a2c5eb7669c249194b41d624ca05654a8d7035b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 13:51:23 2012 +0100

    sna: Once again look into assertions around sna_pixmap->cpu
    
    Revert back to basics, and clear the CPU flag everytime we use the GPU,
    rather than try to avoid clearing it along some paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d3b849c57d78f0447334c5c0871d8bd78e0af24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 12:14:47 2012 +0100

    sna: Avoid using the gpu for uploads whilst wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4608e482615d4b4599608c7bc17ac8a9f9293840
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 4 11:23:36 2012 +0100

    sna/gen2: Allow fine damage tracking for render operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83b8669abc7415202f9e0c764de675ffbcf45dac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 23:45:28 2012 +0100

    sna/gen2: Setup invariant blend arguments
    
    I thought these were completely specified via the LOAD_STATE_IMMEDIATE
    commands we used whilst seting up the render pipeline. I was wrong.
    
    Reported-by: Timo Kamph <timo@kamph.org>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55455
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b71af5dc626adfdf7d753e8e61fb13e8b9290d17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 22:53:57 2012 +0100

    sna: Clear sna_pixmap->cpu when destroying the CPU damage
    
    So that we keep the assertion checks that without CPU damage we can not
    be on the cpu.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55591
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d42872d1e0bab1808c0a544c7ece049da103825
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 14:42:19 2012 +0100

    sna: Protect against undefined O_CLOEXEC
    
    Reported-by: Giovanni Mariani <mc2374@mclink.it>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55577
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a683643ebf9120bd73a7cd740b5fb24f7e8e797b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 14:13:13 2012 +0100

    sna: Fix an instance of undamaged tracking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47c76bb9680eee89d1cef86058782a7073ca4a47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 14:12:50 2012 +0100

    sna/gen7: Tidy detection of unbounded render op
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e770f09dbe76287293fea0a8a1f231885aa1c1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 13:00:25 2012 +0100

    sna/dri: Delay the deactivation of the pageflipping
    
    As we need to clflush the scanout buffer as we return it to the bo cache
    on SNB+, it is costly to terminate the pageflipping as soon as we drop a
    frame as mesa often fails to keep up to the vrefresh rate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3a502a7057649b284601bdd5110b136ab1f5fbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 3 11:46:57 2012 +0100

    sna: Review sna_pixmap->cpu tracking
    
    Notably 52b211cb15b3 was triggering a few assertions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf44d9965b5cc0f0ee31ba2579783d8194fff756
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 2 12:22:51 2012 +0100

    sna: Prevent sna_damage_contains_box__no_reduce() from a NULL deref
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ae6c2ccb006a99e8d7bbfff77f98cc58f62ce2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 2 11:44:16 2012 +0100

    sna: Actually upload the damage when replacing a busy CPU bo for PutImage
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55508
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52b211cb15b3bfe33a61cafcd8dcc1c9fbf20243
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 1 23:55:37 2012 +0100

    sna: Tweak CPU damage partial upload paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1fc3fa699c0b4cae5259d9e439f84ede4a6012b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 1 22:42:26 2012 +0100

    sna: Avoid accumulating damage to the CPU if it is already damaged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c2821d77c4b3bdd4d40d4a2c69f935a9eb0fd47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 2 11:31:40 2012 +0100

    sna: Remember to call ValidatePicture() before using newly created Pictures
    
    Reported-by: Marco De Michele <marco.demichele@taolab.it>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55527
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51202798862c79ad417936cfe2d1847b1da4ab87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 1 13:06:42 2012 +0100

    uxa: Remove USE_GLAMOR check from unrealize glyph caches
    
    In an interesting twist during teardown, the driver info structure is
    freed long before the caches. However, the glyph cache teardown was
    checking to see if glamor was enabled to see if it could skip the
    teardown. In fact, since we won't have created the glyph caches in that
    circumstances it was safe any way.
    
    Reported-by: Maarten Lankhorst <m.b.lankhorst@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba1dea5e373b8d7b410c07df897acc4d11079f63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 1 11:19:41 2012 +0100

    sna/gen2: Clear STIPPLE setup before rendering with the 3D pipeline
    
    One over-zealous removal too many.
    
    Reported-by: Timo Kamph <timo@kamph.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55455
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eec12faf82370a8540114287c224953aa66d7bd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 30 18:39:06 2012 +0100

    sna/dri: Check back/front buffers of a pixmap for format change
    
    Highly unlikely.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e23251aad6d56a59e626b623e59bafac3143562
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 30 13:52:34 2012 +0100

    sna: Cache repeated use of the temporary CPU mapping for tiled_x uploads
    
    Fixes ShmPutImage regression under gnome-shell
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1756cf4d8e80cea47a28786c51cac4a760d6d0cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 30 12:26:23 2012 +0100

    sna/dri: Only chain to a triple buffer pageflip sequence
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba525463fb91900e775c91a54368a9e8b270268b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 30 09:03:36 2012 +0100

    sna/dri: Improve handling of async/sync pageflip transition
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2eab5ef751d7e9caabd7df171cdbb5e784059998
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 30 08:49:34 2012 +0100

    sna: Make sure the CPU bo is destroyed if we fail to mmap it during alloc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45b351412b8ba81f4fef2f64540d87cbf16359fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 29 21:21:18 2012 +0100

    sna: set_cacheing returns a bool not an error-code
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33f6f753788398efdf20cde4aa0b4ca402eee8fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 29 16:41:00 2012 +0100

    sna/dri: Swallow error from GetMSC
    
    Just ignore the error return from WaitVBlank and make up a value for
    last MSC/SBC similar to an unattached Drawable.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55395
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a873f6d354ebbc52265e686b614027f537a6363a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 29 16:01:58 2012 +0100

    sna: Release the front buffer and drop DRM master early during shutdown
    
    If we delay the dropping of DRM master we may complete a VT switch
    before we are ready and so prevent a second X server from reacquiring
    master, and dying.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55446
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a192f8cbc238d84e058b01b7682abe7ef09d3508
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 29 10:51:00 2012 +0100

    2.20.9 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16860d448f11ba405050bd1ff02dc63a4b26280c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 29 10:40:51 2012 +0100

    uxa: Only destroy the bufmgr if it exists
    
    Be wary in case the Screen is destroy before we initialise bufmgr.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13f7a9e267fbefd3326569e89b840bef31d77996
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 28 09:25:12 2012 +0100

    sna: Restore LLC cache level after using a buffer for scanout (uncached)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bfd31e9bb13bcb7f12e4147bec0da87b8e87dde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 18:12:11 2012 +0100

    sna/dri: Improve handling of flipping with no outputs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dddb6e4e63d5cc8b2a1f2ae3ff287922d30460b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 17:17:30 2012 +0100

    sna: Attempt to restore the current mode if pipe is disabled on DPMS on
    
    If we attempt to power up the pipe through a DPMS request, but it was
    previously disabled due to an error, first try re-enabling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88cfd23379950d1fe4e682519c48ef6e3091c2f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 16:16:39 2012 +0100

    uxa: Update mode->fb_id after completing pageflips
    
    As intel_crtc_on() depends upon the current value for determining if the
    pipe is active, we can only change the value afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83990c649cbd3cb563d08f04e1c02232c44997aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 14:58:26 2012 +0100

    Remove the last couple of references to mibstore
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb0b72c4fbb7b1bc941522d8679fef856f2f8936
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 14:53:46 2012 +0100

    uxa: Fixup the last couple of commits after realising I didn't have uxa enabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit feef53005b57d6b4489a15f8d0db8245dcb0cfaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 13:36:55 2012 +0100

    uxa: Do not attempt to pageflip whilst not master
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a45cbacb777e478d8fbda9223b0fb5c705d7249
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 13:31:27 2012 +0100

    uxa: Confirm the pipe is alive before flipping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit edc5b7f741a4bb8e9a58b5eb2201fa9304f94ef7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 27 13:27:20 2012 +0100

    uxa/dri: Confirm Drawable is still attached to an active pipe before flipping
    
    If we schedule a flip to happen on a far distant vblank, it is possible
    for us to disable the pipes with a modeset, whilst maintaining the fb
    size, or with a DPMS command. If the pipe is disabled and we still try
    to flip, then we trigger an EINVAL error from the kernel.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb667378543f97d7c7e7767daddbd9b39e07c1f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 26 15:12:57 2012 +0100

    sna: Typo in DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 557ad78d02dfff3db9e7fc21f05230a8fe482f7c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 26 15:02:17 2012 +0100

    Kill mibstore pretend backwards compatibility
    
    Adam Jackson was kind enough to point out that mibstore had been a no-op
    since xorg-1.4 and the earliest we claim to support is xorg-1.6.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 367f57faf2c422da026a25c099426dc750cf3759
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 26 14:06:18 2012 +0100

    sna/video: Force integer promotion to avoid u16 overflow for frame size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34772cb0e724a880a8c6db936c0bb5dd129398f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 26 12:09:39 2012 +0100

    sna/dri: Handle pending flips when drawable disappears.
    
    The async case needs special handling as the current front buffer may be
    pending a flip onto the scanout which needs to be completed even if the
    Drawable is destroyed.
    
    Fixes regression from commit ad877abdc70b842afd202b2f97892d97a0b8d151
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sat Jul 7 17:48:52 2012 +0100
    
        sna/dri: Attach the chain of frame events to the Window, not pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit addfa653cf51fa45c7eae49be1fd722aaadf97d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 26 08:59:18 2012 +0100

    uxa: Prevent attempting to call intel_mode_fini() before PreInit runs
    
    In the Ubuntu xserver it is apparently possible for the Screen to be
    deleted prior to being fully initialised. Make sure we don't crash in
    that situation!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55346
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b880d8e0a9a32acd50333f72d695268c4819c29e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 16:59:20 2012 +0100

    sna/gen5: Add WA reference
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74f930fd80c3f97a1b6213e9e79e02f8f51c64b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 15:41:51 2012 +0100

    sna: Make sure the batch is flushed before setting DPMS
    
    Just in case on the off-chance that the kernel modifies the pipe and we
    had a pipe-dependent operation in the batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a00c3765c3ba464bb4e9cde12e964c979421ed6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 13:50:33 2012 +0100

    sna: Accommodate changes to the Damage extension not unwrapping the GC
    
    commit 4dc2a76740d921c824a4d8193f39dd373475f02a
    Author: Adam Jackson <ajax@redhat.com>
    Date:   Thu Sep 20 17:57:00 2012 -0400
    
        miext/damage: Only wrap into the GC ops chain if there's a listener (v3)
    
    leaves the GC->funcs still pointing to the damage layer as it calls into
    the driver functions, so we need to be careful to restore the correct
    function table after we manipulate the GC for fallbacks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f5a6d107bb30fa218ff3c1d07532ca834b82edc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 13:36:12 2012 +0100

    Add miInitializeBackingStore() to compat-api.h
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dee133a722fb137767a78b244a312620f52a51b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 13:22:40 2012 +0100

    sna: Remove unused reference to mibstore.h, removed in future Xorg
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0dbfc20aaa9b47329438ce42150770d4d7934c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 25 13:22:21 2012 +0100

    sna/dri: Fixup a DBG statement not to print gibberish
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6008068372709c73034163eddc902b47bf87d24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 21:42:31 2012 +0100

    sna: Check against op->dst.bo rather than priv->cpu_bo for composite upload
    
    In this case, we may also be handling an unattached pixmap, so avoid the
    deferences of the sna_pixmap unless we are sure it will exist.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ed840881c26e90eb8e00521b6d77b0ea514de5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 20:29:21 2012 +0100

    sna: Check that the CPU bo exists before declaring it is busy along upload
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=55251
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a858afc66c1fa2eec65a7041e991f2266f82deca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 13:49:40 2012 +0100

    Silence a couple of potential compiler warnings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9326acc2917109f06dda809107c8fa5a2273c3d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 13:40:04 2012 +0100

    Allow compilation of a separate i810 driver
    
    Allow --enable-ums-only as a counter-option to --enable-kms-only in case
    the distribution wishes to enable a non-root KMS driver but also offer
    a separate UMS driver for i81x.
    
    On the second pass, use "--enable-ums-only --disable-uxa --disable-sna"
    to get the trimmed down unaccelerated i810 support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0afb7efe8c48b5fc839e2137e870bea0f5fb3c9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 09:41:59 2012 +0100

    sna: Avoid overflows when translating the box16 extents during a copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fc6e5820e4543d52bcf8d0285ca6f69b5213831
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 09:32:49 2012 +0100

    sna: Add missing protection against int16 overflow when copying
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2ca1c5abca687adb08d6e137bc3b70bdecb083d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 23 08:56:50 2012 +0100

    Reorder INTEL_XVMC define so that we pick up Option "XvMC"
    
    Otherwise it will remain disabled.
    
    Reported-by: Giacomo Comes <comes@naic.edu>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92dbedc6138b923aa473935013ecb0346280c4d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 22 08:56:49 2012 +0100

    sna: Force the stall before trying to upload into a busy CPU bo
    
    Under the circumstances where we can not instead stream the write into
    the GPU bo, we need to use the busy CPU bo.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54978
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e1be265cf950976b5929b14a9dad0664deaa2c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 21 17:37:58 2012 +0100

    sna: Force an inplace upload if already wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8967aff382c1b6bef2335dea51c979a3f0800c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 21 12:16:27 2012 +0100

    sna: Do not query for the NULL edid property
    
    If the EDID blob id is set to 0, that means that it does not exist and
    so we can safely skip it.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55193
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0be1d964713ca407f029278a8256d02d925dc9da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 11 21:48:24 2012 +0100

    sna: Use inplace X tiling for LLC uploads
    
    Based on a suggestion by Chad Versace (taken from a patch for mesa).
    
    This allows for a faster upload of pixel data through a ShmImage, or for
    complete replacement of a GPU bo.
    
    Using a modified version of x11perf to upload to a pixmap rather than
    scanout on an IVB i7-3720qm:
    
    Before:
    40000000 trep @   0.0007 msec (1410000.0/sec): ShmPutImage 10x10 square
     4000000 trep @   0.0110 msec (  90700.0/sec): ShmPutImage 100x100 square
      160000 trep @   0.1689 msec (   5920.0/sec): ShmPutImage 500x500 square
    
    After:
    40000000 trep @   0.0007 msec (1450000.0/sec): ShmPutImage 10x10 square
     6000000 trep @   0.0061 msec ( 164000.0/sec): ShmPutImage 100x100 square
      400000 trep @   0.1126 msec (   8880.0/sec): ShmPutImage 500x500 square
    
    However, the real takeaway from this is that the overheads for
    ShmPutImage are substantial, only hitting around 70% expected efficiency,
    and overshadowed by PutImage, which for reference is
    
    60000000 trep @   0.0006 msec (1800000.0/sec): PutImage 10x10 square
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d853064e7eebc5719645c12605782f995131a6fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 20 22:43:26 2012 +0100

    sna/gen3+: Trim the target extents to the CompositeClip
    
    When computing the active region with of a composite operation with
    unknown extents we try to simply use the whole Drawable. However, this
    needs to be clipped otherwise it may trigger assertion failure with an
    offscreen pixmap.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=55164
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 853beff4306d5a168e310af82d0ddf9db319fdce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 19 08:30:59 2012 +0100

    sna/dri:Add some DBG and assertions to validate names passed back to clients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c1e60a15431b193b57d94a27b8e8de7c5a7e683
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 18 15:01:52 2012 +0100

    sna: Add some asserts useful for tracking an xserver drawing bug
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd23ac69ffb670468b2993242ce0d596081bbca4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 18 13:39:33 2012 +0100

    sna/gen7: Add some ring switching sanity checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22c84d02ade83c39940d76fc616a9122e535606a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 18 12:01:49 2012 +0100

    sna: Remove special casing of drawing depth=1 glyphs
    
    It turns out that they were not so special after all, and the "fast
    path" was missing the important handling such as validating the GC. As a
    result we ended up trying to render the glyphs through a planemask of 0
    and similar garbage resulting in corruption. An example given by Kaus
    Dittrich was the use of rotated glyphs in gnuplot.
    
    Reported-by: Klaus Dittrich
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71fa350325bb06a6141f89ef14431d96f0c4956a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 17 13:40:24 2012 +0100

    sna: Check that we do not keep a GPU bo around after flushing a ShmPixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88502b32d5d2b826fc08344392c98300341410e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 16 09:02:46 2012 +0100

    2.20.8 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 395d738b5086f24659b56b4b3536bffaebad8a3e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 15 21:18:35 2012 +0100

    sna: Improve handling of probe failure during initialisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe78904a45979d47bb092ce37d321854e2418344
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 22:15:14 2012 +0100

    Add basic support for ValleyView
    
    Bind to the ValleyView SDV for verifying the render routines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b9259f7cedc179617bc24b3912d2d8d75c5a824
Author: Ian Stakenvicius <axs@gentoo.org>
Date:   Fri Sep 14 21:04:42 2012 +0100

    configure: Make udev dependency optional
    
    In order to support buildbots where the udev headers may exist on the
    build system but not the target, we need explicit control over optional
    dependencies.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54942

commit d995705fb01842652a79076cbecee4392f653bfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 19:32:06 2012 +0100

    sna: Only discard CPU damage if we completely overwrite its extents
    
    If we are performing a clipped copy, then we must be careful not to
    completely discard the CPU damage as it may not be entirely replaced.
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54937
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit deacab87e4ba7fe09f0f16568dc2848949f2707a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 17:01:13 2012 +0100

    sna/dri: flip->next_front.bo is owned by the DRI drawable not by the flip
    
    Be careful not to delete the reference we presume we hold as it is
    borrowed from the DRI drawable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5369408d596a0611d4f76333dac2e1c93e63e8b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 16:12:00 2012 +0100

    sna/dri: And the hunt for the use-after-free continues...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e9d64203428b344433ac8f86dc1f06d2c32529a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 14:06:38 2012 +0100

    sna: Fix typo for sna_render_picture_flatten()
    
    Pass it the correct value for the pixmap height, and not its 'y'
    coordinate!
    
    Reported-by: Eugene Rosenzweig <ugn@outlook.com>
    Bugzilla: https://bugs.gentoo.org/show_bug.cgi?id=434860
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ee9969f0e99975a24e113af9591909d9023d8af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 13:04:50 2012 +0100

    sna/dri: Update AsyncSwap for recent changes in tracking DRI drawables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2dbb991384f2b820a714eba262691ed97a6a22a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 13:04:14 2012 +0100

    sna/dri: Add a bunch of assertions for hunting a use-after-free
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8756091474aeb44e5d8eed6b20b65c23b6574e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 12:17:28 2012 +0100

    sna/dri: Version bump for prototypical AsyncSwap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fc3d020f3086b5c6ecef1fed1aaedef7aa52b01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 14 09:49:00 2012 +0100

    Skip adding unknown special modes
    
    In light of the discussion on how to add stereo modes it was revealed
    that we would happily add modes with unknown and unhandled strange
    flags. Adam Jackson mentioned that he has plans to fix that with some
    upcoming work, but as a first step we can simply eradicate them whilst
    pondering how to support the stereoscopic vision of the future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35d81d97b38d05f132a4823e57fff4012e966504
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 22:32:47 2012 +0100

    sna/gen7: Defensively program default GT values
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fbdedbf9d509c5ca58ae0a01fe8e54dcc990cf8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 22:10:08 2012 +0100

    sna: Fix analysis of source extents for BLT composite
    
    After we have computed the source offset vector for the transformed
    source bo, we need to use that with respect to the destination rectangle
    to verify that the source sample is wholly within bounds.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c7f998f7bda4f4f1286e079412d5d3a5b2eb073
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 20:41:23 2012 +0100

    sna: Fix BLT composite offset
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54868
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2575cd0d236b4e1694e3185a487ebfd8bfe6499f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 20:08:37 2012 +0100

    sna: Avoid corrupting the CPU bo when compositing fallback data through BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5781de2e5ab0d7e8e62965bda714789879555ed4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 19:53:29 2012 +0100

    sna/gen3: Tidy NO_COMPOSITE debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd1432b2c00c94ac75af4740b66b5cd1a573e261
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 19:47:29 2012 +0100

    sna: Do not attempt to change tiling if wedged
    
    The caller will just have to live with the current tiling, which should
    be fine in most cases, in other cases the gpu is wedged...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c7dd2219fa777bf6354c4e0ef38a2f09fe09675
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 17:14:23 2012 +0100

    sna: Prefer to use indirect uploads for very small updates
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d87a56ed1789e0c5058b302bb930d7e952ff3e5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 13 09:57:30 2012 +0100

    sna: Teach sna_replace__xor() how to tile large uploads
    
    This path is hit using eog+cairo-1.10 and a large image, e.g.
    http://marsrovers.jpl.nasa.gov/gallery/press/opportunity/20120705a/PIA15689_Greeley_Pan_wDeck_L257F.jpg
    
    Reported-by: Michael Laß <bevan@bi-co.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54808
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58a96f0f684fe0d7d1a7890c630539ef8b065d1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 23:53:44 2012 +0100

    sna: Also remove bogus assertion from sna_replace__xor()
    
    Like the assertion in sna_replace() this is now incorrect due to the
    automatic flagging of large bo with flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6069e78238ca57e3433d528680fe04766a1e5307
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 16:22:49 2012 +0100

    sna: Keep a very small, short-lived cache of large buffers
    
    As we now regularly retire and so discard the temporary large buffers,
    we find them in short supply and ourselves wasting lots of time creating
    and destroying the transient buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e2a03ad19664e846ece4110e53d26babb5a2159
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 16:15:22 2012 +0100

    sna: Propagate busyness when creating the proxy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e28f5a2537821dc170a7ef78bf33ecbd3c032da0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 15:21:27 2012 +0100

    sna: Add some DBG as to why kgem_check_bo() flushes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1af1dae1feefd6567017170bab241570fb528e5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 15:20:49 2012 +0100

    sna: Ensure tiling upload buffers are trimmed to fit in the cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5f137807c318588f546960668345eef34159e26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 14:11:43 2012 +0100

    sna: Avoid fallbacks to shadow pixels if FORCE_GPU is in effect
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=54808
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d17208a66a7e54d4106f8a4034d3a928e28bb62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 14:04:50 2012 +0100

    sna: Avoid readback inplace if the target is unmappable
    
    We have to use the tiling indirect path, or else fail.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=54808
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b4abdaae94d164d5d0b2755907e76b9cbe0c988
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 12 13:47:26 2012 +0100

    sna: Flush after operating on large buffers
    
    As we know that such operations are likely to be slow and consume
    precious GTT space, mark them as candidates for flushing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15911f533d6a7ef40e42ba5921fac7c62b290f8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 11 14:59:53 2012 +0100

    prime: Reorder probe messages so that the driver prefix is correct
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc73acbd4da53bc50752c0413adcd0ce876e0a03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 10 18:55:04 2012 +0100

    uxa: Error out after failing to become DRM master during PreInit
    
    As we set the card fd to -1 upon failure, the error here is
    non-recoverable, so make sure it gets propagated and we abort loading
    the intel ddx.
    
    Bugzilla: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/962892
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0d14071f7b60729c223af925935227393fbd3ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 10 13:53:45 2012 +0100

    sna: Workaround issue with global glyph privates and shared ZaphodHeads
    
    Under ZaphodHeads we end up with multple screens accessing the common
    sna_glyph_key and so cause conflicting updates and erroneous references
    into the screen-local texture atlases.
    
    Two approaches can be tried here. Transition to a screen-specific
    private key introduced with xorg-1.13, or to move the glyph cache (and
    the rest of the gpu state tracker) down into the device private rather
    than screen private. This is neither of those, but a workaround to avoid
    reusing the incorrect entries from shared screens.
    
    Reported-by: Stephen Liang <inteldriver@angrywalls.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54707
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cfa0c6162bbd2f6edab1301b6aed886af7e8ab38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 10 10:50:03 2012 +0100

    sna: Fixup possible_crtcs for ZaphodHeads
    
    As the possible_crtcs is a bitmask of the available crtcs exposed to the
    Xserver, we need to adjust it for the limited view given by Zaphod mode.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95c71d1626dfbd97733e7e7e03fdde3af833446e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 8 20:12:32 2012 +0100

    NEWS: Fix version reference 'bugs since 2.20.6'!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0659711dfa9c9fc52adeaba766049887d5b6f040
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 8 20:01:32 2012 +0100

    2.20.7 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c8e48f8149499040342836491333402fd05b762
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 23:00:47 2012 +0100

    sna: Remember that LineDoubleDash involves updating the GC between segments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed7b8db24921dc0bb6ea59dacf35ea41a61d59bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 22:12:17 2012 +0100

    sna: Pass the hints down to the PolyPoint fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c9df48fa8f1ac93103ce771ae28f47faa321619
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 22:05:19 2012 +0100

    sna: Fix PolyPoint fallback through a complex clip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d76eb155ed78343abfa15b7c8af87fc3d4211e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 18:06:25 2012 +0100

    sna: First scan for a backlight associated with the device
    
    The goal is to find the right interface in a multi-GPU system.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2de7d2d8150d648815feb74a3ae2239b908b971e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 16:56:33 2012 +0100

    sna/prime: Fixup attaching the randr14 scanout pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 448808d8a4e78afa7fe90e318d6d7afdbff66190
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 14:31:52 2012 +0100

    prime: Allocate a GPU_SCREEN when not primary to fulfil the output sink role
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dce661ef3df5558fe9c9d85324ab3395a37b7ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 13:48:12 2012 +0100

    sna: And remember to update the ScreenPixmap after resize
    
    Fixes the regression from the previous commit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c39c363d7235d03f27337c731c0ffe3369bf713
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 13:07:52 2012 +0100

    sna: Protect sna_crtc_resize() against early invocation with no RootWindow
    
    If the outputs are resized very early on, in CreateScreenResources, then
    we will not yet have created a RootWindow and so trying to change its
    pixmap is a futile effort.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7879a5939cabcd8b804e19fc422d2022ab7e3a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 12:18:08 2012 +0100

    sna/dri: Fix the double-buffer pageflipping path
    
    Notably, we need to remember to exchange the front/back buffers after
    flipping!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2630c81937115602faa352fca369d89fbb926b33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 7 11:23:02 2012 +0100

    sna/dri: Make sure we set the SCANOUT flag when creating bo for pageflips
    
    In case we should be creating an untiled framebuffer, we need to make
    sure we honour the scanout alignment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeef03520f1b2a4b8638ff1ed4fbf19c9b35e7c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 11:46:53 2012 +0100

    sna/prime: Correct the pinning flag when importing the prime bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9bdf46d6c1a29b7b9e3d35e39a2e789334c0e1be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 11:38:08 2012 +0100

    sna/prime: Distinguish forms of pinned pixmap
    
    So that we can allow prime to replace the backing bo of currently
    exported pixmaps through DRI2.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39c4be2b0be66ed83bf059d3007f4143325e340d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 11:28:49 2012 +0100

    uxa: Distinguish forms of pinning
    
    This allows us to replace the prime bo to meet sharing requirements, but
    still maintain the integrity with other users.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 031fa1c1c1129e486a02ffb5b3b9071f03b60048
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 11:08:23 2012 +0100

    uxa/prime: Mark the pixmap as pinned once exported (similar to flink)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5d3f3818660cb875ce2ef4721c51bc95317b78d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 10:54:57 2012 +0100

    sna: Add is-pinned checks to changing the pitch on an existing bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2affe403baea78b9c94e3d726d1b9d8a0004f35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 10:24:04 2012 +0100

    sna: Apply the minimum 256 pitch to CREATE_USAGE_SHARED pixmaps as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbe4080816191ee97347128444f56bcc34858481
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 08:57:34 2012 +0100

    prime: Align pitch of shared untiled buffers to 256 bytes
    
    In order for nvidia to handle the buffers we are currently generating,
    they need to have a pitch alignment of 256 bytes. Make it so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5fb025267bf1019907dfcc60f0efef2691be436
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 6 08:55:46 2012 +0100

    sna: Correct assertions for adding damage that bypasses the region
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f5d5a37e57e63fa6e5b336a4847ce4422b89044
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 17:17:58 2012 +0100

    Add PlatformProbe to handle sharing of device entities
    
    Reported-by: Nick Bowler <nbowler@draconx.ca>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54561
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ddde40afc081f47a3b6b694aeb21682c240c9562
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 16:48:01 2012 +0100

    sna: Harden against initialisation failures
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=54561
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4627dc36fa56ab971cd90088bd29a597dd12dc02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 16:17:17 2012 +0100

    Revert "sna: Flush the batch before a render operation if the GPU is idle"
    
    This reverts commit ad57ac07a273bf376b74884de47d8ee1e7129fb8.
    
    These checks end up being too frequent and not allowing us to batch
    sufficient commands to offset the overhead of batch submission. Hmm.

commit 886f3cef4101a674bb62656cf7f3046643cae4b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 15:27:21 2012 +0100

    uxa: Fix cut'n'paste error in Option "Backlight"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6211d0914e2ed1cdd4cc2e170ee16129fc9f0d73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 12:33:08 2012 +0100

    uxa: Flush batch immediately after queuing a WAIT_FOR_EVENT
    
    We still encounter hangs with kernel-3.5 with the culprit being a wait
    on a disabled pipe. As we thoroughly check before that the pipe is still
    disabled and flush before a modeset, the only possibility that remains
    is that DPMS is disabling the pipe before we submit. Close that race by
    always submitting the batch immediately after a WAIT_FOR_EVENT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a1423547769c24d15f6475628981d14a76a4bb2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 12:15:52 2012 +0100

    sna: Initialise the empty boxes field of the region before subtracting it
    
    Fixes regression from commit 38fb77af757318e5fb6f605b37306ce4585b11a5
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Sep 5 08:23:34 2012 +0100
    
        sna: Don't upload ignored cpu damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dff25e5ec4071a0404f82760e8deec3f99f4a0a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 11:05:28 2012 +0100

    sna: Drop master after discarding framebuffers
    
    As Imre Deak pointed out in the previous patch, drmModeRmFB only works
    when we hold the DRM master, therefore to prevent a leak of the
    framebuffer across server reset we need to defer dropping master until
    after we release our scanouts and modes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46981d01700c1159bfb6bc0aebc938ff1d447a0f
Author: Imre Deak <imre.deak@intel.com>
Date:   Fri Aug 31 14:31:51 2012 +0300

    uxa: fix leakage of FB when closing the screen
    
    Calling drmModeRmFB is only allowed in DRM master mode. Since leaving
    the VT also drops master mode we need to remove the FB before calling
    I830LeaveVT.
    
    This is only a real leak in case of a server reset, otherwise the server
    process will exit anyway and the kernel will clean up the FB.
    
    Signed-off-by: Imre Deak <imre.deak@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55cef974a5dad3fda1922648fa27bcf5bb32ea03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 09:38:47 2012 +0100

    sna: Review validity of damage when discarding CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 587499bbf55b7eb0e1848822a792d535a8a3db1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 10:56:18 2012 +0100

    sna/video: Use the scanout flag and FB id for sprite framebuffers
    
    So that we can use the same teardown path as normal scanouts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 913adacc5400f94bc754f22375447e6f90ccd510
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 09:20:55 2012 +0100

    sna/gen7: Always emit a stall when flushing the texture cache
    
    Reported-by: Reinhard Karcher <reinhard.karcher@gmx.net>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=54488
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bdfedb46bd5bb3b96543a3ff553abd8ed0774fad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 09:15:12 2012 +0100

    sna: Use async upload only if the last render was not CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67b75ae6f66e2d8e97b0aaf70d66b6de30f9e67e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 08:46:39 2012 +0100

    sna: Tweak upload path to remove redundant code
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38fb77af757318e5fb6f605b37306ce4585b11a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 08:23:34 2012 +0100

    sna: Don't upload ignored cpu damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2eb32f711ddd65a55c3c21f813b41aca49635a22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 5 00:22:04 2012 +0100

    sna: Add DBG control to disable CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19e170aa6fd3652cc2e983a291f82350dca27e52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 23:52:42 2012 +0100

    sna: Fix comparison of memcpy overlap to include x-offsets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7895416eabfc5bd361d0d0ff92c570e2f6af47e0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 20:30:53 2012 +0100

    sna: Rearrange use_cpu() tests for composite ops to avoid syncing CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad57ac07a273bf376b74884de47d8ee1e7129fb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 20:06:49 2012 +0100

    sna: Flush the batch before a render operation if the GPU is idle
    
    Experiment with pushing those first commands earlier.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6325d7e29a8bacede321362c20bf3acd33c48651
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 14:51:54 2012 +0100

    NEWS: fixup missing links to bugs referenced in 2.20.6 release notes
    
    Reported-by: Adam Jackson <ajax@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc309bad39035649ee377c1d5af9099491a8ea43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 14:22:15 2012 +0100

    sna: And remember to flush the damage to the output slaves...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68d207588a177afa4e999260bfddb4d6dba1029b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 13:20:21 2012 +0100

    sna: Improve handling of output offloading
    
    In particular, don't forget to flush when we only have offload slaves
    and no native pixmaps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cf7ac776b9b47dabd5ab141e5a5385c44d3f309
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 13:55:34 2012 +0100

    sna: Fix a typo in an error message
    
    s/achieve/retrieve/ otherwise it is nonsense.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be83b98d299c74101357e7bf170b1451aec2e1f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 11:23:58 2012 +0100

    sna: Add some DBG to the prime paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0684d55e3a62c231c92a68403cf100c9e18351b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 11:05:43 2012 +0100

    sna: Fixup CREATE_USAGE_SHARED
    
    The DRI2 code tries to create pixmaps with non-zero width/height,
    whoops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6ced7a2267f9429ad38949dda39c843e2119e99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 4 10:05:46 2012 +0100

    sna: Fix typo for detecting prime ioctls
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df68723baae71498de95924c72d4f23fa7fc7fdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 3 20:43:48 2012 +0100

    sna: Port prime interfacing
    
    Preliminary prime support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3ad18036b4dca29744ecfa4694006f01dd3fd18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 3 20:53:30 2012 +0100

    sna: Enable platform probing
    
    Completing commit 0768ac4d195214825137152893deb74a87fcd11e
    Author: Dave Airlie <airlied@redhat.com>
    Date:   Wed Jul 25 16:11:23 2012 +1000
    
        intel: add platform probing support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dc644b2a959fc559e1138b332ed42d7235de42f
Author: Сковорода Никита Андреевич <chalkerx@gmail.com>
Date:   Mon Sep 3 13:44:21 2012 +0400

    uxa: Fix Backlight option support.
    
    Signed-off-by: Сковорода Никита Андреевич <chalkerx@gmail.com>

commit a972affe0c78b23a119d5dd14bb4446c89122af1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 17:43:33 2012 +0100

    sna/gen6+: Redirect fills if the destination is too large for 3D
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54134
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18d26076c778c20eb589b638fc47fa847793f149
Author: Dave Airlie <airlied@gmail.com>
Date:   Tue Sep 4 07:19:12 2012 +1000

    intel: fix return value for no pEnt
    
    Probably never gets hit but shuold return FALSE,
    
    pointed out on irc by Lekensteyn
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit d14ff42f2a205542df2ef723c6151d18db2bea8b
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Jul 26 10:43:29 2012 +1000

    intel: query kernel for caps to setup scrn capabilities.
    
    This queries the kernel for prime support before advertising
    the capabilities.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 6705d8237aca90964449e4dbee97b4f62b87c28b
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Jul 26 10:37:04 2012 +1000

    intel: add pixmap tracking and scanout support. (v2)
    
    This adds support for pixmap tracking and scanout of
    alternate pixmaps.
    
    v2: do dirty updates after uxa block handler, check if kernel
    can flush vmap for us so we don't have to.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 69827126abdfa289417b55fe7db8ae0535037185
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Jul 25 16:22:57 2012 +1000

    intel/uxa: add pixmap sharing support.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 0768ac4d195214825137152893deb74a87fcd11e
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Jul 25 16:11:23 2012 +1000

    intel: add platform probing support.
    
    This allows the driver to be loaded by the platform loading code.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 164ae7a4f9fd3e538f1b506031d297088fc0c659
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 17:19:12 2012 +0100

    man: Malformed "Backlight" section
    
    Reported-by: Matthew Monaco <dgbaley27@0x01b.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54397
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67b44104168650473a24e69056707e0b35f1713e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 12:47:36 2012 +0100

    sna: Cache the temporary upload buffer when copying boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b558281e04e4d4febfc361632a90f8a45080c49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 12:23:59 2012 +0100

    sna: Don't retire when searching for a snoopable buffer without hw support
    
    If the hw/kernel doesn't support snoopable buffers, then it makes little
    sense to search for one, and force a retire in the certainty of not
    finding any.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d933f3a7965c9aa70f70477be3bfe94d5ded948b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 10:29:49 2012 +0100

    2.20.6 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62e7e69d88f7e5c8b0f0931fe887ee0c3bddb43f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 2 09:55:07 2012 +0100

    sna: Tweak placement rules if we already have a CPU bo
    
    If we have a CPU bo, consider if it may be quicker to render to it then
    create a GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f837807cc257fbedd35fa6101dc0b4a57e5ad78d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 1 10:36:09 2012 +0100

    sna/dri: Remove busy-wait spin from vblank chaining of swapbuffers
    
    The issue being that, due to the delay, the chained swap would miss its
    intended vblank and so cause an unwanted reduction in frame throughput
    and increase output latency even further. Since both client and server
    have other rate-limiting processes in place, we can forgo the stall here
    and still keep the clients in check.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54274
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b56e8c5105c858452ca4eabf15b298fc06dfd3c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 1 12:15:47 2012 +0100

    sna: Nullify gpu_bo after free in case final release is deferred in destroy
    
    As we may defer the actual release of the pixmap until after completion
    of the last shm operation, we need to make sure in that case we mark the
    GPU bo as released to prevent a use-after-free.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4d994014160d8c946af731196a908991c77d9f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 1 10:44:24 2012 +0100

    sna/gen2+: Add the missing assertions in case the drawrect is invalid
    
    Only the later gen had these useful assertions, add them to the rest
    just in case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25c1b478a957ceb0474e7121840b7eed1ba2e140
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 1 09:49:34 2012 +0100

    sna: Discard cached CPU upload early when clearing with a solid fill
    
    Otherwise we end up considering the GPU bo as a real target, causing
    confusion and failed asserts.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 530b1d1516595cf14c5112d8833b870cd50eca46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 30 22:21:57 2012 +0100

    sna/dri: Use common routine for testing busyness after flush
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00d8c776b3607dbdab32c1126f91a7a38b8065f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 30 21:47:17 2012 +0100

    sna/dri: Hold a reference to the vsync blit
    
    Fixes regression from
    
    commit 96a921487ef00db03a12bec7b0821410d6b74c31
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Mon Aug 27 21:50:32 2012 +0100
    
        sna: Track outstanding requests per-ring
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2a6c74c2159c9968c19400d61a11f4773724b4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 29 14:51:40 2012 +0100

    sna: Remove inconsistent assertion
    
    As we now may not prefer to use the GPU even if all-damaged and clear,
    asserting that if we choose to use the CPU if clear is now bogus.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit deaa1cac269be03f4ec44092f70349ff466d59de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 28 22:23:22 2012 +0100

    sna: Align active upload buffers to the next page for reuse
    
    If we write to the same page as it already active on the GPU then
    despite the invalidation performed at the beginning of each batch, we do
    not seem to correctly sample the new data.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52299
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e0305a3928f253ded6c8e141a4dd42be3952eb9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 28 20:49:20 2012 +0100

    sna: Discard inplace flag if we create a CPU map for the upload buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3e122554e88da0351bfb9a7a722f0715553689b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 28 21:27:04 2012 +0100

    sna: Propagate the request to flush rather than directly submit the batch
    
    The subtly is that we need to reset the mode correctly after
    submitting the batch which was not handled by kgem_flush(). If we fail
    to set the appropriate mode then the next operation will be on a random
    ring, which can prove fatal with SandyBridge+.
    
    Reported-by: Reinis Danne <reinis.danne@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5c8efe4309248e62d94d80b37a70775284ae985
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 28 08:33:00 2012 +0100

    sna: Make sure we reset the domain tracking when exporting DRI bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96a921487ef00db03a12bec7b0821410d6b74c31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 21:50:32 2012 +0100

    sna: Track outstanding requests per-ring
    
    In order to properly track when the GPU is idle, we need to account for
    the completion order that may differ on architectures like SandyBridge
    with multiple mostly independent rings.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54127
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26c731efc2048663b6a19a7ed7db0e94243ab30f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 20:50:08 2012 +0100

    sna: Ensure that we create a GTT mapping for the inplace upload buffer
    
    As the code will optimistically convert a request for a GTT mapping into
    a CPU mapping if the object is still in the CPU domain, we need to
    overrule that in this case where we explicitly want to write directly
    into the GTT and furthermore keep the buffer around in an upload cache.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52299
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cbf88980ede50370b97f32e565dea33db16ac44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 20:07:17 2012 +0100

    sna: Force the stall if using a busy ShmPixmap bo with PutImage
    
    As we will stall in the near future to serialise access with the
    ShmPixmap, we may as well stall first and do a simple copy using the
    CPU in this highly unlikely scenario.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 705103d77e6b80d796a4535cade96cb6e9ebece3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 20:07:19 2012 +0100

    sna: Add a modicum of DBG to kgem_is_idle()
    
    Print out the handle of the bo we just checked.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8218e5da2b177ca9cd0e2b1e7dbe114e5ef2ebf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 19:36:03 2012 +0100

    sna: Fix crash with broken DBG missing one of its arguments
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=54127
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 593f549b45fbb1528472feed51207d84901d142e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 16:43:19 2012 +0100

    sna: A little more DBG to try and identify ratelimiting ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71ac12e9b6ed00c28993637aafd5186a2ba26256
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 15:49:59 2012 +0100

    sna: Assert that the bo is marked as 'flush' when exported to DRI clients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf64c8ce758cfa5d3bcd1b7626ff94cce7a84636
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 13:59:56 2012 +0100

    sna: Upload PutImage inplace to a fresh GPU bo if the device doesn't snoop
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c6758fc4a50ecfce9ed317fec669cc48addedcf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 11:58:05 2012 +0100

    sna: Flush the batch if it references a ShmPixmap and the GPU is idle
    
    This helps minimise the stall when syncing with the GPU before sending
    the next reply to the Client.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f21079bad6e8316baf5d0295d6e7a809041bce06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 27 11:25:28 2012 +0100

    Revert "sna: Cleanup composite redirection after substituting the BLT"
    
    This reverts commit 5a5212117e7a73ce3fffb87c60a505a849e38c36.
    
    The clean up is in effect too early, as this is during preparation and
    the actual work is already being correctly done at the end.

commit 414e87255cdee6eb556703ddefd194af71b985ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 19:47:31 2012 +0100

    Add Option "Backlight" to override the probed backlight control interface
    
    The automatic selection may not correspond with the correct backlight
    (such as in a multi-gpu, multi-panel device) or the user may simply
    prefer another control interface. This allows them to override the
    chosen interface using
    
      Option "Backlight" "my-backlight"
    
    to specify '/sys/class/backlight/my-backlight' as the interface to use
    instead.
    
    Suggested-by: Alon Levy <alevy@redhat.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=29273
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4f7c58186849374cd929e20fa49ea2e93939a69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 17:01:55 2012 +0100

    sna/gen5+: Use the common methods for choosing the render targets
    
    This should afford us much more flexibility in where we render.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c88b5f693c29b990d69f96508b121ce97a7209e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 25 11:49:30 2012 +0100

    sna: Use a fast span emitter for mono trapezoids without damage or clipping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e10a5b348a37feadcf935ec7694e46cc0802bdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 14:53:12 2012 +0100

    sna/gen6+: Do not call sna_blt_composite() after prepping the composite op
    
    As sna_blt_composite() will overwrite parts of the composite op as it
    checks whether or not it can execute that operation, it will lead to a
    crash as the normal render path finds the op corrupt. (The BLT
    conversion functions cater for the cases where we may wish to switch
    pipelines after choosing src/dst bo.)
    
    Reported-by: rei4dan@gmail.com
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cbbe7727e766a5ee8767673feb6c8cdec38a7051
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 14:43:47 2012 +0100

    sna/gen6+: Simplify prefer_blt_bo
    
    As we already check the tiling state, so all we need to then check is
    that the pitch is within the BLT constraint.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c15824a8143a288716d2eacf03252cc54eb9466
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 14:29:41 2012 +0100

    sna: Add some DBG to kgem_is_idle()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d432983421286d343f7c487c12c7244b711f5a66
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 13:43:35 2012 +0100

    sna: Add some DBG to BLT composite substitute to show if redirection is used
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a5212117e7a73ce3fffb87c60a505a849e38c36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 13:38:23 2012 +0100

    sna: Cleanup composite redirection after substituting the BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 335821d588460c253b2ba2c8616a7c46e5ad0150
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 13:29:04 2012 +0100

    sna/gen4+: Check for allocation failure for the clear solid bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5c77a6aaf520e331e82409b2592911cb1bb3100
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 26 12:48:18 2012 +0100

    2.20.5 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 454cc8453af1852758c3396dbe303c13c5c1be27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 24 08:48:12 2012 +0100

    sna: Submit the partial batch before throttling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e1e83ed4952f620e9422e58f955a5aea406e300
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 24 00:59:31 2012 +0100

    sna: Allow the batch to be flushed if the GPU is idle upon a context switch
    
    Submit early, submit often in order to keep the GPU busy. As always we
    trade off CPU overhead versus concurrency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5059db0697c5516f1538f7062937664baf7b1c2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 24 00:21:07 2012 +0100

    sna: Correct a pair of DBG messages
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5b46e411a2c738c5ae55bffb9b3d460249f5c24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 23 17:36:10 2012 +0100

    sna: Tidy up users of __kgem_bo_is_busy()
    
    A lot of callsites had not been converted to the common function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82e91327d57e03d2117638165f298a50b946fcaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 23 15:59:00 2012 +0100

    sna: Use a temporary userptr mapping for a large upload into a busy target
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b286ffa6beccb8fe341c464a4fb9f2af98541263
Author: Eric S. Raymond <esr@thyrsus.com>
Date:   Thu Aug 23 12:42:18 2012 -0400

    Fix seriously malformed list syntax on intel(4).
    
    Signed-off-by: Eric S. Raymond <esr@thyrsus.com>

commit fc6b7f564df88ca773ae245b1b4e278b47dffd59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 23 15:13:14 2012 +0100

    sna: Flush the batch if it contains any DRI pixmaps
    
    This fixes a regression from
    
    commit 02963f489b177d0085006753e91e240545933387
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Aug 19 15:45:35 2012 +0100
    
        sna: Only submit the batch if flushing a DRI client bo
    
    which made the presumption that we called sna_add_flush_pixmap() for
    every DRI pixmap that we used. However, that is only called for the
    dirty pixmaps, any native exported pixmap only marks the batch as
    requiring a flush. So in those cases we always need to submit the batch
    if it contains an exported DRI pixmap.
    
    Reported-by: chr.ohm@gmx.net
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=53967
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd38f45ec5421802b426867a050c978a2feec937
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 23 12:11:48 2012 +0100

    sna: Mark the CPU damage as needing flushing for DRI buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac6cb667546a82b865c959a1be32f52b2da7bf7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 12:00:49 2012 +0100

    sna: Flush before adding any SHM pixmap into the batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 785c1046b94fd9ca6f22b2a6d73639408a411cea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 10:56:12 2012 +0100

    sna: Only use the GPU for an active CPU bo unless forced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8032f51859ce1928922edf6892f493a84d9c39f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 10:40:53 2012 +0100

    sna: If we cannot use the CPU bo along a render pathway, promote to GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc967507bbf357e1d5ec3cd0f3c0c5ecfa8b867a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 10:36:04 2012 +0100

    sna: Convert to using IGNORE_CPU flag rather than complicating the CPU damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5aa59ce7c012eb309c4f5a362ccf531c065bd7ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 10:10:33 2012 +0100

    sna: Assert that the CPU bo is not used if the GPU is clear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 273765033223024ff6a662195e0e4b96f8960463
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 00:48:08 2012 +0100

    sna: Make sure the opposite damage is destroyed after reducing to all
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31e398c9dbd8539e6fd2cc7398e97ee1df2f7f23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 00:38:17 2012 +0100

    sna: Discard a no-longer-used GPU bo after moving to the CPU domain
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8be15c37df9d9b34e0f21700673212bd19c772b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 22 00:27:00 2012 +0100

    sna: Balance CPU bo accounting for SHM pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 262d57a5aaac46508d8e29860c7a567bcd5bc4d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 21 23:36:12 2012 +0100

    sna: Display still resident memory in inactive/snoop caches under DEBUG_MEMORY
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 304581cc02adeb865a24edde934b5b9ceba68d96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 21 23:29:12 2012 +0100

    sna: Add a DBG to log pixmap destruction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 946d54238d90f5e31772f0df336ac9a5e7f2d62b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 21 21:02:00 2012 +0100

    sna: Fix the assertion for tracking proxies in the batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ee2e227ddf61c87f08f55d4922d2562b563ca87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 21 00:28:40 2012 +0100

    sna: Mark all levels of a proxy as dirty
    
    So that if we write to a surface through one view, we make sure that the
    sample cache is invalidated for all future views.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eee181e9d71273d94fe735805ed84e8f7b7b2180
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 21 00:19:10 2012 +0100

    sna/gen6+: Only mark the dst as dirty again if it already is in the batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c86df17c1455a53cb52f33a25c8c362e5331621e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 22:54:06 2012 +0100

    sna/gen3: Fix assertion to check the freshly allocated vertex bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6aabe90587f4916a01a1cd2bbc577a1e7fa20eca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 22:09:54 2012 +0100

    sna: Allow target bo promotion to GPU even on old architectures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a4b6fea7b1516de35e6800efa5b85f8401a5b2a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 22:08:23 2012 +0100

    sna: Assign a unique id to snoopable CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 892b1a1e431e8f27133825f8a27dde4955da0054
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 22:07:05 2012 +0100

    sna/gen3: Convert to sna_drawable_use_bo()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ca1bfb51ba522454433d58131e7dab7fcbe7e34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 21:28:47 2012 +0100

    sna: Trim a parameter from kgem_bo_mark_dirty() and add some assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16f3d3a9ae145a3af51d2c0c42c6c585d676a863
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 19:42:22 2012 +0100

    sna: Keep a stash of the most recently allocated requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb349ced91e15ecaa025321bd37d1fe3cfdd2f44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 17:35:44 2012 +0100

    sna: A few more buffer cache management assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae6b3c7508d570af94f172d6a91d62d2987d654b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 17:03:16 2012 +0100

    Check that the module that indeed i915 before using custom ioctls
    
    Thanks to Adam Jackson for pointing me towards drmGetVersion() and
    Julien Cristau for saying "Yuck!"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c611087e8ae09fc3fe4271f16d912ac8ae89f6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 16:09:25 2012 +0100

    Only open the matching BusID and not the first named
    
    If you pass a name to drmOpen() it will attempt to open any device
    corresponding to that name if it first fails to open the device
    corresponding to the BusID. Obviously we want the failure from opening
    the specified device in order to prevent wrongly opening the first found
    device multiple times.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd6c67b32f726b6ad7f12f3b83f6d8c868ff4dc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 15:58:03 2012 +0100

    sna: Add a couple of buffer cache management assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 01ebdb4d7a8bb751167153554f9122d996e4ea91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 15:33:26 2012 +0100

    sna: Remove confusing is_cpu()
    
    The only real user now has its own heuristics, so convert the remaining
    users over to !is_gpu().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 410316d20299b9ed3447d1d897f904af786ed097
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 14:56:12 2012 +0100

    sna: Refine decision making for maybe-inplace trapezoids
    
    In particular, we want to avoid preferentially taking the CPU paths
    when it may force any migration (including clear).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91f1bf971f9cdc6498f513a5ddec1ad7a4e24b3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 15:27:27 2012 +0100

    sna: Correct ordering of calls to memcpy for BLT cpu composite paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 027569bf83fc6d67dca7cfd65fdfa37ef6b47204
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 12:55:20 2012 +0100

    Missing includes for b5b76ad849b
    
    The warnings of implicit function declarations were lost amongst the
    noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1b259f627814c765ea93d8c839ee7533249974f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 12:51:51 2012 +0100

    sna: Add a modicum of DBG for PolyFillRect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5b76ad849bfda1e75192d1cb3c6c0fcc623bb91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 12:01:39 2012 +0100

    Sanity check that the driver is an i915.ko GEM device before claiming it
    
    This fixes an issue with us claiming Poulsbo and friends even though we
    do not speak their language.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74f998136bac441d782faf779616af6f7bdcadad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 11:07:55 2012 +0100

    sna: Avoid migrating the BLT composite src to the GPU if the dst is not
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a05643eb670e91ab102465df799301def88faaf9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 10:46:14 2012 +0100

    sna: Remove unneeded source bo unref after __sna_render_pixmap_bo()
    
    As __sna_render_pixmap_bo() deliberately does not reference its returned
    bo, we need to avoid unreferencing it else we cause explosions later.
    
    Fixes regression from commit a13781d19defc97af6a279c11a85e33ef825020e
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Aug 19 09:45:12 2012 +0100
    
        sna: Enable BLT composite functions to target CPU buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c80db9bc2ef0a37a4abb78c9ef667c8b36ab6fba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 20 10:45:36 2012 +0100

    sna: Flush the batch before preparing for a FlushCallback
    
    As we end up submitting and maybe synchronising upon a batch within
    FlushCallback (or our client will) it is important that we start that
    serialized batch as early as possible to minimise the impending stalls.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c39fe0253847f5a86e16b47ba420c8ba819c9110
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 20:42:55 2012 +0100

    sna: Do not use the GPU to migrate to the CPU whilst wedged!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe05268d70088c8cad5f4b5ef756e1ffe2069fca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 19:28:42 2012 +0100

    sna: Experiment with flushing the batch prior to rendering to a ShmPixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bbd7a825810cc9772e6d613df449cb5ecb0be3f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 19:28:20 2012 +0100

    sna: Don't promote a ShmPixmap to GPU for a CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bf7a5ad1057f1aeb5b261da6dc501323c022287
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 19:17:35 2012 +0100

    sna/gen3: Tidy vbo discard
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1b808fd72b477bde96f7c6737a993bd1a20baf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 17:53:24 2012 +0100

    sna: Tweak is_cpu/is_gpu heuristics
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c682c1a37692021cbd9bfc1e3f1ccf2b648c73f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 17:28:25 2012 +0100

    sna: Discard GPU (and damage) after applying clear on migration to CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc83ef49f9e8ff94ab77aa9d54fe29e32b9d7a3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 17:20:45 2012 +0100

    sna/trapezoids: Accept more operators for maybe-inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47d948f5df0cd0e975cfe5183b6ce79cd3fd27ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 17:09:21 2012 +0100

    sna: Update maybe_inplace to recognise more types of handled pixel formats
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02963f489b177d0085006753e91e240545933387
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 15:45:35 2012 +0100

    sna: Only submit the batch if flushing a DRI client bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13d1a105159222518800d3c5ad5660725864ec6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 09:48:05 2012 +0100

    sna: compare the correct trailing dword when skipping identical bitmap lines
    
    Fixes regression in 2.20.4 from
    
    commit 85192f00e345830541e3715e211b1f98154bbef4
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Aug 8 12:11:50 2012 +0100
    
        sna: Ignore trailing bits when comparing lines inside the bitmap
    
    Reported-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=53699
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a13781d19defc97af6a279c11a85e33ef825020e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 19 09:45:12 2012 +0100

    sna: Enable BLT composite functions to target CPU buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be940856c74fbedd27997dd61e2a85959b321193
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 21:23:03 2012 +0100

    sna: Consider sample wraparound in each direction independently
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 110c7ef7f6c31929affa038918e6ce087bccddc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 17:42:51 2012 +0100

    sna/damage: Replace the damage with a larger box if subsumed
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75a2fab766d8aed180ef795919e503db22c0e0fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 17:28:08 2012 +0100

    sna: Avoid forcing an upload for an unblittable bo unless on a fallback path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 110d5519f3523b1e2c50db637cdc4c5bc44c960a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 16:39:52 2012 +0100

    sna: Reduce subtracted damage earlier
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8812e8b6e89e6432a6a768a0566ce4c153e9b256
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 16:21:13 2012 +0100

    sna: Reduce damage after a large composite operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e361627b90ea6bf2f9a8c46cf8debe562fdf4f09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 16:16:17 2012 +0100

    sna/damage: Add some more sanity checks for creating empty regions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10f334872e9dd190e18c768219e60815acabe4d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 15:49:02 2012 +0100

    sna: Add damage for the whole unaligned trapezoid not per component
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ff6198c9346d84717bac28980329b048f4406e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 11:59:56 2012 +0100

    2.20.4 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc77a466531fdbdd21e9354af567e5215a66edf9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 18 11:09:23 2012 +0100

    sna: Silence a couple of recent compiler warnings
    
    sna_accel.c: In function 'sna_poly_fill_rect_extents':
    sna_accel.c:11438:11: warning: unused variable 'v' [-Wunused-variable]
    
    sna_blt.c: In function 'sna_blt_composite__convert':
    sna_blt.c:1712:3: warning: format '%s' expects a matching 'char *' argument [-Wformat]
    sna_blt.c:1738:3: warning: format '%x' expects argument of type 'unsigned int', but argument 4 has type 'CARD32' [-Wformat]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1da2c71461798bb027a260ff8480b71ebffde26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 21:15:54 2012 +0100

    sna: Correct assertion for StoreColors
    
    Fixing the assertion reveals that it was bogus!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31ddaa0cfbde083aef42d9fdb5ed13bb4edc36c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 21:13:52 2012 +0100

    sna: Fixup DBG after 7f5a9e3
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8bc56c12c6fdc559354fbbf96b6e043a491aa8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 21:00:57 2012 +0100

    uxa/gen3: Simply simple fill shader generation
    
    Suggested-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 182581edde356a21a0681de526f83884e1a0de5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:59:09 2012 +0100

    uxa/glamor: Check for failed prepares
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c289b607d1526d8d3625fa84c093552a9f3ea168
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:54:40 2012 +0100

    uxa: Check for failed mmapping of the scanout
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32ec8b979bc8cf7d8ce351ca752b806d42bc1c0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:53:08 2012 +0100

    test/dri2: Discard error returns from _XReply
    
    This is only test code, so keep the static analyser quiet
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5675c36e0dca92b8d24235d82cd0e87f82fdc7b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:44:32 2012 +0100

    sna: Check for failure to pin the front buffer
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9db2c74ab3b482489bec63b11df80bb35e21aca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:42:50 2012 +0100

    sna/gen2: Add break rather than fallthrough
    
    The fall-through in this instance is irrelevant, and the static
    analysers complain for not commenting on the fall-through. Silence the
    analyser by removing the fall-through.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0abbc3ccafb51d6b2114e1c7d6dc2eda3a8c1f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:40:17 2012 +0100

    i810: Query PortPriv for the surface properties
    
    Avoid the NULL deferences.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c09518f98d5c533860b084506d9ee2c819cca52f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:32:53 2012 +0100

    sna: Fix assignment inside assertion (should be an equality check)
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d3e4328d4f4421178377933ca98fb80daa85c76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:32:11 2012 +0100

    sna/glyphs: Fix potential leak of glyph extents (for many lists of many formats)
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b00c82df78cb8820c0e32fbecc7c933eed81d52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 20:30:52 2012 +0100

    sna: Remember alpha-fixup for BLT upload
    
    Still dubious whether this is truly beneficial...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94871944a0e1351273d6029df7bf0300f31a8571
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 16 00:07:58 2012 +0100

    sna: Avoid conflating tearfree and randr shadow modes
    
    For ordinary TearFree we do not want to adjust the crtc offsets.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a389842347bab9d91240444e161589071eb9a47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 15 23:07:16 2012 +0100

    sna: Avoid queuing a pageflip on a DPMS off pipe
    
    If the pipe is not running, attempting to queue a pageflip will result
    in an error and us disabling the output in retaliation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 615739556dd1cc4565eb1c47f93fe8abd697802f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 15 20:10:52 2012 +0100

    sna: Only continue to update the shadow buffer if the flips succeeded
    
    If the flip fail, we disable the crtc and may end up disabling the
    output, removing the shadow (and old scanout bo) in the process.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2554d0d76e0fcae6e324938c28bb50deeb8814dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 15 18:04:18 2012 +0100

    sna: Submit the batch upon destroying a ShmPixmap
    
    The midlayer has already detached the pixmap from the segment (possibly
    destroying that segment in the process, thanks midlayer!) so we need to
    submit the batch asap before the segment disappears.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e604d721be5a1c0f8eaf91e3a5cf8c01a609a69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 15 16:53:20 2012 +0100

    sna: Flush shm pixmaps after upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f5a9e30c953c174a4d6bc83e0b0a5e068cbda52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 15 09:34:24 2012 +0100

    sna: Remove zero-size rectangles fro PolyFillRectangle
    
    Some applications like to waste precious bw by attempting to fill
    zero-sized rectangles; remove them upfront rather than process them.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c882f4fa991ef379e416628eb41cd2178818ad1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 14 16:02:38 2012 +0100

    sna/gen2,3: Prevent dereferencing a NULL bo with solid render fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48f436d3705059711097a222aac65f862b4a5cfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 14 15:05:33 2012 +0100

    sna: Defer the release of a busy SHM pixmap until the next flush callback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f07d1fc0181f22da36837337241f228626e0d88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 14 12:03:24 2012 +0100

    sna: Enable use of shm pixmap for readback
    
    A little too overzealous in the degradation of writing to the CPU bo
    if we need to read from a GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b016d2e466f342cc6649504fa48ab6a810c7e94
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 12 21:36:30 2012 +0100

    sna: do not bother attaching to a miniscule ShmPixmap
    
    If the pixmap is less than a page in size we are unlikely to recover the
    cost of tracking it via the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f4de90709264ad19a3e3f5f0f79f4bba78a760a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 12 13:01:24 2012 +0100

    uxa: Only emit a warning if we fail to tile the frontbuffer and the hw allows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d3cafc99ab49da6744046bc2004981144cb064d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 12 13:02:43 2012 +0100

    sna: Fix compilation without pixman glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc18eaa585c36c8e5f5b4ec405a976a835fd2ac3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 12 10:34:10 2012 +0100

    sna: Make the failure to create render caches non-fatal
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b580abdfa68108f3e63ee1f897b6ea83b9c47935
Author: Dave Airlie <airlied@gmail.com>
Date:   Sun Aug 12 20:52:12 2012 +1000

    intel: fix video xvPipe range check
    
    Pointed out by Russell King on irc.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 44f848f9b2f2a2dcd9087210ea46bc4fdb63c057
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 19:44:15 2012 +0100

    sna: Fix typo in computation of texel offsets for tiled 8x8 blts
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=53353
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b335d369bbcbfaef878795a5c8e72c2d40d3a536
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 12:59:49 2012 +0100

    sna: Discard the GPU bo after syncing to CPU bo for writing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 029934662e0bad6cf47baf4d7202656dd3e0ba08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:47:44 2012 +0100

    sna: Add a little DBG for promotion of CPU source bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f20f8556bfc8b4df6ba5050cca656a4ff0fdf18f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:46:40 2012 +0100

    sna: Treat ShmPixmap as ordinary
    
    In theory the code handles the automatic promotion and demotion of the
    GPU buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16c751a06c503b85c5ab6588bae277af4348487d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:44:08 2012 +0100

    sna: Only mark userptr bo as snooped on non-LLC architectures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59359dba6496229eff7c60dd04536c5add69cec8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:25:40 2012 +0100

    sna: Mark SHM userptr bo as unreusable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64488010504a6e76008bb3b3c1e61caeb025913c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:21:39 2012 +0100

    sna/gen2-5: Substitute an equivalent BLT composite operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f464d508c870293699616626d64bd64f16051467
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 10:10:32 2012 +0100

    sna/gen6+: Try to use the BLT to avoid TLB misses
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9c0e54e69a5ce93bb4e79d56da4a83fddf49c4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 11 08:58:14 2012 +0100

    sna: Handle userptr failures more gracefully
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d6d9231cd2003fda1c6f2dd3174014317a45704
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 10 23:07:07 2012 +0100

    sna: Reset BLT state after copy-boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50bfc172f1f89c023bb3a47418b845e31eba7126
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 10 22:49:26 2012 +0100

    sna: Improve a DBG statement
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b33f6754a99f6d11e423d6a03739fa2c04eeed88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 10 21:59:36 2012 +0100

    sna: Add assertions to 8x8 tiled BLTs and reset BLT state afterwards
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=53353
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff54d4af39edcddd55f597c404ab6dd548a24aa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 10 21:41:38 2012 +0100

    sna: Add a couple of debug options to control use of BLT patterns
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=53353
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22306144030b5d37df6d46321555bced6e33c50c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 19:45:09 2012 +0100

    sna: Use the HAS_SEMAPHORES parameter when available
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 465ae1840a883c50d5a5aab7380b30527f00e17b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 12:23:25 2012 +0100

    sna: Use a compile time constant for determine the zeroth bit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85192f00e345830541e3715e211b1f98154bbef4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 12:11:50 2012 +0100

    sna: Ignore trailing bits when comparing lines inside the bitmap
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit edc1427f3dcddb73acdb5b5e03756ecb30cb3797
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 10:53:40 2012 +0100

    sna/gen5: Add DBG for context switching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fec78ddc60b1f03097b334672546c2c7ef21ab4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 10:08:52 2012 +0100

    sna: Add DBG option to disable discarding of glyph masks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0cd430082d219500729d20c4740440e58773892
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 10:07:06 2012 +0100

    sna/gen5: Fix use of uninitialised rgba value for DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ad923f95c59cdf42363f95c7dd52188c0987296
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 8 09:59:50 2012 +0100

    sna: Minor DBG for fallback glyphs and discarding the mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a0590d133ea6991e0939d1f170f9c10df6856a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 7 17:16:35 2012 +0100

    sna: Check the composite extents against the clip
    
    When computing the composite extents (as opposed to the composite
    region) also check if the resultant box overlaps the destination clip
    region (we know it already fits into the extents). This helps in cases
    with small roi against clipped drawables, such as drawing text onto
    expose events.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=51422
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f5a10ef04a8c01b22da2284583851d84273dc2a
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Mon Aug 6 18:48:09 2012 -0300

    Add Haswell PCI IDs
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    Reviewed-by: Rodrigo Vivi <rodrigo.vivi@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8f7f933bc2d30e529730521d5628c10df0361de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 5 17:18:54 2012 +0100

    sna: Format markup to suppress compiler warning
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d0a259988f67f5c569c5d8000c010a7b662efd3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 15:54:19 2012 +0100

    sna/gen6: Compile fix for DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d917a276bff4e933590e78404526b929b6b3b497
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 18:05:03 2012 +0100

    sna/gen4: Restore the w/a flush for fill/copy as well
    
    So far, it looks like that the only one we can indeed drop is the
    composite with mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d754bc3435889b5d19085588c9c888dc08f9522e
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Nov 7 23:29:29 2011 +0100

    Fix build failure when passing --with-builderstring.
    
    If --with-builderstring="foo" is passed to configure (and sna enabled):
      CC     sna_driver.lo
    src/sna/sna_driver.c: In function 'sna_init_scrn':
    src/sna/sna_driver.c:1023:7: error: token ""foo"" is not valid in preprocessor expressions
    
    Fix the missing defined() around the BUILDER_DESCRIPTION variable.
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>

commit 4bad76b4510d8cf4ccf3f64bcd13ebb80fae4d26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 14:28:41 2012 +0100

    sna/dri: Don't force ring selection if we have semaphores
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb7b584ec9d0ea96175ba3a621699378c6724940
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 14:27:46 2012 +0100

    sna/dri: Correct ring selection for a busy bo
    
    Confused the RENDER ring with the BLT, limiting swap performance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20e58077fe071fd03d44a97194aa163376dc46a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 11:21:10 2012 +0100

    sna/gen6: Reduce ring switching for overlapping copy boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2345227663f443baa3c30bdf8b8c33827b7f4947
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 11:12:12 2012 +0100

    sna/gen7: Use a temporary to avoid switching rings for overlapping copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61ec2999afd5dad22580e024421f13afe7c82f3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 10:33:05 2012 +0100

    sna/gen4: Restore w/a flush for video
    
    One flush removal too many, keep those fingers crossed that the others
    do not make an unwanted return.
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=53119
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5833ef173a01afb710acf10e806b83c5ca6efc09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 4 09:31:41 2012 +0100

    2.20.3 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 036b90f099af21e60fb4c3684616daf1927f705e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 3 21:41:59 2012 +0100

    sna/gen7: Correct number of texture coordinates used for video
    
    Fixes regresion from
    
    commit 33c028f8be829caa4fdb9416ff177dc71f24b68e
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Wed Aug 1 01:17:50 2012 +0100
    
        sna/gen6+: Reduce floats-per-vertex for spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05dcc5f1699ba90fc14c50882e8d4be89bc4a4f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 3 15:08:45 2012 +0100

    Pass the chipset info through driverPrivate rather than a global pointer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b3f4ca33a00440a7005fef69099f8dbaddbbad1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Aug 3 14:27:51 2012 +0100

    Unexport intel_chipsets
    
    Only used by the core module code, so make it static.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ff749727d3590368806508ac0d0fa8efd1d1d51
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 22:21:29 2012 +0100

    sna/gen7: Add constant variations and hookup a basic GT descriptor for Haswell
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd028cad3dc9b059a3d83b818d581f86e16ec317
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 13:17:11 2012 +0100

    sna: Limit the batch size on all gen7 variants
    
    Seems the limit on the surface state size is common across the family
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4cd9ec9d404d934268952a1058afa07741b09efe
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri May 4 18:26:46 2012 +0200

    uxa: fix 3DSTATE_PS to fill in number of samples for Haswell
    
    The sample mask value must match what is set for 3DSTATE_SAMPLE_MASK,
    through gen6_upload_invariant_states().
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>

commit 412668464cf9505629eac20001701af3402dc6e8
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri May 4 17:55:10 2012 +0200

    uxa: set "Shader Channel Select" fields in surface state for Haswell
    
    For normal behaviour, each Shader Channel Select should be set to the
    value indicating that same channel. i.e. Shader Channel Select Red is
    set to SCS_RED, Shader Channel Select Green is set to SCS_GREEN, etc.
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>

commit a47ba68996f117fabcb601d35bcc5f99cbcd6122
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri May 4 17:17:22 2012 +0200

    uxa: fix max PS threads shift value for Haswell
    
    The maximum number of threads is now a 9-bit value. Thus, one more bit
    towards LSB was re-used. i.e. bit position is now 23 instead of 24 on
    Ivy Bridge.
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>

commit ce4421e175ceb9259208c7c223af8d66282c3db3
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri May 4 17:09:19 2012 +0200

    uxa: use at least 64 URB entries for Haswell
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>

commit 8c880aa34c522b0d67cbb932771f00c947d00dec
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri May 4 17:43:19 2012 +0200

    uxa: add IS_HSW() macro to distinguish Haswell from Ivybridge
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>

commit 0c0d1d956a8ba37d9e6f4a5e4f52018c8ce498e5
Author: Gwenole Beauchesne <gwenole.beauchesne@intel.com>
Date:   Fri Aug 3 12:03:00 2012 +0100

    Introduce a chipset identifier for Haswell (Ivybridge successor)
    
    Signed-off-by: Gwenole Beauchesne <gwenole.beauchesne@intel.com>

commit 146959dd5ef28384a3db4fce4bf7840f2b3ec58c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 23:43:15 2012 +0100

    sna: Drop the clear flag as we discard the GPU damage
    
    Hopefully only to keep the sanity checks happy...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7404e3085b2ee36fa24f77a02d156b4b1d2dff60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 23:37:35 2012 +0100

    sna: Ensure we only mark a clear for a fill on the GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca46d1c7a18596ea9fe2b0577ccf1d110e3e42ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 20:20:29 2012 +0100

    sna/gen7: Prefer the BLT for self-copies
    
    Looking at the test results for a third time, gives the edge to the BLT
    again.

commit e4a3cd3d16447b5d83d1c8c63c342f1240935267
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 17:37:33 2012 +0100

    sna: Add validation of the clear flag to pixmap debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eaeda34bef711cc566f51dee092a19a3c4ac1a16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 16:23:05 2012 +0100

    sna: Fix computation of st values for SIMD8 dispatch
    
    Fixes regression with enabling 8-pixels.
    
    Reported-by: Mehran Kholdi <semekh.dev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=53044
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55231eca818c82620c0146384b19b5d5659f6cd6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 16:22:23 2012 +0100

    sna/gen6: Install a fallback 16-pixel shader
    
    In case the DBG options leave no shader compiled, make sure we always
    supply one.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e79c1fef064ce68914eb644edd7f588be3d7300
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 15:58:43 2012 +0100

    Revert "sna/gen7: Prefer the BLT for self-copies"
    
    This reverts commit 89e75dbcb6749bde7587ecc08abed276c255e7f9.
    
    Having removed the forced stall for a RENDER self-copy there is no
    longer a need to encourage ring switching.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85cef78a40c6a7a0254f8fba685f224eac6038e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 13:39:36 2012 +0100

    sna/gen7: Simplify the force-stall detection
    
    After reducing the number of conditions where we think we need to force
    the stall on the results, we can then simplify the code to detect
    that remaining case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9391a2c71f020541a2a62ae68eadd486216a38df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 12:50:32 2012 +0100

    sna/gen7: Only force a stall for a dirty target if also used as a blend source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a4bb8663b9fa9b39d13bfb49aea30f2aaecce78
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 11:19:27 2012 +0100

    sna/gen4: Flush not required between fill vertices, only nomaskcomposite
    
    A small breakthrough... Still need to flush the primitive between state
    changes though.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33c028f8be829caa4fdb9416ff177dc71f24b68e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 01:17:50 2012 +0100

    sna/gen6+: Reduce floats-per-vertex for spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b2873d3d97b6780d878bd9b821fba0302470f9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 1 00:01:15 2012 +0100

    sna/gen4+: Implement an opacity shader
    
    Avoid the cumbersome lookup through the alpha gradient texture and
    simply multiply the incoming opacity value. The next step will be to
    reduce the number of floats required per vertex.
    
    Now that we have removed the primary user of the alpha solid cache, it
    may be time to retire that as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd3a1236051265fab700aad689a171de47d7338f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 31 10:20:51 2012 +0100

    sna/gen6: Enable 8 pixel dispatch
    
    This gives a small performance increase when operating with rectangles,
    which is reasonably frequent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8922b804bc9ed27957c81f7cda4812ab4ecbd4de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 31 10:20:51 2012 +0100

    sna/gen7: Enable 8 pixel dispatch
    
    This gives a small performance increase when operating with rectangles,
    which is reasonably frequent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 492093d04b1486dd34aafe2f109a77ddeb836f18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 31 18:39:17 2012 +0100

    sna: Generate shaders for SNB+ 8-pixel dispatch
    
    Not ideal yet, sampling an alpha-only surface using SIMD8 only seems to
    ever return 0...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a5ed88f9fab654c9c11c566b841d42150d26c5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 30 17:08:20 2012 +0100

    sna/gen4: Tidy debugging code
    
    Cluster the ifdefs together in the initialisation code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46ec9b0ed55d0fcade40f92206e59c02e402d870
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 31 17:41:34 2012 +0100

    sna: Update DPMS mode on CRTC after forcing the outputs on
    
    If we forcibly update the outputs to be on, then the core will not issue
    its on DPMS event and we miss out on updating the CRTC bookkeeping in
    sna_crtc_dpms(). So we need to update the flag on the CRTC as we
    manipulate the outputs during modesetting.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52142
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f166d26b8a93592939068c5a8d160981c724cfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 31 11:58:24 2012 +0100

    sna: Be more careful with damage reduction during CompositeRectangles
    
    We actually need to force DAMAGE_ALL in case we are promoting the GPU
    pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6cb5d93eaa01e7f4763f797bba341f3cc481d98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 30 11:14:58 2012 +0100

    sna: Avoid overlapping gpu/cpu damage with IGNORE_CPU
    
    We cannot simply ignore the presence of CPU damage with IGNORE_CPU but
    must remember to discard it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9805ba98775bb1e969ff59c7044fe1a49673ca8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 18:19:37 2012 +0100

    sna: Export sna_drawable_use_bo() to select target for FillRectangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89e75dbcb6749bde7587ecc08abed276c255e7f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 15:36:44 2012 +0100

    sna/gen7: Prefer the BLT for self-copies
    
    If we are copying to ourselves, we have to regularly flush the render
    cache at which point the RENDER pipeline is slower than the BLT
    pipeline.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33d6afda6cec124494f49b74152768da8a3fbdb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 09:51:16 2012 +0100

    sna/gen7: Compile basic kernels at runtime

commit eba8d3b3e14a5a16cea6cb8a89f12d3feb8f3d99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 09:51:16 2012 +0100

    sna/gen6: Compile basic kernels at runtime

commit 8515ec90405912b3d776defcd6e81b1b5f699f1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 09:51:16 2012 +0100

    sna/gen5: Compile basic kernels at runtime

commit 00c08b1842c9493ca918a868202946b2e7150de0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 09:51:16 2012 +0100

    sna/gen4: Compile basic kernels at runtime

commit 7c9dbc980b760e0053d83ca2d7cb147613285680
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 09:50:39 2012 +0100

    sna: Assemble SF and WM kernels using brw
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ebafa0493c0fa08ab9d80eeb1191b7560dc0863
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 21 19:06:07 2011 +0100

    sna: Add the brw assembler
    
    In order to construct programs on the fly to cater for the combinatorial
    number of possible shaders, we need an assembler, whilst also taking the
    opportunity to remove some of the inefficiencies and mistakes from the
    current shaders.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca9d9c02a260bf7930e04bf64e93cc051893c04e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 28 23:08:07 2012 +0100

    sna: Prefer not to create a GPU bo without RENDER acceleration
    
    Unless that bo happens to be used on a render chain to the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eefbe5b6038424566faf7333bb09764b050dd6b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 30 10:56:29 2012 +0100

    sna: Debug option to test migration of inactive pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3499cacb59f19b5a3439a630ffbc3e105a27b75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 23:00:15 2012 +0100

    sna: Assert that we never attempt to submit a batch whilst wedged
    
    We should be asserting at the point that we insert the invalid operation
    into the batch, but asserting upon submitting the batch is a useful
    failsafe.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb4d789f98e6e05ec29e5242887018c7450ddf10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 22:55:44 2012 +0100

    sna: Disable the warning for a hung GPU is we manually set wedged
    
    Only warn about a hung GPU if we encounter an EIO during operation, but
    don't warn if we set wedged during initialisation based on unsupported
    hw or user request.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fd680ff52f7ce0a101c617dfb8997c4e228e3ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 29 22:51:26 2012 +0100

    Don't disable acceleration on 830/845g by default
    
    Run the risk of a GPU hang (it shouldn't endanger the entire machine
    normally) and let the user elect to disable it through
    
      Option "NoAccel" "true"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d45f0affe263985f440e144203ed7cbb3803696
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 28 18:21:08 2012 +0100

    sna: Honour the Option "DRI"
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52624
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb385745a2347f8966765567e78229d67ddc8d60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 27 13:24:04 2012 +0100

    sna/gen4: Move the common vertex_offset==0 check into the flush()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73ddd8b0decee444a57f10a11f05deebba686649
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 27 12:43:00 2012 +0100

    sna/gen4: Further refinement to the GT allocation
    
    Still hunting for why gen4 fails utterly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 717823a9f77cfedc50e03c5c31c1da44a396b561
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Fri Jul 27 18:12:26 2012 +0800

    uxa/dri (glamor): Use exchange buffer in glamor fixup.
    
    The previous implementation is to create a new textured
    pixmap based on the newly created pixmap's buffer object.
    
    This is not efficient, as we already created it when we
    call CreatePixmap. We can just exchange the underlying
    texture/image buffers by calling intel_glamor_exchange_buffers().
    
    And this commit seems also fix a weird rendering problem
    when working with compiz/mutter.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8ee1406244d8b8399bf933d6b61bfd14374b5f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 27 09:07:16 2012 +0100

    2.20.2 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bef73cd9279be3438e467981db39c67bc13104f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 21:54:33 2012 +0100

    sna/dri: Select the engine before emitting the wait
    
    So that if we have a flexible WAIT_FOR_EVENT that can go on either
    pipeline, we can choose our preferred pipeline for DRI.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ced4f1ddcf30b518e1760c7aa4a5ed4f934b9f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 10:50:31 2012 +0100

    Reduce maximum thread count for IVB GT1 to avoid spontaneous combustion
    
    Somewhere along the way it seems that IVB GT1 was reduced to only allow
    a maximum of 48 threads, as revealed in the lastest bspecs.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52473
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f8f8759111f791ee99adfd87296443fb0e6acad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 17:39:34 2012 +0100

    sna/gen4: Tweak heuristics for render/blt usage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9dd1401615f0ed9492a0c0f547fb37150e013d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 16:31:16 2012 +0100

    sna/gen4: Bump thread counts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f3fdef98c1ab2fa27439c3be9810b7a934017ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 15:39:05 2012 +0100

    sna/gen7: IVB requires a complete pipeline stall when changing blend modes
    
    Similar to how SandyBridge behaves, I had hoped that with IvyBridge they
    would have made the pipelined operation actually pipelined, but alas.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52473
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0938b3df8c25178c8ea0012e1ead1061d03a4e7c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 15:21:59 2012 +0100

    sna/dri: Add an explanatory assertion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c621183466aa55a5938027b702069e792df2272d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 15:18:56 2012 +0100

    sna/dri: Tidy fallback/normal CopyRegion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52d2491a1bafb979d79bb970027c55788f199acb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 15:19:14 2012 +0100

    sna/video: Protect against attempting to use TexturedVideo whilst wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c0e3bbb0c301d0fa4652aa38edd84a9fd6b555e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 14:58:04 2012 +0100

    sna: Force the damage on the DRI pixmap to be flushed to the GPU
    
    Otherwise nothing will happen if we consider ourselves wedged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f50d7b03b5d0b81b24f0acb4ae555545bbdaa179
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 14:47:44 2012 +0100

    sna: Only recommend not to create bo for a pixmap whilst wedged
    
    This allows us to continue to map a GPU bo and operate inplace if we are
    force to create a GPU bo for a compositor.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49403ddd1bd9a23e1b32a10e7d0757ae2897a579
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 14:44:14 2012 +0100

    sna/dri: Mark a flush required for any new DRI already on exec/dirty lists
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efe3c8ff48738f2a274e1d4514d32499fc4aadbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 14:43:33 2012 +0100

    sna: Allow DRI to force allocation of a GPU bo and backing pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2069384f9f06d3ef9dbb0c3f2c64cac4b24e10fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 14:15:45 2012 +0100

    sna/dri: Implement fallback handling for CopyRegion whilst wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b18143de47e060b67a46d9c68590a2d35df9fca6
Author: Paul Menzel <paulepanter@users.sourceforge.net>
Date:   Thu Jul 26 12:51:57 2012 +0200

    NEWS: Correct release version: s/2.12.0/2.20.0/
    
    Signed-off-by: Paul Menzel <paulepanter@users.sourceforge.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c262d02fb5defe9100df54cf83cc00e11e335745
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 01:12:11 2012 +0100

    Limit PCI matching to VGA devices
    
    Fixes X -configure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad6355311b8b80777bc0fec95f6bf6cd1b4969d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 01:02:53 2012 +0100

    sna: Compile against xorg-1.10
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6c7c490d76c683b7b5c89d20f902603b85bd3bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 26 00:48:59 2012 +0100

    sna: Check for a NULL scanout after DPMS off with shadow enabled
    
    We may mark the scanout as detached when all outputs are turned off (for
    example during rotation) and so in the subsequent block handler we need
    to be careful in case we are handling a detached shadow.
    
    Reported-by: chr.ohm@gmx.net
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52514
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4acc01bb09f68edbad4c6cc7e04c271c92661c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 22:43:32 2012 +0100

    sna: Restore inplace upload for DRI compositors
    
    With a DRI compositor we have to flush the output after every request,
    which leads to major inefficiencies. This can be mitigated slightly if
    we know we will have to upload shortly, which we track using the pixmap
    flush flag.
    
    In particular PutImage is meant to upload inplace to an active DRI
    buffer, however this was accidentally dropped in
    
    commit a253c95ec63b2b075e66ae7380fed6a73469eba5
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Sun Jul 15 13:32:35 2012 +0100
    
        sna: Prefer uploads to be staged in snoopable bo
    
    Performace of putimage500 on ivb i7-3720qm:
      bare:        4610
      gnome-shell: 3000
      patched:     3390
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c969a05ef815b261e157fe8d1172aebfd7f5841
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 20:28:41 2012 +0100

    sna/gen7: Move the PS thread count definition into the constant struct
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 901bb618215d65747eb0a8d481c77c1201f69362
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 20:13:15 2012 +0100

    sna/gen7: Remove duplicated constants
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c5077e4ed055a97bf9deda59c0e9a45e42317ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 16:59:11 2012 +0100

    Assume all unknown chipsets are future gen
    
    I think the likelihood of a new product being launched based on a 8xx
    design is remote enough not to worry about.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 954d9c6aca792098cb16a46b4ec8d5fc104b15a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 15:41:29 2012 +0100

    sna: Initialise single-shot tile offsets before use
    
    As noted by the compiler amidst all the noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 484b072072c8297a87940c9e32097923f0a77c8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 12:22:47 2012 +0100

    sna: Add 'gmux_backlight' to list of known devices for backwards compatability
    
    Reported-by: Austin Lund <austin.lund@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52423
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ab6d7a50d37cf4454577cb8c333d4b8683aa054
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 12:20:36 2012 +0100

    sna: Prefer platform backlight devices over firmware
    
    This is in contrast to libbacklight but closer to our original code as
    we prefer a known custom backlight controller over the ACPI interfaces.
    As only the ACPI interfaces are marked as firmware, and the custom
    backlight controllers as platform, we therefore need to prefer platform
    backlight devices.
    
    Reported-by: Austin Lund <austin.lund@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52423
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6d82ab07661aba98963f239f9501b50c3910962
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 10:40:07 2012 +0100

    sna: Reduce ping-pong for Composite with render disabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de707b7dc853a3b315ead9789d5ca541412c99bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 25 09:05:46 2012 +0100

    uxa: Add Apple's gmux to the list of known preferred backlights
    
    Reported-by: Austin Lund <austin.lund@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52423
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d254e4010d0753f433cfe62c6a7546b02482847
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 23:45:33 2012 +0100

    sna: Use SETUP_BLT to reduce overheads for tiled BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ed44149eaa27b9632ec83a776f3ee67b0eec7b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 23:45:33 2012 +0100

    sna: Use SETUP_BLT to reduce overheads for stippled BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1785aaca2c9347114d28f114ee59ef8206d829b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 23:00:25 2012 +0100

    sna: Remove a surplus function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 554fce8a65b2518cae032f1eadf58830559299c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 22:59:16 2012 +0100

    uxa: Pass the correct parameters to intel_detect_chipset()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40d90dfd8674c255a45b46bbdc09d497af5b3f50
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 21:55:46 2012 +0100

    intel: Refactor the common chipset detection/override
    
    Reduce the duplicate messages for which type of chip we by
    amalgamating the common code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3f6c48d18c316899c71b6fc34971039c6f9e5f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 14:43:23 2012 +0100

    sna: Refactor PutImage to avoid calling drawable_gc_flags() too early
    
    drawable_gc_flags() asserts that the gc has been moved to the CPU prior
    to its calls so that it can read the reduced raster operation.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1af26ea4228a9d7768b475b4f9164d2c7620d4fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 14:39:44 2012 +0100

    sna: Flesh out tiled operations using the BLT
    
    Before enabling the RENDER pipeline for this operation, let's just see
    what is required to fully use the BLT pipeline as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac182a006732525a921a9c539e5ebfb537ad3b52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 23 11:05:05 2012 +0100

    sna: Hold a reference to the full stipple pattern for repeated tiles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83f683b47063eab8cfb5037d02133dd977c3fc25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 22 23:20:23 2012 +0100

    2.20.1 release
    
    A good brown paper bag bug release for SNA.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9402bdcc13f7e96dfe527ff4a3da8d13a7870a02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 22 22:14:52 2012 +0100

    sna/glyphs: Also discard the glyph mask for bitmaps with an opaque source
    
    Though I expect all such glyphs to be caught by the non-overlapping
    checks...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b315e0ebb75d8391ebef7ebe53741a5e33c968bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 22 20:07:38 2012 +0100

    sna: Tweak the fallback hints for XYPixmap PutImage
    
    As the fallback uses a multiple-pass algorithm updating one plane at a
    time, we wish to prepare the fallback surface for reads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8acaf2693e176a92993a498683f121cfe0343fd4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 22 12:28:34 2012 +0100

    sna: Promote tiled operations to the GPU if the tile is already on the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d4a3e371beea65bf66e54ae13789d6d5ca91f8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 22 11:19:13 2012 +0100

    sna: Use an upload buffer for large stipples
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40e0cf32a25e43e16184b2af87a1e1abeb8e4052
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 19:43:23 2012 +0100

    sna/dri: We fail at predicting the flip frame
    
    Simply report the values from the kernel, and transfer the blame...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6e316eeba3008b351f2cd63829154f4672c5417
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 18:18:32 2012 +0100

    sna: Adjust hints to prefer rendering convex polygon with the GPU
    
    Keep the general polygons as only using the GPU if necessary, until the
    cost of the routines is analysed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1e7248cb353d634f27d297059911168ce1a0762
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 16:08:31 2012 +0100

    sna: Expand the heuristic for predicting when to use CPU bo for readback
    
    For tiny transfers, the cost of setting up the GPU operation outweighs
    the actual savings through increased throughput. So we try to guess when
    it will be preferrable to simply read from the GPU bo directly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06db69c2c7023f702f9773be90144fdf7a1159e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 15:28:10 2012 +0100

    sna: Update assertion for cached io buffers
    
    As kgem_buffers may be reused and repurposed through the snoop cache it
    is no longer true that only proxies will have the io flag set.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d715e1e01437049e167462281d51b5e214594361
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 15:04:31 2012 +0100

    sna: Also discard the last-was-cpu flag when overwriting cpu damage
    
    We interpret a FillRect that erradicates the existing damage as a
    clear-event and an opportunity to see if it is worth migrating the
    render commands to the GPU. This is undermined if we leave the
    'prefer-cpu' flag intact.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e95825d17ce65ad8173a5e6518a98969e236a4f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 14:38:17 2012 +0100

    sna: Enable snooping on the reused linear buffer
    
    This explains why suddenly I was seeing clflush again on a couple of
    machines...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5e6b5874f334b9124a17f017c6eb175cf88f115
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 14:26:52 2012 +0100

    sna: Fix the reversed not SHM assertion
    
    Should be double checking that we are not about to free a CPU bo pinned
    to a SHM pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f36b656ab2bc16ec8849cadb0afb574bb742c3a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 13:18:40 2012 +0100

    sna: Avoid marking io/snoop buffers as unreusable unnecessarily
    
    As they are kept in special caches, we can reserve the unreusable flags
    for exceptional buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37dfdb0e9e86effc3ca8b590c98aa2382e8f0cea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 13:01:09 2012 +0100

    sna: Correct assertion for __kgem_bo_size()
    
    Only proxies are measured in bytes not pages.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83ad661bc73e9d0094b669c5203e25afc3937bb7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 12:51:41 2012 +0100

    sna: Change the vmap interface name to userptr
    
    This is in common with the other drivers and avoids the conflict with
    'vmalloc/vmap' used by the kernel for allocation of contiguous virtual
    mappings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8dcccd308222bcf1b96f2ee15842b4558ea5f29e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 12:47:21 2012 +0100

    sna: s/vmap/snoop/ since we use the flag more generically
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6acc9e6a6e1de2a11597c810e02f793774cef2dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 21 12:07:46 2012 +0100

    sna: Fix role reversal of __kgem_bo_size() and kgem_bo_size()!
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 286b0e1a48cab85191dfbb112c8dd14aeaa70956
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 16:04:37 2012 +0100

    sna: Refresh experimental userptr vmap support
    
    Bring the code uptodate with both kernel interface changes and internal
    adjustments following the creation of CPU buffers with set-cacheing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93c794eb3f80bef64f1619986a7c950229dc7a47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 20:34:53 2012 +0100

    sna: Micro-optimise copying boxes with the blitter
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0d95a9c2d3a27eafbe459e2aefe772c006e596f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 20:34:23 2012 +0100

    sna: Only update a buffer when it becomes dirty
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c52d265b83b033fb2a275fcc9a8a8d146e3afdf6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 19:38:38 2012 +0100

    sna: Tweak CPU bo promotion rules for CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f92a64dd9162731210b14368b6ee408356d7fefc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 15:54:35 2012 +0100

    sna: Only set the vmap flag after we make the bo snoopable
    
    Otherwise if we fail then we incorrectly add the handle to the vmap
    cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b4cf24f1403bf3d929cc0725de66b3d0e08ebaf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 14:46:32 2012 +0100

    sna: Also check whether the first upload box can use the BLT
    
    No point checking boxes 1..n if box 0 is the troublemaker!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df14b285be44f0c40a718bb8ae09a9558b1eb2c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 14:35:28 2012 +0100

    sna/gen6: Prefer the more flexible render ring for large surfaces
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 578ff11c3753ede2c81afc47302991e3d3b316f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 14:24:06 2012 +0100

    sna: Just use composite.box() when we only have one box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb7987fc0b51cf3b83dcf78bcefe65ec3af32ccf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 13:12:27 2012 +0100

    sna/dri: Cleanup ring selection for SNB+ CopyRegion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b56588fbaa2c4ccdfb2f2a8f5656d2cda9dacd7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 10:19:25 2012 +0100

    sna: Update WIP userptr example usage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 473a1dfb683ed576d86b37aba36aaa0e379f4606
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 09:56:13 2012 +0100

    sna: Rename kgem_partial_bo to kgem_buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e6e8a2fa8adda9ae9be8a88fbb14851e9d2df2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 20 09:51:46 2012 +0100

    sna: Allow the snoopable upload buffer to take pages from the CPU vma cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 979035bb9ce04db5fe30efa4f6daab0a40f6af57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 20:06:28 2012 +0100

    sna: Remove topmost unused 'flush' attribute
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b83011909aaf185f05fc2df743882c2410eff46d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 19:51:46 2012 +0100

    sna: Replace 'sync' flag with equivalent 'flush'
    
    The only difference is in semantics. Currently 'sync' was only used on
    CPU buffers for shared memory segments with 2D clients, and 'flush' on GPU
    buffers shared with DRI clients.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88bee3caeaacbbb1b4d789ea3db9a3802a62b59d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 19:40:34 2012 +0100

    sna: Remove unused scanout-is-dirty? flag
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f60f89588caa70e7d8ed53ba453bbe8c2094a95
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 16:58:34 2012 +0100

    sna/gen6: Bump the WM thread count to 80
    
    Note that we should only do this when "WiZ Hashing" is disabled. So we
    should be checking the GT_MODE register (bring on i915_read!) to be sure
    that is safe to do so. However, it gives a big boost to performance of
    render copies...  It also causes perf benchmarks to hit thermal limits
    much quicker.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc39d4b5cb105d269c5349e479daf112f5d93580
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 16:25:54 2012 +0100

    sna/gen6: Add a simple DBG option to limit usage of either BLT/RENDER
    
    We can force the code to either select only BLT or RENDER operations -
    for those that we have a choice for at least!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15d3eea7004822e5cbd48d676692e1b6a2b26d3e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 16:22:20 2012 +0100

    sna: Handle mixed bo/buffers in assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4fce3b7801038e4f64d848a0995f4b441b4d2aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 10:50:09 2012 +0100

    sna/gen4: Hookup composite spans
    
    Due to the unresolved flushing bug it is no faster (so only enable when
    we definitely can't do the operation inplace), however it does eliminate
    a chunk of CPU overhead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f138176bf15682324d2e8cfa9fac3e49604bf8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 10:32:33 2012 +0100

    sna: Tweak order of screen re-initialisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9bd0f8f3e7783d7a6bab707fc08ec96830cd5809
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 09:40:07 2012 +0100

    i810: Correct the double negative and enable XAA when available
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d145d0e1459f578eea621e6944814642e5dd431f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 09:23:10 2012 +0100

    i810: Handle initialisation without the XAA module present at runtime
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a3b98e05b706548527e73b2008600391c601a62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 19 08:42:05 2012 +0100

    sna: Re-register the SHM funcs every server generation
    
    As the SHM layer hooks into the CloseScreen chain to free its privates,
    we then need to call the registration function again on the next
    generation to ensure that the private is reallocated before use.
    
    Reported-by: Pawel Sikora <pluto@agmk.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52255
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4bcab83bbddf8a698aa83f5038f9ab019a404bd5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 22:19:45 2012 +0100

    i810: DRI is not dependent upon XAA
    
    The blit routines is uses are independent of the XAA driver interface
    and can be used separately.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 558c8251299b786cab1ac83dbd35f077224b5950
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 22:00:30 2012 +0100

    sna/gen4+: Drop unsupported source formats
    
    Once again I've confused existence of the enum with the ability of the
    sampler to read that format.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f3b3098c9f870d303a9de2b9c0db119eff5a865
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 21:39:47 2012 +0100

    sna/dri: Allow DRI2 to be loaded even if we are wedged
    
    Just because the GPU is spitting EIO at us does not necessarily imply
    that a DRI client will also suffer. Spit out a warning for later bug
    reporting and let them find out for themselves!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15b7191fd363e9e6083844a218e25419695d55f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 12:59:41 2012 +0100

    sna/gen6: Micro-optimise render copy emission
    
    Backport of the changes made for IVB.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4eea9ac0035dd72f3c637adc39eeaeda46472e9e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 12:59:41 2012 +0100

    sna/gen7: Micro-optimise render copy emission
    
    The goal is bring the overhead down to that of using the blitter. Tricky
    given the number of steps to using the 3D pipeline compared to the
    BLT...
    
    A stretch goal would be to make IVB GPU bound for -copywinpix10!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 267429bbb146449ee4d3b88fa8e23c5b1d53470a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 19:24:44 2012 +0100

    sna: Enable runtime detection of set-cacheing ioctl
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0b3674d042ff55d64ad1fd0d64926e1967be323
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 20:48:27 2012 +0100

    sna/trapezoids: Only reduce bounded operators to a single pass
    
    Only for a few operators can we replace the opacity mask by
    premultiplying into the source.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb0303677c38076db14dfbceec3636197a971e8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 10:40:50 2012 +0100

    sna/trapezoids: Use pixman from within the spans to reduce two-pass operations
    
    Reduce the two pass CompositeTrapezoids if we can perform the operation
    inplace by calling pixman_image_composite from the span. This step
    enables this for xrgb32.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bee1a14618797b3d3a1c1a20eb72644fa907c048
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 09:38:32 2012 +0100

    sna: Fix processing of the last fallback box
    
    The evil typo caused us to misalign the clip boxes and run over a
    garbage array on 64-bit builds.
    
    Reported-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52163
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88cb1968b6dbf3edfa885da9503e91124af46007
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 09:38:03 2012 +0100

    sna: Add more DBG for fallback processing
    
    Hunting the lost box...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36f2e46619598e9bca4fe1207aa2f157bfa1ecf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 00:45:54 2012 +0100

    sna: Reuse the snoopable cache more frequently for upload buffers
    
    Now that we are keeping a small cache of snoopable buffers, experiment
    with using them for uploads more frequently.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73f07abbd2d78418e5a66262f293b5ed80b7ccb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 18 00:19:49 2012 +0100

    sna: Maintain a short-lived cache of snoopable CPU bo for older gen
    
    Once again, we find that frequent buffer creation and manipulation of the
    GTT is a painful experience leading to noticeable and frequent application
    stalls. So mitigate the need for fresh pages by keeping a small stash of
    recently freed and inactive bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77520641a332a622c0b5378bd254ed5cb46a5f0a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 22:09:33 2012 +0100

    i810: Replace XAAGet.*ROP() with local tables
    
    The XAAGetPatternROP() and XAAGetCopyROP() functions were removed along
    with the rest of XAA so we need to implement those tables locally.
    
    Reported-by: Knut Petersen <Knut_Petersen@t-online.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caef63e0268e59e439b030a9a338e81d5cf8e311
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 21:22:57 2012 +0100

    i810: Split xaa routines from common acceleration methods
    
    Some of the routines in i810_accel.c are specific to XAA whilst others
    are used elsewhere, for example in i810_dri.c. Therefore we have to be
    selective over which ones we compile out without xaa.
    
    Reported-by: Knut Petersen <Knut_Petersen@t-online.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53ff19f45a3cc4863845c23e8d3c2c2b95e03fd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 19:40:16 2012 +0100

    sna: Allow wedged CopyPlane to operate inplace on the destination
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4fa4d5494db45b227c9ae7f7a90cd5dfd940027
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 19:29:32 2012 +0100

    sna: Allow inplace copies for wedged CopyArea
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 217eeadf81a8cbb43e495e1e937acdd95c703377
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 19:35:06 2012 +0100

    sna: Allow operation inplace to scanout whilst wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40ff29480a0dbf458adf1a1b0d3275ad1361530e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 18:38:49 2012 +0100

    sna: Tweak fast blt path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fce69c79c4840e7863d7c382da0d22be90a9f19a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 18:28:24 2012 +0100

    sna: prefer fbBlt over pixman_blt
    
    It is currently much better optimised through memcpy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c29f96d50839388377ad57c6366f9bc7ad8b9d0a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 13:02:51 2012 +0100

    sna/gen7: Bump the number of pixel shader threads for IVB GT2
    
    Spotted-by: Kilarski, Bernard R" <bernard.r.kilarski@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 799bae9e8ff53fb1b5c74f3278d530a58d66de9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 17:07:10 2012 +0100

    sna/dri: Do not allow an exchange to take place on invalid buffers
    
    If the SwapBuffers is called after we have resized a Window but before
    the client has processed the Invalidate notification, then the
    SwapBuffers will be referring to a pair of stale buffers. As the buffers
    are no longer attached to the Pixmap, we can not simply exchange them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 067aeaddb8047f01ae3a20b26ba0acf5ba2d035f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 15:33:19 2012 +0100

    sna: Rebalance choice of GPU vs CPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ebeea3f5c71959773478de44b08a967fe5acc8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 15:10:43 2012 +0100

    sna: Avoid the CPU bo readback for render paths
    
    As we exclude using the CPU bo if there is overlapping GPU damage, we
    can forgo the call to keep the transfer the damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed8c729ed02705fd03be1ab22a94b5aae13567c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 11:21:30 2012 +0100

    sna: Catch the short-circuit path for clearing clear on move-to-gpu as well
    
    I thought the short-circuit path was only taken when already clear, I
    was wrong.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 359b9cc82de13b0ac89692896ac6104ff3be308b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 10:26:27 2012 +0100

    sna: Limit the use of snoopable buffers to read/write uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f21dba6ee505217d63edd84611622e05aeb4593
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 09:26:46 2012 +0100

    sna: Only drop the clear flag when writing to the GPU pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbfbbee8288aba1e4754fd2dbc02e71f5e118cda
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 09:20:21 2012 +0100

    sna: Fix glyph DBG to include clip extents and actual glyph origin
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0ed0ca234a4bed986824845ff70e8554c0e579f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 17 08:35:20 2012 +0100

    sna: Promote an undamaged pixmap to use the full GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f79e877fb6602bd0f9dd14ac9c3511f3b7044fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 21:18:24 2012 +0100

    sna: Share the pixmap migration decision with the BLT composite routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d141a2d59007866c9eaad020c744be446e70c346
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 23:20:58 2012 +0100

    sna: Disable snoopable bo for gen4
    
    Further inspection reveals that whilst it may not hang the GPU, the
    results are not pleasant or complete.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 107feed2a4ca044313c70f83a62909187ff1f905
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 18:58:30 2012 +0100

    sna: Disable snoopable uplaod buffers for gen4
    
    The sampler really does not like using snoopable buffers...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 818c21165c746b7b410a6e6e23b1675d88db685d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 16:28:00 2012 +0100

    sna: Fixup pixmap validation for sna_copy_area()
    
    Remember to offset the box by the drawable deltas in order to
    compensate for compositing.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=52142
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 623d84bed7c47ac39348775ce35eec54196f6dac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 16:07:37 2012 +0100

    Wrap defines to avoid redefinition warnings
    
    Currently this only catches out ARRAY_SIZE, but wrap the other common
    defines for consistency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 907a2a7c97514d3f7610648ed87c7042a857f786
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 14:47:03 2012 +0100

    sna/trapezoids: Fix inplace unaligned fills (on gen4)
    
    Reported-by: Sergio Callegari <sergio.callegari@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=52150
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ce2f40249231f57cf464361ea5329cee1932ccf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 14:46:39 2012 +0100

    sna/trapezoids: Add some DBG to unaligned fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2721214868685123c973970a8ce0d93346ae0ee2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 13:52:39 2012 +0100

    sna: Move the disabling of CPU bo for gen4 to the render unit
    
    They appear to work fine with the BLT and only seem to cause issues when
    used with the sammpler. So enable them for accelerated uploads and
    downloads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0777b146bf1a63c99e4d4af141e676a47b1f2dc9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 13:11:07 2012 +0100

    sna: Use set-cache-level to allocate snoopable upload buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33443f7ee48fa54b6f4d09c93cddac0e32314b9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 12:51:54 2012 +0100

    sna: Add a couple of DBG options to control accelerated up/downloads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 924060293826a1cc0d9d7bc26e913e46c6b2d054
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 12:03:47 2012 +0100

    sna: Discard and recreate the CPU buffer when busy during move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7024ef771ff170e61e788b5216c86b46e0f8ae6a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 12:15:54 2012 +0100

    sna: Add a few DBG to show when CPU bos are being used for xfer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c564414157e27417f0de1c0542dafd9b47e01eda
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 09:34:30 2012 +0100

    sna: Disable the scanout flush when switch off via DPMS
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 536e7ab756d6821db79e4cd79a250af1c0f7d5a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 16 12:16:26 2012 +0100

    intel: Don't use stdbool without declaring it
    
    Reported-by: Fabio Pedretti <fabio.ped@libero.it>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c32be15b06ad63c1fc1371de879f2d879080f6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 5 19:26:48 2012 +0100

    uxa: Remove Shadow hack
    
    This was an incomplete hack so deprecate in favour of Shadow-on-Steriods,
    SNA.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47324
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a18a0936eafc45ab920ab0eecf2fc2a601c41a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 15 20:26:00 2012 +0100

    configure: version bump for 2.20.0 release
    
    The day SNA hits mainstream...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fa059330decd1437eef4928d732ec91fd4e17e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 15 14:04:48 2012 +0100

    sna: Avoid creating a CPU bo for uploads if we already have a large GPU bo
    
    And vice-versa if already have a large CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a253c95ec63b2b075e66ae7380fed6a73469eba5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 15 13:32:35 2012 +0100

    sna: Prefer uploads to be staged in snoopable bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef6d94a8444927941db108811e1a26357dc3f18e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 15 11:46:53 2012 +0100

    sna: Simply reverse all the boxes if dx <= 0 and dy <= 0
    
    In this fairly common case, avoid both the double pass and use a simpler
    algorithm as we can simply reverse the order of the boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6601a943ff968ac39ba198351c50dc883cb4232e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 15 11:39:56 2012 +0100

    sna: Keep track of the base pointer for the reordered boxes
    
    So that we avoid freeing an invalid pointer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef34d5cf415ad7459ab44b0ec2e70b14150735fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 23:25:17 2012 +0100

    sna: Make sure we check for a busy CPU bo before declaring is-cpu
    
    Even if the pixmap is entirely damaged on the CPU, we still may be in
    the process of transferring it and so cause an unwanted stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e397e4a1dc23ed07089c967612d705584f3b376
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 21:35:23 2012 +0100

    sna/glyphs: Perform the fallback mask reduce before moving the glyph pointers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db1ee13a53b0c1348b7566ee60ee1b7b384ef59a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 21:26:01 2012 +0100

    sna/gen7: Check for gradient allocation failure within spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86479e97460da798a3804cbb4ae39e62de881af1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 21:24:04 2012 +0100

    sna/gen7: Uses EXTEND_PAD for its alpha-gradient with spans
    
    Fixes regression from 2b94f9a043.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f17037275c05198c3c3f456964fd42032f9085b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 20:11:17 2012 +0100

    sna: Reorder overlapping boxes for CopyArea/Window
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86e09d14bd00344d378b86a19ebb44f7d946926c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 17:51:31 2012 +0100

    sna: Tidy sna_copy_boxes
    
    So there appears to be a bug hidden here. But only when we scroll
    upwards in a GTK+ application. Hmm.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 924f596463555db27214fd8227218c2e21ecddc8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 19:03:08 2012 +0100

    sna: Avoid BLT to snoopable bo on older gen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44e226b1d9fca8cb95b0864adf8708b03ee8472c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 18:36:29 2012 +0100

    sna/glyphs: A repeat of the earlier typo for pixman glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 797ebf937fcfcc87502727c70e6b52f89fecc799
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 16:58:18 2012 +0100

    sna/glyphs: Fix typo and render glyphs to the small mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b94f9a043372ffede01339eea99377a71169fbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 16:38:21 2012 +0100

    sna/gen7: Preselect sampler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50d61c38bdb720c17ba5bfcaf97032338e466d9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 16:07:32 2012 +0100

    sna/gen4: Fix typo introduced in checking dst format
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc91b1f157f9e6e4097e662e2890574e530344ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 15:48:50 2012 +0100

    sna/gen7: Only emit the render flushes between operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d30dc59651f156e9d4572141e2c54af89d007a37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 15:42:19 2012 +0100

    sna/gen7: Only fallback to BLT for a redirected target
    
    As we can always use a partial surface for the source.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f05b0c03b1fdab474b436431c430028fca1937e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 15:03:32 2012 +0100

    sna/gen4+: Fix up card/dest format confusion in previous commit
    
    That would have been much more successful had I not supplied the wrong
    opaque formats to the sampler.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fffbc34e4621898eee9b80bf8b6b3699bcade52a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 14:54:27 2012 +0100

    sna/gen4+: Translate to card format using a switch
    
    GCC produces faster code than a walk over the format tables.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95fdd9af5c8a8360d02debc400e75869c36f05ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 13:05:27 2012 +0100

    sna: Enable pixman_glyphs if available
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f764ee4c50567cfb831495d42cb6c2bb94055ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 12:29:47 2012 +0100

    sna/dri: Presume an unknown chipset will want i965_dri.so
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39845280b5a9d0ed60c6a158c3d0df9fb8756d40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 12:14:28 2012 +0100

    sna: Allow BLT support on future unknown hardware
    
    Assume that if the kernel recognises the chipset and declares it has a
    BLT, we can use it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b260ca44b3aaba2c8cd25640ad7ac9ca6478b0f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 09:59:07 2012 +0100

    Drop some unused includes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f517bdb12b909ef9d0897166bdabc537551a065b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 14 08:56:21 2012 +0100

    sna: Do not perform batch compaction on old kernels
    
    As they will reject the delta pointing outside of the target batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce69a1e8686889f1eebb4cb3a39c41f473e58b93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 23:25:02 2012 +0100

    sna: Add some DBG for selecting glyph path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b68b2d90915f7a97e43a39e3117927544886fba0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 23:24:32 2012 +0100

    sna: Add some DBG for short-circuiting choice of source bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad4786b285074b5bd70b3ad0bea6ec1b77ad6740
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 22:24:51 2012 +0100

    sna: Aim for consistency and use stdbool except for core X APIs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a05c3547bba52288bae872ea672ffe2f4dab2ffa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 15:06:15 2012 +0100

    sna/gen4: Simplify comparing the pipeline-pointers against the previous
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea9ec18505645dfec85ab96bbbbbc1793830c737
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 11:39:01 2012 +0100

    sna: Split CloseScreen into two phases
    
    In order to get the ordering correct we need to free the xf86_cursors
    before calling the miPointerCloseScreen. This requires us to insert a
    hook at the top of the CloseScreen chain. However we still require the
    final CloseScreen hook in order to do the fundamental clean up, hence
    split the CloseScreen callback into two phases.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f03f7b4359fcbcde651bc1554ddff4fe10bc53b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 13 10:35:27 2012 +0100

    sna: Only try to enable DRI2 if the module is available at runtime
    
    Blatantly cribbed from Michel Danzer's patch for ati...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5d6a57f12025aef9850c7d9baa6905f776be971
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 22:16:27 2012 +0100

    Enable compilation of SNA by default
    
    But only if we meet the required versions of Xorg and leave UXA as the
    default AccelMethod for the time being.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c2975ab2943478b3a246b5fb231f9f3df2d8475
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 22:14:39 2012 +0100

    Fix the reporting of whether SNA is configured
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd15ce65ab8ce5cf571e37daa7db1ee245616cd4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 20:32:14 2012 +0100

    sna: Fix build without DRI2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22be9988b933f33fc5247a9abc3b00a7f2e4a202
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 19:49:34 2012 +0100

    sna: Check for failure to initialize the sprite pointers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32e7f4ee64867779b2def6fcd882708d7b0e2cf5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 19:39:10 2012 +0100

    sna/glyphs: Fix array allocation for list_extents
    
    Originally I intended to skip assigning the box on the last list.
    However, loop simplicity failed and now we run the risk of writing
    beyond the end of stack_extents, and overwriting the list_extents
    pointer.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0477b5fb6f040f3bad86bb314a24df1bcd660aed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 19:37:02 2012 +0100

    sna/glyphs: Apply mask reduction along fallback paths as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16aaa51b5d326f44974489f5b29716c7ff5ab48e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 15:26:54 2012 +0100

    sna: Rearrange the tests for dropping the glyph mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 600746f923b046187a66b60b5e5d2b187475730e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 12 14:16:31 2012 +0100

    i810: Remove vestigial reference to xaa.h
    
    i810_hwmc.c can pull it in via i810.h like everybody else. As for
    xaalocal.h, I have no idea what that is... Both appear to be cut'n'paste
    includes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d9ab2e7101167075112a472ee82530dc0365183
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Thu Jul 12 18:47:50 2012 +0800

    uxa/dri: Fix a buffer leak on pageflipping when enabling glamor.
    
    We need to put current front_buffer to back buffer thus we
    don't need to create a new back buffer next time. This behaviou
    should be the same with or without glamor. Previous code
    incorrectly discard the previous front_buffer and cause a
    big buffer leak problem.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa89e0614563cbe0cc45e6d7e7584cb333244c27
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Thu Jul 12 18:47:51 2012 +0800

    uxa/glyphs: Bypass uxa glyphs operations if using glamor.
    
    glamor_glyphs will never fallback. We don't need to keep a
    uxa glyphs cache picture here. Thus simply bypass the
    corresponding operations.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d25000e1f31e78aff2ab43adb12aec0aac36f56f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 11 22:37:25 2012 +0100

    i810: Tidy configure detection for XAA/DGA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44a1528c15eec9b3f93651e779013137864d4d2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 11 15:05:32 2012 +0100

    sna: Remove unused cached partials list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94d489ae43a2c4d4d9ddc9ce30ff1a9142b77d4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 11 14:25:20 2012 +0100

    sna: Minor tweak to upload in place if the CPU bo is busy
    
    Since we have to pay the price of the stall anyway...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5db90aa52f10897ad2d7795df94c0e3d2878aea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 11 12:52:24 2012 +0100

    sna: Discard the mask for "non-overlapping" glyphs
    
    If we can acheive the same rasterisation results without the mask,
    rendering the glyphs-to-dst is so much faster that it outweighs the cost
    of checking for overlapping glyphs.
    
    The penalty is then for code that correctly declared that it required
    a mask, who now have an extra ~10% overhead in the processing of their
    glyphs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 665c9cbdcf2c493cac29d316eaffa2abe197a183
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 10 19:01:12 2012 +0100

    sna: Disable periodic scanout refresh if all outputs are disconnected
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85fdc3143b157fd7ba3453efc86da8238d9de316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 10 12:43:46 2012 +0100

    sna: Avoid the expensive recomputation of the region when copying
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 747ed0ca28bb46fc45ff20acd1f82212fa2b46bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 10 17:05:20 2012 +0100

    sna: Only promote to full GPU if we already have a GPU bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 232217eef8f99f5678d65bf9aa5b898ef6d3b3c6
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Tue Jul 10 00:32:13 2012 +0100

    i810: Make DGA optional
    
    Don't build DGA when it's not available, or when we don't want it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78dc0c04745ad4485b994f67833f4a155749f01d
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Tue Jul 10 00:32:13 2012 +0100

    i810: Make XAA optional
    
    Don't build XAA when it's not available, or when we don't want it.
    
    Signed-off-by: Daniel Stone <daniel@fooishbar.org>

commit 45ab003a5860fd4290df24739d2520fddfe27a8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 21:28:40 2012 +0100

    sna: Check for overlapping glyphs within each list, then overlapping lists
    
    Spotted by Zhigang Gong is this optimisation to avoid the problem with
    multiple lines passed in a single request (using multiple lists). As the
    start of line will overlap with the previous line when we use the simple
    bbox comparison, we always declare those runs as overlapping and so we
    cannot substitute a glyph mask. However, we can reduce the problem to
    only checking for overlapping glyphs within a list and then checking for
    overlapping lists. Very, very clever.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8066bc33d78e78ce7c13833b08a7daaea2f3ed22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 11:25:11 2012 +0100

    sna: Fix reversal of inside logic for BitmapToRegion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a9a17cd092d156272e8953974119f527b2b77eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 11:12:12 2012 +0100

    sna: Improve the check for assertions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b11bc37684181390fc1400afb44054785104ca15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 11:09:16 2012 +0100

    sna: Simplify the DBG incarnation
    
    It was only ever used in conjunction with HAS_DEBUG_FULL. For debug
    purposes it is as easy to redefine DBG locally. By simplifying the DBG
    macro we can create it consistently and so reduce the number of compiler
    warnings.
    
    Long term, this has to be dynamic. Sigh.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21798a88676e91049917fafd3196dd4374b94226
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 09:23:20 2012 +0100

    sna: Promote large operations to use the whole GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b6ad7a6ae6820c8f66d1c80613885ee84e7d316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 08:54:11 2012 +0100

    sna: Only consider large clears as candidates for GPU migration
    
    If we only operating on a small region of the pixmap and have require
    damage migration in the past, we are likely to require migration again
    at some point. So keep track of small damage areas.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8a75538ea1d2a79d6282b0e2dfd73cfdea1a480
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 08:38:39 2012 +0100

    sna: PadPixmap only writes to the out-of-bounds bits
    
    So we only need to delcare it as reading the source pixmap and not mark
    it as damaged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eafb454edf188e7dada1ddf886d1e46f0151968d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 08:38:08 2012 +0100

    sna: Rename conflicting symbols with uxa
    
    Reported-by: Christoph Reiter <reiter.christoph@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51887
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0af29175a087cc2e509962f8828790c8f7232611
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 01:24:23 2012 +0100

    sna: Just use a linear scan to find the terminating clip box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2941a5fe15626730869a48a63bb088e8ae2c0549
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 9 00:20:57 2012 +0100

    sna: Remove the consideration of CPU damage for overwriting FillRect
    
    We consideer a singular FillRect to be a sequence point in the rendering
    commands, that is it is usually used to clear the background as the first
    operation in a drawing sequence. So it is useful to ask if we can move
    the sequence to the GPU at that point.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8be00b6d4767ffc09328d246d02ee75312ad5842
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 8 20:48:40 2012 +0100

    sna: Substitute the reduce clip region for fallback ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0457935a70f6c1ae06f61f9ad0dd1bdc825465fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 8 20:38:03 2012 +0100

    sna: Review placement hints for fallback operations
    
    Look for those operations that maybe better via the GTT and those that
    are preferred to be in CPU cache. The wonders of multiple layers of
    heuristics.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7f0b0e7e3f66165b87c46f897de536cf74a9daf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 8 19:59:34 2012 +0100

    sna: Remove function for force-to-gpu
    
    This is now enitrely done in the core move-to-gpu as a special case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb8770158c08394c2de79e0ca1c1b3112e17dd23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 8 18:53:25 2012 +0100

    sna: Apply the clear color when resizing the front buffer
    
    If the existing front buffer is clear, just apply the clear color to
    then new buffer rather than copy the old one across.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8dd14855d75240501aa2d089bcdfa46e7badbf18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 8 15:46:41 2012 +0100

    sna/dri: Review stale comments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bb7a530e77a5c6e8bae0fb14c570feafe37c2bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 20:53:27 2012 +0100

    sna/dri: Fix cross-chaining of pageflip vs vblank
    
    And double-check that the drawable is still flippable before completing
    the delay exchange.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1454df8caa51fff9810a9b792d17aa82b247a4ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 19:59:50 2012 +0100

    sna/dri: Use draw ref directly
    
    As we hook into the DestroyWindow notification, we can reliably use the
    original Drawable reference and avoid the secondary object lookups.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9abb6c09bdb9831db5f0626eed70663a2dc39fc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 18:43:06 2012 +0100

    sna/dri: Remove dead code for 'old_fb'
    
    The member still exists but is never set and is unused.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad877abdc70b842afd202b2f97892d97a0b8d151
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 17:48:52 2012 +0100

    sna/dri: Attach the chain of frame events to the Window, not pixmap
    
    So that we can have multiple clients swapping in separate windows
    concurrently.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81cd9aa80091b9bb08b50062f117d678a3bc7a91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 16:12:49 2012 +0100

    sna: Tweak start/stop of the deferred flush
    
    As we now emit work whenever we wakeup and find the GPU idle, we rarely
    actually have pending work in the deferred flush queue, so try to avoid
    installing a timer if we are not accumulating work.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6cb0c631e4eafc09f1677c73906de9108d735de4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 15:10:18 2012 +0100

    sna/dri: Clarify the message for one failure case
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a314d18cef1e08b23f9dca861ad2ba396bb1080
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 14:56:05 2012 +0100

    sna/dri: Add a couple of missing VG_CLEAR on vblanks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66a53c15cb5ee729fb43ea9713fd8538a3f982ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 14:46:08 2012 +0100

    sna/dri: Couple the frame events into DestroyWindow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 975a566bed72ddc79853b329307ed72a82df24b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 14:12:51 2012 +0100

    sna/dri: Replace the DRI2 drawable type with a devPrivate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0da1c98f660269806408af5fd08c1ab5e538082e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 12:15:28 2012 +0100

    test: Add missing header for distcheck
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3e58123d36924c760ab6f58a7155a040422e91d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 6 15:22:26 2012 +0100

    sna: Fixup fb wrapper
    
    To accommodate changes in the Xserver and avoid breakage; would have been
    much easier had the fb been exported in the first place.

commit 5d2f88fd9972c62c87098ddc7fee7b6f0cea0fdb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 10:07:51 2012 +0100

    sna: Add a couple of DBG flags to control upload buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18b3090381ac0fb61df96a7c6b2f12aacf180ee8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 7 00:06:36 2012 +0100

    sna: Fixup USE_INPLACE debug hint
    
    After we enabled inplace readback, we can just apply the INPLACE hint to
    all fallbacks, but instead apply it to the automatic testing for a
    potential inplace operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24b59a8955eb15522ad334a541530aca937fcf07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 6 14:16:36 2012 +0100

    sna: Refactor a common function: is_clipped()
    
    Had I done this earlier, I would not have the bug in the open-coded
    version. Le sigh.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68b357454af705f1ed3a9599435a402f2611a180
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 6 10:58:06 2012 +0100

    sna: Clear garbage from the new front buffer when resizing
    
    Avoid displaying a buffer filled with random junk when resizing (and
    thereby creating a new) framebuffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5784e0f21dc91f33c99a507105a0695cc53d6574
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 6 09:42:37 2012 +0100

    Allow matching against any device supported by drm/i915
    
    However we cannot enable acceleration if we do not recognise its
    hardware layout or instruction set.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ee10cc3b2aa0888753eeb25c7fde7296a3c92eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 6 00:01:58 2012 +0100

    Make the detection of broken pre-production hardware verbose
    
    These SDV should have been returned to the manufacturer long ago and
    replaced with real systems. So if they are still in use, add a gentle
    reminder.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd2dd3016e0834d1636aa96511608022a4cdbcd1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 5 19:58:54 2012 +0100

    sna: Fix clipping of glyphs-to-dst for partially obscurred windows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0f086acb259d7732560c5d0d642308de028a4445
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 12:26:18 2012 +0100

    sna: Fallback to attaching a shadow fb if we fail to setup the crtc
    
    As we've chosen to fix the kernel to handle CRTC offsets > 4096, drop
    the automatic workaround. However, allow the user to force creation of
    PerCrtcPixmaps for the purpose of debugging (and to workaround the bug
    in older kernels) and to fallback to trying a shadow fb if the setcrtc
    fails with the composite fb.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e8060f837475c85cc061ba4a5388140cd227613
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 5 03:31:12 2012 +0100

    sna: Do not force GPU allocation if CPU bo is already busy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c32bb286dc9a489232030f6abe9076411fbcecfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 5 03:18:12 2012 +0100

    sna: Make sure damage is flushed to the CPU bo before use
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d46cc00b3cd903bfaf37ad7d4a60676c4b346983
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 5 02:19:26 2012 +0100

    sna/dri: Assert that our pixmaps sizes are invariant
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c1f58fe45e8f4f18c45733f862ca1f290dde84d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 23:03:44 2012 +0100

    sna: drop an unused ret var
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a69a47f94037698a360f8b8611f6f3e58a20ca87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 22:15:45 2012 +0100

    sna: Fix detection of EIO through throttle
    
    When using drmIoctl, one needs to check the errno for the actual error
    code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2fdb0da83d6208c884ffde2bb30d0a67fc75217
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 21:43:22 2012 +0100

    sna: Use throttle() to confirm a GPU hang
    
    This has two effects. The first is that we confirm that the EIO was
    indeed a GPU hang and not some other form of I/O failure (for example
    swapin). And the second is that it means we also print the warning to
    look for an i915_error_state when we detect a GPU hang.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8c2b34e39c7f2ee2597f8727b9b98c6aac93fb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 19:53:27 2012 +0100

    sna: Simplify timer execution
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 844ab84c64fde38db315787e16a9f7f674d0f88c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 17:58:27 2012 +0100

    sna: Fix leak around ENOMEM error path in sna_copy_boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54ee41bf05e328ed2f2cd2a64c21afe3efe2556a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 17:40:58 2012 +0100

    sna: Pass a hint to the backends when using copy_boxes for readback
    
    If we expect to only emit this set of copy_boxes() and then submit the
    batch, we would prefer to use the BLT for its lower latency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d36623aaebdc454bd281f34332edcad5d94f34c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 13:55:25 2012 +0100

    sna/dri: Remove broken code for buffer xchg from AsyncSwap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0bdb4d0d3693df007a6cfc9a75bb0deddd812d53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 13:12:43 2012 +0100

    sna/dri: Fixup blit fallback path to use xchg when possible
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeeed323f9081875a804ae19fb356bee2a61e7b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 11:52:27 2012 +0100

    sna/dri: Select the appropriate copy engine based on the current src ring
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5026b6a147f411582af24ffd17c87a81da5eea0b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 4 09:39:59 2012 +0100

    uxa: Install the drm_wakeup_handler for vblank events in !use_page_flipping
    
    Even if page-flipping itself is disabled, we still want to allow the
    client to schedule wakeups for some future vblank which requires
    listening to the kernel vblank notifications.
    
    Reported-by: Eric Anholt <eric@anholt.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51699
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79309dd55f20098e12ead5427c811f237d5592fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 22:27:39 2012 +0100

    sna: check for failure to change cache level on the bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e2ac8a413c05aafd1c69775c5b0fa5f1f37ac23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 19:33:55 2012 +0100

    sna: Use set-cache-level ioctl to create CPU bo
    
    As an alternative to vmap, we can use the kernel for all memory
    management through bo, which is much preferred for its simplicity (i.e.
    avoiding introducing even more vm complexity).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f26163e916e21f6b64a19c147165f2f2c9c5466d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 18:51:46 2012 +0100

    sna: Guess when the client is attempting to read back the whole pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c597e6cd4cb4406878eae07c04ad420d8185d99e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 13:26:33 2012 +0100

    sna: Fix iterator typo
    
    Increment the iterator, not the end-stop.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d087eadd9cd3aa2e2ccd73a568286d21702d29a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 11:54:02 2012 +0100

    sna: Also prefer to use the dst GPU bo if CopyArea reduces to an inplace upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbe3a5ca1e6558bcee29d893aba8cc352220a36d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 11:48:15 2012 +0100

    sna: Attempt to reduce all-damage on the CPU
    
    As we now treat CPU all-damaged as a special case for deciding when and
    where to migrate, look out for that condition after adding damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a41248195e8b327a5d970726450bd2077cdaf0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 11:22:54 2012 +0100

    sna: Operate on the original boxes for CopyArea
    
    Be consistent and avoid the confusion when mixing operations on the
    region boxes and the original boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3bc91842bf186ec149c852f48993235ef7ad27f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 3 10:21:06 2012 +0100

    sna: Allow booting on older kernels by disabling HW acceleration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit affdebcb2d09cd8fdc5aadb2d8df3193587e4a06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 18:50:26 2012 +0100

    sna: And free the DIR after use
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e7b31b6d0a32f76db4a8aef64c77d4afe808fb6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 14:01:36 2012 +0100

    sna: Consolidate CopyArea with the aim of reducing migration ping-pong
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce27a81ac508368d54f1237893a9b1214cf3e3d0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 17:52:24 2012 +0100

    sna: Clear cpu flag after deciding to use gpu bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f1b7e8a23ac3086dda0025ecf09dd1feac94837
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 17:53:01 2012 +0100

    sna: Check for non-existent /sys/class/backlight directory
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d12d50d107d403c3cf4dfe24bb63ce1006d0e025
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 14:09:21 2012 +0100

    sna: Skip hidden and special entries inside /sys/class/backlight
    
    Just to avoid the warnings after fallback to comparing the d_name to
    the list of known interfaces.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e80f9c4670a0e84521907b1baa059322784b1558
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 2 10:21:42 2012 +0100

    sna: Prefer backlight iface based on /sys/class/backlight/*/type
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61e16dc5673a1ac96b2ecee072cc3e80971be5d9
Author: Tom Hughes <tom@compton.nu>
Date:   Mon Jul 2 10:23:56 2012 +0100

    Add asus-nb-wmi backlight control
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51593

commit 543816011d05f0cf40b05ec58f87a5954397a224
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 18:36:55 2012 +0100

    sna/gen7: Correct two minor misues of equivalent GEN6 constants
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 839fea7f779ca63c32817ee4ba695dfce3344980
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 18:23:38 2012 +0100

    sna/gen6: Boost VS entries to maximum
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbd114507d9bf2e2b1d1e52c5e42dc6cdbd8c9a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 14:03:31 2012 +0100

    sna/dri: Assert that the replacement bo is large enough for the pixmap
    
    Just another paranoid sanity check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 675cbd5fade91fd6a6bf533a31b0a211237af6e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 12:39:13 2012 +0100

    sna/trapezoids: Skip the division when converting coverage to floating point
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 182c3637cc5d3a6ce52127087aa2f19ca2b42719
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 13:23:44 2012 +0100

    sna: If the pixmap is marked for flushing, prefer to use the GPU
    
    Again, to avoid the forced ping-pong as we upload the damage after
    nearly every operation, simply prefer to use the GPU in such cases.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35b1ac138002c206a6d6b866d49a0d73705dd3ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jul 1 10:53:07 2012 +0100

    sna: After an operation on the CPU, prefer not to use the GPU
    
    A nasty habit of applications is to fill an area, only to read it back
    with GetImage, render locally and replace with PutImage. This causes a
    readback of an active bo everytime, so let's try to mitigate that by
    preferring not to use the GPU after a forced readback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e625c02e6266403fcd8a72ccce2c6c6291e2e5fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 30 09:34:21 2012 +0100

    sna/damage: Early check for contains-box? if subtract and box outside region
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abd7be1cee6f2f494a11cd9d2e7888c3043ffc02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 15:32:10 2012 +0100

    sna/dri: Prefer GPU rendering if no more CPU damage on a DRI bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67b87e4f7cf6c3ab9cfccc9fe43a824bfe84f393
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 15:03:12 2012 +0100

    sna/dri: Optimise clip reduction with copy-to-front to an unclipped Window
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eae5e1275cd11703de2bca67dacd1d57129b561a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 13:12:52 2012 +0100

    sna: Install the ModeSet handler as the base handler
    
    This way we can safely ignore it across server regen.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15a0761cad862a5d73bbc2af81bc5267e66c307e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 12:22:55 2012 +0100

    sna: Only consider the request list when deciding whether the GPU is busy
    
    Micro-optimisation to overhead extra checks and to make sure an
    unflushed bo doesn't prevent us from submitting more work before
    sleeping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4061f05dd61a7200d91d30b9b4a2ab0c61306870
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 11:40:18 2012 +0100

    sna/trapezoids: Write unaligned fallback boxes inplace
    
    As this is a pure write operation (though we will write the edge pixels
    twice) we can perform this operation inplace and incur a slightly slower
    trap creation at the benefit of avoiding the later copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44e41536b7728c03a4899a97242960ae7ed35624
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 11:39:47 2012 +0100

    sna/trapezoids: Render the partial left-edge of fallback unaligned boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6f9bfe1e20c4c76822d77598f4f1c7e10754929
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 11:06:33 2012 +0100

    sna: Use currentTime rather than GetTimeInMillis()
    
    The overhead of reading the hpet() on every block handler (more or less)
    is exorbitant, so trust that we update currentTime frequently enough to
    be a good approximation - the side effect is that we will wakeup
    slightly to earlier from using an old value for the current time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6c4f30e194eb3b8a2421134bb005f1542b3ef9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 10:14:52 2012 +0100

    sna: Add assertions to check that we do install the timers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87c8f5a47e3abb7ff887aab45b6389cf9b8d8008
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 29 09:33:09 2012 +0100

    sna: Make the post-flip delay explictit
    
    As the kernel is inconsistent in enforcing this across generations,
    handle the synchronisation of the pageflip explicity. Ultimately this
    should be replaced with a tripple buffer mechanism.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31caa43a21a68174386682fd558c911c7c03d76f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 17:05:46 2012 +0100

    sna/gen5: Check harder for need_upload() fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c3eb1fda9e567a300a8138acdac9ec11e010b11
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 17:04:26 2012 +0100

    sna: Correct inverted logic for checking xrgb drawables
    
    Reported-by: Christoph Reiter <reiter.christoph@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=51472
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3e2c1332d8d5a3944df99cc11aa66c586add3e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 12:34:36 2012 +0100

    sna: Fix the application of the crtc offset for posting damage
    
    The damage boxes are in framebuffer (source) space, so we need to apply
    the offset for the boxes in crtc (destination) space.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47e6bfa4f40cf7efcfe7eee24d2512d737fd7e89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 12:24:27 2012 +0100

    sna: Force use of per-crtc scanout if the offset is too large
    
    On gen4+, the scanout offset into a tiled surface is specified through
    the DSPTILEOFF register and limited to 12bits of precision. So if we
    have a CRTC positioned in that nether-region, we need to allocate a
    separate per-crtc pixmap for it and perform shadowing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93e77ee019248fe77483e83f2210d584bb5d1be2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 12:02:32 2012 +0100

    sna: Quieten kernel debug complaints when disabling crtc
    
    Even if we are obviously turning the crtc off, it still complains if the
    number of connectors is non-zero. So make it so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85e4f48a87ddbc227af8f4af5ea46ae17902b111
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 11:44:45 2012 +0100

    sna: Add a DBG to the periodic flush mechanism
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87dd6408a5c29e4808283df78a981de0a3c0a79c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 10:53:59 2012 +0100

    sna: Correct the reversal of the periodic flushing semantics
    
    Regression from 1e9319d (sna: extend RandR to support super sized
    monitor configurations) which tried to take into account the need to
    flush the shadow CRTC bo in addition to the normal scanout bo. In the
    refactoring of the need_flush(), the double negative was missed.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05f486f64bc7ea4a8a71f5d792fa586ac0843414
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 28 10:42:21 2012 +0100

    sna: Flush the per-crtc render caches for rotated scanouts
    
    We need to manually flush the render cache in order for results to be
    visible on the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db7979981032d5647069f213a063dcbf78e57890
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 27 09:36:58 2012 +0100

    sna: s/width/height/ cut'n'paste typo
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcbbe1664ae62ae275068cc040f385d2320d5213
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 27 09:30:44 2012 +0100

    sna: Remove a trailing ';'
    
    The unwanted ';' caused is_cpu() to always return false if a GPU bo was
    attached. Not necessary a bad thing, just misses the potential
    optimisation where having chosen to prefer to use the CPU path we then
    have to migrate to the GPU even though the bo is undamaged or idle.
    
    Spotted-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a072ab506569ecff5b4c57fa90f7a417db69f33b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 26 17:24:37 2012 +0100

    test: Add client side copy to FakeFront for emulating CopyBuffer correctly
    
    The server manages FakeFront following a flip, but it the client
    optimises a swap by replacing it with a CopyRegion, it is expected to
    also update the FakeFront itself. Replicate that behaviour so that the
    timings for the test case are consistent with mesa.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96804c74f8f0d19fc1b9db467cf050f4934fe83b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 26 17:09:45 2012 +0100

    test: FakeFront rules
    
    Oh my, I just once again rediscovered the copy on every flip due to the
    requirement for keeping FakeFront uptodate for reads after a SwapBuffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f306cd557ef263ff5057e413c335cc75bc0f7895
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 26 14:59:37 2012 +0100

    sna/dri: Hold a reference to the cached DRI2 buffer on the front buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a87f2b9325bfad2bb3f93226706b6f9a09598945
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 24 13:48:38 2012 +0100

    sna/gen4: Check for peculiar initial values for the surface offset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f4221a2520b7ed1f67b41185c2e4842e83e53ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 26 15:56:50 2012 +0100

    test: Add a simple exercise for DRI2 swap paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a505015a254d6c6e24f0542bc141cde873dc6f34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 25 22:50:47 2012 +0100

    sna: Force DPMS to be on following a modeset
    
    Similarly to UXA, this papers over inconsistent behaviour in the kernel
    in handling the DPMS upon a modeswitch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7a8c94cdb9cf42a31f8ce128d70e23458ba2042
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 25 20:49:59 2012 +0100

    sna: remove the assert(0)s along error paths
    
    This were there as a debugging aide to see if we ever hit unreachable
    code paths - mainly along corruption inducing GPU wedged recovery paths.
    They are superfluous and just scare the reader.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15c0ee445f603033c82f357fedfc7737d198d7b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 24 19:28:03 2012 +0100

    sna/gen5: Tweak thread allocations
    
    Bump the alloted number of threads to their max. Using more threads than
    cores helps hide the stalls due to sampler fetch, math functions and urb
    write. Specifying too many threads seems to not incur a performance
    regression, suggesting that the hardware scheduler is sane enough not to
    overpopulate the EU.
    
    A small but significant boost, peak x11perf -aa10text on an i3-330m is
    raised from 1.93Mglyphs/s to 2.35Mglyphs/s.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa10005ce31483827547b7f71eae066899f0026c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 23 17:28:00 2012 +0100

    sna/dri: Perform an exchange for a composited windowed SwapBuffers
    
    If the front buffer is not attached to the scanout and has not been
    reparented, we can simply exchange the underlying bo between the
    front/back attachments and inform the compositor of the damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53d735ddb16b0204662b8584aa22998ba53deec1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 23 10:16:44 2012 +0100

    sna/dri: Queue windowed swaps
    
    Implement "tripple-buffering" for windowed SwapBuffers by allowing the
    client to submit one extra frame before throttling. That is we emit the
    vsync'ed blit and immediately unblock the client so that it renders to
    the GPU (which is guaranteed to be executed after the blit so that its
    Front/Back buffers are still correct) and requests another SwapBuffers.
    The subsequent swapbuffers are appended to the vsync chain with the
    blit/unblock then executed on the vblank following the original blit.
    That is both the client and xserver render concurrently.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e9319d5f56583be99f573f208cebb0ee3b5cc26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 22 11:22:16 2012 +0100

    sna: extend RandR to support super sized monitor configurations
    
    With the introduction of the third pipe on IvyBridge it is possible to
    encounter situations where the combination of the three monitors exceed
    the limits of the scanout engine and so prevent them being used at their
    native resolutions. (It is conceivable to hit similar issues on earlier
    generation, especially gen2/3.) One workaround, this patch, is to extend
    the RandR shadow support to break the extended framebuffer into per-crtc
    pixmaps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8b090902e788257610374deae659f01a91888f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 22 22:01:37 2012 +0100

    sna/gen3+: Remove stale assertions for cached vbo
    
    Following the previous commit, we reset the vbo when it becomes idle
    rather than discard it. As such, the assertions to check that we are
    discarding the vbo are now bogus.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 565297e6bd3457a150036af9c62fe0dc67b794ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 13:53:02 2012 +0100

    sna/gen3+: Keep vbo cached
    
    Once we switch to using a vbo, keep it cached (resetting everytime it is
    idle) until we expire our caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d806973e21cd46e605b3cd405323ae7a64c12798
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 12:57:13 2012 +0100

    sna: Micro-optimise search_inactive_cache
    
    Discard the unneeded next parameter to drop a memory reference in a hot
    path, and don't wait for a retirement if we are looking in a larger
    bucket than suits.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d39fef0a7f3daf5c07686b44e4dea01c0f06c77a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 12:25:35 2012 +0100

    sna: Tiles are only 128 bytes wide on gen2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f2dde1fa3b04b27bae8fc0bca9c824bd362d23b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 10:31:24 2012 +0100

    sna/gen7: Eliminate the pipeline stall after a non-pipelined operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ef05a8d0833203e265aff392f225a11a11c2d01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 09:36:42 2012 +0100

    sna/gen7: Do not emit a pipeline stall after a non-pipelined command
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4501e131e6b737cb8f2581c8b1f7ea9d29a8e912
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 16:38:32 2012 +0100

    sna/gen7: prefer using RENDER copy
    
    Further testing and the balance of doubt swings in favour of using the
    3D pipeline for copies.
    
    For small copies the BLT unit is faster,
    2.14M/sec vs 1.71M/sec for comppixwin10
    
    And for large copies the RENDER pipeline is faster,
    13000/sec vs 8000/sec for comppixwin500
    
    I think the implication is that we are not efficiently utilising the EU
    for small primitives - i.e. something that we might be able to improve.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3da56c48b7820ec77d704c5a16670eb86a6f673f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 15:14:23 2012 +0100

    sna/gen7: Prefer using BLT rather than redirect for copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1f8386db6e9b3eea1bdbf8cde90f33792640ce8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 23:28:14 2012 +0100

    sna/gen7: Emit a pipeline flush after every render operation
    
    For whatever reason, this produces a 30% improvement with the fish-demo
    (500 -> 660 fps on i7-3730qm at 1024x768). However, it does cause about
    a 5% regression in aa10text. We can appear to alleviate that by only
    doing the flush when the composite op != PictOpSrc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d02e6d81420a114c9622bbdaf90fc3ae5d4b15a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 21 16:10:02 2012 +0100

    Encode the third pipe using the HIGH_CRTC shift for vblanks
    
    The original vblank interface only understood 2 pipes (primary and
    secondary) and so selecting the third pipe (introduced with IvyBridge)
    requires use of the HIGH_CRTC. Using the second pipe where we meant the
    third pipe could result in some spurious timings when waiting on the
    vblank.
    
    Reported-by: Adam Jackson <ajax@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8b67be8d3b5d5cbe730ba5dba3edd2d30a99d9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 12:39:19 2012 +0100

    sna: Don't clear the needs_flush flag after emitting a flush on the busy bo
    
    We use that flag to check whether we need to check whether the bo is
    still busy upon destruction, so only clear it if the bo is marked as
    idle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5419bbb483af595d7021e49debef7700c599217e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 11:21:52 2012 +0100

    sna/gen7: Prefer BLT for copies
    
    It's faster for where the cost of the extra batches and ring switching
    do not dominate...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c0bb8c4c93a43e2932429a9f6c23d91f1be2060
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 10:57:40 2012 +0100

    sna/gen7: Keep using RENDER paths for large pixmaps
    
    As the 3D pipeline is quite versatile and we only need to force BLT if
    we cannot extract the subregion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b238f64e8a53883cfe7c568e37ef18bbee77996e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 20 10:46:59 2012 +0100

    sna/gen[67]: Prefer to not force BLT paths for large pixmaps
    
    The sampler can in fact handler subregions of large pixmaps quite well,
    and so we prefer to keep using the 3D pipeline so long as the operation
    fits in. If not, then switch to the BLT in order to avoid the temporary
    surface dance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38f06a351fdd35fa5c6136e9a25e034a812a94c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 22:22:12 2012 +0100

    uxa: Fix second regression in glyph fallback from 64a4bc
    
    To complete my show of incompetence for the evening, not only do we have
    to restore the original source when compositing the mask onto the
    destination, we also need to restore the original dst (rather than
    composite the mask onto the mask!).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fda9faee755cb35906ca1179a568332ef2de35a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 21:01:47 2012 +0100

    uxa: Use the original src for fallback glyph compositing
    
    In 64a4bcb8cefff, I introduced a WHITE source for the purposes of
    accumulating the glyph mask correctly. Unfortunately I neglected to
    restore the original source picture for compositing the glyph mask on
    the destination, resulting in a use-after-free and then corruption.
    
    Reported-by: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8141e290b1ac7c4d1524bb389a84a8f375df4634
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 20:24:33 2012 +0100

    sna: Explain why we ignore the busy status result during kgem_bo_flush()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb1d07624e5aeb7b5db7ceb46975091e92185d63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 16:00:13 2012 +0100

    sna: Ensure extents is initialised if short-circuit use-cpu-bo
    
    As we may attempt to end up using the GPU bo is the CPU bo is busy, we
    need to make sure we have initialised the damage extents first.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f216e159bd05ddd269eb8ddf3ca7a407c2901e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 15:57:31 2012 +0100

    sna: Assert expected return values
    
    Keep the semantic analyser happy by consuming the expected return value
    with an assert.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2dc93b2a6c832ce8b972de90d09080e860dcd40f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 15:34:09 2012 +0100

    sna: Check results from syscalls
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06634604abf15fdd27dd007fcf81595da994146b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 15:28:43 2012 +0100

    Initialise adaptors to 0 in case xf86XVListGenericAdaptors does not
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bfea58dbc634cadc399d3132030c591e086880c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 15:26:18 2012 +0100

    sna: Minor cleanups from sematic analyser in DBG
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a43d425670b883b04565296c0510e7ba03ba6de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 14:46:58 2012 +0100

    uxa: Implement glyphs-to-dst to avoid fallbacks
    
    An earlier version was buggy and introduced corruption as it failed to
    fallback gracefully with ComponentAlpha glpyhs. This is a much simpler
    implementation that composites each glyph individually, leaving it to the
    backend to optimise away state changes. It should still be many times
    faster than incurring the fallback...
    
    Reported-by: Oleksandr Natalenko <pfactum@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50508
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64a4bcb8ceffff8e4ee448d8a467620596703509
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 13:42:12 2012 +0100

    uxa: Use (white IN glyph) ADD mask to compose the glyph mask
    
    As pointed out by Soren Sandmann and Behdad Esfahbod, it is essential to
    use white IN glyph when adding to the mask so that the channel expansion
    is correctly performed when adding to an incompatible mask format.
    
    For example, loading alpha as the source results in the value 000a being
    added to the rgba glyph mask (for mixed subpixel rendering with
    grayscale glyphs), whereas the desired value is aaaa.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99845dcb3ba862269b29aec782e2bcef31c0403e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 10:37:10 2012 +0100

    Post Damage on the Screen Pixmap after a pageflip
    
    This issue was raised by Dave Airlie as he is trying to integrate
    multiple GPUs into the xserver, and a particular setup has a slave
    rendering device that copies the contents from the GPU over a
    DisplayLink USB adaptor. As such the slave device is listening for
    Damage on the Screen Pixmap and needs the update following pageflips.
    Since we already are posting damage for all the SwapBuffers paths other
    than pageflip, for consistency we should post damage along the pageflip
    path as well.
    
    Reported-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4acf727941a37651f672db3774281a437940c540
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 10:20:54 2012 +0100

    sna: Initialize the color value for fallback unaligned boxes
    
    Reported-by:Zdenek Kabelac <zkabelac@redhat.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=5047
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0b2d3c9663c29e9844aef1608416ae40c194b55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 00:41:35 2012 +0100

    sna: Avoid copying unintialised data during source picture upload
    
    If we have never written to a pixmap, then there will be neither a GPU
    or shadow pointer and we would attempt to copy a NULL pointer. In this
    case as the user is expecting to copy unintialised data we are at
    liberty to replace those undefined values with the clear color.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38472fcc53c5dceb98b96458183e6729b8311a43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 00:37:12 2012 +0100

    sna: Double check that the source is busy before performing indirect reads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cdfb8c24c8b49c88451714d80293c66d63e8c01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 19 00:36:41 2012 +0100

    sna: Fix up the shadow pointer on the source when copying
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17f3a83fdc8c0ef5c12fb4be34d86021c0c865e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 23:48:16 2012 +0100

    sna: Review sna_copy_boxes
    
    A couple of ordering issue and more assertions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9045699b9cd66d0b0d96bfc964458c96845f97f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 23:47:21 2012 +0100

    sna: Reset region after transferring to cpu
    
    If we adjust the region for the pixmap offset, be sure that we reset it
    before returning it back to the caller.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f51311a7d95bf4bc23926b8e6bf8ee52afd180c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 23:45:50 2012 +0100

    sna: Check if the busy is truly busy before commiting to an indirect upload
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 291b3c4367b455bfc5a772f8caaeee73f36d826a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 23:43:00 2012 +0100

    sna: Align upload buffers to 128
    
    This seems to be a restriction (observed on 965gm at least) that we
    have incoherent sampler cache if we write within 128 bytes of a busy
    buffer. This is either due to a restriction on neighbouring cachelines
    (like the earlier BLT limitations) or an effect of sampler prefetch.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50477
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39e5c7491535999643c1761bb1602ad757ab486c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 21:58:27 2012 +0100

    sna: Assert damage is valid after every addition
    
    Even more paranoia than just checking upon migration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92e1693e5fb3a1dd89fca5e5ecc660e2de78f9cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 21:26:58 2012 +0100

    sna: Validate cpu/gpu damage never overlaps
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50477
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2312c8f958002e54ddcb834f37916f4b46ac291
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 21:29:29 2012 +0100

    sna: Fixup tracking of vmap upload buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75e9eeca7e998b1ee3f8b0df780adae1b9e5b408
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 16:39:20 2012 +0100

    sna: Remove overlapping CPU damage when operating inplace on the GPU
    
    Otherwise we gradually introduce garbage into the picture.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50477
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a936466dd41c4bb8b0956c4da5a5838f991b332a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 11:36:53 2012 +0100

    sna: Prefer to attempt a Composite operation rather than use pixman composite
    
    As pixman composite performance is atrocious for anything other than
    solids, prefer to upload the mask and attempt a composite operation on
    the GPU unless we are forcing the fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b325d6e2b99ec3f63a7c5175f6f4746f6773550
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 18 11:24:55 2012 +0100

    sna: Fix rendering of unaligned boxes through pixman
    
    Not only do we need to make sure the source is available to the CPU, we
    need to actually check the right conditions for clipping the box.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caef27492b5a70bd46a09cd5094b2c93e38e39ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 20:56:46 2012 +0100

    sna: convert another instance of applying the clear to the CPU pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8695c4c77666cd07eab51efcbc7c4f11c85250fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 16:53:53 2012 +0100

    sna: Fix the blt composite op with no-ops
    
    When returning early because the operation is a no-op, we still need to
    fill in the function pointers to prevent a later NULL dereference.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7905ddae1dbc8805d0fadbd6d21c7a5df7e715fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 17:01:12 2012 +0100

    sna: Further refine choice of placement when uploading source data.
    
    The goal is cheaply spot a simple copy operation that can be performed
    on the CPU without having to load both parties onto the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a675b61f27273f7ef344d4056dbba1f8cd97737
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 15:42:17 2012 +0100

    sna: Correct typo forcing everything to be clear to 0!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b55bf1abbe71281e3d9ebde1c4005d40902d5e7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 14:14:44 2012 +0100

    sna: Fix cut'n'paste errors in tiling debug
    
    Rename for different variables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9756c60b4ad15281d025b9c27f19d19e8a630958
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 11:39:33 2012 +0100

    sna/gen7: Enable non-rectilinear spans
    
    Seems we have enough GPU power to overcome the clumsy shaders. Just
    imagine the possibilities when we have a true shader for spans...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41aff56a1f452e409c7a49512a1d2824b74f3838
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 10:50:31 2012 +0100

    sna: Add tiling for spans
    
    Semmingly only advisable when already committed to using the GPU. This
    first pass is still a little naive as it makes no attempt to avoid empty
    tiles, nor aims to be efficient.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 222e6ff43ef683e82101fb360911fc01fbe00597
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 23:40:30 2012 +0100

    sna: Read inplace for fallback copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79d468925bb012806e097337e4e5930818c6ab46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 17:54:21 2012 +0100

    sna: Decrease latency for 1x1 GetImage by using an inplace mapping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c2a8d3780f1d8de3f13bee8e068fdaf608ff9e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 23:19:49 2012 +0100

    sna: Allow reads to be performed inplace
    
    If we can guess that we will only readback the data once, then we can
    skip the copy into the shadow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc6997f6f751d3ba352dfc20c6717ec12b8fac47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 17:54:15 2012 +0100

    sna: Cleanup damage processing after operating inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 937ca8a5d8a0f70a0724db1519bb7b5fc0857425
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 17:53:58 2012 +0100

    sna: Use memset for simple clears
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de4572b0b52e2fcfcad04660ee2f81ee88d500a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 13:40:26 2012 +0100

    sna: Inspect CPU damaged state when deciding upon Composite placement
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b689cd924c500373e1e293dd9eb54a238e400381
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 16:25:51 2012 +0100

    sna: Composite traps inplace if the CPU is already all-damaged
    
    One outcome is that inspecting the usage patterns afterwards indicated
    that we were missing an opportunity to reduce unaligned boxes to an
    inplace operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae3c0963790cfb6f984ed4ad3ecbaae492775e1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 16:25:51 2012 +0100

    sna: Composite glyphs inplace if the CPU is already all-damaged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eaed58b2baf30eaea37be06cfc1d9d81059aba27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 16 12:55:54 2012 +0100

    sna: Tweak placement of operations
    
    Take in account busyness of the damaged GPU bo for considering placement
    of the subsequent operations. In particular, note that is_cpu is only
    used for when we feel like the following operation would be better on
    the CPU and just want to confirm that doing so will not stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8eac098962891a5deb7c53d36c6dec57c7f2b972
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 17 09:51:12 2012 +0100

    sna/gen3: Add another DBG for dropping vbo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 515c8b19d638d4a811b159ef0dc7cf4059e30217
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 15:41:14 2012 +0100

    sna: Prefer to operate inplace if already mapped of the GPU is wholly dirty
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1713941e9db3e7a6d83466be1b253978fb4bf01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 15:29:59 2012 +0100

    sna: Tweaks for DBG missing glyphs through fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b23605efba009fb340ec10b37d54caae159b9b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 15:28:31 2012 +0100

    sna: Don't trim prepare for glyphs_via_mask
    
    If we pass the expected width/height without passing the per-glyph
    offset into the preparation function, we make the erroneous mistake of
    analysing the glyph cache only for the mask extents and so will miss
    glyphs that we need to upload for the operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f66b27114fcc457fa5cb2d5889e875384f89e75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 13:47:33 2012 +0100

    sna: Remove mark-as-cpu after gem_pread
    
    The kernel no longer moves the read bo into the CPU domain, so remove
    the last vestiges of that tracking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfd88d5429528b0162eafcc9496bfd1c708b60cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 11:21:29 2012 +0100

    sna: Silence a few compiler warnings
    
    Nothing harmful, just noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3659beec8c4126de5da4df5cb2cc077b7af6c0b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 15 11:08:18 2012 +0100

    sna: Check for zero-sized damage regions after trimming Windows to their pixmaps
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 293a867ea55d3004f5be21b1d0ad765a89c28a5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 23:02:10 2012 +0100

    sna: Specialise the self-copy blitter to handle vertically overlapping copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b76ab995bb70da5f76afead7c696cb7fd72b158
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 22:33:11 2012 +0100

    sna: Add a little bit more DBG to migration IO paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49543522e789a0a8213c164b37a18c0642e60ac4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 20:25:21 2012 +0100

    sna: Fix reversed assertion
    
    Darn the double negative! After adding damage we want to assert that
    the region is not empty, not !not empty.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e50467b4f50b522a07bedae7ff68b9c37362af8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 17:40:09 2012 +0100

    uxa: Force the outputs to off for consistency with xf86DisableUnusedFunctions()
    
    Upon a VT switch, we set the desired modes and turn off the DPMS on any
    unused output. Make this explicit so that we always maintain consistency
    between the kernel and X's list of enabled CRTCs.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50772
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a56a0b10eb3ab07efd28efdc79d0fd3a6fa20ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 19:26:42 2012 +0100

    sna: Make the disable-unused after vt switch distinct from DPMS off
    
    So that we do not lose control over dpms on/off!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b415ca05c2e1c4f09f85d8769d39e5369661ed3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 17:06:19 2012 +0100

    sna: Reset damage extents after reduction goes to zero
    
    If the reduction of the damage clears all of the boxes, we need to reset
    the -infinite extents so that we continue to accumulate further damage.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50744
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0df7c488640d3590d2a88dc353b72167b6644eaa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 16:09:38 2012 +0100

    sna: Supporting overlapping copies for fallback blits
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50393
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5b273b20b7d917d08af120815c28b1618d3342c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 14 15:35:24 2012 +0100

    sna: Explicitly disable the CRTC so that xserver/kernel agree after VT switch
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50772
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 221534abe2dc04fae8b8fc332104bca275d4863b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 22:48:43 2012 +0100

    sna: Only reduce damage addition to a region operation if clean
    
    Some paths bypass operating upon the region as they do not have an
    YX-banded set of boxes and so prefer to defer the costly construction of
    the region till later. As a result, we have to be careful not to
    overwrite any existing information if we do operate on the region after
    setting the dirty boxes.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50744
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0db789e180b6b01fb8aff547879387058f52a0b9
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Wed Jun 13 14:26:37 2012 +0200

    sna: Constification
    
    Adding preserving const modifiers to decrease amount of const warnings
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33998a7080aa7f50ba922c764c6a93fe951c5b64
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Wed Jun 13 14:26:36 2012 +0200

    sna: Fix typo and compare y1 to y2
    
    It seems 'y1' was meant to be compared here
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ade32fbad4014efcc8aa8ed4cd0f8a39f9ab107
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 14:28:43 2012 +0100

    sna: Fix operator preference around a | b & c | d
    
    Tell the compiler what we really mean is a | (b & (c | d))
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20f3114ccd63052b4fd06ef1d87efaaabbbac7ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 14:27:10 2012 +0100

    sna: Use long for simplicity when printing size_t values for debugging
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f75b8da6a468188dd0c00015395424598b3f502
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Wed Jun 13 14:26:33 2012 +0200

    sna: Valgrind updates
    
    Add some mising initialization for unknown ioctl
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70cf637ca47c9e67758e09c7e1d10eef51db1f98
Author: Zdenek Kabelac <zkabelac@redhat.com>
Date:   Wed Jun 13 14:26:32 2012 +0200

    legacy/i810: Fix declaration to match definition
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fea2478cd5ab4156c182210d28c5e27e5f67403
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 14:10:01 2012 +0100

    Lots of trivial semantic fixes
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e499f207c161d1b3cd75f065dc89021ff5f40b63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 13:11:17 2012 +0100

    sna: Fix memleak from sna_crtc_find_plane()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49da55da518348fc6b88e09d5132dd1b1d751304
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 11:20:41 2012 +0100

    sna: Free the reversed glyph bits along with the font
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f68c7fe6aa34ab17d82489fca5f63a3ce335444
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 11:15:42 2012 +0100

    sna: Free clip rectangles after intersection with PolyRectangle extents
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab3b7fe31b5a9d7924e959f21d29c4f7352ec8cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 10:35:14 2012 +0100

    sna: Only reuse a write buffer if all external references have been dropped
    
    This avoids the unhappy situation of overwriting an upload buffer that
    we intend to use for a fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8cb656dc4bab1489df9dfb4cb64704b2a9fa34b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 13 08:10:10 2012 +0100

    sna: Free clip intersection with line extents after use
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 572745eb243a96819c8fa248f4ffdd703ed13b0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 12 22:49:05 2012 +0100

    sna/damage: Remove unused return value
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aefc0417dde8b2137a787459a69d91c14902f22b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 12 22:47:41 2012 +0100

    sna/damage: Simplify initialisation of damage extents
    
    Just use the already computed region->extents when adding the first box.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78a96e812b912c5b25a02670f603f455f93e9d00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 12 21:43:31 2012 +0100

    sna: Refresh the damage self-tests
    
    They had bitrotted with the revamp and needed some massaging to update
    to the new interfaces.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6138f7434a6fb014299a7e9a8392ef962c8cba30
Author: Cyril Brulebois <kibi@debian.org>
Date:   Tue Jun 12 21:19:14 2012 +0100

    Fix up braindamage in previous commit.
    
    ickle: Fixing up my idiotic change, obviously too much birthday cake.

commit 224d631a232d3536e0f1f2780bfbe1218ee7590f
Author: Cyril Brulebois <kibi@debian.org>
Date:   Tue Jun 12 21:14:53 2012 +0100

    Avoid calling xf86nameCompare() with a NULL string
    
    Device sections without a Driver property would lead to a server
    segfault because of a NULL pointer's being passed as the second
    argument of xf86nameCompare().
    
    Debian bug #677206 <http://bugs.debian.org/677206>
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>

commit 3b9b64c7c9b5b0bfaafb97c9a9fe5849bbb412da
Author: Dave Airlie <airlied@gmail.com>
Date:   Tue Jun 12 10:26:34 2012 +0100

    uxa: do copy fb at startup.
    
    Copy the current framebuffer for smooth wayland->gdm handoff.
    
    This has been hanging around in Fedora for too long now, and we've
    dropped the feature a few times, and yes I know the Simpsons did it^W^W^W
    SNA does it.
    
    I've updated the code to have some of the better fixes from nouveau.
    
    I've no idea who wrote this code either, krh or ajax. [ickle: The
    earliest version I've found had krh's fingerprints on it, though it may
    still have been a joint effort.]
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    [ickle: improve error handling, only copy the fb during initial takeover]

commit b6525702b9ffd21beb8ea6bb10a8ad5ce7f9de14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 12 11:59:31 2012 +0100

    sna: Hook up AdjustFrame()
    
    Looks to be unused by the core, just a solitary invocation in an obscure
    extension it seems. However the implementation looks trivial so
    incorporate it until it is finally removed, just in case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b281d1300127d65392aaadbbe2299fa9e1749a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 12 10:37:04 2012 +0100

    sna: Remove a pair of empty stub functions
    
    The export wrappers for the glyph cache constructor/destructor existed
    in case there was a need to add more routines. Since that never
    happened, remove the extra step of indirection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 392e33a62d729c64c57699505220b4029e015470
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 11 09:51:41 2012 +0100

    sna: Instrument memory/bo allocations for monitoring over time
    
    Hide it behind --enable-debug=memory to avoid incurring the cost for
    everybody.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e984b79cce038ba5026d8bdd93dec9b5a6ced8a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 11 09:02:03 2012 +0100

    configure: Correct the help string for --with-default-accel
    
    Prior to finalizing the defaults I changed my mind and realised that the
    default had to reflect the current behaviour of someone enabling SNA for
    the first time, and not the previous behaviour of --enable-sna to
    override UXA. This is so that distro's could offer an SNA enabled DDX
    for the brave whilst not affecting their typical no-xorg.conf users.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7614a541886dd9eb5c9d441e2618785e9cc53a65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 10 09:36:38 2012 +0100

    configure: Harden --with-default-accel against simple mistakes
    
    If the user specifies no options, assume automatic selection. Then
    double check we found a valid backend and so avoid later breaking the
    build.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea0209fbc12fca282bd8ef72223791bf163801ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 8 22:44:23 2012 +0100

    sna: Remove option to disable vmap
    
    It works everywhere, so when it is finally enabled, let it be.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18baa1428b1c4c0a49927d4c32db091db9e4e97b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 8 22:43:01 2012 +0100

    Make the enum list of options consistent with the actual table.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit adc872a9654dc18d778323ca0721704878ad3851
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 8 06:44:20 2012 +0100

    sna: Add DBG spew to flink()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a62ad4e80722db187766c83a16fa84ec236cc5eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 7 23:37:59 2012 +0100

    sna: Skip flushing the active queue if there is not a suitable bo pending
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 318982566bbc7145847bd03601087150eef7a8d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 7 21:56:04 2012 +0100

    sna/dri: Disable experimental code by default
    
    Since these require non-upstream patches to other components, we don't
    want it enabled by default and randomly breaking builds.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebf84b8e572b5cb1a509000d412dfa5be3d1aca3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 7 20:15:53 2012 +0100

    sna/trapezoids: Micro-optimise cell allocation
    
    The pool is a fixed size so we can delete the generic code to handle
    variable sizes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a25fc68c5cd82cad4b99b0f2357f430c8783c3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 7 19:13:09 2012 +0100

    sna: Actually create Y-tiled source pixmaps
    
    An inconsistency highlighted by 7c51cabaecac revealed that we had a
    mismatch between the check in move_to_gpu() and how we created the
    pixmap. This mismatch resulted in us creating and uploading tiled
    pixmaps for single shot textures, and the increase aperture pressure was
    causing a regression in firefox-fishbowl on pnv, for example.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c58d137d3eeb0e97bfd53e68404e04d9012b5697
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 7 11:18:27 2012 +0100

    sna: Suppress DBG prints along potential SIGIO paths
    
    As ErrorF/fprintf is not re-entrant due to its mutex we can not use DBG
    from code that could be called by a signal handler. X's SIGIO handler
    attempts to move the cursor from within the handler (eek!) and so we
    need to be careful not to take any locks, such in as the aforementioned
    fprintf, along the cursor paths.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50744
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f5b94f3d1625b06840c6441a0b175604ee3d2f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:24:07 2012 +0100

    sna: Check against integer overflows when computing cache size
    
    Even with a 1nm process, I doubt we will see 4+GiB cache sizes ;-)
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 902391bd798775e1a7a53503d4dd1756162f737f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:20:39 2012 +0100

    uxa: Remove dead-code for SourcePictures
    
    All SourcePictures are now converted into Drawables, which had been
    assumed by the driver backend. However, the code still existed to
    attempt to pass procedural pictures onwards and so set pSrcPix to NULL
    which was being flagged by the static analyser as a potential NULL
    dereference.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d8a1f7176877975a31ad7a6548fa8309065f617
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:15:42 2012 +0100

    sna/gen4+: Add missing "fall through" comments
    
    Reported-by: <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ae4407c43e6a8d26784508f61b416138f908132
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:13:05 2012 +0100

    sna: Silence static analyser complaining about potential NULL pointer
    
    Add an assert to prove that is not.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08010b23a3e2bc37d202251923fac814b18fa501
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:10:35 2012 +0100

    uxa/dri: Silence static analyser for potential NULL intel_pixmap
    
    If the intel_pixmap was NULL we should have failed to create the DRI2
    buffer, so we can safely assert here to keep the analyser quiet.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06b1b875ba13227ddaf7f28dbdcdaa3eb49f0857
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:05:13 2012 +0100

    uxa/i915: check for failure to allocate temporary destination
    
    If the target drawable is too large for the render pipeline, we need to
    create a temporary surface. This may fail, so abort if it does.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c553dcae2dd714cac413ffc7c7779cd78c9a3e61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 17:04:01 2012 +0100

    sna: Silence a few unused function warnings
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 536033b4edb40db18210e5272eb8ce9703e5e364
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 16:02:47 2012 +0100

    legacy/i810/dri: Check for malloc failure for BusIdString
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2da80c1d1058dca5d3d85693918e53d9fa61dd3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 15:59:54 2012 +0100

    sna: Add some missing 'fall through' comments
    
    Static analysers are dumb and presume readers are too.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c433fb4521e2fb65a555489bd09ba6bb9448b72f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 15:17:30 2012 +0100

    uxa/dri: Fix up typo from f2513cb0f
    
    s/true/FALSE/? Wrong.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1675f441049d559d891fe378e437c12db21df9e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 12:55:13 2012 +0100

    uxa/dri: Transfer reference of the new_back buffer to the flip_chain
    
    In order to prevent a leak of the bo when the chain is eventually
    torn-down when the client exits.
    
    Reported-by: Andreas Lampersperger <lampersperger.andreas@heidenhain.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50670
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18726a4975ab2ddf85eaa6eb1602dcbe599217f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 10:58:49 2012 +0100

    sna: Perform CopyArea directly onto a CPU bo if available
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57d7d5de78bcf01d75d7a7de03fe50a2a9bd1b7e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 00:08:17 2012 +0100

    sna: Use GPU for readback onto CPU bo
    
    Time to blt from GTT to LLC 16384 bytes:	 125.000µs (snb)
    Time to blt from GTT to LLC 16384 bytes:	  71.000µs (ivb)
    Time to blt from GTT to LLC 1048576 bytes:	1400.000µs (snb)
    Time to blt from GTT to LLC 1048576 bytes:	 938.000µs (ivb)
    
    Time to copy from GTT to LLC 16384 bytes:	 118.000µs (snb)
    Time to copy from GTT to LLC 16384 bytes:	 134.000µs (ivb)
    Time to copy from GTT to LLC 1048576 bytes:	6723.000µs (snb)
    Time to copy from GTT to LLC 1048576 bytes:	7424.000µs (ivb)
    
    And conversely,
    
    Time to blt from LLC to GTT 16384 bytes:	 10.000µs (snb)
    Time to blt from LLC to GTT 16384 bytes:	  8.000µs (ivb)
    Time to blt from LLC to GTT 1048576 bytes:	217.000µs (snb)
    Time to blt from LLC to GTT 1048576 bytes:	135.000µs (ivb)
    
    Time to copy from LLC to GTT 16384 bytes:	  4.000µs (snb)
    Time to copy from LLC to GTT 16384 bytes:	  4.000µs (ivb)
    Time to copy from LLC to GTT 1048576 bytes:	270.000µs (snb)
    Time to copy from LLC to GTT 1048576 bytes:	179.500µs (ivb)
    
    It seems clear then that even with the extra synchronisation cost
    copying from the GTT is much preferable with the GPU than using the
    uncached reads by the CPU. Streaming write-combines from the CPU into
    the GTT seem about as efficient as we can manage, so continue to use the
    mapping unless busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2513cb0fdb0d1214854fd4e4dcd477ba8583862
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 6 10:41:35 2012 +0100

    uxa/dri: Do not use undeclared stdbool features
    
    The header isn't pulled in, so stop using the undefined values of
    true/false.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1dafb4777f8378c87f34feae667582498220204c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 21:25:40 2012 +0100

    sna/damage: Add some assertions to validate that each damage box is non-empty
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50744
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4eb5528a456b65c673f7c984d14a622ac67cdca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 16:04:16 2012 +0100

    uxa: Check for DPMS off before scheduling a WAIT_ON_EVENT
    
    Regression from commit 3f3bde4f0c72f6f31aae322bcdc20b95eade6631
    Author: Chris Wilson <chris@chris-wilson.co.uk>
    Date:   Thu May 24 11:58:46 2012 +0100
    
        uxa: Only consider an output valid if the kernel reports it attached
    
    When backporting from SNA, a key difference that UXA does not track DPMS
    state in its enabled flag and that a DPMS off CRTC is still bound to the
    fb. So we do need to rescan the outputs and check that we have a
    connector enabled *and* the pipe is running prior to emitting a scanline
    wait.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50668
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c51cabaecac52348766c622e80ed14b9854e54d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 12:59:46 2012 +0100

    sna: Try to create Y-tiled pixmaps for initial source bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a26c05cc8936cab28d83c6beeff906a910353338
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 12:48:33 2012 +0100

    sna/gen2+: Tweak placement of operations for CPU-bound large pixmaps
    
    Try to avoid uncessary migration to the GPU of large pixmaps that are
    wholly bound to the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a21bdbe3e312b40b936c5c68c84f5c1bc0f9fb88
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue May 22 15:44:28 2012 +0100

    sna: port to compat api
    
    This ports SNA to the new compat-api.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 8f5001493e18b6b3b97ca5f0c923678a51975bd0
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue May 22 15:35:01 2012 +0100

    intel: port legacy and uxa to new API.
    
    This ports the legacy and uxa driver to the new server API.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit c9824827422f8ec4f46c9cba42d871c98dc54761
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jun 5 10:38:21 2012 +0100

    sna: drop using block/wakeup data.
    
    These went away in the new server API, and really if this
    made any measurable difference, I'd be impressed.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit d9850a05003008d86d0b226bcd775aebdd43bccd
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jun 5 10:04:48 2012 +0100

    uxa: drop enable disable access hook
    
    This looks to be unused.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 99df720216787c52d16a350dd25469e2dcea2c47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 10:24:34 2012 +0100

    sna: Add inline keyword in conjunction with attribute(always_inline)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47d7da5a986a9f133cd3dc8314ff243001586a36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 5 10:18:40 2012 +0100

    sna: Maintain the operation on the CPU if not completely replacing all-damaged
    
    We may as well continue the operation on the CPU if already bound to try to
    reduce needless migrations (where the cost of the upload will outweigh
    further use).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81f09347f2ab59cf0a3eaca7be83ded555655e93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 16:45:05 2012 +0100

    uxa/i965: Silence static analyser by asserting the bo exists for the video
    
    This is already checked at the beginning of PutImageTextured, so this
    check upon the return value of intel_get_pixmap_bo() should only be
    required to keep static analysers happy.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f43de322b400dcd64eb4545a978ad9b1c7de185
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 15:39:39 2012 +0100

    sna: Exclude consideration of tiling flags from overwriting BLT commands
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebb1c9d5f82e8822f7400ff11a887ab047a0d78e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 15:28:31 2012 +0100

    sna: Make the bo-is-busy DBG more useful by saying which bo it is
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6dc5ddfe807b307ca10af971c4f84498b2fb82a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 13:49:35 2012 +0100

    sna: Remove bogus check for color == 0
    
    This was written when the RGBA color value was being passed around and
    not the pointer to the xRenderColor. As such, the NULL deref check
    doesn't gain much and the check for rgba==0 irrelevant in this scenario.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b3937228c692598899fb39bfe448a9b457315db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 13:47:58 2012 +0100

    sna: Simplify selecting default tiling for framebuffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff91fd4a2749f1ea8722189aaec938e51bce4222
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:41:05 2012 +0100

    uxa: Check for failure from drmModeGetConnector()
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4712a4008aaff7b3c57a8dd0a5e639992c9b6d30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:40:56 2012 +0100

    shadow

commit 63a55e9db97b647cbf7385403a0f30ee4d24dc3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:36:11 2012 +0100

    uxa/shadow: Free the buffer along the unexpected failure to attach to the pixmap
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9bd4ed7d7d5c9ba6924e911652e03abc9267865
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:29:58 2012 +0100

    legacy/i810: Silence a compiler warning for missing 'const'
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f8b411b8a833cca6fce8888ce515db6413d57ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:21:27 2012 +0100

    uxa: Preferred order for calloc is (count, size)
    
    And assert that the allocation succeeds for good measure. A great big
    dollop of graceful failure is missing...
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72a29aa74a1488269c2184300e573d060c49e232
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:21:27 2012 +0100

    sna: Check that the buffer was allocated prior to caching it
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9bff89b1892cee90a80909255876240126b700b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:21:27 2012 +0100

    legacy/i810: Be paranoid and guard against xf86GetPciInfoForEntity
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed6004f7ad09329bd4097331aaff38edc83107b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:21:27 2012 +0100

    uxa: Be paranoid and guard against xf86GetPciInfoForEntity
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abb8d893742f4ba9567330da9706adda4e636e75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:21:27 2012 +0100

    sna: Be paranoid and guard against xf86GetPciInfoForEntity
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 782cd6eafa9917a5bdb181d66b7f4c05392950ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:20:17 2012 +0100

    uxa: check for failure to allocate drmModeCrtc
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a99bf0125f8f166ff2d65449ecd376c99c3024b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:15:51 2012 +0100

    uxa/i965: Drop superfluous 'state' variable
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15a00ba047fdb7d388a322f2e33894d20787af2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:09:52 2012 +0100

    sna/gen2: Remove double 'const'
    
    So constant, we const'ed it twice.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99129c369c16d9ff7588a0e59f9285cc339b7eb3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:08:11 2012 +0100

    sna/gen4+: Use an explicit invalid value for alu
    
    Since the static analyser also doesn't like comparing a uint8_t against
    ~0.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fae9c054d47203b68a6c09647945d23074ea4df9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:04:30 2012 +0100

    legacy/i810: Remove unused variable
    
    In order to reduce the volumes of output from static analysers.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 880ec2c9a56d3de33c7fbbfa4c043082fbcf7a78
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 12:04:30 2012 +0100

    legacy/i810: Reorder DRI teardown code to avoid potential NULL derefs
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7424ea7dd08e304baa4efa09e887b833737ac9f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:59:24 2012 +0100

    uxa/dri: Free wait_info along DRI2WaitMSC error paths
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebd6dea009479e612c67d78416b8680bb23dba94
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:56:11 2012 +0100

    uxa/dri: Make sure is_glamor_pixmap is always initialised
    
    The code paths are too twisty to be sure otherwise.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33f0b4b96662d953052232b1c0477ced0c326a62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:54:28 2012 +0100

    legacy/i810: Free offscreen image info struct on failure
    
    Impossible with the current code, the server aborts on failure. However,
    this looks to be the simple answer to keep static analysers quiet.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d24340747389db971c04349d1ee517f195c2b28e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:53:26 2012 +0100

    sna: Free clip boxes (if allocated) along error path
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1215abc5c30cc3e183bde59b1523c09b59c484e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:49:15 2012 +0100

    sna: Make the ignored return value explicit
    
    The return from __kgem_throttle_retire() is just a hint as to whether
    any forward progress was made. In the case of the error path, though it
    is a last ditch effort before aborting, so we do not really care whether
    or not it succeeds, we must try again.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e230b460515a043a1b7353d153e864754ca5e064
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:48:23 2012 +0100

    ux/i965: create_sampler_state_bo() expects enums, so feed it the right types
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 072d7a8b42f04600c9d8054f3648642a1aaff57a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:40:01 2012 +0100

    sna/debug: Assert the non-existence of the relocation handle at source
    
    This should help the static analyzer pinpoint the blame and make it
    quieter.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a3c355e056339aed68b70470556633dea899b1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 4 11:32:42 2012 +0100

    sna: Silence a compiler warning for loss of 'const' qualifier
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 791029cc16bca36b8dec82297ff7e07a972c51ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 13:28:43 2012 +0100

    sna/trapezoids: Implement trapezoidal opaque fills inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f78a934a423911e18d340f0585e31941f6e8663
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 13:27:52 2012 +0100

    sna: Clear the counters prior to querying the property
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1953f1d4abc6e158a5e3ca53d3207548842254c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 12:02:55 2012 +0100

    sna: Prefer to use memset() for extremely large clears
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce85cd1a36e31795a966ea8983c2d6f803a4eccd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 11:46:06 2012 +0100

    sna: Add some DBG to retreiving EDID
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8eb273bd6153c232a9ffc558e3b7fd4beaab01b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 10:43:03 2012 +0100

    sna/gen7: Add DBG for ring switching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 722afa6bc910a2ccfbb0442872a878d1b6b78315
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 10:04:02 2012 +0100

    sna: Remove some unused members from the KMS state tracking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26e7bb3f25f0c83d39ff505fa7e05bfcb976e39c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 09:16:51 2012 +0100

    sna: Add a DBG message to indicate flushing for GPU idle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58fc03b8c36688e9fa7925aa82b83d36c9decb7e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 08:53:24 2012 +0100

    sna: Prevent NULL deref with early termination and DBG enabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1be2afb81df887ed664ac31d0641da808cfb8888
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 08:04:02 2012 +0100

    legacy/i810/video: Release memory after creating adaptors
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 261d086265fff6c9b28a67d2fcceed8f107d5cb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    legacy/i810/dri: Propagate failure from allocating texture memory
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ea12b56d42686f75deb33fc126d09acee7e2899
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    legacy/i810: Fix memset(sizeof(*ptr)) rather than memset(sizeof(ptr))
    
    Clear the entire structure and not the first 4 bytes...
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3e15d1460faad192781d74fdc2b5092e9c148ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 08:14:23 2012 +0100

    uxa/i965: Make the unhandled allocation failures explicit
    
    Add assertions to the point of allocation and write failures.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46fbb3d31bf73df4bd0259a146e9929f62a9c488
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    uxa: NameForAtom may return NULL
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8451d5dd3c992bcfad9f71aa890b6b225884b978
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    uxa: Use unsigned bitfields for single bits
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d66ca06865973833398560a04186e0067d9cb206
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    uxa: Intialize is_glamor_pixmap
    
    It is not clear whether is_glamor_pixmap is always initialized prior to
    use, so set it to a safe^W likely value.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25a17b2ca5e3945150151c4308761891c0e20bab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    uxa: Remove 'render_source_is_solid' dead code
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ba0eb230836fa5f94a2f50da5880fdd3b9dfd72e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    uxa: Fix reallocation of XVAdaptors array
    
    Prevent the leak and remove some unsightly code in the process.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit affb1f82c1401bac3f54654a342e3b16b8bd374b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 08:27:59 2012 +0100

    sna/gradient: Reuse old gradient bo if allocation of new fails
    
    Prefer a stall to a crash.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e51f984a4c15de42c5bee3aeacee553e2dd4eca0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 2 08:23:35 2012 +0100

    sna: Check gradient allocations during init
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c5647a18e7856b604bce70270463fc128c2cfcd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    sna: NameForAtom may return NULL
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7867bff00caeff9e1fbe569ca3d37b94f704a4cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    sna: Replace invalid signed value with unsigned ~0 for uint8_t
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca72b372237287af0f4475801a9b64efca975832
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 23:22:31 2012 +0100

    sna: Drop return value from 3D point transform
    
    And just fixup the computed coordinates in the face of an invalid
    matrix.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b83e2a79f2a082630e0d3147abec8d3599f3f4b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:17:49 2012 +0100

    uxa: Static analysis warning fixes
    
    A smattering of bugs and confusing code.
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67e8ac365c4b7dd9c4eb2abe46aecc8cc04d4278
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:20:51 2012 +0100

    sna/gen3+: Guard against a kgem_bo_destroy(NULL)
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e91b27ae14a5366175a4fe9c87ee15a0a25b5a42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:12:36 2012 +0100

    sna: Fix potential deference of NULL cpu_bo inside assertion
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 048161e69612324d6c077ec487a2a64aaaa7c1f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:09:21 2012 +0100

    sna/trapezoids: Check for malloc failure
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2896aa7b46931d3b95567121ccb07844725ab45c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:08:01 2012 +0100

    sna/io: Free the heap clip boxes on error paths
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ef00ff720226c211444806d9fdf67ce2046685b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 17:05:55 2012 +0100

    sna/dri: Fix typo, check for NULL after allocations to spot failure!
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc0fe44bebfdee63bcda4d185b85fe9e1cb16a71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 16:54:41 2012 +0100

    sna: Fix a smattering of static analysis warnings
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8eed569fb386a9af48a8beb28666d72c6678e48c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 13:02:50 2012 +0100

    sna/trapezoids: Correct extents declaration for fallback
    
    Reported-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91419576eef562378cccf90968c4f0277139b03d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 12:09:19 2012 +0100

    sna: Tiny DBG message tweak
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4bdecc5b07a184ba136129e75a7fef914ac3b8d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 11:06:04 2012 +0100

    test: Add a very basic test to exercise BLT text drawing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea0f326d80f21f89c3cff3595a6e1afc42b52efd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 09:04:23 2012 +0100

    sna: Debug XDrawRectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a7efa991a705bdb5a3b9d5300d824a1ce8759af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 1 08:47:20 2012 +0100

    test: Exercise basic rectangle drawing code
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc4323558bebd53e474fbc5404e1c41ab16d02e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 21:19:26 2012 +0100

    sna: Handle negative values when computing the stipple modulus
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aca994e03e6e0e16f55841418b0061b175e91e5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 21:17:24 2012 +0100

    sna: Fill early break for clip process of spans
    
    When on the same Y-band as the span, as soon as the clip boxes are too
    far to the right, we can stop searching for more intersections.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fe150f898120ba9a00e1e6b9d66bec10d7e8a29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 20:02:47 2012 +0100

    sna: Fix computation of box for clipped stippled rectangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a65c3b7b45df46ba993af6755b2460aa80fde930
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 19:15:05 2012 +0100

    sna: Add some more DBG for stippled blts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2cc64253217a90cf2ade9a8d6f1ed21b23fe875
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 19:45:56 2012 +0100

    sna: And combine the two migrate to CPU clauses
    
    Just a small tidy up to remove a duplicated predicate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd1dd4cf663ca230724dc6beb329b7eb270ea9d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 17:57:56 2012 +0100

    sna: If the CPU damage already contains the migration region, we are done
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2d92ade3911e62f950c85b5650fb13da1279ced
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 17:49:01 2012 +0100

    sna: Prevent readback of 1x1 if it lies inside CPU damage
    
    If the pixel exists only in the CPU damage, attempting to read it back
    from the GPU only results in garbage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a34a06c4ba36b21e386b1f6371a4bd3f03ff35a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 20:14:38 2012 +0100

    sna/glyphs: Clip the damage to the drawable for unclipped glyphs-to-dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcc7ba8ccf95db1c265bd5492f041f94ce368b7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 17:48:40 2012 +0100

    sna/composite: Add debugging modes to disable acceleration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 984400b95a879c7c020de14545ac2e1d9e759e05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 16:56:21 2012 +0100

    sna/glyphs: Don't apply drawable offsets twice
    
    The offsets from image_from_pict() already include the drawable offset
    so we need not apply them twice.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bbd445c8cbeb7bcea2c56c4deb9bf6ccf6f2497
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 16:45:03 2012 +0100

    sna/trapezoids: Apply the drawable offset for the CPU migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5313620a2f66bc8daf211fc77a9c480a79ea271
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 15:06:16 2012 +0100

    sna: Suppress flushes once we have cleared the kernel dirtiness
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0347c8abec9740d706d87dd2f719ac68f3d1c32e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 13:50:31 2012 +0100

    sna/glyphs: Fix upconverting of glyphs via gpu
    
    When using the mask instead of the src for adding the glyphs we need to
    pass the glyph coordinates through the mask coordinates rather than the
    source.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90ae4f853222ee33206134f4efdc4accfb2f2c38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 14:17:40 2012 +0100

    sna: Avoid mixing signed/unsigned int/int16 arithmetric
    
    Life becomes unpleasant with sign extension.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 660c89e9742bac5ce7cbd480e08b4667e37dee8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 13:18:21 2012 +0100

    sna: Use full 16-bit unsigned values for absolute differences
    
    Beware the overflow implicit in:
      adx = x2 >= x1 ? x2 - x1 : x1 - x2;
    when both x2 and x1 may be large signed 16-bit values
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50532
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 035c2953751f58225bd6b1fcb4c1275ccb5526cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 31 09:29:40 2012 +0100

    sna/glyphs: use add(WHITE, glyph, mask) for channel expansion
    
    If the glyph format does not match the mask format we can not simply add
    the two together, but must first perform a channel expansion (or
    contraction) by multiplying the glyph against a WHITE source.
    
    Normally the glyph and the mask are equivalent formats and so we hit the
    fast path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf5b3e2ebf4ee0330f5421b9377bb512a94ec284
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 14:44:59 2012 +0100

    sna: Don't attempt to flush scanout if unattached
    
    This was lost in the midst of the OSTimer overhaul.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50393
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a64ba0895035f6567e9a15357396b06c0f2d6dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 13:51:07 2012 +0100

    sna: Convert remaining drmCommands to drmIoctl
    
    This helps to silence valgrind
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47e2db0ba8ae3fbcdf58cba26c58ec0932b4c90b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 10:37:22 2012 +0100

    sna: Replace FREELIKE_BLOCK with MAKE_MEM_NOACCESS
    
    And similarly for MALLOCLIKE_BLOCK. The issue being that valgrind may
    overwrite such blocks with alloc-fill and free-fill values, but when in
    fact they are defined and still in use by the GPU. This can lead to the
    GPU processing garbage, and GPU hangs.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50393
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08a630dc5ef87e551865e558fe4fc45ea66457b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 08:50:44 2012 +0100

    sna: Ensure we flush scanout even when otherwise idle.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50477
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10ca765ad346931087be146f3e6d1f4069c95f26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 08:32:34 2012 +0100

    Mark a few more options as being UXA specific
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 740368c4c6eb547adad247ff529d16e594d6459b
Author: Nick Bowler <nbowler@draconx.ca>
Date:   Mon May 28 18:28:28 2012 -0400

    Include config.h in intel_options.c
    
    Commit 8a9a585341e2 ("Only create a single instance of the intel_options
    array") moved the definition of intel_options into a separate .c file.
    Several of the defined options are #ifdef'd based on the configuration,
    but since config.h is never included, the macros being tested are never
    defined.  Therefore, none of the configuration-specific options will
    ever be available at runtime, even if they should be.
    
    Add an inclusion of config.h so that such configuration-specific options
    work again.
    
    Signed-off-by: Nick Bowler <nbowler@draconx.ca>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1b720c40cf511b4ed6d387891d715522d0d54b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 30 07:47:53 2012 +0100

    sna/sprite: Restore another xf86drm.h
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e986b06162abf286b3f8f97b791fd66dcf8f9aec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 22:21:05 2012 +0100

    sna/overlay: Handle return from GETPARAM query correctly
    
    drmIoctl() returns 0 on success, not a positive value.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68874e2d694cc68f5f051ba5fe4a79a71fdb2dbc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 21:28:39 2012 +0100

    sna: Fix chunking for large stipples
    
    Reported-and-tested-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49510
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12af82581118470f59817f626d61df655950e243
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 21:45:32 2012 +0100

    sna/overlay: Replace drmCommand with direct invocations of drmIoctl
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a1b6e57fbbbb4c8e5ac9588537840f4ec176ae6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 21:37:16 2012 +0100

    sna/overlay: Restore one xf86drm.h include
    
    This was removed in haste, when it is required for drmIoctl and friends.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 264d1b1e1fb368f7845a8112bfa2ad2224acabd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 13:03:56 2012 +0100

    sna: Also check for a free exec slot for the upload buffers
    
    As we check before allocating the upload buffer, we can not be certain
    that we will allocate an already attached bo or that we have a free exec
    slot. So always check that we have an extra exec slot available - the
    false positive rate is going to be negligible.
    
    Reported-by: Zdenek Kabelac <zdenek.kabelac@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50457
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7bcca9a3fb6c669d8b093e6399914693770b0b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 12:49:12 2012 +0100

    sna: Make finding DPMS property valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c074797094dc7675bb6ae549630fdf061ab5258
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 12:45:20 2012 +0100

    sna: Make GetEDID valgrind clean.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 560e50c0a5afa0824086557581ca6aa5696b44a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 12:36:31 2012 +0100

    sna: Make GetEncoder() valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4b6fa795201379694a03d537064dbca446cfdfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 29 11:32:28 2012 +0100

    sna: Trim the set of includes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d1a9e666763a3e1270c8f000b1b37a6b926441f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 20:06:35 2012 +0100

    sna: Bump experimental ioctl number for vmap
    
    Gazumped!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55e6f5f220401318529e81f7c96fe0af3b893a0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 16:21:09 2012 +0100

    sna: Use the local function for turning the cursor off prior to release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77dd429222922aa1ba7f283553e11e60e4d5c496
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:40:23 2012 +0100

    sna/dri: Make WAIT_VBLANK valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ebe84818ab70e662a9bb3f232b4664ff40ac375
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:27:46 2012 +0100

    sna: Make sna_copy_fbcon() valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f37dae734ebac5c0ed2d6f50fc92bc107f4e4a33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:20:54 2012 +0100

    sna: Just use the CRTC id from the array
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1f24a0eae4bb0081ff7469a2aee63a1f32140f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:16:03 2012 +0100

    sna: Make sna_crtc_apply() valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ebfcdbb80245f98c0c7ef9f090a2be6900fb457
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:10:04 2012 +0100

    sna: Make AddFB valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32ca3c7b65516b0bd48b0d0979b086ee1580167a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:02:11 2012 +0100

    sna: Make sna_crtc_is_bound() valgrind clean
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7973f6751c9bf565dee4c89aa3e1badbcc45018f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 14:00:55 2012 +0100

    sna: Add a little bit more verbosity to cursor routines for valgrind
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19c463e52df919fc75de7e420fd3565f0e9a0576
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 12:54:35 2012 +0100

    sna: Only wait if there is a suitable active buffer
    
    There is not point repeating the search after retiring if we know that
    there is no outstanding suitable active buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b99c7cd340f782d3057d4257865c5feb96b71f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 10:55:49 2012 +0100

    uxa/dri: Enable vblank scheduling even with pageflipping disabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 810357ad65d551ec5d35dbf228f1b62fe235801f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 10:12:38 2012 +0100

    uxa/dri: Fix ordering of setting vs using swap members
    
    Trivial readibility fix, as the actual ordering is serialised through
    there being only a single thread.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b56a188ef2c48f82572eca2201a3a0ecf6b4f45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 10:01:09 2012 +0100

    Mark another couple of options as being UXA only.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b025f1a604dbbbd456a23f330ceed5f97ecdffcf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 09:48:49 2012 +0100

    sna/dri: Tweak vblank_mode=n swapbuffers to account for throttle delay
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45148a714f1461fff898aeb393ad225f081b9bd5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 09:39:51 2012 +0100

    sna/dri: Enable handling for Option "SwapBuffersWait"
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c709f2447dfc6dc36c50ff741d5d9bbdc7c03b58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 08:17:21 2012 +0100

    sna/dri: Requeue vblank throttling until the vsync'ed copy completes
    
    If the GPU is busy, then we may not actually schedule our copy for
    several vblanks, resulting in us falsely reporting that the work
    completed too early and allowing the client to continue scheduling more
    work and racing ahead of the queued copies.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e73fa02ed361a9c0c08f61d00421671bf10ce9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 28 08:16:43 2012 +0100

    sna: Add some debugging to show count of outstanding requests during retire
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62b557065edc0555f2bf83b0eed9169329a2f2ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 27 16:52:51 2012 +0100

    sna: Use magic upload buffers for video textures
    
    So that we may benefit from the caching of buffers and the automatic
    selection  of the preferred upload method.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35291d2db813f75fedcdca9920a40592acd3cca3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 27 16:54:29 2012 +0100

    sna: Search the inactive bo cache for a mappable upload buffer
    
    See if we have a bo that we can cheaply map to an inplace upload, rather
    than rely on an existing GTT map.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36d53ff52b055b2b5fc03aff7b2cab83037d9f42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 27 16:46:42 2012 +0100

    sna: Validate all CRTCs after updating one
    
    Updating one CRTC may cause the kernel to turn off another, so be
    paranoid and run the check in a loop after applying the CRTC set.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7fdd8bd6d2ba7bf113d4109e6bb6f750f909565f
Author: Johannes Obermayr <johannesobermayr@gmx.de>
Date:   Sat May 26 23:52:28 2012 +0200

    glamor: Fix misspelled xf86GetOptValString and OPTION_ACCEL_METHOD introduced by commit e456291.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ea4ba081de0206351394481f54dcbe6922a085b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 26 21:48:16 2012 +0100

    sna: Fix typo for debug compilation
    
    s/ctrc/crtc/
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 317bf05196086eb5dedb6436c07f253f01c9bf63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 25 14:34:16 2012 +0100

    sna: Perform the selftest after probing
    
    We do no want to slow down the detection phase by performing our
    self-tests, so only running those before initialising the driver.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5fe863e3f1a6750edaffb518c4e768e9bc11521
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 25 14:28:56 2012 +0100

    sna: Check the bus type before declaring probe success
    
    This should never fail, but still better to fail during detection rather
    than pretend it works.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4094826aee76ef24dad13bc5a8a723bfe4a69162
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 25 08:55:13 2012 +0100

    sna: Trust the crtc-is-bound determination after modeset and hotplug
    
    As these should be the only time that they change and we now have the
    checks in place, we can drop the workaround of doing the check just
    before emitting the wait.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a9a585341e2dd43c649204fcf6d92a867671ba3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 25 08:50:33 2012 +0100

    Only create a single instance of the intel_options array
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e45629135065d0cc73c285f8df35ab4e1d07c6dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 24 18:22:45 2012 +0100

    Allow runtime switching of AccelMethod between uxa/sna and even glamor
    
    Section "Device"
      Option "AccelMethod" "uxa/glamor/sna"
    EndSection
    
    The appropriate backend must also be enabled at compile time for the
    runtime option to be available (i.e. --enable-uxa (default) --enable-sna
    --enable-glamor)
    
    Demanded-by: Adam Jackson <ajax@redhat.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50290
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df6ab02c3690eea8393ecc8c113e2f2891856cc6
Author: Eugeni Dodonov <eugeni.dodonov@intel.com>
Date:   Mon Oct 31 14:43:22 2011 -0200

    Unify options handling between UXA and SNA
    
    Unifies available options for both UXA and SNA drivers, and
    moves them into a common header file, intel_opts.h.
    
    Signed-off-by: Eugeni Dodonov <eugeni.dodonov@intel.com>

commit ae2be7e25bda46551381c19a673b321b4382e1f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 24 16:33:27 2012 +0100

    sna/trapezoids: Correct rounding for downsampling onto sample grid
    
    Reported-by: S. Christian Collins <s_chriscollins@hotmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49446
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ab226e27e7920bdb9f7eb62c5174cd097ac7f7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 24 12:51:46 2012 +0100

    sna: Query CRTC states following a hotplug event
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f3bde4f0c72f6f31aae322bcdc20b95eade6631
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 24 11:58:46 2012 +0100

    uxa: Only consider an output valid if the kernel reports it attached
    
    Reported-by: Kyle Hill <kyle.hill@tacomafia.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50078
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11db66fedf96f158cbbac8011a8ba0b29a20ba3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 24 11:07:19 2012 +0100

    sna: Add some more DBG tracepoints around modesetting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb9da4cb9e12ca733c31879b8b37906f361a8c35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 23 13:53:37 2012 +0100

    sna: Only mark an unattached output as inactive
    
    So that a latter attempt to set the DesiredMode may succeed and we do
    not modify the configuration without notifying clients.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ae032e22b127c7c95753197e0914a8028a3b22e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 23 13:27:07 2012 +0100

    sna: Suppress modesetting errors on return from VT switch
    
    If we presume that userspace will set the correct mode shortly
    afterwards, we can ignore the failure of the automatic restore.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34882a979d9817d33bd6a8ae73a9f7083556578c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 23 10:27:44 2012 +0100

    sna: Keep checking retirement for flushing list
    
    Even after all outstanding requests have been completed we may still
    have buffers on the flushing list that need to become idle.
    Once such consequence would be to prevent the vblank flush from going
    idle, causing spurious wakeups every vrefresh when otherwise idle.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50078
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54fde5bf05d43f26e7f1893584af736a138d245f
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 16 15:34:08 2012 +0100

    intel: convert sna/uxa to using new glyph picture accessors.
    
    The compat-api.h takes care of old/new servers.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 43a34186d13d29c671431832469ca5301751b3cf
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 16 15:26:55 2012 +0100

    intel: convert to new screen conversion APIs
    
    The compat header takes care of the old server vs new server.
    
    this commit was autogenerated from util/modular/x-driver-screen-scrn-conv.sh
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 9aabc04d76fa976abb4a74f4e9676c7556e88df3
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 16 15:14:32 2012 +0100

    intel: add compat header file for conversion fns
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit c9ce6ae8a6fc7b1a91aef1e59640c39024d0426d
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 23 08:33:20 2012 +0100

    legacy/i810: rename pScreen->screen
    
    For consistency before moving to new APIs.
    
    This just changes the files where the API changes will touch.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 70ee0f84f5b9c6c13a0338f8b2757e587c849c14
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed May 23 08:31:52 2012 +0100

    legacy/i810: rename pScrn->scrn
    
    This is need to make the compat api stuff easier to implement.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 3410db008c6c20dc6590a89c05b40a0c6de6744a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 22 15:54:52 2012 +0100

    sna/dri: Avoid confusion of attempting to exchange pixmaps for DPMS-off flips
    
    Not only do we confuse ourselves, but we end up confusing the damage
    tracking on the root window whenever we update the Screen Pixmap. So for
    the time being, don't.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28c4fb0b70e098972af972d30a660d167a8973ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 22 09:49:53 2012 +0100

    sna: Swallow disconnection event upon mode restoration
    
    So that we can VT switch back to X even though the output configuration
    has now changed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b17c44c8d234cb2c651e88c7892bcd5b33139c1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 22 09:43:51 2012 +0100

    sna: Remove incorrect assertion for mode restoration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49b7742999ee11b0c36754ea10bc5609ebe8c609
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 22 09:40:25 2012 +0100

    sna: Force config restoration after VT switch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 952e3dcba3a651d22d44dbb039ad97e111d9bc63
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 21 19:48:52 2012 +0100

    sna: Only override active on DPMSModeOff
    
    Along the enable path we then only want to change the value if we
    actually call sna_crtc_apply.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afdaf184594bfe3633305969eb1166c28e1006bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 21 14:32:39 2012 +0100

    sna: Add a log message for the change of CRTC mode
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9fb18462ec1428a486f998585e7b4caf4dd08f53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 21 14:12:23 2012 +0100

    sna: Confirm that the modeset takes
    
    If we attempt to change to a mode with a disabled connector the kernel
    will silently switch off that connector (and crtc) and report that the
    modeswitch is successful.
    
    Reported-by: Kyle Hill <kyle.hill@tacomafia.net>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=50078
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd3b48854403ee63723ef570c1a7f9f8447e7105
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 19 12:56:45 2012 +0100

    sna/gen7: Trim a dead assignment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf79cd3e27b7077f67f202b16ed39eb1cc70ac65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 19 12:44:11 2012 +0100

    sna: Emit a new batch if we need to clip after PolyText without space
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f91dcc44dcc15850f82666b1bcdd27182400e7dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 18 20:09:41 2012 +0100

    sna: Give the proxy a unique name
    
    So that if we cache the current destination bo (for example, gen3) then
    a new proxy (or even just a new batchbuffer) will indeed cause the
    destination buffer to be updated.
    
    Reported-and-tested-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48636
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ee073d613bba38f90951405d5ecddfcf3ac5e043
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 18 15:19:00 2012 +0100

    sna/traps: Fix processing of full-steps
    
    A missing factor of Y-height caused the computation of coverage for the
    spans to be completely wrong. This affects the vertical segments of
    rounded rectangles, for instance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ba800c63906fb29d34f40b9437092a665bffb14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 17 22:46:18 2012 +0100

    sna: Don't consider uploading inplace if the dst bo is unmappable
    
    Handle (and take advantage of) the fallback at the high level rather
    than masquerading an inplace write.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dad24721a13ce3a357e8ddae3c2dea61045f6fc2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 17 21:44:22 2012 +0100

    Revert "sna: Always try to operate inplace if we an LLC gpu bo"
    
    This reverts commit 10b4a9bb5f46ab9d9c8b165084ce4174b54a8d39 as it
    causes a regression for pixel data uploads to active buffers.

commit 681c6e72412fff96b203a09be6ac8d393f3489a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 17 19:43:02 2012 +0100

    sna: Track flushing status of live bo
    
    Currently we only move a bo with an outstanding kernel flush onto the
    flushing list if it is no longer in use. This leaves us potentially
    stalling on a flush if we try then to write to the object believing it
    to be retired and idle.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d99502a33d5bdbad010b7a036c1aee989fe29947
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 17 17:56:43 2012 +0100

    sna/glyphs: Pass the extents to the backend for preparing to composite glyphs
    
    This information should not be required, but it might come in handy, so
    pass it along.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb21c2df1a10d66f115a5978b0db508058fdc412
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 17 16:30:31 2012 +0100

    sna/io: Assert that we do not replace a bo->flush object
    
    These should be pinned by the higher layers and so we should never be
    attempting to replace them. If we do replace a bo->flush, then we will
    end up miscounting outstanding flush bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 596c0a68709a93bb376647c1b566e9df4f23b35d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 15 18:53:39 2012 +0100

    sna: Assign GCops after checking for fallback to pass sanity checks
    
    We assert that prior to installing the fallback GCops the current ops
    are the default set. This is broken if we point GCops to our GPU ops,
    but then fallback. So check for the fallback first.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c9759ef2ad755bbe720d4aa031ec67dbc3b7734
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 14 14:12:06 2012 +0100

    sna/gen3: Fix pre-multiplication of opacity masks
    
    The return type for the multipliation was only 8-bits wide dating back
    to the time when the function just computed a single channel and didn't
    try to blend the output back into the argb pixel value. Inlining the
    shift into the function means that we need the output to be 32-bits wide
    instead.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49887
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 053bd5bf2425aed44e1c2bb981d98ee5171211a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 14 12:08:09 2012 +0100

    sna: Use the correct storage for box_from_seg
    
    Fixes regression from 3aa98289e3a2 with clipped segments. As we clipped
    the empty box rather than the segment, we never drew any outlines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b654b8794db7b00666ce5c59535a9302932c483b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 14 11:36:15 2012 +0100

    sna/trapezoids: Fix picture creation for fallback trapezoids
    
    Being a little lax in not updating the format after upconversion to
    PICT_a8, meant we were trying to composite with a depth 1, 8 bpp a8
    image and thoroughly confusing everybody when creating the upload
    trapezoid mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80567f61afe77a003e663b17c1fc6b6c3ed04042
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 14 10:40:38 2012 +0100

    sna/trapezoids: Do not reduce SRC to a clear pixmap to unbounded
    
    As we instruct the migration code to drop the clear when copying from
    the GPU to the CPU, we then need to emit the zeros during the span
    writing.
    
    Fixes some occassional corruption behind complex clip masks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 067e9375809ea6cfa0c0b5e2159b359535c3b362
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 14 10:00:00 2012 +0100

    sna: Trim unused partial buffer uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit effb0b9ec579624e38f0007cd7096e7da04048ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 13 19:29:44 2012 +0100

    sna: Tweak usage of kgem_bo_can_map vs kgem_bo_mapped
    
    More often than not we only want to consider whether we can map the bo
    and decide whether doing so is the better option. Whether the bo is
    already mapped is not such an issue any more with the throttling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37aa1e1291127ff4d27407fac936af64d0e353a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 13 16:59:30 2012 +0100

    sna: Simplify partial buffer tracking
    
    As we only want to track partial buffers with asynchronous reuse,
    exclude all overs from the active buffers list. Secondly, keep the list
    in most-recently-used order rather than by size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7048a71fb6ff5e7c37e21a794f7b42d9a1da3473
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 13 15:42:28 2012 +0100

    sna: Flush batch if GPU is idle upon wakeup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12e340c4b8efa70f3305f489af30461b7c0e5edd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 13 11:01:35 2012 +0100

    sna: Optimise kgem_clear_dirty() by keeping dirty buffers at the front
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0dfd8223adee87e28b391a019effa7bb3630533
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 13 08:33:23 2012 +0100

    sna: Flush the batch before blocking if the GPU is idle
    
    If we have work pending for the GPU and we believe it is idle, just
    submit the batch in order to improve GPU/CPU concurrency and reduce
    latency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6924fc525d6bc82901cfed769c176b44c0bce024
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 11 14:04:09 2012 +0100

    sna: Fix off-by-one in computation of width for inplace trapezoids
    
    This lead to the dropping of the last pixel for small area trapezoids,
    such as the right hand outline of buttons under ClearLooks.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48320
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a58a543e84ed15c41f4fa7644be3ba7865d31b92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 10 12:59:55 2012 +0100

    sna: handle vmap creation failures gracefully
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9af651fdf93f6ccdbcb147cb16989f84c2d0ebdc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 10 10:57:56 2012 +0100

    sna: Include some DBG for segment drawing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3aa98289e3a2f59633ac5f1a5f64db4ee55609d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 10 10:31:03 2012 +0100

    sna: Correct adjustment of LineCap for rectilinear segments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad69316ab1054c5e4b56c19b8eec87b9f86939e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 10 10:03:49 2012 +0100

    sna: Include a small amount of timer-slack to avoid very short sleeps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29d1d409b259ba0c85947ef5eef903ea527aa118
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 10 09:54:53 2012 +0100

    sna: Avoid doubling the final step of poly lines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a83d90ee61be44a2a36b56ad24bbc6544320448f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 9 20:34:52 2012 +0100

    sna: Avoid randomly changing domains of active bo
    
    After attaching the bo to the scanout, mark it as retired in order to
    update its domains so that the assertion during retirement later is
    correct.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49526
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5200510b8f2a0ccb2e0c45dfebc659f8360780c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 9 17:58:58 2012 +0100

    sna: Respect the error terms when reversing the PolyLine DDA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3d37fb29f8dffb0e370ad95783994aaa7eccfaf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 8 15:47:14 2012 +0100

    sna: Force remapping for IO transfer
    
    Should fix regression from fcccc5528 (sna: Improve handling of inplace
    IO for large transfers) whereby it was aborting the transfer it we need
    to remap the buffer for the upload.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49546
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a9a93e4484e0c616724610f4c8019fcbaa7ad53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 8 15:12:51 2012 +0100

    sna: Only avoid ring switching for indirect uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 613902b60e0f2ca2a916e68306a1a37bc236d00d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 8 14:17:46 2012 +0100

    sna: Fix off-by-one in checking available execbuffer slots
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 663e387b35c314c4c2bee8137d6b70d27fa9f729
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 8 11:45:34 2012 +0100

    sna: Only submit a batch to the scanout if it is not already busy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd7a56b7313233190a4c4a735d4a141e99c9b688
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 8 08:53:41 2012 +0100

    sna: Throttle independently of scanout updates
    
    As we are now throttling to relieve GTT pressure, it is a benefit to
    consistently throttle before blocking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2372176f73b7c945f56b7673eab5eccb86366416
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 12:57:35 2012 +0100

    sna: Throttle execution when searching for inactive buffers
    
    If we have some active buffers that we may reuse and old outstanding
    requests, throttling before retiring should prevent the CPU from running
    away from the GPU and hogging the entire GTT and RAM.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4df228749729dd540b639368400fa20118cdf412
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 10:42:30 2012 +0100

    sna: Rate-limit and shrink bo usage if we hit system resource limits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca4d2296e6e42e837627756790b262cae0fd3b6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 10:23:19 2012 +0100

    sna: Expand batch buffers
    
    As batch buffers are compacted to fit into the smallest bo, the only
    cost is the larger static array allocation (and presumably cache
    misses).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9281b80644ce76ad9e0f3f8f812cbae97c10814a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 23:25:22 2012 +0100

    sna/gen[345]: Clear used vertices when discarding unmappable vbo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6ee376e93517659391905e6c9018b3bb735135d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 10:24:21 2012 +0100

    sna: Use the correct invocation of kgem_bo_destroy() for sanity-checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c89c7e9a04314e40cee5514a182a8364c4f99374
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 11:54:50 2012 +0100

    sna: Update select timeout when installing a timer in the block handler
    
    The block handler is run after the timers are queried for their
    expiration and so if we install a timer in the block hander, we must
    set the timeout ourselves.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ba366ead3a133136554579fe9a604da1fc1da68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 7 08:55:35 2012 +0100

    sna: Manually execute the timer as TimerForce does not run an inactive timer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c801c45dbad58d18f2673e17723825dda0c4e55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 6 17:23:11 2012 +0100

    sna: Replace timerfd with OsTimer
    
    As timerfd is linux-specific, and OsTimer an OS-agnostic abraction,
    replace the former with the later. Arguably this has slightly better
    performance characteristics in select-bound loops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74d2707de4a0f94d2143f1e9c60762e4167b1ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 6 21:51:27 2012 +0100

    sna: Remove short-circuiting for large font fallbacks
    
    Unlike the fallback for an unhandled depth, we need to ensure that the
    pixmaps are mapped to the CPU before calling the fb routines.
    
    Reported-by: Toralf Förster <toralf.foerster@gmx.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49558
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5b6741d3729c6867702ab64a6c59cb8052c0ef3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 6 12:40:54 2012 +0100

    sna/gen2+: Fix typo for computing redirected extents for render copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 771090f25db702d25ebbd3f2b44429cf0acfe8fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 4 20:56:37 2012 +0100

    sna: Add a pair of asserts to track down a NULL pointer dereference
    
    Looks like the assumption for the location of the data is invalid,
    allocation failure, perhaps?
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d376a960df7a081a5d449f77b81ae13223b98929
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 4 10:09:46 2012 +0100

    sna/dri: Only track a single pending flip across all pipes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 450592f989efd0d3bc9ef2de245fce0a180e91a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 4 09:50:19 2012 +0100

    sna: Cache the framebuffer id
    
    Also fixup a weakness of only tracking scanout with a single bit, as we
    used to clear it forcibly after every flip.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29d035279b2fe98d5ba9cf01125faea34d36fb76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 4 09:11:31 2012 +0100

    sna/dri: pageflip unref debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 079b491ced2c9c3c73d938ef6025d040016ad3a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 23:52:17 2012 +0100

    sna: Ensure drawables are clipped against the pixmap before migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a5f8599b150064339d62a97c58026e62b49ff27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 23:21:48 2012 +0100

    sna: Compile fix for fresh assertion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61cac5c265279d45677262216a0ba56f548cd898
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 22:33:59 2012 +0100

    sna: Maintain a reference to the chain of proxies
    
    Rather than attempt to flatten the chain to the last link, we may need
    to hold a reference to the intermediate links in case of batch buffer
    submission.
    
    Fixes http://tnsp.org/~ccr/intel-gfx/test.html
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=49436
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dea5d429f7a52dfc945b17a57ef79744cc796b0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 17:35:24 2012 +0100

    sna: Remove extraneous SCANOUT flags
    
    These are now fixed by obeying a minimum alignment restriction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19fd24a4db994bb5c5ce4a73f06d9394a758ea91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 17:35:10 2012 +0100

    sna: Fix offset for combining damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1376c81dbf3b789e04e6804df1b1fd32bcb2bd1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 17:34:28 2012 +0100

    sna: Debug option to force particular upload/download paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0d464d6b18855616fc43d9a25aa6853f86c8e2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 16:17:35 2012 +0100

    sna/dri: Balance flush counting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d47e98dd64c0b9fe2979db42622c5ee8168e8b35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 14:54:17 2012 +0100

    sna: Minor glyph fallback fixes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1f08b8850616952fb0babe2275eb36b13a380ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 14:53:29 2012 +0100

    sna: Don't discard GPU buffer if we only want to read back for the operation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcccc5528b8696fb4f9b3f9f528673b95d98a907
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 3 11:27:44 2012 +0100

    sna: Improve handling of inplace IO for large transfers
    
    If the transfer is large enough to obliterate the caches, then it is
    preferrable to do it inplace rather than upload a proxy texture and
    queue a blit. This helps prevent an inconsistency where one layer
    believes the operation should be done inplace only for the IO layer to
    perform an indirect upload.
    
    Testing show no significant impact upon the cairo-traces, but it does
    prevent x11perf -shmput from exploding.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53568e8e49559094ce5b24b8709669f1f76fe2bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 30 09:24:06 2012 +0100

    sna/gen7: Fix debug printing of primitives
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 01c26a44fdce761781908be11102e7a6a3db523c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 2 21:09:27 2012 +0100

    sna: Avoid reducing damage for synchronisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4c34e9ab32f31669896b8f626195827a85af337
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 2 19:09:10 2012 +0100

    sna: Bring back the minimum alignment for G33
    
    The underlying cause is still not fixed. It should be possible to use
    the much laxer alignment for single-stream linear. Still no idea how I
    fail to convince the GPU to drop the depth buffer.
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=49391
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10b4a9bb5f46ab9d9c8b165084ce4174b54a8d39
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 2 12:45:09 2012 +0100

    sna: Always try to operate inplace if we an LLC gpu bo

commit dd80fb00bf7acf37dc3b9125431a12b67d7e92d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 2 11:31:42 2012 +0100

    sna: Fallback for glyphs too large for XY_TEXT_IMMEDIATE
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e09babb3e9e23882db30ee7d0c22c503962faa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 1 12:37:45 2012 +0100

    sna: Only attempt to reuse exported scanout buffers
    
    Yet more mesa w/a.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4b32e7a0172a74372f800e9c74d639a23c5ff34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 1 11:15:00 2012 +0100

    sna: Fast-path unclipped glyphs
    
    Avoid the redundant computation of the glyph intersection with the
    drawable bounding box.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ffdf9aca12adcfa1ec7ab7a1706873105a5f0d4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 29 21:59:52 2012 +0100

    legacy/i810: hwmc additionally depends upon building DRI
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 444da84c47266bcbbdf5121507901de8eb36f11b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 29 21:49:04 2012 +0100

    configure: Version bump for 2.19.0 release

commit a206a1eee1fb799d567d68db564d663cfc66f6cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 28 01:54:43 2012 +0100

    sna: Tune relocation array size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f1908c651ef9e2af33d8831466a605234978c46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 27 23:19:56 2012 +0100

    sna: PolyPoint only uses the gc->fgPixel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8453034c7dd893f1d4c32ee87724f3a13137595d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 27 22:08:51 2012 +0100

    sna/gen6: Allow ring switching at the start of a batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93ad7793894787600c5074917c753fa7c6816134
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 27 22:03:55 2012 +0100

    sna: Tweak semaphores-enabled heuristic
    
    The kernel module now defaults to -1, confusing the test.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 986dbdda3bf8dcf208e55543d8a3393c4b53f10b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 27 19:21:44 2012 +0100

    sna: Tweak placement choice for high-overhead operations
    
    Some operations cost more to setup than to transfer data back and forth!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit daac9a1d036d80ccce83438b49115a236a16bfb6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 27 16:50:28 2012 +0100

    sna: Micro-optimise common case of checking a single fenced bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5967d76ca09a257ec9db66ea664158e1dfd083ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 25 17:15:37 2012 +0100

    sna: Fixup broken assertion
    
    It is valid for the cpu_bo to be NULL, as we may be choosing to free the
    large shadow pixel buffer instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 860d3859b586939cd52e45b944cb6abd2a2ca71b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 25 16:04:33 2012 +0100

    sna/gen7: Add CS stall before changing WM binding table
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c219283460c0f2dfdb823e0cb139d05075c6afce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 25 15:04:01 2012 +0100

    sna/gen7: Apply more recent improvements from SNB perf tuning
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3371613c9bf577a69cdf811ca1bebaea46bbe95
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 25 11:09:35 2012 +0100

    sna: Do not automagically convert GTT mappings on untiled scanout to CPU
    
    The likelihood of an untiled mapping of the scanout is slim, except for
    gen3 with large desktops, and there it should never be in the CPU
    domain...
    
    The issue is that we may perform an operation "inplace", yet incoherent
    with the display engine, and never flush the CPU cache, resulting in
    render corruption. In theory at least!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1abd92cd012ee46d44ed4873a5e750d56ae6668f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 25 11:16:30 2012 +0100

    sna: Clear the domain tracking after attaching the bo to scanout
    
    This is basically to make sure we don't continue treating it as CPU
    coherent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c58c840b1ba579a5601804fc710c58e1e00213f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 23 11:09:37 2012 +0100

    sna/dri: Always clear the scanout when destroying dri2 buffers
    
    As we may end up holding onto and releasing the Screen pixmap last, we
    may also be responsible for flushing the last reference to the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caf9144271a10f90ea580c246b2df3f69a10b7a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 20 17:15:37 2012 +0100

    sna: Remove the assertions that the cached upload buffers are active
    
    These were added to track down some corruption, but the assertions
    themselves are incorrect, just very rare. The upload buffer may
    genuinely be cached if we abort the render operation after uploading the
    source data, leaving the proxy not coupled to any request.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48400
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aff3614efd5c12e658fa5723934e5bd50a83a316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 20 13:21:40 2012 +0100

    sna: Always clear the mmapped domains when reusing  partial upload buffers
    
    As we need to make sure that we do invalidate the caches appropriately
    on reuse. Mildly paranoid, but strictly required by the spec.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb6a3dc2edf3cd612f833bc9a4656166735ee856
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 19 10:34:23 2012 +0100

    sna: Discard proxy upload buffer if we choose to render to it
    
    Even if we try to avoid treating an upload buffer as a real GPU target,
    we may still choose to migrate the buffer to the GPU in order to keep
    other buffers on the GPU. In that case, we do want to create a real GPU
    bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4cf74d409ca63c6a479c1ee2187908c04f3b830b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 19 09:09:32 2012 +0100

    sna: Don't consider upload proxies as being on the GPU for render targets
    
    The upload proxy is a fake buffer that we do not want to render to as
    then the damage tracking become extremely confused and the buffer it
    self is not optimised for persistent rendering. We assert that we do not
    use it as a render target, and this patch adds the check so that we
    avoid treating the proxy as a valid target when choosing the render
    path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd81408b978c9b57c046ee43d2d32e1370e83a7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 18 11:39:43 2012 +0100

    sna: Increase the render target alignment to 4 pixels on gen4+ as well
    
    Repoerted-and-tested-by: Toralf Förster <toralf.foerster@gmx.de
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48865
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11599e52b842b5db76798879b0fbb57762fe6002
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 17 20:08:14 2012 +0100

    sna/dri: Decouple the frame event info after attaching along error paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b817200371bfe16f44b879a793cf4a75ad17bc5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 17 17:54:58 2012 +0100

    Don't issue a scanline wait while VT switched
    
    Be paranoid and check that we own the VT before emitting a scanline
    wait. If we attempt to wait on a fb/pipe that we do not own, we may
    issue an illegal command and cause a lockup.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af4a6e8cb52ace594934446e6d8a7aaa1945a9b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 16 20:57:03 2012 +0100

    sna: Don't assert exported buffers are not busy
    
    As we do not fully control these buffers, we cannot truly say when they
    are idle, we can only trust that the split between us and the compositor
    doesn't lead to much corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a16616209bb2dcb7aaa859b38e154f0a10faa82b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 14 19:03:25 2012 +0100

    uxa: Fix leak of glyph mask for unhandled glyph composition
    
    ==1401== 7,344 bytes in 34 blocks are possibly lost in loss record 570 of 587
    ==1401==    at 0x4027034: calloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==1401==    by 0x8BE5150: drm_intel_gem_bo_alloc_internal (intel_bufmgr_gem.c:689)
    ==1401==    by 0x899FC04: intel_uxa_create_pixmap (intel_uxa.c:1077)
    ==1401==    by 0x89C2C41: uxa_glyphs (uxa-glyphs.c:254)
    ==1401==    by 0x21F05E: damageGlyphs (damage.c:647)
    ==1401==    by 0x218E06: ProcRenderCompositeGlyphs (render.c:1434)
    ==1401==    by 0x15AA40: Dispatch (dispatch.c:439)
    ==1401==    by 0x1499E9: main (main.c:287)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae145c21e9fd3a12164f8b4720d059f9c158249e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 14 18:42:23 2012 +0100

    sna: Avoid leaking the plane resources when determining sprite planes
    
    Fixes the tiny, one-off leak:
    
    ==1407== 8 bytes in 1 blocks are definitely lost in loss record 48 of 527
    ==1407==    at 0x402894D: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==1407==    by 0x8580BE8: drmMalloc (xf86drm.c:147)
    ==1407==    by 0x8583D54: drmAllocCpy (xf86drmMode.c:73)
    ==1407==    by 0x8585265: drmModeGetPlaneResources (xf86drmMode.c:955)
    ==1407==    by 0x8A1BCE9: sna_video_sprite_setup (sna_video_sprite.c:367)
    ==1407==    by 0x8A1A0A3: sna_video_init (sna_video.c:523)
    ==1407==    by 0x89FD4E0: sna_screen_init (sna_driver.c:935)
    ==1407==    by 0x15AD80: AddScreen (dispatch.c:3909)
    ==1407==    by 0x19A2DB: InitOutput (xf86Init.c:817)
    ==1407==    by 0x14981C: main (main.c:204)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69a7737abeded6ee923643bd8a80a5a84e6a979c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 14 12:06:51 2012 +0100

    sna: Align texture subsurfaces to 2x2 texture samples
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d2a46e0902d82b43a5e12af36521a6a7fd6ba39
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 14 12:04:23 2012 +0100

    sna: Align redirect subsurfaces to 2x2 or 4x4 render spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ce2b65d622797000e0a4db7dc851d5b1da04f85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 14 11:59:31 2012 +0100

    sna: Align render target sizes on gen2/3 to 4x4 render spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89f2b09b1e5be9842747998ea4fe32a6f1ede4cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 16:37:43 2012 +0100

    sna: Avoid using TILING_Y for large objects on gen2/3
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48636
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eaadbce122059066353743f1653aa16e9d9b747f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 15:12:36 2012 +0100

    sna: Relax bogus assertion
    
    The bo may be considered unmappable due to being bound to outside the
    mappable region, which we are attempting to rectify through mapping into
    the GTT domain.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b478420740d05fa87ddbd92042b1f7f2d002f73e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 15:07:13 2012 +0100

    sna: Limit the buffer reuse for mappable uploads to only those with mmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90e2740e7e459c56205fa65bab1ae3dbfd5d3945
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 13:51:57 2012 +0100

    sna: Remove the conflicting assertion during GTT map
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48636
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e6d55a8d63f10ca6a2b10e44d00c84b07724485
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 09:56:39 2012 +0100

    sna: Don't use miSpan code for wide-spans by default, too expensive
    
    Only use the fall-forward miSpans code when it prevents a readback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9becfbbf89f2b170e50f705cabfc7bbf1dcf9846
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 13 09:38:57 2012 +0100

    sna: Draw dashed PolyLines twice, once for the fgPixel, once for the bgPixel
    
    As the fast paths only setup state upfront, we were missing the state
    changes required between dash-on/off. Take advantage of that each pixel
    is only drawn once to batch the state changes and run the
    miZeroDashLines twice.
    
    A future task would be to use a custom line drawing routine...
    
    Fixes regression from ec1267df746512c2e262ef0bd9e9527bc5efe6f4.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e269ed5d4e1b9d758aeb9a85ed0fa631f0aff0b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 12 22:46:22 2012 +0100

    sna: Restore CPU domain for vmapped buffers when reusing
    
    For a vmapped upload buffer, we need to notify the kernel (and thereby
    the GPU) to invalidate the sampler and flush its caches when we reuse an
    idle buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d29b8650c40c673e6ddddaf52db9247e9836cba8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 12 22:23:12 2012 +0100

    sna: Revert use of mmap64()
    
    As this just causes mayhem on a 64-bit platform. Doomed if you, doomed
    if you don't. :(
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a78b1d71a39ae29d5f85bd82c09202ebec3e6539
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 12 15:37:25 2012 +0100

    sna: Declare AC_SYS_LARGEFILE for mmap64
    
    In order to use the full 32-bits of mmap address space on small
    platforms we need to use mmap64().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09deba927daa96be6230b1c3e1b425622512d8a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 20:59:36 2012 +0100

    sna: Check ioctl return from set-domain
    
    Let's not assume it succeeds and so avoid altering our bookkeeping along
    failure paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b12f1d8e4d0a4fafac9553f144535efc4ebe0be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 15:23:54 2012 +0100

    sna: Fix shadowed variable
    
    sna_accel.c: In function 'sna_pixmap_move_area_to_gpu':
    sna_accel.c:1751:12: warning: declaration of 'flags' shadows a parameter
    [-Wshadow]
    sna_accel.c:1731:72: warning: shadowed declaration is here [-Wshadow]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 755a7107aed268d87c5cc0feb1ba388b0cb7fc59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 15:19:19 2012 +0100

    sna: Fix typo and use the right pointer for kgem_bo_destroy
    
    Useless warnings in xorg headers ftl.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48400
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8502e350cb18f6f5d821d237ffcee453f347eba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 14:43:28 2012 +0100

    sna: Add missing alloc failure check for creating tile source
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9cc6f7ccc55cc11f47b3b7d626c9f5a7c1327d57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 12:06:56 2012 +0100

    sna: Release the freed bo cache upon expire
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 102d11906a672140bac099e7bd1b35345d13a2fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 22:54:51 2012 +0100

    sna: Check for an inactive partial buffer to reuse after retiring requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2fb2421d8f5c07925d1699673aa4b1dd6c6b22c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 22:54:15 2012 +0100

    sna: Release partial buffers during cache expiration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 333fdcad8677675a4758223c1a980c90d970ee42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 22:53:31 2012 +0100

    sna: Repeat expire whilst there remaining outstanding requests
    
    Do not allow the cache expiration to finish if we are still running
    requests.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 778232e3d2fb5340a3092014801dc00a56c56d42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 10 11:14:50 2012 +0100

    sna: Only move the bo into the read domain for readback
    
    And mark it as currently in no domain afterwards, so that if we reuse
    it, it will be appropriately moved later.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd093eafb9b94b8e4cd8853d74078c3aa7e72f57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 14:09:42 2012 +0100

    sna: Add assertions around proxy list handling
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48400
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f0bede3e7e3f92a637d1c886304b16afc0e34f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 10:48:08 2012 +0100

    sna/traps: Use a temporary variable for the write pointer
    
    To avoid accumulating the write offset for wide spans, we need to reset
    the destination pointer between spans.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48332
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e4da00e3e03b873f5cad0cc5b1f6cc791852ca5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 9 10:42:18 2012 +0100

    sna/traps: Assert that the inplace row is contained before writing
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48332
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0464e93a088a9e8bc29ad8b36b6e12c3dda32ec6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 17:16:03 2012 +0100

    sna: Add some assertions for misuse of proxies
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48400
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 479cb6ba71038fe44f66fb31fad90d0d454fea7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 14:25:49 2012 +0100

    sna: Compress adjoining spans during FillSpans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5c01c13badeb7c2ead0c848b746d8d474277a77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 13:51:13 2012 +0100

    sna: Remove the duplicated check for use-bo? in PolySegments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5deea4f60433ee2b0c2d02fba682fff8b7829e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 13:39:47 2012 +0100

    sna: Correct partial-write flag for PolySegments fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3d7f4c1cf7d052163b7c4e74bb202c618f0eb76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 13:18:56 2012 +0100

    sna/gen3: Reset accumulated constants for each composite
    
    In particular the glyph routines require the composite setup to
    reinitialise state between glyph runs. This affects anything trying to
    use glyphs without a mask with a gradient source, for example.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 701473d20485a0557b4fb36efcbfbb8656e2f619
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 8 10:09:42 2012 +0100

    sna: Release cached upload buffers when reusing a write buffer for readback
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=48400
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ecf17b2507f95e1fefea15833fa9f57ec256a2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Apr 7 10:01:01 2012 +0100

    sna/gradient: Compute the absolute delta between color stops
    
    Otherwise we do not detect gradients that start from white!
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48407
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4356fae72db3a33935b575edf95c84fbb48072a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 21:10:50 2012 +0100

    sna/video: Only wait upon the scanout pixmap
    
    Caught by the addition of the assertion.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b790ba2ec9ead51227d85fc8630bc7505eb7d7b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 15:38:02 2012 +0100

    sna: Correct the damage offset for redirected rendering
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48385
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b81bafb802bb86454739ed46cf45571bccef735
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 15:14:45 2012 +0100

    sna/glyphs: Prefer a temporary upload mask for large glyph masks
    
    If the required temporary mask is larger than the 3D pipeline can
    handle, just render to a CPU buffer rather than redirect every glyph
    composition.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42a84613e34522af885b4b50d6c68ef77e81ffc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 14:27:15 2012 +0100

    sna: Relase the upload cache when overwriting with PutImage
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48359
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 999aa210ff87919945c673bdd34bae76ac097681
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 09:24:36 2012 +0100

    sna: Use a sentinel value to prevent accessing beyond the end of the y_buckets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ae6328c57eb496072f0d0e27440f5d0901633b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 6 09:12:08 2012 +0100

    sna: Remove redundant check from tor_inplace()
    
    We only execute full-steps for vertical edges so we do not need the
    second check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 51b9202d27db3d98c6d82ba224bd8eb218533dd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 4 11:13:27 2012 +0100

    sna: Only engage the GPU detiler for multiple rows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98ad4c3cd8647ba3ec90fb45157773c8e85e886c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 3 19:47:15 2012 +0100

    sna/gen3: Don't force use of the render pipeline just for vmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0915d414f55a1bff4171981feb87bae212f29f23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 3 19:04:29 2012 +0100

    sna/gen3: Fix pre-multiplication of mask value
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04851e4210d2d71542359c14d4b68d0851b36326
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 3 12:34:24 2012 +0100

    sna/gen3: Convert the clear-color from picture->format to a8r8g8b8
    
    The shaders treat colours as an argb value, however the clear color is
    stored in the pixmap's native format (a8, r5g6b5, x8r8g8b8 etc). So
    before using the value of the clear color as a solid we need to convert
    it into the a8r8g8b8 format.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48204
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47308
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87a672dafd9d6f47f31b77b406b7f0fb2b4030ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 3 09:24:06 2012 +0100

    sna: Apply CoordMode when computing point extents
    
    Reported-by: Patrick Truebe <eko-priv@gmx.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48220
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a0ee491ea18dc59748ff4419ae73bd1a369ae79
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 3 09:23:49 2012 +0100

    sna: Debugging flil spans and their clipping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec1267df746512c2e262ef0bd9e9527bc5efe6f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 2 16:16:24 2012 +0100

    sna: Use the solid spans fast paths for dashed zero-width lines as well
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d1f3cb198f2fe9602356a334a076abf3c68a9c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 2 13:51:37 2012 +0100

    sna/gen4: Remove the accidental debugging hack from the last commit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c4dc9c5db7b2a5b936bdbc15536c5cf0f7f5f23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 2 13:40:22 2012 +0100

    sna/gen3+: Fix sampling of borders around gradients
    
    Incurs a slight loss of precision for the internal gradient, but much
    more preferable to the artefacts around the borders with RepeatNone.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45016
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b2651dc04cef8f9692b2557684f044b4980700f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 1 19:43:15 2012 +0100

    sna: Apply composite offset to damage for spans fast paths
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ea9ab9303d21a62683055b75eaed66c97a5f289
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 1 16:36:16 2012 +0100

    sna: Fix assertion to look at bbox of all boxes/points
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 932743bb333e35d5f6529a701137aad4d7490555
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 1 09:54:43 2012 +0100

    sna: Assert that drawing boxes are within bounds
    
    More sanity checks required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc20c45aa0ca15720510668d6918bf3c99104626
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 22:51:21 2012 +0100

    sna: Minimise the risk of hotplug hangs by checking fb before vsync
    
    Everytime we issue a MI_WAIT_FOR_EVENT on a scan-line from userspace we
    run the risk of that pipe being disable before we submit a batch. As the
    pipe is then disabled or configured differently, we encounter an
    indefinite wait and trigger a GPU hang.
    
    To minimise the risk of a hotplug event being detected and submitting a
    vsynced batch prior to noticing the removal of the pipe, perform an
    explicit query of the current CRTC and delete the wait if we spot that
    our framebuffer is no longer attached. This is about as good as we can
    achieve without extra help from the kernel.
    
    Reported-by: Francis Leblanc <Francis.Leblanc-Lebeau@verint.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45413 (and others)
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 305734ebdf3d51c084cfbee8804b6c60b1f03a98
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 21:27:29 2012 +0100

    sna: Separate out scanline waiting for gen4
    
    So that we do not set a gen4 bit on gen2 and apply the old workaround of
    trimming y2 instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f2814db6f7b89e94e54b8d73c7e176ab7d1c469
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 20:45:55 2012 +0100

    sna/traps: Align the pointer+index
    
    It's the location of the pixels within the row that matter for
    alignment!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47418
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: Magnus Kessler <Magnus.Kessler@gmx.net>

commit ee075ced844350785685a0f93f88f1dc310bcc73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 19:09:30 2012 +0100

    sna/traps: Align the pointer not the indices
    
    Magnus found that inplace_row was still crashing on his setup when it
    tried to perform an 8-byte aligned write to an unaligned pointer. This
    time it looks like the row pointer itself was not 8-byte aligned, so
    instead of assuming that and fixing up the indices, ensure that the
    (index+row) results in an 8-byte aligned value.
    
    Reported-by: Magnus Kessler <Magnus.Kessler@gmx.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47418
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fde8a010b3d9406c2f65ee99978360a6ca54e006
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 12:47:21 2012 +0100

    uxa: Remove broken render glyphs-to-dst
    
    Reported-by: Vincent Untz <vuntz@gnome.org>
    Reported-by: Robert Bradford <robert.bradford@intel.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=48045
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 451489b49916cf5a9d27844196f9656e590d9124
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 30 10:21:26 2012 +0100

    sna/gen7: Allow per-device specific maxima
    
    As the maximum thread count and urb size differs between different
    incarnations of the GT units, be a little more flexible in programming
    those maximums.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea36f2c4a3fa9afa8184eeaf944af9924c080368
Author: Eugeni Dodonov <eugeni.dodonov@intel.com>
Date:   Thu Mar 29 21:08:29 2012 -0300

    Add support for Ivy Bridge GT2 Server chipset
    
    Sometimes known as Bromlow.
    
    Signed-off-by: Eugeni Dodonov <eugeni.dodonov@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6142232fa0feeb39412cda85ca727cc770eaa042
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 28 18:59:26 2012 +0100

    sna: Add video sprite support for ILK+
    
    Based on the work by Jesse Barnes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae8aa172a7330439a8e6dda41f5e33eb257a139b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 28 22:07:10 2012 +0100

    sna: Fix up 32-bit overflow for maximum object size calculation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e7b5f7eafbf452c781e50eba7dc8323260af59e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 27 10:42:59 2012 +0100

    sna/traps: Prefer to try mono spans on the GPU before trying inplace CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 522b41b393b979fdccf1ad62194cde8129f98c8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 27 10:42:21 2012 +0100

    sna/traps: Fix the width of the left-hand edge of an unaligned box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 008ad39b72eb86dc2f89789427be269c148feaf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 27 10:41:37 2012 +0100

    sna/gen6: Reduce opaque solid OVER to SRC for render composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9e9041934b2486e5661ba6c550e6670009f69f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 26 16:03:42 2012 +0100

    sna: Remove bogus assertion of no references to in-flight upload buffers
    
    As we may hold a cached reference to an upload buffer whilst it is
    in-flight, the assertion that there are no such references to a buffer
    being reused is no longer true. Those cached references will be released
    as soon as we retire the buffer during the readback and so we are free
    to reuse such an upload buffer for immediate readback.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89091dd8a3fba6520a651e3e135c87546b81df9b
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Tue Mar 20 11:53:21 2012 -0300

    Avoid duplicated code with intel_output_create_ranged_atom
    
    Same change for intel_display.c and sna_display.c.
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62f9833298ea936eaefe973eca04b1dde858fbd8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 25 21:25:15 2012 +0100

    sna/gen2+: Approximate expensive gradients when using imprecise rendering
    
    If we lack the ability to use a shader to compute the gradients
    per-pixel, we need to use pixman to render a fallback texture. We can
    reduce the size of this texture and upsample to reduce the cost with
    hopefully imperceptible loss of quality.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25807f472d051163ed96556a409110fa405c24d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 23 14:56:06 2012 +0000

    uxa: Remove hook for CompositeRectangles
    
    It was broken and not flushing damage correctly. With the
    improvements made to the kernel, it is no longer a significant advantage
    per se and not worth its additional complexity.
    
    Reported-by: Tilman Sauerbeck <tilman@code-monkey.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32547
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4460c6d0d30cf20b76854d47fd9e3aecf1839f15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 23 11:05:55 2012 +0000

    configure: Stop the debug build erroring out if it cannot find valgrind
    
    Another case where I passed an empty string believing that would be
    sufficient to replace the error path...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 168ecd96f23756e185af627f814f81b8a4c0c529
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 22 23:47:56 2012 +0000

    sna: Make the fallback debugging messages more consistent
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8693005b5427f256bcd7c2e7cfc48d56f5b8c5ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 22 23:43:04 2012 +0000

    sna: Update the target bo after changing from Y tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83f98d6e5c303e52c1e0fb95b6237ebf62a8edfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 22 21:57:14 2012 +0000

    sna: Correctly test for clear glyphs when searching for ones to skip
    
    With xterm, it is quite common for it to redraw itself by using lots of
    spaces and so it is efficient for us if we ellide those clear glyphs and
    only draw the backing boxes. However, we were only checking the first 8
    pixels in each line because of a missing pointer increment.
    
    Fixes absent '=' characters when using a compositor and ImageText.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47735
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86121a3af9a9fc9a2c76d7ac9f3ec17105d20d80
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 22 11:21:43 2012 +0000

    sna: Adjust the damage region for the composite offset
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47597
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6b48dd7f1eeb1a8e3841b8f3326c60b300ee9e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 22 09:22:52 2012 +0000

    sna: Force fallbacks if the destination is unattached
    
    Since the removal of the ability to create a backing pixmap after the
    creation of its parent, it no longer becomes practical to attempt
    rendering with the GPU to unattached pixmaps. So having made the
    decision never to render to that pixmap, perform the test explicitly
    along the render paths.
    
    This fixes a segmentation fault introduced in 8a303f195 (sna: Remove
    existing damage before overwriting with a composite op) which assumed
    the existence of a backing pixmap along a render path.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47700
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52f39ae1697bef86471b7c5eef8553661f255b67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 21 13:31:03 2012 +0000

    sna: Assert that the bo created is large enough
    
    Double check that the maximum access size computed from the bo
    parameters is within the allocated size for the bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f23c660f58e0db2107255f32a3503dae62fe304
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 21 13:30:45 2012 +0000

    sna: Assert that the tiled blt is correctly clipped
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0cd13e2af3db237c171f8ca1c70ddc67b1fbce4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 21 09:06:10 2012 +0000

    sna: Fallback to inplace upload if forced to tile the indirect replacement
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47629
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1db1eced5462723811e535a53cb41b108fc6c5a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 20 22:57:50 2012 +0000

    sna: Tidy an assertion when handling tiled copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38b0cc24b45afd4ed57187fb066896bf1e467f45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 21 01:01:47 2012 +0000

    sna: Remove the short-circuiting of move-to-cpu for read if no damage
    
    The danger now is that we may have either discarded the shadow pixels or
    have replaced them with a GTT mapping, either way undesirable and so we
    should reconstruct the shadow mapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f49a6b1fd7e23252b2a306f8bdb9baed5c1e8d4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 20 21:36:26 2012 +0000

    sna: Decouple the private data after UnrealizeFont
    
    As the font is kept around and reused after UnrealizeFont, we need to
    nullify the pointer to our private data in order to prevent the later
    use-after-free.
    
    Reported-by: Peter Jordan
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1bdd6461de18a6812d5af0283f4222cbb80ca2f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 20 11:08:44 2012 +0000

    sna/traps: Remove bogus assertion
    
    As we only enter that path for singular unbounded boxes, we are
    guaranteed to fill the entire trapezoid extents and so do not need the
    unbounded fixup the assertion was fretting about.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c2932e9cb283942567c3dd2695d03b8045da27f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 19 15:51:43 2012 +0000

    uxa: Defer the call to EnterVT till after outputs are initialised
    
    We need to do this apparently or else we never perform the VT switch.
    However, we can not do it too early, especially not before we have
    finished intialising the outputs.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47395
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 972e1108a5606399a679f97af0815ec9730ab5be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 19 14:38:28 2012 +0000

    sna: Declare videoRam correctly on gen2 devices
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0bab1df509d1f7fe36173715846c13b931e9be1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 19 08:25:22 2012 +0000

    sna/dri: Make the drawable as damaged for the off-screen immediate exchange
    
    In some cases off-screen is stil visible, for example under a rotation.
    As such xrandr -o left; glxgears -fullscreen was broken.
    
    Reported-by: Phillip Haddad <phillip.haddad@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17c19ea8e21e1b20eee446045573dfd94ce6f537
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 13:23:26 2012 +0000

    sna/traps: Remove separate edge->vertical flag
    
    Mark vertical edges with dy==0 to reduce structure size and reduce
    memory load during edge walking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82023397cd05c05cfcb8939829a95e287d438875
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 11:10:14 2012 +0000

    sna/gen3: Improve clear-to-solid reduction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ce5f4a11389b2fe9f27a6f09c4848ac71424d5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 10:55:17 2012 +0000

    sna/gen3: Do not force tiling for large pixmaps
    
    As the extraction routine is now smarter and can construction
    subsurfaces without copying we do not need to force tiling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 342dda3fe361c8be2f3af5af1516cdc6a5fdcaa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 10:55:06 2012 +0000

    sna/gen3: Prevent copy-fallback if we cannot blit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28c089781fdf74a9bac2e138e65383748558fcc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 10:55:27 2012 +0000

    sna: Fixup the cpu shadow mappings before uploading the box
    
    On the off-chance we arrive here with a pointer to the GTT mapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79258fe560d08dd3dd22b4782360e1597e54948c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 18 09:45:27 2012 +0000

    sna/traps: Apply some more operator and unbounded reductions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe8866d6112c3e187d6682e9e4610325668427a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 17 21:49:56 2012 +0000

    sna/gen[345]: Convert CPU mappings to GTT for vertices on submit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97cd0c7da51024400e8900e46f51620a5f7ad402
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 17 23:57:46 2012 +0000

    sna/traps: Upon reducing an ADD to a SRC, we need to apply the pending clear
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47444
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e31d9dacafe060dc86de801114b475fdd0142eb6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 17 09:21:00 2012 +0000

    sna/traps: Align indices for unrolled memset in row_inplace()
    
    The compiler presumes that the uint64_t write is naturally aligned and
    so may emit code that crashes with an unaligned moved. To workaround
    this, make sure the write is so aligned.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=47418
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b4e11923d9f683f43acf8053bcec1701df25c1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 17 00:05:47 2012 +0000

    sna/traps: Tune inplace_end_subrows()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d887f209f1210a294afc2c3883a97f7ac9f42bad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 17:19:11 2012 +0000

    sna/dri: Mesa expects the 8-bit stencil buffer to have 2-bytes per pixel
    
    The seperate stencil buffer is full of lies, why worry about one more?
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63c0d10faee3c7cca050505c2e81c416119e57e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 14:51:53 2012 +0000

    sna/dri: Improve handling of non-front attachments for CopyRegion
    
    Confusion reigns between using the backing pixmap for the drawable for
    the front buffer, and a fake pixmap for the auxiliary buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 324a1dffdc7dd896224fab265bd6a9cf99d7587f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 13:07:00 2012 +0000

    sna/gen3: Micro-optimise solid span emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47c47b85f6b7ef5cbc2192da9ef0cee91f6744ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 12:59:13 2012 +0000

    sna/traps: Micro-optimise span emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a26437f195bf3e5d5913f5552a0b838cafb9b2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 12:37:25 2012 +0000

    sna/traps: Tune nonzero_row
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cb04cf9f4395c258987faead80de5c3a2c93082e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 09:28:24 2012 +0000

    sna/traps: Make the inline u8 arithmetic more robust
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d55bbdf42c75eb0fdb634e963ce81953583964b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 16 09:18:29 2012 +0000

    sna/traps: Remove the old paths for mono inplace traps
    
    Dead code elimination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe4ad66aadcfa0c907ba6460a88c49e65225602c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 21:33:00 2012 +0000

    sna: Correct the order of screen private teardown
    
    So that we do not keep a stale references of the last cached pixmap
    across server regeneration (or shutdown).
    
    Reported-by: Thierry Reding <thierry.reding@avionic-design.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47357
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a8218a535babb5969a58c3a7da0215912f6fef8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 13:20:35 2012 +0000

    sna: Prefer the CPU bo for uploads if last access was not through the shadow
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77c9c03b102e6fac2279f0085034557bd68c5112
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 13:18:43 2012 +0000

    sna: Fixup the shadow pixmap pointer for move-to-gpu
    
    If we choose not to use the CPU bo for the upload (because we fear the
    subsequent synchronisation cost), we need to fixup the shadow pointer
    before dereferencing it.
    
    On the move-to-cpu side, the fixup is already performed as we will need
    to access the shadow pixels for the subsequent drawing operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e2fbb6a1c1ad6b0971d07a91a790b0b3236dad3
Merge: 64ccc66 84d7a82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 12:43:47 2012 +0000

    uxa: Merge 'remove complicated second level caching'
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47345
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84d7a82122530a62ab9a2f4bba3044c23a0db9b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 10:03:23 2012 +0000

    uxa: Simplify allocation of backing pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b1016624ad16cf5063e88a1d422e28865a9e87f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 09:31:24 2012 +0000

    uxa/i915: Remove broken CA pass, fallback to magic 2-pass composite helper
    
    The backend failed to handle all the corner cases, so remove the
    complication.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 895a56a553e1386323a593063e5b7fbb7a410abe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 09:28:27 2012 +0000

    uxa: Remove unused render_mask_solid members
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c6f79440e8af9f264e3f6270384064dc1f44721
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 09:27:36 2012 +0000

    uxa: Remove unused tracking of the current render target
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 219467ac8bfab98bca82108b22eae8af3fc0bf36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 09:26:10 2012 +0000

    uxa: Simplify flush tracking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd8fafe0c48df7f138459f590a0e9e8d0c3267b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 10 09:10:16 2012 +0000

    uxa: Kill the complicated in-flight tracking
    
    Reference leak hunting.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64ccc6698def517fc37e9ba3c41715626df0e3ca
Author: Thierry Reding <thierry.reding@avionic-design.de>
Date:   Thu Mar 15 13:10:20 2012 +0100

    configure: Keep passed-in CFLAGS for DRI tests
    
    When the user passes extra CFLAGS and CPPFLAGS to the configure script,
    they should be kept when performing subsequent checks with additional
    flags. This is required to properly build in cross-compilation setups
    where the user may pass in flags like --sysroot in order to pick up the
    cross-built dependencies.
    
    Signed-off-by: Thierry Reding <thierry.reding@avionic-design.de>

commit c5c61ef378cad3c8259631138ea1e03eb02036af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 12:38:22 2012 +0000

    sna/traps: dst IN WHITE does not reduce to SRC!
    
    I was getting too carried with my reductions. However, IN over a
    clear surface is a no-op, though unlikely!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fba49e1bb8e5b6b0e3ceace2dbddb5796ece954e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 15 10:31:51 2012 +0000

    sna/traps: Fix off-by-one for filling vertical segments in tor_inplace
    
    If the last solid portion was exactly 4-pixels wide, we would miss
    filling in the mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27f8f121b3d7433c6c3470b048428ca088acd2c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 23:43:20 2012 +0000

    sna/damage: Handle a reduced damage rather than assert
    
    As we may reduce a damage to empty along the migration paths and not
    detect that reduced damage till later, handle those scenarios rather
    asserting.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?42426
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit abd104600252f0ebd1eb77eb5419693e1c17deda
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 23:08:31 2012 +0000

    sna: Treat unmapped but CPU-mappable bo as available for mapping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c492c0064e23457bffdf4f9ab1a7c9f1be93a87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 23:05:58 2012 +0000

    sna: Disable tiling for single row pixmaps (unless required for hw limits)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6890592cd2b2d6f0d06c530f5e770fdc98577d4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 21:30:13 2012 +0000

    sna/traps: Explicitly create an unattach pixmap for fallback
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42426
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23b5640a0f8d8a944275e574f4c72f2380f7ed7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 20:48:56 2012 +0000

    sna: Avoid using kgem_bo_reference() internally
    
    So that we can keep the assertion to track the refcnt elsewhere.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03731b4e37b0cbd3a1cb8c8ec08fddf0f670a918
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 20:46:59 2012 +0000

    sna: Ellide no-op image glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0e05b4294b2f150a41dd95d52c2e6ee8479283d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 20:19:30 2012 +0000

    sna: Don't mark cached upload buffers for inactivity expiration
    
    As these do not follow the normal rules of damage tracking, we have to
    be careful not to force migration.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42426
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96ead26c4dddab637875c74a9afca6fd6662352b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 19:56:42 2012 +0000

    sna: Add a couple of asserts for inactive_partial reference counting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a4ac18e37521d54dc36b215cbd27c56d20b2922
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 11:51:39 2012 +0000

    sna/traps: Use a more direct fallback path for the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8580677ee6725144acf63f5cc2f8097376352d6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 11:46:18 2012 +0000

    sna/traps: Rasterise using pixman inplace where appropriate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a303f195b53a78dcbb2b6c84e7e691bedc86d25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 11:26:03 2012 +0000

    sna: Remove existing damage before overwriting with a composite op
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63eeb98463a77adadc26d9de1e640b75eefebf1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 14 10:30:47 2012 +0000

    sna/gen3: Look harder to see if we can indeed use the BLT for composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d23ee0380b61e0dfd3ed56b8b4a15fd0b7956491
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 22:00:25 2012 +0000

    sna: Reuse the cached upload as a source GPU bo
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42426
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0acec1685328b1dd9dffa804a27a122fc6e4225a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 21:29:57 2012 +0000

    sna: Defer the release of the upload buffer cache till retirement
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06b28d541bdf2607edc2eb476919b28e747885d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 20:01:53 2012 +0000

    sna: Destroy the cached upload buffer if before copying into it
    
    As we discard the buffer after the next batch, we will lose the contents
    of the pixmap. Instead discard the cache, and treat it as a normal
    shadow again.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42426
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 015db20287ec90f81ddb7eb2e7ce23b90aacfb2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 16:29:41 2012 +0000

    sna: Refactor source upload-to-gpu
    
    This was originally split between into functions for flexibility that
    nothing used, so merge the duplicated code into a common function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6dfe28f978b59ab2fc44cdd8ddf3743d6507588b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 15:47:27 2012 +0000

    sna/gen6: Remove the double application of the render offset
    
    Cut'n'paste error from an older generation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c751242e245eb168b92616bdcea3421be4e420bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 13 12:04:04 2012 +0000

    sna: Only use the cpu bo for xfer between CPU and GPU if either is busy
    
    The synchronisation costs overwhelm any benefit from offloading the
    copy, unless we are currently streaming the updates anyway.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9668a772f15ab36d643a9b0616b309856146c89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 23:28:51 2012 +0000

    sna: Reduce OVER with a clear pixmap to a BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ea58256f5ce6e1c0f48d366ff7a1fbf300600de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 23:05:17 2012 +0000

    sna: Reuse the same upload buffer for the duration of the batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b9abe2be1f54bd8e8593ed155cc4725ac97627a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 21:09:19 2012 +0000

    sna: Prefer to render very thin trapezoids inplace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e2d6ee31a21267ba27e4bebb883aaab08a12f30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 20:34:42 2012 +0000

    sna: Always reset the source counter after rendering to with the CPU
    
    The goal is to avoid moving to the GPU too early for a frequently
    modified CPU buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bde1f55a1075eefab0f083833508265fc0e91e7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 20:25:50 2012 +0000

    sna: After move-to-gpu signals yes, force the GPU bo creation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ee7de1f1711d1058e5812c6aa0d94ecf9af7d8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 20:09:05 2012 +0000

    sna/trapezoids: Reduce mono ADD/OVER against a clear background to a SRC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99c239e380b9f5134afc75bf55bf3f69e5113e38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 19:49:30 2012 +0000

    sna: Treat backing pixmaps no differently from their forward facing cousins
    
    Another fix for the large buffers overhaul.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28792be1f31190171644d911d7b5573186fe2df2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 19:45:35 2012 +0000

    sna/display: Only flush pending output when installing a new scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 278c329b9e2aa9a94bd0d0ee73939814ac514e3d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 11:50:54 2012 +0000

    sna/trapezoids: Further improve the clipping criteria for inplace traps
    
    Not only must we defend against the span starting too far to the right,
    we must also defend against the span terminating too far to the left.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ae45584327a10b05f7aee99bcb71e9d990a3e9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 12 10:49:46 2012 +0000

    sna/trapezoids: Add paranoia to ensure that the span starts within the clip
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47226
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8136bc5e113ae06c30def3c91b1615e5fab8af44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 11 19:45:55 2012 +0000

    sna: Make the maximum BLT pitch assertions consistent
    
    The maximum permissibly BLT pitch value is 32767, so make the assertions
    match...
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47206
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 989615493608525fc252e4e94ac7259cba0741f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 22:44:16 2012 +0000

    sna: Feed fallback mono trapezoids through the mono rasteriser
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 552e4fbd2c25eb5ab0ae77e11f5f8ba2fdb29daa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 20:02:44 2012 +0000

    sna/traps: Add a fast path for narrow masks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 494edfaaacaae13adfa5e727c66a83cb2294d330
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 12:19:33 2012 +0000

    sna: Handle partial reads with a pending clear
    
    Skip the filling of the whole pixmap if we have a small read and we
    know the GPU bo is clear. Also choose to operate inplace on the GPU bo
    if we meet the usual criteria.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd62dc73dcdbab34aa5c83382e46c7315d554a1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 10:37:34 2012 +0000

    sna/traps: Apply somes simple but common operator reduction for clipmasks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c25a3f7f46010660f441070ab7b9d5d1bc39ed0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 09:43:46 2012 +0000

    sna/dri: Only delivered a delayed flip if the drawable is still on the root
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93846b468e778440549ef0cae171c7fe9678ed9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 09:43:24 2012 +0000

    sna/traps: Remove some dead code
    
    This function was never used in this implementation, remove it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90c995736555ce14b08b69a42832d9774ba58304
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 9 00:37:32 2012 +0000

    sna: Emit a INFO when compiled with debugging enabled
    
    It is useful to know and to receive confirmation that you have
    successfully compiled and executed the driver with debugging enabled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e194f33db0437ea2f25c22efdad9552aefcab2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 18:07:22 2012 +0000

    sna/traps: Fix the initialisation of the error term for vertical mono edges
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 635c604b787625f93763001951f8bdf66482c682
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 18:06:51 2012 +0000

    sna/traps: Unroll insertion sort
    
    As the compiler cannot know the loop is bounded by a sentinel, manually
    unroll it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a087430ad99c06e79249d2cdd019cb8bf7f955d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 17:13:39 2012 +0000

    sna/gen6: Replace the memset with explict initialisation
    
    The profiles told me to kill it...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61226cd41faf320f79ee4bd72dc77163079da853
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 13:41:58 2012 +0000

    sna: Fix handling of large glyphs following large and shared buffer work
    
    Part of the large buffer handling was to move the decision making about
    whether to create GPU bo for a pixmap to creation time. The single
    instance where we change our minds later is involving large glyphs which
    we choose not to cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa7a2bd71275e069a2e4383a26355854b0b8044c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 12:27:23 2012 +0000

    sna: Fix reversed logic for CREATE_NO_RETIRE
    
    If the flag is set, we cannot retire, not the other way around!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8d520950edb5cec878999a09d3f7e6f8b15bf5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 12:13:36 2012 +0000

    sna: Avoid NULL deference in DBG
    
    Only print out the details of the allocated CPU bo, if we actually
    allocate it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33af42e6284f104ed3c4cdba4bf3b1c29322ce9c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 12:10:24 2012 +0000

    sna: Force the creation of a backing pixmap for scanout
    
    Ordinarily if the GPU is wedged, we just want to create a shadow buffer.
    Except that we must ensure that we do allow a bo to be created for
    attaching to the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6abfa4c5662e5294edc501953dbfa7aabf0b2f57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 11:59:02 2012 +0000

    sna: Mark the pixmap for writing when creating the screen resources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c5ebd6a3ecf3bd83747003bc272a736b7c333c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 11:13:34 2012 +0000

    intel: Fix typo s/asert/assert/
    
    The joy of conditional compiles masked this compilation failure when
    testing.
    
    Reported-by: Reinhard Karcher <reinhard.karcher@gmx.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6474883d325cff443da9ceaa99ec734e6cdc1d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 11:04:05 2012 +0000

    sna/gen2+: Use the reduced operator from CompositeRectangles
    
    Do not attempt to further reduce the operator locally in each backend as
    the reduction is already performed in the upper layer.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42606
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ae3cd36ae98fa43716ef482e70364e7563cf1ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 10:51:05 2012 +0000

    sna: Tidy marking pixmap->clear for CompositeRectangles
    
    Reduce the two unsightly checks into one.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b21659ef2f9cec799b8215a2e5481667bc744bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 10:50:32 2012 +0000

    sna: Add some assertions around pixmap creation for render operations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d74300647dd815ae5b4399f84ea339045d12563
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 09:54:16 2012 +0000

    sna: Discard unbound partial buffers
    
    Instead of keeping a virgin partial buffer around on its inactive list,
    just transfer it to the global bo cache (in actuality destroy it since
    it is just a kmalloc with no pages bound).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9eb8ba4df2a99342dbb3569c043d84aa82506aba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 09:42:58 2012 +0000

    sna: Preserve the offset alignment when trimming unused rows from partials
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e6166a0e87a00248d0d4925953c923850f5b840
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 02:09:25 2012 +0000

    sna: Becareful not to reduce operators for superluminal colors
    
    wine-1.4 is such an example of a crazy application.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42606
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f73cc706ff39cd4c10433791f12b5f829f62e6d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 08:54:24 2012 +0000

    sna/dri: Use a counter for the number of DRI drawables attached to a pixmap
    
    The root pixmap, for instance, may have unique DRI2Drawables for each
    inferior window. We only want to clear the flush flag on the last
    release, so we need to keep a count of how many DRI drawables remain
    attached rather than a solitary flag.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49a80ce1ff336fb2fa7d214bd3fddbce5a62b77a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 15:52:41 2012 +0000

    sna/gen2+: Prefer not to fallback if the source is busy
    
    As if we try to perform the operation with outstanding operations on the
    source pixmaps, we will stall waiting for them to complete.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4899740f6f0f5b1a5b2b3490502ccdeb7b092877
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 8 00:57:12 2012 +0000

    sna: Do not reset partial buffers if they are not attached to the current batch
    
    As we may be holding on to them as an active mapping whilst they are
    executing; reseting the used counter back to zero in this case can cause
    corruption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72a7538d4e7bcf0bd7455d9e67d8751e17739e6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 15:45:21 2012 +0000

    sna: Convolution filter fixes
    
    A couple of typos made the convolution filter explode rather than
    convolve.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34fe3cbb316c36c7022735cf9b03d8b655e04434
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 17:49:01 2012 +0000

    sna: Avoid recursive calls to kgem_retire_partials()
    
    Whilst iterating the partial list and uploading the buffers, we need to
    avoid trigger a recursive call into retire should we attempt to shrink a
    buffer. Such a recursive call will modify the list beneath us so that we
    chase a stale pointer and wreak havoc with memory corruption.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=47061
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46c79e4d59ec4f90a1fa97b24a3e7058fdbfa6ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 13:17:21 2012 +0000

    sna: Restore checking for all-clipped-out for CompositeRectangles
    
    In the refactoring to avoid repeatedly applying the singular
    pCompositeClip, the check for the all-clipped state was lost.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9944f1834a9c53091e4415f928f917e9247f17c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 10:47:42 2012 +0000

    sna/gen2: Fix transformation of linear gradients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df25495eaab5bcd5baf86047a2dd0149eea00d1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 10:43:24 2012 +0000

    sna/gen4: Hook in the poor-man's linear gradient
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69d6a0387b8eec8396631714a0564b7e28d187ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 10:43:24 2012 +0000

    sna/gen5: Hook in the poor-man's linear gradient
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0d3c4f661bace84b78b194eaeee7bfa009a32cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 10:43:24 2012 +0000

    sna/gen7: Hook in the poor-man's linear gradient
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcc364a7b190ce9cec2ff35aa22c10529f84e4c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 7 10:40:50 2012 +0000

    sna/gen6: Add poor-man's linear implementation
    
    Still no JIT, in the meantime we can at least cache the gradient ramps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 232972c0e5bd833c1d0b33432fa8092c601fd0e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 6 12:17:03 2012 +0000

    sna: Remove the 2-step damage flush
    
    The idea was to reduce the number of unnecessary flushes by checking for
    outgoing damage (could be refined further by inspecting the reply/event
    callback for a XDamageNotifyEvent). However, it does not flush
    sufficiently for the compositors' liking. As it doesn't appear to restore
    performance to near uncomposited levels anyway, remove the complication.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb10ade0fc8e21cd01c0d8acba7891fd7f2aa222
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 5 22:55:57 2012 +0000

    sna: Defer the FlushCallback removal until after the next flush
    
    Try to reduce the amount of Add/Delete ping-pong, in particular around
    the recreation of the DRI2 attachment to the scanout after pageflipping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60dacdb127599606db13ad111af8ce26c1141da5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 5 22:46:20 2012 +0000

    sna: Only install the flush callback for the duration of the foriegn buffer
    
    After we are no longer sharing the bo with foreign clients, we no longer
    need to keep flushing before every X_Reply and so we can remove the
    callbacks to remove the overhead of having to check every time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b39d9f9166547effe066acfc3327dd88a019d273
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 5 22:29:38 2012 +0000

    sna: Check for flush at the start of every WriteToClient
    
    The goal is to simply avoid the flush before going to sleep when we have
    no pending events. That is we only want to flush when we know there will
    be at least on X_Reply sent to a Client. (Preferably, it would a Damage
    reply!) We can safe assume that every WriteToClient marks the beginning
    of a new reply added to the Client output queue and thus know that upon
    the next flush event we will emitting a Reply and so need to submit our
    batches.
    
    Second attempt to fix a438e4ac.
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f30b0beea4f5657a60eb5b286f41105298fa451a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 4 22:23:39 2012 +0000

    sna/trapezoids: Ellide empty cells
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b69c9dfae128ed69a397a066b8fbe62012742bf1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 5 21:05:34 2012 +0000

    sna/composite: Skip clipping the rectangle region against the singular clip
    
    As we will already have taken it into account when constructing the
    region from the rectangles.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4846168a60feca7437f0039612ba9986c5f8d77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Mar 5 21:04:25 2012 +0000

    sna: Flush dirty CPU damage before notifying the compositor
    
    Fixes regression from a438e4ac (sna: Revamp vmap support)
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7600e4e7726bb8bd6c7256ad2baf195d4427c60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 4 19:12:29 2012 +0000

    sna: Add some assertions to partial buffer list tracking
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b5d556a93ac0afebf6c1dd02e0c92f6eb73f633
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Mar 4 15:48:33 2012 +0000

    sna: Fix assertion for checking inactive shadow buffers
    
    We may have an ordinary malloc with no CPU bo attached so check before
    dereferencing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aaed9e9722aa30a3d6dc9a3f07309655de65b6bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 23:31:24 2012 +0000

    sna: Encourage promotion of snooped CPU bo to real GPU bo
    
    This fixes the regression in performance of fishietank on gen2. As
    the texture atlas is too large to be tiled, one might presume that it
    has the same performance characteristics as the snooped linear CPU
    buffer. It does not. Therefore if we attempt to reuse a vmap bo, promote
    it to a full GPU bo. This hopefully gains the benefit of avoiding the
    copy for single shot sources, but still gives us the benefit of avoiding
    the clflushes.
    
    On the plus side, it does prove that gen2 handles snoopable memory from
    both the blitter and the sampler!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 599cd0e8ef3080fc735860bef4e47107c1c05f9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 20:18:32 2012 +0000

    sna: Align allocations with partial buffers to 64 bytes.
    
    A magic number required for so many functions of the GPU. In this
    particular case it is likely to be that the offset of a texture in the
    GTT has to have a minimum alignment of 64 bytes.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46415
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4918e309dfadaf14da6997468f08db03ac0a6327
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 18:18:48 2012 +0000

    sna: Silence an assertion failure during shutdown
    
    Clear the scanout flag on the front buffer during teardown to silence
    the debugger.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f890fc25c6c2ca358323be5a0d636c3f2ab4b298
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 18:11:56 2012 +0000

    sna: And fix compilation for last commit
    
    I skipped a GCC warning about the implicit function declaration, which
    of course results in a runtime silent death. Oops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f853acfeccb92885f154b03125d5716591a87bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 17:36:50 2012 +0000

    sna: Prevent backing pixmaps being created later
    
    We used to allow the backing pixmap to be created later in order to
    accommodate ShmPixmaps and ShmPutImage. However, they are now correctly
    handled upfront if we choose to accelerate those paths, and so all
    choice over whether to attach to a pixmap are made during creation and
    are invariant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 866a61a2590f0c5ae6592a13d4e3de3e68f5e373
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 16:06:59 2012 +0000

    sna: Disable vmap on 965gm
    
    The sampler just dies if it encounters a snoopable page, for no apparent
    reason. Whilst I encountered the bug on Crestline, disable it for the
    rest of gen4 just to be safe.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c653786895fc30be0e88455ce5f9caf9adc835d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 14:34:23 2012 +0000

    sna: Pass usage hint for creating linear buffers
    
    As we wish to immediate map the vertices buffers, it is beneficial to
    search the linear cache for an existing mapping to reuse first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29ec36ff063472e0744af99aa81ed5ad8e291a36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 10:01:07 2012 +0000

    sna: Only discard the inplace flag for LLC partial buffers
    
    KGEM_BUFFER_WRITE_INPLACE is WRITE | INPLACE and so the typo prevented
    uploading of partial data through the pwrite paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f039ccf9587eb07528034c3247a6e700c87a5500
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 2 09:47:10 2012 +0000

    sna: Be careful not to discard the clear operation for move-region-to-cpu
    
    When moving only a region to the CPU and we detect a pending clear, we
    transform the operation into a move whole pixmap. In such situations, we
    only have a partial damage area and so need to or in MOVE_READ to
    prevent the pending clear of the whole pixmap from being discarded.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46792
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 392593e61dac3ac65ee8e32de492c4439413ee85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 1 17:54:51 2012 +0000

    sna/gen5: Help the compiler avoid an uncached read
    
    Debug builds are excruitatingly slow as the compiler doesn't store the
    temporary in a register but uses an uncached readback instead. Maybe
    this will help...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c0c04cac245db046ef17ff24c32e6ab93535f48
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 1 14:52:39 2012 +0000

    sna: Split storage of inactive partials
    
    As we now attempt to keep retain partial buffers after execution, we can
    end up will lots of inactive buffers sitting on the partial buffer list.
    In any one batch, we wish to minimise the number of buffers used, so
    keep all the inactive buffers on a seperate list and only pull from them
    as required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a438e4ac9ba162e870fb22bc54024d35daa2121e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 28 19:15:34 2012 +0000

    sna: Revamp vmap support
    
    Dust off the kernel patches and update to reflect the changes made to
    support LLC CPU bo, in particular to support the unsynchronized shadow
    buffers.
    
    However, due to the forced synchronisation required for strict client
    coherency we prefer not to use the vmap for shared pixmaps unless we are
    already busy (i.e. sync afterwards rather than before in the hope that
    we can squash a few operations into one). Being able to block the reply
    to the client until the request is actually complete and so avoid the
    sync remains a dream.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 272f5d9f8407d8084846b429c1722bddb3e861e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 1 11:10:03 2012 +0000

    sna: Discard use of inplace GTT uploads on LLC architectures
    
    As the buffer is cache-coherent, we can read as well as write to any
    partial buffer so the distinction is irrelevant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43b1a717bae047c7ebbf99e6fa4c03b7a67896b8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 28 13:37:14 2012 +0000

    sna: Sort the partial buffers after stealing a write buffer
    
    It will be decoupled and not used again, but this keeps the sanity
    checks happy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8198e5872c3771e2aefabe1e3e93afa94d2ea0ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 28 10:42:19 2012 +0000

    sna/gen3: Tweak glyph rendering fast paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c4f29820bca336af2c997bafc7ef288b455813c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 27 16:29:38 2012 +0000

    uxa/gen3: Remove special casing of solid pictures
    
    Fixes use of alpha-groups and opacity masks in cairo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f3066f0c70654f04f4acadf140e3c5c8dda051d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 27 13:58:58 2012 +0000

    sna/gen2; Initialise channel.is-opaque for fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3640a0d4cb9e0f115fda9ea36212670f6ccafb22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 27 12:28:22 2012 +0000

    Revert "meh"
    
    This reverts commit 4adb6967a84af8a04769c2d936a41f4a49ed1428.
    
    Oops, this debugging commit was not intended to be pushed along with the
    bugfix. :(
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fd8d74a6aedb6484e53e704d9f44e0bf83ae9ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 27 12:06:50 2012 +0000

    sna: Upload the ordinary partial buffers!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4adb6967a84af8a04769c2d936a41f4a49ed1428
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 27 11:36:35 2012 +0000

    meh

commit 4fbb0baff525115037f7e5a1689541880a6cdafb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 26 22:34:30 2012 +0000

    sna: Avoid reusing mmapped partial write buffers for readback
    
    An artefact of retaining the mmapped partial buffers is that it
    magnified the effect of stealing those for readback, causing extra
    writes on non-llc platforms.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3c398a6731874ba47e0a46bbd42bf9378e12ab8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 25 10:59:14 2012 +0000

    sna: Retain unfinished partial buffers between batches
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d773b88f45594f45174dc6f1a264d968690ce84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 25 09:32:20 2012 +0000

    sna/gen3+: Keep the vertex buffer resident between batches
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cb773e7c809e1de23cd64d3db862d1f8e7e955a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 25 11:07:16 2012 +0000

    sna: Ensure we trigger a retire for search_linear_cache
    
    Bo used for batch buffers are handled differently and not tracked
    through the active cache, so we failed to notice when we might be able
    to run retire and recover a suitable buffer for reuse. So simply always
    run retire when we might need to create a new linear buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1b4db8942e69d47aabfad3751165dc2252fa448
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 25 00:43:30 2012 +0000

    sna: Skip a tiled bo when searching the cache for a linear mmap
    
    If we change tiling on a bo, we are effectively discarding the cached
    mmap so it is preferable to look for another.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85e48d2e5eb029d8c17714cb5e7db39ea06a2455
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 24 21:40:44 2012 +0000

    legacy: Rename XF86DRI to HAVE_DRI1 to avoid conflicts with xorg-server.h
    
    We use the XF86DRI as a user configurable option to control whether to
    build DRI support for i810, but it is also used internally within xorg
    and there exists a public define in xorg-server.h which overrides our
    configure option. So rename our define to HAVE_DRI1 to avoid the
    conflict.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46590
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96db90e819a1990c2d139725e522055e92def959
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 24 21:36:30 2012 +0000

    legacy: Delete unused XF86DRI_DEVEL #define
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46590
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b870a3e5cd922ce37050ece73e2469802dd21da2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 24 11:21:49 2012 +0000

    configure, NEWS: Bump version to 2.18.0 for release
    
    Another quarter, a bit late as I was debugging a few regressions,
    another release.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b5cd6780ef7cae8f49d71d7c8532597291402d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 24 11:14:26 2012 +0000

    uxa: Add a option to disable the bo cache
    
    If you are suffering from regular X crashes and rendering corruption
    with a flood of ENOSPC or even EFILE reported in the Xorg.log, try
    adding this snippet to your xorg.conf:
    
    Section "Driver"
      Option "BufferCache" "False"
    EndSection
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=39552
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8ca50818cd4f82e0ad8eeb245e8ee838b083056
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Sat Feb 18 13:49:02 2012 -0500

    Revert "Update autotools configuration"
    
    This reverts commit 9184af921bc2f332fcb6c9b47001414378eab8e2.
    
    All X.Org modules must be able to be configured with autoconf 2.60.
    In addition, version 2.63 has GPL licensing issues which prevents
    some vendor to release software based on it.
    
    The AM_SILENT_RULES are already handled by XORG_DEFAULT_OPTIONS.
    
    All X.Org modules must be able to be configured with libtool 1.5.
    
    AM_MAINTAINER_MODE default value is "enabled" already.
    
    We use the same autogen script for all x.org modules.
    There are proposals for changes which should be reviewed and eventually
    applied to all modules together.
    
    The lt*.m4 patterns are already included in the root .gitignore file.
    This can be proposed as a change to all modules, but it invloves
    changing the topvel .gitignore, the m4/.gitignore, the ACLOCAL_AMFLAGS
    and the AC_CONFIG_MACRO_DIR together.
    
    For more information on project wide configuration guidelines,
    consult http://www.x.org/wiki/ModularDevelopersGuide
    and http://www.x.org/wiki/NewModuleGuidelines.
    
    Acked-by: Matthieu Herrb <matthieu.herrb@laas.fr>
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit a647aff5124674b638ef52152a5c16c27466eed7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 12:04:09 2012 +0000

    sna/gen3: Silence the compiler complaining with DBG enabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd3a618f583a546bafbe0c171a267774adc4d72b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:40:57 2012 +0000

    sna/gen4 Refactor get_rectangles() to re-emit state after a flush
    
    Condense the work performed by each caller into the callee.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a3fa4d1b6849b666a9232b017ce82329494621b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:40:57 2012 +0000

    sna/gen7 Refactor get_rectangles() to re-emit state after a flush
    
    Condense the work performed by each caller into the callee.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe914eaca4b9178ab3d14053a703772f93295895
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:40:57 2012 +0000

    sna/gen5 Refactor get_rectangles() to re-emit state after a flush
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ecf882c838c1f044b4ed3add486b6579ea2c431
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:40:57 2012 +0000

    sna/gen6: Refactor get_rectangles() to re-emit state after a flush
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfa21713c27eb9135cb5e1745807324e49422fde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:29:38 2012 +0000

    sna/gen3: Refactor get_rectangles() to emit composite state and retry
    
    As gen3 only uses the single state emission block, and uniformly calls
    get_rectangles(), we can move that caller protocol into the callee.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a48e6e0db970ad07cd7452ba24c362d0c2fcf1bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 10:17:34 2012 +0000

    sna/gen3+: Force a batch flush when run out of CA vbo
    
    As we prematurely end the batch if we bail on extending the vbo for CA
    glyphs, we need to force the flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57c19b10db2b512c52a593fad98b5ac5db4f1497
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 23 00:33:16 2012 +0000

    sna: Use a CPU mapping if the bo is already in the CPU domain
    
    The heuristic of using the mapping only before the first use in an
    execbuffer was suboptimal and broken by the change in bo initialisation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 510767e213c2f44563f5c438ad1234113567be90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 18:33:09 2012 +0000

    sna/gen4: Fix vertex flushing across batch flushing
    
    Due to the w/a for its buggy shaders, gen4 is significantly different
    that backporting the simple patch from gen5 was prone to failure. We
    need to check that the vertices have not already been flushed prior to
    flushing again.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6392048e3e761b35644268ef161045524cfa369
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 17:00:38 2012 +0000

    sna/blt: Avoid clobbering the composite state if we fail to setup the BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e86da64be947fe4b8b5f285d26d200827847a8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 14:36:35 2012 +0000

    sna/gen3+: Flush the vertices during vertex-finish
    
    But only when finishing the vbo, which is the tricky part of the recent
    CA glyph bugs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71512b2438e06b2bd256aff3657797152fbef38e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 13:44:24 2012 +0000

    sna: Clear the flush flag on release of scanout/dri
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46445
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 025d3d46dc28e967b4f42e5748d13c7fb3ad283b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 13:17:01 2012 +0000

    sna/trapezoids: Only the inplace PictOpIn is unbounded
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b02f866d67d60538368619849f2acda4c1706476
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 22 09:15:25 2012 +0000

    sna: Ensure we restore the shadow pixels before uploading CPU data
    
    Reported-by: Joe Nahmias <joe@nahmias.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46425
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be5df7b5ab487a1282c96dda92f3799e35cd19af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 23:27:33 2012 +0000

    sna/gen5: Remove CA glyph workaround
    
    The root cause has been found and destroyed, so the w/a is now
    redundant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6038cede83e7f360428b4625d288411794f9d052
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 21:26:29 2012 +0000

    sna/gen3+: Re-emit composite state after flushing CA vertices
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42891
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe6602cbbc4eed1b88ac731a30b46cc970ea444f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 21:26:29 2012 +0000

    sna/gen3+: Only flush the vertices after checking for end-of-batch
    
    Or upon actually closing the vertex buffer.
    
    However, the underlying issue remains. That is we are failing to re-emit
    the first-pass for CA text after flushing the vertex buffer (and so
    emitting the second-pass for the flushed vertices).
    
    Reported-by: lemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42891
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 168c87a340119e65b1d7ccbbf59da820044ca936
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 13:16:43 2012 +0000

    sna: Clear the scanout flag after releasing the scanout pixmap
    
    In the future, this will be a good place to restore the cache level of
    the bo as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7415742a5f78958489216f450411603b1eff9a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 16:33:26 2012 +0000

    sna/dri: Queue a flush on the back DRI2 when enqueing a flip
    
    As we may wait upon the bo having finished rendering before we can
    execute the flip, flushing the render cache as early as possible is
    beneficial
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2715a455f7bfbecd7a6977184dc6180a09d06e1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 14:49:30 2012 +0000

    uxa: Prevent laggy applications by throttling after rendering
    
    Before blocking and waiting for further input, we need to make sure that
    we have not developed too large a queue of outstanding rendering. As we
    rendering to the front-buffer with no natural throttling and allow X
    clients to render as fast as they wish, it is entirely possible for a
    large queue of outstanding rendering to develop. For such an example,
    watch firefox rendering the fishietank demo and notice the delay that
    can build up before the tooltips appear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26721893cb41cef66db7ef626881d1eba8a5bdea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 13:31:16 2012 +0000

    sna: Mark the pixmap as active for the force-to-gpu short-circuit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1541f1afca028453379083e564bc82debf0ba39a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 13:17:35 2012 +0000

    sna: Skip the CPU synchronization when marking a pixmap as inactive
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 74fd55a96bd6c63e9c49a4b7fee7ef91f6b00a2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 13:11:32 2012 +0000

    sna/dri: Ensure that we reattach to the DRI2 front buffer after modeswitch
    
    If we change the Screen pixmap due to a change of mode, we lose the
    flag that we've attached a DRI2 buffer to it. So the next time we try to
    copy from/to it, reassert its DRI2 status.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d051793b9194060f5408503b1fac56958c6e58e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 11:42:31 2012 +0000

    sna/dri: Improve error handling of failing to create a DRI2 pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 580ae520cad749fb86a1bddd0fa2bcadfd60abb6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 10:55:46 2012 +0000

    sna: Short-circuit repeated calls to force-to-gpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2aafb98026b5c476b7f84aa2dc4c1f9ba2e573d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 10:43:11 2012 +0000

    uxa: Silence compiler warning for const arguments
    
    i965_video.c: In function 'gen6_create_cc_state':
    i965_video.c:1374:12: warning: passing argument 4 of
    'intel_bo_alloc_for_data' discards 'const' qualifier from pointer target
    type [enabled by default]
    
    Repeated ad nauseam.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 507f72d6d44963cae5d8d4b9da68165f73c6fd36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 10:39:48 2012 +0000

    uxa: Remove DPRINTF stubs
    
    It wasn't being used for anything non-trivial and was throwing compiler
    warnings, so remove it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c72a67390ea243bf43e2ee4efe237ab88a4615b7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 10:21:56 2012 +0000

    sna/dri: Update for AsyncSwap interface changes
    
    We now need to return TRUE/FALSE depending on whether we need to
    invalidate the drawable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27bc2acf0e6a0e5e071e0d187bdf71577e821af8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 09:29:41 2012 +0000

    sna: Fix use of RegionInit() for singular regions
    
    For a singular region, we want to use a value for nboxes of 0 not 1,
    fortunately if you pass in a box, it ignores the value of nboxes.
    RegionInit() is a most peculiar API!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d98b41ce4323b43d2359349a04a4a56559e341a2
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Fri Feb 17 19:50:52 2012 +0800

    uxa/glamor/dri: Should fixup the drawable pixmap.
    
    Two fixes in this commit, first we only need to check the
    front left buffer, for other attachment we don't need to
    check them. The second is, we should fixup the pixmap's
    drawable not the original drawable.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e0d702c3a77f6db3dfd55b8cafc5fca4d778751
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Fri Feb 17 19:50:51 2012 +0800

    uxa/glamor/dri: Enable the pageflip support on glamor.
    
    To support easy buffer exchange at glamor layer, glamor
    added a new API glamor_egl_exchange_buffers() to exchange
    two pixmaps' EGL image and fbos and textures without
    recreating any of them. But this simple method's requirement
    is that there are two pixmaps. A exceptional case is:
    If we are using triple buffer when do page flipping, we
    will have an extra back_buffer which doesn't have a pixmap
    attached to it. Then each time we set that buffer to a
    pixmap, we will have to call the create_egl_textured_pixmap
    to create the corresponding EGL image and fbo and texture
    for it. This is not efficient.
    
    To fix this issue, this commit introduces a new back_pixmap
    to intel structure to hold the back buffer and corresponding
    glamor resources. Then we will just need to do the light
    weight buffer exchanging at both DDX and glamor layer.
    
    As the new back pixmap is similar to the screen pixmap
    and need to be handled carefully when close screen. As the
    glamor data structure is a per screen data, and will be
    released at its close screen method. The glamor's close
    screen method must cleanup the screen pixmap and back
    pixmap's glamor resources. screen pixmap is easy to get,
    but there is no good way to store the back pixmap.
    
    So the glamor add a new API glamor_egl_create_textured_screen_ext
    function to pass the back pixmap's pointer to glamor layer.
    
    This commit make us depend on glamor commit: 4e58c4f.
    And we increased the required glamor version from 0.3.0 to 0.3.1
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce7a57994d662f340b9457a2750e4385e7d669cd
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Fri Feb 17 19:50:50 2012 +0800

    uxa/dri: Refine the pageflip processing.
    
    Add a new element back_name to intel structure to track
    the back bo's name then avoid flink every time.
    And at function I830DRI2ExchangeBuffers, after finish
    the BO exchange between info's front and back pixmap,
    it set the new front bo to the screen pixmap. But the
    screen pixmap should be the same as front's pixmap,
    so this is a duplicate operation and can be removed.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>

commit 1a65e2b8a2ebfb4d736efb7631515babad75faf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 21 08:09:52 2012 +0000

    sna: Split up/down edge walking in order to handle endpoint clipping
    
    In order to prevent walking upwards off the top of the pixmap when
    rendering a clipped vertical edge, we need to tweak the boundary
    conditions for the vertical edge walker.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46261
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ea44997553ffdf57b346dc9d83742c511c9e5a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 23:50:42 2012 +0000

    sna: Restore the shadow pixels when reducing CPU damage to all
    
    Reported-by: Joe Nahmias <joe@nahmias.net>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46346
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbe0580e207ad85cb6a659f86c5746a7ecbcd036
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 16:30:53 2012 +0000

    sna: gen4+ suffer no penalty for changing tiling
    
    On gen4, the tiling/fence constraints are fairly lax, only requiring
    page alignment of the object and its size, and so we can switch
    tiling modes without incurring a GPU stall on active bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b68b76cf54a322e80685f1ec93538cd6c5813ea4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 13:38:11 2012 +0000

    sna: Move sync'ing of CPU bo after allocation to first write
    
    The idea was that we could afford to allocate an active CPU bo for
    copying to from using the GPU and later sync just before we need to
    write to the shadow pixels. Having the sync inside the allocation
    function potentially causes an unwanted stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bbb6794a3b97b1fcf72c8712ab0ec591683b128b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 12:25:31 2012 +0000

    sna: Trim clipped lines to end within bounds
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46261
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45673
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 805bc3310cd0a13eab8e48e7615bdd42638cfa33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 12:09:19 2012 +0000

    sna: When reversing line-drawing direction, use the clipped endpoint
    
    Make sure we take the clipping into account if we choose to reverse the
    draw direction (to maintain left-to-right inside the box emission).
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46261
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45673
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f0a4a5f7224003a0cd226137de5a068949a41b4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 20 09:52:37 2012 +0000

    sna/dri: Ensure the domain tracking is reset when releasing bo used for swaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7d147c7462ba183f5316e7e8dafeca62add6f97c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 19 17:50:56 2012 +0000

    sna: Correct tile sizes for Y-tiling on i915g
    
    128-byte Y-tiling wasn't introduced until the 945.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95391b7312147760d8da01fce68b8398aa8e4e2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 16 22:01:41 2012 +0000

    sna/trapezoids: Presume that Precise mono rasterisation adheres to the spec
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46156
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52b11f63d7922032caef0f0a5979b080dbddcbfc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 16 11:22:23 2012 +0000

    sna: Upconvert fallback trapezoids to a8
    
    Since the hardware only handles a8 without tricky emulation and pixman
    insists on using a1 for sharp trapezoids we need to ensure that we
    convert the a1 to a8 for our trapezoidal mask.
    
    More worryingly, this path should never be hit...
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=46156
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8050ced6204f5aca12e6c57f86308b6ad1b98209
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 15 17:01:18 2012 +0000

    sna/dri: Mark bo as reusable after completion of a flip-event
    
    After the flip chain is completed, any residual buffers are no longer in
    use and so available for reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc046aabde76142fce130773d78d797d7d750ab7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 15 16:08:23 2012 +0000

    sna/dri: Don't attempt to change tiling if it is a no-op
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 66cc9c69657ac2703f2c7fc3c2c50f06bf5daa99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 15 11:58:42 2012 +0000

    Be paranoid about the definition of container_of
    
    Replace any existing definition with a correct version, since there are
    broken container_of macros floating around the xorg includes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0376b7f7b083ab2e87edc36e56fd8eb99c3cd05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 13 00:48:15 2012 +0000

    Add a missing macro for old xorg/list.h
    
    list_last_entry() needs to be defined if we are including the xorg
    list.h as opposed to our standalone variant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87bed52180cd2abd80ef6b58384f9fd9c9968f7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 11 20:54:18 2012 +0000

    Include a local copy of list.h
    
    In 1.11.903, the list.h was renamed to xorg-list.h with a corresponding
    change to all structures. As we carried local fixes to list.h and
    extended functionality, just create our own list.h with a bit of
    handwaving to protect us for the brief existence of xorg/include/list.h.
    
    Reported-by: Armin K <krejzi@email.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45938
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c64ebee5fdccf313cbd3c73850e02e6fa7dd2a65
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 11 13:31:12 2012 +0000

    sna/gen6: Prefer the render ring for copies
    
    Slower for fills, but on the current stack faster for copies, both large
    and small. Hopefully, when we write some good shaders for SNB, we will
    not only improve performance for copies but also make fills faster on
    the render ring than the blt?
    
    As the BLT copy routine is GPU bound for copywinpix10, and the RENDER
    copy routine is CPU bound and faster, I believe that we have reached the
    potential of the BLT ring and not yet saturated the GPU using the render
    copy.
    
    Note that we still do not casually switch rings, so the actual routine
    chosen will still be selected by the preceeding operations, so is
    unlikely to have any effect in practice during, for example, cairo-traces.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a9b50177408c919ed5c6c2463f687476af2c698
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 11 11:02:53 2012 +0000

    sna/gen6: Suppress the CS stall for the first command in the batch
    
    The batch emission serves as a full stall, so we do not need to incur a
    second before our first rendering.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cbe8bed83f0b4097958c4541ad7809a05e6c6f43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 11 10:58:05 2012 +0000

    sna/gen7: Mention the depth-stall required before changing VS state
    
    Because one day we may actually start using VS! Copied from the addition
    of the w/a to Mesa by Kenneth Graunke.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6193f2f00fa7205f9d736340318c66d116dca53e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 9 14:16:17 2012 +0000

    sna: Fix retire after readback
    
    Upon reading, we encounter a serialisation point and so can retire all
    requests. However, kgem_bo_retire() wasn't correctly detecting that
    barrier and so we continued to using GPU detiling thinking the target
    was still busy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d8369f8e60fd4f5a0ef49f3e9866ea5ecb21927
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 8 13:15:46 2012 +0000

    sna/gen2+: Force upload rather than perform source transformations on the CPU
    
    If both the source and destination is on the CPU, then the thinking was
    it would be quicker to operate on those on the CPU rather than copy both
    to the GPU and then perform the operation. This turns out to be a false
    assumption if transformation is involved -- something to be reconsidered
    if pixman should ever be improved.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8634d461bd9e5a3d3f75b0efc11db87b8d3e1245
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 8 09:13:27 2012 +0000

    sna: Limit max CPU bo size to prevent aperture thrashing on upload
    
    Copying between two objects that consume more than the available GATT
    space is a painful experience due to the forced use of an intermediatory
    and eviction on every batch. The tiled upload paths are in comparison
    remarkably efficient, so favour their use when handling extremely large
    buffers.
    
    This reverses the previous idea in that we now prefer large GPU bo
    rather than large CPU bo, as the render pipeline is far more flexible
    for handling those than the blitter is for handling the CPU bo (at least
    for gen4+).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b16972d7850b2347efc084311d664e14263cba1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 23:45:37 2012 +0000

    sna: Check that we successfully retired an active linear buffer
    
    If we go to the trouble of running retire before searching, we may as
    well check that we retired something before proceeding to check all the
    inactive lists.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 207b4d4482a6af4a39472ec20ff04fa0c9322d73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 21:56:29 2012 +0000

    sna: Relax must-be-blittable rules for gen4+
    
    The render pipeline is actually more flexible than the blitter for
    dealing with large surfaces and so the BLT is no longer the limiting
    factor on gen4+.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13c960db9ef876ee99991d97dfc34fef184c0341
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Thu Feb 2 11:30:57 2012 +0800

    uxa/glamor: Use a macro to specify module name.
    
    This depends upon glamor commit b5f8d, just after the 0.3.0 tag.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70092bfbc51ddc5a51c9cae21c6b2852c216a6fc
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Wed Feb 1 19:47:28 2012 +0800

    uxa/glamor: Refine CloseScreen and InitScreen process.
    
    The previous version calls glamor_egl_close_screen and
    glamor_egl_free_screen manually which is not align with
    standard process. Now glamor change the way to follow
    standard method:
    
    glamor layer and glamor egl layer both have their internal
    CloseScreens. The correct sequence is after the I830CloseScreen
    is registered, then register glamor_egl_close_screen and
    the last one is glamor_close_screen. So we move out the
    intel_glamor_init from the intel_uxa_init to I830ScreenInit
    and just after the registration of I830CloseScreen.
    
    As the glamor interfaces changed, we need to check the
    glamor version when load the glamor egl module to make
    sure we are loading the right glamor module. If
    failed, it will switch back to UXA path.
    
    This depends upon glamor commit 1bc8bf tagged with version 0.3.0.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 798aad6c95a1a95fd587430dc7a6d59497a10ce1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 20:16:48 2012 +0000

    sna/gen[4-7]: Fix erroneous scale factor for partial large bo render copies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea6588726107f1ab0ef5a8f69d420b5bff819a76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 15:26:50 2012 +0000

    sna: Apply offsets correctly for partial src/dst in large copy boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 14c91e108464a305fb23b3313b842bfaeb9420fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 15:25:48 2012 +0000

    sna/tiling: Request Y-tiles if we know we cannot BLT to either the src or dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3131217e3ecbdf6cd40b044bd31e8228ff5c6bff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 14:35:59 2012 +0000

    sna: Mark up the temporary allocations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec1ccb6bf6a984cbe3317e636d7ff73887348a46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 13:37:52 2012 +0000

    sna: Set the damage for render->copy_boxes to NULL before use
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58f634b792c6d109c5f2374a3e24d759e744abb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Feb 7 13:32:20 2012 +0000

    sna: Handle tile alignment for untiled large bo more carefully
    
    We ended up trying to align the upper bound to zero as the integer
    divsion of the tile width by pixel was zero.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bf3518ea910a2a3c5b4500dcba7c829576fbfd47
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Tue Feb 7 09:40:54 2012 +0800

    uxa/glamor/dri: Fix a typo bug when fixup glamor pixmap.
    
    Should modify the old pixmap's header not the new one which
    was already destroyed.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1467a4ba1a327877026cc76b3eabeb51d1415509
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 20:41:53 2012 +0000

    sna: Use the proper sna_picture_is_solid() test
    
    Rather than the specialised routines that assumed pDrawable was
    non-NULL, which was no longer true after f30be6f743.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef335a65a9d9f7eb96873201b546c25fd03d090c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 20:37:54 2012 +0000

    sna: Search all active buckets for a temporary allocation
    
    Reduce the need for creating a new object if we only need the allocation
    for a single operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7e3aaf773f05ce82405e135c0f99b40b3c2f434
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 18:08:19 2012 +0000

    sna: Use the clipped end-point for recomputing segment length after clipping
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45673
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f30be6f74392f5687ffe8bc9dd2c6dc024ae06c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 15:59:21 2012 +0000

    sna/gen2+: Exclude solids from being classed as requiring an upload
    
    We treat any pixmap that is not attached to either a CPU or GPU bo as
    requiring the pixel data to be uploaded to the GPU before we can
    composite. Normally this is true, except for the solid cache.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45672
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f009386de87acccadb1803567e4c494e5e80a2a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 09:50:03 2012 +0000

    sna: If we have a CPU bo, do not assert we have shadow pixels
    
    When transferring damage to the GPU, on SNB it is not necessarily true
    that we have a shadow pixmap, we may instead have drawn onto an unmapped
    CPU bo and now simply need to copy from that bo onto the GPU. Move the
    assertion onto the path where it truly matters.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45672
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22e452ebe01c32a08599411743cf18f9ad0545a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 6 09:19:56 2012 +0000

    sna: Disable use of xvmc for SNB+
    
    Not yet implemented, so don't bother setting it to fail.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44874
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8ed1a02ada1f8d2f910dfefb150d26c840bf9ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 4 20:13:07 2012 +0000

    sna: Discard the redundant clear of the unbounded area if already clear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b899a4b69696141ca8b897a7abf52649b09f7b3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 4 20:07:49 2012 +0000

    sna: Always pass the clear colour for PictOpClear
    
    Having made that optimisation for Composite, and then made the
    assumption that it is always true in the backends, we failed to clear
    the unbounded area outside of a trapezoid since we passed in the
    original colour and the operation was optimised as a continuation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c107b90a44abb45c837ff8924939872be5b490eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 4 16:33:34 2012 +0000

    sna/gen6: Reduce PictOpClear to PictOpSrc (with blending disabled)
    
    The advantage of PictOpSrc is that it writes its results directly to
    memory bypassing the blend unit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4baa2806bc0f51e7576b769ca6750deb3821c4d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 4 12:06:22 2012 +0000

    sna: Check if the damage reduces to all before performing the migration
    
    An assert exposed a situation where we had accumulated an unreduced
    damage-all and so we were taking the slow path only to discover later
    that it was a damage-all and that we had performed needless checks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2653524dffc1fe0dbff7d74bfc9be535d9ececb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 3 20:06:43 2012 +0000

    sna: Reduce the downsample tile size to accommodate alignment
    
    If we need to enlarge the sampled tile due to tiling alignments, the
    resulting sample can become larger than we can accommodate through the 3D
    pipeline, resulting in FAIL.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93a0b10f163ee79b6a6a7ea46b0a33b622b1f86e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 3 19:30:24 2012 +0000

    sna: Apply redirection for the render copy into large pixmaps
    
    If the pixmap is larger than the pipeline, but the operation extents fit
    within the pipeline, we may be able to create a proxy target to
    transform the operation into one that fits within the constraints of the
    render pipeline.
    
    This fixes the infinite recursion hit with partially displayed extremely
    large images.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4774c6b8331831e0c9f3b24f5f6e1b6ea399f628
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 2 15:23:03 2012 +0000

    sna: Add a couple of sanity checks that the CPU drawable is on the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 418cd98db7c4a2886c9e310f3691eb6c77421dd7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 1 19:10:41 2012 +0000

    sna/gen6: Ring switching outweighs the benefits for cairo-traces
    
    At the moment, the jury is still out on whether freely switching rings
    for fills is a Good Idea. So make it easier to turn it on and off for
    testing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d0e7c7ecd7371ac7b5fe3f382fc5d04792f7019
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 1 14:52:56 2012 +0000

    sna: Search again for a just-large-enough mapping for inplace uploads
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55c7088f54655609fbb00106679a566b46ee8dba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 1 01:33:52 2012 +0000

    sna: Add debugging code to verify damage extents of fallback paths
    
    After using the CPU, upload the damage and read back the pixels from the
    GPU bo and verify that the two are equivalent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8fc2cde53ef7aa011ec7c47e7fc5486de0651f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 1 01:27:43 2012 +0000

    sna: Fill extents for ImageGlyphs
    
    The spec says to fill the characters boxes, which is what the hardware
    does. The implementation fills the extents instead. rxvt expects the
    former, emacs the latter. Overdraw is a nuisance, but less than leaving
    glyphs behind...
    
    Reported-by: walch.martin@web.de
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45438
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13508ab5ea136caca90c846ff1026c0c1acd2ad5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 22:38:46 2012 +0000

    sna: PolyGlyph supports all of fill/tile/stipple rules
    
    The hw routines only directly supports solid fill so fallback for the
    interesting cases. An alternative would be to investigate using the
    miPolyGlyph routine to convert the weird fills into spans in order to
    fallback. Sounds cheaper to fallback, so wait for an actual use case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df4e1059a4e09998334dde6aa1c8ccfe76e442c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 19:19:13 2012 +0000

    sna/gen6: Prefer to do fills using the BLT
    
    Using the BLT is substantially faster than the current shaders for solid
    fill. The downside is that it invokes more ring switching.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b012de0a1af4ec97c3197af3f1efdcc67bc2118
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 20:29:58 2012 +0000

    sna/gen5: Always prefer to emit solid fills using the BLT
    
    As the BLT is far, far faster than using a shader.
    
    Improves cairo-demos/chart from 6 to 13 fps.
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a748fc49d60dc2bc9494f95c4934592b111831a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 10:51:02 2012 +0000

    sna: Split the tiling limits between upload and copying
    
    The kernel has a bug that prevents pwriting buffers large than the
    aperture. Whilst waiting for the fix, limit the upload where possible to
    fit within that constraint.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c1f8a768ca1f762c722f63bab2747e4ff1fd773
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 10:29:02 2012 +0000

    sna: Avoid converting requested Y to X tiling for large pitches on gen4+
    
    The only strong requirement is that to utilize large pitches, the object
    must be tiled. Having it as X tiling is a pure convenience to facilitate
    use of the blitter. A DRI client may want to keep using Y tiling
    instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e872c1011fc7b67683703fd891234f07dd7acd04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 10:21:05 2012 +0000

    sna/dri: We need to reduce tiling on older gen if we cannot fence
    
    Only apply the architectural limits to enable bo creation for DRI buffers.
    
    Reported-by: Alban Browaeys <prahal@yahoo.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45414
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4caf67d8da37d04f8915d96b10411ba7267937e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 00:35:42 2012 +0000

    sna: Trim tile sizes to fit into bo cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f7c1646c78d8854c88b214d3699e51839ba9711
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 31 00:09:42 2012 +0000

    sna: Check that the intermediate IO buffer can also be used for blitting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e504fab6c5354ae9d18ccefb10bd586fa49b924c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 23:49:18 2012 +0000

    sna: Discard the cleared GPU buffer upon PutImage to the CPU buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed1c1a7468d78e99cb4f9a4a8b8a6b00c3257a75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 13:43:59 2012 +0000

    sna: Track large objects and limit prefer-gpu hint to small objects
    
    As the GATT is irrespective of actual RAM size, we need to be careful
    not to be too generous when allocating GPU bo and their shadows. So
    first of all we limit default render targets to those small enough to
    fit comfortably in RAM alongside others, and secondly we try to only
    keep a single copy of large objects in memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d53d93ffa6e133f46c39595294ecf8e2182b5a68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 15:11:34 2012 +0000

    sna: Update the partial buffer allocation size when reusing an old mapping
    
    Whilst the old mapping is guaranteed to be larger than the requested
    allocation size, keep track of the actual size allows for better packing
    of future buffers. And the code also performs a sanity check that the
    buffer is the size we claim it to be...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f99555b6b64a0e1baad1853569f7bf521c327c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 11:48:59 2012 +0000

    sna: Allow the creation of render targets larger than the maximum bo cache
    
    Given that we now handle uploads to and from bo that are larger than the
    aperture and that usage of such large bo is rare and so unlikely to
    benefit from caching, allow them to be created as render targets and
    destroy as soon as they become inactive.
    
    In principle, this finally enables GPU acceleration of ocitysmap on gen4+,
    but due to the large cost of creating and destroying large bo it is
    disabled on systems that require clflushing. It is, however, a
    pre-requisite for exploiting the enhanced capabilities of IvyBridge.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c65ec096e79aa6bda7b2b3ef235e3fd9698b4da7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 11:41:07 2012 +0000

    sna: Decrease tiling step size in case we need to enlarge the box later
    
    We can juggle rendering into large bo on gen4 by redirecting the
    rendering through a proxy that is tile aligned, and so the render target
    may be slightly larger than the tiling step size. As that is then larger
    than the maximum 3D pipeline, the trick fails and we need to resort to a
    temporary render target with copies in and out. In this case, check that
    the tile is aligned to the most pessimistic tiling width and reduce the
    step size to accomodate the enlargement.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95f3734dd69b82e007095a599cc21f4c63d6ec00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 11:40:02 2012 +0000

    sna: Allow creation of proxies to proxies
    
    Just update the offset of the new bo by the offset of the existing
    proxy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 488937edb67a60389380b405f8f8a548f51e64c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 30 11:38:36 2012 +0000

    sna: Base prefer-gpu hint on default tiling choice
    
    As on gen4+, tiling increases the maximum usable pitch we can
    accommodate wider pixmaps on the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca252e5b51d7b2f5a7b2c2e0d8fdb024b08096db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 19:36:55 2012 +0000

    sna: Detect batch overflow and fallback rather an risk an ENOSPC
    
    Having noticed that eog was failing to perform a 8k x 8k copy with
    compiz running on a 965gm, it was time the checks for batch overflow
    were implemented.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3aee521bf236994628c4d103a2b8f391a4be2aa7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 19:21:54 2012 +0000

    sna: Add a tiled fallback for large BLT copies
    
    If we are attempting to copy between two large bo, larger than we can
    fit into the aperture, break the copy into smaller steps and use an
    intermediatory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df148c962108a7f3efead0b80ab4fe77f3f79c8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 18:07:14 2012 +0000

    sna: Limit the tile size for uploading into large pixmaps
    
    As we may have a constrained aperture, we need to be careful not to
    exceed our resources limits when uploading the pixel data. (For example,
    fitting two of the maximum bo into a single batch may fail due to
    fragmentation of the GATT.) So be cautious and use more tiles to reduce
    the size of each individual batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1e67e8f394480eb4fef1238ccfd49cc36e4b6f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 15:43:42 2012 +0000

    sna: Fix the "trivial" fix to improve error handling
    
    The logic was just backwards and we tried to upload a shadowless GPU
    pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3fb1e1e89ccf5cefe6add66de4f960ef07cac60
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 14:20:33 2012 +0000

    sna: Handle GPU creation failure when uploading subtexture
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 518a99ea34b26aa094f29a4cc1ea5419f63a0e56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 14:09:46 2012 +0000

    sna: Always create a GPU bo for copying from an existent source GPU bo
    
    Make sure we prevent the readback of an active source GPU bo by always
    prefering to do the copy on the GPU if the data is already resisent.
    This fixes the second regression from e583af9cc, (sna: Experiment with
    creating large objects as CPU bo).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 624d9843abda9ca6bd1b004d70a6fdc082ba9653
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 13:55:20 2012 +0000

    sna: Ignore map status and pick the first inactive bo for reuse
    
    This fixes the performance regression introduced with e583af9cca,
    (sna: Experiment with creating large objects as CPU bo), as we ended up
    creating fresh bo and incurring setup and thrashing overhead, when we
    already had plenty cached.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c6255ba2f12f04938fd586ca02562ee3cae05af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 29 11:02:38 2012 +0000

    sna: Determine whether to use a partial proxy based on the pitch
    
    On gen4+ devices the maximum render pitch is much larger than is simply
    required for the maximum coordinates. This makes it possible to use
    proxy textures as a subimage into the oversized texture without having
    to blit into a temporary copy for virtually every single bo we use.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65466f86263b3788b438fe021a12ade371190b01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 28 01:54:47 2012 +0000

    sna: Allow ridiculously large bo, up to half the total GATT
    
    Such large bo place extreme stress on the system, for example trying to
    mmap a 1GiB into the CPU domain currently fails due to a kernel bug. :(
    So if you can avoid the swap thrashing during the upload, the ddx can now
    handle 16k x 16k images on gen4+ on the GPU. That is fine until you want
    two such images...
    
    The real complication comes in uploading (and downloading) from such
    large textures as they are too large for a single operation with
    automatic detiling via either the BLT or the RENDER ring. We could do
    manual tiling/switching or, as this patch does, tile the transfer in
    chunks small enough to fit into either pipeline.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03211f4b0b7e32b6d7dc28e60be72db204b8c8d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 23:18:05 2012 +0000

    sna: Guard against the upload buffer growing past the maximum bo size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2afd49a28429cdeb36583cfc31cc9b1742c1fb83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 22:18:30 2012 +0000

    sna: Limit inplace upload buffers to maximum mappable size
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45323
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f4bae01e39392faa8978090db4cbe28fa00b013
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 20:28:44 2012 +0000

    sna/video: Ensure the video pixmap is on the GPU
    
    The presumption that the pixmap is the scanout and so will always be
    pinned is false if there is a shadow or under a compositor. In those
    cases, the pixmap may be idle and so the GPU bo reaped. This was
    compounded by that the video path did not mark the pixmap as busy. So
    whilst watching a video under xfce4 with compositing enabled (has to be
    a non-GL compositor) the video would suddenly stall.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=45279
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d02bd80b2f9f8ee3840be5d8d6b8d389192c57f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 20:12:49 2012 +0000

    sna: Use a proxy rather than a temporary bo for too-tall but thin targets
    
    If the render target is thin enough to fit within the 3D pipeline, but is
    too tall, we can fudge the address of the origin and coordinates to fit
    within the constaints of the pipeline.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea433995a37f0a9d1579f74029418f22a63a2bc0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 19:34:39 2012 +0000

    sna: Experiment with a partial source
    
    If the source is thin enough such that the pitch is within the sampler's
    constraints and the sample size is small enough, just fudge the origin
    of the bo such that it can be sampled.
    
    This avoids having to create a temporary bo and use the BLT to extract
    it and helps, for example, firefox-asteroids which uses an 64x11200
    texture atlas.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad910949beb0c42e2d7b864f030b055ca40adacd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 18:37:39 2012 +0000

    sna: Mark diagonal lines as partial write
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9c83e0b2c42f7657b1854a7cdcbc0407957c382
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 18:24:01 2012 +0000

    sna/video: Add some DBG messages to track the error paths
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45279
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45d831c8b11d6f9f38c0cb9b5877541a971f2c67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 15:45:17 2012 +0000

    sna: Consolidate routines to choice destination bo
    
    Combine the two very similar routines that decided if we should render
    into the GPU bo, CPU bo or shadow pixmap into a single function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6402e7f1195f60f96dc269a701532c3270d8920f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 18:05:51 2012 +0000

    sna: Ensure that we have a source bo for tiled fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c5fb84f4de346b06e5a538e683c5a118f2579bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 14:08:57 2012 +0000

    sna/glyphs: Check that we attached to the cache pixmaps upon creation
    
    If the hw is wedged, then the pixmap creation routines will return an
    ordinary unattached pixmap. The code presumed that it would only return
    a pixmap with an attached bo, and so would segfault as it chased the
    invalid pointer after a GPU hang and the server was restarted.
    Considering that we already checked that the GPU wasn't wedged before we
    started, this is just mild paranoia, but on a run-once piece of code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86f1ae9164a94323c08e1dc6cb301e5bc1126b10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 10:26:11 2012 +0000

    sna/video: Add some more DBG breadcrumbs to the textured PutImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce1cae7f4715fc8e14327c5b705d9f2cc45a3741
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 27 00:37:51 2012 +0000

    sna/video: Simplify the gen2/915gm check
    
    And make the later check in put image match.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 541908524f9ee754db3bc45d2e1681d34479c1cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 23:14:14 2012 +0000

    sna: Remove extraneous clipping from GetImage
    
    The spec says that they must wholly contained with the valid BorderClip
    for a Window or within the Pixmap or else a BadMatch is thrown. Rely on
    this behaviour and not perform the clipping ourselves.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ff40b572ec5cd860d7c7ff23beca0388f37c31c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 22:55:04 2012 +0000

    sna: Avoid fbBlt for the easy GetImage cases
    
    From (i5-2520m):
      60000 trep @   0.6145 msec (  1630.0/sec): GetImage 500x500 square
    To:
      60000 trep @   0.4949 msec (  2020.0/sec): GetImage 500x500 square
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit adb1320bba15a3a3b4fa8e7d0fd0360fa696721d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 16:05:48 2012 +0000

    sna/gen2+: Include being unattached in the list of source fallbacks
    
    If the source is not attached to a buffer (be it a GPU bo or a CPU bo),
    a temporary upload buffer would be required and so it is not worth
    forcing the target to the destination in that case (should the target
    not be on the GPU already).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1f9415bf355e9fbd6fc3ce8fa1af59083ca2943
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 13:59:24 2012 +0000

    sna: Allow gen4+ to use larger GPU bo
    
    As the blitter on gen4+ does not require fence registers, it is not
    restricted to operating on large objects within the mappable aperture.
    As we do not need to operate on such large GPU bo in place, we can relax
    the restriction on the maximum bo size for gen4+ to allocate for use
    with the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d35b6955dbb5d652d8685d2c1ea82c5e08de55ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 14:34:36 2012 +0000

    sna: Prevent mapping through the GTT for large bo
    
    If the bo is larger than a quarter of the aperture, it is unlikely that
    we will be able to evict enough contiguous space in the GATT to
    accommodate that buffer. So don't attempt to map them and use the
    indirect access instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c81bcd0c425cc0f7ddf2ad8289bb739c8d44289
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 13:35:15 2012 +0000

    sna: Add FORCE_FALLBACK debugging hook for PutImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35c0ef586bf508c577642d772f18eae0b64cfd44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 11:20:03 2012 +0000

    sna/gen3: Use cpu bo if already in use
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b76a6da3fa0148ef32600dd9505e22b90de037df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 10:47:01 2012 +0000

    sna: Search the buckets above the desired size in the bo cache
    
    It is preferrable to reuse a slightly larger bo, than it is to create a
    fresh one and map it into the aperture. So search the bucket above us as
    well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2b8b1c145932e2254a705905c60f18c200cf2e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 12:42:12 2012 +0000

    sna: Apply any previous transformation when downsampling
    
    In order to handle rotations and fractional offsets produced by the act
    of downsampling, we need to compute the full affine transformation and
    apply it to the vertices rather than attempt to fudge it with an integer
    offset.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45086
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 352828ee59164a9e81093d88dfdd45bc21f0c739
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 26 12:41:34 2012 +0000

    sna: Tweak aperture thresholds for batch flushing
    
    In order to more easily accommodate operations on large source CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cff6a1a2e4648eb211a1789ae9f711e2f16e9d4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 23:21:36 2012 +0000

    sna: Use the cpu bo where possible as the source for texture extraction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e583af9cca4ad2e5643317447c6b065d3ee7d11e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 23:04:50 2012 +0000

    sna: Experiment with creating large objects as CPU bo
    
    Even on non-LLC systems if we can prevent the migration of such
    objects, we can still benefit immensely from being able to map them into
    the GTT as required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55569272f7d4232ef50f7b964dda82f85a190b99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 20:13:27 2012 +0000

    sna: Apply the same migration flags for the dst alphamap as for the dst pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a132ddbf06e5ffc364c25002a1e46ad8bf0e45a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 20:12:55 2012 +0000

    sna: Correct offset for moving drawable regions to the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65164d90b7b17ec7eea1e24d4b02ec037b55b1ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 20:12:27 2012 +0000

    sna/gen2+: Do not force use of GPU if the target is simply cleared
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 307f493d76580687a3cf56106bf296475f1f53e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 20:11:21 2012 +0000

    sna: Map freshly created, unbound bo through the CPU
    
    Take advantage that we know we will have to clflush the unbound bo
    before use by the GPU and populate it inplace.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d785bb7df054a1f15d59db69b089deb743bbdb40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 16:45:43 2012 +0000

    sna: GetImage is allowed to read a window's border
    
    We need to adjust the clip to include the border pixels when migrating
    damage from the backing pixmap. This also requires relaxing the
    constraint that a read must be within the drawable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36425ba49ecbd87b1e3bf4340ca2496d8de24a7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 12:49:24 2012 +0000

    sna: Round up buffer allocations when downsampling
    
    The pathological case being nx1 or 1xm resulting in an illegal allocation
    request of 0 bytes.
    
    One such example is
      wolframalpha.com: x = (200 + x) / 100
    which generates an approximately 8500x1 image and so needs downscaling
    to fit in the render pipeline on all but IvyBridge. Bring on Ivy!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2e83c6dcba1e911f42a3004b3d0782049e243e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 11:22:38 2012 +0000

    sna: Silence compiler warning for a potential uninitialised return on error
    
    sna_accel.c: In function 'sna_copy_plane':
    sna_accel.c:5022:21: warning: 'ret' may be used uninitialized in this
    function [-Wuninitialized]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d22a76506133e0f76424159c0944d29bdf39da9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 09:36:20 2012 +0000

    sna: Run the miHandleExposures for no-op CopyPlane
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 338941eda3c7591a85b83000eafae0407d0d7cd0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 02:42:25 2012 +0000

    sna: Handle self-copies for CopyPlane
    
    Prepare the source first as this has the dual benefit of letting us
    decide how best to proceed with the op (on the CPU or GPU) and prevents
    modification of the damage after we have choosen our preferred path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e8b398ca383f5292adab8b351b8837dde3e131a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:42:56 2012 +0000

    sna: Only shrink partial buffers that are being written to
    
    Ignore inactive and mmapped buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b79252efaafe2ebc998d6cf6176a425dd897e66f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:36:27 2012 +0000

    sna: Apply source clipping to sna_copy_plane()
    
    Ensure that the migration region is within bounds for both the source
    and destination pixmaps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46252bc7bcc7e08e47d00cdc87d6c1ed93830fcc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:31:34 2012 +0000

    sna: Set the source clip for CopyArea fallback correctly
    
    The source window is (src->x, src->y)x(src->width, src->height) in
    pixmap space. However, we then need to use this to clip against the
    desination region, and so we need to translate from the source
    coordinate to the destination coordinate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae6d3a311783d7e063de0347363331f14bd74d74
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:18:11 2012 +0000

    sna: Print source and destination regions for CopyArea fallback for DBG
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd5e90adfc73870cebcb215ad9fb9b5aedd38673
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:17:49 2012 +0000

    sna: Clip GetImage to drawable so that damage migration is within bounds
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1fba5e8534da7fe253e21a3501854c04d82a108
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 25 01:16:34 2012 +0000

    sna: Clear GPU damage first when moving a clear pixmap to the CPU
    
    This allows us to discard any busy GPU or CPU bo when we know we are
    going to clear the shadow pixmap afterwards.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ad95d66665802bce25e127ae0d06f3e0a9b0e62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 22:11:20 2012 +0000

    sna: Reduce number of reads required to inspect timers
    
    By using the information provided by select at wakeup.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aae19cbc5d0ddcf247451d06e063b2550a7ff16f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 19:58:29 2012 +0000

    sna: Only reset devPrivate.ptr if owned by the CPU bo when freeing
    
    If the pixmap is mapped to the GPU bo, we should continue to use the
    current mapping rather than revoke it. Otherwise if we write to the GPU
    bo inplace, thereby discarding the CPU bo, we set the pointer we are
    about to copy to, to NULL.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5312ee90ad80eda1c6ff72fbef60f77f03094972
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 19:02:56 2012 +0000

    sna: mark the pixmap as no longer clear after rendering video
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69d3fc91f4a397f704b9971f97a905626e86eb3c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 18:51:32 2012 +0000

    sna: Set up GC for general FillArc to FillSpans callback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 855c45c65a69d34ad32a97a5fc54dd09d40d3e26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 18:48:17 2012 +0000

    sna: Enable clipping for mi FillSpans gpu callback
    
    The mi routines do not ensure that their output is suitably constrained
    to the clip extents, so we must run it through the clipper.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3fe42cde70a06a9a9a6190934df5cddb41d2f5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 18:36:08 2012 +0000

    sna: Don't attempt to create pixmaps for dpeths smaller than 8
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22bab3cd7d0b2bcedfdd86f198d1ed9a21dd82aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 18:33:14 2012 +0000

    sna: Handle malloc failures when downsampling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4aef9e6f50cb96c57b7ba345a18e55c97d788192
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 17:23:43 2012 +0000

    sna: Add more damage-is-contained asserts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16462e551d575bd5a370a8ac8b450ba72fea7d47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 17:47:22 2012 +0000

    sna: Install CPU handler for PolyLine for miPolySegment callback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8b49ae70b3aadf4423bd6830c446c040f87a2f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 16:32:40 2012 +0000

    sna: Mutate a temporary copy of the GC->ops so we don't alter new GCs
    
    In order to avoid using the wrong function for a scratch GC created
    during the course of a MI function whilst we have a specialised GC in
    use, we need to avoid modifying the original function table.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a116a15a5d978a1edf413a439f6ef6d3205a7aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 16:53:21 2012 +0000

    sna: Reduce the assertion that we would have hinted to operate inplace
    
    As the drawable_gc_flags() operate on lower level information than the
    hint, it is able to spot more oportunities to reduce the READ flags and
    so the assertion was overly optimistic.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d1bba033bc29fdf498dc082f3542c520a5ed39a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 18:22:12 2012 +0000

    sna/gen3: Apply damage to video pixmap
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44504
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff4b8a03a40f7eb1d71b96aebb5daa1d8df83d2a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 17:51:35 2012 +0000

    sna: Use RepeatPad to avoid sampling the border color when downsampling
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45086
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09bddddaf94b848f417e1c9449cfe4b21d2554dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 15:50:02 2012 +0000

    sna: handle negative modulus for tiled blits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3b11ebc28114062581c39089781114323946654
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 16:05:09 2012 +0000

    sna: Add more assertions for copy errors
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b56971986d2d495aa38f015beb659fb12f0d433a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 17:23:59 2012 +0000

    sna: Trim the clipped Segment to the right length
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 358a0861e642c26d925a69656039b4c95adba237
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 13:30:19 2012 +0000

    sna: Do not discard CPU damage for a partial copy
    
    If we are copying a region that does not fill its extents (i.e. is not
    singular) then we must be care not to discard the CPU damage that is not
    overwritten by the copy.
    
    Fixes regression from 77ee92248582d65a03619d1bb1d93a74468eea00
    (sna: Use full usage flags for moving the dst pixmap for a copy).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 672c6ad8170572c0f2562d5a8381ab2d17fd1e1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 12:56:59 2012 +0000

    sna: Silence the compiler with a few DBG format warnings
    
    The size of the integers being printed changed causing warnings on 32/64
    bit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 238f3d9bc563950475ee823f844197cf15a909e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 12:19:38 2012 +0000

    sna: A deferred attachment will never have a CPU bo
    
    So we can remove that check in sna_copy_boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c353a8cfde838b070f3e71d3946f3b40d1d5113a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 10:52:27 2012 +0000

    sna: Revise use of the inplace hint to favour small cacheable operations
    
    The goal of the heuristic is to reduce readbacks and damage tracking on
    active GPU bo whilst simultaneously offering the best performance for
    small operations which would prefer to be performed on the shadow rather
    than in place.
    
    This restores ShmPutImage performance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29547421f392a9b589ba069cbfbba01dbe535d93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 10:23:46 2012 +0000

    sna: Use the reduced ROP from the fbGC to accurately determine readback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec794f7594ae5e2c223b7f7255ff8979d9fb06c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 22:14:15 2012 +0000

    sna: Track a proxy's dirty status upon itself rather than the target
    
    As proxy's are short-lived and are not used outside of the operation for
    which they are created, dirtied or flushed, we can safely copy the dirty
    status onto the proxy object itself.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2574a04c940e032fdcf1cd39a0950515e8652471
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 21:45:29 2012 +0000

    sna: Split the active bo cache into per-tiling caches
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 566cbf1ef53b1f970289fcd5b3b389a74beb7e78
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 21:15:10 2012 +0000

    sna: Abort search for a linear bo if we encounter a purged buffer
    
    Given the rarity of encountering a purged buffer versus the frequency of
    scanning the list and the then likely result of allocation a new buffer,
    simply abort the search on the first purged bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b8d3353624be51f2b618467c899a9ce3cbf3cbfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 19:13:22 2012 +0000

    sna: Refactor tests for a solid gc to use the new function
    
    This way all paths can test to see if they might be able to reduce the
    tiled fill or the opaque fill into a solid fill.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78238b3a37c1c8a152bd3920e73aa6034c0f663f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 18:00:05 2012 +0000

    sna: Prefer mi span filling functions to call through to the GPU
    
    Having removed the double analysis for the fast paths, at least, the
    span filling code on the GPU is now faster than doing the same
    operations in cache memory for the majority of cases. So allow the
    driver to prefer to use those functions when it has a GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5c77d04d79666962fd7c2d86bc6e7aef716084b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 18:24:21 2012 +0000

    sna: Reduce GC to solid if possible along general spans path
    
    Again, we should no longer be hitting this code if at all possible, but
    for completeness...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03611f662db854dc3b14f32c0315bf45bc415bbf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 19:59:06 2012 +0000

    sna: Guard against being passed n==0 to FillSpans
    
    Apparently this does happen, notably by miFillPolyArc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ac13a4d5aca1627b3a5fc9e7261d5dfafba970b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 00:21:12 2012 +0000

    sna: Provide a fast path for miZeroLine for PolySegment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e7817a2206bd0b1cc4e4458686c328f7b41ea32c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 17:43:55 2012 +0000

    sna: Override sna_fill_spans for PolySegment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b8db54d0fa9eab2610feed6947e917f2e400e1a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 00:21:12 2012 +0000

    sna: Provide a fast path for miZeroLine for PolyLine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 280a9165db5382b93ab449158106bdd5aa7b2329
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 17:43:55 2012 +0000

    sna: Override sna_fill_spans for PolyLine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72fc3122b85fe1a1a16c7f7401c300089273fd88
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 24 01:27:08 2012 +0000

    sna: Prefer to always use span generation for PolyArc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98879e3786b7f6241378a32a10f2d46eb01baf85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 23:22:00 2012 +0000

    sna: Specialise PolyPoint for callback from miZeroPolyArc
    
    miZeroPolyArc may use either FillSpans for PolyPoint to generate its
    curves, so also provide custom point filling routines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b10cb4a5ce84bd677b0a67a17d8674defb19f31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 17:02:46 2012 +0000

    sna: Override sna_fill_spans for PolyArc
    
    This is the missing like that allows the GPU to outperform fbPolyArc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6390a44a69d7f13a3ba16e8b48c640dc39dd227f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 15:57:53 2012 +0000

    sna: Pass the reduce clip region to sna_fill_spans__cpu
    
    Since we compute it for the pixmap migration, we may as well use to
    perform the clipping within FillSpans as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40e3745debe9738362661c7d7f498f3489c28876
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 15:42:18 2012 +0000

    sna: Wrap gc->ops->PolyFillArc
    
    The goal is to avoid the overhead of performing multiple region analysis
    when calling sna_fill_spans by doing it once at the top level and then
    choose the most appropriate drawing method.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55c2211143b3be2827fd4e299c3c211f3bd7935b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 18:15:36 2012 +0000

    sna: Use a streamlined sna_fill_spans for when we know we want to use the gpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b20ae331566e92f1a995f49fd0760f020db25035
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 19:49:18 2012 +0000

    sna: Switch to using spans based on use_wide_spans()
    
    This just gives us a hook with which to conveniently enable or disable
    the new code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41739ff9517ca158d9f7b7ac82e5bacef62a3d68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 15:42:18 2012 +0000

    sna: Wrap gc->ops->FillPolygon
    
    The goal is to avoid the overhead of performing multiple region analysis
    when calling sna_fill_spans by doing it once at the top level and then
    choose the most appropriate drawing method.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aef56b194d4de9bd71ab71e3d93d81e1750262c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 15:38:30 2012 +0000

    sna: Mark GPU bo as busy when drawing to an all-damaged pixmap for core
    
    The fast path to decide whether to use the GPU bo for the core drawaing
    operations forgot to update the active status of the pixmap. This
    included forgetting to clear the is-cleared flag.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c67e6a05ff729c0ddb26775e1c8533be1144d85a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 11:40:13 2012 +0000

    sna: Align the origin of downsampling subregion to an even pixel
    
    In order for us to produce stable downsampled images across multiple
    frames, we need to sample the same pairs of pixels every time. This
    requires us to align the origin of the sample region to an even pixel.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45086
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9267da93969d1727cb95956c3f63643f0039c60d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 11:20:12 2012 +0000

    sna: Apply composite offset to copy-clear GPU path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 803f6558c665c16ba2d20415e778b5bd1d308c2f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 11:05:50 2012 +0000

    sna: Only subtract the fillrect from the CPU damage if it covers the drawable
    
    The idea behind that optimisation is for the inactive pixmap to be
    refreshed and allowed to be transfered back to the GPU when it is
    entirely redrawn. As such performing the subtraction when it does not
    completely remove it only incurs additional overhead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 267493f39137704bd52df65b7605be30d2a062b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 23 10:54:13 2012 +0000

    sna: Assert that the subtract operation does reduce an all-damaged
    
    Somewhere somewhen it appears that I am discarding the all-damaged flag
    on the pointer. The only possibility I can see is for a no-op
    subtraction, so put an assert there just in case the impossible is
    happening.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2908fe2df7b8f870a55fc5856f94ea541a7c7b75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 18:46:57 2012 +0000

    sna: Remove assertion that all flushing list members are in the GPU domain
    
    This may not be true for external buffers that are put on the flushing
    list because they have foreign requests pending.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0bc17c0fa34c9f9243817d1674d1ff235dc99d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 18:27:34 2012 +0000

    sna/gen6: stall before blending dirty pixels from the render cache
    
    Another restriction on the render pipeline, it turns out, is that before
    the blend unit can read back the dst pixels in a subsequent primitive,
    we must stall the pipeline for the completion of that earlier primitive.
    
    This is demonstrated by cacomposite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5aa494305e90eed5df211427741a75380add8e96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 16:10:39 2012 +0000

    sna: Correct the offsets for performing partial downsampling on the GPU
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45086
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7b24bb4342eefb2b23fa40d7c7216c38f2edc09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 15:50:47 2012 +0000

    sna: Correct image buffer size when uploading a downsampled image
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=45086
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 238fc67aa945d5669eccd2a8fe8e98402b9a6223
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 16:04:13 2012 +0000

    sna: Incude prefer-gpu hint in decision to upload CPU textures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeaffb102190a8846c6341e72a4338b41639d679
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 15:52:41 2012 +0000

    sna: Add some more DBG along the downsampling source extraction path
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92badc9c9c2636284af8bc56b098d24ff222f167
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 12:41:31 2012 +0000

    sna: Avoid a common readback after clearing
    
    It is surprisingly common for a pixmap to be created, cleared and then
    used as an upload target or, even worse, as a source for a ShmGetImage.
    In order to prevent this folly, we can trivially track when we clear an
    entire pixmap and its GPU bo and avoid the readback in such cases.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67a166d1247a1197fc851308c33c4970868f6a21
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 13:46:05 2012 +0000

    sna: Pass inplace hint for sna_copy_boxes fallback
    
    In the unlikely event that this makes a difference, provide the hint as
    to when we do not read back from the destination and so a streaming copy
    would be preferable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 77ee92248582d65a03619d1bb1d93a74468eea00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 22 13:42:57 2012 +0000

    sna: Use full usage flags for moving the dst pixmap for a copy
    
    Now that the migration code can decide for itself when to not move
    damage, we can pass the hints to the code rather than perform the
    optimisation in sna_copy_boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd079dd1f64e7832c6343c24958aa9eeb2f58789
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 21 19:38:40 2012 +0000

    sna: Check the blt composite op is within the source bounds
    
    If we attempt to read from a drawable that is partially off its backing
    pixmap (such as a partially offscreen composite window) we need to fixup
    the read from the out-of-bounds regions to return clear. Since we don't,
    the easier answer is to just to switch to the render pipeline for such
    an operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a91c7d85740a5adc25d2a9b1972c367780ce714
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 21 01:18:17 2012 +0000

    sna: Give kgem_create_buffer_2d a unique id
    
    The gen3, among others, backend uses the unique id of a buffer to track
    the currently attached buffer and uses 0 as the invalid value. Linear
    buffers as created by kgem_create_buffer_2d were not being assigned a
    unique id causing mayhem when they were then being passed to the
    backends as render targets and sources. In particular, gen3 did not
    notice the switch in render target and did not emit commands to change
    the GPU target nor attach the buffer to the batch, causing the
    sna_read_boxes to fail and for us to trigger an assertion for an
    uncomsumed read buffer.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42718
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d21e80433f2574fe96036ad1d563515406a1946f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 21 01:17:39 2012 +0000

    sna/gen3: Add DBG markup for tracking target state
    
    In particular for when we switch to a new destination and mark it dirty.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20006a9ae7f993f02c45ccbc1e414d74bfee3acd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 22:17:44 2012 +0000

    sna: Cleanup PolyText and ImageText fallback debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fbd7cafb4394e0641565dc794b82bef615b4aac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 22:16:53 2012 +0000

    sna: Copy the glyphs metrics before checking for an empty glyph
    
    The empty glyph still needs the correct advance, and copying it too late
    left it as zero and so we were collapsing spaces in PolyText8 and
    friends.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0d8f5d377460bb7da82546e8304252312e97147
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 14:34:28 2012 +0000

    sna/gen3: Set bo to NULL for render_fill_one
    
    It had to happen, I missed one! From fc9531fc2df.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0286ddbd67d3b2585ffa3deccb7eeb674cd7a3e0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 11:33:05 2012 +0000

    sna/gen6: Cleanup non-pipelined w/a
    
    Move the workaround CS stall into the emit drawrect which is the only
    non-pipelined op we emit. This removes the split between deciding
    whether we will emit a drawrect and actual emission.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0c4024e32ccab70e7f7893896d30c80ad9f4240
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 09:42:18 2012 +0000

    sna/gen6: Do not enable blending on video sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bbbda4c408c2576927582097f7cd4f606b1761fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 09:40:04 2012 +0000

    sna/gen6: Reduce the sampler stall if already stalling for drawrect
    
    If we are force to emit a stall for the non-pipelined workaround, we do
    not then need to emit a stall for switching samplers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e91601278a057f70df76b74539ff4f80d203bf00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 20 01:37:29 2012 +0000

    sna/gen6: Force a CS stall for changing samplers
    
    On closer inspection, we still need the workaround of forcing a pipeline
    stall if we update the samplers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc9531fc2df12b896e6d9e8b3f0d7248e55bfcdd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 21:15:35 2012 +0000

    sna: Move the flush to the backends
    
    This allows us to implement backend specific workarounds and use the
    more appropriate device specific flushing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e0a534a888c59b921fd4cad69b980c6eda72212
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 18:52:35 2012 +0000

    sna/gen7: Forward port recent changes from gen6
    
    Fixes for resubmitting batches after running out of space for vertex
    buffers and also a couple of trivial spans functions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5caf806d42a1909ff3a7716d8bc592fa68a02377
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 17:33:25 2012 +0000

    sna: BLT use dword pitch only for tiled surfaces
    
    The gen4+ spec is a little misleading as states that all BLT pitches for
    the XY commands are in dwords. Apparently not, as the upload/download
    functions were already demonstrating. This only became apparent when
    accelerating core text routines to offscreen pixmaps, such as composited
    windows.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbc75532d5f6a10e9fc7cfe3634d5a0db7304a99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 14:36:32 2012 +0000

    sna: Tweak move-to-cpu to ignore inplace hint if its already on the CPU
    
    If we test the area to be drawn against the existing CPU damage and find
    it is already on the CPU, we may as well continue to utilize that
    damaged region.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ad4a0c9423ee7f4041173c428b07ac4af312fe1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 11:15:38 2012 +0000

    sna: Only use the blitter to emit wide spans if we cannot stream the updates
    
    If either the region is busy on the gpu or if we need to read the
    destination then we would incur penalties for trying to perform the
    operation through the GTT. However, if we are simply streaming pixels to
    an unbusy bo then we can do so inplace faster than computing the
    corresponding GPU commands and uploading them.
    
    Note: currently it is universally slower to use the GPU here (the
    computation of the spans is too slow). However that is only according to
    micro-benchmarks, avoiding the readback is likely to be more efficient
    in practice.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9db6b9fad808175184849f3030862ea115ef0708
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 11:54:14 2012 +0000

    sna: Also check for the inplace hint when migrating the whole pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3f7d5d614748306cc376d1929da2bbc14494a6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 11:15:38 2012 +0000

    sna: Only use the blitter to emit spans if we cannot stream the updates
    
    If either the region is busy on the gpu or if we need to read the
    destination then we would incur penalties for trying to perform the
    operation through the GTT. However, if we are simply streaming pixels to
    an unbusy bo then we can do so inplace faster than computing the
    corresponding GPU commands and uploading them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff2eb116ef85182eea9ed06daaa1e9a4f7bdbad3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 00:56:07 2012 +0000

    sna: Micro-optimise line extents for zero line width
    
    Handling zero line widths is the common case, so avoid the extra work.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c010745076204ed3b66e947c9eab6de84f670fe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 09:46:52 2012 +0000

    sna: filter out degenerate segments whilst drawing unclipped PolySegment
    
    The damage layer was detecting that we were asking it to accumulate a
    degenerate box emanating from PolySegment, as the unclipped paths made
    the fatal assumption that it would not need to filter out degenerate
    boxes. However, a degenerate line becomes a point, does the same apply
    to a degenerate segment?
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35f81005f91d294e61bb4ced7cbddd1a76ccb324
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 00:41:08 2012 +0000

    sna/damage: Always mark the damage as dirty when recording new boxes
    
    A few of the create_elts() routines missed marking the damage as dirty
    so that if only part of the emebbed box was used (i.e. the damage
    contained less than 8 rectangles that needed to included in the damage
    region) then those were being ignored during migration and testing.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44682
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 36e691ea900d7979950c19714e15c5887d3ea039
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 00:39:28 2012 +0000

    sna: Demote MOVE_READ if the GC operation covers the clip
    
    If the write operation fills the entire clip, then we can demote and
    possible avoid having to read back the clip from the GPU provided that
    we do not need the destination data due to arithmetic operation or mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17efdbc48c964d9d7b0af630c13a6ceb62fb1787
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 19 00:36:52 2012 +0000

    sna: Clip damage area with source extents for fallback
    
    The damage tracking code asserts that it only handles clip regions.
    However, sna_copy_area() was failing to ensure that its damage region
    was being clipped by the source drawable, leading to out of bounds reads
    during forced fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb07243c9a08b24e2dc03b86dc16d3cd72cbfcba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 21:30:34 2012 +0000

    sna: Fine grained fallback debugging for core drawing routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05f9764a8860cbdd7ea2ce7f04c221ec8481e0bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 21:29:45 2012 +0000

    sna/damage: Fast path singular regions
    
    Mainly for consistency, so that we treat it like the other damage
    addition functions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96529e345d0718d253e4abfa0a02cd1f9f7c0406
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 21:05:40 2012 +0000

    sna: Make sure we create a mappable GPU bo when streaming writes
    
    If we decide to do the CPU fallback inplace on the GPU bo through a WC
    mapping (because it is a large write-only operation), make sure that
    the new GPU bo we create is not active and so will not^W^W is less likely
    to cause a stall when mapped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efce896e1dbab6177a773a7cf1c8eaf2dab0cdee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 20:53:55 2012 +0000

    sna: Check number of boxes to migrate during move-to-cpu
    
    When reducing the damage we may find that it is actually empty and so
    sna_damage_get_boxes() returns 0, be prepared.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 334f3f70a8b4372cb089773ecded8339d2c7d984
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 20:09:26 2012 +0000

    sna/gen3: Set the batch mode for emitting video state
    
    The lack of kgem_set_mode() here is causing some recently added
    assertions to fail.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76203b70708b8750f52348ea8b9135191e650ff7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 18:36:43 2012 +0000

    sna: Almagamate writes based on the total number of bytes written
    
    Cachelines will only be dirtied for the bytes accessed so a better
    metric would based on the total number of pages brought into the TLB
    and the total number of cachelines used. Base the decision on whether
    to try and amalgamate the upload with others on the number of bytes
    copied rather than the overall extents.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 470741e84c813a257897ee69f14500207a2674dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 18:35:59 2012 +0000

    sna: Debug uploads
    
    All of the asserts and debug options that lead me to believe that the
    tiling was completely screwy for some writes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab387a89cf64ace9f7d7fa52b7743e78b625f47d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 18:32:51 2012 +0000

    sna: Update bo->tiling during search_linear_cache
    
    search_linear_cache() was updated to track the first good match whilst it
    continued to search for a better match. This resulted in the first good
    bo being modified and a record of those modifications lost, in
    particular the change in tiling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b893ab0812452238305b29b1beea224219f641d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 16:34:17 2012 +0000

    sna: Remove defunct debugging option
    
    FORCE_GPU_ONLY now has no effect except for marking the initial pixmap
    as all-damaged on the GPU, and so not testing the paths for which it was
    originally introduction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 965586544a8559b6b6b98c20e14c1266e46bf20d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 16:11:50 2012 +0000

    sna/gen6: Don't assume that a batch mode implies a non-empty batch
    
    Just in case we set a mode then fail to emit any dwords. Sounds
    inefficient and woe betide the culprit when I find it...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2e05750360fb19575f3becd87816184615855bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 16:08:51 2012 +0000

    sna: Fix some tracking of to-be-flushed dri pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ad5320fd40eaaf0bffcd209bf1eabd9a20e4bf8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 15:39:35 2012 +0000

    sna: Add valgrind markup for tracking CPU mmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3da610eadd1f560812603ab1a72c2e173679689
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 12:59:48 2012 +0000

    sna: Prevent switching rings with render disabled
    
    We fudge forced used of the BLT ring unless we install a render backend
    and so we must also prevent the ring from being reset when the GPU is
    idle. Therefore we make handing the ring status a backend function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d31cb2d943be456f4ebaa663275c6a939013d9e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 11:25:30 2012 +0000

    sna: Restore use of shadow pixmaps by default without RENDER support
    
    If we do not have access to an accelerated render backend, only create
    GPU buffers for the scanout and use an accelerated blitter for
    upload/download and operating inplace on the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15a150579c3907054e186c68382873efdbadca75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 18 10:26:33 2012 +0000

    intel: Trivially remove a piece of XAA dependency for shadow
    
    The wolves are gathering at the door baying for the removal of XAA from
    Xorg.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 850495f956c811b1eb617d2e704e6bb7b5a86369
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 22:51:29 2012 +0000

    sna: Fix increment of damage boxes after updating for rectangles
    
    Found by valgrind:
    ==13639== Conditional jump or move depends on uninitialised value(s)
    ==13639==    at 0x5520B1E: pixman_region_init_rects (in
    /usr/lib/x86_64-linux-gnu/libpixman-1.so.0.24.0)
    ==13639==    by 0x89E6ED7: __sna_damage_reduce (sna_damage.c:489)
    ==13639==    by 0x89E7FEC: _sna_damage_contains_box (sna_damage.c:1161)
    ==13639==    by 0x89CFCD9: sna_drawable_use_gpu_bo (sna_damage.h:175)
    ==13639==    by 0x89D52DA: sna_poly_segment (sna_accel.c:6130)
    ==13639==    by 0x21F87E: damagePolySegment (damage.c:1096)
    ==13639==    by 0x1565A2: ProcPolySegment (dispatch.c:1771)
    ==13639==    by 0x159FB0: Dispatch (dispatch.c:437)
    ==13639==    by 0x1491D9: main (main.c:287)
    ==13639==  Uninitialised value was created by a heap allocation
    ==13639==    at 0x4028693: malloc (in
    /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==13639==    by 0x89E6BFB: _sna_damage_create_boxes (sna_damage.c:205)
    ==13639==    by 0x89E78F0: _sna_damage_add_rectangles (sna_damage.c:327)
    ==13639==    by 0x89CD32D: sna_poly_fill_rect_blt.isra.65
    (sna_damage.h:68)
    ==13639==    by 0x89DE23F: sna_poly_fill_rect (sna_accel.c:8366)
    ==13639==    by 0x21E9C8: damagePolyFillRect (damage.c:1309)
    ==13639==    by 0x26DD3F: miPaintWindow (miexpose.c:674)
    ==13639==    by 0x18370A: ChangeWindowAttributes (window.c:1553)
    ==13639==    by 0x154500: ProcChangeWindowAttributes (dispatch.c:696)
    ==13639==    by 0x159FB0: Dispatch (dispatch.c:437)
    ==13639==    by 0x1491D9: main (main.c:287)
    ==13639==
    
    Use 'count' everywhere for consistency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b5c9affd4968fd5b3d85551cf5a0b4d600a7892
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 20:23:26 2012 +0000

    sna: Restore orginal shadow pointer before uploading CPU damage
    
    Detected by valgrind:
    ==22012== Source and destination overlap in memcpy(0xd101000, 0xd101000,
    783360)
    ==22012==    at 0x402A180: memcpy (in
    /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
    ==22012==    by 0x89BD4ED: memcpy_blt (blt.c:209)
    ==22012==    by 0x89F2921: sna_write_boxes (sna_io.c:364)
    ==22012==    by 0x89CFABF: sna_pixmap_move_to_gpu (sna_accel.c:1900)
    ==22012==    by 0x89F49B0: sna_render_pixmap_bo (sna_render.c:571)
    ==22012==    by 0x8A268CE: gen5_composite_picture (gen5_render.c:1908)
    ==22012==    by 0x8A29B8A: gen5_render_composite (gen5_render.c:2252)
    ==22012==    by 0x89E6762: sna_composite (sna_composite.c:485)
    ==22012==    by 0x21D3C3: damageComposite (damage.c:569)
    ==22012==    by 0x215963: ProcRenderComposite (render.c:728)
    ==22012==    by 0x159FB0: Dispatch (dispatch.c:437)
    ==22012==    by 0x1491D9: main (main.c:287)
    ==22012==
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bbd6c8123635899e89911104bf84e1b7d11d66a1
Author: Eugeni Dodonov <eugeni.dodonov@intel.com>
Date:   Tue Jan 17 16:16:37 2012 -0200

    sna: check for LLC support
    
    Instead of checking for CPU generation, use the libdrm-provided
    I915_PARAM_HAS_LLC instead.
    
    v2: use a define check to verify if we have I915_PARAM_HAS_LLC.
    
    Signed-off-by: Eugeni Dodonov <eugeni.dodonov@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4efde920bcab980451e79df7d645d1814e5f78d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 13:44:12 2012 +0000

    sna: Track whether damage is a complete representation of the dirt
    
    The previous commit undoes a premature optimisation that assumed that
    the current damage captured all pixels written. However, it happens to
    be a useful optimisation along that path (tracking upload of partial
    images), so add the necessary booking that watches for when the union
    of cpu and gpu damage is no longer the complete set of all pixels
    written, that is if we either migrate from one pixmap to the other, the
    undamaged region goes untracked. We also take advantage of whenever we
    damage the whole pixel to restore knowledge that our tracking of all
    pixels written is complete.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9b705f9a7bbd37a0543ce5fbd4c60c912d1017d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 12:58:43 2012 +0000

    sna: Mark GPU as all-damaged discarding the CPU bo to prevent stalls
    
    If we discard the CPU bo, we lose knowledge of whatever regions had been
    initialised but no longer dirty on the GPU, but instead must assume that
    the entirety of the GPU bo is dirty.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d631e26d758eb4c2032a502604f07c5403b25ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 12:58:03 2012 +0000

    sna: Mark the freshly allocated CPU bo as in the CPU domain
    
    As we immediately use it after creation, we need to inform GEM of the
    domain transfer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfbf02b8778719b86e0f5d78ee833a19436d43a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 10:55:29 2012 +0000

    sna: Add some DBG breadcrumbs to put_image upload paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da90afc32f19e9168cbaa4e0cdcd941d12f2c142
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 10:24:06 2012 +0000

    sna: Add DBG breadcrumbs to gradient initialisation
    
    Put some markers into the debug log as those functions create many
    proxies causing a lot of debug noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d14341cb22e37f52070cd92b707fec5e08038e96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 00:31:43 2012 +0000

    sna: Add a render ring detiling read path
    
    For SNB, in case you really, really want to use GPU detiling and not
    incur the ring switch. Tweaking when to just mmap the target seems to
    gain most anyway...
    
    The ulterior motive is that this provides fallback paths for avoiding
    the use of TILING_Y with GTT mmaps which is broken on 855gm.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3620f9ca459f7bbbb01786c95b5583023b6d870c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 00:23:04 2012 +0000

    sna: Cap pwrite buffer alignment to 64k
    
    We only want to create huge pwrite buffers when populating the inactive
    cache for mmapped uploads. In the absence of using mmap for upload, be
    more conservative with the alignment value so as not to simply waste
    valuable aperture and memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9f59b1099eeba3fb8b25693d4f37dd13267d8a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 17 00:20:51 2012 +0000

    sna: correct adjust of a stolen 2d read buffer
    
    If we steal a write buffer for creating a pixmap for read back, then we
    need to be careful as we will have set the used amount to 0 and then try
    to incorrectly decrease by the last row. Fortunately, we do not yet have
    any code that attempts to create a 2d buffer for reading.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fc4cdafeba4517b94202ff292f05fdd90e52b2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 21:34:43 2012 +0000

    sna: Correct assertion for a partial read buffer
    
    The batch may legitimately be submitted prior to the attachment of the
    read buffer, if, for example, we need to switch rings. Therefore update
    the assertion to only check that the bo remains in existence via either
    a reference from the exec or from the user
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 377f5e16cd14bdf42e67b0c8f2e13b75526f3a85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 15:51:33 2012 +0000

    sna/gen[45]: clear the state tracker before setting the formats
    
    When backporting the patches from gen6, I didn't notice the memset that
    came later, and this wasn't along the paths checked by rendercheck.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6387f2fb8a40f32cc4a3e4228983dcf0604ac4dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 14:12:36 2012 +0000

    sna/gen[4567]: x1r5g5b5 is only a render target, not sampler
    
    Whilst we can render to and blend with an depth 15 target, we cannot use
    it as a texture with the sampling engine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b2bb666662305ab88aad8198ad69b1c98407d75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 13:35:05 2012 +0000

    sna/gen6: Restore the non-pipelined op after every WM binding table update
    
    The hw wants it as demonstrated by the '>' in KDE's menus. Why is it
    always KDE that demonstrates coherency problems...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a11b22d172898ebfc657339a9ca56102ae92592f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 13:06:58 2012 +0000

    sna/gen[23]: Remark the destination bo as dirty after flushing
    
    One of the side-effects of emitting the composite state is that it
    tags the destination surface as dirty as a result of the *forthcoming*
    operation. So emitting the flush after emitting the composite state
    clears that tag, so we need to restore it for future coherency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f09363a6e2c77fb23bf0e4c12c4507521fa631b
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Thu Jan 12 15:30:15 2012 +0800

    uxa/glamor: Create glamor pixmap by default.
    
    When creating native glamor pixmaps we will get much better performance
    than using the textured-drm pixmap, this commit is to make that the
    default behaviour when configured to use glamor. Another advantage
    of this commit is that  we reduce the risk of encountering the
    "incompatible region exists for this name" and the associated
    render corruption. And since we now never intentionally allocate
    a reusable pixmap we could just make all (intel_glamor) allocations
    non-reusable without incurring too great an overhead.
    
    A side effect is that those glamor pixmaps do not have a
    valid BO attached to them and thus it fails to get a DRI drawable. This
    commit also fixes that problem by adjusting the fixup_shadow mechanism
    to recreate a textured-drm pixmap from the native glamor pixmap. I tested
    this with mutter, and it works fine.
    
    The performance gain to apply this patch is about 10% to 20% with
    different workload.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd4c139a3959df90c7f078817fc6e2f3db715bf8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 16 00:32:12 2012 +0000

    sna: On LLC systems quietly replace all linear mmappings using the CPU
    
    If the GPU and CPU caches are shared and coherent, we can use a cached
    mapping for linear bo in the CPU domain with no penalty and so avoid the
    penalty of using WC/UC mappings through the GTT (and any aperture
    pressure). We presume that the bo for such mappings are indeed LLC
    cached...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c20a729d0a57fd5a782d9114535d9474f39a8950
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 22:19:22 2012 +0000

    sna/gen6: Force a batch submission after allocation failure during composite
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 380a2fca3cce4c99c5026ab800f7885a1959b16d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 22:13:20 2012 +0000

    sna: Optimise call to composite with single box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f89250de1dc134f54cb68012fa5eb996c61d57e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 21:54:13 2012 +0000

    sna: Use the prefer-GPU hint for forcing allocation for core drawing
    
    Similar to the render paths and simpler than the current look up tiling
    method.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8652bf7a196f53842db70f5c70aded31b470b0ab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 19:04:01 2012 +0000

    sna: Don't track an unmatching tiled bo when searching the linear cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc4b616990fa71e96d38512d8cdb4c3e2abb21c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 19:55:50 2012 +0000

    sna/video: Increase the level of paranoia
    
    In how many different ways can we check that the scanout is allocated
    before we start decoding video?
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f480ba02c66fcc02bad483731c4c0cf6c746c0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 18:45:06 2012 +0000

    sna: Tidy search through active bo cache
    
    Perform the assertions upon cache consistency upfront, and tidy the
    indentation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f7bc35d7f956f7c2507eabc874ead1a83c85ddb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 18:14:24 2012 +0000

    sna: Use indirect uploads rather than teardown existing CPU maps
    
    Allow the snoopable CPU mapping to be used inplace of the GTT map for
    untiled bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 475fa67ed320f94df37ec86fe6c5dda886923751
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 17:30:00 2012 +0000

    sna: Fast path move-area-to-cpu when the pixmap is already on the cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37ced44a53008debaf869ec9ef4ba2e5d6982e76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 15:35:57 2012 +0000

    sna: Be a little more lenient wrt damage migration if we have CPU bo
    
    The idea being that they facilitate copying to and from the CPU, but
    also we want to avoid stalling on any pixels help by the CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3732a6f7f61a959521be9a668bba045591e633c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 11:06:59 2012 +0000

    sna: Defer ring switching until after a period of idleness
    
    Similar to the desire to flush the next batch after an overflow, we do
    not want to incur any lag in the midst of drawing, even if that lag is
    mitigated by GPU semaphores.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5df7147b0934dadc63459c2c0f33e0663692425a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 10:28:00 2012 +0000

    sna: Restore the kgem_create_map() symbol
    
    As the stub is exported to the driver even in the absence of vmapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be53740c6f0bb182e3d88f0597f127732c839316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 10:16:13 2012 +0000

    sna: Various DBG typos
    
    Fix some mispellings inside the DBG messages
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 349e9a7b94199e759acaaccac3abf5e28f3c246f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 10:04:11 2012 +0000

    sna: Prefer read-boxes inplace again
    
    Using the gpu to do the detiling just incurs extra latency and an extra
    copy, so go back to using a fence and GTT mapping for the common path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09dc8b1b358aa33836d511b75f92e8d096bc7e59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen7: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9871f01d8c4584c1f39eb09b51d5461863934e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen6: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d6030322e2c3bae87a0173a32fb8d341dea560c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen5: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e4a24ef6c186909c99a501cb606994b5c10a813
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen4: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea299f2523d5adeca84274bb7003cde8ec743a44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen3: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 007da2f97894814eaded4d24e0481f950ca7bd00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:21:29 2012 +0000

    sna/gen2: Check reused source for validity
    
    Be sure the mask picture has a valid format even though it points to the
    same pixels as the valid source. And also be wary if the source was
    converted to a solid, but the mask is not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d55b42fbd77e85ab8930b78bb5a9e3bccbca49e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:44:23 2012 +0000

    sna: Fix read back of partial mmapped buffers
    
    Do not move a GTT mapped buffer into the CPU domain, it causes untold
    pain for no benefit!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 046e945173397e5fee36a231303b68a6bc9d809d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 23:25:52 2012 +0000

    sna: Discard read buffers after use
    
    Rather than pollute the cache with bo that are known not to be in the
    GTT and are no longer useful, drop the bo after we read from it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 421ee0bb53321e9fb2f17c850c51b80cc385bf57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 15 00:46:47 2012 +0000

    sna: Do not assume that the mappable aperture size is a power of two
    
    And instead derive a power-of-two alignment value for partial buffer
    sizes from the mappable aperture size and use that during
    kgem_create_buffer()
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44682
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d5da35c9fab4e7154921861ecbb83befb8840e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 18:28:24 2012 +0000

    sna/gen[23]: Check for room in the batch before emitting pipeline flushes
    
    Use a single idiom and reuse the check built into the state emission,
    for both spans/boxes paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7e4799687d5010ea0b56aeb6fbbb2e854b1b363
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 16:53:38 2012 +0000

    sna/gen6: Allow greater use of BLT
    
    Typically we will be bound to the RENDER ring as once engaged we try not
    to switch. However, with semaphores enabled we may switch more freely
    and there it is advantageous to use as much of the faster BLT as is
    feasible.
    
    The most contentious point here is the choice of whether to use BLT for
    copies by default. microbenchmarks (compwinwin) benefit from the
    coallescing performed in the render batch, but the more complex traces
    seem to prefer utilizing the blitter. The debate will continue...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1ce34d4509a3f3e963d82ac0569a21706892f8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 15:08:18 2012 +0000

    sna/gen6: Tidy markup for when using the BLT is truly preferrable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b64751dbdb1b88b91ad97aaf995b4261876cf860
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 13:50:50 2012 +0000

    sna: Be more lenient wrt switching rings if the kernel supports semaphores
    
    If the kernel uses GPU semaphores for its coherency mechanism between
    rings rather than CPU waits, allow the ring to be chosen on the basis
    of the subsequent operation following a submission of batch. (However,
    since batches are likely to be submitted in the middle of a draw, then
    the likelihood is for ddx to remain on one ring until forced to switch
    for an operation or idle, which is the same situation as before and so
    the difference is miniscule.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 295a22d2709b2442b5254968437f897dac22a0ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 14:12:25 2012 +0000

    sna: Ensure that the batch mode is always declared before emitting dwords
    
    Initially, the batch->mode was only set upon an actual mode switch,
    batch submission would not reset the mode. However, to facilitate fast
    ring switching with semaphores, reseting the mode upon batch submission
    is desired which means that if we submit the batch in the middle of an
    operation we must redeclare its mode before continuing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d2a50772200d868d094f90dc1d30c1b4d7930ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 11:03:55 2012 +0000

    sna/glyphs: Cache the glyph image on the fallback path as well
    
    The glyph cache grew to accommodate the fallback pixman image for mask
    generation, and is equally applicable along the full fallback path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3e0ba4f65db2b85f89aa3868d153434bc41c811
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 10:17:27 2012 +0000

    sna/gen5: Disable render glyphs_to_dst
    
    Processing more than a single rectangle using the CA path on ILK is
    extremely hit-or-miss, often resulting in the absence of the second
    primitive (ie. the glyphs are cleared but not added.) This is
    reminiscent of the complete breakage of the BRW shaders, none of which
    can handle more than a single rectangle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb92818ba4dc81ce62d58a87b5af6cb1e3a96708
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 01:48:11 2012 +0000

    sna: Pass render operation to flush and avoid the implicit flush-on-batch-end
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a62429a1f79b8fa4a5ddaf61b2bc80fc8dbe576c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 19:00:01 2012 +0000

    sna: Upload continuation vertices into mmapped buffers
    
    In the common case, we expect a very small number of vertices which will
    fit into the batch along with the commands. However, in full flow we
    overflow the on-stack buffer and likely several continuation buffers.
    Streaming those straight into the GTT seems like a good idea, with the
    usual caveats over aperture pressure. (Since these are linear we could
    use snoopable bo for the architectures that support such for vertex
    buffers and if we had kernel support.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24df8ab9742f771cfeb6d30bd8a61a17a9e22ca7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 16:15:21 2012 +0000

    sna: Reverse the chronological sort order of inactive vma entries
    
    The goal is to reuse the most recently bound GTT mapping in the hope
    that is still mappable at the time of reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f26bbe3dd55bfe26b6f93fc1f9e9813fc11f7c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 15:59:51 2012 +0000

    sna: Remove the short-circuiting of all-damage in move_to_cpu
    
    To allow a replacement of the complete pixmap to be performed in place.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c81dba18e6a308d716a11b90da6e53ca7f5f8a02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 14:21:13 2012 +0000

    sna: Hint whether we prefer to use the GPU for a pixmap
    
    This includes the condition where the pixmap is too large, as well as
    being too small, to be allocatable on the GPU. It is only a hint set
    during creation, and may be overridden if required.
    
    This fixes the regression in ocitysmap which decided to render glyphs
    into a GPU mask for a destination that does not fit into the aperture.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2bd942d55314426d7f429d7ccc0b62a622a79009
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 14:08:34 2012 +0000

    sna/trapezoids: Quieten the debugging of the gory details of the rasteriser
    
    Hide the noise under another level of debugging so that hopefully the
    reason why it chose a particular path become clear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5dbcfc2ee3af64846298dbcb20db27c93b3d57f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 13:52:10 2012 +0000

    sna: Be more lenient in not forcing to the GPU if the sources have CPU damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20ff4a1d73cc10e1f53050b19b8799ccbb5c7d04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 13:30:13 2012 +0000

    sna: Use top_srcdir to detect .git rather than top_builddir
    
    For srcdir != builddir builds, we need to be searching the source tree
    for the git id.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4d5d725996b94e314ae7697c7a597ed2f60e8cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 10:41:44 2012 +0000

    sna: Experiment with GTT mmapped upload buffers
    
    In a few places, we can stream the source into the GTT and so upload in
    place through the WC mapping. Notably, in many other places we want to
    rasterise on a partial in cacheable memory. So we need to notify the
    backend of the intended usage for the buffer and when we think it is
    appropriate we can allocate a GTT mapped pointer for zero-copy upload.
    
    The biggest improvement tends to be in the PutComposite style of
    microbenchmark, yet throughput for trapezoid masks seems to suffer (e.g.
    swfdec-giant-steps on i3 and gen2 in general). As expected, the culprit
    of the regression is the aperture pressure causing eviction stalls, which
    the pwrite paths sidesteps by doing a cached copy when there is no GTT
    space. This could be alleviated with an is-mappable ioctl predicting when
    use of the buffer would block and so falling back in those cases to
    pwrite. However, I suspect that this will improve dispatch latency in
    the common idle case for which I have no good metric.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 252f3818250ecf4776f20afa8111d7f1f6f29c18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 11:30:32 2012 +0000

    sna: Relinquish the GTT mmap on inactive buffers if moved out of the aperture
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c73dd91e90810116c215060bac434c5e8174f5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 14 17:00:01 2012 +0000

    Include <xorgVersion.h> to repair build
    
    intel_module.c:41:48: error: missing binary operator before token "("

commit b213f6e876f29cbcaccffeeb733726be4c91529e
Author: Stefan Dirsch <sndirsch@suse.de>
Date:   Sat Jan 14 05:43:33 2012 +0100

    Make driver backwards compatible for server 1.6.x.
    
    Signed-off-by: Stefan Dirsch <sndirsch@suse.de>

commit 94217a4dd908f1368dfdef90797ce74a081663fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 10:03:28 2012 +0000

    sna: Decouple dirty pixmaps from list if we fail to upload them
    
    Rather than iterate endlessly trying to upload the same pixmap when
    failing to flush dirty CPU damage, try again on the next flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65ef369c733ab45945a7d5fe4b76fe5c7167b51b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 13 09:58:40 2012 +0000

    sna: Decouple from CPU dirty list after removing all CPU damage
    
    In the paths where we discard CPU damage, we also need to remove it
    from the dirty list so that we do not iterate over it during flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0845fcef9e664eb100b55ad1cc20743844deee58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 23:45:03 2012 +0000

    sna: Correct iteration counter for stippled blits
    
    ==7215== Invalid read of size 2
    ==7215==    at 0x51A72F3: sna_poly_fill_rect_stippled_8x8_blt
    (sna_accel.c:7340)
    ==7215==    by 0x51A9CDF: sna_poly_fill_rect_stippled_blt
    (sna_accel.c:8163)
    ==7215==    by 0x51A3878: sna_poly_segment (sna_accel.c:6090)
    ==7215==    by 0x216C02: damagePolySegment (damage.c:1096)
    ==7215==    by 0x13F6E8: ProcPolySegment (dispatch.c:1771)
    ==7215==    by 0x1436B4: Dispatch (dispatch.c:437)
    ==7215==    by 0x131279: main (main.c:287)
    ==7215==  Address 0x6f851e8 is 0 bytes after a block of size 32 alloc'd
    ==7215==    at 0x4825DEC: malloc (vg_replace_malloc.c:261)
    ==7215==    by 0x51A3558: sna_poly_segment (sna_accel.c:6049)
    ==7215==    by 0x216C02: damagePolySegment (damage.c:1096)
    ==7215==    by 0x13F6E8: ProcPolySegment (dispatch.c:1771)
    ==7215==    by 0x1436B4: Dispatch (dispatch.c:437)
    ==7215==    by 0x131279: main (main.c:287)
    
    An example being the stippled outline in gimp, the yellow marching ants,
    would randomly walk over the entire image.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c2c6474efd4dbc5a0fc9c68ef4e5b5e5cfee415
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 23:11:05 2012 +0000

    sna/dri: Hook up a compile option to switch colour buffers to Y-tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59b79e5952fdc40f8c50f74a72a19363cb426140
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 21:05:39 2012 +0000

    sna: Reorder composite-done to destroy mask bo before source bo
    
    Just in the unlikely event that we hit the delete-partial-upload path
    which prefers destroying the last bo first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 983b755313df8a0d256c59c32ec4106e35f237aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 21:05:16 2012 +0000

    sna/damage: Fix union of extents with dirty damage but no region
    
    By failing to account for certain paths which would create a damage elt
    without fully initialisating the damage region (only the damage extents),
    we would later overwrite the damage extents with only the extents for
    this operation (rather than the union of this operation with the current
    damage). This fixes a regression from 098592ca5d,
    (sna: Remove the independent tracking of elts from boxes).
    
    Include the associated damage migration debugging code of the callers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d2f1eefe142b65db7d8821ba0f80fdb0902b2d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 21:08:41 2012 +0000

    sna: Pass a hint that we may like to perform the fallback in place
    
    If we do not read back from the destination, we may prefer to utilize a
    GTT mapping and perform the fallback inplace. For the rare event that we
    wish to fallback and do not already have a shadow...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48ab72754d0069a3247c5fee8c353a6b593eaed9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 21:07:15 2012 +0000

    sna: Use the GPU bo if it is all damaged
    
    By marking the scratch upload pixmap as damaged in both domains, we
    confused the texture upload path and made it upload the pixmap a second
    time. If either bo is all-damaged, use it!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20a4d7181983c7fed289844be49ccaf3f56965c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 21:05:51 2012 +0000

    sna: Dump batch contents for debugging before modification
    
    We need to dump the batch contents before the maps are made by the
    construction of the batch itself.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7932a2a259069bb7d19af8566f7b7704f6c2eade
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 14:06:22 2012 +0000

    sna: Update for removal of backwards compatible miWideDash
    
    miWideDash() no longer calls miZeroLineDash() when called with
    gc->lineWidth==0, we need to do so ourselves.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7cefddd467bfd0c100219969712a0133475004c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 13:17:43 2012 +0000

    sna: Re-enable min-alignment workaround on pre-SNB hw
    
    Confirmed as still being required for both gen3 and gen4. One day I will
    get single-stream mode working, just not today apparently.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 978e1aeceab3c1a524f7d7a070fe04f37530c8d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 11:38:56 2012 +0000

    sna: Only shrink a partial buffer if it is no longer used.
    
    The condition on being able to shrink a buffer is more severe than just
    whether we are reading from the buffer, but also we cannot swap the
    handles if the existing handle remains exposed via a proxy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3169154d18600e0d41db5f833fad52970e17b55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 11:36:05 2012 +0000

    sna: Improve a DBG message
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a22990968aebd53a7bfeaf19e58ee609b980e5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 11:22:06 2012 +0000

    sna: Prevent 60Hz wakeups if the client stops in mid-render
    
    Only continue to wake up if the scanout remains active.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c0e9916caef6594511009c8cb79071ac0d82090
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 11:12:56 2012 +0000

    sna: Align the partial buffer contents to cachelines
    
    To enable Daniel's faster pwrite paths. Only one step removed from using
    whole page alignment...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e4080318f58fd51f37792eefd367e2e4c813ea3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 10:47:19 2012 +0000

    sna: Replace the open-coded bubble sort of the partial list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7290ced5791f9860b00901fa9a4545ab5a067fae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 02:59:43 2012 +0000

    sna/video: Fix for changes in damage api
    
    We can avoid both calls to modify the damage with one simple check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87e6dcb3b06c274ecba5de56d4e86fec73e46dbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 02:09:22 2012 +0000

    sna: Don't call RegionIntersect for the trivial PutImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1bd6665093574372248a0743e5630e68aac653ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 01:37:08 2012 +0000

    sna: Disable the min alignment workaround
    
    Allow all generations to use the minimum alignment of 4 bytes again as
    it appears to be working for me... Or at least what remains broken seems
    to be irrespective of this alignment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 112b8959261712aaa82f92af0aca4b97fa7c7f03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 01:38:18 2012 +0000

    sna: Prevent shrinking a partial buffer stolen for a read
    
    If we reuse a partial buffer for a read, we cannot shrink it during
    upload to the device as we do not track how many bytes we actually need
    for the read operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b09ae4c20313fea7af11f77cd673039635d4dcc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 12 00:58:08 2012 +0000

    sna: Don't drop expired partial bo immediately, wait until dispatch
    
    As the partial bo may be coupled into the execlist, we may as well hang
    onto the memory to service the next partial buffer request until it
    expires in the next dispatch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3c42565a8f557b2e7f7ff7bfa45b13b606f2968
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 16:39:45 2012 +0000

    sna: Store damage-all in the low bit of the damage pointer
    
    Avoid the function call overhead by inspecting the low bit to see if it
    is all-damaged already.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c64a9d0683e047a7eb041df78db746f6dd387b5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 19:51:42 2012 +0000

    sna: Choose a stride for the indirect replacement
    
    Don't blithely assume that the incoming bytes are appropriately aligned
    for the destination buffer. Indeed we may be replacing the destination
    bo with the shadow bytes out of another,larger, pixmap, in which case we
    do need to create a stride that is appropriate for the upload an
    perform the 2D copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b82851e74d5010ee08938ee42fa44c29fed633b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 15:42:00 2012 +0000

    sna: Mark upload pixmaps as being wholly GPU damaged
    
    So that subsequent code resists performing CPU operations with them
    (after they have been populated.)
    
    Marking both sides as wholly damaged breaks the rules, but should work
    out so long as we check whether we can perform the operation within the
    target damage first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a5ab05f1690484c230e8f876a3f7aefb371af71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 15:24:28 2012 +0000

    sna: Use a minimum alignment of 64
    
    We should be able to reduce this by disabling dual-stream mode of the
    GPU (which we want to achieve any way for 2D performance). Artefacts
    in small uploads demonstrate that we fail to do.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44150
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e94807759eb6cfb10bd2d372fa71cc64a730bc7c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 12:13:18 2012 +0000

    sna/gen6: Special case spans with no transform
    
    As the no transform is a special case of affine, we were attempting to
    deference the NULL transform in order to determine if it was a simple
    no-rotation matrix. As the operation is extremely simple, add a special
    case vertex program to speed it up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a5313900ec9a7c499eb5051f3a5f078a9b0bbde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 12:09:13 2012 +0000

    sna: Explicitly retire the bo following a serialisation point
    
    This is to keep the sanity checks in order, but conceptually should be
    useful as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2add5991a7d186d8271cb79ae4f62dad7b4ca243
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 11:33:19 2012 +0000

    sna: Mark the bo as no longer in the GPU domain after clearing needs_flush
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fec70985719eec75b7fa799bddc3115fb329ab86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 10:57:57 2012 +0000

    sna: Add assertions to track requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a93c93be76f6d5d2b481971349aabd15f282c3e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 11 00:05:20 2012 +0000

    sna/gen6: Add a vertex program for a simple (affine, no rotation) spans
    
    I long for the day when this code is obsolete... Until then, this gives
    a nice boost in the fishtank.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cf5da1090ac777044912ec24619d349d1f6b521
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 23:32:29 2012 +0000

    sna: Amalgamate small replacements into upload buffers
    
    Similar for the standard io paths, try to reuse an upload buffer for a
    small replacement pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0e3f6b5bebf7471d3e3e84bd9b2d8469eb64093
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 22:12:41 2012 +0000

    sna: Check needs-flush status immediately upon destroy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4ae6dbaedd774f250b610b1e7323897c4abe23a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 21:25:28 2012 +0000

    sna: Align the small upload buffers to 2 texels, and the pitch to dwords
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44150
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46f6c6917effbc43305367581cc1bbaa962c0251
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 20:34:09 2012 +0000

    sna: A partial read buffer is allowed to be in the GPU domain
    
    As we can create the read buffer from an active cached bo, it may
    already be in the GPU domain by the time we first finish it, so fix the
    broken assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c26055639f789b211f7db982e65ec0b86b23d4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 20:06:51 2012 +0000

    sna: Shrink the partial upload buffers before compacting the batch
    
    So that the relocation entries point into the contiguous surface/batch
    and can be trivially fixed up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b077a4d3d549cde79d5b876289203788294493c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 18:40:53 2012 +0000

    sna: Make the check for a single fill-rectangle clearer before modifying damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca2a07adc45273dc1abeb4b3ba7f88461aaf9c00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 17:13:38 2012 +0000

    sna: Release the stale GTT mapping after recreating the bo with new tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8dd913fd3a093b54fc024fea2b31a3db2518db8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 10:38:43 2012 +0000

    sna: Add reminder about possible future tiling optimisations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21948578d0d87f38447ef1ae44fada406949bca8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 03:19:16 2012 +0000

    sna: Disable the inline xRGB to ARGB upload conversion
    
    As we have to upload the dirty data anyway, setting the
    alpha-channel to 0xff should be free. Not so for firefox-asteroids on
    Atom at least.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87f73b043426c47efa7670fb65bdcc7dfcf71fc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 01:42:37 2012 +0000

    sna/gen[23]: Tile render fill to oversized bo
    
    If we are forced to perform a render operation to a bo too large to fit
    in the pipeline, copy to an intermediate and split the operation into
    tiles rather than fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ccb31c5a4120efb940168c5e52154add01b0586
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 01:41:09 2012 +0000

    sna: Shrink upoads buffers
    
    If we do not fill the whole upload buffer, we may be able to reuse a
    smaller buffer that is currently bound in the GTT. Ideally, this will
    keep our RSS trim.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 572cc76be5c78102166f2b3640640e21acdfa129
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 09:13:34 2012 +0000

    sna: Destroy the counter damage after a reduction-to-all
    
    If, for instance, we reduce the GPU damage to all we know that there can
    be no CPU damage even though it may still have a region with a list of
    subtractions. Take advantage of this knowledge and cheaply discard that
    damage without having to evaluate it.
    
    This should prevent a paranoid assertion that there is no cpu damage
    when discarding the CPU bo for an active pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a255e13164440b797e5ac11dcbf72f0827a3094
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 16:34:23 2012 +0000

    sna: Replace the free-inactive-gpu-bo with the generic code
    
    The function was semantically equivalent to moving the pixmap to the CPU
    for writing, so replace it with a call to the generic function.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1d403266a611a68081690d19f6debb8e343095f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 00:41:05 2012 +0000

    sna: Allow for xRGB uploads to replace their target bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 406776cd955c3c384d4a537300e21eebe4413666
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 10 00:25:14 2012 +0000

    sna: Rearrange buffer allocation to prefer llc bo over vmaps
    
    If we can create snoopable bo, we prefer to use those as creating a vmap
    forces a new bo creation increasing GTT pressure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b76865fa3deff2f44a1158914a124b9c81d67eca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 9 22:11:21 2012 +0000

    sna/gen2: Try to avoid creating a bo for solid colours
    
    As we try to use the diffuse/specular and only resort to using a texture
    operation for convenience in the rare case of a solid mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 981aae104a96b41db88cc381cc7592818f3e1298
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 9 22:02:40 2012 +0000

    sna/gen2: Eliminate some switching between logic op and blend
    
    If the new mode can be done either using a logic op or with the blend
    unit, prefer the currently enabled unit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d65b7f9cf46a48e3bfb37c0b75df55aa1e7bff41
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 9 21:58:03 2012 +0000

    sna/blt: Rearrange to reduce a out-of-bounds copy to a clear
    
    If we asked to use the BLT, try to avoid trigging a context switch for
    a trivial case where we sample outside of a NONE source and so can
    reduce the operation to a clear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 09e54c553680cbc2f3b4319cdab0f3d1af1574a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 9 14:04:41 2012 +0000

    sna/gen2: Add poor-man's linear gradient support
    
    Convert the linear gradient to a texture ramp and compute the texture
    coordinates in the standard manner.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c70558ae7298db94724c931d88a730ef0151608
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 20:48:48 2012 +0000

    sna: mark the cpu bo used for the upload buffer as in CPU domain
    
    For correctness we need to inform GEM of the change of domain for the
    buffer so that it knows to invalidate any caches when it is next used by
    the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9ec31af02922bb016d0dfba07bc60cdca35b36f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 15:52:17 2012 +0000

    sna/io: Combine small uploads into single writes
    
    For a small update, try and amalgamate the upload buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4db1bb3fd81b51e74b7f3e90078627d9d96fbefe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 14:20:40 2012 +0000

    Removed deprecated xf86PciInfo.h includes
    
    The driver should and does provide its own PCI-IDs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54232d1a5da51d0f68fe099436bb0a1a2e249954
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 15:22:58 2012 +0000

    sna: Add ricer stripes to memcpy_xor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c037b4f542a7b21cbaecedec259da3589db10039
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 08:58:41 2012 +0000

    sna: Tune cache size for cpu bo cache
    
    This helps SNB on cairo-traces that utilize lots of temporary uploads
    (rasterised sources and masks for instance), but comes at a cost of
    regressing others...
    
    In order to counter the regression from increasing the GTT cache size,
    the CPU/GTT vma cache are split and accounted separately.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26042b2660d87044e1920a1267d9984c00c9566a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 11:45:11 2012 +0000

    sna: Bubble sort the partial buffer list back into order after trimming padding
    
    After reducing the used size in the partial buffer, we need to resort
    the list to maintain the list in decreasing amount of available space.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f7ea44bf19a03ee81b683885c9c2416092254a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 02:27:28 2012 +0000

    sna/gen[67]: Hook into the clear operation for glyph masks
    
    Allow SandyBridge to specialise its clear routine to reduce the number
    of ring switches. It may be interesting to specialise the clear routines
    even further and use the special render clear commands...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 803ac5c6b992cb5448c67b11345b87a5d2b9c60d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 01:38:09 2012 +0000

    sna/trapezoids: Don't risk stalling for inplace SRC trapezoids
    
    Optimistically we would replace the GPU damage with the new set of
    trapezoids. However, if any partial damage remains then the next
    operation which is often to composite another layer of trapezoids (for
    complex clipmasks) using IN will then stall.
    
    This fixes a regression in firefox-fishbowl (and lesser regressions
    throughout the cairo-traces).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0229841c0d705138d6317a22ba80f4fa10d26acc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 01:46:24 2012 +0000

    sna: Do not upload an untiled GPU bo if we already have a CPU bo
    
    Continuing the tuning for sna_copy_boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42eb9b7c4b55b620d9652ad3a54c8ab0a76fd7c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 00:21:26 2012 +0000

    sna: Trim usage of vmapping
    
    The first, and likely only, goal is to support SHMPixmap efficiently
    (and without compromising SHMImage!) which we want to preserve as vmaps
    and never create a GPU bo. For all other use cases, we will want to
    create snoopable CPU bo ala the LLC buffers on SandyBridge.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e52f0204939924181480feec6d1511259169c8f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 8 00:20:11 2012 +0000

    sna: Do not move-to-gpu for sna_copy_boxes if we have a cpu bo
    
    We trade-off the extra copy in the hope that as we haven't used the GPU
    bo before then, we won't need it again.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c05e90aa99c093431a74a94ceba27d7dce49d05b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 7 18:23:43 2012 +0000

    sna: Missing chunks from last commit
    
    And update the check for reusing the blit!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 292aebfcdc042b08d3a5a21f839e6aec1175359e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 7 18:09:47 2012 +0000

    sna: Prevent reuse of scanlines after the buffer is destroyed
    
    Once the buffer is destroyed, it may be reallocated with a new pitch. We
    could track handle and pitch, but it is easier to simply restart the
    blit after the buffer is freed.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44277
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44555
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7d07d1df3ffc889ccc32c2ed44ce374e37f851d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 7 10:37:01 2012 +0000

    sna: Pad upload buffers to ensure there are an even number of rows
    
    One restriction common to all generations is that samplers access pairs
    of rows and so we need to pad the buffer to accommodate access to that
    second row. Do so unconditionally along paths that may be used by the
    render pipeline.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2ad0f6272c776939499c6202fb60bdcc2e955fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 17:11:00 2012 +0000

    sna/blt: Amalgamate many PolyFillRect of single boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c085de905c30cb5bae6b339841badf1e105c6ee6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 15:47:47 2012 +0000

    sna: Also mark a bo created by force-to-gpu as being all-damaged
    
    Similar to the action taken into move-to-gpu so that we forgo the
    overhead of damage tracking when the initial act of creation is on the
    render paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f1935bb4e894264053d94e53c99d5ad607700fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 15:26:11 2012 +0000

    sna: Support performing alpha-fixup on the source
    
    By inlining the swizzling of the alpha-channel we can support BLT copies
    from an alpha-less pixmap to an alpha-destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 141001df6c9c3485c500ed531a214c09b46c1d3b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 13:35:27 2012 +0000

    sna: always skip active search when requested for find an inactive bo
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44504
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eac0d9652b2399f8c36ba0288db6fe347ed78dc9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 12:39:49 2012 +0000

    sna: Optimise sna_poly_segment() for the frequent no-op case
    
    Strange as it may seem... But the principle of doing less work with
    greater locality should help everywhere, just not as noticeable when
    real work is performed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3699fff5ada85e4dea739aade25ebbb728e18f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 12:15:46 2012 +0000

    sna: Only force a pipeline flush for a change of destination, not sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2fefee6015ed2df52c8513ae180ca83c01ff83c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 12:10:27 2012 +0000

    sna/gen6: Reuse current no-blending setup for PictOpClear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 800ca0b4d1194544fe2461f91cbdc632c4d3dd7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 12:00:43 2012 +0000

    sna/gen6: Tidy emission of CC state (blending)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9c9e9970cdb542173e3ed0da2bef614abedd3f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 11:38:31 2012 +0000

    sna/trapezoids: Add debug markers for move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2841c5fee79c42bca3e098ec620755d341b6888f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 11:32:54 2012 +0000

    sna: fast path move-to-cpu of an all-damaged CPU bo
    
    When the bo is already completely damaged on the CPU, all we need to do
    is to sync with the CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07f1724ba5759772043fc4c5d1163ddd640004c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 11:00:38 2012 +0000

    sna: Pass the real destination pixmap to sna_write_boxes()
    
    Faking it for the render upload simply isn't good enough, since we need
    the correct drawrect.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c2e9a98715eeddd8dfdff9fe3871bde659484cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 02:26:39 2012 +0000

    sna/trapezoids: Use a slightly faster miTrapezoidBounds()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75f61678249018c84872c61b4609ba9d3d0d73dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 01:38:42 2012 +0000

    sna: Only need to remove the pixmap from the dirty CPU list when clearing damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86cc2cd3343c16b12e35e2048c113481f49196cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 01:31:15 2012 +0000

    sna: The condition for automatically using the GPU source is no CPU damage
    
    With no CPU damage to upload, we know that there is no reason not to use
    the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 69c556c310da544ddb66c2441f5d06dca29fb9f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 6 00:21:29 2012 +0000

    sna: Rearrange use-cpu-bo to avoid reducing GPU damage
    
    If we spot that the region is wholly contained within the CPU damage
    initially, we can conclude that is not in the GPU damage without
    reduction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34c4dbe825a45315b05f0bd49539cbcf5de276f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 23:18:37 2012 +0000

    sna/gen6: Only force BLT if the src and dst overlaps for self-copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc79af7a4abf1f0ceccacf23e8467ee2872eec09
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 23:06:17 2012 +0000

    sna: Only force a batch continuation if the scanout is written to
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c16c16d2553aa9a8bf9b0b0b367715b59020a357
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 22:51:55 2012 +0000

    sna/gen6: Enable reuse of source Picture
    
    Check if the source and mask are identical pictures and just copy the
    source channel to the mask in that case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f642b08870c6d7686368e053962075c153f76f86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 22:26:09 2012 +0000

    sna: Quickly handle the common case of using a CPU source pixmap
    
    For the common case (at least with llc bo) where we are immediately
    using an uploaded image from its linear buffer, check upfront before
    computing the sampled region for transfer to the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a9baa59e9d0c0761b82f23734514f6847a9bcc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 22:16:31 2012 +0000

    sna: Quickly handle the common case of using a GPU source pixmap
    
    For the common case of glyphs, the pixmap is entirely on the GPU which
    can be quickly tested before performing the more complex transformations
    to determine how much pixel data we need to upload.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4dad6e3723d70d78247f29f86079862af175266
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 21:39:24 2012 +0000

    sna: Check that the GTT is no longer mapped before ensuring the shadow pointer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 352f0a3ffb8ae8503bb2fab779ea84f4e6d76317
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 21:33:26 2012 +0000

    sna: Only mark the pixmap as GTT mapped if the private owns the pixels
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3061382f98c0b284c250c1a36f7a4fee22046664
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 21:05:52 2012 +0000

    sna: Make sure that we do not attach to SHM pixmaps in ignorance
    
    Without xserver support for notification of when scratch pixmaps are
    reused, we simply cannot attach our privates to them lest we cause
    corruption with SHM pixmaps.
    
    This is a recent regression back unto an old, old xserver issue.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=44503
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7431726338e72d7a989e838f48aecdab15ab366
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 20:26:30 2012 +0000

    sna: Add more debugging to use-gpu-bo
    
    To aide debugging in conjunction with compositors and their crazy
    offsets.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53c943b551b86402067ea96cd9fcca2848e84387
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 18:41:26 2012 +0000

    sna: Check for usable pixmap before deference its private
    
    Beware the NULL pointer and early deference.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 307276d7da99ceb84c175e412452e5d86d615cf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 14:26:05 2012 +0000

    sna: Enable using the render pipeline for uploads to Y-tiled pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9451aaa39e1d77b08d2201f5c4a44ab834f2237
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 14:22:21 2012 +0000

    sna: Mark the upload as having acquired the GTT mapping
    
    In order for the entire PutImage to be performed inplace, we need to
    maintain the tendency to keep doing inplace operations. This hint is
    provided by tracking whether or not the last operation used the GTT
    mapping. However, that hint was not being provided by zpixmap_blt.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce93c00a33a395986ffc0d33aae85d2c23aabc5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 14:20:55 2012 +0000

    sna: Avoid operating inplace if we have pending CPU damage
    
    If the operation does not replace existing CPU damage, we are likely to
    want to reuse the pixmap again on the CPU, so avoid mixing CPU/GPU
    operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5d02d90f3349f33341954fc55824d12a7829e6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 12:56:21 2012 +0000

    sna: Avoid switching rings for uploading data
    
    On systems that incur painful overhead for ring switches, it is usually
    better to create a large buffer and perform a sparse copy on the same
    ring than create a compact buffer and use the BLT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a42111ff94911d5fad34e6dbac8aa4a11b2d8032
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 12:12:22 2012 +0000

    sna/trapezoids: Try creating the trapezoids mask inplace if not using spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c6ccbd46a1681c73382b79a0246f7d8cb097606
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 11:09:01 2012 +0000

    sna: Throttle, throttle, throttle.
    
    This reverts 281425551bdab7eb38ae167a3205b14ae3599c49 as it was causing
    insufferable lag in firefox.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbb495c3aeef34eab2aabfdfaafb81facdea4100
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:34:08 2012 +0000

    sna: Attach to the pixmap for source counting when deferring uploads
    
    If we decide to defer the upload for this instance of the source pixmap,
    mark it so. Then if we do use it again we will upload it to a GPU bo and
    hopefully reuse those pixels.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 292097590ba0f81b7505aedb2a4fbd18021641a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:31:15 2012 +0000

    sna: Try doing a cheap is-contained check before reducing damage
    
    If the pixmap is entirely within the current CPU damage, we can forgo
    reducing either the GPU or CPU damage when checking whether we need to
    upload dirty pixels for a source texture.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ddae8bf21067e7d2a031a6b9020c02ab977cfed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:27:37 2012 +0000

    sna: Check the composite-rectangles will be on the GPU before forcibly attaching
    
    If we think that the operation is better performed on the CPU, avoid the
    overhead of manipulating our privates.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ffd3605640bacaf0d744075622463aacf78d797
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:25:12 2012 +0000

    sna: Deferred attachment to a pixmap needs to mark the pixmap as entirely dirty
    
    As demonstrated with oversized glyphs and a chain of catastrophy, when
    attaching our private to a pixmap after creation we need to mark the
    entire CPU pixmap as dirty as we never tracked exactly which bits were
    dirtied.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a09ebe0b6cc66d08e52b57851d9b8a6a1f71df2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:23:25 2012 +0000

    sna: Immediately upload oversized glyphs
    
    Glyphs, even large ones, we suspect will be reused and so the deferred
    upload is counterproductive. Upload them immediately and mark them as
    special creatures for later debugging.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 797b27365dc09a3f84349a33cffbfdc67cba0baa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 10:30:47 2012 +0000

    sna: Don't perform a deferred attachment for vmapping if not supported
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23e3959e1f603c3ba0bd4f01128290241cf93edf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 04:00:32 2012 +0000

    sna: Use the created cpu-bo for upload and download
    
    As we explicitly create CPU bo when wanted, we no longer desire to
    spontaneously create vmaps for simply uploading to the GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4530b87e445aea30ccbe751699963118ad5672d4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 5 00:01:27 2012 +0000

    sna: Fix assertion as we may want to create active bo with cpu mappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4119e68fb157fc612bce5e9c5669112ce35b4ca1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 19:35:30 2012 +0000

    sna/damage: Fix reduction to copy the boxes correctly
    
    We need to be carefully to copy the boxes in a strict lifo order so as
    to avoid overwritting the last boxes when reusing the array allocations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71b0924b586d9a60397e92e941e3d0cfa636ee61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 19:34:41 2012 +0000

    sna: Mark tiny CPU pixmaps as completely dirty
    
    Avoid the overhead of tracking damage on small pixmaps when using CPU
    rasterisation; the extra cost of sending the whole pixmap compared to
    the damage is negligble should it ever be required on the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc14e63256a9b756c7c77ffe73f2f13784396c5a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 19:33:30 2012 +0000

    sna: Only request page size allocations for the replacement buffer
    
    A precondition on bo creation is that the size must be page aligned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89739b711f42c3dbed7d3f4e6da0cdd61a5205ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 17:41:16 2012 +0000

    sna: Expand small stipples into 8x8 patterns
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 878fbfe509da0a25dff8515d6d3b38ca3826466e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 16:56:55 2012 +0000

    sna: Align tiled stipple uploads with the stipple pixmap correctly
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28a222a66bb450c7f6d61aef16fe73332854c8ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:48:25 2012 +0000

    sna: Always prefer to use cacheable operations after the GPU is wedged
    
    As rasterisation will be performed upon the CPU we need to avoid the
    readbacks form uncached memory and so we should restrict ourselves to
    only create further damage within the CPU pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99ff83a3bebf1aa25c44a87f2c344307d20bc062
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:35:12 2012 +0000

    sna: Prevent creation of bo purely for GTT mapping when wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7c35fa4c3155d10ad75ac33aefb03dafa010aba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:33:09 2012 +0000

    sna: Only allow mappable pixmaps to be mapped
    
    If we did not allocate the pixel data, such as for wedged pixmaps or
    scratch buffers, then we cannot perform the pointer dance nor do we want
    to create the GPU buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cbc97d28aae138566e49df05e16d274b533ea86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:32:06 2012 +0000

    sna: Force creation of ordinary pixmaps when wedged.
    
    If the pixmap was intended for scanout, then the GPU bo will be created
    upon attachment to the fb.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6cc73ba66f34d190b7c17421a62aa1256698431
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:56:31 2012 +0000

    sna: The batch is counted in dwords, not bytes!
    
    Yikes, I choose the wrong units for the max_batch_size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 227fbb90c4884bbc58c6c0cfff9663ec9ca54171
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 11:47:32 2012 +0000

    sna: Carefully free the freed_pixmap upon exit
    
    As the contents of the pixmap are now rubbish, we need to manually
    destroy it rather than pass it to the normal sna_pixmap_destroy()
    routines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ed758cd2176ee4f34e03d05d05130d52d75e577
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 12:18:20 2012 +0000

    sna: Limit batch to a single page on 865g
    
    Verified on real hw, this undocumented (at least in the bspec before me)
    bug truly exists.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3449f1cbe184a618e662d2a662167f05362b82e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 02:38:16 2012 +0000

    sna: Guard against NULL damage deref
    
    The fast version of damage checking assumes that the damage has already
    been determined to be non-NULL, so make sure it is.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04a6260016fb5ebefc1056ed6acf5001ec535d5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 01:14:19 2012 +0000

    sna: Fix typo during partial list deletion
    
    And keep the asserts that lead to its discovery.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1dc1eadd84097fc691e85c636535ceeeb601a18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 4 00:09:30 2012 +0000

    sna/gen3: Remove incorrect premultiplication of solid component-alpha mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8cb9b8d7d7a1eb62eb3b20e6a50d3f1c9bde40c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 23:13:24 2012 +0000

    sna: Discard mask and source for PictOpClear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit feb75c55d6105a9ecc5f5ec7830276d1654918b9
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Sat Dec 31 21:18:15 2011 +0800

    uxa/glamor: Route some missing drawing function to glamor
    
    We have to route all the drawing function to glamor first, when
    glamor is enabled. This adds a few more functions that were previously
    just falling back to swrast and passes them to glamor instead.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4ea732d7181d4ef7f97fb2585e87cdcaef99d46
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Tue Dec 27 17:09:17 2011 +0800

    uxa/glamor: Let glamor do the GC validation
    
    If we are using GLAMOR, then a tile pixmap or stipple pixmap
    may be pure glamor pixmap and thus UXA will not know how to
    render to them, and we need to let glamor do the validation.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8aa9cedbfca09e22d46ec8882b9bebb3eb83022
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Tue Dec 27 17:09:16 2011 +0800

    uxa/glamor: Remove extraneous flush
    
    When glamor is enabled, a pixmap will not be accessed by UXA's
    accelerated functions. Only unaccelerated functions may access those
    pixmaps, and before each unaccelerated rendering, it calls
    uxa_prepare_access which will do a glFlush. Combined with a flush before
    sending to DRI clients, we no longer need to flush after every
    operation.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ca94ed91fab7a9de5eed1053b891e8420cdf43d
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Tue Dec 27 17:09:15 2011 +0800

    uxa/glamor: Remove dead code.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5576afc7d12ec0f028e416f4b4a076fc6d3c29d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 16:48:52 2012 +0000

    sna: Inline checks for over-sized buffers during pixmap creation
    
    Make the tests for acceptable GPU pixmaps explicit and upfront.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2dc17678fa3a548be61e1055d4d321dbd6494c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 15:50:21 2012 +0000

    sna: Always search for an exact active match first from the bo-cache
    
    And accept second-best only if permitted by flags.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit caf41ae23d263c7baed6b23a80693690c4dfe563
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 15:11:13 2012 +0000

    sna: Force tiling on medium pitches if not reduced for other reasons
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b688ca0cfc1e623f896e60a6a6abf724d57efb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 14:18:05 2012 +0000

    sna: Delete the last buffer if destroyed without being used on the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a68e7277104d7dccbdc4739eb5651902b9ccc20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 12:19:24 2012 +0000

    sna/gen3: Prefer to use the blitter for solid fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 199e357dc693cfe232464e4faa82d9223a8325d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 12:16:48 2012 +0000

    sna/trapezoids: Pass the sna pointer to the callees
    
    Avoid the repeated multiple indirect dereferences.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd7aa1754dcf9d58d7deb92d99da9b78c91a0eb2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 12:46:40 2012 +0000

    sna: Avoid unnecessary call overhead for read-only move-to-cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 294c8791c435acf5933109fbcab85623a55b2c6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 12:09:51 2012 +0000

    sna: Use a cheaper no-reduction damage check for simply discarding further damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ff42e9c83cdb17660a64901497704b38032af8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 19:15:07 2012 +0000

    sna/damage: Mark the box as packed so that the embedded_box is aligned correctly
    
    valgrind was complaining about an overlapping memcpy on a 64-bit
    platform as gcc padded the sna_damage_box to 28 bytes...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4652a20de5fee0d5d1a8baadc4a93b6a93525564
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 3 21:20:09 2012 +0000

    sna/gen3: Check for a non-NULL bo before incrementing its ref in reuse_source()
    
    For gen3, we may reduce a source into a constant operator and so
    dispense with keeping a bo. When duplicated into the mask channel, we
    then need to be careful not to dereference the NULL pointer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 777fcc9b11e8cbfe942aa6bf898749f552acb3cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 16:03:42 2012 +0000

    sna: Prefer not to force the creation of gpu bo for pixmap uploads
    
    As this causes a significant regression when benchmarking firefox on SNB
    with firefox-planet-gnome if we already have CPU buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a6c16a24cb74f82df9757c034c50f2cf141523f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 14:32:48 2012 +0000

    sna: Keep a freelist of buffers
    
    As reallocation of bo is the most frequent cause of malloc/free.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f008a2a90c632d843f07846426f6d14af728c13b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 10:24:49 2012 +0000

    sna: Tune blt routine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b57c7248acc2ad6a51b7eac74449d155defc998f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 14:10:20 2012 +0000

    sna: Delete some redundant code
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83d16455b70e2f0348e51f95128d4fcae3736e7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 13:58:44 2012 +0000

    sna: Eliminate one union pass when reducing damage-add
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f5b769e7144c7b85010429e6d8aebf9c9fc1628
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 1 10:00:37 2012 +0000

    sna: Move some checks against programming errors to asserts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24bf59c43fbedd9d85c913ac3c7f0e752c232eb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 18:57:57 2011 +0000

    Revert "sna: Increase the minimum alignment constraint for g33"
    
    This reverts commit 2934e778f01cdf1307732b248b11a31c0e79e866. The actual
    cause of the bug I was seeing on my PNV box turned out to be
    a1f585a3d0a, so time to reinvestigate the alignment issues.

commit 770a953ff03bb8328c3f29e274d225528840f30c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 17:19:08 2011 +0000

    uxa/video: Clear all state structures before uploading
    
    A regression from eb859f644633e left some of the state uninitialised
    before uploading to the GPU leading to undefined behaviour.
    
    Reported-by: Alexey Shumitsky <alexey.shumitsky@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=44338
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=44252
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1995c684d2e074ae04c9e42727e59cc77e16104
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 15:57:32 2011 +0000

    uxa: the video destination should be in the render write domain
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 511146d2e40e267f74e18c0dd06b65f5d6a69f5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 13:27:13 2011 +0000

    sna: Implement inplace trapezoidal addition (for clipmasks)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1f585a3d0ae72e896684f62960a9ae96dc259f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 12:43:04 2011 +0000

    sna: Update pixmap->devKind for GTT mappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 343de19ef98eea016601dbbe2d1f601dbff9de20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 11:19:44 2011 +0000

    sna: Implement tiled uploads for small stipples larger than patterns
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb15cf2294da20bfc375ae62443b822770850316
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 10:24:58 2011 +0000

    sna: Make sure the shadow pixmap is suitable for scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 281425551bdab7eb38ae167a3205b14ae3599c49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 31 10:10:00 2011 +0000

    sna: Tweak throttling to be run before going idle
    
    The goal is to avoid introducing extra latency in the middle of a
    command sequence and to delay it until we have to wait for the clients.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f5448f1329f344702e4e29b2509d7190677bbf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 30 22:13:05 2011 +0000

    sna: compare tiling against minimum width for relevancy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e82b3d8069629ae5776e039d6ea1f3c901a3a094
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 30 09:16:00 2011 +0000

    sna: Defer the initial source upload if the GPU bo will be untiled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72624b0b5ba6549cb8d96f992d2656a28ec6078c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 22:43:35 2011 +0000

    sna: Remove redundant use-gpu-bo clause
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6dc9bbc0161f071bbaf5c7e379974158a5ad666f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 22:43:44 2011 +0000

    sna: Fix DBG for no intersection with damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0dc5c0651cb691fb8811cdf3075b3d322f9d37f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 13:49:23 2011 +0000

    sna: Tune disarming of the scanout flush timer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccd895c61d9f409a36c70eaf02d7ab43cc6c03c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 12:09:04 2011 +0000

    sna: Allow uploading inplace to a freshly created GPU bo
    
    If the operation is favoured to be performed using a WC upload, presume
    that we will use the uploaded pixmap on the GPU and so prefer to create
    a GPU buffer to hold the fresh data.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f85a853455249fd782e907ce1d78d11f75362def
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 11:59:57 2011 +0000

    sna: Only update the damage region as necesary for contains-box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f53936407bd68f3d36ab525b4e0531fad58098e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 11:59:37 2011 +0000

    sna: Reset the source counter upon dirtying the shadow pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9f7f10bc528ac783f4e89bdb36fc56ccdcd0088
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 09:03:21 2011 +0000

    sna: Be paranoid and check for errors from mmapping the bo
    
    Now that the error propagation is actually in place, we may as well use
    it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98e053503aed292beb2006043e8508d59262c7c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 29 08:50:53 2011 +0000

    uxa: Depend upon DRI2 not DRI
    
    The symbols required for building intel_dri.c are checked during
    configure under the DRI2 defines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58cee9d0def82d19f03c840325b6e84c20e77ace
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 22:52:58 2011 +0000

    sna/dri: Update set_bo() for change of bo ownership transfer during page-flip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9ee02be269d1658d3a8a5166e9bd2a49ab6dea0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 22:52:44 2011 +0000

    sna: Fix debug message for read-boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 698bd43e0f7a59bcce6601b0c96df85935e54bb3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 21:45:12 2011 +0000

    sna: Do not create glyph caches if the gpu is wedged
    
    As these will only be created in normal memory and never used.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78425a15597079c0549de0fa1bbbdbebcf9eaf28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 15:26:14 2011 +0000

    sna: Refactor common code for testing gpu busyness of a pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9105b7e03ab7e3602c7200ebdc44e89f873afe1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 13:46:18 2011 +0000

    sna: Perform clip mask compositing inplace
    
    Avoid the extra composite-in pass for simple clipmask construction.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5583165da0d2ae5eb1e5a2e11ee6e245d4b5aa4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 13:57:09 2011 +0000

    uxa: Remove concept of global FB ownership made obsolete by GEM and KMS
    
    With the introduction of GEM, we can continue to submit batch buffers
    irrespective of ownership of the console, so do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 337635ab97bbfc9b4455eadb63214783bb90bb2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 28 10:56:57 2011 +0000

    sna: Add some more debugging to find the source of a read-boxes error
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bf81241cbc97763e5f3cbc82772437ccbff5a6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 27 17:09:59 2011 +0000

    sna: Skip zero-sized glyphs
    
    Similar to the empty glyphs make sure that we just advance by the
    character width without drawing anything.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8fc21328a0bdf87fde35d68d2b27834011acde7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 27 15:26:46 2011 +0000

    sna: Don't discard empty glyphs, just skip them
    
    A space is encoded as a 1x1 blank glyph, but we still need to advance by
    its character width and so we cannot simply discard the glyph.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44091id=44091
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 726290ea2a54716d3d8fb998fe7d2ab252421de7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 27 13:16:34 2011 +0000

    sna: Rearrange damage for tail-call optimisations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04396b6e5039c0cd1ac655a8a9afe88bb8a1ebde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 27 09:58:40 2011 +0000

    sna: Don't force the creation of a GPU bo if it will be untiled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 655a96cd5f12ff7fe593e7da5f34c7c92ef9b87d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 26 14:37:37 2011 +0000

    sna: Mark the glyph cache as being unpageable
    
    In order to prevent it falling foul of the inactive pixmap reaper, we
    need to mark the pixmap as pinned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2934e778f01cdf1307732b248b11a31c0e79e866
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 26 11:30:39 2011 +0000

    sna: Increase the minimum alignment constraint for g33
    
    Still not getting the single-stream mode that I am aiming for!
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=44150
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7593a995a829978ce81397dde5c9ea6f9bb7681
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 25 09:40:46 2011 +0000

    sna: Move the is-mappable check into the callers of region_inplace()
    
    As they slightly differ in their requirements.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aff32e3e08fce3c7b8dab3a25c96d69c409471fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 25 00:36:33 2011 +0000

    sna: Tweak damage not to reduce if it will not affect the outcome of reducing to all
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be21a09fef0a3499153f2c123b65f1d5c872d437
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 25 00:28:55 2011 +0000

    sna: Only call move-to-gpu on scanout flush if we have cpu damage to move
    
    Reduce the number of redundant calls.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b69dc88094ee2bb017364cd4356f3ae69cbc1f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 25 00:21:21 2011 +0000

    sna: Inline the common portion of sna_get_pixel_from_rgba()
    
    The function overhead completely dominates for the common case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b117f65520919f4ba36010cfe913a8c53166bf23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 21:03:01 2011 +0000

    sna: Jump straight to the fallback copy routines if the dst is not attached
    
    Marginally simplify the convoluted logic for choosing the most
    appropriate path and help prevent further errors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72217790ee2c080d618274456360b481d015e898
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 19:14:09 2011 +0000

    sna: Use shadow if the GPU is busy or not immediately mappable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0be136c21f0373d1eb2259b83c598655f4eb841e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 18:44:15 2011 +0000

    sna: use indirect uploads if the bo was last known to be unmappable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e764a52ee8f0c552e218b3110318be9ba06634ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 15:17:06 2011 +0000

    sna: Encourage large operations to be migrated to the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f9f8535db6a9e3affba9ba2c2a9314dfe12ab270
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 21:01:39 2011 +0000

    sna: Fix damage reduction by adding new boxes to the tail of the box list
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8c91f229a9ca18fc58b0cabbea595d26627db8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 12:17:53 2011 +0000

    sna: We can always compare the box to be subtracted against the dirty extents
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc21d3fa045209861564cf240a9a082e0bdb63f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 12:17:43 2011 +0000

    sna/damage: Fix the is-contained test
    
    It was a non-overlapping test which is almost the reverse of what was
    intended.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b86e4f59299f935d5a0ea8375da97e6fc57571f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 11:45:27 2011 +0000

    sna: Check that the copy dst is attached before replacing damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bcc9f08e1309725c18dfa5ca0e905bb88ebf4ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 09:59:24 2011 +0000

    sna: Create a GPU for a streaming write
    
    If we are about to do a write-only drawing operation that will exceed
    our cache, allocate a GPU bo and perform the operation inplace.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efc8d04fc114e9966e5ca00600f9663ecf03a5ca
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 09:32:18 2011 +0000

    sna: Promote an unattached pixmap to the GPU for inplace copies
    
    If we would prefer to perform the copy on the GPU and if the pixmap is
    virgin, create a GPU bo for the operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c0e7ff5ac996a5a5c0790966084d1c9e1b1f859
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 09:19:18 2011 +0000

    sna: Clear the CPU damage for other overwriting rectangular blits as well
    
    And make the accessing of the sna_pixmap safe -- it may not even exist!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f9ed3ca56466f319d9ec06aebb7055552fb1fe1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 08:57:49 2011 +0000

    sna: reset the pixmap on the initial clear after being swapped out
    
    Pixmaps are swapped out into the CPU after a period of inactivity. This
    then prevents the core rendering routines from migrating the pixmap back
    to the GPU until it gets used again on a Render path. However, we can
    clear that CPU damage and enable migration before a number of key steps
    in the expose process.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c987b6ccfa83b99a316a7da49a6d7e30fcdf295
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 09:09:58 2011 +0000

    sna: Cheaply reduce damage when subtracting and removing the entire damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 098592ca5d79af2e4bdcd82ee598c4b2ba08df6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 02:49:24 2011 +0000

    sna: Remove the independent tracking of elts from boxes
    
    Following the switch to a global mode for damage, the elts array became
    redundant and all that is required is the list of boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73df0c7ab7c3a9edf0be2439c7e7ab07c0d75ecf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 02:48:18 2011 +0000

    sna: Tune region upload inplace threshold
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef66c5b5ad221211948ec795ade031591c3f0ac7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 24 00:15:33 2011 +0000

    sna: Search the inactive VMA cache first for a linear mapping
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1cc07fa2d24b10ac95c7a84908290ec06539d447
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 20:31:21 2011 +0000

    sna: Avoid forced creation of GPU bo for tiny operations and dirty pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5bfea5826117bdd29664d83b3d478ff9db29ca3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 20:30:58 2011 +0000

    sna: Discard any GPU damage when overwriting with trapezoids
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 819dc93e52533afc9b9005db1472672c3d42229f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 20:29:59 2011 +0000

    sna/glyphs: Create GPU bo for large enough destination surfaces with glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9580ae8490a4119dac2fefe0085326db350209d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 19:11:43 2011 +0000

    sna: Pass usage-hint to move-to-gpu
    
    When simply creating a source GPU bo it is preferrable not to mark it as
    all-damaged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98f15fc61361b7f1e01969f8d4237c13e93e3fb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 17:25:42 2011 +0000

    sna: Don't align pwrite to cachelines for doing discontiguous copies
    
    The batch compaction breaks the 1:1 mapping between the cpu buffer and
    the bo, so we can no longer safely align the transfer to whole
    cachelines.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=44091
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3850f4ad48986691e1fb98038ae921deb6c25423
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 12:42:02 2011 +0000

    sna: Silence unsigned comparison against 0
    
    The good news is if this ever failed, the kernel is far too broken...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9ca113a83177562cde3537bf955164c6950cbd0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 10:06:58 2011 +0000

    sna: Trim the unused pages from the batch between the last command and surface
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 013eda17e91ff421cd1ef70470e3575f1183fcbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 10:40:58 2011 +0000

    sna: Free the additional bindings on proxies

commit 84d97bdba02b909369b54de21425ffc9f6ad581a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 23 00:01:50 2011 +0000

    sna/gen2+: Reuse source channel for mask where possible
    
    GTK+ has a clever trick for premultiplying its images by loading the
    same pixel data into both the source and mask, and then performing the
    composite. This causes us to upload the same pixel data twice!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 281f620573917faef52d9226b12737ce1e2dffdc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 22:23:41 2011 +0000

    sna: Age active wholly damaged GPU buffers more slowly
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8575b8bd150ae11147fbf6b59171cbbb072dfec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 22:15:42 2011 +0000

    sna: Cancel the immediate batch submit once handled in the block handler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 609e1d9da282323ab7abc1baad4d3f24ac55588f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 15:54:39 2011 +0000

    sna: Bump the inactivity timeout
    
    With the goal of removing inactive pixmap froms the GPU after 5 minutes
    of idleness.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62602209e54c3568795122ee1c902c3b81985303
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 14:20:20 2011 +0000

    sna: discard damage-all even for width|height==0 operations
    
    Even if we don't know the extents of the render operation, if the entire
    pixmap is damaged we can still reduce the damage tracking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f68a99a55e1e63d7e76a13a7b77b4bb3f7802b9e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 15:04:22 2011 +0000

    sna: Mark fresh GPU only bo as being all damaged
    
    Presume that we will not fallback and so treat a GPU only bo (one that
    is initially created on the GPU) as being all-damaged. This makes future
    operations cheaper as the damage tracking overhead is much reduced, and
    the cost of the first readback will mainly be in the synchronisation
    overhead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f2cd536bc712843233de3f5c50802c388d63c72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 14:30:04 2011 +0000

    sna: Reduce damage after complete solid fills
    
    RenderFillRectangles is often used to initially clear a pixmap after
    creation by flooding it with a solid colour, as is PolyRect. We can
    reduce further damage operations by checking for this condition.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a6a2c5d4cc98da76c73152cb7eafcbdb0c088ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 13:24:07 2011 +0000

    sna: Setup the pixmap correctly in order to attach our private
    
    During creation of sna_pixmap we validate that we can use a GPU bo with
    the target pixmap. This fails if we pass in a raw pixmap header, so
    make sure the scratch pixmap is fully initialised first.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f621b3de841f6037d387ca1439a0abe12ef29811
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 11:19:45 2011 +0000

    sna: flatten source alphamaps
    
    Replace the source picture+alpha with a bo that contains the RGB
    channels from source and A from the alpha map.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c08eb4d6f8789e692ef018e007d1ae97a57c25f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 22 11:42:39 2011 +0000

    sna/gen2+: Prefer to use the CPU if we have a source alphamap and CPU pictures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 354dc3c65b9cb86885b6927ee2b80cd2ee6a82ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 21 21:35:06 2011 +0000

    sna: Avoid fallbacks for convolutions by rendering the convolved texture
    
    If we have no shader support for generic convolutions, we currently
    create the convolved texture using pixman. A multipass accumulation
    algorithm can be implemented on top of CompositePicture, so try it!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34cfa15e522ba486d591d37f37d494e399f70354
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 21 00:47:47 2011 +0000

    sna: Drop suggested tiling parameter when creating bo
    
    The only place where we did anything other than use the default was when
    creating a new bo for CopyArea. In that case, basing the choice on the
    src GPU bo was not only wrong but a potential segfault.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d348425592251f49fd31b9259651e8b05e92d1e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 21:35:58 2011 +0000

    sna: Intiialise pixmap size before use
    
    After 0c12f7cb0 we were setting the width/height of the pixmap *after*
    trying to use them to determine if the pixmap could be created on the
    GPU. Normally this would be corrected when we attempt to render, except
    for the core drawing protocol.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e71058c9c81067cd72b1193242acbd85272ab73a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 21:20:48 2011 +0000

    sna: Always readback untiled bo in place
    
    We are going to gain no advantage from the kernel detiling the busy
    buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6690ff51ec939367051985172a00bf8ed65ac4e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 21:09:01 2011 +0000

    sna: Treat all exported bo as potentially active
    
    Don't assume that a read/write will clear the active flag if the bo has
    been exported to another DRI client.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 743084bbc4c411694190f60cf5161086ada6454f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 20:42:08 2011 +0000

    sna: Only upload tiny pixmaps on the second use
    
    Most small pixmaps appear to be single shot, so amalgamate them into one
    buffer and trim our memory usage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca24ffe8b9acef034a5610376c73ebbdce87d41c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 20:11:12 2011 +0000

    sna: Improve a debug message
    
    Give the units when saying the pixmap is too small to bother tiling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f837b9bcc7d384aeb37c2e9ebdac95571deaedc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 20:06:25 2011 +0000

    sna/render: If the pixmap already has a GPU bo, use it for the source
    
    The usage hint not to create a GPU bo is obviously superceded if we
    already have a GPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfafe76a57655784c313bc2078d0b28a7ac2675b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 18:39:20 2011 +0000

    sna: Do not use Y-tiling for composite back pixmaps
    
    These are treated by the core drawing routines as replacements for the
    front-buffer attached to Windows, and so expect the usual BLT
    accelerations are available, for example overlapping blits to handle
    scrolling. If we create these pixmaps with Y-tiling and then they are
    pinned by the external compositor we are forced to perform a double copy
    through the 3D pipeline as it does not handle overlapping blits and the
    BLT does not handle Y-tiling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cda7b4fa82870d57fcd0036a3b734cc73e2bf28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 17:58:33 2011 +0000

    sna: Implement extended fallback handling for src == dst copies
    
    Only marginally better than falling all the way back to using the CPU,
    is to perform a double copy to workaround the overlapping copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d257a967396c517146cfb12bbec5cd28418752a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 12:53:42 2011 +0000

    sna: Explicitly handle depth==1 scratch pixmaps
    
    Short-cut the determination of whether it can be tiled and accelerated
    -- we know it can't! This is mainly to cleanup the debug logs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c12f7cb01e75de3bf9c2af8ac6d5b4152566457
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 10:19:01 2011 +0000

    sna: Tidy up some recent valgrind complaints with reuse of scratch pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3a4f5db149888239b78df1b9fcc5379b1603005
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 12:12:39 2011 +0000

    sna: Fixup the refcnt to avoid an assert
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac52a1fcd11a3ab10e1843ed2d19f9cf818de4c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 02:20:48 2011 +0000

    sna: Don't immediately check for region intersection after subtract
    
    In the READ==0 case we know that the region does not intersect damage
    because we have just subtracted, and checking the intersection causes us
    to immediately apply the subtraction operation defeating the
    optimisation and forcing the expensive operation each time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4071dca0ef8b2b1605f16bed5c42991885a35efd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 20 00:25:29 2011 +0000

    sna: Don't mark mapping as synchronous by default
    
    Only those that point into scratch memory need to synchronized before
    control is handed back to the client.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c2a97e9d2b1073f0e4b3f7b6670939e1b1c5121
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 23:10:45 2011 +0000

    sna: Always pass the damage to sna_drawable_use_gpu_bo()
    
    As it now assumes that the damage is always writable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06a1792f91d3ae2ebb17e4ad55caec10c5407aa6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 21:04:02 2011 +0000

    sna: Avoid the GPU readback with READ==0 move_to_cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b5fec3f80c8d2e4d3b504af5bb02fb76be6b3a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 20:13:05 2011 +0000

    sna: Drop the is-mapped flag after operating via the GPU
    
    Mark the end of a sequence of CPU operations and force the decision to
    map again to be based on the current upload operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 351c8f16336e757b8a4d218b3afda0698781d143
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 19:51:12 2011 +0000

    sna: Discard all damage when replacing pixmap contents
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit addf66dda7cecaee8e58f53bb4e8d725dfdd2717
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 18:37:08 2011 +0000

    sna: Tweak the rendering priorities
    
    If the last operation was on the GPU, continue on the GPU if this
    operation overlaps any GPU damage or does not overlap CPU damage.
    Otherwise, if the last operation was on the CPU only switch to the GPU
    if we do not overlap any CPU damage and overlap existing GPU damage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b6ade12346efa5b9cc095ad44c7d71880a19ab0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 17:21:26 2011 +0000

    sna: Create a GPU bo for accelerated core drawing
    
    As we now can accelerate most of the common core drawing operations, we
    can create GPU bo for accelerated drawing on first use without undue
    fear of readbacks. This benefits Qt especially which heavily uses core
    the drawing operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eeb81dd6b4651c6b3e8676007d37480888726efa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 16:48:02 2011 +0000

    sna: Remove the forced inplace upload
    
    Make the decision per-operation, with a tendency to remain mapped.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3a8d77a2b6806a69de87fbaadea8612ef5f91dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 16:51:29 2011 +0000

    sna: Tune the inplace cross-over point to be half-cache size
    
    The theory being that we will also require cache space to copy from when
    uploading into the shadow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d53b1b28951fd7558e9913a2973c17983e0bcecf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 15:33:39 2011 +0000

    configure: Bump the required pixman version
    
    UXA now also uses pixman_triangle_t in order for its fallback, so we
    need to bump the required pixman version for UXA as well as SNA.
    
    Reported-by: Fabio Pedretti <fabio.ped@libero.it>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43946
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1fa5721f064a8d1f34e4032b52f24597f4015313
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 00:37:03 2011 +0000

    sna: Reset the GTT mapping flag when freeing the shadow pointers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7326d3098662688b8040c6e1261064caed1f5d06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 00:35:14 2011 +0000

    sna: Restore CPU shadow after a GTT memory
    
    When mixing operations and switching between GTT and CPU mappings we
    need to restore the original CPU shadow rather than accidentally
    overwrite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae32aaf4b20dafef138dc9c28dbddbfe49f24b83
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 19 00:34:12 2011 +0000

    sna/gen[23]: We need to check the batch before doing an inline flush
    
    A missing check before emitting a dword into the batch opened up the
    possibility of overflowing the batch and corrupting our state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e32ad646762ccc7f22f938454e222d43abfb38ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 23:42:07 2011 +0000

    sna: Continue searching the linear lists for CPU mappings
    
    Prefer to reuse an available CPU mapping which are considered precious
    and reaped if we keep too many unused entries availabled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15a769a66fa1afbcffc642ef980387cffefc6bef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 22:18:02 2011 +0000

    sna: Distinguish between GTT and CPU maps when searching for VMA
    
    Similarly try to avoid borrowing any vma when all we intend to do is
    pwrite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0ee695ef091671e2cc69b773f517030ebe961b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 20:28:18 2011 +0000

    sna: the active cache is not marked as purgeable, so skip checking it
    
    Otherwise we do a lot of list walking for no-ops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8df9653135c6390ed699ba9f8cbf374b2cc84396
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 19:53:14 2011 +0000

    sna: clear the request list when reusing a flushing bo
    
    That the rq is NULL when on the flushing list is no longer true, but
    now it points to the static request instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b51e3de66292e4b29483324e1dbfeb2495817351
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 19:51:17 2011 +0000

    sna: When freeing vma, first see if the kernel evicted any
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fed8d145c148bfa8a8a29f4088902377f9a10440
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 19:26:38 2011 +0000

    sna: Use a safe iterator whilst searching for inactive linear bo
    
    As we may free a purged bo whilst iterating, we need to keep the next bo
    as a local member.
    
    Include the debugging that led to this find.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2a98dabcabf25067abcda60f233656e19e83493a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 18:48:30 2011 +0000

    sna: Purge all evicted bo
    
    After we find a single bo that has been evicted from our cache, the
    kernel is likely to have evicted many more so check our caches for any
    more bo to reap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ae105b2c7a06fc81757f06ec1aaa2447b53498a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 18:20:11 2011 +0000

    sna: Only retire for the VMA search if there are cached VMA
    
    If there are no VMA that might become inactive, there is no point
    scanning the inactive lists if we are searching for VMA.
    
    This prevents the regression in firefox-fishbowl whilst maintaining most
    of the improvement with PutComposite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0c0a3765ca348c74096fb157885da5b1258ee08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 16:59:15 2011 +0000

    sna: Retire if the inactive vma list is empty
    
    Try to recycle vma by first trying to populate the inactive list before
    scanning for a vma bo to harvest.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34efb7314612cedcda4f866bc33f3ad5b6929ae2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 16:58:04 2011 +0000

    sna: Hint likely usage of CPU bo
    
    If we are going to transfer GPU damage back to the CPU bo, then we can
    reuse an active buffer and so improve the recycling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 301896743867de0cbd22063c4bf2e1a8cf491656
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 16:17:04 2011 +0000

    sna: Only upload to the source GPU bo if we need tiling to avoid TLB misses
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7f5d75aa54db7d0542b09f4b3081f7692ede602
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 16:11:34 2011 +0000

    Silence uxa-only compilation
    
    Kill the stray warning for the undeclared extern used by the module
    loader.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a73cc4bf1e554806f403c6704d1cf98491f4d444
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 14:54:12 2011 +0000

    sna/gen5: Tidy checking against hardcoded maximum 3D size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b43548af39f8773283b744e979ee575032183cdc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 12:11:01 2011 +0000

    sna: Explicitly handle errors from madv
    
    In order to avoid conflating whether a bo was marked purgeable with its
    retained state, we need to carefully handle the errors from madv.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 954cf5129d462f7f4ff5d4ff44b256e0f091667c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 10:40:35 2011 +0000

    sna/gen[67]: check for context switch after preparing source
    
    If we used the BLT to prepare the source, see if we can continue the
    operation on the BLT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90a432431c8fc293db611289c3369669c2975706
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 10:23:11 2011 +0000

    sna/gen[23]: Try BLT if the source/target do no fit in the 3D pipeline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eeb9741981be528d1fba3021a30ab24084a5ce8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 10:04:08 2011 +0000

    sna/gen3: Tidy checks against hardcoded maximum 3D pipeline size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcfcf438a511ee43e5969d01e41b3040a08cac3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 09:58:08 2011 +0000

    sna/gen2+: If we use the BLT to prepare the target, try using BLT for op
    
    If we incurred a context switch to the BLT in order to prepare the
    target (uploading damage for instance), we should recheck whether we can
    continue the operation on the BLT rather than force a switch back to
    RENDER.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 507debe8015ee10734a0b8a6ddf4aa251b7dddc5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 01:45:47 2011 +0000

    sna/gen5: If we need to flush the composite op, check to see if we can blit
    
    If we need to halt the 3D engine in order to flush the pipeline for a
    dirty source, we may as well re-evaluate whether we can use the BLT
    instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de530f89a36a80b652ed01001e6f0d4c8b1dc11a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 01:41:03 2011 +0000

    sna/gen5+: First try a blt composite if the source/dest are too large
    
    If we will need to extract either the source or the destination, we
    should see if we can do the entire operation on the BLT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b88f87945f23b3f80ae44b2aa19f00dff1904c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 18 00:44:00 2011 +0000

    sna: Upload images in place from CopyArea
    
    As for PutImage, if the damage will be immediately flushed out to the
    GPU bo, we may as well do the write directly to the GPU bo and not
    staged via the shadow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1418e4f3156a17ff6c5cd0f653918160e30b7c0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 23:11:03 2011 +0000

    sna: Tune the default pixmap upload paths
    
    One issue with the heuristic is that it is based on total pixmap size
    whereas the goal is to pick the placement for the next series of
    operations. The next step in refinement is to combine an overall
    placement to avoid frequent migrations along with a per-operation
    override.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25c353503a25d20e7db5acdc63d83564804efdf4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 17:16:07 2011 +0000

    sna: Simplify write domain tracking
    
    Replace the growing bitfield with an enum marking where it was last
    used.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d20d167a753d8e4fe581950e1bc49f29e0ec9f1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 16:28:04 2011 +0000

    sna: Upload to large pixmaps inplace
    
    When the pixmap is large, larger than L2 cache size, we are unlikely to
    benefit from first copying the data to a shadow buffer -- as that shadow
    buffer itself will mostly reside in main memory. In such circumstances
    we may as perform the write to the GTT mapping of the GPU bo. As such,
    it is a fragile heuristic that may require further tuning.
    
    Avoiding that extra copy gives a 30% boost to putimage500/shmput500 at
    ~10% cost to putimage10/shmput10 on Atom (945gm/PineView), without any
    noticeable impact upon cairo.
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd8fd6c90612ada39eb32b98adc5acc97e7902aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 12:38:09 2011 +0000

    sna: Search through the inactive VMA cache for potential upload bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ef5d8c1955e2e2ee19c64730f600639ac42de55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 17:52:20 2011 +0000

    sna: Map the upload buffer using an LLC bo
    
    In order to avoid having to perform a copy of the cacheable buffer into
    GPU space, we can map a bo as cacheable and write directly to its
    contents. This is only a win on systems that can avoid the clflush, and
    also we have to go to greater measures to avoid unnecessary
    serialisation upon that CPU bo. Sadly, we do not yet go to enough length
    to avoid negatively impacting ShmPutImage, but that does not appear to
    be a artefact of stalling upon a CPU buffer.
    
    Note, LLC is a SandyBridge feature enabled by default in kernel 3.1 and
    later. In time, we should be able to expose similar support for
    snoopable buffers for other generations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e47f283711d122d96384a1a82854c11644e6d68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 23:49:18 2011 +0000

    sna/gen3: Enforce a minimum width of 2 elements for the render target
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ff0826f94ca16e95cd662385f7091be750dec30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 23:33:25 2011 +0000

    sna: Discard GPU damage first before choosing where to fill_boxes()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55520bab578865f878965aa362ec4933f4b26050
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 23:22:38 2011 +0000

    sna/gen3: Initialise missing value of need ca pass for fill_boxeS()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e56d5081ea2da930bc82036ac7c4c78b433117ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 23:18:02 2011 +0000

    sna: Wrap I915_GEM_GET_PARAM with valgrind markup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0399ec1619fe4f87f0578791e697a7e2a8c86dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 23:07:37 2011 +0000

    sna: Suppress an overwritten XY_SRC_COPY
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1684ed6a5e8c26ecb48cc1a5025107466526fe94
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 19:35:35 2011 +0000

    sna: Clean up compiler warnings for shadowed variables
    
    No outright bug, just plenty of unwanted noise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 300586b229ae941ac31850af00d120d8c441c583
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 17:56:53 2011 +0000

    sna/gen4+: disable the blend unit for PictOpSrc
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0de7604d8ecfc73ef9e92059340d00ce5cfcdd75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 16 17:40:01 2011 +0000

    src/gen4+: Add support for depth 15 render copies/fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8fe50ab6503d9cb63931771318dc3e84d002092
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 11:15:36 2011 +0000

    uxa: Explicitly check for libdrm_intel in configure
    
    And remove the excess dependencies from the common files.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3320b459d6fe90d1145e3874c840b95279fb16c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 17 12:08:24 2011 +0000

    sna: Clean up caches stored upon the batch bo
    
    Until the advent of the VMA cache, we were safe to reap the batch bo by
    hand. However, as we continue to add additional data to the bo, it is
    wise to use the common free function.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43899
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2c8bac972cf46982bf64bd786ecc001009081f0
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Fri Dec 16 15:11:16 2011 +0800

    uxa/glamor: Fallback to new glamor pixmap if failed to create textured pixmap.
    
    If we failed to create textured pixmap from BO's handle, we
    turn to create a new glamor pixmap by call glamor_create_pixmap
    rather than fallback to in-memory pixmap. Have to introduce
    a new wrapper function intel_glamor_create_pixmap.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>

commit 19c184b7e4f8de747ed6fb1f6f910238193cf2a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 18:18:19 2011 +0000

    sna/gen3: Check for upload failure of video bo
    
    And propagate that failure back to the client.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=43716
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e68a8748f3418179eb41e8d81ba1050b883b7e47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 09:44:20 2011 +0000

    uxa: Move the region creation beyond the call into glamor
    
    So that we avoid leaking the region if hooking into glamor.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3153a779ed220ad71958ce56be179d458794964
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 09:30:28 2011 +0000

    sna: cap the number of times we attempt to resubmit the batch upon EBUSY
    
    Just in case the kernel gets stuck in a loop and we fail to make any
    progress at all.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1cc43dc97bd6438d7fc808cb5ee449889a966bdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 00:00:56 2011 +0000

    sna: More missing move-to-cpu allocation checks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12448b56060fb9c14da6b4ab02c95c7834fd3874
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 15 00:01:37 2011 +0000

    sna: silence warning for unused 'priv'
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb8e979b4de5d854f15ae4c86d3db29371b386c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 23:02:28 2011 +0000

    uxa/glamor: Allocate a fbPixmap with storage for fallbacks
    
    When we try to create a glamor pixmap and fail we need to create a real
    pixmap along with its pixel allocation, instead of detaching ourselves
    and returning the fake pixmap header.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 232fa93a4bf1760e16e913e8fb4d5159c4be9295
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 20:11:39 2011 +0000

    uxa/glamor: Always notify glamor that the glyph has been unrealized
    
    The danger of the early return when UXA is not using glyphs is evident
    in the eventual crash when glamor begins evicting and reusing its glyph
    cache slots.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95cceb5ae5503af0ac50a923fa47e134f0da8743
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 19:27:53 2011 +0000

    sna: Fix DBG crash whilst pruning inactive GPU buffers
    
    Don't attempt to dereference the NULL gpu_bo after having just freed it.
    Here in lies the folly of trying to blindly silence the compiler.
    
    Instead we should heed the error return as it means that we didn't
    decouple the pixmap from the inactive list and so we choose to place it
    back on the active list to purge again in the near future.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de
    References: https://bugs.freedesktop.org/show_bug.cgi?id=43716
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e7f4b7fd91a41cac77e5eb1cb4f185141b09a09e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 18:21:22 2011 +0000

    sna: Add some DBG() around Y-to-X fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32bb2c89b8cab92f16af32e7a084bfefa406661d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 16:28:54 2011 +0000

    sna: Check allocation of pixman_image_t
    
    And just fail to perform the copy, clearing the dst instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37c525a11c0fab4e279e80ad24e5cf791239e005
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 16:26:46 2011 +0000

    sna: Skip glyphs if we fail to allocate pixel data for them
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a8188bb4dd0eba58e29803566023ad5c3d4d58a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 16:24:54 2011 +0000

    sna: Close any handles after bo allocation failures
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43a22743124a83310379122d509c35840b583b2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 13:26:05 2011 +0000

    sna: Use the provided bo for blitting rather than assume priv->gpu_bo
    
    Reported-by: nkalkhof@web.de
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43802
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 30f5ee11f8ec3688807bbaded92561e96f9a439b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 12:30:40 2011 +0000

    sna: Use a static request and synchronous rendering in case of malloc failure
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23fb2cebbe1d4d7df7403a64635339efa08a4dfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 12:34:03 2011 +0000

    sna/blt: Add a missing allocation check upon the source CPU pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b0f3ff9a83b7cc932e96400999dc5e4a49369cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 12:23:04 2011 +0000

    sna/damage: Guard against malloc failures
    
    In the event of failure, we choose to loose track of the damage and
    choose rendering corruption over crashing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8b9a2a5473efd0fefb3d2878e70c24c320245ca
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Tue Dec 13 21:46:14 2011 +0800

    uxa/glamor: Enable the rest of the glamor rendering routines
    
    This commit hooks up all the remaining rendering routines to call into
    glamor; the takeover is nearly complete! When tested with the latest
    glamor master branch, it passes rendercheck.
    
    One thing need to be pointed out is the picture's handling.
    Pictures support many different color formats, but glamor's
    texture only support a few color formats. And the most common
    scenario is that we create a pixmap with a color depth and
    then attach it to a picture which has a specific color format
    with the same color depth. But there is no way to change a
    texture's internal format after the texture was allocated.
    If you do that, the OpenGL will allocate a new texture. And
    then the glamor side and UXA side will be inconsitent. So
    for all the picture related operations, we can't fallback to
    UXA path directly, even it is rather a straight forward
    operation. So for the get_image, Addtraps.., we have to add
    wrappers function for them to jump into glamor firstly.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    [ickle: prefer access; ok = glamor(); finish; if (!ok) goto fallback; return; ]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5456e40d9bebc9d6a121abdb124a90a2a8a6958
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 14 10:41:33 2011 +0000

    uxa/glamor: Silence a compiler warning for some unused code
    
    intel_glamor.c: In function 'intel_glamor_create_screen_image':
    intel_glamor.c:192:12: warning: variable 'pixmap' set but not used
    [-Wunused-but-set-variable]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f1a99a70e76ea5637c5ee8226b2e52a464f5948
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 19:44:15 2011 +0000

    sna: Protect against deferred malloc failures for pixel data
    
    As we now defer the allocation of pixel data until first use, it can
    fail in the middle of a rendering routine. In order to prevent chasing
    us passing a NULL pointer into the fallback routines, we need to propagate
    the failure from the malloc and suppress the failure, discarding the
    operation, which is less than ideal.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2c6d950ed2c5882e7d501b6974e72be4d6da8a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 15:04:10 2011 +0000

    sna: Mark upload buffers as unaccessible upon submission
    
    Use valgrind to catch use-after-finish bugs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e39ea29bcc5d1d76dd5cb3db555516ef848647a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 13:18:56 2011 +0000

    sna: Allow the debugger to map bo from the batch during kgem_submit()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2fabb5068d36ce97242844066b5121fcf6d9c24e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 13:15:51 2011 +0000

    sna: Debug fixup for non-LLC systems
    
    The cpu bo is only allocated on LLC systems, so do avoid the NULL deref on
    debugging for others.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e037379c8e57f8e42956863c10a4e2b18057a6d5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 13:14:15 2011 +0000

    sna: Fix a debugging assert
    
    The bo is allowed to be NULL, so defer the assert until after it is
    known to be non-NULL.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d5b2b8ee203ae2274fc7d13ed38d2945facca9e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 11:30:05 2011 +0000

    uxa: Cap the maximum number of VMA cached
    
    Since we can not keep an unlimited number of vma cached due to the hard
    per-process limits on the number of mappings and recreating mappings is
    slow due to excruciatingly slow GTT pagefaults, we need to compromise
    and keep a small MRU cache of inactive mmaps.
    
    This uses the new API in libdrm-2.4.29 to specify the limit upon the VMA
    cache maintained by libdrm.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1128825efb3179a5a5d951fa24db6b769ee41219
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 11:20:25 2011 +0000

    uxa: Wakeup 3s after the last rendering to reap the bo-cache
    
    libdrm expires its bo 2s after entry into the cache, but we need to free
    a buffer to trigger the reaper. So schedule a timer event to trigger 3s
    after the last rendering is submitted to free any resident bo during
    long periods of idleness.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db7c9e8561afcc1ca7ab16b3bf2d5b49938e26d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 10:05:25 2011 +0000

    configure: Link the extra valgrind debugging to --enable-debug
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d02dc0fd84194b6acc607d17e4396dd1fdc681f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 13 01:18:59 2011 +0000

    sna: Set the refcnt on the replacement bo
    
    The paranoia wasn't in vain.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7472db8c8c9994798ea36de1ce2f51725d8b387a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 21:55:04 2011 +0000

    sna: Double-check that the submitted buffers were not purged
    
    More paranoia is good for the soul.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0bbd6a08fe485c80bd5c9a1b7027618a03a26f84
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 21:52:56 2011 +0000

    sna/gen2: Tidy checking against too large pixmaps for the 3D pipeline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b392474f3a052fefc410383725b64f0fdbe7788e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 21:28:09 2011 +0000

    sna: Force a suitable minimum stride for 3D temporaries
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c22baaba97a89d24e507e3d832d53d764902040
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 21:16:56 2011 +0000

    sna/gen2: Check for unhandled pitches in the render pipeline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6a30df8dc75852d1f6daeabe4511b275594e52e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 20:40:29 2011 +0000

    sna: Enable memcpy uploads to SHM pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c163d105e964a1084d665500ef917254d8f2179
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 16:26:13 2011 +0000

    sna: Use the CPU bo as a render source if compatible and no GPU bo
    
    This is principally to catch the cases of compositing after a fresh
    PutImage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c481bec356b2e40e66a000dbaaf261bf7aae930d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 14:10:57 2011 +0000

    sna: Experiment with creating the CPU pixmap using an LLC BO
    
    A poor cousin to vmap is to instead allocate snooped bo and use a CPU
    mapping for zero-copy uploads into GPU resident memory. For maximum
    performance, we still need tiled GPU buffers so CPU bo are only useful
    in situations where we are frequently migrating data.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c9aa6f9cf8e59ca6aa1866b83690a1de8cfb757
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 11:47:25 2011 +0000

    sna: Defer allocation of memory for larger pixmap until first use
    
    In the happy scenario where the pixmap only resides upon the GPU we can
    forgo the CPU allocation entirely. The goal is to reduce the number of
    needless mmaps performed by the system memory allocator and reduce
    overall memory consumption.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b48d28f6e85f345730cb7242f2152ac115b267a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 10:52:34 2011 +0000

    sna: Fix a typo, end statements with semi-colons
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d20798c7871ffe8581e2cf509b6aa2e40b3ae5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 10:10:16 2011 +0000

    sna: We need to remap the gpu_only mmap prior to every use
    
    Since the VMA may be reaped at any time whilst the mapping is idle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2682308c10c9622247409dee9c6bb6a862b73c3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 09:24:11 2011 +0000

    sna: Remove bo transference for whole XCopyArea
    
    In benchmarking firefox this performs whose - it would appear the
    sources are indeed used more often than not.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7703424222f8bd08450c1b109ea64c6b0ee901d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 12 00:15:10 2011 +0000

    sna/gen6: Only use CPU bo for a render target if untiled
    
    For large render targets, we prefer to use tiled bo in order to avoid
    severe performance degradation. However, if we don't have a GPU bo but
    do have a CPU bo and the operation would be untiled, then simply use the
    CPU bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a92a41ba3291a4304948ed1961d1242ca7d3981e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 19:03:54 2011 +0000

    sna/gen6: Tidy the usage of the max pipeline size
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9e6d6f7c8af300716c64b041f96c09d58b3eaa2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 17:25:46 2011 +0000

    sna/gen3: Move the video dst_bo to make the conditional clearer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 118ef0781c5064aa0696af59a5dac67091b10046
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 16:56:53 2011 +0000

    sna/composite: Make the check for a no-op earlier and clearer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2674ef864c93034d728ee11ee0b7ab96cd4cba57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 16:23:13 2011 +0000

    sna: Enable hooking up of valgrind during debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c83fd4e24de187700bc125037cd9ae311514213e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 16:14:38 2011 +0000

    sna: Add some more debug messages for VMA caching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3ae7fb918a2ca47d3944521a1ae30143dcb14eeb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 13:52:42 2011 +0000

    sna: Restrict pitch alignment on 945gm to 64 bytes
    
    In theory we should be able to disable dual-stream mode and so be
    subject to much looser restrictions (such as the pitch need only be
    dword aligned). However, achieving single-stream mode seems quite
    difficult!
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=43706
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f35d77cd07a4974051c922f4809ce44939b0556
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 13:37:18 2011 +0000

    sna: Update computation of untiled pitch to cater for CREATE_SCANOUT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a0139487f5a5caada56121395aa166fc9f08663
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 12:34:40 2011 +0000

    sna/gen3: Ensure that depth read/writes are disabled before first use
    
    Our goal is to achieve "single-stream" rendering where the entire
    RenderCache is allocated to the colour buffer (rather than split between
    colour and depth). In theory all that is required is for the pipeline
    not to reference the depth buffer at all, however it is not made clear
    when that evaluation is made.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a02bbd8700690c98c6cf3ae98dd7ee3da9887b0a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 10:34:37 2011 +0000

    sna: Only transfer the bo if the src/dst are of matching size
    
    If the src replaces the dst, it could just be a much larger pixmap!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 43a99648635fa76e0d6d71acaeb6ba919d24eb26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 10:30:48 2011 +0000

    sna: Only transfer unpinned buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb859f644633ee716083d253a5b7ff95163380e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 11 01:34:05 2011 +0000

    uxa/video: Correct the offset of the binding table in the surface buffer
    
    The binding table is intended to be after all the surface descriptions,
    so make sure we write it with the appropriate offset into the buffer.
    
    Fixes regression from 699888a64 (uxa/video: Use the common bo
    allocations and upload)
    
    Reported-by: Cyril Brulebois <kibi@debian.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43704
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 051a18063df075536cb1ac0dc4dfc3c1306ab74e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 22:45:25 2011 +0000

    sna: Implement a VMA cache
    
    A VMA cache appears unavoidable thanks to compiz and an excrutiatingly
    slow GTT pagefault, though it does look like it will be ineffectual
    during everyday usage. Compiz (and presumably other compositing
    managers) appears to be undoing all the pagefault minimisation as
    demonstrated on gen5 with large XPutImage. It also appears the CPU to
    memory bandwidth ratio plays a crucial role in determining whether
    going straight to GTT or through the CPU cache is a win - so no trivial
    heuristic.
    
    x11perf -putimage10 -putimage500 on i5-2467m:
    Before:
      bare:   1150,000   2,410
      compiz:  438,000   2,670
    After:
      bare:   1190,000   2,730
      compiz:  437,000   2,690
    UXA:
      bare:    658,000   2,670
      compiz:  389,000   2,520
    
    On i3-330m
    Before:
      bare:    537,000   1,080
      compiz:  263,000     398
    After:
      bare:    606,000   1,360
      compiz:  203,000     985
    UXA:
      bare:    294,000   1,070
      compiz:  197,000     821
    
    On pnv:
    Before:
      bare:    179,000   213
      compiz:  106,000   123
    After:
      bare:    181,000   246
      compiz:  103,000   197
    UXA:
      bare:    114,000   312
      compiz:   75,700   191
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 735a15208dd600eefa3090f344186df9cac0462d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 23:45:56 2011 +0000

    sna/gen5: Remove a redundant format check
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5584252c34b792313578cc31d56248d8990b571
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 23:34:16 2011 +0000

    sna: Remember to assign a new unique id for the replaced bo
    
    Missed from the previous patch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c764dc13be40fc14238a4c130f7d8b44dbdf7db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 22:38:57 2011 +0000

    sna: Be more pessimistic with CPU sources
    
    Try to avoid a few more unnecessary context switches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 358aaef6dbff0737f026046b0c9a2e21d8cfdf2a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 22:38:33 2011 +0000

    sna/dri: Prefer using the BLT for DRICopyRegion on pre-SNB
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c295ad8da91e39c8fffa540901097651df5d24b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 22:37:31 2011 +0000

    sna: Transfer the whole bo for a replacement XCopyArea
    
    If we are copying over the entire source onto the destination,just copy
    across the GPU bo. This is often used for caching images as pixmaps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ece7fc8afeb8eefcf0ad1a054f02e7fac8db6327
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 21:04:08 2011 +0000

    sna: Only use the 64-byte pitch alignment for scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3816cf3a99d23d0c3ab4cd716b24ea544a07283
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 20:32:56 2011 +0000

    sna: Remove assertions that external bo are not busy
    
    We have to be careful to assume bo via exposed are under our full
    control, in particular not to assert their state. :(
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b5a6bc9e33a2797c926969e1f98b4a9a796248c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 13:14:45 2011 +0000

    sna/gen[23]: Fixup render targets with pitches below hw minimum
    
    gen2/3 have a restriction that the 3D pipeline cannot render to a pixmap
    with a pitch less than 8/16 respectively. Rather than mandating all
    pixmaps to be created with a stride greater than 16, fixup the bo for
    the rare occasions when it is necessary.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43688
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0dab7b1cf17fe751c86ad2b3fabce682eb50366
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 12:46:46 2011 +0000

    sna/trapezoids: Try to render traps onto a8 destinations in place
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c73b14cabb059075af0f1727847074a89941c9df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 10 11:41:18 2011 +0000

    sna/trapezoids: First try the scan converter for fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22d9bc0bc1ccd869ebcc93f9a57efc8a85840cb8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 23:48:11 2011 +0000

    sna: Use a single definition for the inactive cache timeout
    
    And share it between the timer and the expiration function, just to
    simplify the code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb3e04d960cd749adf696ba15c501a17cd1a184e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 23:36:56 2011 +0000

    sna: Fallback to ordinary monotonic clock if coarse is not supported
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c202cc0746541b541d0af22eab5c9798d229a69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 17:25:19 2011 +0000

    sna: s/MONOTONICE/MONOTONIC/
    
    A late addition to be flexible for compiling on different systems
    heralded its doom.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c51626ccb660c777da8d84bb425de0d590864448
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 15:45:29 2011 +0000

    sna: Use the coarse monotonic clock to coalesce wakeup events
    
    For the long interval events (such as expiring the caches), we do not
    need precise timing and so can use a coarse timer to allow the system
    to coalesce and reduce wakeup events.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c22197f25bc0419d9f2abfcc978df5ef439feb47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 15:12:03 2011 +0000

    sna: Discard bo for idle private pixmaps
    
    If a pixmap lies around for a couple of minutes not being used, it is
    unlikely to be used again in the near future. Reap the GPU buffers of
    any of those idle pixmaps (copying to a more compact buffer in system
    memory) in order to free up resources for use elsewhere. Any object
    that is exposed via DRI is obviously exempt from this reaping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 429a36f7481b9bfd5ed137642d2916d69a713557
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 9 09:54:12 2011 +0000

    uxa: Fix clip processing for uxa_fill_spans()
    
    Fixes regression from e0066e77e026b0dd0daa0c3765473c7d63aa6753
    (uxa: Simplify Composite solid acceleration for spans by only clipping
    once) [2.15.901]
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43649
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 699888a6410b0699c69a7f8a8d82dc4fde6fcc7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 16:55:20 2011 +0000

    uxa/video: Use the common bo allocations and upload
    
    In order to avoid inconsistent usage of coherency domains and to avoid
    completely unnecessary clflushing during video playback, use the same
    buffer allocation and upload functions as the rest of the driver.
    
    Reported-by: Christophe Roland <roll68@gmail.com>
    Bugzilla: http://bugs.debian.org/cgi-bin/bugreport.cgi?msg=60;bug=651316
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 706d3a97bd3049e60c08d121a3d4d81c03029a87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 18:05:14 2011 +0000

    sna/trapezoids: Fix detection of rectilinearity after projection
    
    A typo confused left and right, rejecting true vertical edges, and worse
    might have incurred false positives.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc081420a5d6d28c4e6fd5527a70caaa3a8361c4
Author: Simon Que <sque@chromium.org>
Date:   Wed Dec 7 16:20:41 2011 -0800

    xf86-video-intel: change order of DPMS operations
    
    The operations when setting dpms on should be in the order opposite
    of what's done when setting dpms off.
    
    This is because of potentially conflicting effects:
    ~ drmModeConnectoSetProperty() enables/disables the backlight driver.
    Some backlight drivers such as intel_backlight set the backlight to 0
    when disabled and to max when enabled.
    ~ intel_output_dpms_backlight() saves the backlight value when turning
    DPMS off and restores it when turning DPMS on.
    
    Here's the current order of operations:
    
    xset dpms force off (backlight is nonzero)
       drmModeConnectoSetProperty(DPMSModeOff)
          kernel: disable backlight, backlight=0
       intel_output_dpms_backlight(DPMSModeOff)
          save backlight value (0) <-- it has been set to 0 by kernel
          set backlight to 0
    
    xset dpms force on
       drmModeConnectoSetProperty(DPMSModeOn)
          kernel: enable backlight, backlight=max
       intel_output_dpms_backlight(DPMSModeOn)
          set backlight to saved value (0)
    
    The correct way to do this would be to reverse the operations during
    xset dpms force off:
       intel_output_dpms_backlight(DPMSModeOff)
          save backlight value (nonzero)
          set backlight to 0
       drmModeConnectoSetProperty(DPMSModeOff)
          kernel: enable backlight, backlight=0
    
    This restores the saved nonzero backlight value during the force on.
    
    Signed-off-by: Simon Que <sque@chromium.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84aaf1537cbd29e163346d03debc39f4623c69eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:36:08 2011 +0000

    sna/gen7: Reduce dst readbacks for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 440ac68ec074e82818713773f3e2cb5d363862aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:35:54 2011 +0000

    sna/gen6: Reduce dst readbacks for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc68211d18356c4a0e011ac360665d600de9fa30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:35:39 2011 +0000

    sna/gen5: Reduce dst readbacks for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5df7c28e458c2f2b173fe5d745f447087eb8c6f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:35:22 2011 +0000

    sna/gen4: Reduce dst readbacks for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cc8cab649c0a4788803d2c62f186142ec7152b89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:34:58 2011 +0000

    sna/gen3: Reduce readbacks on dst for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5bc0c823b8fd46b3f851c5e9a4b4de39cda9a91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:34:34 2011 +0000

    sna/gen2: Avoid readbacks for unsupported sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 874c722c86b06ac0aa10e6943d3faf76fcb751be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 8 12:07:28 2011 +0000

    sna: Beware flushing partial buffers before they are written
    
    A partial buffer is considered finished upon the next batch submission,
    so one needs to be careful that it is completely written to before such
    an event is triggered. move-to-cpu is such a trigger as demonstrated by
    the picture fixup routine for handling convolution filters.
    
    Reported-by: Victor Machado <machado.prx@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43607
    Signed-off-by: Chris Wilson <ickle@crestline.(none)>

commit 6ccb114a7e685c69fb388ebd119393455b315c36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 7 21:09:31 2011 +0000

    sna: Prefer to use our pixmap upload paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 101942d41df7efaa6103e31e738775fafdb63159
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 5 10:11:04 2011 +0000

    uxa: Unmap the buffer after swrast
    
    Otherwise we may exhaust the per-process vma limit and cause
    applications to stop rendering and eventually crash the X server.
    
    Will only work in conjunction with a new libdrm (2.4.28) and commit
      c549a77c (intel: Unmap buffers during drm_intel_gem_bo_unmap)
    in particular.
    
    Reported-by: nobled@dreamwidth.org
    References: https://bugs.freedesktop.org/show_bug.cgi?id=43075
    References: https://bugs.freedesktop.org/show_bug.cgi?id=40066
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b424b10e771b1d3d041efdd2b77f576251364744
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 4 13:01:10 2011 +0000

    sna: use tight pitches for a8
    
    As we never use these with a depth nor attach them to scanout, we can
    safely relax the multiple-of-64 byte pitch restriction. In the unlikely
    event that we do need A8 surfaces with depthbuffers, this is broken...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46c7df803881fa0e733c0d0fdd37567ebdccd6ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 3 18:02:00 2011 +0000

    sna: Remove one redundant retire
    
    There is no need to retire immediately after a batch and no indication
    that it will be useful.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b99c6b13ebba9521333b8dd5982ac37b6e244b54
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Dec 3 18:01:11 2011 +0000

    sna: Pass the current value of the batch offset to the kernel relocator
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 735219cd59e6184a6622d3d429a704ca3f58b9cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 2 10:42:00 2011 +0000

    uxa: Ensure that we can fallback with all of (src, mask, dst) as GTT mappings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6c82c73b673ec3c9cce432fe38d5e0076234efd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 2 10:34:10 2011 +0000

    uxa: Fix runtime linking of previous commit
    
    So much for relying on compiler warnings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85d3dc5910a2eea3a10b822e01443e11eaae9291
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 2 10:22:51 2011 +0000

    uxa: Reset size limits based on AGP size
    
    The basis for the constraints are what we can map into the aperture for
    direct writing with the CPU, so use the size of the mappable region as
    opposed to the size of the total GTT.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e55198746102afb7427f577bd5bfc76667438da9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 1 13:49:03 2011 +0000

    sna: Reuse the full size of an old handle for io
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5632369cbd6473304c06e4230347abbe46513ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 1 13:23:56 2011 +0000

    sna: Move the preservation of the io handle into the common destroy path
    
    In order to capture and reuse all io buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95f4da647a4055545b09cae0834df0fa2127a458
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 30 11:59:31 2011 +0000

    sna: Align pwrite to transfer whole cachelines
    
    Daniel claims that this is will be faster, or will be once he has
    completed rewriting pwrite!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ecd6cca617ac29cf2b1b2a4d33fca19b84fea2a9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 29 19:27:46 2011 +0000

    sna/gen5: Handle cpu-bo for render targets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8f2e87473eae81e07922271b5f608fdceb4ae5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 29 10:59:48 2011 +0000

    sna/render: Fix check for "migrate whole pixmap"
    
    The whole pixmap means the sample covers the full width and height, not
    just either!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20e57914089d6959529ad222e04853f5ffcb364f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 29 10:59:20 2011 +0000

    sna: Fix assertion around flushing of mmap(PROT_READ)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56155c91afb5a0dcafe4dbc22ade3b7c0c977674
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 29 10:27:18 2011 +0000

    sna/gen6: Set the batch mode prior to checking limits and flushing
    
    If we change contexts, then we will submit the batch obsoleting the
    earlier resource checks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b1e9e15738b9001346ab6e0166f861ce308008e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 28 22:01:00 2011 +0000

    sna: Always reduce tiling for thin pixmaps
    
    Benchmarking on the current code base, says this is now a win. A
    reversal of older benchmarks, so expect further tuning.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dacb301c05dd1686e788d6ed8101887c27968389
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 28 18:59:10 2011 +0000

    sna: Use the correct pitch when creating an untiled active buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8657128fa7e758a2dde93340d6e58928d5f11255
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 28 18:22:01 2011 +0000

    sna: Pass the pixmap to sna_replace()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e38d22105da2bd97db005dc505e75dcd22291d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 28 18:21:19 2011 +0000

    sna: Tidy kgem_choose_tiling()
    
    Reduce the calls to compute the surface size down to one.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04f47e52da06cc20c2a266da92ba3f8e961433cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 27 17:45:05 2011 +0000

    sna: Don't try to guess when the kernel believes a buffer to be flushed
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d87c332653001db4413c7dd81116ee03830db491
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 27 10:18:11 2011 +0000

    sna: Eliminate empty glyphs during format conversion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 413776c79ee7c55b3a48b1ed29af63f8cea39337
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 27 10:17:40 2011 +0000

    sna: Use 64-bit mov (when available) for bitmap glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 507f99eba2c72bc109c9267c698f3d5f9fb6f539
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 26 17:57:57 2011 +0000

    sna/gen6+: Only use BLT if the untiled bo will cause per-pixel TLB misses
    
    i.e. only force the BLT if using the sampler is going to be incredibly
    slow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f11e9f189111f53ace20381a0bd4f559ccd3605f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 26 17:12:03 2011 +0000

    sna: Only check for all-damaged CPU bo if we may discard the GPU bo
    
    The goal of the optimisation is to discard the GPU bo early, so we
    can skip the extra damage reduction if there is no gpu bo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccee730e45d8c2490e578d0b85d9e76f3a44f76f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 26 16:47:04 2011 +0000

    sna: Discard the gpu-bo is the entire pixmap is written to by the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df68b20a17e28c0898226f970315bc8e515e9f56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 26 16:45:22 2011 +0000

    sna: Disabling tiling if the bo would be smaller than a page
    
    Once again experiment with untiled smalled buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d88ad2e60ac3d9f5608db1653a7af789f7f1b446
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 27 09:01:09 2011 +0000

    sna: Round up stride to alignment for TLB miss checking
    
    We want to avoid the condition of reducing the tiling mode (when reusing
    an active untiled buffer in preference to creating a new) for a wide buffer
    when doing will force a TLB miss on each sample.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16f5e224dcfd97012b38ee1af6c72dbe3c0f3304
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 25 16:21:41 2011 +0000

    sna: Avoid the double application of drawable offsets for tiled spans
    
    As we handle tiled spans indirectly, we need to avoid applying the
    drawable offsets twice (once in the mi layer generating the spans, and
    then once more in the tiled rect renderer).
    
    Reported-by: Ulrich Müller <ulm@gentoo.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43245
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e06789871b5cdf0c5535d46622b8ec3f85eb4386
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 25 15:24:29 2011 +0000

    sna/gen5+: Prefer using the BLT when either src or dst is untiled
    
    The cost of the TLB miss on every sample far outweighs the impact of the
    context (and ring) switch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0cce0da71fae275a0f1be33b2bebad9d41212c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 25 13:16:37 2011 +0000

    sna/gen5: Use the same prefer_blt_fill() switch for fill-one
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ad2d3b695115439f685a12d43ab240cf5e18ef7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 25 09:44:21 2011 +0000

    sna/gen2: Wire up NO_COMPOSITE for debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 394ad51c421f41e4bc6545fcee10b1757cb5f518
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 17:35:36 2011 +0000

    sna/video: Check for Xv presence in the server before initialising
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a2fab9560ec5dd6efc352917fe7626e59bed69e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 17:14:08 2011 +0000

    sna: Downgrade Y-tiling if we must use the BLT
    
    There are many operations, usually the core drawing acceleration, where
    the BLT is much more preferable than using the CPU. However, the BLT is
    limited to only using X-tiling, so if we encounter a Y-tiled pixmap
    target we need to recreate it as X-tiling before proceeding. Hopefully,
    the pixmap is then kept around and rendered multiple times to amoritize
    the cost of the copy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0a4492c8b51d6ae09cde0b895da6177284e95e0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 17:00:18 2011 +0000

    sna: Use Y-tiling for source pixmaps
    
    Y-tiling is slightly faster with RENDER operations, so attempt to
    allocate source-only pixmaps using this tiling mode. Actually using
    Y-tiling is a delicate balance because it then prevents the use of the
    BLT. For instance, enabling Y-tiling by default gives a 30% performance
    improvement on the fish-demo (compositing benchmark) at 2560x1440 on
    Ironlake but regresses tiger-demo by 2x (spans benchmark).
    
    So experiment with this compromise and allow for changing the default
    tiling.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e4a1b7ed25a881113e197acde62b07f26f2d6ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 11:34:51 2011 +0000

    src/sna/gen5: Replace the precompiled shaders
    
    Take advantage of a couple of new instructions introduced with Cantiga
    to reduce the instruction count inside the shaders and improve
    performance by around 10% in the fish-demo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67ea8808d7f0ce47733a66d8708dcfa0dbec14c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 11:45:38 2011 +0000

    sna/gen5: Remove the unused SIP
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 499ed74e979d99bbe1670ad54875fba6055fce5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 11:02:01 2011 +0000

    sna: Tweak cancellation of deferred flush
    
    The goal is to keep running until the tick after every stops,
    irrespective of forced flushes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35239d207c38e1ae0cb843ed7a72621711cb001e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 02:51:51 2011 +0000

    sna: Always call retire following a mmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11e0b456de93dae9f7ba4298d8a32b6b60edc503
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 03:04:09 2011 +0000

    sna/gen5: Use the BLT rather than flush when copying
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a44663af9335136cba59b12078c6717992283b62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 24 02:54:43 2011 +0000

    sna/gen4,gen5: Fix typo and only emit a flush if the video source is dirty
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a27dd287cdb85d80ceaf6b54e7de0c17e01c00d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 21 12:56:32 2011 +0000

    uxa: Make the glamor/uxa transition more verbose
    
    And so hopefully make it clearer. In the process we restore the flushing
    behaviour for UXA back to before the glamor intervention.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0d64a9567d9cb749568448e4ce090b187308028
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 21 11:49:49 2011 +0000

    sna: Correct end-point adjustment for stippling PolySegment
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Reported-by: da_fox@mad.scientist.com
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43134
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5353a7c1d1f02b887f61f543c8e4bd4e8bd104f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 21 10:58:17 2011 +0000

    sna/gen4: Use the special composite rect emission for fill_one()
    
    In order to workaround a bug in the shaders on gen4, we need to flush
    the pipeline after every rectangle. The recently introduced fill-one
    mechanism for gen4, missed this vital step triggering a random hang with
    an otherwise sane batchbuffer (the missing flush is hard to spot!).
    
    Fixes regression from 86f99379ee5 (sna/gen4: Add fill-one).
    
    Reported-by: Albert Damen <albrt@gmx.net>
    Reported-by: Fryderyk Dziarmagowski <fdziarmagowski@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43083
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b9479dc39d32fd97f80c1e5e0fac67d36ee5e40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 19 19:12:06 2011 +0000

    sna: Micro-optimise sna_push_pixels_solid_blt()
    
    Unroll the byte reversal as we know the row length is word aligned.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 297f7680cfd73ab6eb099adca7aefe00e61c9e85
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 19 16:11:42 2011 +0000

    sna: Avoid the NULL damage deref
    
    Fixes x11perf -wdcircle100 -time 1 -repeat 1 -rop GXxor
    
    Reported-by: Fryderyk Dziarmagowski <fdziarmagowski@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=43084
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a86ec5ddbaf119fd9a32ecd963f7238152d7d28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 19 00:33:28 2011 +0000

    sna/gen7: Apply recent SNB tuning as applicable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fe944d61d53c275a168da2e9515d1e42be81630b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 19 00:02:17 2011 +0000

    sna/gen7: Correct shifts for surface state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70042400fd95f613b9547d0a72d6288abcc2357d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 18 23:41:33 2011 +0000

    sna/gen7: minor tidy of redundant defines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f938cd15990d1a851b9d92414545dda37f00c5db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 17 13:43:37 2011 +0000

    glamor: Include glamor cflags and libs for atypical builds
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb6148a36a318eb0b4aad865c34b50fedf4b709e
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Wed Nov 16 15:04:37 2011 +0800

    uxa/glamor: Turn on glamor for fill spans and rects
    
    This commit only enables two glamor functions for
    uxa_fill_spans and uxa_poly_fill_rects.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbabe60f48006ee664c983082498a863e8beec71
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Wed Nov 16 15:04:36 2011 +0800

    glamor: Initial commit to introduce glamor acceleration.
    
    Added one configuration option --enable-glamor to control
    whether use glamor. Added one new file intel_glamor.c to
    wrap glamor egl API for intel driver's usage.
    This commit doesn't really change the driver's control path.
    It just adds necessary files for glamor and change some
    configuration.
    
    Reviewed-by: Eugeni Dodonov <eugeni.dodonov@intel.com>
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4c2eb1fae2518578a56a278afeaec66d544439d
Author: Zhigang Gong <zhigang.gong@linux.intel.com>
Date:   Wed Nov 16 15:04:37 2011 +0800

    uxa/glamor: Introduce additional access modes to wrap glamor acceleration
    
    Integrate glamor acceleration into UXA framework. Add
    necessary flushing at the following points:
    
    1. Flush UXA batch buffer before call into glamor.
    2. Flush GL operations after return from a glamor function.
    3. The point we need to flush UXA batch buffer, we also
       need to flush GL operations, for example, in
       intel_flush_callback and couple of places in intel_display.c.
    
    Signed-off-by: Zhigang Gong <zhigang.gong@linux.intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac7df2919b92c9fe47c6745975e1848932f989e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 16 23:25:16 2011 +0000

    Revert "Disable adding normal RTF modes for an eDP"
    
    This reverts commit 212fa9868767637e8f430485eeb522c99e63fd16.
    
    The underlying register programming for eDP is now believed to be fixed
    as of linux-3.1.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=38012
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=41070
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24ece4a87e34c27115ffb55f91294bce2bdf1502
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 16 23:14:25 2011 +0000

    configure: Version bump for 2.17.0 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 14b3176962bd535933623d8ed77ba286b077d6f0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 16 23:13:44 2011 +0000

    NEWS: Release notes for 2.17.0
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c259144e3fc52d078b0a78107c38f0f3d3a2bbc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 16 10:28:23 2011 +0000

    sna: The block handler is passed an indirect pointer to the timeval
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfd2bb40274d1242001d295a4010211fd51b0fc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 15 10:38:09 2011 +0000

    sna: Correct dependencies for DRI2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3771387ad11b5842a83e58a4b373c2acdd827bd2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 15 10:32:34 2011 +0000

    Compile out UXA if so desired
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit edbeab8c4edf9e0e89d85add485fe659795b6350
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 15 10:17:06 2011 +0000

    sna: Reduce and clarify dependencies
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78d4e99fc916e6477edb01c6f24b69ad73adc552
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 15 11:06:04 2011 +0000

    sna: And keep unity happy
    
    Rewrite the DRI layer to avoid the various bugs and shortcomings of the
    Xserver and interfacing with mesa.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=38732
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=39044
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aac022cbb3342e7027301a3f8c9add8929edbad6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 19:49:29 2011 +0000

    sna: Optimise single pixel transfers
    
    Surprisingly frequent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5647e2981d81fd2b5cdb22d544f83d2d0f9445c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 14:11:56 2011 +0000

    sna/damage: Always reduce damage for testing PIXMAN_REGION_OUT
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42414
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 405b015fe255c75f91b0f3fe93f06bd14faee5a1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 14:05:10 2011 +0000

    sna: Be explicit in all sna_damage_contains_box() tests
    
    Clarify the exact in/out/maybe expected result when testing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d23149647b1645057dbd89087691e873494f763
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 13:53:37 2011 +0000

    sna: Remove redundant 'can_fill_spans()'
    
    Spans are almost always accelerated now...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae9de984adb275e028e7fbcb8b74a3ce11920eed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 13:39:34 2011 +0000

    sna: Convert non-FillSolid rectilinear lines to boxes
    
    And render using the tiled/stippled rect routines instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e861e816f53989ce3ab3ec89dd1d9a35155f999a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 13:39:34 2011 +0000

    sna: Convert non-FillSolid rectilinear segments to boxes
    
    And render using the tiled/stippled rect routines instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fc2928f578ae1e278c968d5c778d99d56bd667a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 13:05:00 2011 +0000

    sna: tidy assignment of composite damage
    
    Make sure that the damage is always set, even if only to NULL, so that
    we are safe if in future the operation state is not initially cleared.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 99338ebe61917a07611cbc81cfaf70c0ec905014
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 12:04:49 2011 +0000

    sna: Check whether damage can be reduced to all-damage on moving to GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00d1c539e4b69636bfc35c0c47a6f1db3a33e731
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 11:19:42 2011 +0000

    sna/damage: Add a little more verbosity to debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 60c0fc101adbc457a7c1927602175f8079175e10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 11:12:47 2011 +0000

    sna: Refactor some common code into the common destroy-gpu-bo function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 571457e9a4b0941ec956ef98391e96fe90fb4abc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 10:31:21 2011 +0000

    sna: Be more thorough discarding fences for large objects
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e33dfbe3c00e634328adc7319261e5501f4c7a7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 09:41:53 2011 +0000

    sna/damage: Verify that all-damage covers the entire pixmap after reduction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f033172d2f383c7e17362a10f56c4958fb9a3a6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 09:32:53 2011 +0000

    sna: Fix debug compilation
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42887
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c405595fb8739b22569f81f400100b5dfa472cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 09:27:49 2011 +0000

    sna: Downgrade tiling in order to fit within fence constraints
    
    Fixes a later assert that the fenced size is valid for kgem_create_2d()
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42888
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1baff9f8cf79fdb4a5649eabcc66cf73487c873e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 14 08:44:35 2011 +0000

    uxa/gen4+: Re-emit composite invariant after video
    
    Reported-by: Ben Hutchings <ben@decadent.org.uk>
    Bugzilla: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=635953
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ad3b377a394c9342c3ab2f003d48b7cb3c0891d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 17:53:11 2011 +0000

    sna/video: Use the right pointer for unmapping
    
    Don't just deference any old random pointer, use the one we actually
    mapped in the first place!
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42880
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8da8809d03734d92c3bcf478fe051077ce3caa29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 17:49:23 2011 +0000

    sna/video: Simplify check for 915G[M] which is simply gen==30
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cac335b979a95e31e201f9766d19d737361e09b2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 13:13:03 2011 +0000

    sna/video: Constify a couple of attribute arrays
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e592eb93dbd7df177993986f01ba6f65c4e20d4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 11:16:45 2011 +0000

    configure: Version bump for 2.16.902 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56707b97dc746f7b46dd6cf94ba6c1db85ed619c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 11:16:12 2011 +0000

    NEWS: Details for 2.16.902
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f0acc6c0f15875fd51f6df6c8f13d589f9149771
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 13 09:39:47 2011 +0000

    sna/composite: Attempt to reduce the damage is the operation is contained
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87147b63e905c3566ac1c12e0712f068e90d5e2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 12 19:35:43 2011 +0000

    sna/damage: Reduce the damage for evaluating sna_damage_is_all
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8799cdea461df5102d421fda26fecceae79b929
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 12 12:19:31 2011 +0000

    sna: Be stricter and disallow allocation of large fenced objects
    
    When allocating objects, we need to check the size of the full fenced
    regions against the mappable limits in order to be able to mmap the
    object later.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42813
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0269ec5533ecf7bec0f01c682e085861a3d2ab00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 12 11:49:32 2011 +0000

    sna: Handle incremental uploads from PutImage
    
    PutImage rarely uploads the entire image inside a single request,
    instead breaking up into scanline segments to fit within the protocol
    limits. A few optimisations are based on detecting when we can discard
    the GPU bo for an all-dirty CPU pixmap, which are useful in this case so
    check for an entirely dirty pixmap following an incremental PutImage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ed68f1b00ae7c0fb3be1f0e758b3683f3c26675b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 12 11:13:59 2011 +0000

    sna/gen7: Fix PRIMITIVE command
    
    The topology is now an extra dword rather than an embedded field in the
    command.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 991ffcb60a15f08ebb396d4d4ec86d5aff0ded31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 11 23:20:36 2011 +0000

    sna: Reset the source counter if we completely dirty the CPU pixmap
    
    For a long lived pixmap which we are repeatedly using for upload and
    copying to other pixmaps, we don't want to keep to maintain a GPU
    buffer. So instead, reset the source counter if we discard the GPU bo
    and treat the pixmap as purely CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 403a4dd353eef67decfba965e40623e8137e1944
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 11 14:59:03 2011 +0000

    sna: Defer source migration for a solitary upload via CopyArea
    
    Try to avoid allocating a GPU pixmap for PutImage followed by CopyArea.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11acfaa62362660ff303f3afe90d1afa36b9ce73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 11 14:46:33 2011 +0000

    sna/glyph: Tweak the small mask threshold
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6e6ae1829e06ee8fe8eb063f2433cce603c9f96
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 11 14:22:38 2011 +0000

    sna/glyphs: Cache the glyph pixman_image_t wrapper
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f50950f467eb2440009a807081f3ba2c9db209b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 15:58:36 2011 +0000

    sna/gen7: Remove stray no-op from GEN7_3DSTATE_SBE
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a8338fc08a1b7e5e2c6722baa87cff3915b6ef9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 15:11:13 2011 +0000

    sna: Begin debugging gen7
    
    This is the stub of the decoder, sufficient to give details of the ops
    within the batch and to keep the debugger happy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2309f19638f8b2c35eb60fb44fa988aa5aaab57f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 11:57:21 2011 +0000

    sna/dri: Apply the damage for fullscreen async blits
    
    Otherwise gnome-shell forgets to update. Eventually, I'll get the async
    pageflipping bits merged into the Xserver and this path and its extra
    bw wastage will be history! But still I'll be undermined by the
    compositor, grrr.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e65c2c54f5efcec16e97085dbc41042007c39151
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 11:37:46 2011 +0000

    sna: Store the sna pointer on the pixmap for cheap lookups
    
    A large part of the function preamble overhead is the multi-indirection
    lookup for retrieving the sna pointer. We can eliminate most of these by
    storing a pointer on the Pixmap as well, which we often need to lookup
    anyway.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bddac63de2d26c6ad4ade2f0a038d756f7a41424
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 10:55:13 2011 +0000

    sna: Defer purging a target buffer
    
    This is to keep the sanity checks upon the caches happy by keeping a
    potential flush out of the inactive cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9083f7edcb05b1deb7a77c9c5a8b54fe73176648
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 10:51:32 2011 +0000

    sna/gen3: Fixup some false asserts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea01f7681901e3181204d3117fc0a23655de631f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 10:51:01 2011 +0000

    configure: Force full-debug builds to disable compiler optimisations

commit a72563464f53f24246379afcf1365206fae9aad3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 10 00:55:55 2011 +0000

    sna/gen3: Clear the video shader flag upon batch reset
    
    Fixes regression from 3252b46e1.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3252b46e115e6cc46abbcc4f502feeb9edc31ad6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 15:16:04 2011 +0000

    sna/gen3: Pack video frames
    
    If you're going to benchmark, you may as well do so favourably.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e926759528a12076bd7565672acd82a37aa3eb1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 14:44:54 2011 +0000

    sna/video: Pass texture video limits to the client
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bca58ff6f02b20ccf88937df8e2688f18cabac80
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 14:18:57 2011 +0000

    sna: Clear kgem->busy when all requests have been processed
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8fdbd01c94c0f6f56247feed8f225901ba39e18e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 13:14:04 2011 +0000

    sna/video: Use the normal bo cache for texture video streams
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 436a78684507129ca1245e065ff68870eb27624b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 12:48:27 2011 +0000

    sna: Track purgeability separately from reusability
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2699c01a396b644a35a9acb969ab556454be3517
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 12:27:52 2011 +0000

    sna: Handle non-reusable bo more correctly during retire
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcc89d26600a57317007035fa720915e8a2ade81
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 12:25:43 2011 +0000

    sna: Safety first; make all flinked bo unreusable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f62b9f94f64f402e731463205635d386386e274e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 10:15:11 2011 +0000

    sna/video: Pass cropped source dimensions along with frame data
    
    So pack all the relevant details into the same structure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5809b1ad934d6e19dbcf00f1b59e156761ec16b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 9 09:41:53 2011 +0000

    sna/video: Tidy up copy routines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1cd06100185a37ee33209fb18362da89f9646e6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 17:37:44 2011 +0000

    sna: Protect against NULL deference of damage after reduction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b100b099a4d5877c79989e8b3b4ffcd3aa2306f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 16:30:22 2011 +0000

    sna: Convert stippled spans to rects
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7b95f87b26675af3a1923fef824c45e087098d61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 16:18:58 2011 +0000

    sna: Use the blitter for overlapping lines if the alu doesn't read dst
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a8d3a9dfff8be65b4ab28312ec49dbca36019e0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 13:51:00 2011 +0000

    sna: Avoid the penalty of only writing partial channels with glyphs
    
    Yes, writing 3 channels is slower than writing 4. But it's okay we
    simply ignore the alpha value anyway.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 576c5169efd068c364fb7d266fbb6b1dd2ad3f4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 13:27:05 2011 +0000

    sna: Tidy sna_copy_bitmap_blt
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32bbeefb8563ae2ab3a105d0b1c9b55d9587b788
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 13:17:20 2011 +0000

    sna: Pack clipped stippled uploads
    
    This are even more likely to fit inside the immediate payload.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3620cd2d157f3d81ccb76bce2ab813bd1e058878
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 11:25:14 2011 +0000

    sna: Begin hooking up valgrind/memcheck
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeaadb16093f83c9b830958c5946d4d048ffd26b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 11:03:19 2011 +0000

    sna: Handle creation of large Screen pixmap when the GPU is wedged
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42606
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7577d6ea45794b83d2f84b175d453d8a460b0e9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 10:24:34 2011 +0000

    sna: Add some error messages to explain why we failed to create the screen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33256af40b3ce2cf8a899ced1fcbf40e316772e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 09:55:07 2011 +0000

    sna: Fixes for DBG_NO_HW (i.e. simulated GPU hanges);
    
    A couple of the recent GPU paths were failing to check for !wedged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f0886dae29429f498fb10a12d5dc8de6bd798fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 8 00:02:18 2011 +0000

    sna/trapezoids: Use ints for the offsets to accommodate multiplication
    
    Although the original precison need only 16-bits to store the offsets,
    after projecting on to the sample grid we need a few more bits of
    precision and so need a larger integer type to avoid overflow and render
    glitches.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42680
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33351d5c3dd912534c54e64ccfc7adc4c6f6ecae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 22:57:44 2011 +0000

    sna/glyphs: Bypass masks for single glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4872225ace7e3b129292f5822aa75b84c52beff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 22:57:05 2011 +0000

    sna/io: Minor tidy of setting command flags
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5ba8ba7421e36bcdf83e84423595326939dbe7cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 22:55:10 2011 +0000

    sna: Avoid overwriting an upload buffer during readback
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Buzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42677
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f7a8a80237db77452f02273bd8ade68dfba575f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:08:25 2011 +0000

    sna/composite: Minor fixes in operator and colour reduction
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1234f3d3a27f326b8048e3d6b476021a26e9101
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:07:37 2011 +0000

    sna: Expand multiplies of two 16-bit values to a full 32-bit range
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afdf931e61821985b31b339d1f346ddd7c4e9e3c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:06:35 2011 +0000

    sna: Add some more debugging in the hunt for overflows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f3c845782fdb2fa8bdf751bdd7dd83ca02c42ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:05:41 2011 +0000

    sna/blt: Small cleanups
    
    Whilst perusing for overflows, remove some redundant conditionals.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8e775cecccebe543d344721d45b2d43ee9f122b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:01:33 2011 +0000

    sna/gen3: Fix false reduction of ComponentAlpha with white source
    
    The principle behind the opertator reduction of WHITE * maskca is valid,
    except that we failed to account for the src/mask transposition when
    emitting the vertices - garbage ensued.
    
    Given that we agressively reduce the shader required for WHITE * maskca,
    it does not seem worthwhile to special case the primitive emitter as
    well.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42676
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 65a440543b13e3e605a4a2d6209a460fbbe55736
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 20:00:20 2011 +0000

    sna: Fix 16-bit overflow of rowlength for memcpy
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42619
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d4edbd480445bc6aadd2c9f17262bd4b3eefbca6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 11:16:06 2011 +0000

    sna/glyph: Fallback if we fail to clear the scratch pixmap for the glyph mask
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42663
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 05f3e96a69af7750d2d62cf5ba991b89f39bc88a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 7 09:28:19 2011 +0000

    test: Compile fix for make check
    
    Reported-by: Jeremy Huddleston <jeremyhu@apple.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd3d86037746f3a03c4004c1e3ba6e8281344745
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 6 11:13:27 2011 +0000

    sna: Beware unsigned promotion of int16_t to uint32_t
    
    Mmakes for an unhappy mempy!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b9408d972050cb02c1024926c406cd45508a158
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 6 09:55:09 2011 +0000

    sna: Self-intersection of wide PolyLine are only drawn once
    
    We need to process the union of the PolyLine command if lineWidth!=0 so
    we cannot generally feed lineWidth==1 into our special case handler.
    Proving the lines do not intersect is as difficult as finding the
    intersections and thereby finding the union of the path - so there is no
    advantage in adding a check whether a wide line could be special cased.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c76714c29d29687f941a9112e80223c817185d53
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 6 09:43:47 2011 +0000

    test: Add a basic line tester
    
    Starting with exercising drawing of a single segment.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1e1e20fe7875262530a4d522e970985642c3f13
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 20:59:17 2011 +0000

    sna: Add the pixman version to the debug output
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2165f0e6b0620e3d788546924a2174506fbbde5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 19:46:13 2011 +0000

    sna: For a 32k max window size, we need to handle up to 128k strides
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42619
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5d94b21d5c65dcae3e294412a8f20bad347a6d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 14:32:16 2011 +0000

    sna: Extend the zero-line segments by one
    
    Fixes misrendering of the wine tabs
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42606
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cf29afda9b061455bc438a22bbbfb1d6db6528e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 12:36:53 2011 +0000

    sna/glyphs: Fix clip detection for small masks
    
    -ENOCOFFEE.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d21c30d0b8b08ec85c3b5d9a02a6969f7c8b9315
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 11:56:17 2011 +0000

    sna: Constrain GPU pixmaps to always fit within the blitter
    
    Otherwise we end up always doing expensive readbacks where we would
    obviously prefer it if we simply used cached memory for the CPU
    operation and then upload.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e309cea3ae5c22c58a918008a52e3d8d694c9ff2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 11:28:06 2011 +0000

    sna: Do the supported PictOp check first
    
    There is no point even attempting a BLT operation if we know that it is
    an unusual render operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab3d6d878fa27515eb760107d963d522cc87cd77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 10:08:02 2011 +0000

    sna: Render small glyph masks on the CPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c25cf434d81ac1b4da29c9c75ca1d7c28be71d04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 01:04:54 2011 +0000

    sna/gen3: Initiailse the op for fill_boxes()
    
    After removing the memset(0), a couple of fields where left
    uninitialised, causing potential rendering glitches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96e760ea7589cbe953bd0a6f2f41980a7f1c4795
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Nov 5 01:04:24 2011 +0000

    sna: s/flush/vblank/ fixes for DBG()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 676cb4e38dc381b2ef4fb092b66db80687aa5013
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 23:30:09 2011 +0000

    sna: Run the deferred flush at vrefresh
    
    This helps to reduce the perceived jerkiness of the redraw.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42413
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8052c3904a1ac0308846ac13534c4c76bb96d5dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 21:14:23 2011 +0000

    sna: Drain the delayed timer after forcing a flush
    
    The goal is to remove a spurious wakeup when we have no work outstanding
    afterwards and so would end up prematurely disabling the timer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 112c61f6557c2337d5f1b25eb71d0dc9ada6ec89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 21:13:55 2011 +0000

    sna: Convert GXcopy with -1 to GXset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 573b23c6b618af808d3236395bbf4f4993b406e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 15:57:24 2011 +0000

    sna: Add some asserts to detect buffer overflow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ba55c3d110ba51400a72da7d4f4c62efcea1335
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 15:55:15 2011 +0000

    sna/gen5: Prefer using the BLT for many solid fills
    
    Even if it means incurring a context switch, the BLT unit is
    significantly faster so long as we do enough fills. And there is the
    catch ;-)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 703cf8abdbcda783e2bb0ceb423909ee8ca98176
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 15:24:57 2011 +0000

    sna: Add earlier guards against to wedged to sna_glyph_blt
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc415ec3d3e982d89d7a25db8d5fd18e0412a99b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 13:53:17 2011 +0000

    sna/gen5: Also experiment with lazy spans here
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 567cfa508f788b4dd5de9aafbe2f148bb6a8dbc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 13:43:03 2011 +0000

    sna/gen6: Enable spans interface for boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 465515a1446fd05fdc4691522803c94515187b4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 13:40:13 2011 +0000

    sna: Silly compile fix, escaped when testing uxa
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a26c5d44ccaa7e9ff931948032b073f0a550343a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 12:36:40 2011 +0000

    uxa: Ensure that alphaMaps are mapped into the CPU for fallbacks
    
    Reported-by: Hans-Peter Budek <peter.budek@gmx.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34758895cdd93bd7671a78464e79b3891bca113d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 11:57:09 2011 +0000

    sna: Ensure operations on a ShmPixmap are synchronous with clients
    
    If we are rendering to or from a ShmPixmap, we need to be sure that the
    operation is complete prior to sending an XSync response to client in
    order to preserve mixed rendering coherency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5525691eb024f2a04b486652c24e0e34176fdd5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 10:49:48 2011 +0000

    sna/gen6: Poor man's spans layered on top of the exisiting composite
    
    Performance of this lazy interface looks inconclusive:
    
    Speedups
    ========
     xlib         swfdec-giant-steps  1063.56 -> 710.68:     1.50x speedup
     xlib          firefox-asteroids  3612.55 -> 3012.58:    1.20x speedup
     xlib       firefox-canvas-alpha  15837.62 -> 13442.98:  1.18x speedup
     xlib                  ocitysmap  1106.35 -> 970.66:     1.14x speedup
     xlib             firefox-canvas  33140.27) -> 30616.08: 1.08x speedup
     xlib                    poppler  629.97 -> 585.95:      1.08x speedup
     xlib          firefox-talos-gfx  2754.37 -> 2562.00:    1.08x speedup
    Slowdowns
    =========
     xlib                       gvim  1363.16 -> 1439.64:    1.06x slowdown
     xlib              midori-zoomed  758.48 -> 904.37:      1.19x slowdown
     xlib           firefox-fishbowl  22068.29 -> 26547.84:  1.20x slowdown
     xlib       firefox-planet-gnome  2995.96 -> 4231.44:    1.41x slowdown
    
    It remains off and a curiosity for the time being.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5dba7028cd5024282b601c41ddfc9081eaa1d189
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 11:24:03 2011 +0000

    sna: Make sure the alpha map is accessible by the CPU on fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 70c9e70f35af21de2b5b56d72f2a9e7fe9ed49d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 4 10:19:21 2011 +0000

    sna: Don't reuse partial vmapped bo
    
    A fun use after free.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e8c9a5b8b1625fdfe885740c36da3f4c1373ee6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 14:02:56 2011 +0000

    sna: Submit the batch on the next blockhander if operation overflows
    
    If an operation overflows from one batch into another, we submit the
    complete batch and begin a new. That new batch will not be submitted
    unless it is filled or on the next delayed flush update. This can cause
    a flicker as a large operation is broken up, such as performing a
    CopyArea through a Clipmask. So if we submit a full batch during a flush
    interval, immediately flush any partial batch at the next blockhandler.
    
    This stops rude Santa flashing Rudolf in xsnow!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b21838471651a59d3e425c05a389c3f9196e21d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 22:51:24 2011 +0000

    sna: Compute the correct extents for the PolyRectangle
    
    Otherwise we may leave one behind...
    
    A regression from the introduction of sna_poly_rectangles:
    40af32a0e9ed971a1f2c2a45266f32016bda7ed3 (sna: Execute blits directly
    for PolyRectangle)
    
    Reported-by: Matti Hamalainen <ccr@tnsp.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42568
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2174f840158aa9cfa370ade38be28f8dc8e4b526
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 20:41:31 2011 +0000

    uxa: Remove caching of surface binding location
    
    If the pixmap were to be used multiple times within a batch with
    mulitple formats, the cache would only return the initial location with
    the incorrect format and so cause rendering glitches. For instance, GTK+
    uses the same pixmap as an xrgb source and as an argb mask in order to
    premultiply and composite in a single pass. Rather than introduce an
    overly complication caching (handle, format) mechanism, kiss and remove
    the invalid implementation.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40926
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1b40a20bbba4b70990a8983a2916d3d5850d828
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 19:27:23 2011 +0000

    sna: Support binding of a bo for multiple formats
    
    Applications may use the same pixmap with multiple formats within the
    same operation. For instance, you can premultiply and composite a normal
    pixmap in this manner.  However, as we reused the sampler binding
    locations of the source (without an alpha channel) for the mask, we
    failed to read and multiply by the alpha channel causing it to remain
    black instead of transparent.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40926
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31c5eb8e906bf8e59743372edb2d703b50cd311e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 17:07:48 2011 +0000

    sna: Clean up the fallback code for glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fa0fefd638d148d48760c95fe05520cddd96e5a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 15:33:25 2011 +0000

    sna: Restore the lowlevel glyph routines for the sake of Damage
    
    Damage bypasses the Text interface, preventing the backend from hooking
    into the font and storing private glyph representations, and calls
    directly into the Glyph routines. So to prevent a segfault we have to
    restore them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1677b273af67e2b690bd21a1b43a7d9f9d5a70c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 14:31:53 2011 +0000

    sna: Skip encoding zero sized glyphs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 239cfb99f9697392d7c25328093e6662ad04bdc9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 14:25:54 2011 +0000

    sna: Unroll the quadword upload of the glyph data
    
    We know that the length is nicely aligned and so can avoid a relatively
    expensive call into memcpy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2542bad88573e590ef4cbeed6b5884166b56adb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 14:17:05 2011 +0000

    sna: Add the missing returns to prevent fbImageGlyphBlt fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc032c9be1bab7477fbf4b2a64fb7aca6d75ac18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 11:47:18 2011 +0000

    sna: Coalesce reduction of cpu damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c92671b33ef30a8eb723eb366692ae3a5878b8f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 11:47:18 2011 +0000

    sna: Coalesce reduction of gpu damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b4a508eb022e9ade5929d3ebc97e0f9216a80b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 00:32:29 2011 +0000

    sna: Translate glyphs into MSBFirst upon initial load
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8a259e34d3295af3be864e4fae96e6c3a9a632c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 01:05:52 2011 +0000

    sna: gc->miTranslate is always 1
    
    So we can perform some constant folding and eliminate dead code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f68f9e5f8341e20c4e1e46044f79806a44ecd03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 00:59:46 2011 +0000

    sna: Trimming is redundant given that we always have a CompositeClip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4bdd84b846e6e778b7c496e7ed0d51e77310f36
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Nov 3 00:48:10 2011 +0000

    sna: Simplify the uncommon check for gpu-only damage by using damage-all
    
    The use of a gpu-only scratch bo is uncommon with the core acceleration
    routines, and we can eliminate the check for not incrementing the damage
    by allocating a damage-all and using the common optimisation of
    reduce_damage().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 353fa4218cd904857fe95ef140e7f38aefe07578
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 22:53:51 2011 +0000

    sna: Don't call into retire unless there are outstanding requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fdd0f254d2e58d425d6d23023e9db3d2924c6be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 22:23:16 2011 +0000

    sna: Use an integer value for the sentinel
    
    clang complains otherwise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1073c78f6cebfd6380b53dd891b7a72e50f398d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 22:14:40 2011 +0000

    sna: Pack small 1-bpp uploads into immediate buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73b2ef5a7de8d733fa1821e5010480ede305e25e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 22:02:51 2011 +0000

    sna: gc->pCompositeClip always exists after validate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fd0754e9c81164ca0fdcf96ba2bfb419568187f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 18:03:07 2011 +0000

    sna: defer calling fbValidateGC until we fallback
    
    A secondary effect is that this prevents needless migration of the
    tiling pixmap which we want to optimistically keep on the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f8875e216194474e818ba6e743e7c22b817f96e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 15:41:40 2011 +0000

    sna: Wait an extra interval before switching off periodic updates
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit def6b5e733e623333abf596bbdbabf8dd0ac8b00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 14:35:45 2011 +0000

    sna: Only execute the accel block handler if we are about to block
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 088b875affb8655010bc678ca4a3e87703c92daf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 13:11:04 2011 +0000

    sna: Use the packed 8x8 stipple for non-repeating small rectangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c373db73d1d2b7cf844653307c60a3891a3cc10
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 12:43:55 2011 +0000

    sna: Fix the 8x8 stippled pattern origin
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9cdf8be55029f30b47cfc39ddd2754d40602cf2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 12:17:31 2011 +0000

    sna: Add clipped stippled upload support
    
    For xsnow!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6553c9e1cbfcecf781ba106de99f9e70c6d373ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 2 10:03:45 2011 +0000

    sna: Quieten a fewer compiler sign compare warnings
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42e2036cda6b76f2b64e28a81bdaa661e4cbffa5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 20:56:48 2011 +0000

    sna: Use bo for scratch pixmaps allocated by the dix/mi routines
    
    Now that we have the rudiments of accelerated deep-plane copies, we can
    begin to benefit from using BO for the core dix/mi routines like
    ShmPutImage.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 45cc952994e169590ac4300f4ccf54810377f7f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 20:20:35 2011 +0000

    sna: Fix debugging assertions for Composite
    
    When comparing drawable clip extents against pixmap boundaries we need
    to include the pixmap screen offset on a Composited desktop.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebc9f3966d28343aebeba6886500abf511631785
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 19:47:51 2011 +0000

    sna: Accelerate deep-plane copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e0fd07bc251296784bf70f02877765171a053cc6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 17:02:17 2011 +0000

    sna: Accelerate XYPixmap upload when using GXcopy
    
    Mostly for the lols.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22c43efe6b9b5f669593aa9f3af6ee437426c5d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 13:43:23 2011 +0000

    sna: Implement 8x8 stippled rect fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c58b7643e9b86599a41ede516a778bd9869adc8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 1 10:13:20 2011 +0000

    sna: Accelerate 1bpp uploads
    
    These still get used (see Wine and Swing) by applications which like to
    do "crisp" 1-bit rendering on the client side and then put onto the
    scanout. So avoid the readbacks, and push them through the BLT instead. It
    turns out to be faster than using fb too, bonus!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8939ddbc27efedbb3e446dd26425a6bed39577f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 17:45:02 2011 +0000

    sna: Improve rendering of thin segments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98b830a975e04685455b244a8414a293857cbd00
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 17:41:27 2011 +0000

    sna: Improve rendering of thin lines
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42443
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6a5834ae560ef3b05c42b58ee0654316a66eaed0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 16:28:59 2011 +0000

    sna/gen3: Fix invalid assert
    
    SHADER_CONSTANT is expected here, the other IMMEDIATES however should
    have already been handled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e12375d05bfb32933897b62829d82c6f1aa81d70
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 14:24:19 2011 +0000

    sna: Fix a few minor cut'n'paste errors
    
    Use the constant value [last_box-box] where applicable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 20a4f533958991557a3b05af00f2856657579d68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 14:14:40 2011 +0000

    sna: Apply the GPU damage for clipped PolyFillRectangles
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42425
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7172f28c2b36aaa8c3a74ae4a7f699d3d4af10eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 12:53:35 2011 +0000

    sna: Fix placement of clipped wide PolyRectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 59535d0e1c587cfe9249ab1baf9acf8470b49b8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 12:10:52 2011 +0000

    sna: Set the flush interval based on output vrefresh
    
    Rather than a blank 25Hz, use twice the vblank interval to hopefully
    avoid bad values.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a2e59bfba6748325918f895b3e58351c7eb4baa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 11:56:53 2011 +0000

    sna: Fix reversal of zero/wide for PolyRectangle
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42414
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b1287e49347e0fff67f43d157fa87758d5cbe588
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 11:27:36 2011 +0000

    sna/video: Fix copy region for cropped video
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42412
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b4ab412cb3eb8d37a33f5eeae5c613090ad2df0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 10:37:43 2011 +0000

    sna/blt: Optimise fill with GXcopy and pixel==0 to a GXclear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 088728ad26c7efc2d65b97ff22d526c65a0fa442
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 10:04:35 2011 +0000

    sna/blt: Don't idiotically override alu for pixel==0 and track alu
    
    Another classic and utterly stupid mistake. At least I was consistent in
    my error.
    
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42414
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c399c74adc5e5bc7d425382a74d84315d2cef02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 31 09:20:54 2011 +0000

    sna: Add an option to disable the delayed flush
    
    Section "Device"
      Option "DelayedFlush" "False"
    EndSection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8860ce26eaa8f9e876af2354d61c35338076ac8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 23:25:48 2011 +0000

    sna: Report whether anything was retired to the inactive list
    
    So that we can skip a fresh search of the inactive list if nothing
    changed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7adcc8e47ba550e7c36a6543a6e0d99040c7354
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 21:19:35 2011 +0000

    sna: Stash the last scratch pixmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8d4f5d32af94f712cc81ff495b19907261759ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 21:21:25 2011 +0000

    sna: Correct PolyRectangle verticals to be the end-point not the length
    
    Fixes an off-by-one in the drawing of the rectangles caused by a
    too-literal translation of the rectangles into boxes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c45622b889ba66b6476241601e1458d219c45ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 17:49:19 2011 +0000

    uxa/glyphs: Fallback rather than fail to render with a non-solid Source
    
    Reported-by: Uli Schlachter <psychon@znc.in>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31819
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e6eb803cb44b01e300fb4b08304227a430912beb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 17:44:26 2011 +0000

    sna: Loop over all clip rects for glyph blt rather than fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1eefb75c91fb769551b485f1b2c6b59023c69906
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 17:17:36 2011 +0000

    sna: Don't mess with NDEBUG
    
    This is set in configure and redefining it later inside the C files just
    leads to trouble and broken compilation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7237374a03d1e0c2e6c0b2d0eb42afc8df25df0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 16:46:10 2011 +0000

    configure: Bump version to 2.16.901

commit 0a78a75e75225d89e465804c482a667840a2c8de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 16:45:46 2011 +0000

    NEWS: Add release notes for 2.16.901

commit c7552cb819ae8c90975193c159236e0070628dd9
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Oct 30 16:35:14 2011 +0100

    i810: kill mmio vga access helpers
    
    Signed-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit e8b8adeab3b2e69a8684217271604a5f658f617d
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Oct 30 16:34:05 2011 +0100

    i810: use vgahw functions instead of roll-your-own
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 4aeea489ed3189d7ebcae4199153c1ae736ebf68
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Oct 30 16:07:45 2011 +0100

    i810: rip out PIO access functions
    
    All the io done at init time is already converted to libpciaccess
    
    Signed-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit e735636194671e221eca3e86b9bd06fd0d4b6c5a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Oct 30 15:51:49 2011 +0100

    i810: kill dead i830 defines
    
    Signed-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit bb840ee09fa620648065884306fbe3e0da37ad77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 16:13:04 2011 +0000

    sna: Convert PolyRectangles to use Box32
    
    For the same overflow protection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af52e234a78bbde964a93ef8cce21f41a5c959f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 15:34:34 2011 +0000

    sna: Fix compilation
    
    Remember to drink coffee and compile "obvious" fixes before pushing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23b314729c43101e515e2625db2a2401c72c2596
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 15:24:21 2011 +0000

    sna: Rewrite box32_add_rect() to enable int32_t promotion
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 427622aca31b7463eb2dcd52e352dc8997e84baa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 12:02:42 2011 +0000

    sna: Push overflow detection to the end of extents
    
    Removes a couple of conditionals from the middle of the hotpath and on
    Intel we are not realising the benefit of only utilising 16-bit values.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d3aba8518ae790325c6123dacc3ce73b6e91cbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 11:22:26 2011 +0000

    Revert "sna: Don't flush the render caches if in the process of writing again"
    
    This reverts commit 15266e1b9500f6b348661c60d1982bde911f2d0e.
    
    KDE relies upon the ability to render into a sampler and then render
    upon itself. Not the first sign of madness...
    
    Will have to find another way of winning back the compwinwin
    performance.

commit d4062705178856cffc83030fa40f758e9d884566
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 30 10:40:32 2011 +0000

    sna/composite: Fix incorrect operator reduction for RenderFillRectangles
    
    As exemplified by KDE (using Kate) on gen3, it would attempt to render a
    large set of boxes using OVER and a transparent colour. As gen3 copied
    across some of the BLT assumptions, it was incorrectly reducing that to
    a CLEAR and thus rendering incorrectly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da3f8656744f7c801608c7c89a859c0f7dc9e6e0
Author: Jeremy Huddleston <jeremyhu@apple.com>
Date:   Sat Oct 29 20:15:11 2011 -0700

    Use malloc/calloc/realloc/free directly
    
    Signed-off-by: Jeremy Huddleston <jeremyhu@apple.com>

commit 17ba07a7befc7f442ae1c917a087ac026516d886
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 29 20:03:37 2011 +0100

    sna/gen3: Set the src flags for fill
    
    A regression from c2040fb8e62076d87f7a5b407505ee3f3482945e (sna: Remove
    the memset(0) of the fill op) left the flags for the source channel
    uninitalised leaving the shader construction undefined and causing
    visual glitches.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=42367
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4835fe5b2e19ac456773565399f334845f7442c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 29 18:56:29 2011 +0100

    sna/genX: Improve reduction of Render operator to BLT alu
    
    This appeared to introduce a visual gitch into the xfce4 selection box
    on gen6 at least.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42367
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33383fde55609fb4bd372d2d41a6254799499225
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 29 12:53:15 2011 +0100

    sna: Tweak PolyRectangle blitting
    
    A box of height/width 1 and lineWidth 0 can also be drawn with a single
    box as the far edge is contiguous with far side of the near edge.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 64a57c8dbec81f6420ff032985237eb16cebfb87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 29 11:01:51 2011 +0100

    sna: Further clipping bugs
    
    Make sure the line is clipped to the current clip box and discard if the
    clip is reduced to nothing.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=42361
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 719626ef7918d5cd69d13f983b8b615aefe215d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 29 10:26:08 2011 +0100

    sna: Increment clip box when short-circuiting the iteration
    
    Reported-by: nkalkhof@web.de
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32a9e0352a1e28509580d84bfc5377d8fae913c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 23:14:24 2011 +0100

    sna: Retire and search inactive again before creating new buffer
    
    Attempt to retire an active buffer into the inactive cache before giving
    up and creating a new buffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15266e1b9500f6b348661c60d1982bde911f2d0e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 18:00:56 2011 +0100

    sna: Don't flush the render caches if in the process of writing again
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d3c7ee921172d4898ebdc6e944812a02426008e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 16:44:16 2011 +0100

    sna: Faster unclipped rectilinear segments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cd909cfe9e7d7e97a1d51513a049e312fd9ddae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 15:48:49 2011 +0100

    sna: Call miZeroArcLine where appropriate for GPU paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9921c98df070032e082570f0663f6d3ad0cccd56
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 14:09:11 2011 +0100

    sna: Faster unclipped PolyFillRect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1718f96f520874c1fb2af0eb975c7f548762d34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 14:01:24 2011 +0100

    sna: Faster unclipped PolyPoint
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4762ed891a50238abddf6c762a053db5c34b87f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 13:39:17 2011 +0100

    sna: Call directly into tiled rects for tiled spans.
    
    As we already know the extents and that this is a candidate for
    GPU-acceleration, we can skip over those steps and emit the tiled rects.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a02069df2ddc259d65ad468834f7968d283b713f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 28 11:30:37 2011 +0100

    sna: Faster unclipped spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48eff1676c4066c8b8e069fd579a1b6fc2329960
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 23:30:06 2011 +0100

    sna/gen2: Reset BLT registers across 2D/3D context switches
    
    It appears the hardware trashes the BLT registers after a 3D context
    switch, so we need to reload.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f006fac72a733e047b9468704e9c9206f62f96f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 21:50:25 2011 +0100

    sna: Fast path typically unclipped tiled rects
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6f543011bf3d03b9298b5ceeddfc1fc20fc534b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 20:16:35 2011 +0100

    sna: Use private identifier for internal scratch pixmaps
    
    This was meant to be a part of the previous commit.
    
    These are the scratch pixmaps for which we truly do want to allocate
    GPU-only.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 14a065a267523f9a31be07daaab19b67e9f02290
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 18:07:53 2011 +0100

    sna: Create scratch pixmap on the CPU
    
    Contrary to earlier belief, the only usage of
    CREATE_PIXMAP_USAGE_SCRATCH in the dix/mi are either along paths unused
    by us or more importantly for operations which are detrimental to create
    GPU-only buffers. So create CPU pixmaps instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d52d5009375618bb703909fa0fad04e6d54a2ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 17:06:51 2011 +0100

    sna: Tweak zero line spans to include missing last segment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72e00096351137bd7eb0ae91474657a597836252
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 16:36:39 2011 +0100

    sna: Fix advance through clip boxes for fill->boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c7bd89fb54686c14b687c007e42c34c23423b0fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 16:23:35 2011 +0100

    sna: Fix PolyPoint not to always send 512 boxes
    
    Just emit the remaining boxes!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cfd5b7f6ce80af911bfc8b71bba776ea814e307a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 15:28:11 2011 +0100

    sna: Use fill->boxes to pack PolyFillRectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8d304f47e35be344550f389158eac3d4c21d9440
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 14:43:46 2011 +0100

    sna: Use fill->boxes for rectilinear blits
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5d51ff0cf901b808c3cd5aea761d51e6d15b73bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 13:57:59 2011 +0100

    sna: Clip PolyLines to the current clip box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 990043f6b8cf8e580aad2e52f8d236a6aec838b5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 12:33:55 2011 +0100

    sna: Handle singular clip regions for PolyRectangles
    
    Otherwise X will crash!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 991582f6678581e3d92c0497e10ecee67536efc2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 09:27:41 2011 +0100

    sna/io: Update batch mode after submitting partial requests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91745de113340c8a281e8cb724b4a7e0b7a0711a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 27 09:17:50 2011 +0100

    sna: Further improve use of fill->boxes for PolyRectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ffe1bdea82c07a2738743855dfa83494531b41aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 18:37:29 2011 +0100

    sna/blt: After submitting the batch, it will be empty
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b34e7454574f36796560955fb9d3d33ca00924d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 18:11:25 2011 +0100

    sna/blt: Convert Copy with color 0 into a Clear
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 389241aa6469b2e64a58cc0527e3310fdc69ffb7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 17:50:38 2011 +0100

    sna: Suppress an overwritten fill
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit baf78fcddb87eba987163485ad8fd227fb244f29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 12:54:13 2011 +0100

    sna/gen2: Cache the last solid colour for spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff4715a36999a43cee20cf3474b4ae0af646342c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 12:40:46 2011 +0100

    sna/composite: Discard opaque masks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0079579ebd548fc1b490a42928373507a93229bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 11:49:53 2011 +0100

    sna: Fix debug compilation, again.

commit 5988422455ebb2a3b1cafadc1ff302c35a7a5039
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 11:47:45 2011 +0100

    sna: Handle degenerate copy area whilst wedged
    
    We want to return early to avoid handing the empty box as the lower code
    makes the assumption that it has work to do.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fc7cd2dc8e2b9c0d4143a9f6657f84050ae249a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 20:59:50 2011 +0100

    sna/blt: Rename the composite paths
    
    Whilst re-reading, I found the old naming scheme slightly muddled and
    not nearly as descriptive as it should be. Hopefully this slight tweak
    reads better in 6 months time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 280325900bf3c17c3177f6e3f52236d6b452e0f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 20:58:48 2011 +0100

    sna/blt: Share the common fill->boxes between blt and render paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56f65e65204f1ecbad598419e525e69f6179f9c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 20:40:21 2011 +0100

    sna: Inline box_intersect()
    
    Most of this branchy function is spent in manipulating the stack for the
    function call, so inline it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f65e73f8a3a013e79b753d625f79994408e717f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 19:55:40 2011 +0100

    sna: Use fill->boxes to unroll FillSpans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 94f9cd40dcdd444d3b5a5598deb0f3d04026df3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 19:11:35 2011 +0100

    sna: Use fill->boxes to unroll PolyPoint
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5e08ca75a5eb852c09b9acf6004668bc63f1fe6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 23 17:53:54 2011 +0100

    sna: Use the new fill->boxes for PolyRectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efdc7985e2f619ca94cf6ad77ead4f6867ceedc5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 26 14:57:28 2011 +0100

    self-copy-damage

commit 0ed3426a810336b666604d34c10f996f318ebf82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 23:45:28 2011 +0100

    sna: Convert diagonal zero-width lines into blits
    
    This is slower than falling back to swrast for x11perf (up to 4x slower
    on SNB), it is still faster than doing that rasterisation through a
    WC-mapping and much faster in ordinary usage due to avoiding the
    readback hit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c12371d9e7b3bbff7f318186a0933d6108db0bc8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 22:28:56 2011 +0100

    sna: Flatten the branching for fill-spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e7f19d85fead62df21eedc87409b5abacfec4a17
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 22:15:09 2011 +0100

    sna/blt: Upload the box using a single 64-bit instruction
    
    So long as we have 64-bit instructions of course!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40af32a0e9ed971a1f2c2a45266f32016bda7ed3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 20:10:02 2011 +0100

    sna: Execute blits directly for PolyRectangle
    
    By constructing the batch buffer directly for PolyRectangle, rather than
    via miPolyRectangle->(PolyFillRectangle/PolyLine), we dramatically
    reduce the CPU overhead and can saturate the GPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a18f559961135fa288dda3b94207abb0b6d4d302
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 16:37:09 2011 +0100

    sna: Fix debug compilation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3a075201c8e47cfad6ec296b7baf549deb44cb3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 15:30:52 2011 +0100

    sna: Treat a bo marked as being last seen on the GPU as requiring a flush
    
    We are hitting this path upon retiring the old scanout buffer following
    a page-flip. We want to treat this as being hot and available for reuse,
    so mark it as such until the next retirement pass.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 999d13f32162ce11fe4042825b5b849073944ca8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 12:43:02 2011 +0100

    sna: Fast path unclipped points
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb80013f4ea50ad4f54b4d1d90c5e9da27e1c34c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 11:49:55 2011 +0100

    sna: Fast path for unclipped rectangles
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6ae86a51cc49dbba579838edd24a94e8f68294c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 03:06:20 2011 +0100

    sna: Optimise reduce_damage() to handle all-damaged pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b945b85ee938688412df6adfea488766f4656af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 02:45:50 2011 +0100

    sna: Fast-path unclipped fill spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9a193e9803bb69fc4a7e712f33a36ba395b3c89
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 02:20:22 2011 +0100

    sna: Short-circuit GetWindowPixmap() to speed-up pixmap retrieval
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 662402e41e5c7976002a71a7f961ca97c771b1f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 02:11:19 2011 +0100

    sna: Micro-optimise PolyLine blt
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2040fb8e62076d87f7a5b407505ee3f3482945e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 02:00:44 2011 +0100

    sna: Remove the memset(0) of the fill op
    
    The backends are all expected to initialise the state required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e7759db4c1dbf8b782fab9b9ca95cfa1db6cf59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 01:41:56 2011 +0100

    sna: Pass a BoxRec to the fill op
    
    For many of the core drawing routines, passing a BoxRec for the fill is
    more convenient since they already have one generated by the clip
    intersection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98bca2dbb9c33c548b1d9789ddb633ae0389c8f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 01:07:52 2011 +0100

    sna: Check whether we can blt whilst determining the PolyLine extents
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91f49549750aac99d38ae8f3a132c955a2c8d8f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 21 00:42:43 2011 +0100

    sna: Speed-up blitting of unclipped lines
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06d7574d7da047a6314be5af27f4ac47ccd5a350
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 20 21:38:30 2011 +0100

    sna/damage: Stash the last freed damage for quick reallocation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1471ef82b595a207dc8873c45176ec31f277a43f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 20 21:32:14 2011 +0100

    sna/damage: Only track the mode globally
    
    As damage accumulation is handled modally, we do not need to track the
    mode per elt and so attempt to simplify the code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1229bf6a690e7f315ab22957da23481f58515ff9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 20 17:37:41 2011 +0100

    sna: Actually apply the composite offset for the self-copy
    
    I translated the region to copy by the composite pixmap offset, only
    failed to use the translated region for the actual copy command (using
    instead the original boxes). Fix that mistake by avoiding the temporary
    region entirely and applying the translation inplace.
    
    We also have to be careful in the case of copying between two composited
    windows that have different offsets into the same screen pixmap.
    
    This fixes the regression introduced with a3466c8b69af (sna/accel:
    Implement a simpler path for CopyArea between the same pixmaps).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3526d83e460ce6410f23f59d1315793ff9607253
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 20 00:29:52 2011 +0100

    sna/dri: Perform a little dance to restore the gpu status on release of the bo
    
    As the bo is outside of our control whilst it is under the influence of
    an external renderer, we try to maintain it on the gpu so as to avoid
    unnecessary ping-pong. But once it is wholly back under our control, we
    want to stop paying the penalty for sharing it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50b980f12e02401cdd4bc21b970d92e7bd1e6459
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 21:09:01 2011 +0100

    sna: Reuse any partial write buffer for readback
    
    Take advantage of any available temporary buffer that we reuse for
    readback knowing that it is the last operation in the batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 972989276dd3f84c1cedca0494d04f907875f8f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 20:41:14 2011 +0100

    sna: Add some debug to discern the nature of the Cr fallback
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc224e2f8c0200c114f8dbddfc4f5395a3ef0fad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 20:20:55 2011 +0100

    sna: Clean up some debug messages for 64bit
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4346e5d255f419ee6148f7d69f02560732dd4de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 19:26:19 2011 +0100

    sna/blt: Use SCANLINE_BLT for multiple fill boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7fb98efdcc1bcc2cca6deb54b16d425b0350196
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 17:52:56 2011 +0100

    sna: The initial aperture check for a set of bo is unlikely to fail
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c8e1c5c4cbe703781f2845926f76a9537a971ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 16:35:08 2011 +0100

    sna: Reset the ring flag upon idling
    
    We track the last ring used when active so as to avoid stalling between
    batches. Once the GPU has retired all the pending requests, we can use
    whichever ring is preferrable for the next operation without any danger
    of stalling upon submission.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 594c5f86bb2e1cd0390b360c926ead58ba49979f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 16:25:42 2011 +0100

    sna: Don't rewrite the solid colour cache if it hasn't changed
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5515f75647bb148d9e720dcc4713a93b59ffbd49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 13:49:55 2011 +0100

    sna: Enlarge the minimum pixmap size to migrate for Render
    
    This is to workaround a ping-pong issue involving small icons. The
    horrible sequence of operations appears to use a tiled FillRect to copy
    from the scanout onto to a temporary pixmap, which causes us to
    readback from the scanout. We are destined to hit the fallback path there
    anyway until we implement stippling...
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=41718
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 87ba33bc0bcaf3c5160edfc61cff3ba0d28d3fd8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 13:09:19 2011 +0100

    sna/damage: Avoid reducing the damage for simple tests
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 63aa84ef57ff1e55d2df6d680d6bbf88be0619a6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 19 13:08:50 2011 +0100

    sna/gen6: Apply the unknown blitter death workaround
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25f2d181946738d1ac2deb724eb48453c8692ed1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 23:03:10 2011 +0100

    sna: Compute region extents in place to eliminate redundant stack space
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a43b2a46a67fdea215719c4446224c9d2e26a20
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 17:52:56 2011 +0100

    sna: Use the unlikely wedged() throughout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a9c76e1812d106fedf160c959e6e502998e4ce8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 15:51:33 2011 +0100

    sna: Micro-optimise fill-spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b83abfb2bc3f65447205048ae0af1a94fa9ef15
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 14:43:37 2011 +0100

    sna/gen6: Don't modify composite arguments whilst checking for BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae7bd2bf70b42b8c12e5e5ae074891595827a1c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 11:54:05 2011 +0100

    sna/blt: Move the conditional out of the fill-many hotpath
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86f99379ee55b157634174c4c8aad61a30b4f57f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 11:35:12 2011 +0100

    sna/gen4: Add fill-one
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26c082dbd3f89b987168d321f72e78db8c5ddc2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 10:50:53 2011 +0100

    sna/gen6: Precompute floats_per_rect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c69a7989b3c9cedc961e29b1a569b174207964ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 10:48:37 2011 +0100

    sna/gen5: Add fill-one implementation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 26a1918290b2d23de72a67805fe5e766da0c5309
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 10:42:48 2011 +0100

    sna/gen6: Try continuing with the BLT if the last batch was also BLT
    
    In the vain hope of reducing switching between rings and introducing
    stalls between batches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b1398f26d4de44167096c6548ff7384c24d5e06
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 18 00:29:18 2011 +0100

    sna/gen6: Micro-optimise gen6_rectangle_begin
    
    We can only emit state between primitives, ergo we need only check for
    state updates if we've finished the vbo or are starting a new operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2d842df5e3198dab401fbd450d4af83d44917dd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 23:34:19 2011 +0100

    sna/gen2: Precompute floats-per-rect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 729f1ec7869167ff91fa969d06dbdfbf0e8b4126
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 23:20:20 2011 +0100

    sna/gen2: Prefer to use the BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit adef3a56cde1210554dc8327baa37c36fc5f18e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 23:08:32 2011 +0100

    sna/gen3: Prefer to use the BLT where possible for composite ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f40e6ab50b264ef7eb7750f72ab7418c0d3dc9c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 23:06:30 2011 +0100

    sna/gen3: Prefer to use the BLT to clear the scratch glyph pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 941e3504e049be8af50ca9df2d0aafe9eb477983
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 19:51:33 2011 +0100

    sna: Some more debug output for request/bo retirement
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1d82fe3e528578d11d2a258b586b67c807eb7cb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 19:47:03 2011 +0100

    sna: Only retire the flush handler if nothing was submitted within the period
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7758e333409409393c4c974adb2831a7b5b18fe4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 19:32:44 2011 +0100

    sna/gen3: Use immediates for black/white solid sources
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 29ca1a3922cb0e6f3d7b71857a252e5de81941b5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 17:16:16 2011 +0100

    sna/gen3: More removal of memset(0)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88bc10878830dffefda6ed905c1f598d7a7d67ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 20:05:49 2011 +0100

    sna/gen5: Rearrange the BLT->RENDER workaround
    
    So that we can simply use the pending DRAWRECT as the non-pipelined
    flush required following use of a BLT command.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18aed47ba37ccfbcdd72ed251fc97222741c66a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 16:41:14 2011 +0100

    sna: Fast path common colour conversions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a3466c8b69afeda95180fcdc97b56d31f7a1d1ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 20:52:47 2011 +0100

    sna/accel: Implement a simpler path for CopyArea between the same pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8afa05191a9a337ce6e02b1064de2876f5635435
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 00:55:51 2011 +0100

    sna: Improve debug output for mi/fb fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b118658d5b9cfa56132f91238f2ea61fba8b357
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 15:00:01 2011 +0100

    sna/gen3: Remove memset(0) from fill_boxes
    
    And initialise only the state used for the operation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1bb4ebfd8991f2f9eb9c38b9259792c11e7c86a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 14:22:58 2011 +0100

    sna/damage: Clear damage->all when subtracting
    
    I missed clearing the all-damaged flag on the subtract fast paths,
    causing us to disregard further GPU damage and losing track of render
    coherency.
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=41769
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46f97127c22ea42bc8fdae59d2a133e4b8b6c997
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 21:40:15 2011 +0100

    snb,ivb: Workaround unknown blitter death
    
    The first workaround was a performance killing MI_FLUSH_DW after every
    op. This workaround appears to be a stable compromise instead, only
    requiring a redundant command after every BLT command with little
    impact on throughput.
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=27892
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=39524
    Tested-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71bf291e563ec5224777b4907a5347a3fbfe64c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 12:53:19 2011 +0100

    sna/gen3: Micro-optimise gen3_rectangle_begin()
    
    We only need to emit the vbo description either at the beginning of a
    new op (when the state may have changed) or after finishing a full vbo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a032feb2531439b9945d7ae1e0c2e3ab95a960e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 12:41:21 2011 +0100

    sna/gen3: Store floats_per_rect alongside floats_per_vertex
    
    Moves a multiply out of the hot path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cbe79b85b46796d561105afa980e7a52f4f1889
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 11:57:07 2011 +0100

    sna/gen3: Improve reduction of render operator to blt
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 606e18bd360d904a8aed01aef43644fb4a51d929
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 10:50:33 2011 +0100

    configure: Add a check for pixman version
    
    As SNA requires a fairly recent release and calls directly into pixman.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17acaf8e232a8bad9bc2c653a9fceb06f0f65f6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 17 00:55:51 2011 +0100

    sna: Defer CPU fallback if fb calls into mi
    
    If the fb routine does not access the pixel data directly, but instead
    calls into an mi routine, we can defer the readback and possibly avoid
    it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c348b69f66cbe1cafc88396523da9768e1006889
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 18:23:33 2011 +0100

    sna: Prefer to accelerate non-RENDER operations if already using the GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fdc9e3fd3f8defb7ad62de11f8cb069a10e5736
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 17:57:55 2011 +0100

    sna: Simplify busy tracking by trusting the bo->gpu flag
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 30dff81cd62b5fc5a28d5175a08c5a3ee09667bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 17:41:34 2011 +0100

    sna/accel: Upload source to GPU for !copy CopyAreas
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eefa925e3d3e009b21ecc0b428d93a6c732bfa14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 17:39:06 2011 +0100

    sna/accel: Fall-forward for handling a non-copy CopyArea to a dst gpu bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 01f41e624b31af88d433a25eaefce557e7ff3d62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 17:38:26 2011 +0100

    sna/gen2: Eliminate redundant diffuse and rectlist emission
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9e3dbffcb7e6cff35e10100d81544936813095a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 12:48:23 2011 +0100

    sna/gen2: Fix fill-one-box
    
    Lets only have one special gen2 value for the source channel pixel
    colour and so remove the confusion and misrendering.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b89592b16e373da1fe259ad067f65ba95021dc49
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 16 19:39:14 2011 +0100

    sna/gen7: Add missing tail to 3DSTATE_SBE
    
    I was a few NULs short of the declared amount.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33f17b996dd0fcbb8e07875770e11571380d6509
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 14 12:01:34 2011 +0100

    Remove a couple of trivial compile warnings for unused variables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5e27528ffeb74f404823c678e04e847cf2109aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 14 11:51:44 2011 +0100

    sna/blt: Add a pair of operator reductions for opaque fills
    
    Extend the coverage of the BLT for a couple more composite operations,
    though they be relatively infrequent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f5289b29962c3e5d94deb30782a156292d20053
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 14 11:31:46 2011 +0100

    sna/trapezoids: Fallback if the composite operation is not supported
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3d79264ef8a8be225d9b13efd14f37a7478e6b1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 14 11:31:00 2011 +0100

    sna/tiling: Hook up composite_box
    
    Now used for spans and so triggering death by NULL function pointer on
    older chipsets.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f5f3135e3cc1f4740508773cfefca0954aed2fd3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 14 10:40:39 2011 +0100

    sna: Ensure that the scanout is flushed before we sleep
    
    So that we do not see any delayed rendering on i965+.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 020d84d2d09c71a8209dd774a0735a3c11cb148d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 13 22:32:00 2011 +0100

    sna/accel: Fix sense of nothing-to-do due to clipping
    
    A missing not due to a hasty conversion from an assert.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7fd6906c41e328649b97e16c42848a39f6e48f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 13 17:46:48 2011 +0100

    sna/accel: Actually apply the clip to the glyph extents
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=41718
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit eb5f86b78181b174664aaa9bc689db5421b7e7bd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 13 17:32:54 2011 +0100

    sna/accel: Correctly offset the damage intersection for glyph runs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a4766026ad0aa14283e35598d33f13d311cc029b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 13 17:32:30 2011 +0100

    sna/accel: Check for reloc overflow when adding a new glyph run
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b10850af4125b8dbc36d13fa83f1dcce13ac6684
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 13 17:09:25 2011 +0100

    sna/blt: Check for reloc overflow when initialising solid fills
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5242565ef17cb4265177338df5b564b960e3692
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 12 21:14:43 2011 +0100

    sna/gen2: Trim some surplus state commands
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c5020532335c07d9b0f6cecb0b004de4af6d273
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 12 20:36:53 2011 +0100

    Remove vestigial includes from DRI1
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6b3bb9b5e56949cbd9189d9857ffa1ff46377fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 20 19:41:03 2011 +0100

    sna: compare against the right array of cache buckets
    
    Fortunately harmless today as there are the same number of
    inactive/active buckets.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f70095837a30d6a88b9e313d3583d38ea55221d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 16:06:31 2011 +0100

    sna: And free the clip after creation for PolySegments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 92f4d978c8b1f5e9a6cf3affa15d90bfb3d4e7b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 15:52:13 2011 +0100

    sna: More micro-optimisation of messing around with clip regions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57151f654752ed64716358ecb5e9217b59784da8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 15:23:17 2011 +0100

    sna: Micro-optimise checking for singular clip boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 823a4272c50247482428a16cb08741bf87a302ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 13:51:41 2011 +0100

    sna/gen3: Avoid RENDER/BLT context switch for fill boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 887361de173e082841453902089427447c5a158a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 13:51:25 2011 +0100

    sna: Enable single fill fast path for PolySegment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 721cf30e9eeb0102c77f337332ad8259463b7fef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 13:28:45 2011 +0100

    sna/accel: If the data is already on the GPU, use it for the source
    
    Fixes regression from 1ec6a0e2775 (sna: Move the source to the GPU
    if it is reused).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15a4410cec111c3b3bd15ec33f29bc1f4cb709c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 13:28:30 2011 +0100

    sna: use correct insertion point for sorting partials
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9b53c48774078d404149e86267c39eb82234c3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 10:37:25 2011 +0100

    sna: Mark the spans render functions as fastcall
    
    This reduces the amount of dancing required to call into the span
    functions as we can pass the arguments in both the integer and floating
    point registers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 208fa8e6b88daf8446239a1a001a68ceb7d02e76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 10:08:42 2011 +0100

    sna/trapezoid: Perform the NULL check for damage in the caller
    
    Save the function call overhead in the common case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5050fead0ef81785a2a9be735852921463377e04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 09:59:13 2011 +0100

    sna/gen3: avoid applying zero offset to common spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0184b59095d5b8fab1a65ceba075d29189130d4
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Oct 9 18:43:14 2011 +0200

    snb: implement PIPE_CONTROL workaround
    
    Sandybdrige requires an elaborate dance to flush caches without
    hanging the gpu. See public docs Vol2Part1 1.7.4.1 PIPE_CONTROL
    or the corrensponding code in mesa/kernel.
    
    This (together with the corresponding patch for the kernel) seems to
    fix the hangs in cairo-perf-traces I'm seeing on my snb machine.
    
    v2: Incorporate review from Chris Wilson. For paranoia keep all three
    PIPE_CONTROL cmds in the same batchbuffer to avoid upsetting the gpu.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 4a2e833ab17e4facf0f90166b82a5696a1deef91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 08:45:47 2011 +0100

    sna/gen7: Add render support for fill one
    
    To prevent the RENDER to BLT transition and potential stall.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41f525fab5a82c24adafc7e8c8409417d16a0e9a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 11 00:22:11 2011 +0100

    sna/gen6: Add render support for fill-one-box
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b6575bdded4b24ec1c9515203f44798225c10b6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 10 16:39:02 2011 +0100

    sna: Support a fast composite hook for solitary boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c5414ec992d935e10156a2b513d5ec2dded2f689
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 12:02:41 2011 +0100

    sna: Use BLT operations to avoid fallbacks in core glyph rendering
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b62b9d7c4301457a024f840383fb4515704ebdb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 4 19:30:06 2011 +0100

    sna: Increase reserved space in batch to accommodate gen5 workaround
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6351d8eb823dbfffb4792af8592d1ce565211e23
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 4 19:29:46 2011 +0100

    sna/gen[23]: Fix compilation with debugging enabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ec6a0e27753027a68beeaff0276ae65c658d468
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 3 16:14:18 2011 +0100

    sna: Move the source to the GPU if it is reused
    
    We attempt to skip upload a source pixmap to the GPU in the event it is
    used only once (for example during image upload by firefox). However, if
    we continue to use the CPU source pixmap then it obviously was worth
    uploading to the GPU. So if we use the CPU pixmap a second time, do the
    upload and then blit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 413c9f7111c605a3842d4d0a85f8cf01470e5faa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 3 00:24:50 2011 +0100

    sna/blt: Suppress repeated SETUP_BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1067335305a6b8123217518085f70a77b7f0334f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 3 00:11:55 2011 +0100

    sna/blt: SETUP_BLT needs 9 dwords of batch space, not 3!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8c96a6a1d50cd3dd40fd4b78958c8f78337a2fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 12:57:53 2011 +0100

    sna/blt: Use SETUP_MONO to reduce the number of fill relocations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d227d43f0dfca1fa1822207d68539635aac37b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 12:03:21 2011 +0100

    sna/accel: Correct syntax for constifying BoxPtr
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3dd80524160d6b6cf0fb668afcc766f2bc6f8383
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 09:59:03 2011 +0100

    sna/accel: Only throttle after flushing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04b8f0a5a16ff71c5e55e0281dbcaa32554703ec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 09:36:38 2011 +0100

    sna/accel: Add a compile option to force flushing on every blockhandler
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32cef71efe231692f7b24f66913a8ae57bc00aa8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 2 08:55:55 2011 +0100

    sna/accel: Add an compile option to disable use of spans
    
    Using spans has a tremendous effect (~100x) on x11perf, some good but
    mostly bad. However, in reality operations are mixed and so preventing
    migration on alternate opertaions is a win. In the x11perf slowdowns, it
    appears to be CPU bound and so it seems like there should be plenty of
    scope for recovering the lost performance.
    
    However, for the time being, just go back to the old fallbacks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc1ec0dd1a5f66114ee4249309d3a283ad84d584
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 20:11:47 2011 +0100

    sna/accel: Only disable the flush migitration if nothing changed
    
    Previously we ignored updating the scanout in place, and so we were not
    amoritizing the shadow cost of common core rendering operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6acf1325833b8679ef09ab74f0cb0fd82a8cd92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 11:26:54 2011 +0100

    sna/accel: Micro-optimise sna_fill_spans_blt
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8029765515399b130bee18db0a2830eb83f47a07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 11:19:49 2011 +0100

    sna/accel: Don't attempt converting to spans if we will only fallback
    
    As the span code does not yet handle plane masks or stippling, it is
    disadvantageous to convert to spans only to fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd11bd69f4c1b961593886945946c7d7c9269900
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 10:45:18 2011 +0100

    sna/accel: Use miPolyArc to convert arcs into spans for gpu bo
    
    This is actually tricker than it looks since miPolyArc() sometimes uses
    an intermediate bitmap which performs worse than the fbPolyArc() fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d07256cc3360cf94d131d9a1b24d9f1c6a70ee04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 10:42:45 2011 +0100

    sna/accel: Convert segments into spans similarly to PolyLine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d09a229e32468c810f5056bfd0043f2fb68038d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 10:01:21 2011 +0100

    sna/accel: Use the mi*Line routines to convert the line into spans for gpu bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e7a662b92e3012735f7a3d72d4f7860ca61a3810
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 09:26:52 2011 +0100

    sna: Sort partials by remaining space
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 13b9b5d8d6b6f6db59fe2418270ac93d9b74436c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 1 09:23:41 2011 +0100

    sna/io: Only mark the buffer as LAST if we know we will flush the IO
    
    Otherwise we can continue to batch up the data upload into larger
    buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ecc6993b8c8205e5896ee87c14d6a76310c9aa7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 30 16:11:05 2011 +0100

    sna/gen6: Fix offset of Scan-Line-Compare register
    
    Reported-by: Frank Mariak <fmariak@macrosystem.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d8fe941bc245e24c83c417ccff5c57e83baac3f7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 28 23:04:03 2011 +0100

    sna: Check for request retires after every batch
    
    In the beginning, I did perform a retire after ever batch. Then I
    decided that it was too much CPU overhead for too little gain. On
    reflection, i.e. further benchmarking, we do see a performance
    improvement for recycling active buffers faster.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e74a39b45446e2c43df5419efc4a2e0e73275c45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 28 14:47:33 2011 +0100

    sna/gen7: Confusion reigns as trying to fix errors found by an outdated checker
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6395894ada6b9c14deb62814ccf55848eaa80527
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 27 23:26:33 2011 +0100

    sna/gen7: Fix up a couple instances of my inability to count
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a53538659d5e18cb5a7a7a7dbd460f35985183fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 25 12:40:01 2011 +0100

    sna/accel: Fix s/x/y/ typo in computing relative drawing coordinates
    
    Reported-by:Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=41165
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 960688d1684dd062c345aa8df1ff4f105015f467
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 25 12:23:10 2011 +0100

    sna/accel: Debug option to force CPU fallbacks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fd46b8bb7e7a104a0afa0e5dee92993e043ef57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 25 10:02:02 2011 +0100

    sna/glyphs: Add glyphs directly onto a client temporary buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5154e281ed66334a8ff6342236c1203a1e4ac5a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 25 09:56:16 2011 +0100

    sna/glyph: Avoid useless attempt at GPU glyph rendering to a1 destinations
    
    The actual bug is a little involved as we don't damage the temporary
    glyph mask correctly presuming that we only hit GPU paths. However,
    should we fail to prepare the composite operation that paints the mask
    on to the destination, things fail horribly.
    
    One particular example is that wine like to create its own temporary a1
    buffer for the glyphs (which we render to via another temporary mask...)
    which triggers the delayed fallback and then sw compositing with a random
    buffer.
    
    Reported-by: Roman Jarosz <kedgedev@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=41165
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 46fedf0cf1a413381109c1de34619e84ad614b8a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 25 09:38:43 2011 +0100

    sna/kgem: Check all operation bo in a single amalgamation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ccf6547a8f1b77ddf4e79bdefe2a0878c0e9b256
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 24 23:16:57 2011 +0100

    sna: Paranoid debug flush after every op (as well as before)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 02337600345951c0ea629db11f0484403a260991
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 24 23:03:52 2011 +0100

    sna/gen5: Debug option to disable state caching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af4d3853ae8f834fbf2fc55fb2b397b3f7f17656
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 24 19:26:46 2011 +0100

    sna/glyphs: Convert all sub-8bpp masks to a8
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c79e90da71ae58cb3804f8abaf0541350e47eb14
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 24 19:26:31 2011 +0100

    sna: Add a debug option to disable caching
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6bbb88af096e054877409a54d0e0a4ccf5ee317e
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Sat Sep 24 09:27:33 2011 +0100

    Fix incorrect maximum PS thread count on IvyBridge
    
    I mistakenly set GEN7_PS_MAX_THREAD_SHIFT to 23; it's actually 24 on
    Ivybridge.  Not only did this halve our thread count, it caused us to
    write 1 into a bit 23, which is marked as MBZ (must be zero).
    Furthermore, it made us write an even number into this field, which is
    apparently not allowed.  Apparently we were just lucky it worked.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f7f95abbf57e6e71f6a30d917f97c2f2bd6cea9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 23 11:38:18 2011 +0100

    sna/accel: Use the PolyFillRect to handle tiled spans
    
    Would be preferrable to duplicate the tiling logic. Leave the task of
    reimplementing XAA to another day!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 964c96b181e6b55f4de6a4011a5beb6cc2cac33d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 23 11:37:48 2011 +0100

    sna/accel: Always subtract the enlarged region from the outstanding GPU damage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c68856f34653ac3e7af900dfbba41a108ffe119e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 23 11:35:50 2011 +0100

    sna/accel: Only skip undamaging the GPU for reads
    
    Introduced with ac1b83240e5 (sna/accel: Simplify single pixel read-back)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5913c90967091124e7c7b262782f0e99cf400eab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 22 17:13:20 2011 +0100

    sna/accel: fix assert to include the offset of copy
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31857068026138fe5edd8656381fc1ae59d3058b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 22 17:12:53 2011 +0100

    sna: move an assert
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61764af13aa3c770d19d51c8ad198cab8a5866f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 22 12:59:32 2011 +0100

    sna/dri: Bump DRI2INFOREC_VERSION
    
    An intervening dri2 patch landed in the sever.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12070b8eb1e98cb158802fff3e59f906b1547877
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 22 12:18:26 2011 +0100

    sna/dri: Play with marking bo reusable
    
    Since we have no recycling of wc pages in the kernel, we try hard to
    recycle buffers in userspace to avoid GTT thrashing. This requires
    co-operation between DRI clients and X, which is sadly lacking and so we
    need to discard any buffer given out to a client after it is finished.
    We cheat slightly for page-flips and access to the scanout.
    
    A further compromise.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=38732
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 902a0234191d77816259affe331339caaa9131d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 19 20:34:15 2011 +0100

    sna: Use pot buckets for active cache
    
    On x11perf one of the major hotspots is the search through the active
    list for an object large enough to reuse as the target surface. We can
    eliminate that overhead by keeping those active objects in pre-sorted
    lists by size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bb2c5c4d55560f7901fd8036cab164460f81edc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 19 19:12:46 2011 +0100

    sna: Move an assertion to the point of import
    
    All the guesswork is so that when we require an inactive bo, we do
    actually get a buffer that is not currently on a GPU active list. For
    some unresolved reason, this assertion was firing when putting the
    buffer onto the inactive list - so just workaround the worrisome issue
    by delaying the check until use.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 686a5ec52c9ae475fac22c36fff18814372def71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 19 18:14:05 2011 +0100

    sna/trapezoids: Fix overflow during sorting of mono edge step
    
    We were tracking the 32bit value of the prev_x using only a 16bit
    variable, and so failing to sort the edges after advancing to the next
    scanline.
    
    Fixes cairo a1-clip-fill-rule.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0390105bc239bf2ac22189f39fccc9d98bae4992
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 19 12:48:38 2011 +0100

    sna: compile fixes for debugging
    
    Update the DBG messages to reflect changes in function parameters.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f0cba3a255eb9e76d56201b26d15f2d49134b58
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Fri Sep 16 18:56:00 2011 -0300

    Remove useless assertion
    
    Removes 17 instances of:
    warning: comparison of unsigned expression >= 0 is always true
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d9effca142b1d82cd1a7ad3b7d2a61c4567801b
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Fri Sep 16 18:53:01 2011 -0300

    Fix "always false" conditionals
    
    Enums are unsigned by default in gcc and we can't rely on any specific
    signedess for the other compilers.
    
    i965_render.c: In function ‘i965_prepare_composite’:
    i965_render.c:2018:2: warning: comparison of unsigned expression < 0 is always false
    i965_render.c:2025:2: warning: comparison of unsigned expression < 0 is always false
    i965_render.c:2050:3: warning: comparison of unsigned expression < 0 is always false
    i965_render.c:2057:3: warning: comparison of unsigned expression < 0 is always false
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    [ickle: take advantage and rename the enum values]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7bcd1d2b75d280cecfc23877bb13426a28c07a1f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 17 21:38:46 2011 +0100

    sna: perform a warnings reduction pass
    
    Didn't spot anything that might have led to a genuine bug, but this
    should help improve the signal-to-noise ratio of warnings in the future.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5b5b4ebb14cab19258dd1cbc12721aaa9df226d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 17 00:28:30 2011 +0100

    sna: Apply the screen offset for direct upload of a composited pixmap
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=38733
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit daeb9291e22d94cd2f81b3b56418f0f879531da5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 17 00:27:55 2011 +0100

    sna/trapezoids: Ensure we do not overrun the vertical edges for mono
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 481df2618af3c10877db0610c4cadf6fc509e72f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 17 00:27:32 2011 +0100

    sna: Add debug option to force allocaiton of gpu-only pixmaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52f93c95465151d16f588d648a58b1f979e946a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 16 23:24:16 2011 +0100

    sna/glyphs: Disable the glyph cache for debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8a144d6f84a00a26785fd518cb890ad77edd45f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 16 22:56:36 2011 +0100

    sna/glyphs: Correct offset of fallback-via-mask glyphs
    
    Under a compositing manager where we have fun values for both
    drawable->x/y and pixmap->screen.x/y, we were not drawing either the
    glyphs into the mask correctly and then failed to composite the mask in
    the right position on top of the pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1eea2c4e60af535ac6500b1b62367f9f63f2a784
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 16 20:35:03 2011 +0100

    sna: Can't free bo from the active list
    
    As the active bo is still referenced in the request list, we can not
    simply free it but need to wait for it to be purged on expiration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d743c456db11bd3c0d21948dc3a2eb4b33e46342
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 16 20:34:33 2011 +0100

    sna: Debug option to disable tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c35df4493c910ef62c66a411c14e5be3b26bcf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 16 20:33:57 2011 +0100

    sna: Remove bad assert
    
    The caller intentionally violates this assert, so it is useless.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72ca1fdf2fea80ff4cf003bb025424d15d8bac58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 15 17:52:45 2011 +0100

    configure: Introduce --with-builderstring
    
    Julien Cristau disliked my broadcasting of the git tree used to build
    his distribution package as it bore little relevance to his users. As it
    is only useful for people installing their own drivers (as a means of
    sanity checking that they are running the right driver), we introduce
    the --with-builderstring idiom borrowed from the xserver. This allows
    the builder to override the use of `git describe` and either leave it
    blank or to fill it with something useful for their own purposes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 544a4167c156eac7b630f90ddef30a6f00829835
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 14 18:39:37 2011 +0100

    sna/trapezoids: Amalgamate adjacent mono spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3565c48c4bb77c836d817de75d098791dbb529d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 14 17:45:41 2011 +0100

    sna: Yet another s/x/y/ typo
    
    Every time I do a transformation into pixmap space I like to include one
    of these copy'n'paste errors.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40850
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d4aca21fd32a367d78dfaf1c23b4faeabe36428
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 14 13:06:26 2011 +0100

    sna: assert that the memcpy upload path points to valid regions
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83961051789e418f6022096b1ed2302cb2f05e5b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 18:37:01 2011 +0100

    sna/gen3: Reset the shader after playing video
    
    Another piece of state we zap without marking as dirty when playing
    video.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40842
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34c03f22158d8fc1ec2fc56cb5e87f74e42d9a8f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 17:24:14 2011 +0100

    sna: Clear the list of buffers upon server regen
    
    Or else we may try to clear the new framebuffer with an invalid batch,
    because it will reuse the same bo as last time and that bo may still
    think it is part of the old batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 831cdb837189e92aee80030dec553f28e53ba0bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 17:09:38 2011 +0100

    sna/debug: Assert that BLT commands on gen2/3 are properly fenced
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a9242a77f0952d029be57d75615dd107af660de1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 16:20:40 2011 +0100

    sna: Add a couple of debug statements for why we may not flush the scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0056bfd11e9930c1bcad6c186cd80fbab3694a8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 14:44:48 2011 +0100

    video: Stop advertising unsupported Xv attributes
    
    We have yet to implement a yuv-shader that applies
    contrast/brightness/saturation and so should not advertise such
    features, potentially allowing the client to fallback and perform the
    adjustments itself.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84a7c11a8134dfd040d2f90bb1e0670aa2c89962
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 14:42:33 2011 +0100

    sna/video: Stop advertising unsupported Xv attributes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a0d533ea8d098dbbd86af166de9c07ce67050c35
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 12:23:10 2011 +0100

    sna/trapezoids: Implement a mono-rasteriser to skip opacity spans
    
    For mono-rasteriser we can simply emit the composite spans without
    requiring an opacity shader.
    
    For single trapezoids, it will be more interesting to emit triangles
    directly. However, we still need to compute the union of many
    trapezoids, and this builds upon existing code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 343b99d2a85c520c81d1408534b2531fcbedfaae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 11:39:39 2011 +0100

    sna: Reuse the smallest bo that fits the request
    
    When scanning the active list, pick the smallest that we can reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90071454d24e7230d00c49f5a897296298fc1f22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 11:37:17 2011 +0100

    sna: Don't clear the kernel-needs-flush flag if we emit a MI_FLUSH
    
    We need to mirror the kernel active lists in order to predict when it
    will stall upon an access to a bo, and so we cannot clear the
    needs_flush for our own MI_FLUSH.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2deafe2d95d07b574f5a92471f7d7f13aebc790f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 11:34:43 2011 +0100

    sna/accel: Use correct enum for requesting a write-buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 544b1a678d5bf49559d8422750866685c36cb152
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 13 11:34:25 2011 +0100

    sna/gen5: Fix debug compilation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b1ed58d63e9ac80d7d028fa3036633436154816
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 19:07:25 2011 +0100

    sna/gen5: Avoid bitfields for simple assignments

commit 03a7fc16f9ef00ca5591655337621ec67bc37cba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 12:20:24 2011 +0100

    sna: Avoid the call overhead for the trivial clip case
    
    Profile guided micro-optimisation. /o\
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2540c877d4811b318e1c2cd707745e5b06c9fa4b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 11:54:46 2011 +0100

    sna/gen6: Prefer RENDER for copies as it compacts better
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2a617dcc5fbeaf503db4777f0ec7b3d862085b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 11:54:02 2011 +0100

    sna: Use single precision for computing the texcoord scale factor
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2e19987c333de31b258a3af37a2ed1f63ef949a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 10:37:24 2011 +0100

    sna: Provide a direct lookup cache of alpha values
    
    To reflect recent changes in cairo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 04c5a3df02f6f40a904ff4edb927ae6ff0ce6408
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 12 09:20:58 2011 +0100

    sna: Fix compilation without timerfd()
    
    Based on the patch by Konstantin Belousov.
    
    Reported-by: Konstantin Belousov <konstantin.belousov@zoral.com.ua>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae887c9d1cb2a06c515e054b36464bcf65440f9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 11 13:59:08 2011 +0100

    sna/trapezoids: Prevent a memleak if feed lots of degenerate boxes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72fafdfd374eb165e703b791c70592c47e5772fc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 23:15:58 2011 +0100

    gitignore: add git_version.h
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac4d4cdbc1336c86a16a2ec3da2ef6e9842c1079
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 23:12:59 2011 +0100

    sna: Mark the bo as reusable after extracting the handle from the buffer
    
    The whole purpose for that little dance was so that we could reuse the
    bo. However, we left it marked as non-reusable in order for us not to
    tie up memory with too many buffers and so defeated the purpose of
    trying to place it into the inactive cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3429cf12d6e3e8dd89372f8f70c64205d835b0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 18:09:55 2011 +0100

    sna/gen3: Use a clear pattern for ill-defined radial gradients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6837c21b459a99cb51b0d41906d82604e515dc0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 14:57:09 2011 +0100

    sna/gen5: Prefer BLT for solids
    
    And Ironlake also fails to live up to the promise that its GPU is fast
    enough to run simple programs at memory rates.
    
    x11perf -trap300 5x fold improvement. No obvious improvement elsewhere
    yet.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27e42b4e1216099f4a6aa7fddeb1e83b87124b6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 14:06:53 2011 +0100

    sna: Prefer memcpy_blt over fbBlt
    
    We know we have compatible formats since we have a gpu_bo attached to
    the pixmap, so we can use the simpler direct memcpy rather than calling
    fbPutZImage/fbBlt.
    
    On my i3-330m, this improves putimage500 from 730 to 1100 ops/s.
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2e1bf7e1b44db16d0c322f17535fc6a6fa07353b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 12:36:32 2011 +0100

    sna: Record git-tree used for compilation
    
    Hopefully, I have all the dependencies correct for auto-updating and
    should continue to work with tarballs...
    
    The next step is to perhaps include it in the usual version number,
    perhaps as patch level?
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f73cd955e760064f57f414dce5f39e43022e4ea6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 9 11:37:32 2011 +0100

    sna/trapezoids: Hook up Imprecise AddTraps in lieu of spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit adde6eab5d0e532633c864830f8edfa63b36ef4e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 8 23:35:33 2011 +0100

    sna/trapezoids: Fast upload path for gpu busy bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9ca05331db9849fba39fbd0583db7052fc80a31
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 8 22:54:22 2011 +0100

    sna/traps: Use the trapezoid path for AddTraps
    
    Usually this will be to CPU-only pixmap, but just on the off-chance that
    we are stalling for a GPU pixmap just the faster path developed for
    Trapezoids.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit afdb8aa89a88c62ccd5e26a3ed9adb70fec310a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 7 20:10:02 2011 +0100

    sna/gen3: Do not assume video updates are always vsync'ed
    
    In case the video is running async, then there may be subsequent
    instructions within the batch and so we do need to mark the clobbered
    state as dirty when setting up the video frame.
    
    Reported-by: Paul Neumann <paul104x@yahoo.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40693
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6aee152cb8444bf63c0009a75c6537e9886b6070
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 4 12:57:17 2011 +0100

    sna/gen2: Flush the batch when we run out of vertex space
    
    Unlike the later gen, we do not yet use a separate vertex buffer and so
    when can no longer fit a rectangle (and its CA ghost) we must flush the
    batch. Due to the duplication required for the CA pass, the normal
    checks to see whether we had sufficient space to add the new command
    were passing as they failed to take into account the need to submit the
    whole primitive again.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 48bfe4e6ded746f32080b83079235a7576f50d7a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 4 12:46:32 2011 +0100

    sna/gen2: Improve batch decoder.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cda0aaf397de1a0ca049508c6fa76f2dd4e61e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 3 14:46:57 2011 +0100

    sna/trapezoids: Check for alignment after projection
    
    If after projection onto the Imprecise fast sample grid, the trapezoid
    becomes a pixel-aligned box, treat it as such and send it down the fast
    paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db0fb368c135d4fef4ae993df67ed4610a80fd52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 2 13:13:38 2011 +0100

    sna: Add missing implementation for Triangles
    
    Feed both into spans and as a mask fallback.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 695e7115efab96c4467dc926be07dc2609011720
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 1 15:50:29 2011 +0100

    sna/trapezoids: Edges may lie out of bounds
    
    We cannot assume that the edge lies completely within the target, so we
    must make sure that the initial prev_x is truly less than any possible
    value whilst sorting intersections.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a563ea03b6ad87d41bc091c5819e6c462100450
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 31 23:29:00 2011 +0100

    sna: Use the shadow buffer for PutImage
    
    This is optimising for the x11perf putimage benchmark, but nevertheless,
    uploading the PutImage directly into the uncached scanout is between
    2-20x slower than making a temporary copy in the shaodw buffer and
    doing a deferred update. Most of the overhead is in the kernel, and
    should be addressed there (rather than worked around) and a portion is
    due to the overdraw in the benchmark (which is not likely to be
    realistic, but then again neither should PutImage be!).
    
    The argument for uploading inplace when possible is that given that the
    buffer already exists on the GPU implies that is likely to be used again
    in future by the GPU and so we will be uploading it at some point.
    Deferring that upload incurs an extra copy. The putimage benchmark does
    not actually use the pixel data and so that extra cost is not being
    measured.
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32fc0c896e0dfd06617c12beda1ccacedf69fb4a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 31 23:21:54 2011 +0100

    sna/gen6: Prefer the BLT ring, except for copies on behalf of DRI
    
    As demonstrated by the all-important trap300, using the BLT is 2x faster
    than the RENDER ring for the simple case of solid fills. (Though note
    that performing the relocations costs 3x as much CPU for 2x GPU
    performance.) One case that may regress from this change is copywinpix
    which should benefit from the batching in the RENDER commands, and might
    warrant revisiting in the future (with realistic and synthetic
    benchmarks in hand!)
    
    However, due to the forced stall when switching rings, we still want to
    perform RENDER copies on behalf of DRI clients and before page-flips.
    
    Checking against cairo-perf-trace indicated no major impact -- I had
    worried that setting the BLT flag for some clears might have had a
    knock-on effect causing too many operations that could be pipelined on
    the RENDER ring to be sent to the BLT ring instead.
    
    Reported-by: Michael Larabel <Michael@phoronix.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5586dd729b153e37f942a285d328a07f3fe7ae16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 31 09:25:48 2011 +0100

    sna/trapezoids: Refactor to project the trapezoid only once
    
    And doing so means that we can go back to using the common validity
    check.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3507437cdba62c28772822cce8c4b656448546db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 30 22:13:24 2011 +0100

    sna/trapezoids: Reject invalid traps after projecting onto the sample grid
    
    If either of the edges are degenerate on the sample grid, then the trap
    has zero height and must be skipped. (Otherwise if just one edge becomes
    degenerate than the polygon becomes unbalanced and the rasteriser will
    implode.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 150a0612d545b7fd77bf393efdef1cc92ed91e61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 30 19:45:22 2011 +0100

    sna/trapezoids: Allocate sufficient space for a8 mask for mono traps
    
    Oops, a silly cut'n'paste from caused us to allocate an A1 pixmap for
    mono traps instead of the A8 pixmap that we tried to write to; mayhem
    ensued.
    
    Reported-by: Eugeni Dodonov <eugeni.dodonov@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aafe03d3d1cfd5cbdf345cd51436de268ac27b6f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 29 16:47:48 2011 +0100

    sna: Retain the GTT space used for an upload buffer
    
    In order to retain the GTT space without keeping hold of the memory used
    for the upload buffer, we have to create a new bo and copy the relevant
    details across.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28c8c5ca14c5b4eab7e2dc58c87050c1019037bb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 29 16:27:35 2011 +0100

    sna: Free the buffers immediately upon release
    
    They do not appear to have been leaked per-se, but we end up
    accumulating the unused buffers. A more complicated solution would be to
    reallocate the handle for retained buffers so that the GTT region can be
    reused.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=39184
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f2fc00944272243af343a8b99f6eb8e0dfda006
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 29 15:14:41 2011 +0100

    sna: Cleanup up the cache upon close
    
    To help with leak-chasing under valgrind.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ac4b974b90a5614d1114d5e211cb4b986a89454
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 29 10:46:46 2011 +0100

    sna/video: Defend against PutImage to a broken screen
    
    Similar to the previous commit, check that the Screen Pixmap is bound to
    a bo before proceeding.
    
    [Note that in this case, the absence of the bo would have been picked
    up much later after doing all of the setup...]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0a74cd77a3f462d5d2707bf1f35663279bcb9be5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 29 10:41:26 2011 +0100

    video: check that the pixmap exists before use
    
    Now, the pixmap being used is meant to the Screen pixmap and by rights
    that has to exists in a GPU buffer! Evidence contrary to the above
    exists and so we had better check that we have a bo before using...
    
    Reported-by: Toralf Förster <toralf.foerster@gmx.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40439
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8216c92d5c49d4b8de5c16b615bca0acece49a70
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 28 22:32:09 2011 +0100

    sna/trapezoids: Use the tor scan converter to compute the low precision mask
    
    Take of the advantage of the faster mask computation available using the
    imprecise tor scan converter for chipsets non yet supporting spans.
    In doing so, limit the ability to full step only for vertical only rows
    as the small sample grid reduces the benefits of the computationally
    more expensive full-step.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aeee6db798e9ded746b399bc08716cff0bd16ef8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 27 11:43:48 2011 +0100

    sna/trapezoids: Reduce imprecise sampling to 4x4
    
    Note this also revealed a subtle bug in the handling of degenerate
    trapezoids after shrinking to the raster grid.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ac1b83240e5d4dc5d5bacad3ed49446143cc5589
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Aug 27 11:42:19 2011 +0100

    sna/accel: Simplify single pixel read-back
    
    The single pixel case is usually assocated with synchronisation of perf
    clients and so we do not want to incur extra complication along that
    path. Also the cost of tracking a single pixel of non-damage outweighs
    its benefit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 786a770f528a0daee2971494352672cb89f48384
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 25 19:52:13 2011 +0100

    sna/video: Flush the video state at the end of the operation
    
    Or in the case where a second command is received prior to the batch
    being flushed, the vertex data is not flushed and leads to the a
    miscompution of the number of vertices emitted.
    
    Reported-by: Elias Probst <mail@eliasprobst.eu>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=40332
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bd98001a49be061f0f2cb008b515f5505c8a63a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 25 14:49:30 2011 +0100

    sna: Clear structures across server reset
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0865acb3ad03239ffdf8cbf3c9fc204b6c97121b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 25 12:47:27 2011 +0100

    sna/dri2: Add some debug around the use of the Resource database
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98b67457caea583de50bff1b11a3c5a2bd694e26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 25 12:45:43 2011 +0100

    sna/display: Destroy shadow data
    
    Under certain circumstances the shadow can be destroy after being
    allocated but before being created. The pixmap is a NULL pointer at that
    time, but we know that its value should be data, so just use the data
    pointer instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9ae4e7e71527f1cf2b6dd6890420da22a22fad9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 24 21:38:28 2011 +0100

    sna/gen3: reset blend state after applying CA pass
    
    Otherwise we use the stale value when rendering CA glyphs directly to
    the front-buffer and subsequent rendering have a tendency to become
    invisible. (Rendering via a temporary glyph mask has a fortunate
    side-effect of reseting sufficient state to force the re-emission of the
    blend state.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef52f6c8c3421a31552d5965c40b4d9cf68f6a5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 24 11:04:28 2011 +0100

    sna/render: allow CLAMP_TO_EDGE for outside samples of extract regions as well
    
    When clipping the sample region to the edge of the texture we can also
    allow the GPU to use CLAMP_TO_EDGE (as well as CLAMP_TO_BORDER) to
    emulate the RepeatPad mode of the parent texture. (Only the
    RepeatNormal, RepeatReflect need special treatment with regard to tiling
    that is not yet handled.)
    
    This fixes the recent performance regression due to a slight change in
    the fish benchmark that caused it to sample outside of the texture atlas
    for one of its little fish.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d330f3751e484d28293fc593a20375a31b068bc7
Author: Stefan Dirsch <sndirsch@suse.de>
Date:   Fri Jul 22 12:21:01 2011 +0200

    Fix array size calculation for intel_pci_probe().

commit ccddff087df0c567c28416941b175be81190a1d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 8 00:42:21 2011 +0100

    sna/trapezoids: Speedup tor rasteriser
    
    Faster sorts for the win.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bfbe36cfea76337689dd8a101ec03469f6d3553d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 11 01:08:49 2011 +0100

    sna/gradient: Use a high-precision ramp for a color step rather than fallback
    
    Slightly less precise, but the difference should not be observable in
    practice...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e61e235bf7a926fd4e5b1f5a05b72dce4c450f3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 22:55:31 2011 +0100

    sna/damage: Take advantage of marking all-damaged
    
    Return early from adding new damage regions if we know that we have
    already marked it as all-damaged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a81bb6bafdbd37802dab96b8f05173ec6701d7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Aug 9 09:42:40 2011 +0100

    NEWS: 2.16.0 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4bbbd1dfe59031f864c7d2bbf7bb0252a3aa6a7
Author: Edward Sheldrake <ejsheldrake@gmail.com>
Date:   Mon Aug 1 14:46:08 2011 +0100

    Fix man page formatting
    
    Two option sections were not starting at the beginning of a new line.

commit 63518c42234001ec96f638af5732c09079a3d682
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 1 13:36:28 2011 +0100

    dri: Build fix for xserver-1.7.7
    
    Back in the olden days before the introduction of dixRegisterPrivate().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7976f5144d42a03ccd027908252a600db2631054
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 30 09:21:36 2011 +0100

    NEWS: 2.15.901 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cfb703bbe7ec043d443452f4fa94f06b1ff7266
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 30 09:23:22 2011 +0100

    Fix typos for distcheck
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f919264da69ed8bce6f2573629d89962a670783
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 30 09:00:06 2011 +0100

    sna: Mark the stencil as untiled
    
    In reality, Mesa will be treating it as W-tiling, only we have no way of
    communicating that requirement to the kernel (as not only does the
    kernel not understand W-tiling, but also the GTT is incapable of fencing
    a W-tiled region.).
    
    Ported from Chad Versace's 3e55f3e88.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 326a84e832c43cc200a32e091b4e60b8b6a4a7c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 22 11:10:26 2011 +0100

    sna: Port IVB acceleration code (Xrender + Xv)
    
    Based on the superlative work by Kenneth Graunke and Xiang, Haihao.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10790921570fea21d6b2bcc07a0204ef315c9182
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 30 08:46:19 2011 +0100

    sna: Include the pixmap size in the debug info for moving to cpu
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5691c8cdec2a5264b8552f096b4a34b97afe4ae5
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Jul 14 10:14:53 2011 -0700

    render: Enable RENDER acceleration on Ivybridge.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d92612b2a2782f80196a08eb9a17af906169f18
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Jul 14 00:30:09 2011 -0700

    render: Update pixel shader state for Ivybridge.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7460ee73d1fd22e6b02ce125f11ac38efff743ce
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Jul 14 00:16:54 2011 -0700

    render: Use Ivybridge variants for 3D pipeline setup.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3a09608716c1dee2554e8fc26d6f77aeec684bd
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Thu Jul 14 00:04:31 2011 -0700

    render: Refactor to use newly shared pipeline setup code in i965_3d.c.
    
    Slightly generalize the shared SF and CC code to accomodate both.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 682a690bfeeabae710b1392282163eab35b58eed
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Wed Jul 13 22:52:52 2011 -0700

    Xv: Refactor out pipeline setup functions for future reuse in render.
    
    While we're at it, make the functions simply take an intel_screen_private
    pointer directly instead of having to fetch it from ScrnInfoPtr.
    
    Also coalesce some gen6/gen7 functions that were 98% identical.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54b3222658a285d26b7800bdc5f8343c918a804e
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Wed Jul 13 22:27:37 2011 -0700

    render: Update 3DPRIMITIVE for Ivybridge.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e491a1f6d7a15009904cb79e2c0b13cf2d9d6ec
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Wed Jul 13 22:19:21 2011 -0700

    render: Set Address Modify Enable in 3DSTATE_VERTEX_BUFFERS on Gen7.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2787cd66f0d2907110f774392370537df63a96fa
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Wed Jul 13 22:10:17 2011 -0700

    render: Update SAMPLER_STATE for Ivybridge.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1a7e541d0d33727953fa69f1e29fa4eda665a0d9
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Wed Jul 13 21:53:27 2011 -0700

    render: Update SURFACE_STATE for Ivybridge.
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07cc488bcf3f7653cd54928e3cedb1f4f102c5e0
Author: Kenneth Graunke <kenneth@whitecape.org>
Date:   Sat Jul 9 01:36:52 2011 -0700

    render: New Ivybridge assembly programs for render acceleration.
    
    These are exactly the same as the ones for Sandybridge, but with message
    registers translated (hopefully) in the same way as Haihao's new
    programs (m1 == g65).
    
    Signed-off-by: Kenneth Graunke <kenneth@whitecape.org>
    Acked-by: Eric Anholt <eric@anholt.net>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b9e82b4b59dd50c1b057f58d71d5c04dcc648a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 26 08:29:36 2011 +0100

    sna: Revert enabling scan-line wait on SNB
    
    Hanging the machine does indeed prevent video tearing. Just not quite
    what the user expected...
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=39497
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6dbbb74bde034f5f00aee0396ccd1e03a6625fbd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 16 14:05:54 2011 +0100

    sna: Enable gen6 scan-line waiting
    
    The code was ready and waiting, just forgot to turn it on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e55f3e88b40471706d5cd45c4df4010f8675c75
Author: Chad Versace <chad@chad-versace.us>
Date:   Mon Jul 18 00:38:00 2011 -0700

    dri: Do not tile stencil buffer
    
    Until now, the stencil buffer was allocated as a Y tiled buffer, because
    in several locations the PRM states that it is. However, it is actually
    W tiled. From the PRM, 2011 Sandy Bridge, Volume 1, Part 2, Section
    4.5.2.1 W-Major Format:
        W-Major Tile Format is used for separate stencil.
    
    The GTT is incapable of W fencing, so we allocate the stencil buffer with
    I915_TILING_NONE and decode the tile's layout in software.
    
    This commit mutually depends on the mesa commit:
        intel: Fix stencil buffer to be W tiled
        Author: Chad Versace <chad@chad-versace.us>
        Date:   Mon Jul 18 00:37:45 2011 -0700
    
    Signed-off-by: Chad Versace <chad@chad-versace.us>
    Reviewed-by: Ian Romanick <ian.romanick@intel.com>
    Acked-by: Kenneth Graunke <kenneth@whitecape.org>

commit 212fa9868767637e8f430485eeb522c99e63fd16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 21:11:14 2011 +0100

    Disable adding normal RTF modes for an eDP
    
    This is causing a hard hang with 2.6.39+, we don't know why so play safe
    and disable for the time being.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=38012
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a695c9f6b919eba8785d62094526762ba2a0449
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 10:57:13 2011 +0100

    sna: Fast-path single span boxes
    
    These are very common when compositing unclipped trapezoids, and the
    majority of the overhead is in handling the arbitrary number of boxes
    and misses out on the constant folding the compiler can do if it is
    known we have just one box.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0190964906ad878d469d6021c10cde4e7f5799c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 10:26:44 2011 +0100

    sna/damage: Avoid testing against a completey damaged region
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b929717c89352d4b47dc2b9ce58e26fbbf327201
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 09:49:09 2011 +0100

    sna/gen3: Tune emit_spans_primitive_constant
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbdbfaf38d4da5204750d91cf5a3f43307a6ac33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 17:38:41 2011 +0100

    sna/glyphs: Discard GLYPH_PICTURE hint if the glyph doesn't fit into the cache
    
    If the glyph is too big to fit into the cache, than ideally we do want
    to keep an associated GPU bo around for future use. As it is too large
    to fit into the cache, it of reasonable size and there is little wastage
    in allocating indiviual GPU bo for each oversized glyph.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12f52530db1727e2f835e55dc922e5efaf4d3a16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 13 17:38:22 2011 +0100

    sna: Add some extra debugging to the texture upload fallback paths
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a861094c23b5f0df7b889bcc03904e32c4c2c6be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 12 20:17:00 2011 +0100

    sna/dri: Fix a couple of typos
    
    Somehow these were lost in the rebasing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c221d0356db57c10f5d29ca17fdf592724b35385
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 12 15:39:42 2011 +0100

    sna/dri: Remove the unused id/type members for Resource tracking
    
    ...and reduce it to a simple list.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 644b1a903301531e1fb59f27952c15e87888c4c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 12 11:50:24 2011 +0100

    dri: Always initialise resource members of DRI2FrameEvent
    
    As we now attempt to always decouple the lists upon freeing the frame
    event, we need to initialise them along all code paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 32f42358140ee812984149ae52b0df3dfd1778c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 11 20:29:53 2011 +0100

    sna/dri: Add some simple debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a46598220ebf5d4e629e1e0a7baf47ce144ed2c8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 11 14:40:30 2011 +0100

    sna/dri: Refactor common code for assigning a pixmap to the DRI2 buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7538be3315b8683b05e8f6b22023baadcc0bc4da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 11 10:50:36 2011 +0100

    dri: Enable triple-bufferred pageflips
    
    By popular demand.
    
    Triple-buffering trade-offs output latency versus jitter. By having a
    pre-rendered frame ready to swap in following a pageflip, we avoid the
    scenario where the latency between receiving the flip complete signal
    from the kernel, waking up the vsynced application, it render the new
    frame and then for the server to process the swap request is greater
    than the frame interval, causing us to miss the vblank. The result is
    that application can become frame-locked to 30fps. Instead, we report to
    the application that the first frame swap is immediately completed,
    supply a new back buffer (or else the rendering would be blocked on
    waiting for the front-buffer to be swapped away from the scanout) and
    let them proceed to render the second frame. The second frame is added
    to the swap queue, and the client throttled to vrefresh. (If the client
    missed the vblank, the swap queue is empty and the client is immediately
    woken again, whilst the pageflip is pending.)
    
    Note, for practical reasons this only applies to page-flipping, for
    example, calls to glXSwapBuffer() on fullscreen applications.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2608a367acba7247e50754c3daeed09ba2e97d05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 11 16:28:15 2011 +0100

    dri: Prevent abuse of the Resource database
    
    The Resource database is only designed to store a single value for a
    particular type associated with an XID. Due to the asynchronous nature
    of the vblank/flip requests, we would often associate multiple frame
    events with a particular drawable/client. Upon freeing the resource, we
    would not necessarily decouple the right value, leaving a stale pointer
    behind. Later when the client disappeared, we would write through that
    stale pointer upsetting valgrind and causing memory corruption. MDK.
    
    Instead, we need to implement an extra layer for tracking multiple
    frames within a single Resource.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=37700
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ab1000821ae881a301fb0e1f2210493ec383e681
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 9 19:44:26 2011 +0100

    dri: Remove the shadow copy of attachment
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f22ea7ca440c788f8104647356393c96c62d155
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 9 14:54:33 2011 +0100

    sna: Clamp results for computing BoxRec coords from xRectangle
    
    As the width/height in the rectangle is specified as uint16_t, the
    result may be larger than is storagable in the int16_t of the box. Of
    course it would take a really inane client to do attempt to draw
    something much larger than the largest possible surface... Is it strange
    that first example I've found to do so is a Java application?
    
    Reported-by: Nicolas Kalkhof <nkalkhof@web.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f4c5dc88171435aa04a5d99372913120cdafe92b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 9 14:17:24 2011 +0100

    sna/accel: Fix fallback for depth=1 copy
    
    A little carelessness with passing down the offsets caused us to
    incorrectly copy depth=1 bitmaps, as exemplified by gkrellm.
    
    Reported-by: Nicolas Kalkhof <nkalkhof@web.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 649ebcef0938c7cde4f3172a639d39488454999a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 8 17:44:58 2011 +0100

    sna: A buffer only needs a flush if it remains dirty at the end of the batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 625e37b317e4d237bdc9f80d7ab86b5d2badddc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 8 18:58:32 2011 +0100

    sna/gen3: So we also need to ensure stippling is cleared...
    
    My theory that we used nothing that invoked polygon stippling proved
    baseless.
    
    Fixes regression from 3b5971bd2359383cb8326702d80e03bc15d34c69
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1e2cae0ab339e477929e429f8ff31b11fcaf2cbf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 8 09:54:43 2011 +0100

    sna/gen3: Restore disabling the use of stencil/fog in the invariant
    
    One cleanup too far causing spurious results after rebooting. We also
    need to ensure that the writemask is fully enabled (ie not disabled)
    as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec3dd64e739c4c2bbd8141de5275fe8a90f24a57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 8 00:17:27 2011 +0100

    sna/dri: Enable chaining of page-flips
    
    Trade off extra frames of latency for extra frames of anti-jitter
    buffering and loss of completion information; compiz users rejoice.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a32694b0f07e35c22dd83bcfb828196d5d86628e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 7 23:11:39 2011 +0100

    sna/dri: Remove redundant NULL check in reference
    
    The buffer has already been dereferenced by this point...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d180c5f5f781f4fa7f747dd7bb8073a20771cd79
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 6 20:19:00 2011 +0100

    sna: Take advantage of the needs_flush tracking on the front buffer
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0be47f459ba576ed3f93367de18732fb2367357a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 6 13:02:53 2011 +0100

    sna: Check against an execbuffer reference before discarding partials
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6573fe7577e00a1d2706dbc39179ab658c021d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 6 12:44:08 2011 +0100

    sna: Compute aligned tiled heights for gen2 correctly
    
    We were underestimating the height of X-tiled surfaces (and less
    harmfully overestimating the height of Y-tiled surfaces.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6afd66461ebcdc2e8dcd94b3f46f374d8acf469
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 23:12:59 2011 +0100

    sna: Reset unused partial buffers
    
    Whilst searching for available space on the active partial buffer list,
    if we discover an unreferenced one, reset its used counter to zero.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e7a0c86419bf6c928837f592784333c25d8b27b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 23:05:37 2011 +0100

    sna: Discard unused partial buffers
    
    If we allocate a partial buffer and then fallback for the operation, the
    buffer would remain on the partial list waiting for another user.
    Discard any unused partials at the next batch submission or expiration
    point.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3b5971bd2359383cb8326702d80e03bc15d34c69
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 22:20:28 2011 +0100

    sna/gen2: Restore invariant ENABLES
    
    One deletion too many, unnoticed until the next reboot. Besides the
    failure to disable logic op and enable colour buffer blending which
    causes a hang if you subsequently try to enable both, you also need
    to request texture caching...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fa3e73f2c03bcadb87c1760f76f853c22fdba18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 21:38:08 2011 +0100

    sna/gen[23]: Do as the comments suggest and prefer the BLT
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f749ed618e21b56a36a2feb9b4333ec797ec2ae5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 21:37:02 2011 +0100

    sna: Reduce tiling if pitch is less than a tile_width/height only on pre-G33
    
    (Note this only applies to 2D pixmaps.)
    
    The rationale, borne out by experimentation with cairo-perf-trace, is
    that on the pre-G33 devices we always need a fence region region
    for tiled surfaces, i.e. at least .5/1MiB in size, and that combined
    with the smaller GTT on those devices, we loose the benefit of tiling to
    the excessive GTT thrashing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9de6a98d33db660ffad3f186c2b0ab2aea71ac0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 5 17:48:11 2011 +0100

    sna: Remove unused aperture_size member
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd3bc2af471a3f9a73064cb28818fdd3485cffc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 4 16:31:20 2011 +0100

    sna: Clamp object size to the min of 1/4 of the whole GTT or 1/2 the mappable
    
    ... for those pesky early devices whose GTT was no larger than the AGP
    aperture.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d294e41a6a49ddaa6f8d7d5cda266168095fe1f5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 4 13:45:06 2011 +0100

    sna: Update flush/retirement lists after a implicit flush for mmap
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e53b0f3a365c031bfef8d087bcee0ae1c2d2988
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 4 13:44:28 2011 +0100

    sna: Enable relaxed-fencing for gen2 devices
    
    (Just as dependent upon non-buggy kernels as gen3...)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33ddaf54299979e98b196d479f1b2060d9551cc5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 4 13:43:48 2011 +0100

    sna: Fix gen2 tiled surface sizes
    
    Actually use the gen2 path for gen2 devices!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9eceddf69f78fc79c02ca75ed10b000beeff2033
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 4 13:42:58 2011 +0100

    sna/gen2: fix batch buffer acounting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f80f7edb8c511b94e66159cd59ba9362c3f69a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 23:16:04 2011 +0100

    sna: Manually set to the GTT domain for mmap
    
    ...since the kernel no longer does strict coherency.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f91ee24b2dabb48288d6e81dcdd82191f158e312
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 23:05:04 2011 +0100

    sna: Trim number of downsample passes
    
    If we can fit the entire width or the entire height into the pipeline
    when downsampling, do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6db93720a73f59a9857a3c5ab260fab8b957813e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 23:04:14 2011 +0100

    sna: Don't change tiling modes on replace
    
    This was trying to workaround a kernel bug, and instead causes a
    performance cliff for textures that *need* to be tiled.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 430c905ef306ece8a4cb19091711a9feae74b00b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 18:24:40 2011 +0100

    sna: Force tiled modes for large pitches
    
    If the surface is so big that the 2x2 texel sampling will cause a TLB
    miss everytime, i.e. the row pitch exceeeds 4096, then we need to
    encourage tiling to prevent attrocious performance.
    
    For example, try downscaling a 2560x1600 background image on a gen3
    device using I915_TILING_NONE...
    
    Using slideshow-demo /usr/share/backgrounds/cosmos/whirlpool.jpg, on a
    PineView netbook, fps goes from under 4 to over 40.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae567b783e5af53f17f49dbf58b9be17fcb53737
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 00:11:21 2011 +0100

    sna: Finer-grained debugging for trapezoids
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98f2e3855d70c02b05e2721a70ebce0c17e44283
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jul 2 09:53:11 2011 +0100

    sna/video: Downgrade severity of "overlay not found" message
    
    We don't need to warn the user that their hardware does not support the
    video overlay plane (but Jesse is working on it!), but merely inform
    them that its presence is lacking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 01c258718e981f4da949a4e48595a0660d55d66e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 23:17:54 2011 +0100

    sna/gen2: Add missing stub debug files
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c8a108d2c99f542372efb1734c96ddd2af6bc76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 21:24:43 2011 +0100

    sna/gen2: Recompute blend pipeline for component-alpha pass
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 121511d3bd63da5eca28edf971aae3d062aed46e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 16:54:28 2011 +0100

    sna/gen2: Pack solid sources into the default diffuse component
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a303f85c163979276ff13e00b7c56f55b5fd1d07
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 16:27:11 2011 +0100

    sna/gen2: Remove unused state from invariant setup
    
    ... and also some state that gets clobbered when we install the
    composite pipelines.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 120c98ac10435c8e848a8337c1f544f81a05cd3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 14:55:44 2011 +0100

    sna: Downsample sources 2x too large to fit in the 3D pipeline
    
    This is quite trivial to hit given the 2k limits on gen2/gen3. We
    compromise on image quality by pre-downscaling the source by a fixed
    factor to make it fit into the pipeline in preference to performing the
    entire operation on the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f6c8c3bb6fd75bca6c7704b7d5869a5d44ce3832
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 11:17:32 2011 +0100

    sna/gen2: Use specular component for solid spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de14e3c8595f9e315dc3ce23ad15b04e118499f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 09:58:27 2011 +0100

    sna/gen2: Add missing render fallbacks for blt ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ecbf6bbd27b1205dcf76cfe34ae2a7a3f5ec195a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 1 08:50:58 2011 +0100

    sna/gen2: Implement composite-spans
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c89b37d7b43c9e588097b7fadcba3bc13a03f8bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 30 17:53:49 2011 +0100

    sna: Mappable aperture is region 0 on gen2
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c0434ab49035bf278dad6f5f84a541ea58536fb4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 30 16:31:28 2011 +0100

    sna: Distinguish 830/845 vs 855/865 using the generation id
    
    Remove the PCI ID device checks by using the simpler check on the
    generation id for errata pertaining to 830/845.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18d08e49d270b7a05f14a309759c9315e5ab9679
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 28 20:25:46 2011 +0100

    uxa/glyphs: Fallback instead of crashing on large strings
    
    Not ideal, but being slow is a major improvement over losing data.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=36860
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95866bd6bdaeb612732fd43ec1b93e088763086e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 27 21:07:22 2011 +0100

    sna/video: Use EXTEND_PAD to avoid mixing in the border color
    
    ...which is 0 and appears green around an unaligned YUV-video.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=38723
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7446b39f04306ae2ffccdfe8dd6c8bda64a27043
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 27 15:26:49 2011 +0100

    sna: Disable XVideo using the TexturedAdapter if the GPU is wedged
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 44cd6ebf43aa5b7f23c03629a11cdf83b6e96e3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 26 18:41:20 2011 +0100

    sna: Typo in debug assertion.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5cd7f5b59857f221bd3aa9965b43b938ff7824ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 26 18:36:05 2011 +0100

    sna/dri: Mark the GPU bo as damaged upon a page-flip
    
    ...so that CPU pixmap is correctly invalidated for the next readback.
    For instance, if you were to take a screenshot on a composited destkop.
    
    Reported-by: Sitosfe Wheeler <sitsofe@yahoo.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4f7959266571f14c43c0f0cea69134bb8556875
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 26 14:09:11 2011 +0100

    sna: Only create bo up to half the size of the mappable aperture
    
    As we use GTT mappings if writing directly into the tiled buffer and the
    available aperture is reported by the kernel as the total GTT and not
    limited to the fenceable/mappable region, we need to manually probe this
    value and ensure that our creation and fenced routines observe this
    distinct limit.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 130350111720a0e4ae825bb9d21a8c481cd2b548
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 25 23:21:20 2011 +0100

    sna/dri: Reorganise schedule_swap to not confuse immediate and wait paths
    
    Eeek, the wait-for-target-msc was using the immediate swap path, meaning
    that for copy-swaps the copy was submitting immediately but the client
    throttled waiting upon the target vblank. What is actually intended is
    for the presentation to be delayed until the target_msc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b460b9645451af84136c5daebbc00c7545de67f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 25 16:34:15 2011 +0100

    sna/dri: Fix composited copy-swaps
    
    The secret is not to cheat and render directly to the front buffer, but
    remember to mark the Window as damaged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28fffbd1d07890c8b4d697369159f6a30f267675
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 25 16:33:31 2011 +0100

    sna/display: Protect against drmModeGetCrtc returning NULL
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c73b4651a04390668c3ed2aa10699663e44fd8a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 25 16:32:30 2011 +0100

    sna/gen4+: Use the drawable rectangle offset for copy boxes
    
    Saves a little bit of work whilst emitting the rectangles.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3833ff967766b0b99f1d636c6453de1783a90586
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 25 14:02:50 2011 +0100

    sna: Correct typo in computing damage of PolyPoint
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=38614
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 471115a9806162bf0cafe27947f49d94fdd63d87
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 13:32:45 2011 +0100

    sna: Also allow BLT copies to discard the alpha channel
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c3b1a0d7046a83b6daec03e5a562116e3adf3c71
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 12:19:09 2011 +0100

    sna/dri: Copy to real front upon swap
    
    The front-buffer of a DRI2 drawable, may not in fact be pointing to the
    scanout pixmap. So override the destination for swapbuffers to update
    the scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 669378cd8db8af89d12f1b95a07fc1ead0b1569c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 11:53:17 2011 +0100

    sna: Wrap the fbcon in a scratch pixmap for render-copy across depth changes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33b2ea0392fe944b210ef744398aa22989bfdf33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 11:43:07 2011 +0100

    sna: Avoid using the BLT to copy between mismatching depths
    
    We either conflated bpp (which fails given a mixture of depth-24 and
    depth-30 pixmaps) or neglected to check at all.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28f6dc24d3c50aa399dd098a9ba6a18a95837800
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 11:24:59 2011 +0100

    sna: Support depth-30 and some more logging to show the depth
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 312460ea69792594fe9acca8591ead55baea7d99
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jun 23 00:20:03 2011 +0800

    Xv: set up pipeline for Xv on Ivybridge
    
    The configuration is same as that on Sandybridge, but
    many state commands are changed
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 90a0800588f83d78254136b94bca656c4c24215d
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Jun 21 14:14:38 2011 +0800

    Xv: upload new shaders to GEM objects for Xv on Ivybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 00614f712b243a7724cf919f94d204a123d2789a
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jun 23 00:09:21 2011 +0800

    Xv: update SURFACE_STATE & SAMPLER_STATE for Xv on Ivybridge
    
    SURFACE_STATE & SAMPLER_STATE are changed since Ivybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 70f884772a3adc5dbf56572499c5fb2e080aa84a
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jun 23 00:02:38 2011 +0800

    Xv: New shaders for Xv on Ivybridge
    
    Redefine some M4 macros, also update the check for
    intel-gen4asm to support Ivybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 3cf423bd3a9483181e59ee87376a9487fa1f923d
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Jun 22 23:33:08 2011 +0800

    Xv: separate fragments from M4 macros
    
    It is to prepare for Xv on Ivybridge. The difference from Sandybridge
    is that all message payload must be in GRF registers instead of MRF registers
    on Ivybridge. We will only redefine some M4 macros for Ivybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 58d7a89b93ba4022f45465e479d2799b8903137a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 00:35:30 2011 +0100

    sna: Don't render to invalid surfaces
    
    Fixes a regression from d0362a. In bypassing the is_wedged checked, we
    also ended up bypassing the checks that we could indeed render to the
    target bo. With the result that we were creating GPU buffers for SHM
    surfaces, something that requires Xserver fixes before we can actually
    enable...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c1d5bc35e02dfd8234c029dcab5661e1656ca8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 24 00:34:11 2011 +0100

    sna: Clip the fbcon to the frontbuffer
    
    ...both to correct the placement of the fbcon into the smaller scanout and
    to ensure that we correctly clip the boxes to be copied.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3b4c10f239f69e5282bde1d3b0c3685b24cf0aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 23 20:54:28 2011 +0100

    sna: Relent and workaround the lack of O_NONBLOCK on /dev/dri/card0
    
    So in order not to block server shutdown, check that the fd is readable
    before attempting to read from it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33d3077266942b23c5bc05ef4a9a6cebe357272a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 23 15:53:45 2011 +0100

    sna: Debug compile fix, and some extra comments
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03e6aee8fd2cc7486fbd2ec55a537c712786486b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 23 15:51:59 2011 +0100

    sna: For an unbounded op, we need to convert the whole surface
    
    Otherwise if we fail to check, then we create a 0x0 surface to sample
    with the operation -- net result is that we end up using a clear source
    instead of the desired mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 356ded1308e8fe5f8dbec217b219228a991356d5
Author: Adam Jackson <ajax@redhat.com>
Date:   Wed Jun 22 17:17:15 2011 -0400

    Don't include xf86Priv.h
    
    I'd like it to not be in the SDK anymore, and we're not using anything
    from it.
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8fb98e22a63a4354b049ace7870abb6406541c28
Author: Jian Zhao <jian.j.zhao@intel.com>
Date:   Wed Jun 22 08:54:59 2011 +0800

    configure: Define required_xorg_xserver_version later so it can make successfully.

commit ea71133da78632d4cfee5b0b4c96e8dddd6cdf44
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 21 12:28:13 2011 +0100

    sna/video: Use pwrite for upload of unclipped, unrotated frames
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f6afb5b1f02cc448da1b342627108ceddda4f0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 20 17:29:17 2011 +0100

    sna: Only reduce gpu damage after migration
    
    Otherwise we end up doing work for no reason, ala the regression in
    grads-heat-map. However, it is important that the damage is reduced at
    some point or else it may grow unbounded. Hopefully normal usage will
    never hit the pathologocial case...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 88d840b53d64e67cfee14cc4cef8da46d716c401
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 20 15:22:57 2011 +0100

    sna/gen4: Check for sufficient batch space before emitting pipelined pointers
    
    For the broken shader workaround, we need to reset the pipeline state
    before every blt as the state is changed by the magic CA pass. So we
    need to check that we actually have sufficient space to emit the
    pipelined pointers before doing so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84bd6e51199bf8b49e6f6e0c29a1d71c89f6996f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 20 15:22:00 2011 +0100

    sna/gen4: Correct the number of dwods required to emit the ca pass
    
    We need 7 for pipelined pointers, 6 for the primitive and 1 for the
    flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 22255335e428cb1f349fe4198d36e0ab3fe06948
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 20 13:51:12 2011 +0100

    sna: Don't perform a GPU copy of the scanout if it is wedged.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2684498a4905b4ac157a1c752c1c4f75301e7ad
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 20 13:50:43 2011 +0100

    sna: Add some debugging asserts for handling wedged GPUs
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0362a20bb3ead2fab9401b63209f917bdd72d55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 19 19:33:01 2011 +0100

    sna: Bypass the gpu-is-wedged? check for forced bo creation
    
    In order to attach a scanout (and use swrast) on a wedged GPU, we need to
    bypass the safety checks for normal pixmap creation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 585667c2f9f88554ed89ff21ae38600f761d964c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 18 15:52:22 2011 +0100

    sna: Bump the required xserver version to 1.10
    
    SNA requires some pending bug fixes to the xserver so it makes little
    sense to conditionalise the code and deliberately cause broken
    behaviour.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=3843
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit de0286ed9f7814f903d56e488c7a4b3eb0ca56b0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 17 09:40:53 2011 +0100

    sna/display: After copying the fbcon, tell the server that we have a background
    
    ... so that the core knows to skip the clear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3869d60cc3bc349d1efba642baa011378f1c09b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 17 09:37:15 2011 +0100

    sna/display: Apply damage for the fbcon copy
    
    ... so that any immediate shadow usage will read back the fbcon
    contents.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 39f0b0ae17d00402971bb62555d3807bdf39ee93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 23:49:06 2011 +0100

    sna: Copy the fbcon contents onto the front buffer upon X startup
    
    This patch has been carried by the distributions every since they
    started doing graphical boot splashes. Time to integrate it and give it
    some TLC.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 37ba33f502af0878f6cb75f890c9fe288d0f7e41
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 17 07:03:25 2011 +0100

    sna: Fix kgem_create_from_name error paths and to mark the bo as non-reusable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 665bc1735748f266fad5255f82c40edc59ef98e5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 17 07:00:54 2011 +0100

    sna/display: Remove the caching of the drmModeCrtc
    
    We only use it for the id. Everything else stored on it, like the
    buffer_id, is not permanent and we need to query the current status as
    required.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad6235cfb11a5dfdd27106ac45106aaacba73bde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 19:02:36 2011 +0100

    sna/accel: convert BOX_ADD_RECT to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a86f43988c4ded10cc3b1b964668300c9aa3af59
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 19:00:09 2011 +0100

    sna/accel: convert BOX_ADD_PT to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f67a26590aadac8b9b9870ae3b03d23eb7eda1a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:58:38 2011 +0100

    sna/accel: convert TRIM_AND_TRANSLATE_BOX to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit df1b117dedfdda425fbc3e4ee394169902df4716
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:57:38 2011 +0100

    sna/accel: convert TRANSLATE_BOX to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 76ff3c715cf6059316d08217e7e7783ca0388393
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:56:24 2011 +0100

    sna/accel: convert TRIM_BOX to an inline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e4a66368e71df288323fce66b27237f1d9f93c3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:55:03 2011 +0100

    sna/accel: convert CLIP_BOX to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d7b51cc5d6e624a72b2f2fb92b4488e49a1c749c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:52:56 2011 +0100

    sna/accel: convert BOX_EMPTY macro to an inline function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1c3c08e80f08adb12a03277a60c4a56115281743
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 18:37:43 2011 +0100

    sna: Fix the typo in BOX_EMPTY
    
    BOX_EMPTY(&box) surprisingly compiles and generates interesting code that
    evaluates to if (0). Oops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17bf0019b6962c06c87a08e4b41799481eaccd26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 14:26:06 2011 +0100

    sna: Only retire requests after IO if the bo was active
    
    We only want to process retirements if we know we caused a stall waiting
    for the GPU to release the bo before performing IO.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b707f18d17564653a2b45adf46a4e8eafcc6ab2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 14:16:06 2011 +0100

    sna: Purge the bo cache only if we detect aperture thrashing
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 855ced5a4eb67e287001ae22cb6489639c548cfa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 13:24:14 2011 +0100

    uxa: Remove the attempt to use the 3D pipeline for core rendering
    
    The attempt was still ridden with bugs, such as
    
    http://bugs.freedesktop.org/show_bug.cgi?id=28768
    http://bugs.freedesktop.org/show_bug.cgi?id=28798
    http://bugs.freedesktop.org/show_bug.cgi?id=28908
    http://bugs.freedesktop.org/show_bug.cgi?id=29401
    
    A fresh approach was taken with SNA, but in the mean time before that
    can be enabled downstream, restore correct behaviour.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dd4ad11e0d432f3a8eff4574a241c16f8463278d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 12:53:22 2011 +0100

    sna: compile fix.
    
    A pox on all those who write trivial patches, attempt to compile on a
    system not having dri2proto and just assume that all is good.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ff36af7e1841a82fd43a9317d07b3229a309df5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 11:23:16 2011 +0100

    sna/accel: Prevent initialising a region with an invalid box
    
    pixman complains if you attempt to use a region created with an invalid
    box, so don't do that.
    
    Reported-by: Reinhard Karcher <reinhard.karcher@gmx.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c02110052ecf69d43577ed8537a8850227da560
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 16 10:30:58 2011 +0100

    sna/dri: Add some comments to explain the choice of flags upon the bo
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 881f961a1c78e554e566ef624d6edcf28fee8fdf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 15 19:11:05 2011 +0100

    sna: Clear the gpu flag once is not busy and no flush is pending
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1ee4b930846d4ba9274028c08800b882fc926f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 14 23:46:15 2011 +0100

    sna/dri: And fix the blit swap paths
    
    Following on the recent successes with the pageflip paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f675cf402a6d158448a9300779829a10ca991fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 14 08:13:58 2011 +0100

    sna: Split zaphod across the crtcs
    
    Since we have no global resource allocator for zaphod mode, that's what
    RandR-1.4 solves, we have to further constrain zaphod mode to only use
    one crtc per screen. This also means that you must match the output
    restrictions within the Screen definitions, noting that the crtc pipe id
    corresponds with the screen number.
    
    Reportede-by: Phillp Haddad <phillip.haddad@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49f265915a4bca52724c345f04cddfeaca972655
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 14 07:59:50 2011 +0100

    sna: Compile fix for debugging enabled
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 12b8a62652e219de255fdd8b3c801c23274130e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 13 20:51:56 2011 +0100

    test: Exclude the long running stress tests from make distcheck
    
    tinderbox complains when it is left running for days on end...
    
    Reported-by: Jeremy Huddleston <jeremyhu@apple.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4173ca344bb7d3fb7c03ebdce0e31aa82dba1192
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 13 22:31:55 2011 +0100

    sna: Invalidate the mode if the front pixmap was swapped whilst blanked
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2158534421f26bcd1eca9ad74ab7a30f27e47a75
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 13 15:27:23 2011 +0100

    sna/dri: Accurately track front and pending front for async flips
    
    By not tracking the front buffer correctly, i.e. performing the exchange
    on every swap, GL_FRONT was no longer pointing at the updated buffer and
    neither was the root pixmap. So both X and GL would read the wrong
    buffer was the flip was pending.
    
    The other issue was that we would feed the old front buffer back to the
    application as a future back buffer (due to buffer caching) and so the
    kernel would duly insert a WAIT_EVENT for the pending flip to complete
    before allowing rendering to affect it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2facaa910798c0e7adb34345e6d6913849b7d8a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 13 11:46:04 2011 +0100

    sna/dri: Complete the pending async flip even after DrawableGone
    
    If the client exits before the async page-flip completes then we still
    need to decrement the pending flip count in order to correctly flip the
    scanout next time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86888723901030c5cb9da16cbb03508d4b13332f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 12 22:38:01 2011 +0100

    sna: Just do a pointer exchange when flipping with no scanout
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b881d1b16a8beec024ac18eca8308418e34cb05d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 12 20:13:26 2011 +0100

    sna: Check that the scanout is still attached before waiting for scanline
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb08e73c557c379ef131225ffea5aa729ca781d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 12 20:07:20 2011 +0100

    sna: Prevent tracking scratch pixmaps on older xservers
    
    Before the xserver is patched to send notification of release of the
    scratch pixmaps, we cannot associated GPU resources with them. In
    practice, the only advantage for doing so is for SHM pixmaps...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ff262aca9c46b7616c59d8e8f04d33a5bbc6e324
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 11 10:15:14 2011 +0100

    sna/dri: Fix tripple-buffering for vblank_mode=0
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b199bc2b415fd0f06e456e0b1f44dd25ba8dbe02
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 11 09:57:46 2011 +0100

    sna/dri: Skip querying current msc for immediate swaps
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f4dbcc8bde3690668bde739ac61178037612475
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 11 09:06:50 2011 +0100

    sna/dri: Queue page-flips immediately for next vblank
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00e8b4bec6dc5bb46e6f073af9c1fa34f4a2c2c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 11 09:00:16 2011 +0100

    sna/dri: For offscreen, swaps just exchange the buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9397b28eff5be4cd5e8a2ceca80333424f24391
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 11 08:54:04 2011 +0100

    sna: Process dri wakeups first
    
    The goal is to minimise the latency in receiving the event from the
    kernel and acting upon it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bcad5b21fef4573f3144608364cf5b1ea6d241e3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 21:27:38 2011 +0100

    sna: Unbreak configure after last commit
    
    I went a step too far... I still need some define in order to switch
    between uxa/sna at compile time.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0d65940b4f4d4993eccb8c66ec7e8b633b331da
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 19:51:12 2011 +0100

    sna: Remove the ability to disable chipset specific code
    
    This was a fun little, but pointless, exercise.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f035e80b98e478ff4c59427e50e57ecd710da62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 18:41:56 2011 +0100

    sna/dri: Keep reference on swap buffers until the end of the pageflip
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cf6c7901825bb831443615ef21555c5843184bdb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 17:49:13 2011 +0100

    sna: Use the ScreenPixmap->serialNumber as a generation count
    
    DRI2 presumes that the pixmap->serialNumber can be used as unique id.
    If it changes revokes *all* the buffers, it presumes a new pixmap has
    been attached to the window, for example after a reconfiguration event
    (resizing of a window, or a mode switch). However, as we updated the
    root pixmap upon a pageflip, we were triggering revocations everytime,
    causing further revocations and massive aperture thrashing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f19270d6795738b58d9ce1721896b3067b38c9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 15:29:57 2011 +0100

    sna/dri: Actually restrict pageflipping to properly aligned fs windows
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e9c628708ae838e5df3df89331243f84b297e8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 15:17:18 2011 +0100

    sna/dri: Create pixmap suitable for the framebuffer for fullscreen buffers
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b22de0b01453884d5018e7e0faef439421fa63a0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 13:30:54 2011 +0100

    sna/blt: Suppress overwriting boxes through fill_boxes()
    
    As the introduction of the unrolled fill_boxes() was bypassing the
    effective optimisation in fill_one().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ebeebc2044610e6e31d9cef746c768d2e435f32c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 13:07:13 2011 +0100

    sna: Use temporary for storing the current crtc box when computing best crtc
    
    ... as the caller may be reusing an input parameter for the result.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b3949d0d7424242703c9e60e2e33908499aa6a43
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 12:45:24 2011 +0100

    sna/kgem: remove erroneous assert during submit
    
    This was only valid for gen6+ with the multiple rings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33abb68da2c49081f28898f93cc4e14702b40d70
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 12:44:56 2011 +0100

    sna/kgem: remove redundant clears upon initialisation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cfde920a2e449efaa387850173e46f87d928023b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 11:27:04 2011 +0100

    sna: Remember to decouple the fb on closing
    
    ... so that we actually attach a new one after regen!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b6192ce95af8aa8be6d9a68a500393f2a73c2f4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 11:05:41 2011 +0100

    sna/gen4: Tweak calculation of required batch space for CA
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c9b89fc87f1d43a715cd9c5915bfed957175986d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 10:53:29 2011 +0100

    sna: Drain the event queues before CloseScreen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ea560e25dfcce3750339b477a1a3c05f504cf91e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 10:44:27 2011 +0100

    sna: Workaround the random free of the ScreenPixmap in fbCloseScreen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1f364c6d241e8971e8fc1447871c718240e4563e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 10:03:01 2011 +0100

    sna: Reset the kgem state on server regen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95ae39a93467655b2107b82bd7970f732c8de066
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 09:57:22 2011 +0100

    sna: Add some debug statements to the core DDX interface
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0594724dc4e9e459240b8b290ddf42ed711be22b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 08:18:07 2011 +0100

    sna/gen4: Restore normal state after CA pass and FLUSH_EVERY_VERTEX
    
    By working around the broken shaders, we emitted the CA rectangle in the
    middle of a sequence of glyphs and left the state setup for CA. So we
    need to reset the pipeline state at the start of every composite blt.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2dff681efe1b89ffe59e5d33979c6e059b72a786
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 08:23:19 2011 +0100

    sna/blt: Remove a couple of unused members from its op-state
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fbbd1c9dde3b2fafd8aaebb88daf3c546d86e5a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 08:22:00 2011 +0100

    sna/glyphs: Fix glyphs to dst fallback path

commit 3f46c34d534e389f541b5c7987b78981c556d868
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 10 08:20:12 2011 +0100

    sna/composite: Tweak setup for the minimal composite extents
    
    Clip the operation extents before passing to the backend to setup the
    operation, so that we only need to upload the minimum amount of data
    necessary, or avoid tiling etc.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a34caf1e3ded03dca53bbea3432dcd45101460fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 20:45:18 2011 +0100

    sna/gradient: Check solid busy status not current domain
    
    We can write into the bo if it has no outstanding requests, whereas we
    were checking to see it was last on the gpu instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1638a0a6c0b335dd31def93a9199f7407ae51170
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 16:00:30 2011 +0100

    sna/dri: Add a comment to warn about a potential race between DRI clients
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b54c89fbddc7aa72e5f2c5eded44e84bce70b77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 15:53:11 2011 +0100

    sna: Place the pixmap on the DRI dirty list after damaging the shadow copy
    
    In order that we remember to flush the contents back to the GPU
    before we wake up the DRI clients, we need to add those dirty
    pixmaps to the flushing list. I caught the obvious place, the
    central move-to-cpu, but I missed a couple of paths were we
    optimise the copy onto the shadow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 190a6786563aadd69f63bb7b509f3edf712e81ef
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 15:13:17 2011 +0100

    sna: Periodically reduce the gpu damage (after migrating any cpu damage)
    
    This will prevent the gpu damage list from growing unbounded.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38d084ee6241527193ba08c6600b6734e1833118
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 14:53:34 2011 +0100

    sna: Move !kgem->wedged check down into kgem_can_create_2d
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d1a3bb1467429310f5d17bf6afbf2eeb043ae64d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 14:51:49 2011 +0100

    sna: Prefer inactive buffers when creating a bo for a dirty pixmap
    
    As we will immediately attempt to replace it with an inactive when
    moving the data to the GPU, short-circuit that replacement.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ee53cc7449de7df294f49d089ff1d6b2e944323
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 13:05:19 2011 +0100

    sna: Debugging compile fix
    
    Still not enough coffee this morning.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f59d7d19053fed4e9d6402a5f03bc8a62cb56af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 12:59:59 2011 +0100

    sna: Use --enable-debug=full to enable extremely verbose debugging
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 021209d5d3add8b28143611cfad4c5481a2945a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 10:27:12 2011 +0100

    sna: Remove the stubs from sna_render.c
    
    These only existed to work around an include order problem, when kgem
    was intended to be entirely separable from sna. Moving the function
    pointer into kgem simplifies matters.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6141b1aea159759e7e9dcf2561deb9d8c02bd0a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 10:06:08 2011 +0100

    sna: Warn after detecting a hung GPU
    
    ...and include the instructional error message from uxa.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1786d2ee03a190ebe242ac7b58bed7cc31d66b16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 09:48:57 2011 +0100

    sna/accel: Add debug messages for falling back due to a wedged GPU
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d509d501b09f565fea232947e6f53d54a08749f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 01:03:16 2011 +0100

    sna: Tweak retiring old bo
    
    As we check for retirement everytime we wakeup, it is seldom useful to
    check again until we know we have invoked an operation that may block.
    But when we do check, we do not want to scan the entire active list
    looking for flushing candidates, so track those on a separate list.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17be5e2eb41b2ada94954b87c855961003c2fc7c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 9 00:38:29 2011 +0100

    sna: Reduce the frequency of the timer interrupts
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d0b09f10242e09adfddbbe6ee1ea39dbf5d1b32d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 8 20:34:57 2011 +0100

    sna: Make the device fd non-blocking
    
    So that we can simply query it from each of the Zaphod instances without
    blocking. Requires a fixed kernel...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67ed14c5369cfd967f90e5a3e6053c95a48dd16e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 8 19:42:02 2011 +0100

    sna/dri: Set bo=NULL to actually detect unknown dri attachment points.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 68755bc5ff830dc5ed6a34b18a1217b7d1003ce4
Author: Chad Versace <chad@chad-versace.us>
Date:   Wed Jun 8 18:34:02 2011 +0100

    sna/dri: Add support for DRI2BufferStencil and DRI2BufferHiz
    
    Based on Chad's commits 2662db5b and 3daba7e6:
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0030c3aab6172cdb83ca8f1b7b07c7db5915990d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 8 18:31:12 2011 +0100

    sna/dri: Drop support for old dri2 versions with incompatible ABI
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 715d466ad44e82b740f5454c41db944863420596
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 8 13:32:59 2011 +0100

    sna/dri: valgrindify
    
    Lots of scary warnings found by valgrind.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a62db5b050dee10246c02c72385358acb5e72b56
Author: Chad Versace <chad@chad-versace.us>
Date:   Mon May 23 14:23:54 2011 -0700

    dri: Add support for DRI2BufferStencil and DRI2BufferHiz
    
    And bump configure.ac to require dri2proto >= 2.6, because
    DRI2BufferStencil and DRI2BufferHiz were introduced in that version.
    
    When a client requests DRI2BufferHiz or DRI2BufferStencil,
    I830DRI2CreateBuffer() now returns a Y-tiled buffer. The stencil buffer is
    handled as a special case due its quirky pitch requirements.
    
    CC: Eric Anholt <eric@anholt.net>
    CC: Ian Romanick <idr@freedesktop.org>
    CC: Kristian Høgsberg <krh@bitplanet.net
    Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>
    Signed-off-by: Chad Versace <chad@chad-versace.us>

commit 263daba7e6afb37bd471fdc8dd8e4458da0a45ff
Author: Chad Versace <chad@chad-versace.us>
Date:   Sun Jun 5 19:48:19 2011 -0700

    dri: Do not create DRI2 buffers for unrecognized DRI2 buffer tokens
    
    Before this commit, if a client were to request an unrecognized DRI2
    buffer, such as DRI2BufferStencil, then I830DRI2CreateBuffer() allocated
    and returned an X-tiled buffer by accident. The problem was that
    unrecognized tokens were caught by the default case of a switch statement.
    
    Now, when given unrecognized DRI2 tokens, I830DRI2CreateBuffers() returns
    null.
    
    This shouldn't break older Mesa versions, because they never query (via
    DRI2GetBuffersWithFormat) for the drawable's DRI2BufferStencil.
    
    CC: Eric Anholt <eric@anholt.net>
    CC: Ian Romanick <idr@freedesktop.org>
    CC: Kenneth Graunke <kenneth@whitecape.org>
    CC: Kristian Høgsberg <krh@bitplanet.net
    Signed-off-by: Chad Versace <chad@chad-versace.us>

commit 038f29c259c1463c0bff12f5f8f0b228c02e45b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 7 19:16:01 2011 +0100

    sna/blt: Flush batch before overwrite surface data
    
    A left-over from before the surface was embedded into the tail of the
    batch, we were only checking for room against the total size of the
    batch buffer. So under the wrong set of circumstances we ended up
    overwriting surface data with batch and triggering a GPU hang on gen4+.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 265d94e0aa46b30a3198893544dd3619cc9145de
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 7 14:23:51 2011 +0100

    sna: Add zaphod support
    
    Zaphod support is a rudimentary method for creating an Xserver with
    multiple screens from a single device. The Device is instantiated, with
    a duplication of its resources, as many as required up to a maximum of
    the number of its outputs, and each instance is attached to a Screen
    and added to the ServerLayout. A Device can be bound to a selection of
    outputs using a comma separated list of RandR names.
    
    Note: in general, this is not the preferred solution! And will be
    superseded by per-crtc-pixmaps in RandR-1.4.
    
    For example, the following xorg.conf fragment creates an XServer with
    two screens, one attached to the LVDS panel on the laptop, and the other
    to any external output:
    
    Section "Device"
    	Identifier "Intel0"
    	Driver     "intel"
    	BusID	   "PCI:0:2:0"
    	Option     "ZaphodHeads" "LVDS1"
    	Screen     0
    EndSection
    
    Section "Device"
    	Identifier "Intel1"
    	Driver     "intel"
    	BusID	   "PCI:0:2:0"
    	Option     "ZaphodHeads" "DVI1,VGA1"
    	Screen     1
    EndSection
    
    Section "Screen"
    	Identifier "Screen0"
    	Device     "Intel0"
    EndSection
    
    Section "Screen"
    	Identifier "Screen1"
    	Device     "Intel1"
    EndSection
    
    Section "ServerLayout"
    	Identifier "default"
    	Screen     "Screen0"
    	Screen     "Screen1"
    EndSection
    
    Based on a patch by Ben Skegs <bskeggs@redhat.com>
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad5ead8257b7dda84a886461873d87831d43e663
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 7 11:06:52 2011 +0100

    sna/gen2: Support covered xrgb sources on 830/845
    
    830/845 cannot directly sample from an x8r8g8b8 source, but if we know
    that we are only sampling from within the confines of the source then we
    force the alpha channel to one. (Outside of the source we require the
    sampler to return a==0.)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 790f90a277ff2a6fbb615b8cd3c06faa0d549c41
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 7 08:18:30 2011 +0100

    sna/gen6: Initialise a couple more composite op members for copy_boxes
    
    Valgrind detected that I missed initialised a couple of fields for
    use with the generic state emission paths:
    
    ==28683== Conditional jump or move depends on uninitialised value(s)
    ==28683==    at 0x83BE646: gen6_get_blend (gen6_render.c:251)
    ==28683==    by 0x83BF769: gen6_emit_state (gen6_render.c:818)
    ==28683==    by 0x83C38ED: gen6_emit_copy_state (gen6_render.c:2280)
    ==28683==    by 0x83C3C89: gen6_render_copy_boxes (gen6_render.c:2356)
    ==28683== Conditional jump or move depends on uninitialised value(s)
    ==28683==    at 0x83C15C3: gen6_rectangle_begin (gen6_render.c:1458)
    ==28683==    by 0x83C177D: gen6_get_rectangles (gen6_render.c:1502)
    ==28683==    by 0x83C3D16: gen6_render_copy_boxes (gen6_render.c:2363)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4e443cbef589e016d085e8023677f47c1f01a858
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 7 00:24:17 2011 +0100

    sna: Add some more debug commentary to render picture source migration
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 367298c5109b47fa4961a60fa3cb454c800f02c3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 23:21:09 2011 +0100

    sna: Subtract the Solid RenderFillRectangles from CPU damage
    
    ... and so avoid having to move it the GPU, as seen in the wild. It
    looks like I will actually need to handle mixed Render/Core operations
    on the frontbuffer.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 62e4266b4dc9b5c3d165aca980738fa777a0f259
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 16:20:38 2011 +0100

    sna/gen5: Only emit the non-pipelined op after BLT commands
    
    We were always terminating the batch with the non-pipelined op, and not
    just at the end of a BLT sequence.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f97157d2e807d6c9acb521ec59757f419e6518b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 10:21:17 2011 +0100

    sna/gen2: Replicate alpha for non-CA masks
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8a2fa3a2e3f22e12f363e8ea060c70585156190
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:43:34 2011 +0100

    sna/gen2: Correct command length for CA LOAD_IMMEDIATE_STATE_1
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a89fc7181b6ccec8ccca2cd4ccab4f180f663656
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:39:17 2011 +0100

    sna/gen2: Only emit the mask texcoord if there is a mask
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fb7784e1e1b2b999c0c2420583e9c48eb1127ac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:27:17 2011 +0100

    sna/gen3: Non-affine texcoords require space for 4 floats not 3.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9344ab8d04fe4795a3a532c5c0e85dc11ecf968
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:25:53 2011 +0100

    sna/gen2: Set op->floats_per_vertex
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 741c1101f17bfa379a15178e4760211737fa18cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:22:45 2011 +0100

    sna/gen2: Enable selection of gen2 only
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c76ec69660bf40de052159f60c16de8fd87341a8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 6 08:02:09 2011 +0100

    sna/gen2: The inline primitive takes a length, not a vertex count
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91424d49373d8117e71441fa3221bd1801171692
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 31 23:29:43 2011 -0700

    uxa: Simplify uxa_poly_fill_rect by only clipping once.
    
    Reviewed-by: Keith Packard <keithp@keithp.com>

commit e0066e77e026b0dd0daa0c3765473c7d63aa6753
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 31 23:17:16 2011 -0700

    uxa: Simplify Composite solid acceleration for spans by only clipping once.
    
    Unlike the previous commit removing this style of code, the code in
    this one was originally wrong, and would fail to clip in the second
    pass of clipping when y was > pbox->y2.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=37233
    Reviewed-by: Keith Packard <keithp@keithp.com>

commit ace324e4aa27effdd621156eec03f3f87b610732
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 31 23:13:18 2011 -0700

    uxa: Simplify BLT solid acceleration for spans filling by only clipping once.
    
    We were clipping each span against the bounds of the clip, throwing
    out the span early if it was all clipped, and then walked the clip box
    clipping against each of the cliprects.  We would expect spans to
    typically be clipped against one box, and not thrown out, so we were
    not saving any work there.  For multiple cliprects, we were adding
    work.  Only for many spans clipped entirely out of a complicated clip
    region would it have saved work, and it clearly didn't save bugs as
    evidenced by the many fix attempts here.
    
    Reviewed-by: Keith Packard <keithp@keithp.com>

commit bdb396a44bf64f823a44aafee19b5ec692f1bf5f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 5 19:41:25 2011 +0100

    sna: PutImage: Copy straight to GTT if the bo is idle
    
    This saves a copy in the typical PutImage to frontbuffer favoured by
    flash. And we also happen to fix a bug if we should be requested to
    PutImage outside of the clip region...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 407257570fea1c6456fda47c9fab36c39f169c2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 5 15:33:27 2011 +0100

    sna/gen6: Flush the pipeline before effecting a change of blend modes
    
    ... also make sure that we flush if we change the blend mode for the CA pass.
    
    Reported-by: Ivan Bulatovic <combuster@archlinux.us>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=37946
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73167711226f430cc9ef4c27f267655d0edf4622
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 5 14:56:32 2011 +0100

    sna: 915gm does not have 128-byte Y-tiling
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0260c4ce32fa4d7ae8c6ee79d5488b0114e96251
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 5 14:39:34 2011 +0100

    sna: Fallback if presented with mask under NO_COMPOSITE
    
    Just making sure that the debug paths actually work...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fcbe2d9ee79c936cad3ee86836286dcb280f0047
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 4 18:11:54 2011 +0100

    sna/gen4: Flush every vertex for the magic CA pass
    
    gen4 dies hard if it has two rectangles in the pipeline, and despite the
    stringent and crippling efforts to prevent us from efficiently using the
    GPU, I missed a flush before submitting the CA rectangle.
    
    Reported-and-tested-by: Fryderyk Dziarmagowski <fdziarmagowski@gmail.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=28768
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bcef98af561939aa48d9236b2dfa2c5626adf4cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 8 07:17:14 2011 +0100

    sna: Introduce a new acceleration model.
    
    The premise is that switching between rings (i.e. the BLT and
    RENDER rings) on SandyBridge imposes a large latency overhead whilst
    rendering. The cause is that in order to switch rings, we need to split
    the batch earlier than is desired and to add serialisation between the
    rings. Both of which incur large overhead.
    
    By switching to using a pure 3D blit engine (ok, not so pure as the BLT
    engine still has uses for the core drawing model which can not be easily
    represented without a combinatorial explosion of shaders) we can take
    advantage of additional efficiencies, such as relative relocations, that
    have been incorporated into recent hardware advances. However, even
    older hardware performs better from avoiding the implicit context
    switches and from the batching efficiency of the 3D pipeline...
    
    But this is X, and PolyGlyphBlt still exists and remains in use. So for
    the operations that are not worth accelerating in hardware, we introduce a
    shadow buffer mechanism through out and reintroduce pixmap migration.
    Doing this efficiently is the cornerstone of ensuring that we do exploit
    the increased potential of recent hardware for running old applications and
    environments (i.e. so that the latest and greatest chip is actually faster
    than gen2!)
    
    For the curious, sna is SandyBridge's New Acceleration. If you are
    running older chipsets and welcome the performance increase offered by
    this patch, then you may choose to call it Snazzy instead.
    
    Speedups
    ========
     gen3           firefox-fishtank  1203584.56 (1203842.75 0.01%) -> 85561.71 (125146.44 14.87%): 14.07x speedup
     gen5             grads-heat-map  3385.42 (3489.73 1.44%) -> 350.29 (350.75 0.18%):  9.66x speedup
     gen3          xfce4-terminal-a1  4179.02 (4180.09 0.06%) -> 503.90 (531.88 4.48%):  8.29x speedup
     gen4             grads-heat-map  2458.66 (2826.34 4.64%) -> 348.82 (349.20 0.29%):  7.05x speedup
     gen3             grads-heat-map  1443.33 (1445.32 0.09%) -> 298.55 (298.76 0.05%):  4.83x speedup
     gen3             swfdec-youtube  3836.14 (3894.14 0.95%) -> 889.84 (979.56 5.99%):  4.31x speedup
     gen6             grads-heat-map  742.11 (744.44 0.15%) -> 172.51 (172.93 0.20%):  4.30x speedup
     gen3          firefox-talos-svg  71740.44 (72370.13 0.59%) -> 21959.29 (21995.09 0.68%):  3.27x speedup
     gen5                       gvim  8045.51 (8071.47 0.17%) -> 2589.38 (3246.78 10.74%):  3.11x speedup
     gen6                    poppler  3800.78 (3817.92 0.24%) -> 1227.36 (1230.12 0.30%):  3.10x speedup
     gen6         gnome-terminal-vim  9106.84 (9111.56 0.03%) -> 3459.49 (3478.52 0.25%):  2.63x speedup
     gen5              midori-zoomed  9564.53 (9586.58 0.17%) -> 3677.73 (3837.02 2.02%):  2.60x speedup
     gen5         gnome-terminal-vim  38167.25 (38215.82 0.08%) -> 14901.09 (14902.28 0.01%):  2.56x speedup
     gen5                    poppler  13575.66 (13605.04 0.16%) -> 5554.27 (5555.84 0.01%):  2.44x speedup
     gen5         swfdec-giant-steps  8941.61 (8988.72 0.52%) -> 3851.98 (3871.01 0.93%):  2.32x speedup
     gen5          xfce4-terminal-a1  18956.60 (18986.90 0.07%) -> 8362.75 (8365.70 0.01%):  2.27x speedup
     gen5           firefox-fishtank  88750.31 (88858.23 0.14%) -> 39164.57 (39835.54 0.80%):  2.27x speedup
     gen3              midori-zoomed  2392.13 (2397.82 0.14%) -> 1109.96 (1303.10 30.35%):  2.16x speedup
     gen6                       gvim  2510.34 (2513.34 0.20%) -> 1200.76 (1204.30 0.22%):  2.09x speedup
     gen5       firefox-planet-gnome  40478.16 (40565.68 0.09%) -> 19606.22 (19648.79 0.16%):  2.06x speedup
     gen5       gnome-system-monitor  10344.47 (10385.62 0.29%) -> 5136.69 (5256.85 1.15%):  2.01x speedup
     gen3                    poppler  2595.23 (2603.10 0.17%) -> 1297.56 (1302.42 0.61%):  2.00x speedup
     gen6          firefox-talos-gfx  7184.03 (7194.97 0.13%) -> 3806.31 (3811.66 0.06%):  1.89x speedup
     gen5                  evolution  8739.25 (8766.12 0.27%) -> 4817.54 (5050.96 1.54%):  1.81x speedup
     gen3                  evolution  1684.06 (1696.88 0.35%) -> 1004.99 (1008.55 0.85%):  1.68x speedup
     gen3         gnome-terminal-vim  4285.13 (4287.68 0.04%) -> 2715.97 (3202.17 13.52%):  1.58x speedup
     gen5             swfdec-youtube  5843.94 (5951.07 0.91%) -> 3810.86 (3826.04 1.32%):  1.53x speedup
     gen4                    poppler  7496.72 (7558.83 0.58%) -> 5125.08 (5247.65 1.44%):  1.46x speedup
     gen4         gnome-terminal-vim  21126.24 (21292.08 0.85%) -> 14590.25 (15066.33 1.80%):  1.45x speedup
     gen5          firefox-talos-svg  99873.69 (100300.95 0.37%) -> 70745.66 (70818.86 0.05%):  1.41x speedup
     gen4       firefox-planet-gnome  28205.10 (28304.45 0.27%) -> 19996.11 (20081.44 0.56%):  1.41x speedup
     gen5          firefox-talos-gfx  93070.85 (93194.72 0.10%) -> 67687.93 (70374.37 1.30%):  1.37x speedup
     gen4                  evolution  6696.25 (6854.14 0.85%) -> 4958.62 (5027.73 0.85%):  1.35x speedup
     gen3         swfdec-giant-steps  2538.03 (2539.30 0.04%) -> 1895.71 (2050.62 62.43%):  1.34x speedup
     gen4                       gvim  4356.18 (4422.78 0.70%) -> 3276.31 (3281.69 0.13%):  1.33x speedup
     gen6                  evolution  1242.13 (1245.44 0.72%) -> 953.76 (954.54 0.07%):  1.30x speedup
     gen6       firefox-planet-gnome  4554.23 (4560.69 0.08%) -> 3758.76 (3768.97 0.28%):  1.21x speedup
     gen3          firefox-talos-gfx  6264.13 (6284.65 0.30%) -> 5261.56 (5370.87 1.28%):  1.19x speedup
     gen4              midori-zoomed  4771.13 (4809.90 0.73%) -> 4037.03 (4118.93 0.85%):  1.18x speedup
     gen6         swfdec-giant-steps  1557.06 (1560.13 0.12%) -> 1336.34 (1341.29 0.32%):  1.17x speedup
     gen4          firefox-talos-gfx  80767.28 (80986.31 0.17%) -> 69629.08 (69721.71 0.06%):  1.16x speedup
     gen6              midori-zoomed  1463.70 (1463.76 0.08%) -> 1331.45 (1336.56 0.22%):  1.10x speedup
    Slowdowns
    =========
     gen6          xfce4-terminal-a1  2030.25 (2036.23 0.25%) -> 2144.60 (2240.31 4.29%):  1.06x slowdown
     gen4             swfdec-youtube  3580.00 (3597.23 3.92%) -> 3826.90 (3862.24 0.91%):  1.07x slowdown
     gen4          firefox-talos-svg  66112.25 (66256.51 0.11%) -> 71433.40 (71584.31 0.14%):  1.08x slowdown
     gen4       gnome-system-monitor  5691.60 (5724.03 0.56%) -> 6707.56 (6747.83 0.33%):  1.18x slowdown
     gen3                  ocitysmap  3494.05 (3502.44 0.20%) -> 4321.99 (4524.42 2.78%):  1.24x slowdown
     gen4                  ocitysmap  3628.42 (3641.66 9.37%) -> 5177.16 (5828.74 8.38%):  1.43x slowdown
     gen5                  ocitysmap  4027.77 (4068.11 0.80%) -> 5748.26 (6282.25 7.38%):  1.43x slowdown
     gen6                  ocitysmap  1401.61 (1402.24 0.40%) -> 2365.74 (2379.14 4.12%):  1.69x slowdown
    
    [Note the performance regression for ocitysmap comes from that we now
    attempt to support rendering to and (more importantly) from large
    surfaces. By enabling such operations is the only way to one day be
    faster than purely using the CPU, in the meantime we suffer regression
    due to the increased migration and aperture thrashing. The other couple
    of regressions will be eliminated with improved span and shader support,
    now that the framework for such is in place.]
    
    The performance increase for Cairo completely overlooks the other
    critical aspects of the architecture:
    
    World of Padman:
    gen3 (800x600):   57.5 ->  96.2
    gen4 (800x600):   47.8 ->  74.6
    gen6 (1366x768): 100.4 -> 140.3 [F15]
                     144.3 -> 146.4 [drm-intel-next]
    
    x11perf (gen6);
    aa10text:     3.47 -> 14.3 Mglyphs/s [unthrottled!]
    copywinwin10: 1.66 -> 1.99 Mops/s
    copywinpix10: 2.28 -> 2.98 Mops/s
    
    And we do not have a good measure for how much improvement the reworking
    of the fallback paths give, except that xterm is now over 4x faster...
    
    PS: This depends upon the Xorg patchset "Remove the cacheing of the last
    scratch PixmapRec" for correct invalidations of scratch Pixmaps (used by
    the dix to implement SHM operations, used by chromium and gtk+ pixbufs.
    
    PPS: ./configure --enable-sna
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 340cfb7f5271fd1df4c8948e5c9336f5b69a6e6c
Author: Diego Elio Pettenò <flameeyes@gmail.com>
Date:   Sun May 15 02:17:32 2011 +0200

    build: do not use AC_CHECK_FILE to find the header files.
    
    Using AC_CHECK_FILE will cause cross-builds to fail picking the right file;
    instead use compile/preprocessor checks properly, and check for
    xf86driproto earlier.
    
    Reviewed-by: Rémi Cardona <remi@gentoo.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d6e02a135efdea1d169d1938359ab2b553e941c
Author: Adam Jackson <ajax@redhat.com>
Date:   Tue May 10 15:27:45 2011 -0400

    Remove the memory of Option "AccelMethod"
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 895a46e8ff70195c1a4bdccbeb652e330376f64a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 10 20:38:25 2011 +0100

    dri: Flush the batch after a DRI swap/copy event
    
    To minimise lag in those every so critical games, we want to ensure that
    the copy happens as soon as it is received, so we need to flush the
    batch after processing a swap event and before we go to sleep.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=37068
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0b4ca9313cc7eb4845cf7f4e87c869c0c6d6ff0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 10 20:36:10 2011 +0100

    video: Flush the batch on the next blockhandler after queuing
    
    In order to avoid video lag and jerky playback we need to ensure that
    any queued video is flushed before we go to sleep.
    
    Fixes regression from 6f104189bb.
    
    Reported-and-tested-by: Edward Sheldrake <ejsheldrake@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=37068
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bb8bf2a28bcb5e838bf4bb7e80ce220d28540719
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 10 14:35:02 2011 +0100

    Correct chipset detection for Q33, Q35, B43_G1
    
    Everytime we update these tables we trip over this bit of marketing
    genius.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fd1ebd44fb72e7bdf57d00f8941cd6110a529cac
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 10 07:30:58 2011 +0100

    module: Adopt IVB's more detailed naming convention for SNB
    
    This should fix the seven-fold repetition of "SandyBridge" in the list
    of supported chipsets during start-up... And be more useful in bug
    reports!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9811bb777dfc51af19836175645400489f7d991
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 10 07:28:23 2011 +0100

    Whitespacing cleanup for intel_module.c
    
    Bring intel_module.c into line with the kernel whitespacing rules abided
    by everywhere else in the tree.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79e59fb2a047b1e733a7b0dee608db3311391725
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 6 12:40:12 2011 -0700

    Add support for Ivybridge chipset.
    
    This gets display and 2D blit acceleration up and running.  No Render
    acceleration is provided yet.

commit 792738adfc5164d30358f045875dfc9b199a46da
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 6 13:14:25 2011 -0700

    Remove the static list of PciChipset and construct it from SymTabRec instead.
    
    This is one less place the new hardware enabler has to spam the
    chipset in.  The PciChipset is just a match structure from PciId to
    the SymTabRec entry token, and our SymTabRec entry tokens are just the
    PciId, so it's trivial to construct.
    
    Acked-by: Kenneth Graunke <kenneth@whitecape.org>

commit 583e80dfa12d6c73fc677c81cb605a07b2768979
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 6 13:00:53 2011 -0700

    Use the existing deviceID -> name mapping in SymTabRec instead of duping it.
    
    We need to have this array anyway for the xf86 interfaces, apparently,
    so just store the name in one location.  This drops the i852/i855
    subdevice distinction in the name printed, but I haven't seen us ever
    care about that.
    
    Acked-by: Kenneth Graunke <kenneth@whitecape.org>

commit adf7bbd3a8758de6cdecbace42e399dd27188497
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 6 12:56:53 2011 -0700

    Store the chipset info struct in the PCI match struct, instead of a switch().
    
    Acked-by: Kenneth Graunke <kenneth@whitecape.org>

commit 3145530feed879082bcfab11ffc8e7fd0911c920
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 7 19:51:04 2011 +0100

    Ensure that the partial batch is flushed upon the blockhandler
    
    Currently, we require that a batch containing a dirty bo be submitted
    before we mark the device as requiring a flush. So if we never submit a
    batch between block handlers, we can end up sleeping without ever
    flushing either the partial batch or the rendering to the scanout.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=36776
    Tested-by: Vasily Khoruzhick <anarsoul@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67e5a74e997f199327f9115c7ba867df3c49da8d
Author: Paul Menzel <paulepanter@users.sourceforge.net>
Date:   Fri Apr 22 15:09:12 2011 +0200

    NEWS: fix typo (s/2.14/2.15/) to match corresponding release
    
    Signed-off-by: Paul Menzel <paulepanter@users.sourceforge.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0944e2d5749f5122cd9802c4a2421106fa829ea4
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Apr 20 11:39:55 2011 -0700

    Add basic 30 bit depth support
    
    Still need to handle video and gamma correction, but this gets the
    display up and running at 30 bit depth if the kernel and display support
    it.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 1d102cc6ed21d1c4afa47800eecd24b9d663f689
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 12 13:48:38 2011 +0100

    Use SwapbuffersWait config option to control waiting on fullscreen swaps
    
    As fullscreen swaps were going via a different path to the swapping of
    ordinary windows, we were no longer honouring the xorg.conf option to
    disable swapbuffer waiting.
    
    This changes the code to only use pageflipping if the Option
    "SwapbuffersWait" is set to "TRUE" (default).
    
    Jesse's comment was that this should be superseded by actually
    supporting asynchronous page flips. As we are missing kernel and dix level
    support for that, in the meantime honour the config option.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Jesse Barnes <jbarnes@virtuousgeek.org>
    Cc: Kristian Høgsberg <krh@bitplanet.net>

commit c9fb69cb2502917dfb2828c90802de7766072899
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 17 10:42:05 2011 +0100

    i965/video: We need 150 dwords of space for video state emission
    
    (Actually around 131, with additional 10% just for safety.)
    
    Reported-by: Modestas Vainius <geromanas@mailas.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=36319
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a51cd83d25f2f9f2107219d5671194f931601244
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Apr 17 10:36:26 2011 +0100

    intel: Beware the unsigned promotion when checking for batch overflows
    
    Reported-by: Modestas Vainius <geromanas@mailas.com>
    References: https://bugs.freedesktop.org/show_bug.cgi?id=36319
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 030aa3d13643a0acb7126fa1fa6c5a8eac134639
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 14 10:25:21 2011 +0100

    NEWS: typo.
    
    Spotted too late...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e425b30e12b11dbf51eea1d3366e3372f8b93af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 14 10:16:03 2011 +0100

    configure,NEWS: 2.15.0 release
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 686018f283f1d131073ef5917213e6a8ac013f26
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 12 08:23:04 2011 +0100

    Turn relaxed-fencing off by default for older (pre-G33) chipsets
    
    There are still too many unresolved bugs, typically GPU hangs, that are
    related to using relaxed fencing (i.e. only allocating the minimal
    amount of memory required for a buffer) on older hardware, so turn off
    the feature by default for the release.
    
    Reported-and-tested-by: Knut Petersen <Knut_Petersen@t-online.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=36147
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Acked-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 3d2b79098ccb3fed86be66f619f4ed338741d454
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 11 15:20:16 2011 +0100

    dri: Rearrange code to compile against xorg-server-1.7
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4fa35dd5e13a58070220f787fc0678f1c679808d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 11 10:44:55 2011 +0100

    NEWS: version bump for 2.14.903 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97e9557619e58ef769eb7cbf1a03fbd52be7f2ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 8 13:38:48 2011 +0100

    intel: Restore manual flush for old kernels
    
    Daniel Vetter pointed out that the automagic flush by the kernel for the
    busy-ioctl was only introduced upstream in 2.6.37. So we still need to
    manually emit a flush on old kernels.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fb40bf2b33a6d26f0e6a4e5798d10c905faa8aad
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Fri Apr 8 12:37:35 2011 +0200

    Tell users to grab i915_error_state on gpu hangs
    
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 59ed6b05db99d7e5144f4f8499c67cee9b833673
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 7 15:28:46 2011 +0100

    Revert "i965: Convert to relative relocations for state"
    
    This reverts commit d2106384be6f9df498392127c3ff64d0a2b17457.
    
    Breaks compiz (but not mutter/gnome-shell) on gen6. Not sure if this is
    not seem deep interaction issue with multiple clients sharing the GPU or
    just with compiz, but for now we have to revert and suffer the inane
    performance hit. It looks suspiciously like another deferred damage
    issue...
    
    Bugzilla: 51a27e88b073cff229fff4362cb6ac22835c4044
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 25521900df11bc71020ee80db2223f979bec5ec6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 7 15:09:30 2011 +0100

    gen6: Invalidate texture cache
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad22003033eb502474ae538a97e3b42cf8f83880
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 7 10:29:40 2011 +0100

    i965: Avoid transform overheads for vertex emit where possible
    
    Minor improvement as the bottlenecks lie elsewhere. But it was annoying me.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 007c2f86cbb386861a1f711786523657f92e12cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Apr 7 09:53:34 2011 +0100

    i965: Refactor to use constant sampler_state offsets
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8dc99b305a514dcd42c4260698e685a66dc95518
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 22:30:29 2011 +0100

    i965: Reset vertex_id after every batch
    
    So that we always remember to re-emit the initial vertex elements state.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5982ed4da12a964351029c6f786348a11e33dc81
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 19:32:43 2011 +0100

    i965: Always update last_floats_per_vertex
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f104189bb9439ab0e05f04d4be020813eb04bf9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 19:21:10 2011 +0100

    Take advantage of the kernel flush for dirty bo in the busy ioctl
    
    Rather than just creating and submitting a batch that simply contains a
    flush in order to periodically ensure that rendering reaches the
    scanout, we can simply ask the kernel whether the scanout is busy. The
    kernel will then submit a flush on our behalf if it is dirty, which
    takes advantage of the kernel's dirty state tracking.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 314439860e595c473d168c0cafb2b5b49b7fef30
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 17:20:04 2011 +0100

    Remove unused function 'intel_bo_alloc_for_data'
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ced747cefb5e697e6caa65296dff728904f52b93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 17:13:50 2011 +0100

    Remove the unnecessary MI_FLUSH from the flush handler
    
    The kernel will emit any required flushes between the dri client and the
    ddx, and we do not rely on the MI_FLUSH here for scanout.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 79444291a39c42039192a5baa3a71d52300cf4ee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 16:34:58 2011 +0100

    i965: segregate each vertex element into its own buffer
    
    Reduce the number of relocations emitted by only emitting one relocation
    per vertex element per vertex buffer.
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=35733
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2106384be6f9df498392127c3ff64d0a2b17457
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 4 12:33:04 2011 +0100

    i965: Convert to relative relocations for state
    
    References: https://bugs.freedesktop.org/show_bug.cgi?id=35733
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 972569f6fd1e14519f46e9f50d2509faf1d0aa55
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 25 10:46:14 2011 +0000

    MI_LOAD_SCAN_LINES_INCL are inclusive and range [0, display height-1]
    
    We have seen GPU hangs with:
    
    batchbuffer at 0x0f9b4000:
    0x0f9b4000:      0x09000000: MI_LOAD_SCAN_LINES_INCL
    0x0f9b4004:      0x00000300:    dword 1
    0x0f9b4008:      0x09000000: MI_LOAD_SCAN_LINES_INCL
    0x0f9b400c:      0x00000300:    dword 1
    0x0f9b4010:      0x01820000: MI_WAIT_FOR_EVENT
    0x0f9b4014: HEAD 0x02000006: MI_FLUSH
    
    on a 1366x768 display. That according to the specs an invalid command
    for the pipe.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=35576
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 537a836dd6db384d53b52eb457a7d257c440217f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Apr 1 07:10:25 2011 +0100

    946GZ is a 965G!
    
    Sales & Marketing score another victory in confusing me.
    
    Bugzila: https://bugs.freedesktop.org/show_bug.cgi?id=35854
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 630d77bf10ba6234bb9c04538636f7d8aa319aea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 30 07:24:42 2011 +0100

    Add a DRI2SwapEventPtr typedef for retro xservers
    
    Because people are still trying to build upon our solid historical
    foundations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f660df2cb44b310740ed850037ff37891b671f28
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 29 18:02:24 2011 +0200

    Cleanup gen2 tiling confusion
    
    A tile on gen2 has a size of 2kb, stride of 128 bytes and 16 rows.
    
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit a2c8442fcb29ef2d0df41518952a2d8df1671070
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 29 11:38:45 2011 +0100

    configure: version bump for 2.14.902 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f2680793952876c89796174bed53c824fe6d1cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 29 11:38:18 2011 +0100

    NEWS: Entry for 2.14.902 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ccbec801e9ee32fc110db730dfec674a94dea21
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Mar 24 11:06:57 2011 -0700

    Recover from i830_dri2_add_frame_event out-of-memory condition
    
    If adding either the frame or client resources fails, we need to clean
    up afterwards properly.
    
    First, add_frame_event needs to internally clean up after itself by
    undoing any partial execution. Second, the callers need to look at the
    return value and free the swap/flip info structure when necessary.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Julien Cristau <jcristau@debian.org>

commit ec133abc4bd8caba15ed54e18621b816afb06981
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 24 15:32:50 2011 +0000

    Use the per-generation batch context switch for atomic sequences
    
    A modest boost to throughput and reduction in CPU overhead from
    not flushing the batch on every transition from BLT to RENDER.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86f23f21ab57fcbc031bcd2b8f432a08ff4cc320
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Mar 23 17:07:49 2011 -0700

    Skip client and drawable resource delete calls when deleting frame event
    
    As the frame_event is about to be freed, there's no point in cleaning
    up references to the drawable and client.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit e1ff5182304e00c0d392092069422cae7626cf8d
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Mar 9 17:00:41 2011 -0800

    Handle drawable/client destruction in pending swaps/flips
    
    A pending swap or flip holds references to drawables and clients which
    become invalid when destroyed. Add suitable resources to the database
    to track those lifetimes and clean up the pending data structure then.
    
    Later, when the pending swap or flip occurs, handle a missing drawable
    by just discarding the flip or swap. Handle a missing client by not
    sending an event or reply.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit aa0328f342177e33f9c863531712eaa4577b5f2b
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Mar 9 16:23:22 2011 -0800

    dri2: Make DRI2FrameEvent public and use instead of void *
    
    Instead of using void * for all of the flip_info and swap_info
    pointers, just make the underlying structure a public data type and
    use that.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ee740778f5d5355c04f6fc4564f598993b106d62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 16 08:37:24 2011 +0000

    i915/video: Clip indirect Xv output
    
    In the case of a singular clip box and rendering onto the front buffer
    larger than 2048, the clip extents were being ignored.  Here we can
    simply reduce the size of the indirect pixmap to the clip extents.
    
    Reported-by: Michael Chang <mchang@novell.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=35346
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 014fc7abb7b2cc2110e3ab9a0bd6f7cff2c64c05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 9 17:10:50 2011 +0000

    dri: Disable page-flip between a tiled buffer and a linear scanout
    
    Keith Packard pointed out a loophole that could cause the DDX to end up
    with a tiled scanout even if the user required a linear framebuffer;
    that is by using page-flipping we could replace the scanout pixmap with
    another of our choosing, and not necessarily tiled.
    
    Close that loophole by only allowing an exchange of buffers between
    identical tiling modes. For the common case, this is fine since they
    will indeed be allocated with the same tiling. For the linear
    framebuffer case with mesa using a tiled pixmap, we force it to blit
    onto the scanout instead.
    
    Reported-by: Keith Packard <keith.packard@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 049ce4397ddf7fd088ce364cbb53cacf5133176f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 9 08:27:02 2011 +0000

    Give each user of tiling separate xorg.conf options
    
    So that you can indeed allocate a linear framebuffer if you so desire
    without breaking mesa.
    
    Adds:
    
    Section "Driver"
      Option "LinearFramebuffer" "False|True" # default false
    EndSection
    
    to xorg.conf
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0bb1a5f19e09dc553761ddd90bf6319eab94a597
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 9 08:26:44 2011 +0000

    Update priv->stride after bo reallocation
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 34f9a3335f96b16ef9df6213eb0a586c94f8f05b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 2 17:46:19 2011 +0000

    configure: Bump for 2.14.901 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 057783937d7a42a766d0e45174c4c2dc0ffacd40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 2 17:45:43 2011 +0000

    NEWS: Add entry for 2.14.901 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e889d3a709b55a0731ab098b17a3364b9bf39387
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Feb 27 10:51:50 2011 +0000

    dri: Protect against destroying a foreign DRI drawable
    
    I have no clue as to how such an alien drawable reached us, but we have
    the evidence of a segfault to say it can happen.
    
    Reported-by: Bernie Innocenti <bernie@codewiz.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=34787
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d21d781466785c317131a8a57606925867265dc8
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Feb 22 18:31:44 2011 +0100

    Fix relaxed tiling on gen2
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 9599fde65a0d8b7e7c85199346f7b620bdd8388d
Author: Bryce Harrington <bryce@canonical.com>
Date:   Tue Feb 15 22:30:18 2011 -0800

    Quell excessively verbose vblank counter failed error messages
    
    Certain error situations can result in the following printed to
    Xorg.0.log at a high enough rate to make log file size a problem.
    
    (WW) intel(0): I830DRI2GetMSC:1062 get vblank counter failed: Invalid argument
    (WW) intel(0): I830DRI2ScheduleWaitMSC:1118 get vblank counter failed: Invalid argument
    
    Following in the tradition of commit 0ad6d6e1, limit the warnings to be
    output 5 times, then quell the remainder.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=34322
    Ref.: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/710594
    
    Signed-off-by: Bryce Harrington <bryce@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ca595e9d533019b241666d29b421c7b36f9647a
Author: Adam Jackson <ajax@redhat.com>
Date:   Thu Feb 17 15:26:35 2011 -0500

    Fix IGD and IGDNG constants to be comprehensible
    
    Since, with GPU-on-package, it's hard to talk about a model number for
    a specific chipset like 855GM, just use the platform names.
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c66b28870b050493ad96f7b0fe2d70d7ee539c7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 17 16:48:24 2011 +0000

    uxa: Fallback if the temporary is too large
    
    If the render operation requires a temporary source Picture and the
    operation is large, larger than the maximum permitted bo, then we will
    fail to allocate the bo. In this case, we need to fallback and perform
    the operation on the CPU rather than dereference a NULL bo.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=34399
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23f9b14df7c102c1036134835dd5d1a508059858
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Feb 12 10:42:34 2011 +0000

    i965: Remove broken maximum base addresses from video
    
    WRONG.
    
    The hardware was never limited to 0x1000000 and the kernel can quite
    rightly place objects above that limit. Specifying such had no relation
    to reality, so why did we do it? TWICE!
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=34017
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9184af921bc2f332fcb6c9b47001414378eab8e2
Author: Javier Jardón <jjardon@gnome.org>
Date:   Wed Feb 9 00:36:37 2011 +0000

    Update autotools configuration
    
    Use new libtool syntax and silent-rules to silent
    the build output a bit (linux-like)

commit 6e721e098b9181e8e77e314f966729d28e705582
Author: Bryce Harrington <bryce@canonical.com>
Date:   Fri Feb 4 00:15:13 2011 -0800

    Check return value of uxa_acquire_solid() since it can return NULL
    
    uxa_acquire_solid returns NULL under OOM.  Thus the value of solid
    must be checked before dereferencing it in the uxa_get_offscreen()
    call.
    
    Signed-off-by: Bryce Harrington <bryce@canonical.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit da990536eca09c6de74627541cd56ecfad925eda
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Feb 3 09:41:48 2011 +0000

    uxa: Undo damage translation before appending
    
    The region is used to paint onto the backing pixmap (and thus
    translated) prior to being passed to the damage layer (wrt to the
    drawable). So the local translation needs to be undone first.
    
    Identified by Christopher James Halse Rogers.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=33650
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce1e0969058f8c70b624bc85bb8d6698a35794d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 31 20:27:26 2011 +0000

    Rename 'intel' backlight to match upstream name in 2.6.38
    
    (Just waiting for libbacklight to bring sanity...)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 80f59c8a4f51ccc27653a2de2dee2563b1e911f1
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Jan 31 06:22:39 2011 +0100

    xvmc: Stop using uninitialized variable.
    
    The actual code was removed in 5f64122551, where the get_surface_status
    driver callback was dropped. Just return Success if there were no issues
    with the parameter.
    
    Get rid of the following with CFLAGS="-Wall -Werror":
    |   CC     intel_xvmc.lo
    | cc1: warnings being treated as errors
    | intel_xvmc.c: In function ‘XvMCSyncSurface’:
    | intel_xvmc.c:677: error: ‘ret’ may be used uninitialized in this function
    | intel_xvmc.c:672: note: ‘ret’ was declared here
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86284abafbe1364f82509d2656c82ba11cdce6cc
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Jan 31 06:22:38 2011 +0100

    xvmc: Silence gcc, adding a cast to work around signedness issues.
    
    Both exported XvMCPutSlice/XvMCPutSlice2 functions have a prototype with a
    parameter whose signedness differs from the one in the put_slice/put_slice2
    functions they call. Make it unsigned through a cast.
    
    Get rid of this accordingly with CFLAGS="-Wall -Werror":
    |   CC     intel_xvmc.lo
    | cc1: warnings being treated as errors
    | intel_xvmc.c: In function ‘XvMCSyncSurface’:
    | intel_xvmc.c:677: error: ‘ret’ may be used uninitialized in this function
    | intel_xvmc.c:672: note: ‘ret’ was declared here
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit fc2eb64d7a184770ccd708a5b2337a538ca2b9db
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Jan 31 09:59:04 2011 +0000

    xvmc: Silence gcc, add parentheses around arithmetic.
    
    Get rid of those accordingly with CFLAGS="-Wall -Werror":
    |   CC     i915_xvmc.lo
    | cc1: warnings being treated as errors
    | i915_xvmc.c: In function ‘i915_mc_one_time_state_emit’:
    | i915_xvmc.c:369: error: suggest parentheses around arithmetic in operand of ‘|’
    | i915_xvmc.c:374: error: suggest parentheses around arithmetic in operand of ‘|’
    | i915_xvmc.c:379: error: suggest parentheses around arithmetic in operand of ‘|’
    | i915_xvmc.c: In function ‘i915_mc_load_indirect_render_emit’:
    | i915_xvmc.c:708: error: suggest parentheses around arithmetic in operand of ‘|’
    | i915_xvmc.c:713: error: suggest parentheses around arithmetic in operand of ‘|’
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1b9349bceb9172d9bf01638b2df10b9b79e883b4
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Jan 31 06:22:36 2011 +0100

    xvmc: Silence gcc, add parentheses around assignment.
    
    Get rid of the following with CFLAGS="-Wall -Werror":
    |   CC     intel_xvmc_dump.lo
    | cc1: warnings being treated as errors
    | intel_xvmc_dump.c: In function ‘intel_xvmc_dump_open’:
    | intel_xvmc_dump.c:41: error: suggest parentheses around assignment used as truth value
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae8877e30707cae586565b4deee4c7fd9ac7d3ed
Author: Cyril Brulebois <kibi@debian.org>
Date:   Mon Jan 31 06:22:35 2011 +0100

    xvmc: Get rid of unused variables.
    
    Signed-off-by: Cyril Brulebois <kibi@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8bd6a7149fcb5f9ed6580dc2aa0180874938a1ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jan 29 12:04:09 2011 +0000

    Enable conditional compilation of asserts
    
    With '--disable-debug' we define NDEBUG and so disable the asserts, that
    is we continue to default to compiling asserts into the code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a5a1ab7bbc58ec884cd0b90fe7139f402291b92f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 28 17:20:06 2011 +0000

    i915: Remove unused 'w' and 'h'
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c9b3225d8c7b53e2d921705dbb069710abcea5d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 28 17:19:39 2011 +0000

    i915: Remove unused 'num_floats' variable
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c6dc27562abbc8ca9e873ad502ca49ae010461d2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 24 20:25:27 2011 +0000

    uxa: Only recreate the glyph cache on *generational* updates
    
    The screen resources are recreated when the screen is rotated as well,
    without being finalized. In this case, we do not need to reconstuct the
    cache (or if we did, we would need to tear it down first).
    
    Reported-by: Till Matthiesen <entropy@everymail.net>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=33412
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5baa63c634990810a66c3150b4f2b76fcee2df38
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Jan 21 08:45:52 2011 +0800

    Fix an error in 4c4ad555564a80311df1a4b762eb1e119c6d95fb.
    
    See the original patch at https://bugs.freedesktop.org/show_bug.cgi?id=24767
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 3e28a0c0b43823d3104fe8fc50b5994b41fc0cc1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jan 20 15:07:26 2011 +0000

    Create the UXA generational resources during screen create
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4c4ad555564a80311df1a4b762eb1e119c6d95fb
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Jan 19 15:25:06 2011 +0000

    Correct offset of planes within clipped window
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=24767
    Reported-and-tested-by: Sitsofe Wheeler <sitsofe@yahoo.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a22bc999de8555f26c639eaffbe73b680746174
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 17 11:32:37 2011 -0800

    Quiet compiler warning about is_affine_src same way we do is_affine_mask.

commit 3a2a4b0784f0fc96a5457b18931471f15ad745fc
Author: Simon Farnsworth <simon.farnsworth@onelan.co.uk>
Date:   Mon Jan 17 17:38:23 2011 +0000

    Fix textured video when destination is larger than screen
    
    In our application, the screen is never rotated from the point of view
    of the driver; instead, the compositor applies a suitable rotation as
    it composites the display. This works fine on 945, but on 965, videos
    are limited in height to the actual height of the screen.
    
    Change various bits of code so that we use the width and height of the
    destination pixmap instead of the width and height of the virtual
    screen. This works correctly both for XVideo to offscreen storage
    (CompositeRedirect) and for XVideo to the screen (no compositor).

commit fd9235ebe03a01982238cdd6e8b55f613e14b6af
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:58:36 2010 +0000

    Delete unused memory allocation flags.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03248a798409ca4dd1caf5e25a3d5f5a80173260
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:57:01 2010 +0000

    Cache the fixed crtc<->pipe relationship
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00a2aee38dc5cbbd4907a593fa8d617f5a20292e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:50:33 2010 +0000

    Remove unused I830Output
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a851879695c48e88d421b053a78f867d9902273f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:48:26 2010 +0000

    Remove bitrotted, but fortunately unused, I830CrtcPrivate
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8a5d7737e014e99943b947d088a4f9f1b465d46
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:37:47 2010 +0000

    Delete some dead code
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 968151898b807b06953b2f4170ac02889f16c8dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:18:25 2010 +0000

    Remove unused GTT/Map sizes and addresses
    
    These have been made obsolete by KMS and GEM.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19b5817a54d4a17161340ada9bf20027644ff074
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 00:15:31 2010 +0000

    Remove unused struct _intel_memory definition
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 40a7bde9140c0ae6412b8f916b1455d44e2af6cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 7 23:46:07 2011 +0000

    configure: version bump for 2.14.0

commit 8ecbba2aca657da3894eb77e856ac2d4e9efc0cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jan 7 23:45:06 2011 +0000

    NEWS: Release notes for 2.14.0

commit 22d7b61791c382088a6c0df5dce3a15405d6c495
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 4 12:32:01 2011 +0000

    i965: Fix off-by-one in assert
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7c7a9108f76aa312f3d5efa466052b914c81484
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 4 10:53:30 2011 +0000

    configure: version bump for 2.13.903 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3fbecf34630c3588618900afdfbd9a4266856178
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jan 4 10:52:44 2011 +0000

    NEWS: Add entry for 2.13.903
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90538ecfff9c324d61419f451d41d26ab026f232
Author: U. Artie Eoff <ullysses.a.eoff@intel.com>
Date:   Tue Dec 21 17:42:38 2010 -0700

    configure: suggest upstream to find macros in case they're missing.
    
    added upstream suggestion to error message in case xorg macros or
    xserver macros are missing. removed package manager references in
    suggestion since these are 'user' and/or 'distribution' preferences.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d50f5a140dbefdf86eb25d18d08473aa7e42acc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 3 23:06:14 2011 +0000

    If the crtc is not enabled, then it can't be on
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 145c42a101c3150fb1e2cae8a1780b26e8b56f42
Author: Adam Jackson <ajax@redhat.com>
Date:   Mon Jan 3 17:52:27 2011 -0500

    dri2: Fix interlace computation
    
    scrn->currentMode is a hack for xf86vidmode and in general is wrong for
    RANDRful drivers.  Use the mode on the associated CRTC instead.
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>
    [ickle: crtc->mode is a ModeRec not Ptr]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b0d10ff04a24a951256a79710ba22b325b549ba4
Author: Adam Jackson <ajax@redhat.com>
Date:   Mon Jan 3 17:52:26 2011 -0500

    xv: Fix interlace computation
    
    scrn->currentMode is a hack for xf86vidmode and in general is wrong for
    RANDRful drivers.  Use the mode on the associated CRTC instead.
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>
    [ickle: crtc->mode is a ModeRec]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ad6d6e1a678de7d8c2d4cd7c734887e1deb2f9b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 3 16:52:07 2011 +0000

    dri: Only issue a warning for an "impossible" flip return 5 times
    
    As it appears that some kernels do indeed return the "wrong" value,
    issuing a warning 60 times a second is a cruel and unusual punishment.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32680
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d729ef02f2955f7476df4c65403bc1f8e705b780
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 2 09:11:10 2011 +0000

    dri: Don't wait upon a NULL current mode
    
    There is a race condition between the dri swapbuffers code and
    hotplugging whereby we might attempt to execute a wait upon a
    non-existent output. This causes a NULL dereference and a loud crash.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32770
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 537fa55ed2449e91f3dd1e04abc720c6818d7227
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 2 09:06:28 2011 +0000

    dri: Fix the use of the uninitialised bo for flink
    
    Reported-by: Jeff Chua <jeff.chua.linux@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbc542b9d38ff9781efcdf1d5308e97f04499138
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 31 23:29:05 2010 +0000

    dri: Protect against using dri with an non-gem pixmap
    
    Reported-by: Jeff Chua <jeff.chua.linux@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53fbc9f1760ee481cba1f6dceb9e7c97282a2976
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 30 15:32:40 2010 +0000

    Don't replace the scanout bo through PutImage
    
    As the bo may be pinned for either use by the scanout or through sharing
    with another application, under those circumstances we cannot replace
    the bo itself but must force the blit for PutImage.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31367
    Reported-and-tested-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7667ad8432c032aec3a2aa004fc4dfc1877971b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 24 09:42:29 2010 +0000

    dri: Differentiate identical "get vblank failed" messages with line no
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 875d4828352c501ec5d0169735fb078807e76f2e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 23 19:36:12 2010 +0000

    i830: amalgamate consecutive composites into a single primitive
    
    Improve aa10text on i845 from 218kglyphs/s to 234kglyphs/s
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58d9912e447cf6e29b20747b5ed6ee595687ce8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 22 13:50:53 2010 +0000

    Remove the deprecated function 'XNFprintf'
    
    As we know the maximum length of the string, we can replace our single
    usage of XNFprintf with snprintf.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8db77e019e19ace48592b2f6d96af6baa9a228e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 21 23:03:21 2010 +0000

    Revert "Suggest where to find xorg-macros in case it's missing"
    
    I failed my reading comprehension and didn't spot that the help strings
    pointed to two separate downstream packages.
    
    Thanks to Carl Worth for pointing out my mistake.
    
    This reverts commit ebb7aca66785730737bc739624006e55d43dfe1b.

commit ebb7aca66785730737bc739624006e55d43dfe1b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 21 22:23:24 2010 +0000

    Suggest where to find xorg-macros in case it's missing
    
    [Modified version of U. Artie Eoff's commit to remove the duplicated
    string. The paraphrased commit message is repeated below for clarity.]
    
    xorg-macros is often package under an unusual name, so provide some
    clues as to what name to try on the user's distribution. Installing
    build-deps would be just too easy...
    
    Also include a check for the existence of the XORG_DRIVER_CHECK_EXT
    macro, otherwise configure might continue in spite of the missing macro
    and cause obtuse syntax errors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90576f95f35e528fa2c667df162c5dc7ec98975d
Author: U. Artie Eoff <ullysses.a.eoff@intel.com>
Date:   Tue Dec 21 15:10:41 2010 -0700

    configure: updated m4 macro check in configure.ac
    
    Added m4 check for XORG_DRIVER_CHECK_EXT macro definition.  Updated m4 fatal messages to give better hint on how to resolve error when xorg macros are missing.  Previously, configure would continue in spite of the missing macros and the build would fail for syntax errors.

commit 1ac2e04023f84dbf1f3db2ecad1cadd159aa614d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 20 10:55:11 2010 +0000

    Undo: Disable BLT for i830 and 845G
    
    Reported-by: György Balló  <ballogy@freestart.hu>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32482
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6f21405454487adf7623cf22f0fdd9f127099afd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 17 16:37:55 2010 +0000

    G35 is gen4 and not gen3
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=32478
    Reported-and-tested-by: Michal Marek <mmarek@suse.cz>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5743c223877fbff710cdd5114cff6d3ee3108309
Author: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
Date:   Thu Dec 9 03:27:59 2010 +0100

    Check consistency of pageflip completion vblank count.
    
    Implements a consistency check on returned vblank
    count values of pageflip completion. Impossible
    values are detected, a x-warning is logged and
    returned (msc,ust) values are marked invalid,
    so clients could perform error handling. Such
    a warning would indicate bugs in the pageflip
    completion routine of future kms drivers or the
    ddx and thereby aid driver debugging.
    
    Signed-off-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2177e6032146f4720f244e98f7c0d6df1b925784
Author: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
Date:   Thu Dec 9 03:12:35 2010 +0100

    Fix reporting of pageflip completion events on multi-head.
    
    When a drawable is page-flipped on multiple crtc's (fullscreen
    drawable on mirror-mode or multi-head x-screen), only one pageflip
    event is finally delivered, after the last participating crtc signals
    flip completion, this to avoid visual corruption.
    
    Old code returned vblank count and timestamps of flip completion
    of this last crtc, instead of the values of the "master crtc", the
    one that was used for initially scheduling/triggering the pagflip
    via vblank events. (master = I830DRI2DrawablePipe(drawable))
    
    This patch makes sure that the pageflip completion values of the
    "master" crtc are returned, otherwise client applications will
    get confused by the random (msc, ust) values returned by whichever
    crtc was the last to complete its flip. Without this, the returned
    values change randomly and jump forward and backward in time and
    count.
    
    Signed-off-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 71af40a75fbdd1054b1111e8cbe67ad1f97e6613
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 10 15:55:09 2010 +0000

    NEWS: 2.14, I meant the upcoming 2.14 release!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 556331a22101d08babbd276236f74ffcc380171c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 10 15:28:37 2010 +0000

    configure: version bump for 2.13.902
    
    This is actually the first release candidate for 2.14.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e01ea4a45c1cf8953a6d5ff6c600d76dbbe4760d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 10 15:28:00 2010 +0000

    NEWS: Add entry for the 2.13.902 snapshot
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8df6f0a6082ad762ec69be7789a961db0c74154a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 10 12:26:16 2010 +0000

    configure: Bump required libdrm to 2.4.23
    
    To pull in the required headers for BLT and relaxed fencing support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9b967807c2d240488a715509649663aac3583532
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 20:45:16 2010 +0000

    Revert "i965: The RenderCache flush after every glyph is required for compiz"
    
    This reverts commit 03e8351179b1c25d219842ef3e01ee8e176f594f.
    
    * sigh.
    
    This was only meant to be a temporary debugging hack, not for public
    consumption (or embarrassment).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 27e33928f87ecb806d1f8c459d4a4ada76b0e30e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 20:42:24 2010 +0000

    i965: Mark sure we mark reused render targets as dirty
    
    ... or else we may forget to flush them again.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 03e8351179b1c25d219842ef3e01ee8e176f594f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 19:27:57 2010 +0000

    i965: The RenderCache flush after every glyph is required for compiz
    
    ... now who can explain why.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d90c8f4d0bb6b79ecdcaa82f87291169c18c64b9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 19:22:30 2010 +0000

    i965: Invalidate pixmap binding location on reuse.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a186a612376bdd6f86c026e8b8b442108868a0a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 16:56:57 2010 +0000

    Always flush the batch before blocking for new X requests
    
    This should prevent any lag when waiting upon user input, for example
    whilst logging in with gdm.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ba983034b3a70fb541dc359189c020ee497c634
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 7 12:27:29 2010 +0000

    uxa: Emit the damage after the render for the workaround in uxa_solid_rects
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00c204a7b2df7a6b501db9b57603534a45ecafa9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 6 16:34:52 2010 +0000

    snb: Only emit CC and DepthStencil bos once per batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 084ae43110240c582ae7cd6452966dd9f22350fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 6 15:57:19 2010 +0000

    snb: Restore drawrect, we need the implicit flush
    
    Something is wrong, we should be tracking when to invalidate the caches
    as appropriate, yet I can not finding the missing flush to replace the
    implicit one of DRAW_RECTANGLE.
    
    Fixes cacomposite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f3a47d7f235d18e4529e3898a48673c7c3cbd489
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 6 14:11:05 2010 +0000

    snb: Cache pixmap binding locations
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4d48fed9aa0c3c7b84e74b4f72f298f580a8973c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 6 13:50:43 2010 +0000

    snb: Cache state between composite ops
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a58e5a1bdf10be3b96ecaa3d5e3ee288eab1063f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 6 13:34:53 2010 +0000

    snb: Emit more invariants only once
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8f41c371024e2f3845c7652b22af8f5900200f2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 5 21:37:23 2010 +0000

    uxa: Prevent reading past the last byte on upload/download
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=29752
    Reported-by: Sergey Samokhin <prikrutil@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2fac6ca108734dd9566570b15f01cc476fa53dc
Author: Matthias Hopf <mhopf@suse.de>
Date:   Fri Nov 19 04:29:57 2010 +0100

    Don't use hardware acceleration on Sandybridge rev 07 hardware or earlier.
    
    This is known to lock up the GPU even with the workaround in place.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31773
    Signed-off-by: Matthias Hopf <mhopf@suse.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8abade8a2139b500251488be5d6390f149666fb2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 5 09:55:43 2010 +0000

    display: Flush any pending batches before changing modes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8450aba6c731b20e5cd7b55f1d747f00a6523291
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 5 01:08:51 2010 +0000

    i965: Also flush the vertex buffer when restarting the array.
    
    As a corollary to filling one vertex array and beginning a new one is
    remembering to emit the old one before overwriting...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f40f8bcf07bd7f496bfd3069eddfcbeb3d1bf8be
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 5 00:26:22 2010 +0000

    i965: Check for potential vertex array overflow every time
    
    There was a reason why we need to check at the start of every composite
    operation to see if we have enough space in the array to fit the
    vertices, which I promptly forgot when moving the code around to make
    it look pretty.
    
    * sigh.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 55c5f1876e2329a938955967f5d45c814e50beb5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 3 02:05:05 2010 +0000

    Wait on the current buffer to complete when running synchronously.
    
    And remove the vestigal wait upon changing crtc as this is more properly
    done in the kernel.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3cc74044ce3546cc7dc2e918cbabbb41a77f4026
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 2 12:07:44 2010 +0000

    i965: Amalgamate surface binding tables
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a1fa0dbfdafea32139d4457d81b9d722df955eaf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 2 11:25:05 2010 +0000

    i965: Upload an entire vbo in a single pwrite, rather than per-rectangle
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23437fe6769322d48cc3d264660717475b5d0d74
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 3 01:16:16 2010 +0000

    i965: Use reciprocal scale factors to avoid the divide per-vertex-element
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0bb135c40e5ac1bf7593ec1d68d2815cbf47aa25
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 23 22:27:38 2010 +0000

    Disable BLT for i830 and 845G
    
    This pair of chipsets seem broken beyond repair, specifically the
    erratum that causes the wrong PTE entry to be invalidated, so disable
    our incorrect attempts to use the BLT on those devices.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33c08882c0d551afb28baef643279901dcc65fa9
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Nov 17 16:37:53 2010 +0800

    Mark outputs as DPMSModeOn and restore backlight at mode set
    
    The kernel always turns monitors on when doing mode setting, and so no
    further DPMS action is required. Note this in the mode setting code by
    marking the updated DPMS mode and restoring any saved backlight level.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit cc930a37612341a1f2457adb339523c215879d82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 14 19:47:00 2010 +0000

    uxa: Relax fencing some more for gen3
    
    Allow fenced allocations even for small pixmaps if the kernel supports
    relaxing fencing (where only the used pages are allocated).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c5b1399e29ef577b8b91655b5e1c215d1b6dfbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 9 20:20:06 2010 +0000

    i915: Disable maximum state addresses
    
    As the kernel controls the relocation of state buffers, we should not
    hard code the maximum permissible value for them.
    
    Fixes an eventual hang with full-gtt.
    
    Reported-by: Peter Clifton <pcjc2@cam.ac.uk>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 81d355a8dcdfe3d0924bb843bcc0e6546f695391
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 9 09:28:54 2010 +0000

    uxa: Fix crash after allocation failure
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31487
    Reported-by: Thomas Fjellstrom <tfjellstrom@shaw.ca>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 861ee17ae662ffec2269292f92da7833df508b1a
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Nov 5 12:55:02 2010 -0700

    Update version number to 2.13.901
    
    In preparation for a snapshot.

commit aaa436b437839a80d340cc5ad598ec4b47ed2eff
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Nov 5 12:54:16 2010 -0700

    NEWS: Add release notes for 2.13.901 snapshot.
    
    An intermediate snapshot to capture recent developments.

commit 6b66b45b1ff207b80b81973745f42a776448f764
Merge: a44a63d 9f232ad
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Nov 5 12:51:55 2010 -0700

    Merge commit '2.13.0'
    
    This changes the version number and adds the 2.13.0 release notes,
    (which were otherwise missing from the master branch).

commit a44a63d2ff6c01c3dc61de6f736dd441ddd25e52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 5 09:58:45 2010 +0000

    Wait for any pending rendering before switching modes.
    
    A perennial problem we have is the accursed WAIT_FOR_EVENT hangs, which
    occur when we switch the framebuffer before the WAIT_FOR_EVENT completes
    and upsets the GPU.
    
    We have tried more subtle approaches to detected these and fix them up in
    the kernel, to no avail. What we need to do is to delay the framebuffer
    flip until the WAIT completes, which is quite tricky in the kernel
    without new ioctls and round-trips. Instead, apply the big hammer from
    userspace and synchronise all rendering before changing the framebuffer.
    I expect this not to cause noticeable latency on switching modes (far
    less than the actual modeswitch) and should stop these hangs once and
    for all.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=31401 (...)
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 52b32436b9e14a3e13818f80102150ff5bc3c002
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 3 19:42:26 2010 +0000

    Downgrade tiling allocation failure to a warning
    
    We emitted this message as an error even though we fallback and attempt
    to allocate a non-tiled framebuffer before failing (with an appropriate
    error message).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 18839aaec505f8bbdb0690fe694162bf09a87d5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Nov 3 18:14:29 2010 +0000

    Fallback to shadow for Sandybridge if we don't have access to the BLT
    
    If we attempt to emit BLT batches without kernel support, we just end up
    with EINVAL and no rendering. Prevent this, and avoid uncached
    rendering, by restoring the shadow fallback paths if there is no BLT
    support.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8ff37667bf864b771d16a58fc5041cb48408b6a8
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 2 10:36:03 2010 -0700

    Remove the intermittent GEM_THROTTLE call.
    
    This is a holdover from early GEM work when we weren't syncing on the
    DRI client side.  It would keep clients from getting too far ahead and
    killing their interactivity, by bringing everyone to a halt when
    anyone was too far ahead.
    
    Now, GL clients throttle themselves to avoid the problem, and it turns
    out that in the case that they don't (long rendering to buffers with
    no swap), this actually reduces X Server interactivity: instead of
    lagging of X rendering behind input, you get no response for seconds
    at a time, then a burst of rendering, then nothing again.
    
    Reported by ajax.  Tested with moving a window while running
    cairo-perf-trace on the GL backend (improvement) and X backend (no
    significant change in responsiveness).

commit 540c5742186c26c3aeccb7b5d3ff0f374722a20c
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Nov 2 11:05:32 2010 +0800

    render: use headerless render target write
    
    It is weird that some rendercheck cases only work fine with headerless write.
    Need to update intel-gen4asm to support headerless write
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 7a3109312e43ce4c2f600a65fe6bc821a8f0ebde
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Oct 27 16:51:28 2010 +0800

    render: acceleration for composite on Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 0ab2c05a291738ee763eb518c46e6dcfe29249a2
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Oct 27 16:49:26 2010 +0800

    render: fragments for composite on Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 21c86548dc2c80632c49ec6ec4da2935a0c99476
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Oct 27 16:47:36 2010 +0800

    render: fix send instruction used in sampling fragments
    
    To prepare for composite on Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 8d008ca89d44aa10aeb032d631971aaebb388675
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Oct 25 15:39:39 2010 +0800

    render: set the surface state base address
    
    It is the same as commit 73d4c7d7
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit b5ae596a0746e5a37e86f5b0980f9265e0061142
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 1 11:11:09 2010 +0000

    Flush BLT batches before starting an atomic RENDER batch
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42363134bd38fb406d90cdb9e5b227836a793912
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Nov 1 13:23:36 2010 +0800

    Support BLT acceleration on gen6
    
    Signed-off-by: Zou Nan hai <nanhai.zou@intel.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5bed685f765671d63642b24e17abd70579c40ddf
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Nov 1 13:23:35 2010 +0800

    add BLT ring support
    
    gen6+ platform has a BLT engine with seperate
    command streamer to support BLT commands.
    
    Signed-off-by: Zou Nan hai <nanhai.zou@intel.com>
    [ickle: merge trivial conflict]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ec3ff134baeac33d9d5821695d5f80843a96c91
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Oct 15 11:21:09 2010 +0800

    Xv: don't call intel_wait_for_scanline on Sandybridge
    
    MI_LOAD_SCAN_LINE_INCL command is not available on sandybridge.
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 9e73cbd7eea61f2fe69692056ca446a4d95e17c2
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Oct 15 11:20:22 2010 +0800

    Xv: enable TextureAdaptor for Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 3213849907bf1b1468872668d10764054c1034fe
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Oct 27 09:54:05 2010 +0800

    Xv: setup pipeline for Xv on Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 9e4dd27aa848acae1b74b77bbbc0a5bb9f6a502a
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Oct 21 16:10:14 2010 +0800

    Xv: fragments for xv on Sandybridge.
    
    Need to update intel-gen4asm to build these fragments
    
    Signed--off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit e34b3f6ef5811d5e8d156dd6582df8f442e9792e
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Oct 21 13:15:45 2010 +0800

    Xv: Send instruction doesn't use implied move when sampling YUV surface
    
    The two fragments will be reused for sampling YUV surface
    and send doesn't have implied move on Sandybridge
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 73d4c7d7b8efc920ac09885dcace5a536f93b70f
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Oct 13 09:13:50 2010 +0800

    Xv: set the surface state base address
    
    To prepare for Xv on Sandybridge. It is easy to fill the binding
    table without relocation and make sure that the pointer to binding
    table only uses bits[15:0].
    
    Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>

commit 5afc7472b155e8e940f12a38baf80c298dc3b364
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 29 12:23:59 2010 +0100

    intel: don't pass a dangling pointer to GET_PARAM
    
    I fail at cut'n'paste.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6b3ce2e8701e7c3fcd30ca07fc13a2cdcf62560d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 29 11:07:50 2010 +0100

    uxa: Enable reduced fence sizes for i915
    
    Depends on libdrm 362457715faacd3101929e5f0d8ae250d0ad09df (for
    HAS_RELAXED_FENCING define).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b066ddda31e40afa652ae51ffc35025ac3ef6f2a
Author: Adam Jackson <ajax@redhat.com>
Date:   Sun Oct 3 14:42:56 2010 -0700

    intel: Listen for hotplug uevents (V3)
    
    This connects the kernel uevent indicating monitor hotplugging to the
    RandR notification events so that X applications can be notified
    automatically when monitors are connected or disconnected.
    
    This also adds a configuration option to disable hotplug events.
    
    V2: missed a #ifdef HAVE_UDEV around some udev-specific declarations
    
    V3: document Hotplug option in man page
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit a1c54f69643671ce296c57d132852e9846cc41d3
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 18 13:28:44 2010 -0700

    Fix violation of gen6 requirements for depthbuffer tiling.
    
    In general, demoting of tiling of DRI2 buffers seems dubious, as we've
    got various bits of functionality that won't all work together unless
    buffers are tiled as expected.  This just covers one instance of the
    problem, caught by assertions in Mesa.
    
    Fixes:
    fbo-1d
    fbo-d24s8.
    glean/readPixSanity
    glean/rgbTriStrip
    glean/scissor

commit 33133a1d38a4dce60d2e135663b545895fc85abc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Oct 17 09:21:06 2010 +0100

    display: do not report failure for setting unrecognised properties
    
    We need to accept any changes to properties not handled by ourselves -- we
    can't validate the changes ourselves. Denying those changes breaks EDID
    reporting, for example.
    
    Reported-by: Elvis Pranskevichus <el@prans.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8507ef50ba08061ac158848a7c4c136e1755d87e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 13 09:45:59 2010 +0100

    Fix driverName regression for i830 from 4083197a
    
    Reported-by: Stefan Glasenhardt <stefan@glasen-hardt.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30808
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 15aab1ef982fb67eb2ea463089f070afd9a2cfe5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 13 09:50:25 2010 +0100

    Move EDID_COMPLETE_RAWDATA define to intel.h to avoid redifinition warning
    
    The compiler was simply warning that we defined the name prior to
    including the original definition, so reorder.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d2bc2212f8be746e697a65555d6d83bc66d9ce43
Author: Stefan Dirsch <sndirsch@suse.de>
Date:   Fri Oct 8 17:48:38 2010 +0200

    Make driver compile for 1.6 Xserver series again. Part deux.
    
    Signed-off-by: Matthias Hopf <mhopf@suse.de>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5472359d6860af655a3c286d30558540376c9fdb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 8 15:23:13 2010 +0100

    dri: Check for pixmap privates before dereferencing them
    
    It is still possible for the pixmap allocator to return a software only
    pixmap (i.e. without an associated GEM buffer or intel_pixmap), so check
    before dereferencing.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30707
    Reported-by: Matthias Hopf <mhopf@suse.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4083197a44d1a1a05d33654b3c7d6e96d7472fe7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Oct 7 12:45:02 2010 +0100

    Include a chipset generation number to clarify device specific paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1444ea35706992a1f094fe029e6a7d9eec0f93c6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 12:36:30 2010 +0100

    dri+shadow: Only tweak the acceleration of CopyRegion if using shadow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f286891d1415fc607f0c1b574e6bce4b3759493e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 11:38:48 2010 +0100

    dri: Reattach the fake pixmap for the shadow scanout to the drawable.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 23ee926bcd8ddd7a2785786efdf119e4fae75bfd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 10:20:49 2010 +0100

    uxa: Skip a pixmap lookup if there is no driver finish access function
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 707901bf98073fb56179a0b61c806f85ef8f413c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 08:47:20 2010 +0100

    uxa: Re-enable acceleration.
    
    A side-effect of discriminating offscreen based on the devPrivate.ptr
    was that it broke uxa_finish_access and so after any fallback to s/w on
    a Pixmap, it remained in software for the reminder of its life.
    
    Introduce an explicit boolean to mark whether or not hardware
    acceleration is enabled for a pixmap (with a GEM buffer).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 54f545e0631a287f421ef6a6f20831624b212cf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 08:50:13 2010 +0100

    Revert "Clear pixmap->devPrivate.ptr [regression in 7c7294e]"
    
    This reverts commit 48b4e224297fa807be0e2bc7a67bf7e94579e8de.
    
    The better fix is to manually mark the pixmap when acceleration is and
    is not permitted. Whilst the devPrivate.ptr are invalid upon creation,
    it is not worth carring code that serves no purpose.

commit d1925deedd70c6c4374e42de5aa44989fe328b58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 6 00:17:03 2010 +0100

    Clear pixmap->devPrivate.ptr [regression from 7c7294e]
    
    ModifyPixmapHeader(pixdata = NULL) does not clear the
    pixmap->devPrivate.ptr, instead the NULL value is interpreted as meaning
    to keep the current value. (This is similar to the interpretation of the
    other invalid values like depth=-1 which also mean not to change the
    current property). However pixadata=NULL is indeed a valid value, and in
    7c7294e, devPrivate.ptr == NULL was used to differentiate a bo pixmap
    from a system pixmap. Except that we never did clear the ptr as
    intended, and so X would immediately crash.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4bf2182bf9ee64795e2bf524fedf7b6c36f3cd03
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Oct 5 09:59:04 2010 +0100

    shadow: Use a cacheable shadow for all generations
    
    Always avoid direct rendering to the uncached scanout buffer,
    redirecting all 2D access to the shadow instead. Then for the couple of
    platforms where either the BLT is not ready or cannot be trusted (i8xx)
    perform the front buffer fixup using the uncached writes from the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b27a521214728052b8b10342aaacbaf1622b8e2c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 4 20:31:44 2010 +0100

    shadow: Enable shadow by default on SandyBridge
    
    SandyBridge 2D support is far from complete, so instead of
    permanently falling back and always using uncached GTT mapping for
    rendering, use the shadow buffer instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3e641459f8997f45288cc3cb314e50f2b5a629fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 4 20:31:01 2010 +0100

    shadow: Disable BLT for SandyBridge
    
    The blitting code is incorrect for SandyBridge so disable until
    the BLT ring is ready.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7c7294ec00d6c3a454a17a1b9983d14d0655162c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 4 11:56:27 2010 +0100

    shadow+dri2: Allow dri2 to be independently enabled with shadow
    
    To enable DRI we create GEM buffers for the client to render into with
    hardware acceleration. In order to maintain coherency between any 2D
    render operations with the independent 3D clients (this includes the
    reading of 2D rasterisation by the direct rendering client, e.g.
    compiz using texture_from_pixmap) we need to replace the shadow pixmap
    with the GTT mapping. Therefore 2D rendering to a DRI buffer will be to
    uncached memory and thus penalised -- but the direct rendering clients
    will have full hardware acceleration.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 16a5d0ee3ca4d41af6a6876a8baf81e3f715781d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 4 11:21:17 2010 +0100

    shadow: Map the scanout directly on i8xx
    
    Even with the minimal use of the BLT to copy from the GTT shadow to the
    GTT scanout, i830 was still hanging. Just write to the scanout directly.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 516d235c5b3bd51e9533925140d95d3b4533129c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 4 11:10:57 2010 +0100

    Split shadow handling routines to their own file.
    
    This is about to get messy, so separate out the shadow from the normal
    code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 455f2939a661764ebb8d1747d44e16a0a8937808
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 2 13:32:58 2010 +0100

    Do not claim the PCI device if !KMS
    
    By returning FALSE whilst probing if we can't find a KMS driver, we
    allow X to fallback to trying the VESA driver -- rather than failing.
    
    The initial idea for this was by Julien Cristau.
    
    Reported-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 97fea2fd0c36d78f4e940b124a7886c4a3f3dfc7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Oct 2 10:05:59 2010 +0100

    legacy/i810: Remove pVisualConfigs
    
    Completely unused pulling in an undesired glxproto dependency.
    
    Reported-by: Cyril Brulebois <kibi@debian.org>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30554
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8784c4f5a1524fb979b00c7ce7981cbc1dcf0ec0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Oct 1 21:40:36 2010 +0100

    video: Disable TextureAdaptor for Sandybridge
    
    The acceleration code does not yet exist, so we try to use gen4 shaders
    which hangs the chip and makes everybody upset. Disable it until such a
    time as support is written for Sandybridge XVideo.
    
    Reported-by: Matthias Hopf <mhopf@suse.de>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30500
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f232ad67c72b7869dcd112207bc41dc01d7d104
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Sep 30 08:45:49 2010 -0700

    Increment version to 2.13.0
    
    For the new, major release.

commit 99ec9bb0f1eaf2e5c04614957a51624a928526e5
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Sep 30 08:45:15 2010 -0700

    Add release notes for the 2.13.0 release.
    
    Which is functionalliy identical to 2.12.902.

commit 345c963e443ec325f1ff530512a356ddb318ff70
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Thu Sep 30 10:58:49 2010 +0800

    Always use tiling on Sandybridge
    
    Sandybridge requires kind of buffer must be tiling, like depth.
    And we would or have all tiling cases handled fine. So not allow
    user to turn off tiling on Sandybridge+ may be fine.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit d4c013cb9d92d2959c9a98eca20e43ab14ae22e3
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 28 20:49:52 2010 -0700

    Increment version to 2.12.902
    
    Just before making the 2.12.902 (2.13-rc2) snapshot.

commit 35e7da7df0b286b5168a85d540cc9fdf55c1cae6
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 28 20:49:10 2010 -0700

    Add release notes for the 2.12.902 snapshot.
    
    Summarizing the 5 recent changes to the driver.

commit 5704955538f59a2b7a5eff67cc23953d2f27d523
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 28 20:44:40 2010 -0700

    Fix to depend on the (just-released) libdrm >= 2.4.22
    
    With libdrm < 2.4.22, the compilation of xf86-video-intel would fail
    due to an undefined DRM_MODE_CONNECTOR_eDP. We now ensure that a
    sufficiently new libdrm is available before compiling.

commit 40c9d180bf43af84ae05d88e993deedf76e263e6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 26 23:09:04 2010 +0100

    Retry framebuffer allocation if first attempt fails.
    
    If we are tiled, we may fail the allocation due to an EIO and so not
    being able to set tiling. Try again with an untiled request in this
    case.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 537e73f3f935b917f2f5f9b51499cb29d65e3889
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 24 17:37:41 2010 +0100

    Disable dri2 after forcing fallbacks
    
    If we force fallbacks, then we will only create pixmaps in system
    memory, preventing DRI2 from passing valid bo names to the clients. In
    this case, they will just fallback to swrast. If we disable DRI2 after
    forcing fallbacks (e.g. regenerating after a GPU hang or explicitly
    disabled with the shadow buffer) then it is simpler just to disable the
    extension and allow mesa to use pure swrast.
    
    Reported-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b84925b9c0842ba4dfa3481c09d3a80f84db4838
Author: Matthias Hopf <mhopf@suse.de>
Date:   Tue Aug 17 18:05:02 2010 +0200

    Make driver compile for 1.6 Xserver series again.
    
    Signed-off-by: Matthias Hopf <mhopf@suse.de>

commit 99f8d68d3dbc54fdd7de4a6df546cfa89422a0c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 22 12:34:00 2010 +0100

    display: Refactor is_panel()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4ba27e1f2198fc10a1dd268ed9f137bac6e80086
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 21 17:43:01 2010 -0700

    Bump version to 2.12.901
    
    Just prior to pushing out this new snapshot.

commit 334265fa5ef18405bd8c897343fff49ad53f5fce
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 21 17:42:21 2010 -0700

    NEWS: Add notes for the 2.12.901 snapshot
    
    (Otherwise known as rc1 for 2.13)

commit bfba6d6148b938588ffbefdf04f4e71683c66dfd
Author: Krzysztof Halasa <khc@pm.waw.pl>
Date:   Tue Sep 21 22:56:26 2010 +0100

    Allow interlaced modes.
    
    This may not the best method, but it should be a good base on which to
    build...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f63c7df6866fed61551d39209b1a262e2a0c4b28
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Fri Sep 17 16:39:12 2010 +0800

    Disable swap buffer wait on Sandybridge
    
    MI_LOAD_SCAN_LINE_INCL command is not available on sandybridge.
    I haven't got reply on any substitution for it, so turn it off for now.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 55b5fe888002258dd863d41977bfbfcf1a922179
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 16 16:50:13 2010 +0100

    Add alternate pci-id for B43
    
    Confirmed by http://en.wikipedia.org/wiki/Intel_GMA
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30221
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 08c2caca48323d6d5701dcef3486f850619d7905
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 12 12:34:51 2010 +0100

    uxa: Apply source clipping to blits
    
    Yes, this should be done in the higher layers. Yes, I have written code
    to that. No, it is not ready, hence add the sanity check to the
    SRC_COPY_BLT.
    
    This isn't the first report that I've seen, but will be the last.
    
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=30120
    Reported-by: rezbit.hex@gmail.com
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ae160d7fbfc79e78dad8702efcc55d9c0c25ff67
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 10 13:19:12 2010 +0100

    shadow: Simply modify the Screen pixmap header
    
    This is a slightly less risky strategy than having to remember to update
    all pointers to the old Screen pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0515256490d5bcd55f85af83b84918d1bfe7f8f8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 10 00:08:58 2010 +0100

    display: Free the EDID blob after we copy it to the output, not before.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b96c18165d713cd6781dbf217ec33e11cc961bc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 25 12:56:43 2010 +0100

    Enable a shadow buffer and disable GPU acceleration.
    
    An attempt to workaround the incoherency in gen2 chipsets, we avoid
    using dynamic reallocation as much as possible.
    
    The first step is to disable allocation of pixmaps using GEM and simply
    create them in system memory without a backing buffer object. This
    forces all rendering to use S/W fallbacks.
    
    The second step is to allocate a shadow front buffer and assign that to
    the Screen pixmap. This ensure that the front buffer remains in the GTT
    and pinned for scanout. The shadow buffer will be rendered to in the
    normal fashion via the Screen pixmap, and be marked dirty. In the block
    handler, the dirty shadow buffer is then blitted (using the GPU) over
    the front buffer. This should completely avoid having to move pages
    around in the GTT and avoid incurring the wrath of those early chipsets.
    Secondly, performance should be reasonable as we avoid the ping-pong
    caused by the small aperture and weak GPU forcing software fallbacks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0fa4321a765126228170ecb9536f32c134886d51
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 7 13:56:16 2010 -0700

    KMS: initialize backlight support for eDP panels too
    
    Since being able to control the backlight is handy.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit f56c839f30ec39ea22bbf6a7fda4cefd7cbfbfc2
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 7 13:53:47 2010 -0700

    KMS: rename LVDS fields to reflect actual usage
    
    These are used for panels, not just LVDS connections, so name them as such.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 0d26d950fdada1f59dc6cb31fe2f03004825f773
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 7 13:46:58 2010 -0700

    KMS: add fake EDID on eDP too
    
    This gives us a few more standard modes on eDP panels with just a simple
    fixed timing in the VBT, just like on older, LVDS attached panels.
    
    Fixes FDO bug https://bugs.freedesktop.org/show_bug.cgi?id=30069.
    
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: Manoj Iyer <manoj.iyer@canonical.com>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 273d34fbc43e54a8539fbe7efc1dca66bbb4e6dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 7 12:57:04 2010 +0100

    display: Query current level after finding max value.
    
    The current backlight value is clamped to the valid range [0, max] and
    so as we queried the value before setting the max, we forced the current
    backlight to 0 and so set it to be zero on initialising the display.
    
    Fixes:
    
      Bug 30063 - start X will modify brightness value to zero
      https://bugs.freedesktop.org/show_bug.cgi?id=30063
    
    which is a regression due to 38f940dfea494d3093236f065392c431be06ae6e.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 53767cc0d0a58d36cd445da3a31c65b349eebbba
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Sep 7 14:17:05 2010 +0800

    Add more sandybridge graphics device ids
    
    New ids for GT2 and GT2+ on desktop and mobile sandybridge, and
    server sandybridge device ids.

commit 00f6af2c8ec899258ffab60dc2d9d80c4d9daec8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 4 18:45:11 2010 +0100

    display: Set MONITOR_EDID_COMPLETE_RAWDATA for large EDIDs
    
    Quoting Adam Jackson:
    
    "But the X driver looks like
    it never sets MONITOR_EDID_COMPLETE_RAWDATA, which means the X core
    doesn't know that any sections beyond the first are present, so it won't
    ever hand back more than 128 bytes to clients.  Boo."
    
    This patch is based on his.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 501e78b0095b00a635dc1dc182fc132f14f08f22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 4 12:37:39 2010 +0100

    Force use of GTT and fence registers for mapping tiled objects
    
    If the buffer object is tiled, we need to use the fence registers to
    perform the appropriate untiling for CPU access. Ensure that we always
    take this path for tiled objects, regardless of their size.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b7a8087fbc5cbd944f8345b8a098270c1f63ebab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 25 15:44:20 2010 +0100

    Revert "Leave adjustment of backlight to the driver."
    
    This reverts commit 9c3e34703dcdc2155faeb2c1886930def19d9989.
    
    This commit is not ready, as first the driver needs to handle all
    controllers, especially those that ignore the BLC and require their own
    interface.  Fortunately, by moving that discovery into the kernel - where
    it just means finding which ACPI device is attached to the video and has a
    backlight interface - the userspace code should become much more sane,
    and work even with multi-gpu, multi-lid systems.
    
    But that is for tomorrow.

commit 68a5ad497b557ab9e8bff301098ea78c84d385a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 25 14:59:04 2010 +0100

    uxa: Fallback if faced with large A1 glyphs.
    
    Rather than assert, we should fixup the use of large A1 glyphs. However,
    the simplest approach is to simply fallback to s/w.
    
    Fixes:
    
      Bug 29430 - [UXA] Crash due assert (uxa_pixmap_is_offscreen(src_pixmap));
      https://bugs.freedesktop.org/show_bug.cgi?id=29430
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c3e34703dcdc2155faeb2c1886930def19d9989
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 22 21:27:45 2010 +0100

    Leave adjustment of backlight to the driver.

commit 104cd0554bde1d109a54db7a93700d5edfabd914
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Mon Aug 23 09:48:22 2010 +0800

    Add sandybridge D0 support
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 271dda84be2f81b32dbe5947e64f5558a89e385e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 22 19:57:24 2010 +0100

    display: Use the native intel backlight controller
    
    If the i915 driver exposes a native ACPI interface to modify the panel
    backlight use it in preference to the generic interfaces. On multi-GPU
    systems, the panel backlight is meant to be connected via the IGP and
    this ensures that we always find the right interface.
    
    Fixes:
    
          Bug 29273 - XORG Intel driver chooses wrong acpi_video to control
                      brightness in multi-GPU system
          https://bugs.freedesktop.org/show_bug.cgi?id=29273
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42312bbd8c9cbadf0adc4556b76987857d105bd9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 22 09:54:18 2010 +0100

    Remove accel_pitch_alignment
    
    This has to be 64 on all generations currently, so replace the variable
    with a constant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7f86e5b5da88201e5443e26619c35a1a9745cf68
Author: Matt Turner <mattst88@gmail.com>
Date:   Sat Aug 21 17:32:25 2010 -0400

    Replace ROUND_* macros with ALIGN.
    
    Signed-off-by: Matt Turner <mattst88@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b611bced15c30f7bcd03106ce90668b684c1ada6
Author: Matt Turner <mattst88@gmail.com>
Date:   Sat Aug 21 17:32:24 2010 -0400

    Use ALIGN macro instead of open coding it.
    
    Signed-off-by: Matt Turner <mattst88@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b04b350a983b89eb2d741f55baa297a933ac6ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 19 20:05:08 2010 +0100

    Open-code DRICreatePCIBusID()
    
    During -configure we would attempt to query the availablility of KMS
    before the DRI module was loaded, thus we were unable to create a valid
    bus identifier and so the query failed and we disowned the device.
    
    Fixes:
    
      Bug 29611 - Xorg -configure fails
      https://bugs.freedesktop.org/show_bug.cgi?id=29611
    
    Reported-by: Sergey Samokhin <prikrutil@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c882f6a22a862c1664c375e05e5e6fc4bdb04edb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 18 10:21:22 2010 +0100

    Move registration of vsync fd from pre-init to screen-init
    
    Marty Jack reported an issue he found where the page-flipping handler
    was being lost on server reset. This results in the swap completion
    notification being lost, with the sporadic hang of full screen
    applications like Compiz, flash and even glxgears!
    
    Fixes:
    
      Bug 29584 - Server in compute loop
      https://bugs.freedesktop.org/show_bug.cgi?id=29584
    
    There are also several possibly related bugs with similar symptoms, i.e.
    OpenGL applications hanging on missed swap notifications.
    
    Reported-by: Marty Jack <martyj19@comcast.net>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Keith Packard <keithp@keithp.com>

commit 19c48d3b3f33582baa87a9b3a9189e320e4cea45
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 9 10:13:58 2010 +0100

    display: outputs are enabled automatically by KMS
    
    When an output is attached to a crtc and that crtc is enabled, the
    output is automatically enabled so we can remove the redundant manual
    dpms on.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6304cb048c745be81dae13f1d936996e04eaa530
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 5 18:13:55 2010 +0100

    display: Minor cleanup for adding extra LVDS modes
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 41ae9564350cba8ac9f040f22bad8740e08e14c4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 5 18:13:30 2010 +0100

    display: Refactor EDID attachment to output.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8919ab2967a8425e1cdc04b73702ce534f6abf0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Aug 5 09:59:22 2010 +0100

    Revert "display: Cache whether we have probed for an EDID"
    
    Dave Airlie advised that hotplug detection can be unreliable and that
    mode caching, in general, should be done in the kernel in any case.
    
    This reverts commit 622e600069ab0efd22586c7a71eecbd4baf21c40.

commit 622e600069ab0efd22586c7a71eecbd4baf21c40
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 4 09:57:12 2010 +0100

    display: Cache whether we have probed for an EDID
    
    Remember for the detection cycle whether we have already probed for the
    EDID -- as this can be slow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6a707ca13097b85b319283b3a174b1986056ab8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 4 09:54:28 2010 +0100

    display: Embed the lvds size into the connector
    
    Remove one very common allocation.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c7d105ccae32fba49a07a03b726cc3fe2de3d27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 4 09:51:34 2010 +0100

    display: Handle cursor error paths.
    
    Check that the cursor was allocated before freeing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 38f940dfea494d3093236f065392c431be06ae6e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 4 09:50:14 2010 +0100

    display: Tidy backlight initialisation
    
    Mostly whitespace and a single error-code fix.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b7263b771d94401cb4ea6cbf4dc7a295eeda7c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Aug 4 09:46:01 2010 +0100

    display: Check for buffer overrun in output name lookup.
    
    The kernel may know about more types than we do, so protect ourselves
    from reading from beyond the end of the string array.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56629166915155628e70e6ec8052c0d220a8bb68
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Aug 4 15:35:41 2010 +1000

    intel: add output names for later additions to kernel

commit fe7dee7fe1cf12665bc5ba3923cd1a8f74cbbe57
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 1 14:15:09 2010 +0100

    Remove the final references to the drmmode prefix
    
    In particular fix the compile regression for intel_do_pageflip().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4f8b279f32cfda0f3b8fa1542b3fe00051520012
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 1 12:35:57 2010 +0100

    intel_display: Miscellaneous tidy
    
    A mixture of whitespace and closing of leaks on error paths.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit db7cd7b9f0ce8e435c121071eaadf8e6dcebf9e8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Aug 1 11:25:42 2010 +0100

    Rename drmmode_display to intel_display
    
    And fixup all the drmmode_* functions to have an intel prefix and
    categorise those into intel_mode, intel_crtc, intel_output and
    intel_property so that the functions are a little more self-descriptive
    and, more importantly, are consistent.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0be3e95c844247746742805830860ace9f546d99
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Fri Jul 30 09:39:58 2010 -0400

    Remove explicit batchbuffer submit in DRI2 copyregion
    
    Now that we submit from the flush callback chain, we know we'll always
    submit before the client receives the reply or event that blocks it from
    rendering the next frame.

commit 69d65f9184006eac790efcff78a0e425160e95aa
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Thu Jul 29 18:31:48 2010 -0400

    Submit batch buffers from flush callback chain
    
    There are a few cases where the server will flush client output buffers
    but our block handler only catches the most common (before going into select).
    If the server flushes client buffers before we submit our batch buffer,
    the client may receive a damage event for rendering that hasn't happened yet.
    
    Instead, we can hook into the flush callback chain, which the server will
    invoke just before flushing output.  This lets us submit batch buffers
    before sending out events, preserving ordering.
    
    Fixes 28438: [bisected] incorrect character in gnome-terminal under compiz
    https://bugs.freedesktop.org/show_bug.cgi?id=28438
    
    Signed-off-by: Kristian Høgsberg <krh@bitplanet.net>

commit b68d4fcab5d671946c187947f5d00aedff939852
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 28 13:41:41 2010 +0100

    drmmode: Only treat a backlight as connected if it has a non-zero max
    
    Optimistically might help
    https://bugs.freedesktop.org/show_bug.cgi?id=29273
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 938ef4eaec0e406e198105d866f6d2a1be5e0ef8
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Wed Jul 28 07:57:42 2010 -0400

    legacy: Remove long gone use of GlxSetVisualConfigs()
    
    This removes the last dependeny on anything GL/GLX in the driver.

commit fba6651a92af76d7a8d034e1acfdad5023cd311c
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Tue Jul 27 12:59:39 2010 -0400

    Drop use of GL types in the driver
    
    Still used in i810 for building the glx visuals.

commit 34b9d45be6cb0c42f031677a0bda8a5013472ae8
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jul 27 09:10:04 2010 -0700

    Revert "configure.ac: add xi and gl requirements"
    
    This reverts commit d580fa82a1cf339d2d1fd1055d137c0b23cd04f3.
    
    Oops, these should be server or other package dependencies, we don't
    actually need them for xf86-video-intel.

commit d580fa82a1cf339d2d1fd1055d137c0b23cd04f3
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jul 26 16:44:19 2010 -0700

    configure.ac: add xi and gl requirements
    
    Could probably be earlier versions, but having these here makes packaging
    easier.

commit f46a8dfce59013ce593c15f7166598d0fff9198f
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Jul 26 23:02:02 2010 +0200

    video: kill do { ... } while (ret != -EINTR) loops
    
    Chris Wilson likes to sprinkle these all over, but in this
    case it's just misleading. libdrm already does this for us.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 1cb69b9a77b7afbb4358757556065e10a6b15ea8
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Jul 26 23:00:20 2010 +0200

    video: kernel overlay needs triple buffering
    
    The kernel overlay code does asynchronous overlay flips. So keep
    onto two old buffers, for otherwise the rendering of the next
    frame might overwrite the contents of the currently still displaying
    one. With ~25fps videos and ~50 Hz screens that's rather unlikely,
    still, fix it.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 68df6b2790891683ee2e58daaad34ef17ae344f5
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Fri Jul 23 17:39:37 2010 -0400

    simplify Makefile as per-target compilation flags are not needed
    
    Per-target compilation flags (libIntelXvMC_la_CFLAGS) are required
    when multiple targets which require different compiler flags,
    are build in the same makefile.
    
    Automake issues a command with -c and -o flags which not all compilers
    support. The object fles are prefixed with libIntelXvMC_la.
    The macro AM_PROG_CC_C_O must then be used to provide this feature
    on compilers that do not have it. If not, a warning is issued at make time.
    
    This macros checks for compiler support and if missing, uses a "compile"
    script it generates in the package root directory.
    
    Currently the driver uses per-target flags but the macro is missing.
    Rather than adding the macro, this patch stops using per-target flags
    by using the AM_CFLAGS variable for all targets in the makefile, as
    there is only one.
    
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 0ae30b6d1f4f6c2f2db9443f1027ea41849ad087
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Jul 21 16:49:04 2010 -0400

    config: add comments for main statements

commit b12b2219677d94933774955b50545efceff57279
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Jul 21 16:07:00 2010 -0400

    config: replace deprecated use of AC_OUTPUT with AC_CONFIG_FILES
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 8b2d65da41461735b1138fdd6e0efc96419cd815
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Jul 21 14:37:41 2010 -0400

    config: replace deprecated AC_HELP_STRING with AS_HELP_STRING
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 3feeef5294b1a2df05a25f4f4eb6400be6cc4ee1
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Jul 21 14:05:22 2010 -0400

    config: replace deprecated AM_CONFIG_HEADER with AC_CONFIG_HEADERS
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 74a828e286c46473b8edf6de32c1989c052dd82c
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Jul 21 09:27:42 2010 -0400

    config: complete AC_INIT m4 quoting
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 33ec66d7006e2a7e287fd77c53a31db49220591a
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Jul 20 21:54:11 2010 -0400

    config: remove unrequired AC_SUBST([DRI_CFLAGS])
    
    This macro is called by PKG_CHECK_MODULES
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit b20b8ac937505310fbe68f07e42cafe4ba88da76
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Jul 20 20:24:42 2010 -0400

    config: remove unrequired AC_HEADER_STDC
    
    Autoconf says:
    "This macro is obsolescent, as current systems have conforming
    header files. New programs need not use this macro".
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 9fe5169fffeee10b1262f160a15c11c283e2faa7
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Jul 20 19:41:31 2010 -0400

    config: remove AC_PROG_CC as it overrides AC_PROG_C_C99
    
    XORG_STRICT_OPTION from XORG_DEFAULT_OPTIONS calls
    AC_PROG_C_C99. This sets gcc with -std=gnu99.
    If AC_PROG_CC macro is called afterwards, it resets CC to gcc.
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit e6b8811e5bb30e2cd4e35b1fe84d69f18a73ee0e
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Jul 20 18:45:19 2010 -0400

    config: update AC_PREREQ statement to 2.60
    
    Unrelated to the previous patches, the new value simply reflects
    the reality that the minimum level for autoconf to configure
    all x.org modules is 2.60 dated June 2006.
    
    ftp://ftp.gnu.org/gnu/autoconf/autoconf-2.60.tar.gz
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 2d85efaa36791bd441f069b612ee86387353d1ed
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Jul 20 16:15:29 2010 -0400

    config: upgrade to util-macros 1.8 for additional man page support
    
    Use MAN_SUBST now supplied in XORG_MANPAGE_SECTIONS
    The value of MAN_SUBST is the same for all X.Org packages.

commit 142ffa287236adbc3c5f6ead46c63c4c541ace0c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 22 16:42:26 2010 +0100

    video/i915: ValidateGC after setting clip.
    
    Order is important. And ensure that the scratch GC is performing clip by
    children.
    
    Fixes:
    
      Bug 29213 - video artifacts if used dualscreen mode
      https://bugs.freedesktop.org/show_bug.cgi?id=29213
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c57840b272ba88fddf22484929608431879b0fab
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jul 21 09:06:06 2010 +0100

    uxa: Check for failed pixmap allocation
    
    Fixes:
    
      Bug 29187 - crash in intel_drv
      https://bugs.freedesktop.org/show_bug.cgi?id=29187
    
    Backtrace:
    0: /usr/bin/X (xorg_backtrace+0x28) [0x466808]
    1: /usr/bin/X (0x400000+0x67c79) [0x467c79]
    2: /lib/libpthread.so.0 (0x7ff19b297000+0xef60) [0x7ff19b2a5f60]
    3: /usr/lib/xorg/modules/drivers/intel_drv.so (0x7ff197986000+0x34684) => uxa/uxa-render.c:841
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a4bfaf42412f373bbc8ebe1536018dcacde7436
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 20 11:30:44 2010 +1000

    intel: respect tiling disable.
    
    For testing purposes its nice to know tiling isn't being used anywhere.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit d48d584a822ae5adae64f6d5f09faa4ac9b8de73
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 15 14:37:59 2010 +0100

    video: Free the buffers immediately after turning off.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 24bdfe0d5eb4e890e9c63bbb4617efaa0768ab7f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 15 13:54:04 2010 +0100

    video: Reuse the old buffers.
    
    After passing the new buffer to the kernel, the old buffer is unpinned
    and becomes available for re-use. So keep hold of the old buffer and
    swap after a PutImage. This greatly reduces the amount of CPU time
    consumed by the kernel on behalf of the video overlay -- by only
    allocating two buffers for an entire sequence, we avoid clflushing and
    page allocation on every frame.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2267e5928bd90a6997970584462bd97df447e819
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 13 10:36:34 2010 +0100

    Workaround a broken container_of define in list.h

commit 798c3a5fc6e3d44c9b94e6bc4e72385a10939f52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 13 10:30:33 2010 +0100

    Teardown the bufmgr on shutdown as well.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b2e98227d11a60e90b3ea518f14962f2764ffa68
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 13 10:15:34 2010 +0100

    Remove the duplicate drmmode prototypes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5de1b74d64f807b59c730871d4cb171484db9780
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 13 09:34:53 2010 +0100

    modes: There may be more than one crtc and output... DESTROY THEM ALL!
    
    In order to cleanup all CRTCs and outputs on shutdown, we need to keep a
    list of the individual structures and iterate over that list on
    shutdown.
    
    Also, the output and crtcs are configured just once and not for each
    screen generation so move the shutdown to the termination and not on
    CloseScreen. Oops.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3a7c25ff8ddd45c9d9eca5cc2228552847ca9e7d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 12 19:47:46 2010 +0100

    video: Apply overlay stride errata for i830 and i845
    
    Due to an erratum on these chipsets, the overlay stride must be a
    multiple of 256 bytes.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 56e5816252afbc7dd555c308ca678fce7ee584cc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jul 12 17:26:37 2010 +0100

    video: Copy DummyEncoding into each adapter.
    
    As we use the static DummyEncoding and may attempt to modify it for each
    adaptor (on each device), we should use copies instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e30f0338fbf894fa3fdab20f4f9a97495cd341da
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Jul 1 09:56:40 2010 -0400

    Destroy screen pixmap on screen close.
    
    This avoids a memory leak on server reset.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    [ickle: Added comments from Keith that explain the necessity of
    destroying the pixmap ourselves and why chaining up in this instance is
    not the correct approach.]
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6e08b0f48f0d6ddaca963de6f4fd3b56f32512c6
Author: Fernando Carrijo <fcarrijo@yahoo.com.br>
Date:   Thu Jul 1 07:15:22 2010 -0300

    Purge macro NEED_EVENTS
    
    Signed-off-by: Fernando Carrijo <fcarrijo@yahoo.com.br>
    Acked-by: Tiago Vignatti <tiago.vignatti@nokia.com>
    Reviewed-by: Alan Coopersmith <alan.coopersmith@oracle.com>

commit 5ce3f536b7169a1ee9eadf830e61bab230dd7239
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 9 14:06:43 2010 +0100

    drmmode: Destroy the output on shutdown
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ff369cd2602497ee11273b50f76d1a7bf25991d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 9 14:00:31 2010 +0100

    drmmode: Destroy Crtc on screen shutdown
    
    Should fix:
    
      Bug 26946 - CRTC cursor BO leak in 2D
      https://bugs.freedesktop.org/show_bug.cgi?id=26946
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6fba8c449f61341a98a5ae8d97effa6fd0610fd4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 9 12:12:13 2010 +0100

    Add support for I854.
    
    I spotted that the kernel knew of the I854, but the pci-id was never
    added to the ddx.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 141e88c8730a099a6ca5eab1350c2e53a680cb0d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 9 12:11:07 2010 +0100

    video: forgotten amendment to previous commit.
    
    An extra sanity check to skip the wait if all clipped...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 272d1c14a39c32ade39b5a8b080a891f2b3d6e8e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jul 9 10:41:19 2010 +0100

    video: apply the crtc box checks from dri.
    
    The dri code is much more careful in ensuring that the scan lines that
    is waits for are valid. Copy this code to video, with a bit of work this
    can be refactored, and perhaps even teach dri how to handle rotated
    front buffers.
    
    References:
    
      Bug 28964 - [i965gm] GPU infinite MI_WAIT_FOR_EVENT while watching video
                  in Totem
      https://bugs.freedesktop.org/show_bug.cgi?id=28964
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 75850e824bd66b961b9ce21696d9090169f7b28f
Author: Evan McClain <aeroevan@gmail.com>
Date:   Thu Feb 25 01:51:42 2010 -0500

    Add mbp_backlight support.
    
    Acked-by: Julien Cristau <jcristau@debian.org>

commit a2aa4c23f65b03c389c2ba8eac0298dfb205e67d
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Jul 5 14:02:42 2010 +1000

    uxa: oops typo in previous commit

commit feff2ec80eeeba5074d19efcddf4867adf639b4f
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Jul 5 09:07:08 2010 +1000

    uxa: don't compare planemask with FB_ALLONES.
    
    planemask is an unsigned long initialised to ~0, on 64-bit this is not equal
    to an (unsigned int)-1.
    
    Use the macro provided to do this.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 7ad9c0bebf2c71db574e0302264859ce53cecd37
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Jul 2 12:39:27 2010 -0700

    add cscope files to gitignore

commit afcd41820d7481912b49093670e9d7a4a6a2338f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 1 22:14:03 2010 +0100

    Reduce front buffer stride prior to rejection
    
    If we reject the front buffer because it has too large a stride, repeat
    the allocation using untiled for the cases where we can utilize laxer
    hardware restrictions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f8778b66a98d68e622cdf5b2d1fd959c4f7a2b2b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 1 21:58:43 2010 +0100

    drmmode: Add missing newlines at the end of log messages.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 690fbd1a64c1e1fd07f7f8a5e39e05a33e4d0721
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jul 1 21:55:04 2010 +0100

    drmmode: Use a copy of the converted mode on resize
    
    Avoid a potential use-after-free of the copied mode string by reusing
    the converted kernel mode on resize.
    
    ==19897== Invalid read of size 8
    ==19897==    at 0x661C330: ??? (strcpy.S:1308)
    ==19897==    by 0x8618AE7: drmmode_set_mode_major (drmmode_display.c:293)
    ==19897==    by 0x8618E6F: drmmode_xf86crtc_resize (drmmode_display.c:1299)
    ==19897==    by 0x529A77: xf86RandR12ScreenSetSize (xf86RandR12.c:708)
    ==19897==    by 0x4BD528: ProcRRSetScreenSize (rrscreen.c:301)
    ==19897==    by 0x42B820: Dispatch (dispatch.c:432)
    ==19897==    by 0x4254C9: main (main.c:289)
    ==19897==  Address 0x72e91e0 is 0 bytes inside a block of size 9 free'd
    ==19897==    at 0x4C23DBC: free (vg_replace_malloc.c:325)
    ==19897==    by 0x48424F: xf86DeleteMode (xf86Mode.c:1921)
    ==19897==    by 0x4942B7: xf86ProbeOutputModes (xf86Crtc.c:1572)
    ==19897==    by 0x5290BB: xf86RandR12GetInfo12 (xf86RandR12.c:1551)
    ==19897==    by 0x5313AE: RRGetInfo (rrinfo.c:202)
    ==19897==    by 0x4BCCAA: rrGetScreenResources (rrscreen.c:337)
    ==19897==    by 0x42B820: Dispatch (dispatch.c:432)
    ==19897==    by 0x4254C9: main (main.c:289)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 772f8236d50725f0b330508616b4f2a9a910662a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 30 13:58:05 2010 +0100

    dri: Handle errors during GetBuffers() gracefully.
    
    Unwind the array of Pixmaps already allocated and report failure for the
    old dri GetBuffers() path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 17884af4eda01c05e7429ed6a195f3e4ceeff892
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 28 17:44:45 2010 +0100

    Repair the damage to 'make distcheck' after splitting out i810
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 28c0ca676c47e7e38fabdd9ef24a70bd26701f33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 25 13:40:22 2010 +0100

    Remove unused inclusion of <sys/mman.h>
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2306e675c48bc00a8ca1f4545bb88c97d6ef4fa6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 25 13:32:02 2010 +0100

    configure: Remove check for unused function, mprotect
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6695296ca28da7c4f551b0e80a8d06b557d59a5e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Jun 25 13:31:11 2010 +0100

    configure: Remove unused checks for xext
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5c663ce8442bd3b69c96e29061c57cc565fca91d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 20 15:01:16 2010 +0100

    Rename common infrastructure to the intel namespace.
    
    After splitting out the i810 driver into its own legacy directory, we
    can identify the common routines not as i830 but as intel. This
    clarifies the code which *is* i830 specific.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 797d173a9af12055ba2609293182b616dd673ef4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 20 12:52:10 2010 +0100

    i810: Move into a legacy directory.
    
    The driver is still built but is no longer under active development so
    move it and supporting files to a new directory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd61531a78b9a2cbdd6019199c43258f83e6e2ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 20 21:03:44 2010 +0100

    Remove unused configure option: --enable-video-debug
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ca16e3133658504b68a6b5c83bb8712899016544
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Jun 24 14:07:15 2010 -0700

    Update version to 2.12.0
    
    For the imminent 2.12.0 release.

commit 8caf1564a75d65636d9b7a4da03219bb302bb37b
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Jun 24 14:06:43 2010 -0700

    NEWS: Add notes for the 2.12.0 release.
    
    Let it ship!

commit b58a6a39c1568800938eb0e3ebc7664683b61200
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 23 23:56:44 2010 +0100

    uxa: Fallback to pixman if source is out-of-bounds
    
    If the source is outside the drawable, then CopyArea will fail to
    initialise the source correctly. The simplest fix in this case is to
    fallback to pixman to generate the source texture.
    
    Fixes:
    
      Bug 28497 - Graphics corruption after opening a specific website
      https://bugs.freedesktop.org/show_bug.cgi?id=28497
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6d33e578de4e23336ac69cc3c5d0935a65d4dda1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 23 21:28:50 2010 +0100

    Limit maximum tiled stride to 8k and untiled to 32k.
    
    Tiling on gen 2/3 hardware is only supported for pitches up to 8192
    bytes, so above this limit the surface will be untiled and we will no
    longer have to comply with the power-of-two pitch alignment. So
    disabling tiling for these too wide surface should ~halve the memory
    requirement for the full surface.
    
    Also the absolute limit for the 2D blitter is 32,768 bytes. The
    documentation says "up to 32,768 bytes" and my PineView box was
    malfunction with a surface stride of 32,768 so set the limit to be
    32,767.
    
    References:
    
      Bug 28497 - Graphics corruption after opening a specific website
      https://bugs.freedesktop.org/show_bug.cgi?id=28497
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5bf470bd38b1f6a7a540585186a54c9dbbca98f9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 22:28:58 2010 +0100

    i965: Compile fix.
    
    Oops, I spent more time discussing these flushing bugs than I spent
    paying attention to what I was actually doing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0203cf91b54ee8a7cea8560e559288ee9b6e8554
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 22:25:08 2010 +0100

    Do not clear need_mi_flush within the batch.
    
    This is a situation that should not be possible, need_mi_flush being
    true but the list of pending flush pixmaps being clear. However, an
    earlier bug in doing just that revealed this minor bug. So for
    correctness, be careful not to clear need_mi_flush without emitting a
    MI_FLUSH.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5107b6fa26ecfdbdd60b869a86765c9c484db3a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 22:21:58 2010 +0100

    i965: Mark the render target as dirty within composite_setup()
    
    The key difference between i965 and earlier, is that the surfaces passed
    to the samplers through an indirect table and so the batch and render
    target was not being marked dirty by the relocation (since the
    relocation only happens within prepare_composite() which may have been
    in another batch.) Simply call intel_pixmap_mark_dirty() when binding
    the sampler table into the batch to ensure that the dirty is tracked
    appropriately.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bebd64d82121d2b61893e1d0adebda03f4faea61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 22:05:19 2010 +0100

    Also submit any pending flush for *this* batch in the BlockHander.
    
    We still need to submit an additional flush if we have further writes
    since the last flush.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c4d200517755e6b0f48d6c6a6ba8dd0ddc883d8b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 21:57:21 2010 +0100

    Only append the pixmap to the flushing list if we are writing to it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c942585098ac84ae461821cbb8f52dedce7a0da1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 21 21:45:04 2010 +0100

    Emit the flush after a potential draw from the BlockHandler.
    
    As the batch submit may not trigger further drawing through flushing the
    vertices, pass the requirement to emit the flush down to the submission
    routine so that the flush can be appended after the final commands.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e8783869ad55d337601b6f6a51c02f6576c64f38
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 20 00:09:20 2010 +0100

    uxa: Apply the source offsets to the pixmap source, not target.
    
    A slight confusion in computing the correction image location resulted
    in the application of the source offsets to the pixel location in the
    target and not in the source as intended.
    
    Fixes the visual corruption of the scrollbar in Chromium, and hopefully
    the crash reported by Robert Hooker when starting gdm after plymouth.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4b7142baa0b3bf6f38843d06aadc579d8624cefc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 19 12:30:23 2010 +0100

    uxa: Enable SHM pixmaps
    
    Now with streaming uploads and downloads for composite operations in
    place, shared memory pixmaps are no longer that dire performance wise.
    With careful use these can in fact be the most efficient means of
    transfer between a wholly software renderer in the client and a backing
    store. For instance, Chromium renders internally to an ARGB32 image
    buffer and uses a shared pixmap to composite dirty regions into the
    backing store. Thereby using the GPU to either perform the blit or the
    format conversion. Enabling shared pixmaps, reduces our CPU overhead
    whilst scrolling by a factor of 5 or so.
    
    And this is achieved simply by deleting obsolete code!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d748f8e6fcebdf5b5b00c90b6c3d519560ee2928
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 17 18:29:55 2010 +0100

    uxa: Use accelerated get_image for copying to !offscreen
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 78ee25f005fac9e9cc85425aa3fca8c396d015ea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 17 18:37:32 2010 +0100

    uxa: Match depth 30 to format.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit af5c4fc96db56a14bf6347774d8e8f23b38c5967
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 19 13:36:20 2010 +0100

    uxa: Check for allocation failure.
    
    Check for the NULL Picture prior to passing it to the backends for
    inspection.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit be55066c6481b4c5e2cd39ef1c0f3be88cae0c93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 17 14:23:21 2010 +0100

    i830: Remove domain tracking from pixmaps.
    
    The 4 integers can be reduced to a single boolean value, so do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c187da9a24e98cbdf86f0f0dfbdcd9025c8a4c76
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 16 13:16:28 2010 +0100

    i830: GetImage acceleration.
    
    The presumption is that we wish to keep the target hot, so
    copy to a new bo and move that to the CPU in preference to
    causing ping-pong of the original.
    
    Also the gpu is much faster at detiling.
    
    Before (PineView):
     400000 trep @   0.1128 msec (  8860.0/sec): GetImage 10x10 square
      18000 trep @   1.3839 msec (   723.0/sec): GetImage 100x100 square
        800 trep @  30.0987 msec (    33.2/sec): GetImage 500x500 square
    
    After: (PineView)
     180000 trep @   0.1478 msec (  6770.0/sec): GetImage 10x10 square
      60000 trep @   0.4545 msec (  2200.0/sec): GetImage 100x100 square
       4000 trep @   8.0739 msec (   124.0/sec): GetImage 500x500 square
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0e0101758438debf98f989d815989b45e78cf5f6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 15 12:48:57 2010 +0100

    i830: Tidy i830_uxa_put_image()
    
    Use a single code path to upload the image data after selecting the
    right bo, and take advantage of pwrite() when possible.
    
    Fixes:
    
      Bug 28569 - [i965] IGN's flash-based video player crashes X
      https://bugs.freedesktop.org/show_bug.cgi?id=28569
    
      Bug 28573 - [i965] Fullscreen flash and windowed SDL games fail to
                  update the screen
      https://bugs.freedesktop.org/show_bug.cgi?id=28573
    
    Reported-and-tested-by: Brian Rogers <brian@xyzw.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2ff7a2fc9d939554502e9adec89cae5597a9e82c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 17 13:56:30 2010 +0100

    i915: Force the emission of BUF_INFO on every composite_setup
    
    We should be able to eliminate these as the drawable remains unchanged.
    However, the implicit flush of BUF_INFO fixes the rendering in KDE.
    Alternatively, we need an MI_FLUSH | INHIBIT_RENDER_CACHE_FLUSH between
    composites. (Note that it is not stale cache data causing the rendering
    corruption and that a pipelined flush is not sufficient either.) Also,
    having tried varies points at which to flush, the only place where the
    flush is effective seems to be between composite operations - that is a
    flush after 2D is not sufficient.
    
    Reported-by: Vasily Khoruzhick <anarsoul@gmail.com>
    Reported-by: Clemens Eisserer <linuxhippy@gmail.com>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a25573d5c47ebea34c076075e1993233d7db2b4f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 15 20:26:19 2010 +0100

    drmmode: Use the tiled stride for the rotated pixmap.
    
    After d41684d5459 we now allocate all framebuffers as tiled bo, and so
    we must be careful to use the appropriate stride as returned from the
    allocation, instead of assuming that it is just an aligned width.
    
    Fixes:
    
      Bug 28461 - screen rotation results in corrupted output.
      https://bugs.freedesktop.org/show_bug.cgi?id=28461
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reported-by: Till Matthiesen <entropy@everymail.net>

commit 23ddcf45344936da2931a3bf25bd187a9ea28344
Merge: 254bcc4 ffc6897
Author: Julien Cristau <jcristau@debian.org>
Date:   Tue Jun 15 17:46:52 2010 +0100

    Merge commit '2.11.901'

commit 254bcc40fca6ed9aa0b71f2115c654667f16aec6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 15 10:24:40 2010 +0100

    configure: Bump drm requirement to 2.4.21
    
    We depend upon the recent introduction of drm_intel_bo_is_reusable().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reported-by: Julien Cristau <jcristau@debian.org>

commit ffc689767fa56f2c7710e6f396441c3d8a24ea18
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 14 17:35:20 2010 -0700

    Update version to 2.11.901
    
    For the 2.12 RC1 snapshot we're making now.

commit 68c8b3f12482489f2e2e8040fd6728f1a2b9e420
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 14 17:34:38 2010 -0700

    NEWS: Add notes for 2.11.901
    
    This is the 2.12 RC1 snapshot we're making now.

commit 8899cd03e2e7ee673e8b3b2a9d2873839cdc1bf8
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Jun 10 15:38:54 2010 -0700

    Fix to require libdrm 2.4.19 or newer.
    
    This is necessary for the drm_intel_bo_emit_reloc_fence function which
    did not exist in 2.4.16 which is all we were requiring earlier.

commit 995a4b2b1d09c31672d9258a8ac732dcf9a8fe9f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 14 12:15:34 2010 +0100

    i965: Sanity check ComponentAlpha status in prepare_composite
    
    Fixes:
    
      Bug 28446 - Garbled Font with Mathematica 7
      https://bugs.freedesktop.org/show_bug.cgi?id=28446
    
    Rewriting the glyphs to render to the destination directly and removing
    the more expensive multiple invocations of CompositePicture per picture
    was a great performance boost -- except that it needs special handling
    in the backend in order to not fallback. Having done so for i915, I
    neglected to ensure the sanity checking in i965_prepare_composite() was
    sufficient. As it turns out, it was not and so we misrendered CA-glyphs
    when rendering directly to the destination. This causes us to fallback
    properly, but is a performance regression as we no longer try the 2-pass
    magic helper before resorting to s/w. At the moment, I'd rather live
    with the temporary regression and fix i965 to do the same magic as i915,
    as it critical to fixing the severe performance issues currently
    crippling i965, as I believe that this regression only affects the
    minority of applications (incorrect, as it turns out, as the glyphs are
    overlapping) rendering directly to the destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 84d65bace521ad80b9bede4ae9e3e2a8d0668b90
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 14 11:31:40 2010 +0100

    Compile fix for alternate list.h from xserver-1.9
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00a54eee8f29ced610ef9d65b077e64bc65655e9
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Sat Jun 12 20:24:10 2010 -0400

    COPYING: replace stub file with actual Copyright notices.
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 94217ed5f5a3726db3fad6cac2132d99ed45c154
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 12 17:21:44 2010 +0100

    uxa: Always clip glyphs to destination.
    
    Even if there is only a single clip rect, since the clip may be smaller
    than the drawing rectangle on the destination we need to actually
    compute the clipped glyph rectangle.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5a0a8a1cf6d9b0616d6a097e783f2aa318b45736
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Jun 10 22:56:34 2010 +0100

    i830: Limit disabling acceleration following EIO to !i965
    
    Following a conversation with Owain G. Ainsworth, it was decided that
    the second best approach to handling a wedged GPU was to hope that the
    kernel could successfully reset it, which currently is only possible for
    i965 and later chipsets.
    
    The best approach is of course to prevent such hangs from ever occurring
    in the first place.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bf4ca2cdc2493e209bbb9c597bfa17ed7fcf5dc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 9 12:02:21 2010 +0100

    i830: Only emit the disabling GPU error message once.
    
    But emit the warning about rendering corruption every time for the
    transient errors like out-of-memory.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 35a12f029005d8f432755fb78f10c9d48ea2f347
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 9 11:47:37 2010 +0100

    Fallback implementation for trapezoids for hung GPUs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8c1a8d22978f143044cc3cd0ff2ade5736ee9d48
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 9 10:03:08 2010 +0100

    Revert "xp:trapezoids"
    
    This reverts commit f429fb9d872950705e11171d0e7407fb7673c786.
    
    An experimental patch I forgot was on my main branch as I was bugfixing.
    ARGH!

commit 994aa1ef571ac2ab05f6588f9068d33b536c7a37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 9 09:59:36 2010 +0100

    uxa: Handle all-clipped out case with destination glyphs.
    
    Fixes the crash reported in:
    
      Bug 28446 - Garbled Font with Mathematica 7
      https://bugs.freedesktop.org/show_bug.cgi?id=28446
    
    pDst=0x3d663c0, src_x=0, src_y=0, xDst=142, yDst=112, nlist=0,
    list=0x7fffea026580, glyphs=0x7fffea025d88, extents=0x0)
        at uxa-glyphs.c:809
            dx = 0
            y1 = 101
            x2 = 150
            x1 = 142
            dy = 0
            y2 = 112
            rects = 0x5491000
            this_atlas = 0x2456d00
            mask_y = 128
            glyph = 0x35933a0
            mask_x = 736
            priv = 0x39309e0
            screen = 0x8d2cc0
            uxa_screen = 0x2443eb0
            src_pixmap = 0x37c29e0
            dst_pixmap = 0x45ddbf0
            localSrc = 0x361a450
            glyph_atlas = 0x2456d00
            x = 142
            y = 112
            n = 18
            nrect = -9975128
            box = {x1 = 23152, y1 = -5630, x2 = 32767, y2 = 0}
            __PRETTY_FUNCTION__ = "uxa_glyphs_to_dst"
    
    Though the meat of that bug regarding the incorrect remains unsolved.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f429fb9d872950705e11171d0e7407fb7673c786
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 8 10:24:51 2010 +0100

    xp:trapezoids

commit 0776a42b70f2de7b7d7d8804046c79442da1cb8a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 8 10:43:24 2010 +0100

    implicit-flush

commit d41684d54592cf93554a4d6534e7ea74562b1798
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 7 11:18:09 2010 -0700

    Allocate rotate shadow buffers using the usual framebuffer allocator.
    
    This means we can get tiling on them, which should significantly boost
    performance, and also allow for FBC.

commit b5c9de10ba3a811f312e622b97ee5e601bd3b74f
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Jun 6 23:41:23 2010 -0700

    Allocate a correctly sized framebuffer when tiling by using libdrm's support.
    
    When I made libdrm stop overallocating so much memory for the purpose
    of bo caching, things started scribbling on the bottom of my
    frontbuffer (and vice versa, leading to GPU hangs).  We had the usual
    mistake of size = tiled_pitch * height instead of size = tiled_pitch *
    tile_aligned_height.

commit e6acbc763229fd5b5b2cc1d65136404d02ac4655
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 18:04:51 2010 +0100

    uxa: Setup acceleration functions prior to the damage layer
    
    We need to install the acceleration functions so that they are wrapped
    by the Damage layer. This fixes the corruption under a compositing WM
    introduced in commit 8700673157fdd3a87ad5150f2f30823261fec519.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reported-and-tested-by: Arkadiusz Miśkiewicz <arekm@maven.pl>

commit 1788b16eb26580624dd3df96ed84f68d40e78ed7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 15:31:47 2010 +0100

    i915: Fix typo from previous commit.
    
    A trivial change, I thought, having tested it before rebasing, unworthy
    even of a perfunctory compile test. How wrong I was.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d9bc36ae03e3c56ab165d24fe4bdc6688fd62b6d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 15:28:18 2010 +0100

    i915: Remove screen size limit from video setup.
    
    The i915 textured video routine know how to handle drawing on an output
    larger than the 3D pipe, so allow them to do so.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6555ef5fd16c9e4fe733caf9e831f29f97462278
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 13:16:34 2010 +0100

    i915: Replace structure passing with macros for shader generation.
    
    gcc is horribly bad at collapsing the constants:
    
      text     data     bss     dec     hex filename
    282336     8720     256  291312   471f0 intel_drv.so.old
    269280     8720     256  278256   43ef0 intel_drv.so
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d56ea7a852d7090360fe080acec268de55ee908d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 00:20:35 2010 +0100

    Use the direct dixGevPrivate() API when available
    
    This is quicker and smaller than the old indirect function call to
    dixLookupPrivate().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8700673157fdd3a87ad5150f2f30823261fec519
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jun 7 00:16:18 2010 +0100

    Adapt glyphs for changes in devPrivates API
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 42ddc39430a10513c49a415ddf1a0dc5fa52089e
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Apr 30 13:33:54 2010 -0700

    Adapt to DevPrivate API changes
    
    This allows the driver to be built against either the old or new
    DevPrivate API.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 2c1fda08e889cad07acb452230da06f9c383d21c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 4 16:04:37 2010 -0700

    Use libc instead of deprecated libc wrappers for malloc/calloc/free.

commit b586624d4f2908d2a998ba87fe0ae31c10f46b91
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jun 6 17:11:40 2010 +0100

    uxa: Force fallback for copies.
    
    All but uxa_copy_window() perform the preliminary checks for whether
    acceleration is available. The simplest method for adding the fallback
    for uxa_copy_window() seems to be to add it in the core copy function,
    so be it.
    
    This allows X to survive a little longer once we encounter a GPU hang.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6db1e5231b7a0e79611f771d4efea686f7849e04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jun 2 20:43:49 2010 +0100

    dri: Protect against NULL dereference following GPU hang.
    
    References:
    
      Bug 28361 - "glresize" causes server segfault with single buffering.
      https://bugs.freedesktop.org/show_bug.cgi?id=28361
    
    [ 14528.767] (EE) intel(0): Failed to submit batch buffer, expect rendering corruption or even a frozen display: Input/output error.
    [ 14528.767] (EE) intel(0): Disabling acceleration.
    [ 14528.788] Backtrace:
    [ 14528.858] 0: /usr/bin/X (xorg_backtrace+0x28) [0x491818]
    [ 14528.858] 1: /usr/bin/X (0x400000+0x65ca9) [0x465ca9]
    [ 14528.858] 2: /lib/libpthread.so.0 (0x7f9df2dc9000+0xedf0) [0x7f9df2dd7df0]
    [ 14528.858] 3: /usr/local/lib/libdrm_intel.so.1 (drm_intel_bo_flink+0x0) [0x7f9defd60c60]
    [ 14528.858] 4: /usr/local/lib/xorg/modules/drivers/intel_drv.so (0x7f9deff6a000+0x2fdfd) [0x7f9deff99dfd]
    [ 14528.858] 5: /usr/lib/xorg/modules/extensions/libdri2.so (0x7f9df01b8000+0x19e7) [0x7f9df01b99e7]
    [ 14528.858] 6: /usr/lib/xorg/modules/extensions/libdri2.so (0x7f9df01b8000+0x1fdb) [0x7f9df01b9fdb]
    [ 14528.858] 7: /usr/lib/xorg/modules/extensions/libdri2.so (DRI2GetBuffersWithFormat+0x10) [0x7f9df01ba250]
    [ 14528.858] 8: /usr/lib/xorg/modules/extensions/libdri2.so (0x7f9df01b8000+0x3834) [0x7f9df01bb834]
    [ 14528.858] 9: /usr/bin/X (0x400000+0x2fc2c) [0x42fc2c]
    [ 14528.858] 10: /usr/bin/X (0x400000+0x24da5) [0x424da5]
    [ 14528.858] 11: /lib/libc.so.6 (__libc_start_main+0xe6) [0x7f9df1d60a26]
    [ 14528.858] 12: /usr/bin/X (0x400000+0x24959) [0x424959]
    [ 14528.858] Segmentation fault at address 0x20
    [ 14528.858] Fatal server error:
    [ 14528.858] Caught signal 11 (Segmentation fault). Server aborting
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2989f51caf3134460c2551de597e7e54fe74ee92
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 1 23:08:02 2010 +0100

    i830: Remove unused coord-adjust.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc402334f4e9b0de624bc89cd77eae4ec7cf1708
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 1 23:03:19 2010 +0100

    i915: Centre sampling.
    
    Use centre sampling of textures to match pixman, and remove numerous
    off-by-one and visual artefacts when rendering. The classic example for
    this is cairo/text/xcomposite-projection where the edge of the rotated
    rectangle is jaggy due to the incorrect sample position.
    
    Fixes:
    
      Bug 16917  - [i915] Blur on y-axis also when only x-axis is scaled
                   billiear
      https://bugs.freedesktop.org/show_bug.cgi?id=16917
    
    And about 15 tests from the Cairo test suite.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f74b3f82bab11463a0f4de9f614fc6aa1492ef24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jun 1 22:31:35 2010 +0100

    i915; Avoid the implicit flush on changing BUF_INFO
    
    3DSTATE_BUF_INFO is an implicit flush of the piepline, so avoid emitting
    that and associated state unless the destination pixmap has actually
    changed. This is a win of around 3-5% for cairo-perf-trace, notably for
    firefox.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f2272402035574c206a0e3383c55373c440fd928
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 1 13:46:15 2010 -0700

    DRI2: fix new buffer exchange check
    
    Chris's new buffer exchange check is a good one, but we don't want to
    hit the immediate blit fallback path if it fails.  We still want to
    schedule a blit for sometime in the future, and we need to use it
    wherever an exchange might occur (like the secondary flip check or the
    currently disabled CanExchange check).
    
    Fixes https://bugs.freedesktop.org/show_bug.cgi?id=28252.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit a386a003e7b0ff7100434dccd51fedd822454a6c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 31 22:18:43 2010 +0100

    uxa: Spans, try again to get the early break correct.
    
    Trigger happy bug fixing. The sign *was* right, the endpoint was wrong.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1672ee0421a99b745d65d72a3818de01d8100b6b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 31 22:08:43 2010 +0100

    uxa: Sign reversal on early break from spans passing the YXband
    
    Introduced with e5c971e7639095d38da3518a5dc404b708d45cfb.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd38b705be84901a38380dc2a1b90889b553d565
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 31 17:23:36 2010 +0100

    Disable acceleration if we detect a hardware error.
    
    This is wildly optimistic, but it should work in a surprising number of
    error situations and some output in those cases will be hopefully be
    better than none...
    
    If we submit a batchbuffer and the kernel reports the GPU is hung (which
    will be caused by an earlier execbuffer, and so the kernel should have
    had enough time to determine whether or not it could reset the GPU) then
    disable any further attempt to accelerate gfx and force fallbacks to map
    the buffers and use the CPU. We cannot normally map any more buffers if
    the GPU is hung, so only those already mapped prior to the hang can be
    written to, or those allocated in system memory. However, we can expect
    that the framebuffer is already mapped, and so have a reasonable
    expectation to continue to see the display update.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5fff430046db2030f89e49beb66c6476dc3fcd4c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 29 17:35:00 2010 +0100

    uxa: Mega-Glyphs!
    
    Rewrite glyph rendering to avoid the intermediate buffer, accumulating
    the glyph rectangles directly in the backend composite routines. And
    modify the glyph cache routines to fully utilise the allocated size of
    the tiled buffer on older hardware. To do this we alias all glyph sizes
    into the same texture using a technique suggested by Keith Packard.
    
    PineView:
      885/856-> 1150/1110 kglyph/s (aa/rgb)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d31abccd41c417338aac7c681e8bc6bd187b1843
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 31 12:14:23 2010 +0100

    i915: Support textured video on an extended desktop.
    
    Handle rendering textured video onto an extended desktop (>2048) by
    using a temporary pixmap. Note that we still cannot handle rendering to
    a greater than 2048 destination region, for that we will need to tile.
    Hmm, time to request a 2560x1600, 10bpc monitor...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cfd5bc134f0dd86ea714594d61f6d5eb29019ce
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 29 17:55:19 2010 +0100

    dri: Compilation fix.
    
    17:53 < arekm> ickle: i830_dri.c:630:28: error: ‘DrawableRec’ has no member named ‘bpp’
    17:53 < arekm> ickle: i830_dri.c:630:57: error: ‘DrawableRec’ has no member named ‘bpp’
    
    * sigh. I need to fix this machine to have the right version of the
    * headers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e2615cdeef078dbd2e834b68c437f098a92b941d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 29 16:37:12 2010 +0100

    dri: Only flip if the front and back pixmaps match.
    
    An unredirected window (thanks Michel for the reminder) is backed by the
    Screen pixmap, and so uses a reference of that as its front buffer. The
    back buffer is a pixmap appropriately sized for the drawable. When the
    application requests to swap its buffers, obviously we cannot simply
    exchange the front and back buffer as they do not match, but need to copy
    the appropriate region from the back to the front.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8b2039187fc23f5e9dddf4081f8b1ab6f4c01416
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 29 12:14:55 2010 +0100

    Revert "dri: Use size from backing pixmap when creating buffers."
    
    This reverts commit 44d45d3fa56f121ce89ffe5b28beb48be01a95df.
    
    Michel Dänzer pointed out the flaw in using the pixmap size instead of
    the drawable size:
    
      Using the backing pixmap dimensions for this is not desirable. In
      particular, it means that the DRI2 buffers of non-redirected windows
      always have the same size as the screen. But even for redirected windows
      it wastes some graphics memory with a re-parenting window manager, that
      is if it doesn't break in various ways due to the top left corner of the
      DRI2 buffers no longer corresponding to the top left corner of the window.

commit 44d45d3fa56f121ce89ffe5b28beb48be01a95df
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 29 10:39:28 2010 +0100

    dri: Use size from backing pixmap when creating buffers.
    
    This avoid using the garbage values stored in the Screen drawable,
    instead of the true values which are only maintained in its backing
    pixmap. The consequence of using the wrong size was to hand a 1x1
    pixmap to metacity/mutter and have it believe it was a full screen
    drawable; GPU hangs ensued if using page flipping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90c74a43149ec72bef64fb7e64b812294bda69a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 28 21:49:38 2010 +0100

    i915: Don't re-emit vertex size unless it has changed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a94ae175d6a69243a4465de0be0a8a3368e0ab28
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 28 12:40:02 2010 -0700

    uxa: Fix prepare_solid being called without check_solid first.
    
    Fixes GPU hang on gen6.

commit 66c90158e45e890c6f655195c6707d216c7ac4c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 28 17:13:30 2010 +0100

    uxa: Skip the redundant miComputeCompositeRects() when adding to the mask
    
    As we are in full control of the destination (the temporary glyph mask)
    and the source (the glyph cache) we know that there are no clip regions
    on either and so can skip computing the composite rectangles. (We trust
    the device clipping to prevent compositing outside the target.)
    
    x11perf on PineView:
    701/686 -> 881/856 kglyphs/s [aa/rgb]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b2254838eb89bf77eeb893c73eecb8c737822f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 28 12:47:26 2010 +0100

    uxa: Make the glyph caches' fixed size explicit.
    
    Until we actual resize the glyph cache dynamically, make it obvious to
    the reader and the compiler that the size is fixed.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 11581dda99cb2e4ae78fc73be4b02185b3be58ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 28 11:38:05 2010 +0100

    uxa: Use a glyph private rather than a hash table.
    
    Store the cache position directly on the glyph using a devPrivate rather
    than an through auxiliary hash table.
    
    x11perf on PineView:
    650/638 kglyphs/s -> 701/686 kglyphs/s [aa/rgb]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 73111cf2a212ee5cc2e03af1c600867df0c55b39
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 21:05:27 2010 +0100

    Decouple non-reusuable pixmaps from batch lists on unref.
    
    ==7596== Invalid write of size 4
    ==7596==    at 0x491ACA8: intel_batch_teardown (i830_batchbuffer.c:118)
    ==7596==    by 0x491C9D6: I830CloseScreen (i830_driver.c:1419)
    ==7596==    by 0x8103A9C: RRCloseScreen (randr.c:105)
    ==7596==    by 0x80DE794: xf86CrtcCloseScreen (xf86Crtc.c:759)
    ==7596==    by 0x80BEBA3: DGACloseScreen (xf86DGA.c:268)
    ==7596==    by 0x80D044B: DPMSClose (xf86DPMS.c:134)
    ==7596==    by 0x488B050: XvCloseScreen (xvmain.c:320)
    ==7596==    by 0x81841B1: VidModeClose (xf86VidMode.c:110)
    ==7596==    by 0x80EB12F: CursorCloseScreen (cursor.c:191)
    ==7596==    by 0x810CA17: AnimCurCloseScreen (animcur.c:108)
    ==7596==    by 0x816937E: compCloseScreen (compinit.c:86)
    ==7596==    by 0x48D39B9: glxCloseScreen (glxscreens.c:221)
    ==7596==  Address 0x49c1a50 is 24 bytes inside a block of size 52 free'd
    ==7596==    at 0x4024866: free (vg_replace_malloc.c:325)
    ==7596==    by 0x80B023C: Xfree (utils.c:1096)
    ==7596==    by 0x4927CFD: i830_set_pixmap_bo (i830_uxa.c:647)
    ==7596==    by 0x491C9B4: I830CloseScreen (i830_driver.c:1413)
    ==7596==    by 0x8103A9C: RRCloseScreen (randr.c:105)
    ==7596==    by 0x80DE794: xf86CrtcCloseScreen (xf86Crtc.c:759)
    ==7596==    by 0x80BEBA3: DGACloseScreen (xf86DGA.c:268)
    ==7596==    by 0x80D044B: DPMSClose (xf86DPMS.c:134)
    ==7596==    by 0x488B050: XvCloseScreen (xvmain.c:320)
    ==7596==    by 0x81841B1: VidModeClose (xf86VidMode.c:110)
    ==7596==    by 0x80EB12F: CursorCloseScreen (cursor.c:191)
    ==7596==    by 0x810CA17: AnimCurCloseScreen (animcur.c:108)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a6fb6aa5f9c1c81b8b81b9d1138a526ffbbd5ad3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 20:31:45 2010 +0100

    Add vertex bo to the list of buffers to be torn down.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5dce69002dd48dd6dce4f0e7ad9ecf2c4c17cfe4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 20:26:42 2010 +0100

    i965: Remove ATOMIC_BATCH.
    
    This paranoid check is deceased; pining for the fjords.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 06ebb55d308defbf8e01e30e4f994c2dd1071c40
Author: Eric Anholt <eric@anholt.net>
Date:   Sun May 23 20:33:47 2010 -0700

    Add a workaround for Ironlake errata relating to disabling the clipper.

commit 158a158dad26b6888dd2ebaf13e6020894475fcb
Author: Eric Anholt <eric@anholt.net>
Date:   Sun May 23 20:28:24 2010 -0700

    Add a workaround for Ironlake errata regarding blits and other engines.

commit 3461f8f4bc2a49fd41c408d225c592623404be91
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Apr 18 19:14:13 2010 -0700

    Remove remaining REG_DUMPER build stuff.

commit 03bbb4c896ef3cd275312b413a2c85d9f499c032
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 10:16:36 2010 +0100

    uxa: Perform manual damage for CompositeRects
    
    [xserver-1.8] The damage layer doesn't wrap CompositeRects, so we need to
    manually append the damaged region ourselves. This works for
    miCompsiteRects since that translates the call into multiple invocations
    of either PolyFillRectangle or Composite, which themselves cause damage.
    
    Fixes:
    
      Bug 28120 - Tint2's tooltip borders end up at 0,0 and do not disappear
      https://bugs.freedesktop.org/show_bug.cgi?id=28120
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b9ada52a3081f54e0ed094ac31188bb240866f81
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 10:14:52 2010 +0100

    uxa: Force the alpha value to 0xffff when treating Over as Src
    
    Since we have at most 8 bits of alpha, we treat >= 0xff00 as opaque.
    However, being paranoid we should set the alpha value to 0xfff in case
    something unexpected happens when converting from the xRenderColor to
    the pixel value.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3055d40164590147d35b5e7059ebe5f5858c85fa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 10:12:57 2010 +0100

    uxa: Use Composite rather than solid blitter for PolyRect
    
    Due to the relocation overhead, using a single composite with many
    rectangles outperforms many solid blits.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ec2437f958ec4f5ac5222b37cba4cd403b5c8855
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 10:12:18 2010 +0100

    uxa: Add PICT format mapping for depth 4 pixmaps.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 309bd3a29943ef7502d40c67be49c19a59b6d1a2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 26 10:11:32 2010 +0100

    i830: Skip an empty fill.
    
    In the extremely unlikely event that the higher layer erroneous gave us
    an empty fill, skip it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b645ec83e0d86f2247b8338ceab60b9502516e70
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 25 09:49:20 2010 +0100

    uxa: Apply the drawable offset to the solid rects
    
    Fixes:
    
      Bug 28120 - Tint2's tooltip borders end up at 0,0 and do not disappear
      https://bugs.freedesktop.org/show_bug.cgi?id=28120
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9d8ac271404ff219c3d40ae8f829e8b76ac7c359
Merge: 509df27 ea07535
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 21 11:01:30 2010 +0100

    Merge branch 'glyphs'
    
    Tweak glyphs to improve x11perf on i915 by about 33%.
    PineView, aa10text:  460 -> 617 kglyphs/s.
    PineView, rgb10text: 434 -> 610 kglyphs/s.
    
    Speedups
    ========
      xcb                    poppler    18.636 -> 13.958:  1.34x speedup
     xlib          firefox-talos-gfx    71.905 -> 56.232:  1.28x speedup
      xcb          firefox-talos-gfx    72.882 -> 57.969:  1.26x speedup
     xlib         gnome-terminal-vim    38.126 -> 34.472:  1.11x speedup
      xcb         gnome-terminal-vim    35.164 -> 32.573:  1.08x speedup
     xlib                    poppler    19.634 -> 18.246:  1.08x speedup
    
    Note the lack of significant improvement for firefox-planet-gnome.

commit ea07535240dafc4c6ef55b4b7a2eeaa595febe86
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 21 14:33:18 2010 +0100

    i915: Emit CA over using OutReverse + Add passes
    
    On PineView:
      578/621 -> 610/617 kglyphs/sec [rgb/aa]

commit 80a9e64f50aeda6004e3aba1fbfdda50bb1f1c82
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 21 09:55:55 2010 +0100

    uxa: Use temporary dest when target is too large for compositor
    
    If the destination cannot fit into the 3D pipeline when we need to
    composite, we fallback to doing the operation on the CPU. This is very
    slow, and quite easy to trigger on i915 by plugging in an external
    display.
    
    An alternative is to extract the extents of the operation from the
    destination using the blitter which can usually handle much larger
    operations. This gives us a temporary target that can fit into the 3D
    pipeline and thus be accelerated, before copying back into the larger
    real destination.
    
    For x11perf this boosts glyph rendering on PineView, from 38kglyphs/s to
    480kglyphs/s. Just a little shy of the native performance of 601kglyphs/s
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 91f560034fc2695680d1208a78fc56d814b0da79
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 20 10:26:59 2010 +0100

    uxa: Composite glyphs directly onto dst when possible.
    
    Without using a mask and compositing directly onto the destination,
    takes us from 580 kglyphs/s to 850 kglyphs/s on i945 [x11perf -aa10text].
    
    However, the extra intersection check almost entirely cancels out the
    speed up and we discover that the glyphs in x11perf are always
    overlapping. Nothing is ever easy.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e3ece83f577d3664962edeec6ab5bdc41c5d77cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 16:52:11 2010 +0100

    i915: compute normalized texcoords using a scale factor.
    
    500 -> 580kglyphs/s on i945.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c2abf8d659b8b161a4f9df100b614ee3c8f8e458
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 16:18:40 2010 +0100

    uxa: translate the region in line for composites
    
    When compositing, we need to convert the box into a rect and so the
    advantages of using REGION_TRANSLATE are lost.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2adf823b80b7b1f6df1bf3422a1219e93321a8fb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 15:02:58 2010 +0100

    i915: Add special case primitive emitters for glyphs.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f64ab9e0d97dd9c654b4ae1924e62ef6813d9bb0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 14:50:12 2010 +0100

    i915: Move vertices into a vertex buffer object.
    
    In theory this should allow us to pack far more operations into a single
    batch buffer, and reduce our overheads.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2b050f330f78d02e7f476e55be29d760271ac61c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 10:57:46 2010 +0100

    Use pwrite to upload the batch buffer
    
    By using pwrite() instead of dri_bo_map() we can write to the batch buffer
    through the GTT and not be forced to map it back into the CPU domain and
    out again, eliminating a double clflush.
    
    Measing x11perf text performance on PineView:
    
    Before:
    16000000 trep @   0.0020 msec (511000.0/sec): Char in 80-char aa line (Charter 10)
    16000000 trep @   0.0021 msec (480000.0/sec): Char in 80-char rgb line (Charter 10)
    After:
    16000000 trep @   0.0019 msec (532000.0/sec): Char in 80-char aa line (Charter 10)
    16000000 trep @   0.0020 msec (496000.0/sec): Char in 80-char rgb line (Charter 10)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dcef703a7cdcf360f12312a338361697acffc3e9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 19 09:30:02 2010 +0100

    Kill paranoid assertions on every write into the batchbuffer.
    
    On my PineView box these represent ~5% overhead on x11perf text:
    
    Before:
    16000000 trep @   0.0020 msec (495000.0/sec): Char in 80-char aa line (Charter 10)
    12000000 trep @   0.0022 msec (461000.0/sec): Char in 80-char rgb line (Charter 10)
    
    After:
    16000000 trep @   0.0020 msec (511000.0/sec): Char in 80-char aa line (Charter 10)
    16000000 trep @   0.0021 msec (480000.0/sec): Char in 80-char rgb line (Charter 10)
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit bc41f84e01f18548b05c670e1fd0d641adc28d0f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 18 23:54:13 2010 +0100

    i915: Emit composite primitive with specialised functions.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4a3476ea094e84887fefb558e0bba023fee34151
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 18 23:25:59 2010 +0100

    i915: amalgamate composite into a single primitive list
    
    Combine all the calls to composite between prepare_composite and
    done_composite into a single primitive list, rather than a primitive
    call per composite().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e5c971e7639095d38da3518a5dc404b708d45cfb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 18 22:16:17 2010 +0100

    uxa: Spans! OMG!
    
    Use composite rather than solid blits in order to bring performance on
    a par with the CPU when using GEM and relocations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 509df27c7401e96d3062890da73f6af6629adef4
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Tue May 18 10:01:52 2010 -0400

    dri: Clean up DRI2 API #ifdefs a bit
    
    Signed-off-by: Kristian Høgsberg <krh@bitplanet.net>

commit 5e04a81369dfc76bbc1ebbd4db00c23e71eb9e1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 17 15:16:25 2010 +0100

    i830: Remove vestigal debugging ALWAYS_FLUSH and ALWAYS_SYNC
    
    These are now debugging options exposed in Xorg.conf, and now unused int
    the source code.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 723cc45b2707aa160eac6d5b56a20e19cc42c8a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 17 15:14:55 2010 +0100

    dri: Check error code from GetScratchGC()
    
    It may fail so be prepared, and do use the right drawable!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c00297bc3b4969f28e2eb19bce36ece50ce4ccb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 16 19:15:37 2010 +0100

    uxa: Replace solid planemask [0xffffffff] with FB_ALLONES
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c69709d8afa6e9c0990efc463df0061536585e1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 16 18:41:52 2010 +0100

    i830: Encode surface bpp into format
    
    References:
    
      Bug 28135 - [855GM] Slowdown/High CPU-Usage after Git-Commit
                  926fbc7d90ac1d0d49d154f136f9c9ed613c98c2
      https://bugs.freedesktop.org/show_bug.cgi?id=28135
    
    The simple answer is that I had assumed that 0 was a reserved value.
    However, without the bbp encoded into the format 0 was used for a8r8g8b8
    and r5g6b5, which are very common formats!
    
    The other possibility for the slowdown is that gtkperf is using of the
    now verboten xrgb formats -- but would in fact be valid if the source
    covers the clip and we could fixup the alpha value in the fixed function
    combine.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21b5fd427f5ed6c99276349a7ae128eea580dd72
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 16 13:51:41 2010 +0100

    uxa: Tidy uxa_solid_rects()
    
    Move the operator reduction after a few fallbacks, closer to its use.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 61835701fd411d3bb550ceee3365e30639e46861
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun May 16 13:26:07 2010 +0100

    uxa: Patterns are acquired at 0,0
    
    Set the correct offset for the gradients patterns after rendering to a
    local Picture.
    
    Fixes cairo/test/huge-radial and friends
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 89f43f69a9c854fb2b82538a8938002675ca19e4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 18:34:54 2010 +0100

    uxa: Force an alpha channel when rendering source fallbacks
    
    As the source may not cover the extents, we need to represent those
    areas as transparent in the fallback picture, ergo we need an alpha
    channel. We could be smarter and force a format conversion when
    necessary, and we could let the backend choose the most appropriate
    format.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 524fd2dd0da8f69d4c3f5aebe3a345fe34af609d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 18:23:21 2010 +0100

    uxa: Apply clip for solid rectangles.
    
    References:
    
      Bug 28120 - Tint2's tooltip borders end up at 0,0 and do not disappear
      https://bugs.freedesktop.org/show_bug.cgi?id=28120
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 58b089febceca1e915607bb723ee658aaa9dbed3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 09:11:46 2010 +0100

    uxa: Avoid using blits when with PictFilterConvolution
    
    References:
    
      Bug 28098 Compiz renders shadows wrong, garbage line of pixels along left
                and top edge of windows
      https://bugs.freedesktop.org/show_bug.cgi?id=28098
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ef95899f5b21453daeabf81a3015b22456d21fec
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 09:02:07 2010 +0100

    uxa: Check the w-scaling component is 1 for an translation matrix
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c3da71349bcfeabae08f1572cf602c357bf7641
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 01:05:24 2010 +0100

    i830: Remove xrgb conversion to argb, no longer required.
    
    All textures are now properly declared so that the alpha swizzling
    occurs in the sampler or not at all. The downside is that for quite a
    few composite operations we have to fallback to software on older
    hardware. There is scope for more performing the alpha expansion in
    shaders or combiners when we know the picture covers the clip - which is
    almost all of the time for normal operations especially those
    constructed by Cairo.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 926fbc7d90ac1d0d49d154f136f9c9ed613c98c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 01:01:20 2010 +0100

    i830: Remove incorrectly mapped tex formats.
    
    We no longer workaround the lack of alpha expansion for xrgb textures as
    this interferes with EXTEND_NONE, though we could if we know the source
    covers the clip...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 95654cffa8643f61f153218f27e800df75b9bdee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 00:50:42 2010 +0100

    uxa: Fix order of conditionals to only run fill_region for SRC or opaque
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f67b45965b527699794ee21174809c5d71c03f22
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 00:50:20 2010 +0100

    uxa: Expand the range of compatible formats to cover all bpp.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 82d07fdf10cac2211af74ebf7d519daacd7084c0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 00:49:39 2010 +0100

    uxa: Only use 1x1R as a solid with an opaque format or SRC
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3bca186a7ead84d4f0e71dfd83847ef77a4e390b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 00:48:31 2010 +0100

    uxa: Call check_solid before running the solid blitter.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 213816c30b5ca6146e26ded85b2aa31ca16ca9bf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 15 00:47:55 2010 +0100

    i915: Load texture into directly into OC when possible.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 737de9a779d05fe6fb1efe1904fda2cc452ff137
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 23:48:27 2010 +0100

    uxa: Disable compatible src xrgb and dst argb
    
    I'm seeing garbage alpha for rendercheck blend:
    
      x8r8g8b8a 10x10 SRC ar8g8b8a
    
    so disable blitting until I work out if we can fast-path it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 271240fd477b11885947da32868bc77151681559
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 23:38:02 2010 +0100

    i915: Remove a couple of unsupported 16bpp no-alpha tex formats
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7c318d21c9035f6cab48c16e734b9ecb6f4b238
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 23:30:21 2010 +0100

    uxa: Parse BGRA pixel formats.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7bbcc492a05f0801c64ee884798cf1a7ebb71c2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 23:29:13 2010 +0100

    Split the prepare blitter functions into check + prepare.
    
    Allow us to check whether we can handle the operation using the blitter
    prior to doing any work.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4be8d7eb89e61ffb2ceb19f1f84260e581187692
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 21:13:21 2010 +0100

    i915: Don't force alpha=1 for RGB drawables in the shader.
    
    I was blindly fixing rendercheck without thinking. We need to force the
    alpha value to be in the blend unit and not before -- otherwise we
    generate the incorrect result whilst blending. D'oh.

commit b9a5e36f957e42eaf0387ad15f2298d3e9538b05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 20:52:48 2010 +0100

    uxa: enable solid rects for backends that require pixmaps
    
    Convert the color into a (cached) pixmap if the backend cannot handle
    the SolidFill natively.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a21297d7cc5945704d8cbd28ad0a2a3f6096fa47
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 17:51:42 2010 +0100

    drm: Remove pin(); unpin() sync
    
    GEM handles serialisation of the new front buffer with respect to page
    flipping and rendering and reports back when the flip is complete.
    Adding a sync point here is then redundant.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7ee73d2c6f373f3d6829cb1876b1940db62be452
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 17:51:20 2010 +0100

    drm: Remove unused old_front parameter from drmmode_do_pageflip.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 030d56279bf14d9ddd42d8fdbeaa66ef3f557b4d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 16:53:40 2010 +0100

    drm: don't overwrite the old intel->front_buffer
    
    It's now handled in the common ExchangeBuffers() path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5bd022739511104e4978bdfd2f4a1f60b9206723
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 15:47:09 2010 +0100

    i830: Teardown batch entries on reset.
    
    By not cleaning up the batch entries when resetting the X server, we left
    the pointers in an inconsistent state and caused X to crash.

commit 0d2392d44aae95d6b571d98f7ec323cf672a687f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri May 14 10:32:12 2010 +0100

    dri: Hold reference to buffers across swap
    
    As we schedule swaps for some time in the future and may process a
    detachment prior to receiving the vblank notification from the kernel,
    we need to hold a reference to the buffers for our swap event handler.
    
    Fixes:
      Bug 28080 - "glresize" causes X server segfault with indirect rendering.
      https://bugs.freedesktop.org/show_bug.cgi?id=28080
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8de09a0707ee1be1b919b979843711728618ef27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 17:15:28 2010 +0100

    uxa: Convert 1x1R back to solid_fill
    
    In the change to prevent blitting between incompatible sources, we also
    prevented 1x1R pixmaps from being used for solid fills. Reorder the
    sequence of conditions to enable this fast path again.

commit 92e9cf8af784b13c28030e38b15c8decf29e6a32
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 15:12:51 2010 +0100

    uxa: Only use solid_fill for SRC.

commit d1bd14e8b6754ba9f797642e1b33bf689e19417b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 15:11:16 2010 +0100

    uxa: Replace source for CLEAR with a transparent solid
    
    This means that we will hit the faster try_solid_fill path instead.

commit cdab72c405434ecbf7a79e402ff2d65d6a728179
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 15:12:32 2010 +0100

    uxa: Fallback early if compositing with alphaMaps

commit 25811dc7b7d1ad3fb01c31197d1ae1fe5b498975
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 15:09:28 2010 +0100

    i915: Force output alpha to 1. if dst has no alpha channel.
    
    Ensure that garbage is not stored in the unused alpha channel so that
    we can rely on it being currently initialiased when used as a source or
    returning via GetImage.
    
    Partial fix for rendercheck -t blend

commit 0e726b85ca6013ae9dc51391aaa309203352b61e
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu May 13 09:41:39 2010 +0100

    i915: Add a2r10g10b10 format and friends
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9f54107f866a25cf670f81f7c52b8c108728c6a5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 14:55:16 2010 +0100

    dri2: Handle reference counting across page flipping
    
    1. Instead of swapping bos, swap the entire private structure.
    
    2. If we update the pixmap bo for the Screen, make sure we update the
    reference inside intel->front_buffer so that xrandr still functions.
    
    Fixes:
    
      Bug 27922 - i965: Rapidly resizing OpenGL window causes GPU to hang.
      https://bugs.freedesktop.org/show_bug.cgi?id=27922
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6c27f6e4f76b97df71094acf25083b2922966b42
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 12:01:46 2010 +0100

    uxa: Avoid glyph ping-pong with !offscreen destination
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d5383c2073e181b9ec352461c05d6202ad37f9d6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 10:53:14 2010 +0100

    uxa: Avoid ping-pong with !offscreen destination and traps
    
    If we are destined to target an !offscreen drawable, then uploading the
    trapezoid mask to a bo is the last thing we actually want to do...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00664b8f9d3da8d0d6aa53471ed3a8a8f6391660
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 12:41:51 2010 +0100

    uxa: Fallback when compositing to a !offscreen destination
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0c6372a77fd8c051534c1b420a02a8737aa1dd01
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 09:57:27 2010 +0100

    i830: Prevent allocation of bo larger than half the aperture
    
    We need to prevent overcommitting the aperture, and in particular if we
    allocate a buffer larger than available space we will fail to mmap it in
    and rendering will fail. Trying to allocate multiple large buffers in
    the aperture, often the case when falling back, causes thrashes and
    eviction of useful buffers. So from the outset simply do not allocate a
    bo if the the required size is more than half the available aperture
    space.
    
    Fixes allocation failure in ocitymap.trace for instance.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 244b7cbfffdcda4761948eaa37ed2a30ca81f107
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 09:18:30 2010 +0100

    uxa: Use accelerated PutImage for uploading pixman images.
    
    Short-circuits the current use of PutImage from CopyArea, bypassing all
    the temporary allocations.

commit cb887cfc670bf63993bd313ff33927afb8198eae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 26 09:59:51 2010 +0000

    uxa: solid rects
    
    The cost of performing relocations outweigh the advantages of using the
    blitter for solids with lots of rectangles.
    
    References:
    
      Bug 22127 - [UXA] 50% performance regression for XRenderFillRectangles
      https://bugs.freedesktop.org/show_bug.cgi?id=22127
    
    By using the 3D pipeline we improve our performance by around 4x on
    i945, measured by the jxbench microbenchmark, and a factor of 10x by
    short-cutting to the 3D pipeline for blended rectangles.
    
    Before, on a i945GME:
      19982.412060 Ops/s; rects (!); 15x15
      9599.131693 Ops/s; rects (!); 75x75
      3803.654743 Ops/s; rects (!); 250x250
      6836.743772 Ops/s; rects blended; 15x15
      1443.750000 Ops/s; rects blended; 75x75
      495.335821 Ops/s; rects blended; 250x250
      23247.933884 Ops/s; rects composition (!); 15x15
      10993.073048 Ops/s; rects composition (!); 75x75
      3595.905172 Ops/s; rects composition (!); 250x250
    
    After:
      87271.145975 Ops/s; rects (!); 15x15
      32347.744361 Ops/s; rects (!); 75x75
      5884.177215 Ops/s; rects (!); 250x250
      73500.000000 Ops/s; rects blended; 15x15
      33580.882353 Ops/s; rects blended; 75x75
      5858.811749 Ops/s; rects blended; 250x250
      25582.317073 Ops/s; rects composition (!); 15x15
      6664.728682 Ops/s; rects composition (!); 75x75
      14965.909091 Ops/s; rects composition (!); 250x250 [suspicious]
    
    This has no impact on Cairo, but I have a suspicion from watching xtrace
    that Qt likes to blit thousands of 1x1 rectangles with the same colour.
    However, we are still around 2-3x slower than the reported figures for
    EXA!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c8e10f7791fecf0fed7ad606db062d87d8ff263c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed May 12 12:41:00 2010 +0100

    debug: Add names for operators
    
    Most useful for confirming my worst fears: unwarranted use of
    OutReverse + Add.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6ea8ce640fbc7e5054b521a6f70b303945d0e849
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 19:35:59 2010 +0100

    xvmc: Build fix with -pedantic
    
    Fixes:
    
      Bug 27352 - RPMLINT error causes build breakage
      https://bugs.freedesktop.org/show_bug.cgi?id=27352
    
    Reported-by: Johannes Obermayr <johannesobermayr@gmx.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e1b7e8bf1d475b3d00adcb96e6002c20c9e70d1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 15:50:23 2010 +0100

    drmmode: Reorder i830_set_pixmap_bo() so that the correct stride is used.
    
    The pitch needs to be set on the pixmap prior to the private
    intel_pixmap structure being created so that it can record the correct
    value from the pixmap.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dfbaf9aab80cf33d47148f087fa747eacd508b05
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 14:54:15 2010 +0100

    i830: Never create a bo for depth=1 pixmaps.
    
    As we can not accelerate these either as a destination or a source,
    don't bother allocating a buffer object for them.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5b7efe375ae951ffcdb2c81e2ad8a2ed86ffbdf2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 14:53:29 2010 +0100

    i830: Use set_pixmap_bo() instead of open-coding.
    
    The advantage is that this enables in-flight reuse of the old pixmap if
    possible.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad8af95dd35921118f45d6cff355c80cf0906ff0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 14:52:54 2010 +0100

    i830: Do not cache in-flight non-reusable buffers.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f1048e14d5ef34970cb717e2a37d1c6bb4ea3a34
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 11:39:46 2010 +0100

    i965: Add texformats mapping for additional pixman formats
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a35afd4a2df8bab543700d874274228eddccae5b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 11 11:26:33 2010 +0100

    uxa: Recheck texture after acquiring pattern.
    
    As the first step to handling unsupported texture formats, double check
    that the converted pattern can be used as a texture by the card.
    
    Fixes: rendercheck -t repeat
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d745cab6c45b9fce5e46eacbdd04ceae911fddbb
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 10 22:58:49 2010 -0700

    Must call ValidateGC in i830_uxa_put_image for scratch GC
    
    Always need to call ValidateGC or the scratch GC will not get the
    right composite clip.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 3eded4202ea00d42edf5edad831484ebc6c0c826
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 23:38:17 2010 +0100

    i915: Fix pixmap based masks.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1ecd89be039b642affb2f9933f4341d186cb4dea
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 23:33:52 2010 +0100

    uxa: Protect against valid SourcePict in uxa_acquire_mask()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8761585ef0b37736d302299d6b03e0957ad3e16
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 19:38:24 2010 +0100

    i830: Minor cleanup
    
    Remove some extraneous prototypes and unused variables.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9e9b0d85da801f1f95c7bc7e99566fe7056f5813
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 18:37:02 2010 +0100

    i830: Update stride when swapping bo for PutImage
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0d4dd00aeafdd625ffe902e26e666b63a0842adc
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 12:10:09 2010 +0100

    uxa,i915: Handle SourcePict through uxa_composite()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 21c1c3c7f6eb2b5070d2153b15a8fb1afe938bbb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 10:19:28 2010 +0100

    i915: Use 1x1R pixmap for solid drawables
    
      x11perf has a regression
      https://bugs.freedesktop.org/show_bug.cgi?id=25068
    
    caused by
    
      commit e581ceb7381e29ecc1a172597d258824f6a1d2d3
      i915: Use the color channels to pass along solid sources and masks.
    
    Do not convert 1x1R pixmaps into a solid color as the readback from the
    bo negates all the performances advantages of using a smaller vertex
    buffer and fewer samplers.
    
    Before (PineView):
      aa=66800 glyph/s, rgb=28800 glyphs/s
    
    Now:
      aa=96800 glyphs/s, rgb=48500 glyphs/s
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f52b6e832292c02c0010b19882e38e1097beeda0
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon May 10 09:39:44 2010 +0100

    uxa: Rearrange checking and preparing of composite textures.
    
      x11perf regression caused by 2D driver
      https://bugs.freedesktop.org/show_bug.cgi?id=28047
    
    caused by
    
      commit a7b800513fcc94e063dfd68d2f63b6bab7fae47d
      uxa: Extract sub-region from in-memory buffers.
    
    The issue is that as we extract the region prior to checking whether the
    composite can in fact be accelerated, we perform expensive surplus
    operations. This is particularly noticeable for ComponentAlpha text,
    such as rgb10text. The solution here is to rearrange the
    check_composite() prior to acquiring the sources, and only extracting
    the subregion if the render path can not actually handle the texture.
    
    Performance (on PineView):
    a7b800513^: aa=68600 glyphs/s, rgb=29900 glyphs/s
    a7b800513: aa=65700 glyphs/s, rgb=13200 glyphs/s
    now: aa=66800 glyph/s, rgb=28800 glyphs/s
    
    The residual lossage seems to be from the extra function call and
    dixPrivate lookups. Hmm. More warning is the extremely low performance,
    however the results are consistent so the improvement looks real...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 848ab66384508c3ad3e5fb4884e4527f3ebd3bde
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat May 8 18:36:55 2010 +0100

    uxa: Transform composites with a simple translation into a blit
    
    We can also convert a composite with an integer translation into a
    blit, so long as the sample extents remains within the source.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a7b800513fcc94e063dfd68d2f63b6bab7fae47d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 14 21:14:34 2010 +0100

    uxa: Extract sub-region from in-memory buffers.
    
    If the buffer is too large or not suitable for a GPU operation, we
    currently fallback and perform the composite on the CPU. An alternative
    is too extract the small region out of the source (as usually the
    sample extents are much smaller than the actual surface size) and try
    the composite with the new surface.
    
    The effect is particularly noticeable on pathological websites that use
    very large background images. For example, http://www.woodtv.com/ uses a
    1299x15000 pattern that is obscured by another opaque pattern.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8562b7bc6740eef2602af76b8685388efd2d4d37
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Apr 27 10:27:44 2010 +0100

    i830: prepare the uxa pixmap for fbCopyArea.
    
    Complete the prepare access for the PutImage fallback via fbCopyArea(),
    by remembering to set the private pointer to the GTT mapping.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a5cd65b593ea82e56e0c403f7ddcc2420a64dc3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 26 09:07:07 2010 +0100

    i830: if pixman_blt() fails fallback to fbCopyArea()
    
    On older versions of pixman, pixman_blt() can return false if the images
    are <= 8bpp. If we are being called from CopyArea, then we cannot return
    FALSE here as that will trigger an infinite recursion. Instead we must
    manually perform the fallback using fbCopyArea().
    
    Reported-by: Peter Clifton <pcjc2@cam.ac.uk>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 86d349aa7b0a596fbb9530e896c19349405bf3ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 26 09:12:54 2010 +0100

    i830: tidy in flight bo reuse.
    
    A left-over cleanup patch for c374c94. *sigh*
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 72fd7d191c33c8d0b75b06ab0717d7ca0d4e019a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Apr 19 21:56:57 2010 +0200

    Fix "make dist"
    
    This is some fallout from my xvmc cleanup.
    
    Original-Patch-by: Rico Tzschichholz <ricotz@t-online.de>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 9494f4e91f8c8c7a0f8d61c6883c9bfceb2cec46
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Fri Apr 16 22:24:01 2010 +0200

    i810: adjust the pitch for DRI rendering
    
    Current code forgot to adjust the pitch of the frontbuffer.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=16729

commit c374c94e41d6e7d677334171e3255778d77cbe18
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 31 11:50:27 2010 +0100

    uxa: Reuse in-flight bo
    
    When we need to allocate a new bo for use as a gpu target, first check
    if we can reuse a pixmap that has already been relocated into the
    aperture as a temporary target, for instance a glyph mask or a clip mask.
    
    Before:
    backend                      test   min(s) median(s) stddev.
    xlib         firefox-planet-gnome   50.568   50.873   0.30%
     xcb         firefox-planet-gnome   49.686   53.003   3.92%
    xlib                    evolution   40.115   40.131   0.86%
     xcb                    evolution   28.241   28.285   0.18%
    
    After:
    backend                      test   min(s) median(s) stddev.
    xlib         firefox-planet-gnome   47.759   48.233   0.80%
     xcb         firefox-planet-gnome   48.611   48.657   0.87%
    xlib                    evolution   38.954   38.991   0.05%
     xcb                    evolution   26.561   26.654   0.19%
    
    And even more dramatic improvements when using a font size larger than
    the maximum size of the glyph cache:
     xcb firefox-36-20090611:  1.79x speedup
    xlib firefox-36-20090611:  1.74x speedup
     xcb firefox-36-20090609:  1.62x speedup
    xlib firefox-36-20090609:  1.59x speedup
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 96aa7a236ac0605324a94f7b7d10413cb219f071
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 14 15:04:53 2010 +0100

    i830: Allocate bo's for glyphs larger than 32x32.
    
    As we only use the glyph cache for small glyphs, those large than 32x32
    will first be copied to a bo and used as a mask in a composite
    operation. We can avoid the allocation and upload per use by allocating
    a bo for the over-sized glyph from the start. As the glyph is large
    anyway, the excess memory allocation is less significant.
    
    Using normal font sizes, firefox shows no change - as expected. However,
    using the 36 font size traces, we see around a 10% improvement on g45.
    
    Before:
          xcb          firefox-36-20090609  127.333  127.897   0.22%
          xcb          firefox-36-20090611   87.456   88.624   0.66%
          xcb             firefox-20090601   19.522   20.194   1.69%
         xlib          firefox-36-20090609  201.054  201.780   0.18%
         xlib          firefox-36-20090611  133.468  133.717   0.09%
         xlib             firefox-20090601   23.740   23.975   0.49%
    
    With large glyphs in bo:
          xcb          firefox-36-20090609  117.256  118.254   0.42%
          xcb          firefox-36-20090611   79.462   79.962   0.31%
          xcb             firefox-20090601   19.658   20.024   0.92%
         xlib          firefox-36-20090609  185.645  188.202   0.68%
         xlib          firefox-36-20090611  123.592  124.940   0.54%
         xlib             firefox-20090601   23.917   24.098   0.38%
    
    Thanks to Owain G. Ainsworth for the suggestion!
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d17bd50af367bead84985c22fdd43d264a5f072
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 14 14:54:34 2010 +0100

    Revert "Revert "uxa: Try using put_image when copying from a memory buffer.""
    
    This reverts commit 6d50553e8f70d8f2142efdfd6c90bc27a599d0bc.
    
    Now we have taught the fallback path not to infinitely recurse,
    re-enable the accelerated path for ShmPutImage and friends.

commit 1cc2c2c44ac72460cf1c4e6bdc13c612235809c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 14 11:18:25 2010 +0100

    i830: Use pixman_blt directly for performing the in-memory copy
    
    In order to avoid an infinite recursion after enabling CopyArea to use
    the put_image acceleration to either stream a blit or to copy in-place,
    we cannot call CopyArea from put_image for the fallback path. Instead,
    we can simply call pixman_blt directly, which coincidentally is a tiny
    bit faster.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 324a2810da3fbae35637ba9080f31f9383db0868
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Apr 13 08:39:43 2010 +0200

    i830 render: check aperture space requirements
    
    No point not doing this.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 804263c10df2fedb2f0debab6cdfaa6a89184a42
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Apr 11 12:56:24 2010 +0200

    render: tell the kernel explicitly when fences are needed
    
    This slighlty improves xrender performance on fence reg starved
    i8xx hw.
    
    I've also changed a few function calls to the new names from the
    compat ones while looking at the code.
    
    The i915 textured video path is not converted because atm the xv
    code does not use tiled surfaces.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit a619a7831228dc52f0fef7d92c92f701e5aeaa94
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Apr 8 18:49:01 2010 +0200

    i915 render: use tiling bits where possible
    
    This is in preparation to explicit fence allocation with execbuf2.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 55cd36046e61e8d51b5cb754a81cdb54e3eab166
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Apr 8 14:48:35 2010 +0200

    i830 render: use tiling bits where possible
    
    This is in preparation to explicit fence allocation with execbuf2.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 6d50553e8f70d8f2142efdfd6c90bc27a599d0bc
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 12 13:44:31 2010 -0700

    Revert "uxa: Try using put_image when copying from a memory buffer."
    
    This reverts commit 27195d7dba0f3ff08b92f3fd916cdf5113cbef58.
    put_image often calls copy_area. Which calls put_image.  Exhausting of
    the stack follows.

commit 28024f6c5f351ce4cb3434998d5dbfbeded7c606
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Apr 12 13:44:01 2010 +0100

    Revert "uxa: Add fallback warnings for PutImage."
    
    This reverts commit 299b0338d0811192dc4f8eae5d79453e9882c5d1.
    A debugging patch, it was never intended to go into master

commit 27195d7dba0f3ff08b92f3fd916cdf5113cbef58
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 31 20:30:27 2010 +0100

    uxa: Try using put_image when copying from a memory buffer.
    
    Often, for example in the fallback for ShmPutImage, we will attempt to
    use uxa_copy_area() copying to a normal pixmap from a memory buffer.
    This triggers a fallback, and maps the destination pixmap back into the
    GTT. The accelerated put_image path will attempt to stream a blit to the
    destination pixmap if it is currently active, avoiding the stall.

commit 385563417d10b5e8a005bed6ae4de9a8fac1b407
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 30 21:10:50 2010 +0100

    Review i830_pad_drawable_width()
    
    We appear to have a confusion of stride in terms of pixels, pitch in
    terms of bytes and the actual width of the surface.
    i830_pad_drawable_width() appears to be operating aligning *pixels* to a
    64 pixel boundary and has never used the chars-per-pixel causing
    considerable confusion in its callers. Remove the parameter and ensure
    that the callers are expecting a value in pixels returned, multiplying
    by cpp where necessary to get the pitch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 299b0338d0811192dc4f8eae5d79453e9882c5d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 25 13:43:26 2010 +0000

    uxa: Add fallback warnings for PutImage.

commit 80f52482c7cde000a76b91fe3d8b6c16baf2141f
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Apr 8 22:30:33 2010 +0200

    XvMC: fix memory overflow
    
    Caught by a malloc library assert.
    
    Note to self: Don't just copy&paste codelines around :(
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Buzilla: https://bugs.freedesktop.org/show_bug.cgi?id=27540
    Tested-by: Nick Bowler <nbowler@draconx.ca>
    Tested-by: Calvin Walton <calvin.walton@gmail.com>

commit 3d7723526b181686d62f09f81fba3ccdbf7d2b1a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Apr 8 22:21:01 2010 +0200

    Xv: fixup overlay stride confusion
    
    For some reason I've made a mess out of the overlay stride constrains.
    Fix it up.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Tested-by: Calvin Walton <calvin.walton@gmail.com>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=27453

commit bdf0ee509c26ab35e60f3ed02549efa435be032f
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Apr 8 13:29:04 2010 +0200

    i965 Xv: fix chroma pitch
    
    In my recent fix for the chroma pitch for i915 xvmc I've forgotten about
    i965 class hw. For videos with a non-even sized stride (measured in dwords)
    the chroma pitch was internally incosistent and one dword off.
    
    Fix this by using pitch2 for the chroma pitch in i965 textured video like
    everywhere else.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=27417
    Tested-by: Nick Bowler <nbowler@draconx.ca>
    Tested-by: Sven Arvidsson <sa@whiz.se>

commit f6cb28e909c8685474e69e8bd8600f146d3a74e9
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Mar 11 15:37:54 2010 +0100

    libXvMC: rip out debug stuff
    
    Almost totatlly unused, but surely totally useless.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 676028ec0cbd4fadded92feefc8371e075abcc12
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 19:23:06 2010 +0100

    libXvMC: unify CreateSurface
    
    Simply store the desired bo size in intel_xvmc_context and initialize
    it in the driver's create_context function.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 3f590a4577f554313e7577205e471757a39129b6
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 19:04:51 2010 +0100

    libXvMC i915: kill unused context private fields
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 8a31dacb067f813a5b0eafc16d265434e48ec5fc
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 18:59:29 2010 +0100

    libXvMC: derive driver context from struct intel_xvmc_context
    
    ... by putting struct intel_xvmc_surface at the beginning. Also kill
    the common context handling code and simply keep a pointer in the
    surface private to the context.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 16e5edde4d97e1818e0dbfbc165bd8199f697336
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 16:51:10 2010 +0100

    libXvMC: unify DestroySurface
    
    Surface bo's can be freed by the common code, then there's nothing
    driver specific left.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 5f64122551f2d8d41d745351b2e4e68208aa6084
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 16:25:57 2010 +0100

    libXvMC: drop get_surface_status driver callback
    
    It's unused. Also drop all related generic code that tries to do
    clever stuff with this callback. These are all remnants from a
    pre-gem world.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 6c44ce9e127e531224bac825da7918800a3e6a1a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 16:20:03 2010 +0100

    libXvMC i915: s/i915XvMCSurface/struct intel_xvmc_surface/
    
    The private surface struct now adds nothing. Drop it.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 583ec1f2f7ed32bb42c98baa1ca0fc3735b69b11
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 15:55:44 2010 +0100

    libXvMC i915: rip out unneeded surface fields
    
    All of these are also stored in the context. Also kill the context
    reference counting. Doesn't serve a purpose besides occupying a
    pointer to the context in the private surface struct.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit c9aaaed829731cda22d057d6ac6424c587770973
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 15:27:02 2010 +0100

    libXvMC: unify PutSurface
    
    Now that the drm bo is in the common structure, do the PutImage
    handling in common code, too.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 4edff6c972311df2370a8323e346eeabd49ced35
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 15:13:41 2010 +0100

    libXvMC: move drm_intel_bo to common intel_xvmc_surface
    
    i965 lost the last field in it's private surface struct. Kill it
    and any associated headers.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 9eeabf876d1f70f5525bbac438414557dd2d4335
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 15:00:58 2010 +0100

    libXvMC: derive driver surfaces from struct intel_xvmc_surface
    
    ... by putting struct intel_xvmc_surface at the beginning. This
    will allow to consolidate surface and bo handling.
    
    Also kill some now dead code used to handle the common surface
    structure.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit a0058369bbdfb49f8df5ee1e50671115927d3565
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Mar 10 14:31:40 2010 +0100

    XvMC: kill intel_xvmc_command
    
    We only passed around and actually used the gem handle. Don't
    need a struct for one field alone ...
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 79fe4caafd21f6ca262901eac4a66ce5a4eaf548
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 16:20:33 2010 +0100

    XvMC: dynamically allocate adaptor
    
    And kill all the static structures. This way it's clearer what's
    common and what's specific. And the code is shorter too.
    
    Also clean up src/i830_hwmc.c - kill the nonstandard surface types
    for i915 and the associated code.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 00b63ecb192b7eafea9482bf5c5c5d442ce2c6fc
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 15:29:15 2010 +0100

    XvMC: directly set driver type in context creation
    
    Instead of threading it through a global variable.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 411cdcb6fcb60085191cf712aba1e0977f145256
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 15:23:02 2010 +0100

    XvMC: init driver in one function call
    
    No point splitting this up. Gets rid of two #ifdef INTEL_XVMC blocks
    in i830_video.c.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit b666e3e29f22894f43a8e9f7f3d1b950d431c42d
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 14:56:44 2010 +0100

    XvMC: move i965 specific stuff to common context
    
    Like for the i915. With this create_context is now also shared.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit e0068b1e63bc914940dbeb52de46657fcf5da1ea
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 14:44:53 2010 +0100

    XvMC: move i915 specific stuff to common context
    
    Doing the same with the i965 code will allow us to share the
    create_context function.
    
    src/i915_hwmc.h is now almost empty. Move the last #defines to
    src/xvmv/i915_xvmc.c where they are actually used and delete the
    file.
    
    Also rename the ddx context struct to something sane.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 8cab7b84da6d06c20ad9dbbcd8f3f3d971b438e7
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 9 14:02:23 2010 +0100

    XvMC: unify destroy context function
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 323464b8e2669423df573a18fd1137cb3cad6700
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 23:46:25 2010 +0100

    XvMC: clean up i830_hwmc.c
    
    - Drop unnecessary macros
    - Denote i965 specific stuff
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit cfa907adf800e91a3c1f4698ac701b9b83fa600b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 23:41:56 2010 +0100

    XvMC: unify surface functions
    
    Like for the subpicture stuff, share the "do-nothing" functions ...
    And fix function name spelling, too.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 036cd4bb82131c08b79f596667f00b19a0c8ab79
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 17:33:18 2010 +0100

    i965 XvMC: don't create any surface state in the ddx
    
    Like for i915. Also drop that now totally superflous limit on the
    available surfaces.
    
    Move the surface struct into the userspace library header now that
    the ddx doesn't use it anymore.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 69218cc1b51acfee91b471bb973a4419b79cdd85
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 17:05:25 2010 +0100

    XvMC: unify subpicture functions
    
    The XvMC driver api in the server is insane. Even for optional stuff
    like subpicture support it doesn't check for NULL-pointers. So we
    have to retain some dummy functions.
    
    Wonder how many copies of these things exist on fdo ...
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 5d104e9c5cd5cd2d34c9035dd38794fa9b5578f3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 17:03:36 2010 +0100

    XvMC: unify PutImage handling
    
    Both xvmc are handing in the bo in the exact same way. So move the code
    to src/i830_video.c and kill this great oeuvre of spaghetti-code.
    
    The xvmc driver ini and fini also lost their last use, kill them, too.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit ebc0ffba79cc4bd564a8bd97327f24a1d15b3d1a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 16:36:24 2010 +0100

    XvMC: merge *_hwmc.c into i830_hwmc.c
    
    After unifying i915 and i965, not much will be left of these files.
    Therefore merge them to make the following changes easier.
    
    This creates some warnings about some redefined macros, but when this
    is all cleaned up they'll all be gone.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 8199f8f191f8385ef3a228e0ec014a8bbd44002b
Author: Daniel Vetter <daniel@fliege.ffwll.ch>
Date:   Sun Mar 7 23:17:49 2010 +0100

    i915 XvMC: kill more subpict support remnants
    
    This things just won't die!
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 29ba8a84f7cf5c29a5f38688a1ac0ccf41d8e4ec
Author: Daniel Vetter <daniel@fliege.ffwll.ch>
Date:   Sun Mar 7 23:16:28 2010 +0100

    XvMC: everyone's using execbuffer!
    
    XvMC was switched over from batchbuffers a few years ago ...
    
    Signed-off-by: Daniel Vetter <daniel@fliege.ffwll.ch>

commit 440b4d207b730112169827d0b90b46596659b504
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 29 11:20:20 2010 -0700

    Increase version to 2.11.0
    
    In preparation for release.

commit 1119c4523889ddedecf1722f0e9a2e4a7ad326b2
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 29 11:19:31 2010 -0700

    NEWS: Add release notes for the 2.11.0 release.
    
    Hurrah! We made it.

commit df3b26847914557eb3c9c70732d91169b1936d77
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Mar 26 10:44:55 2010 -0700

    DRI2: release our private front buffer ref when buffer swapping
    
    Pauli pointed out that we take a ref on the front buffer when exchanging
    but forget to release it.  The ref is necessary since the set functions
    will drop refs as necessary, but once we set the front buffer to point
    at the back pixmap, we ned to release our private ref again, or we'll
    leak buffers.
    
    Reported-by: Pauli Nieminen <suokkos@gmail.com>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 362a49e71fc41541b6dc121660d98e29da4b14e8
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Thu Mar 25 10:07:41 2010 -0400

    uxa make: remove unused XORG_INCS and DIX_CFLAGS variables
    
    Most likely copied from xserver makefile.
    
    Acked-by: Dan Nicholson <dbn.lists@gmail.com>
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 0d1ac4da5288a621d0493cb109fcd1e040e6c5a7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 25 09:12:09 2010 +0000

    uxa: Perform the xrgb -> argb conversion not inplace
    
    After reports of segmentation faults caused by
    d6b7f96fde1add92fd11f5a75869ae6fc688bf77 and vmware, the most obvious
    cause would be illegally writing to the src data when performing the alpha
    fill inline. So force the image upload to go via a fresh buffer whenever
    we need to modify the incoming data.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reported-and-tested-by: Jeff Chua <jeff.chua.linux@gmail.com>

commit 0c47195ca805881e3fbd5b9224be5c930feeeb8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 24 17:37:39 2010 +0000

    i830: Clip solid fills to surface.
    
    There is a reasonable surfeit of evidence to support this error,
    for instance: http://bugs.freedesktop.org/attachment.cgi?id=34417
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5537079c29a56133446f1874d24d9e6516825edb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 24 14:59:20 2010 +0000

    uxa: After filling the alpha channel xrgb src is compatible with argb dst.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 90a971c60769781f53827b469a9be3aab14cf71c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 24 14:50:45 2010 +0000

    uxa: Only reduce a composite to a BLT if it is wholly contained
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2eec53d0b9232970fe3d03ce6c8940ebeea44bee
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Mar 23 17:28:22 2010 +0000

    uxa: Default to using TILING_X for pixmaps.
    
    On memory constrained hardware, tiling is vital for good performance as
    it minimizes cache misses.  The downside is that for older hardware
    (which often suffers from the lack of bandwidth) requires the use of
    fences for many operations, which are in short supply and so may cause
    shorter batchbuffers. However our batch buffers are typically short and
    so this is unlikely to be a concern and not affect the performance wins.
    
    A quick bit of testing suggests the effect is inconclusive on
    firefox/i945:
                      linear            tiled
      xcb             205.470           206.219
      xcb-render-0.0  404.704           388.413
      xlib            166.410           170.805
    
    A secondary effect of the patch is to workaround a G31 specific hang
    when attempting to use linear 2048x2048 surfaces. Bonus!
    
    Fixes:
      Bug 25375 - Performance issue using texture from pixmap (tfp) glx extension on 945
      http://bugs.freedesktop.org/show_bug.cgi?id=25375
    
      Bug 27100 - GPU Hung copying a 2048x1152 pixmap
      http://bugs.freedesktop.org/show_bug.cgi?id=27100
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: John <jvinla@gmail.com>

commit 9c037f61a490c96f9095f7ff3fecbf41f5efe9f7
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 22 15:23:04 2010 -0700

    Update version to 2.10.903
    
    For today's snapshot.

commit 11142cffe4bc81e1ce465ea725fcaef024130082
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 22 15:22:28 2010 -0700

    NEWS: Add notes for 2.10.903
    
    For today's snapshot.

commit f206816154fd44e61b0bdeaab1aa4c5359c3b70a
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 22 14:14:46 2010 -0700

    man: Update list of available 'sclaing mode' property values.
    
    Include the names from the current kernel driver along with accurate
    descriptions of each. Indicate how to use the values with:
    
    	xrandr --output output --set property value
    
    and point the user to "xrandr --prop" for an accurate list of
    currently available values.
    
    Closes bug:
    
    	xf86-video-intel manpage needs update for KMS xrandr properties
    	http://bugs.freedesktop.org/show_bug.cgi?id=25606

commit d1dfab6b1649214177435629d8e85239dbe44d89
Author: Matthias Hopf <mhopf@suse.de>
Date:   Wed Mar 17 15:13:51 2010 +0100

    Clear drmmode_output->mode_output in drmmode_output_destroy().

commit 10cd04a84bcb6313903fc23b2d7791658ebc6b8e
Author: Li Peng <peng.li@linux.intel.com>
Date:   Sat Mar 20 00:21:48 2010 +0800

    Initialize flip_count before using it
    
    Otherwise it would be a random value and drmmode_page_flip_handler()
    won't have a chance to call I830DRI2FlipEventHandler() and indicate
    a full page flip is complete.
    
    Signed-off-by: Li Peng <peng.li@intel.com>

commit 3d4b3f257fbbb69c6f236d9803abe54a90d7d434
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Mar 18 12:48:39 2010 +1000

    intel: free bus id in error path after printing it out.
    
    the error message prints out a freed string, spotted during
    code reappropriation to radeon driver.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 31d5f84bb4416ef92abd97264d52cdab7a184687
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Mar 17 09:11:05 2010 +0000

    i915: Correct preamble for emit_composite
    
    Fixes:
    http://bugs.freedesktop.org/show_bug.cgi?id=27123
    
    Fatal server error:
    i915_emit_composite_setup: ADVANCE_BATCH: under-used allocation 100/104
    
    Introduced with commit d6b7f96fde1add92fd11f5a75869ae6fc688bf77.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit d6b7f96fde1add92fd11f5a75869ae6fc688bf77
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Mar 6 15:49:04 2010 +0000

    Fill alpha on xrgb images.
    
    Do not try to fixup the alpha in the ff/shaders as this has the
    side-effect of overriding the alpha value of the border color, causing
    images to be padded with black rather than transparent. This can
    generate large and obnoxious visual artefacts.
    
    Fixes:
    
      Bug 17933 - x8r8g8b8 doesn't sample alpha=0 outside surface bounds
      http://bugs.freedesktop.org/show_bug.cgi?id=17933
    
    and many related cairo test suite failures.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 910fd171a00227025abc8bcc286a740f5bae895b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Mar 5 14:32:13 2010 +0000

    i830: Remove coord-adjust for nearest centre-sampling.
    
    Fixes a number of cairo test suite failures.
    
    Also affects:
      Bug 16917 - Blur on y-axis also when only x-axis is scaled bilinear
      http://bugs.freedesktop.org/show_bug.cgi?id=16917
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 753914acc31947df8e9f2fa3b9c39de745098709
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 15 17:32:57 2010 -0700

    Bump version to 2.10.902
    
    For the imminent 2.10.902 snapshot release.

commit 185196cb010cb8426ca929a9dc3f028ec9b383db
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Mar 15 17:32:20 2010 -0700

    NEWS: Add notes for the 2.10.902 snapshot.
    
    Which I'm about to push out.

commit 318aa9ed799197810e2039dbe3ec51559dcc888c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 8 23:22:53 2010 +0100

    i915 XvMC: fixup colors
    
    My cleanup accidently created a inconsistency in the YUV plane ordering.
    I think we can safely assume that I'm colorblind ;)
    
    As Carl Worth rightly pointed out, this change deserves a more elaborate
    explanation:
    
    For Xv planar formats, the three planes are stored consecutively in
    memory, ordered Y U V. Now for some totally odd reason (= none at all),
    i915 xvmc stored it in Y V U order. Right after the release of 2.10, with
    commit "Xv: consolidate xmvc passthrough handling" I've inadvertently
    broken xvmc support (which started this whole odyssey into xvmc). When
    fixing stuff up, I neglected this special plane ordering and simply
    assumed it to be the same as Xv and dropped that special case for i915 in
    src/i830_video.c. This patch completes the change to standard YUV plane
    ordering by making the corresponding change in src/xvmc/i915_xvmc.c.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 68629b63740fb6e62c258b8a46669e77660fa4e4
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 8 15:42:39 2010 -0800

    DRI2: make WaitMSC error handling more consistent with ScheduleSwap
    
    Just make it mirror ScheduleSwap: complete the wait on any error
    condition so as not to crash the client if the kernel is misbehaving.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 6df74e61afb7831ebf3fbab8782f46ddccbe262b
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 8 15:33:20 2010 -0800

    DRI2: truncate OML values to 32 bits
    
    We can only handle 32 bit values unless we totally virtualize the count,
    since the kernel only handles 32 bits itself.  Rather than adding all
    that overhead, just tolerate the occasional missed event everytime the
    counter runs over.
    
    Reported-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit c66d57080dc034aa7877f47612065e388bbc38a2
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 8 15:26:24 2010 -0800

    DRI2: more WaitMSC fixes
    
    A couple more niggles: make sure we return a target_msc that at least
    matches the current count; this is a little more friendly to clients
    that missed an event.  Also check for >= when calculating the remainder
    so we'll catch the *next* vblank event when the calculation is
    satisfied, rather than the current one as might happen at times.
    
    Reported-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 7845c6ade82085488192bd76729d92fb7b534cc0
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 8 15:19:14 2010 -0800

    DRI2: fixup stray curly brace
    
    Got left in the wrong column after the last cleanup.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 9656d329e4df28cfe138b657d04e5136bc794ce2
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 8 14:34:04 2010 -0800

    Put back the pitch alignment for new framebuffers.
    
    I confused a dead assignment with dead code, because one of the args
    to the function was an outvalue.  Fixes corruption under compiz.
    
    Bug #26814.

commit b71ca26a026a356763c51c763bcdd8024fc4a783
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 8 11:27:42 2010 -0800

    DRI2: fixup ScheduleWaitMSC similarly to ScheduleSwap
    
    My merge of Mario's patch for this was botched.  Fix it up so that OML
    waits work correctly, and remove a bogus warning from ScheduleSwap.
    
    Reported-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 06b54e089eb21736e6d4f6462bbfca987be0c5cc
Author: Matt Turner <mattst88@gmail.com>
Date:   Sun Mar 7 14:27:27 2010 -0500

    Don't check for Xinerama.
    
    It doesn't seem to be used anywhere, so don't require it.
    
    CC: Eric Anholt <eric@anholt.net>
    CC: Jesse Barnes <jbarnes@virtuousgeek.org>
    Signed-off-by: Matt Turner <mattst88@gmail.com>

commit 8ece6cf5afa1bb0d8d9328696422f42f3c3adbd6
Author: Robert Hooker <sarvatt@ubuntu.com>
Date:   Sat Mar 6 14:09:12 2010 -0500

    Fix build against xserver 1.6 branch.
    
    Signed-off-by: Robert Hooker <sarvatt@ubuntu.com>
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1cd556420277f103c47ade422f3ec8f8efb2d282
Author: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
Date:   Fri Mar 5 12:32:18 2010 -0800

    DRI2: handle target_msc, divisor and remainder properly in DRI2ScheduleSwap
    
    The current code in I830DRI2ScheduleSwap() only schedules the correct
    vblank events for the case divisor == 0, i.e., the simple
    glXSwapBuffers() case.
    
    In a glXSwapBuffersMscOML() request, divisor can be > 0, which would go
    wrong.
    
    This modified code should handle target_msc, divisor, remainder and the
    different cases defined in the OML_sync_control extension correctly for
    the divisor > 0 case.
    
    It also tries to make sure that the effective framecount of swap
    satisfies all constraints, taking the 1 frame delay in pageflipping mode
    and possible delays in blitting/exchange mode due to
    DRM_VBLANK_NEXTONMISS into account.
    
    The swap_interval logic in the X-Servers DRI2SwapBuffers() call expects
    the returned swap_target from the DDX to be reasonably accurate,
    otherwise implementation of swap_interval for the glXSwapBuffers() as
    defined in the SGI_swap_interval extension may become unreliable.
    
    For non-pageflipped mode, the returned swap_target is always correct due
    to the adjustments done by drmWaitVBlank(), as DRM_VBLANK_NEXTONMISS is
    set.
    
    In pageflipped mode, DRM_VBLANK_NEXTONMISS can't be used without severe
    impact on performance, so the code in I830DRI2ScheduleSwap() must make
    manual adjustments to the returned vbl.reply.sequence number.
    
    This patch adds the needed adjustments.
    
    Signed-off-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>

commit 13119ffc034a3e9d6c76339d4fedc62bb3b41257
Author: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>
Date:   Fri Mar 5 11:33:45 2010 -0800

    DRI2: make MSC waits handle specific target_mscs and divisor/remainders
    
    Previous code only handled divisor == 0 case correctly. This should
    honor a given target_msc for the divisor > 0 case and handle the
    (msc % divisor) == remainder constraint correctly.
    
    Signed-off-by: Mario Kleiner <mario.kleiner@tuebingen.mpg.de>

commit b6e0b92f398823629ba8a1ea8f5e62fbf959e725
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Mar 4 10:07:26 2010 -0800

    DRI2: handle offscreen drawables better at swap time
    
    If a drawable isn't visible due to DPMS or redirection, we'll just blit
    it rather than schedule a swap event.  However, we didn't reset the
    target_msc, so the swap target we receive from the server could get out
    of sync with the vblank count of the drawable's display.  So at DPMS on
    time, the swap target would be the last good vblank count plus some
    large number (since the swaps won't have been throttled).
    
    Solve this by zeroing out the swap target like we should when we fall
    back to a blit.  Also make the kernel error cases more friendly by
    making them fall back to blits too.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 54ac4e2df987b72529a523ffbde357bec27e3658
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Mar 4 21:34:52 2010 +0000

    Rate limit batch buffer error.
    
    Once we hit this error it's unlikely that we're coming back - so don't
    flood the logs with redundant information.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 066d9b64ee243e0d255d7e12c2134951eef4ade7
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Mar 4 20:50:20 2010 +0100

    i915 XvMC: kill dead code
    
    This kills one wip remnant from my i830_memory cleanup and the last
    remainings of the subpicture support.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 7b7c724da97f358f5d2d4d4dae75cfc85bde2c62
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 10:29:09 2010 -0800

    Remove remaining fbOffset setting.
    
    In the long long ago, fbOffset was used for DGA.  The server now has
    only one reference to fbOffset, a leftover setting of it in fbdevhw.
    We can safely ignore it now, which is good since we weren't updating
    it in other places where the front buffer offset could change.

commit 15026d64d3c0d8ad96e0a73fcae3103d1c41fd46
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 10:28:09 2010 -0800

    Remove a piece of fbOffset cruft from non-DRM support.

commit e8e615289213ba1704e402b923c51ce9d196f06f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 10:27:51 2010 -0800

    Remove i830_allocate_2d_memory() now that it only called one function.

commit e37b562083aa3293e0c009171724a3f122d8a32d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 10:23:12 2010 -0800

    Init CRTC cursors with CRTC setup instead of i830_memory.

commit a36bdaba6136054ae7c67943ca0215cfd177bc5b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 09:47:10 2010 -0800

    Remove intel_sync() at teardown time.
    
    The kernel's still running after we're gone.  This didn't matter.

commit 4ada6d7a856a941b834871ff8a7c5505ff26ae23
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 09:32:42 2010 -0800

    Remove 3D state clobber on EnterVT, and always clobber at batch start.
    
    We know that it's clobbered at each batchbuffer, anyway.  And even if
    this server isn't running DRI2, it can still be clobbered at batch
    start in the KMS world.

commit d92d42303e5ca9f4208ed97823ad8f691121370f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 09:31:56 2010 -0800

    Remove pre-2.6.29 error message handling since we require KMS.

commit faecd155c49229499e29815eb6e79662ed33ddd5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 4 09:31:15 2010 -0800

    Move batch and 965 render state setup/teardown to screen init/close.
    
    Whether we're VT switched or not shouldn't impact rendering.

commit 74e2b69a317cc728b00e675c18d2976987407aec
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Mar 4 09:51:03 2010 -0800

    i915_hwmc: Remove dead code.
    
    Daniel recently identified this code as unneeded (with an #if 0).
    Here we take the next step and remove it entirely.

commit 1cc35a8ba403ad95b67caff46b803db1edea5ad3
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Mar 4 09:46:33 2010 -0800

    uxa: Fix type mismatch to avoid compiler warning.
    
    The code was using uint32_t where an XID (currently an unsigned long)
    was specified in the prototype. Use XID to avoid both the warning and
    any potential problem.

commit 1d6537ec57535183638c62e3099bc79786c682ca
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Mar 4 09:39:28 2010 -0800

    i830_video: Remove unused variable.
    
    Certainly just a little leftover from the recent rewrites.

commit 57c0043b9a519da5c9af29019ef632716782bda2
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:33 2010 +0100

    Xv: fixup relocation in i965_video.c
    
    The previous code made no sense, (multiplying an offset by 4 is
    meaningless). It could have onlt worked with the offset being
    fortuitously 0.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit e606be463f6359fd017791a8d4d85059831a5d41
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:28 2010 +0100

    i830_memory: rip out the remainings of the old allocator
    
    Yeah!
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 371be65fb74789250dbb1e332e46416d931da321
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:27 2010 +0100

    XvMC: kill the pinned batchbuffer in the ddx code
    
    It's been unused for quite a while.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit d5a20c81ab76129a1e0bcefecd9c4a10b5040af4
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:26 2010 +0100

    i915 XvMC: kill pinned surface buffer in the ddx code
    
    Like with the per context stuff, also drop the now artificial limit
    on surfaces. Again, with that gone, a lot of code can be deleted.
    
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit e6eb257ad32b393fb67c506943d8ece98b9a8061
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:25 2010 +0100

    i915 XvMC: kill pinned per-context buffers in the ddx code
    
    There's now not a reason anymore to limit the number of active contexts.
    So kill this accounting, too.
    
    With that all gone, per-context state in the ddx is nil, so rip out
    all associated code.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 47ae1181f6cfd2ab64cd5c8535289fdaa2a9fd9c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:24 2010 +0100

    i915 XvMC: don't stall the cpu anymore
    
    Proper bo management ensures that the cpu doesn't step on buffers
    used by the gpu. Drop the now unnecessary synchronization.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 9bba123c5f0f081562306c152e70221fc5041a3b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:23 2010 +0100

    i915 XvMC: drop superflous MI_FLUSH
    
    Cache coherency is now fully under the control of gem.
    
    For lack of hw documentation, I had to find out the correct cache
    placements by trial and error:
    
    Backward and forward surfaces: I915_GEM_DOMAIN_RENDER
    Correlation data:              I915_GEM_DOMAIN_SAMPLER
    
    Changing any of them leads to visual corruptions, so I think these
    are the correct ones.
    
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit b11623f20e303ae1d90d4a6bf0d5d73970b4e9bf
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:22 2010 +0100

    i915 XvMC: switch surfaces to drm_intel_bo
    
    Now the last user of the fixed buffers provided by the ddx is gone!
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit b7f79bfd40db3ed17d7a79750d007b57d7ed157a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:21 2010 +0100

    i915 XvMC: switch corrdata buffer to drm_intel_bo
    
    It works!
    
    v2: Correlation data needs to be in the render cache!
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 62846d88d41f1bbbd16a6e700ca611656fa20f61
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:20 2010 +0100

    i915 XvMC: switch msb to drm_intel_bo
    
    Like for the static indirect state buffer.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit d27955c697e1768559957da8d61087644befd285
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:19 2010 +0100

    i915 XvMC: switch sis to drm_intel_bo
    
    I've decided to allocate a new buffer for every render command, to
    prevent stalling for the gpu. libdrm bo reuse should take care of
    not wasting memory in case the buffer is not busy.
    
    Also always emit the full state, it's not worth it to complicate
    the code over a few stores to wc memory.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 3203c66fbf04c55adba760e97c9fa1feb9e55f8d
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:18 2010 +0100

    i915 XvMC: switch load_indirect_render_emit to batchbuffer macros
    
    Like with one_time_state_emit, this preps for relocatable bo's.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit d30decae6a9db585f2d2589ae2c3d9e1f9acd33d
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:17 2010 +0100

    i915 XvMC: switch psc to drm_intel_bo
    
    Like with the sampler state buffer.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit b543c355f4fdcb64deb198765d9b8b86f7c234c2
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:16 2010 +0100

    i915 XvMC: switch psp to drm_intel_bo
    
    Like with the sampler state buffer.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 18c364084ce5495ffdfea38c17c1297d555c6c54
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:15 2010 +0100

    i915 XvMC: switch ssb to drm_intel_bo
    
    This also starts to kill the last remnants of the support for
    physical addresses for the indirect state buffers. With gem this
    would need kernel support (in the form of a new reloc type in
    execbuf2).
    
    This does not change the ABI between ddx and client libIntelXvMC.
    I've decided to do this in one swoop when all the buffer rework is
    done.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit fc9e44f01910eb9fd43def9b2ac531b0742d8b4e
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:14 2010 +0100

    i915 XvMC: kill last_flip and last_render
    
    Seems to be a remnant from i810 XvMC support. last_flip is always 0,
    so serves no real purpose anymore. Kill it and the associated code.
    
    With last_flip gone, last_render also lost its purpose. Kill it, too.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 04aa38a639fefcd00acb485f36ab18c2083ed1bb
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:13 2010 +0100

    i915 XvMC: switch one_time_state_emit to batchbuffer macros
    
    This is in preparation for real relocatable drm_bo's instead
    of memory at a fixed address. By switching to the batchbuffer
    macros (like i965 xvmc) we can use the nice OUT_RELOC macro.
    
    Also align the code more with coding-style elsewhere, i.e. bitops
    instead of bitfield structures. The bitfield structures are
    quite a mess to work with the batchbuffer macros, so they were
    getting in the way, anyway.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 24d787335a0c319b8d9243ea1f2726575cf73b2b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:12 2010 +0100

    XvMC: kill dead code in i915_xvmc.c
    
    WIP code that hasn't changed for over two years is unlikely to
    suddenly start progressing. Drop it. After all, git can easily
    resurect it in cases it's needed.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 13266b152ae35ed54984844e3282cbdf20dc2e32
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 21:53:11 2010 +0100

    XvMC: kill i830_memory in 965 class xvmc
    
    Yes, this breaks binary compat of the struct passed around between
    X ddx and the client libXvMC. But we always ship both, so they should
    not get out of sync.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit d39d822cf887a861b37cee92c0b59533370ded2f
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:44 2010 +0100

    i830_memory: hide as much of the old memory allocator as possible
    
    The only user left of this stuff is the xvmc support.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 65267d4bfbf19942beab72858333c6ee3c719223
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:43 2010 +0100

    i830_memory: switch frontbuffer to drm_intel_bo
    
    Yet another user of i830_memory gone for good.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 06f147dc04629a8a1534703be570e7f25e41cdd9
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:42 2010 +0100

    i830_memory: switch cursors to drm_intel_bo
    
    Minus one user of i830_memory, some more to go.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 23d12e3b088f38d25e83d6501d553d98be442d49
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:41 2010 +0100

    i830_memory: kill field "pitch"
    
    Totally unused.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 2fb8feeb56fae364380ffd91749eeb69fb461cff
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:40 2010 +0100

    i830_memory: rip out field "size"
    
    Use the one in the drm bo instead.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 4d4d763b3d96e2cac99a0b7b03ad9bcaf4465c61
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:39 2010 +0100

    i830_memory: kill field "tiling_mode"
    
    Totally unused.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit d0800d098739d5e8ea94be9c5ed2f7a8a86c06dc
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:38 2010 +0100

    i830_memory: no memory allocations without a bo!
    
    Kill the corresponding !bo path in i830_free_memory.
    
    Also kill another remnant of the pre-kms era in the same file, while I
    was looking at the code.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 086c0e25cac1d3dd0a37def8b5cb82c1c6279edf
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:37 2010 +0100

    i830_memory: rename i830_bind_all_memory to reflect code reality
    
    It doesn't bind anything anymore, but does a few random things.
    Give it a hopefully vague enough name to cover all cases ;)
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 2a989aa057cee74154419fd0a4911ba1e95582cf
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:36 2010 +0100

    i830_memory: rip out the old video memory allocator
    
    Besides the debug stuff the went away in the previous patch,
    this stuff was totally unused ...
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit bf83b9a10254966cb73b24e08954154d4296dac3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:35 2010 +0100

    i830_memory: kill i830_desribe_allocations
    
    Totally useless debug function from the pre-gem era. No point
    to occasionally spam Xorg.log with a bogus "No memory allocations"
    message.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit ff8a1e1cf728eeae848f6284bb4272193dfa918b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:34 2010 +0100

    i830_memory: rip out field "offset"
    
    Use the one in the drm bo instead.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit e18ffceb142a9e18968900dd526a2d50fab72900
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Mar 2 09:22:32 2010 +0100

    i830_memory: rip out field "end"
    
    It's a left-over from the non-gem era and no longer used at all.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Eric Anholt <eric@anholt.net>

commit 5018fd3097d77a5f31af4cb27e39daa37557b64e
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 1 22:57:40 2010 +0100

    libIntelXvMC: kill ums leftovers
    
    On i965 class hw, kernel_exec_fencing was 1 always, anyway. And on
    i945, this patch kills a memory leak (dunno how, but it does).
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit cb06aa32d433f54affe87da2cf964f0308d3c258
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 1 22:57:39 2010 +0100

    Xv: fixup XvMC on i915
    
    I've accidentally broken i915 xvmc due to alignment constrains that
    break my assumption that Y-pitch == UV-pitch*2. Fix this up by consistenly
    using dstPitch2 for the Y-pitch. This also unifies the dst pitch
    computation slightly, now that the i915 xvmc special case is gone.
    
    Bugzilla: http://bugs.freedesktop.org/show_bug.cgi?id=25949
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    
    (Minor edit to support compilation without INTEL_XVMC defined by
    Carl Worth <cworth@cworth.org>)

commit 80f2a1f3b5e477a12899ea2251aebcfa62689943
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Mar 1 22:57:38 2010 +0100

    Xv: fixup YUV plane offset for xvmc case
    
    In my previous cleanup I've inadvertedly dropped the offset adjustment
    code for the xvmc passthrough case. Fix this up.
    
    Also reimplement that ugly hack I've accidently killed to keep i915 class
    xvmc a tad bit longer on life support.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Tested-by: xunx.fang@intel.com

commit a0ee9c3d9c72962c8d513ec8c43dd4a21e316947
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Feb 26 17:05:45 2010 -0800

    Update version number to 2.10.901
    
    In order to make a new snapshot.

commit 63b8e890a134e5fc8242b655115491a3905ad0ff
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Feb 26 17:05:06 2010 -0800

    NEWS: Add notes for the 2.10.901 snapshot.
    
    From skimming the git lot since 2.10.0.

commit d5409303128f5c9ba940ab564ff407a82eabc597
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Feb 26 16:12:50 2010 -0800

    Remove dead code: fill_detailed_lvds_block
    
    All callers of this function were recently removed, so it can join
    them in the bit bucket.

commit 7d0e6ff4dadcf243b1006ce6f85bd06c5f4e4908
Author: Adam Jackson <ajax@redhat.com>
Date:   Wed Dec 2 12:05:52 2009 -0500

    kms: Fix LVDS mode list construction.
    
    Rather than mangle the EDID block and hope the server does the right
    thing, just build a sensible mode list up front.  Do this for LVDS where
    there is no EDID or where it does not claim to be continuous-frequency
    (since in the latter case, the server will add reasonable modes for us).
    
    Signed-off-by: Adam Jackson <ajax@redhat.com>

commit 1730af4437530ab7f6fe6ca74b16efb4a843b3ae
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Feb 25 17:12:49 2010 -0800

    NEWS: Fix typo (we just released 2.10 *not* 1.10)
    
    Sigh. Every version number that must be typed manually will eventually
    be typed incorrectly at some release. (I think that's Owne Taylor's
    Law)

commit 529bf185fbcb9f7705b315a5106054ee25c1c77f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 24 17:54:13 2010 -0800

    In frame event handling, track drawable id instead of drawable pointer.
    
    Windows aren't refcounted, so if the event came in after the window
    was destroyed, we'd dereference garbage and segfault.

commit 633c7033170b0e9b468dbee444b94922f6c30940
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 24 17:40:30 2010 -0800

    Fix up a bunch of inconsistent 4-space indentation in i830_dri.c

commit 9291828a569a01ed4a6ef71f530b93f8a54c84aa
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jan 15 12:51:50 2010 -0800

    Add new mobile Sandybridge PCI IDs.

commit 3c71f98b9e5262675e61fafb317d0c35e62a873f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 22 16:55:02 2009 -0700

    Add initial defines and probing for Sandybridge

commit c2c670ef18755cf5c878edf8a6b7d1617f54fe73
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:54:48 2010 -0500

    Remove more DRI1 dead code.

commit b320449f75adf912e06832dacc0b861ce26353bd
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:44:11 2010 -0500

    Remove dead i830_ring.h.

commit 6d48b26098691d772a8de001c89a05b2442ef3b5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:27:55 2010 -0500

    Remove dead i830_display.h.

commit 4126f73051aa73defcf342c81aa0fc9062f83f90
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:25:47 2010 -0500

    Remove dead i830_bios.h.

commit ca173c1eaf0e28f7fa138b1965f5e768b3add895
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:24:00 2010 -0500

    Remove the last tool now that it's been moved to gpu_tools.

commit 6da7cda5830817b0c977ed4767a9432748f12b09
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:21:47 2010 -0500

    Remove swf_dumper.  We have intel_mmio_read in gpu_tools to do this.

commit 71c613c8475909e58fc491131bf9c10f4b047b16
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:20:33 2010 -0500

    Remove bios_reader now that it's moved to gpu_tools.

commit 7ada4eb3836f58a72f1c5b6b8139030fab9b7d63
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:18:23 2010 -0500

    Remove intel_hotplug tool now that it won't work with KMS.
    
    We'd want to put something like it in sysfs or something if we wanted
    this tool to exist again.

commit 3284aacfe095f6260eee5ed126685d0638626a29
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:14:12 2010 -0500

    Remove dead i830_bios.c.
    
    Things that used it are now either in the kernel or stashed off in
    gpu_tools.

commit 761d386a940081688b9b599c7a5b0270abfc5138
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:13:25 2010 -0500

    Remove intel_gtt and intel_lid now that they're in gpu_tools.

commit 6199af00cb47df6347ecd72ff7f6c86a564cec57
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:06:18 2010 -0500

    Remove xprintf.c from the old "I can't believe it's not an X Server" tools.

commit cba8e3136a100ba274f48c78df5b23fa8960fa16
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:04:51 2010 -0500

    Remove intel_statuspage, now that we have /debug/dri/0/i915_gem_hws

commit 40f5f72e30003993bfe298cd634d4f3f56148d4a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:01:30 2010 -0500

    Remove dead main.c from reg_dumper/

commit 0c5e4a65f5d0f8d41c6bcb4c6978054f40064494
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 12:00:56 2010 -0500

    Delete the audio dumping tool now that it lives in gpu_tools.

commit 6bdab841766c8d9febaa23cb01a7bbc9edfae471
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 11:21:40 2010 -0500

    uxa: Skip adjusting mask coordinates when no mask is present.
    
    Quiets clang warnings about garbage variable usage.

commit a86869e6c3131b83a2ad529bc313270a9f45f5bd
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 08:15:30 2010 -0800

    Fix an unused variable warning for !INTEL_XVMC.

commit ec5deb2bcbf828c3c47488eb77461c26cab38ed6
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 08:11:00 2010 -0800

    Remove dead assignments noticed by clang.

commit a4180eabfa00c256494ed09aa336a17605c49a8a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 08:10:17 2010 -0800

    Remove stale junk in VideoRam setup, noticed by clang.

commit 03657d4a698e0a25ab3863a15ad4c8b9d64dbb9a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 19 08:03:44 2010 -0800

    Remove dead UMS CRTC resize code.

commit 1c3aaad09d6ef207fba748ad4ef4575a26ab2e5c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Feb 17 17:48:32 2010 +0000

    dri2: Silence the compiler for an unused function with proto < 4
    
    Move the unused function into the #if DRI2INFOREC_VERSION >= 4 block.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00e7312dc45e54cd4547a943897a524639cb0b38
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Feb 11 09:46:12 2010 -0800

    DRI2: handle full height blits without tearing in CopyRegion
    
    On 965 and up, if we detect a full height blit, we should just wait for
    vblank, rather than try to do a scanline wait for the whole display.
    
    On pre-965, doing a scanline wait followed by a blit works, but in the
    full height case we need to give the blitter time to start up, so we
    wait until the bottom line of the blit minus 2 padding scanlines to
    accommodate.
    
    Fixes FDO bug #22475.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit f0d760bfd71e2b2b40d2b250cd84b4626492ba47
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Feb 10 11:24:46 2010 -0800

    Disable bo reuse on shadow framebuffer
    
    This keeps us from trying to set tiling on it while pinned, which also
    keeps us from trying to unpin it in the kernel, causing an error.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 41784e15d39c29af5a87fe8d0982bd1b0be3562d
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Fri Jan 29 15:54:16 2010 -0500

    config: remove dead LINUXDOC macro usage
    
    This module does not generate LINUXDOC documentation.
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 6610bcbac51c9ac970128012f0d4566d8cfba000
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Feb 5 17:18:50 2010 -0800

    DRI2: only use version 4 APIs if kernel support exists
    
    Check for page flipping support before enabling flip and vblank event
    support needed for the new DRI2 APIs.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 1a76fa5574e8e8f88ac3518a4e4494e1af301dc1
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jan 29 23:28:46 2010 -0800

    Initialize DRI2 info rec version 4 list of driver names
    
    With DRI2 supporting multiple subsystems, the video driver must
    initialize the list of driver names instead of just passing the single
    driver name used by Mesa. Without this, the X server will fail to
    initialize DRI2 as the numDrivers field in this structure will be
    uninitialized.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 918151a7955c26174db80b775205f6ffb4f44ab6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Jan 27 20:33:08 2010 +0000

    uxa: Fix compatible_formats() for OVER
    
    In separating the boolean logic out into a separate function, dc6522dd,
    I reversed the sense of one particular test:
    
      src->format == dst->format
    
    The OVER optimisation is only valid if the src and dst formats match,
    but not always.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 197cb08a2d54cabbfe97454d7db85cfe1f5f27ba
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 25 15:15:04 2010 +0000

    Extract pixel value for all formats to avoid hitting fallbacks.
    
    On failing to extract the pixel value for an alpha-only solid we
    actually triggered a fallback. Since this path is commonly hitting
    whilst fading in images, for example cairo_paint_with_alpha(), the
    fallback was detected during the Moblin boot sequence where it was
    adding a second to the overall boot time.
    
    See
      fallback intel: Moblin startup is hitting a composite fallback, costing
                      a ton of performance
      https://bugs.freedesktop.org/show_bug.cgi?id=26189
    
    Based on the initial patch by Arjan van de Van.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5f93d019dc6311dd16b6792ffb60dbfc45ef3d08
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Jan 25 15:47:11 2010 +0000

    uxa: Adjust uxa_get_color_for_pixmap to match prototype
    
    The prototype says this function returns a Bool and not just an int, so
    be pedantic and return TRUE/FALSE.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dc6522dd491831f3843606e3ed57cc01fe2c804c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 24 09:37:23 2010 +0000

    uxa: Protect against a potential NULL src->Drawable reference
    
    One of the convoluted if branches dereferenced Drawable when it is
    potentially NULL. Avoid this by explicitly handling the NULL Drawable
    cases earlier, and enabling solid fills for solid sources.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 31bbd7f919f4f1f545dd49861c15e60561c075cb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 24 09:04:16 2010 +0000

    uxa/uxa-render: Always remove useless repeats during composite.
    
    I added a jump if there was no src or mask Drawable, but we do actually
    need to check for useless src repeats even if we have a source-only
    mask.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 326fe00df4160fbc3513ddbedfec90bdb2d7101b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Jan 24 09:02:05 2010 +0000

    uxa: Increase amount of composite fallback verbage
    
    The fallback log for http://bugs.freedesktop.org/show_bug.cgi?id=26189
    does not actually state the reason why we actually fallback. This is
    possibly because we need to fallback for reasons other than the
    operation cannot be performed in hardware -- such as using an alpha map
    or the screen is swapped out, so add this information to the fallback
    log.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 93cd943d41c646c794b8cb5a960d8f0805e15395
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jan 15 12:53:47 2010 -0800

    intel: Use the compositing-aware colorkey filler instead of homebrew fail.
    
    Of course, it's still fail since you can't correctly composite
    colorkey overlay, but at least this doesn't spam colorkey to the root
    window.
    
    Tested-by: Daniel Vetter <daniel@ffwll.ch>

commit 6e61de896b42cffe1af6b0384cb69265d3d121a1
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Fri Jan 15 15:51:28 2010 -0800

    Update Sun license notices to current X.Org standard form
    
    Signed-off-by: Alan Coopersmith <alan.coopersmith@sun.com>

commit 96f45c66eed2631eba98ae416c3afdf540fa5c34
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Jan 13 13:20:43 2010 -0500

    DRI2: if the swap condition is satisfied, complete it immediately
    
    If we get to the point where we check the divisor/remainder equation and
    it's satisfied, we should complete the swap immediately.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 51c75906329a4727e37c8d1f64f257ea9602caa2
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri May 1 14:52:26 2009 -0700

    DRI2: support new DRI2 APIs
    
    The new interfaces allow for improved buffer swap, and support for the
    SGI_swap_control, SGI_video_sync and OML_sync_control GLX extensions.
    
    The Intel implementation allows page flipping to occur for swaps that
    are full screen and not rotated.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 4902f546be19e3d5bb47f6c75e2199dc4856c0f4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 13 10:44:12 2009 +0000

    i965: Ensure that URB_FENCE is aligned to 64-bytes
    
    The PRM (Vol 1, p32) specifies that the URB_FENCE command must not cross
    a cache-line boundary (64-bytes) in order to workaround a silicon issue.
    Ensure that it does not by inserting an alignment point before the atomic
    section.
    
    This is a slightly too large hammer, but the easiest method to work with
    the current BEGIN_BATCH/ADVANCE_BATCH protections.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 83626aba357ffb4dd7931daaf163c1dd1d08f9d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 21:39:41 2009 +0000

    uxa-glyphs: Enable TILING_X on glyph caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 50e07da8094c8c8c593b6eb8c41fc42444851d04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 13 09:35:36 2009 +0000

    i830: Do not use vtSema when chosing mapping type.
    
    The mapping type to use is determined by the tiling of the underlying
    object, not by whether or not not we control the vt. This was a
    left-over wart that was intended to mean that we had GEM and so could
    use GTT mappings.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7a2b7cfab5cdef277f0feb838683422d9fcb0db3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Dec 13 09:33:45 2009 +0000

    Consolidate determining maximum sizes for use with GEM
    
    Add a small wrapper function so that the callsites need only call the
    single function when checking the available aperture size for
    determining the maximum viable size for operations. This will allow us
    to easily extend this set in the future by only needing to adding the
    check to a single location.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 229d23fb18d696fb7ad476ce335be14ec9811bd3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:34 2009 +0100

    Xv: don't enable XVMC port on unsupported configs
    
    This just makes it _really_ clear, what's supported. No other changes.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit ce7ba18f577cc9aedddaff303dbc9662a276b4cf
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:33 2009 +0100

    Xv: consolidate xmvc passthrough handling
    
    It's now all in I830PutImageTextured. Also kill some leftovers
    from XVMC-on-overlay support and ums-XVMC-on-i915 support. Plus
    a small comment as a reminder for where to add i915 xvmc support
    back in.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 1ac7c94083a3266e2d5dd932709118436074dd00
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:32 2009 +0100

    Xv: hide ugly semantics in i830_clip_video_helper
    
    I'm still curious as to why fixed-point semantics are necessary
    for this generic XV helper function that's been causing all this.
    Can modern X really run on hw without floating-point support?
    
    Anyway, the ugliness is now all nicely under the carpet (in
    i830_clip_video_helper).
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 31f13fa8a0d4cd28067de37d0d31d23e8200d0ff
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:31 2009 +0100

    Xv: move users of x1, x2, y1, y2 to PutImage
    
    After this there are no other external users of these strange variables,
    so we can nicely hide them somewhere in the next changeset.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit ce6526b9b4df304ccd83a0a02a95621300dbaed3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:30 2009 +0100

    Xv: kill unnecessary parameters for hw PutImage functions
    
    This is the first part of my small crusade to rip out x1, x2, y1, y2
    from I830PutImage*. These variables have strange semantics (they
    change from simple integers to fixed-point values somewhere in
    the middle) and don't really seem to be what we actually need.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit cf74caaa91667457bba3583b216dfc157d09f39e
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:29 2009 +0100

    Xv: kill an unnecessary if
    
    We always pass a non-null pointer for crtc_ret, no point to check
    for this.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit d8353c737b5b8077f499461b1e6c78f09544d226
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 1 14:32:28 2009 +0100

    Xv: split up I830PutImage into textured and !textured case
    
    This wasn't making much sense anymore, and further cleanups will
    make this even more apparent. This change just makes two copies of
    I830PutImage and kills the not-applicable if-clauses in both
    versions.
    
    There is one small functional change in here: The textured video
    path doesn't munch around with adaptor_priv->videoStatus anymore,
    which is only used by the overlay. This could prevent the overlay
    from being switched off if someone would use textured video at the
    same time.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 091035146463bf1aa6674bff6947d04fc620c18f
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jan 4 14:20:11 2010 -0800

    configure.ac: Bump version to 2.10.0.
    
    In preparation for the 2.10.0 release.

commit 01f7d0307b3f5f085e383ff85026757de9cda359
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jan 4 14:19:17 2010 -0800

    NEWS: Add final release notes for the 2.10.0 release.
    
    Mentioning that it's functionally identical to our most recent release
    candidate.

commit e966bca3a9143cff37beb54359bea13c9f693b44
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Dec 29 21:49:49 2009 -0800

    Take note for Pineview support in README and manpage
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 6137791e9f1a4778afabbbc06de3da68648ae258
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jan 4 14:08:24 2010 -0800

    man page: Remove section describing BACKLIGHT_CONTROL property.
    
    This apparently no longer exists in a KMS world, so remove it from the
    documentation.

commit 7f36a439249cc2101d8985de5e95af652e5b984b
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jan 4 14:07:24 2010 -0800

    man page: Rename PANEL_FITTING to "scaling mode".
    
    The old UMS name was PANEL_FITTING while the new KMS name is "scaling mode".
    
    Fixes bug #25606.

commit a6fb71e6e26fb31f4cd10fad2d3a87d9114a649a
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jan 4 14:05:27 2010 -0800

    man page: Add additional indentation for some output configuration options.
    
    The BACKLIGHT_CONTROL and PANEL_FITTING options appear in a list, and
    then each contain a sub-list of sub-options. Use indentation to make
    this structure more apparent to the reader.

commit 25a6c8dfae240143309b14cc32ebac6008c3a378
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Tue Dec 15 21:46:48 2009 -0500

    configure.ac: use backticks rather than $() for cmd subs
    
    Use "$PKG_CONFIG" rather than hard coded "pkg-config"
    
    Acked-by: Dan Nicholson <dbn.lists@gmail.com>
    Acked-by: Daniel Stone <daniel@fooishbar.org>
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 2c142e421e859406b5aff16ba18624150269fc06
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Dec 10 15:25:44 2009 -0800

    Update version to 2.9.99.902.
    
    For the second release-candidate snapshot in preparation for 2.10.

commit 8ecf70ea553083cbc26928dc3973c8f6f8b3d9d0
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Dec 10 15:17:57 2009 -0800

    NEWS: Add notes for 2.9.99.902 (and preliminary notes for 2.10)
    
    This comes from my cursory glance over the commit log from 2.9.1
    to master.

commit 88b2209a7526a7c7f3b3a2d491d48bd0d5d56e04
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Dec 10 14:52:46 2009 -0800

    Document the DebugFlushBatches, DebugFlushCaches, and DebugWait options.
    
    These were added in 3c0815abf28744e215bea286e71d935cd486955a . The
    documentation added here comes straight from that commit message.

commit 8d6faf7dc546bda64e11bf6dea7f3c997f07f887
Author: Tobias Doerffel <tobias.doerffel@gmail.com>
Date:   Wed Dec 9 09:57:20 2009 +0100

    Fix compiler warning in i830_copy_video_data() if XvMC is disabled
    
    The variable "intel" is unused when building i830_video.c without XvMC
    support which results in a compiler warning:
    
      i830_video.c: In function 'i830_copy_video_data':
      i830_video.c:1443: warning: unused variable `intel'
    
    Trivial fix via #ifdef.

commit bd81734465912d79d6320a6fb021ce43d258b906
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Dec 8 15:27:41 2009 +0100

    Xv: enable drmmode overlay
    
    Now that libdrm 2.4.16 is released (and already required) we can
    unconditionally enable this.
    
    Please add something like this to the release-notes/NEWS file:
    
    * Overlay support for kernel modesetting. This needs at least kernel
      v2.6.33 to work. A backport to 2.6.32 is available at:
    
      http://gitorious.org/daniel-s-linux-stuff/linux-kernel/commits/intel-kms-overlay-for-2.6.32
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 37f631d669c165c4fb56ccd7a6fc0a432f453b52
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Dec 10 08:50:16 2009 +0000

    Revert "uxa-glyphs: Enable TILING_X on glyph caches."
    
    This reverts commit 3f11bbec420080151406c203af292e55177e77d1.
    
    For unknown reasons, enabling tiling for the glyph cache is causing
    glyph corruption both across suspend and resume and VT switching, on a
    wide range of chipsets (reports include both i8xx and gm45)
    
    This strongly suggests that we are handling tiling, or updates to tiled
    buffers, incorrectly across i915_gem_idle(). However, until we can find
    the root cause, we want to fix this regression before the next stable
    release, so simply revert this patch. :(
    
    Fixes:
      [Bug 25406] fonts garbled after resuming from suspend since 6729b508
      http://bugs.freedesktop.org/show_bug.cgi?id=25406
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 093bb9ebe69760975a3fcf2322db950312e6c2d7
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 8 23:45:28 2009 +0000

    i965: Only use the affine kernels if both src and mask are affine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0cf04ea4d736f7d7848f33b772d88a0f1b6678b1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 8 23:44:45 2009 +0000

    i965: Set src_filter before testing.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 417ad2712edcbca635eb5eeff0d11cdb16c069ed
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 8 23:43:57 2009 +0000

    Assert that we only call OUT_BATCH() inside a BATCH
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47416b1eea09b238a997636d35998d71e0d18161
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 8 13:47:07 2009 +0000

    i965: Maximum number of vertices per composite is 24, not 18
    
    Beware the potential buffer overflow.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c1afc831c8fe4cbececee7dfa23506a6746c2425
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 7 21:27:56 2009 +0000

    uxa: Cache solid fills.
    
    Maintain a small cache of pixmaps to hold SolidFill pictures. Currently
    we create a pixmap the size of the damaged region and fill that using
    pixman before downloading it to the GPU and compositing. Needless to say
    this is extremely expensive compared to simply emitting the solid
    colour. To mitigate this cost, we maintain a small cache of 1x1R
    pictures which is recognised by the driver as being a solid, but at the
    very least is maintained as a GPU ready pixmap.
    
    This gives a good boost to cairo-xcb (which uses solid fills) on a gm45:
    
    Before:
      gnome-terminal-vim: 41.9s
    After:
      gnome-terminal-vim: 31.7s
    
    Compare with using a cache of 1x1R pixmaps in cairo-xcb:
      gnome-terminal-vim: 31.6s
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd475bad23c02130d11c49882c11261c9f0d4ef1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Dec 7 11:09:14 2009 +0000

    batch: Ensure we send a MI_FLUSH in the block handler for TFP
    
    This should restore the previous level of synchronisation between
    textures and pixmaps, but *does not* guarantee that a texture will be
    flushed before use. tfp should be fixed so that the ddx can submit the
    batch if required to flush the pixmap.
    
    A side-effect of this patch is to rename intel_batch_flush() to
    intel_batch_submit() to reduce the confusion of executing a batch buffer
    with that of emitting a MI_FLUSH.
    
    Should fix the remaining rendering corruption involving tfp [inc compiz]:
    
      Bug 25431 [i915 bisected] piglit/texturing_tfp regressed
      http://bugs.freedesktop.org/show_bug.cgi?id=25431
    
      Bug 25481 Wrong cursor format and cursor blink rate with compiz enabled
      http://bugs.freedesktop.org/show_bug.cgi?id=25481
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 415aab474edd1425034981306718afd8506445f1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Dec 4 09:02:36 2009 +0000

    intel: And remember to flush the batch...
    
    In commit 98e11210
    
      Remove flush parameter from intel_batch_flush()
    
    Maxi spotted that I had broken screen updating. It appears in my haste
    to eliminate the extra parameter I removed a call to intel_batch_flush()
    when throttling, i.e. when pushing the updates to the screen before
    idling.
    
    Should fix:
    
      Bug 25409 [bisected] rendering corruption since a938673e
      https://bugs.freedesktop.org/show_bug.cgi?id=25409
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8438372dcc9d15c7b708332cfcb3a1c16a2c5cf2
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Thu Dec 3 14:39:43 2009 -0500

    Require libdrm 2.4.16
    
    Needed for drmGetDeviceNameFromFd().

commit c439207ec0cc16d7d9f523598fcdebf7cec893e2
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Dec 2 14:43:17 2009 -0800

    Update man page to reflect currently available options
    
    Many have been removed or are obsolete now that UMS is gone.  And some
    are only available on i810/i815 or i830+, so move them to the
    appropriate section.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit a938673ee84d51ef655c37dfa7bbc5c35334cd28
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 20:51:53 2009 +0000

    batch: Downgrade batch submission from a FatalError.
    
    If we wedge the GPU then we will return -EIO for the current batch and
    then attempt to reset the GPU. Meanwhile the X server detects the error,
    throws a FatalError and to all intents and purposes appears to crash to
    the user - whereas before it often just appeared to momentarily freeze.
    Of course, on older hardware the server remains frozen until we can find
    a way to reset those GPUs at runtime.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 98e11210367c950e3f932419d2a4722cf971885d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 20:48:37 2009 +0000

    Remove flush parameter from intel_batch_flush()
    
    There is only a single caller that wishes to forcibly append a flush
    into the batch: intel_sync(). So move the logic there.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 57336c26f1fb90d43851ddcf78539585b67d86d9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 20:42:41 2009 +0000

    Rename I830Sync() to intel_sync()
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 370157f4932cf9067ba81c8bd5a311aff610882b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 20:28:49 2009 +0000

    batch: Avoid flushing a NULL batch
    
    During shutdown from a FatalError during batchbuffer submission, it is
    possible for the batch_ptr to be NULL, so we must be careful not to
    append a flush on this error path.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ad68881b670aabf8dbfd3b954e8796f91260579d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 14:14:39 2009 +0000

    uxa_check_composite: Minor whitespace.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 49d2ccab2a82083110fe796636f3f91ba8c31237
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 14:13:43 2009 +0000

    uxa_prepare_access() don't force a flush.
    
    Only the kernel knows whether the mapping requires a flush, so do not
    preempt it.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b68d3646f1fdfe012c16741958c7a62136a9b5aa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 14:12:19 2009 +0000

    Review use of errno after libdrm call
    
    Since drm may not actually set the appropriate errno after a failure, we
    must use the return code instead when determining the cause of failure.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0ff4d42a42b9e537b083343ee7dcc41cb41ae7cf
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Dec 2 12:12:07 2009 +0000

    uxa: Review uxa_prepare_access() to remove potential nesting
    
    Around a call to uxa_put_image() it is possible to mix both accelerated
    and fallback paths, with the fallback code making the presumed
    optimisation of only trying to call uxa_prepare_access() once. This
    fails if the accelerated path also uses prepare/finish access on the
    same drawable and then later fallback to the fallback path. This can
    happen currently if an error is reported whilst attempting to accelerate
    PutImage.
    
      #0  memcpy () at ../sysdeps/x86_64/memcpy.S:162
      #1  0x00007ffff43ce4bd in fbBlt (srcLine=<value optimized out>, srcStride=40, srcX=<value optimized out>, dstLine=0xffffffffffffffff, dstStride=64, dstX=0, width=<value optimized out>, height=8, alu=3, pm=4294967295, bpp=8, reverse=0, upsidedown=0) at fbblt.c:93
      #2  0x00007ffff43ce740 in fbBltStip (src=0xffffffffffffffff, srcStride=156555204, srcX=34, dst=0xfffffffc, dstStride=64, dstX=40, width=304, height=8, alu=3, pm=4294967295, bpp=8) at fbblt.c:944
      #3  0x00007ffff4c32c53 in uxa_do_put_image (pDrawable=0x246aa410, pGC=0x2c0a4f0, depth=8, x=0, y=0, w=38, h=8, leftPad=0, format=2, bits=0x954d7c4 "") at uxa-accel.c:196 #4  uxa_do_shm_put_image (pDrawable=0x246aa410, pGC=0x2c0a4f0, depth=8, x=0, y=0, w=38, h=8, leftPad=0, format=2, bits=0x954d7c4 "") at uxa-accel.c:223
      #5  uxa_put_image (pDrawable=0x246aa410, pGC=0x2c0a4f0, depth=8, x=0, y=0, w=38, h=8, leftPad=0, format=2, bits=0x954d7c4 "") at uxa-accel.c:289
      #6  0x00000000004d574f in damagePutImage (pDrawable=0x246aa410, pGC=0x2c0a4f0, depth=8, x=0, y=0, w=38, h=8, leftPad=0, format=2, pImage=0x954d7c4 "") at damage.c:905
      #7  0x00000000004287db in ProcPutImage (client=0x47ca72d0) at dispatch.c:2073
      #8  0x000000000042bd94 in Dispatch () at dispatch.c:445
      #9  0x000000000042513a in main (argc=4, argv=0x7fffffffe2a8, envp=<value optimized out>) at main.c:285
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 6be26cae8379f973d9ca27e0d5371d16618e4f7b
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 1 16:13:25 2009 +0000

    i830: Simplify prepare_access / finish_access
    
    Reduce the 3 conditions into the 2 distinct cases. This has the
    secondary benefit of also distinguishing between the reported errors.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 637f003b047e426901cab6b1fe3a0924bcb9a38a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Dec 1 13:20:20 2009 +0000

    uxa: Don't treat prepare_access as a flush synchronisation point.
    
    The kernel will only emit a flush iff the buffer is currently owned by
    the GPU. Instead of presuming that the kernel must emit a flush, it is
    safer to assume that it does not and so cannot mapping the buffer on to
    the CPU as a synchronisation point. The most obvious counter-example is
    when we map the same buffer twice without using it in a batch.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit cd5a9568ce0a541f030c27cdae529fe18e5f0437
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Nov 30 20:17:04 2009 -0800

    Add i830_bios.h and i830_display.h to EXTRA_DIST.
    
    These files have been dropped from the generated tar file since the
    removal of UMS support. However, the bios_reader code still includes
    these, so "make distcheck" fails unless these are distributed.
    
    There's probably a cleaner fix possible, but this at least fixes the
    build so that the snapshot can be pushed out.

commit 5bdac72a5c3f68ab6d9f7f2f1dfa6e5b78f04e57
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Nov 30 20:16:19 2009 -0800

    NEWS: Note that the driver now has a hard dependency on KMS.
    
    Since the UMS code has all been removed.

commit 813a910d7e4cc1c3deec0dcb1b536f8af337993a
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Nov 30 19:48:05 2009 -0800

    configure.ac: Bump version to 2.9.99.901.
    
    In preparation for a new snapshot.

commit b62c72913a85895a60268a49eed1c136f63f160d
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Nov 30 19:46:59 2009 -0800

    NEWS: Add generic notes for the 2.9.99.901 snapshot.
    
    We plan to collect real release notes before the 2.10.0 release.

commit 00aa4f7a45a318af5b651f9f3928e9da4443233a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 20:50:31 2009 +0000

    uxa: Limit maximum size of tiled objects
    
    On older chipsets (i.e. pre-i965) tiling is very restrictive and imposes
    severe size and alignment constraints. Combine that with relatively
    small apertures and it is very easy to create a batch buffer that
    cannot be mapped into the aperture (but would otherwise fit based purely
    on total object size). To prevent this we need to not use tiling for large
    buffers (the very same buffers where tiling would be of most benefit!).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8dd1c9eca02fb8da0c51f6fa4a38eb5e5ff41855
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Sun Nov 22 17:13:02 2009 -0500

    video-intel: remove i2c_vid.h from src/Makefile.am
    
    make dist failed due to missing i2c_vid.h
    Commit b9b159c49854d8d9d2207946bb583537bb0d48d6 Remove UMS support.
    The above commit did not remove this header file from the makefile.
    
    Signed-off-by: Gaetan Nadon <memsize@videotron.ca>

commit 6729b508c44bfca0b0dbef238a8732adbed6d4c9
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 16:52:10 2009 +0000

    uxa: Initialise lists for private pixmap structure.
    
    When updating a buffer object for the framebuffer, we may need to
    allocate a fresh pixmap private structure, for example if the pixmap is
    replaced due to resize. When doing so it is then imperative to
    initialise the circularly linked lists correctly.
    
    Should fix the fault:
      #0  i830_set_pixmap_bo (pixmap=0x24ab380, bo=0x24ab780) at i830_uxa.c:524
      #1  0x00007f8615c629fd in drmmode_xf86crtc_resize (scrn=0x247a320, width=1280, height=800) at drmmode_display.c:1345
      #2  0x000000000051246c in xf86RandR12ScreenSetSize (pScreen=0x24824f0, width=<value optimized out>, height=<value optimized
     out>, mmWidth=<value optimized out>, mmHeight=<value optimized out>) at xf86RandR12.c:709
      #3  0x0000000000512aa8 in xf86RandR12CreateScreenResources (pScreen=<value optimized out>) at xf86RandR12.c:839
      #4  0x0000000000514ec0 in xf86CrtcCreateScreenResources (screen=0x24824f0) at xf86Crtc.c:727
      #5  0x0000000000424fb3 in main (argc=<value optimized out>, argv=<value optimized out>, envp=<value optimized out>) at main.c:215
    as reported by 'buscher'.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 85fe41126e83b35954dc2066eb103e0555e207a4
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 15:57:42 2009 +0000

    uxa: Remove cache flush for copy
    
    As the copy uses the 2D blitter, it uses the render cache so the source
    should not require flushing if it has previously been used as a
    destination.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2d434eed09936328a52cb942450a95aedc3eac63
Author: Kristian Høgsberg <krh@bitplanet.net>
Date:   Mon Nov 30 10:27:42 2009 -0500

    Use new drmGetDeviceNameFromFd() for mapping to drm device name
    
    Should have been in libdrm to begin with.

commit cfcabc45140d19bfbfa4737c0a11cdbb042d11eb
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 13:58:30 2009 +0000

    i915: Disable centre-point sampling.
    
    I still have no idea how this is triggering failures, but it is. So
    revert until the problem is solved.
    
    Should fix once again:
    
      Bug 23803 [bisected i915] gnome characters disappear
      http://bugs.freedesktop.org/show_bug.cgi?id=23803
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8f8b6bd03d275379918777eaf7f63c0157b7ed9d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 14:03:40 2009 +0000

    i915: Whitespace
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 47916ea9d351f0ce6dc34713d6c164b0032f9830
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 13:58:06 2009 +0000

    debug: Enable dumping of batchbuffer [compile-time only]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit b118a52cd1a006321571967bd5f6c2a9e674de3a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 11:03:32 2009 +0000

    i915: Remove routing of alpha channel to green.
    
    This modification is redundant since the routing is done in the blend
    unit anyway.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5e04ded2bce4c135b57d391f5f4e24e030103e61
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 10:57:04 2009 +0000

    i915: Fix missing texture offset for mask.
    
    In commit e581ceb, I modified the shader generation to accommodate mixed
    textures and solids but missed applying the new computed sampler for the
    mask.
    
    References:
    
      Bug 23803 [bisected i915] gnome characters disappear
      http://bugs.freedesktop.org/show_bug.cgi?id=23803
    
      Bug 25031 rendering and color corruption since 14109abf
      http://bugs.freedesktop.org/show_bug.cgi?id=25031
    
      Bug 25047 [945GM bisected] rendercheck/repeat/triangles regressed
      http://bugs.freedesktop.org/show_bug.cgi?id=25047
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a8ea20100de5be45699e71eb6ba67bef546ad0cd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 10:13:18 2009 +0000

    debug: Don't always flush the batch when emitting a debugging flush
    
    I incorrectly changed the logic in 285f286 and caused the batch to
    always be flushed when debugging, instead of merely inserting a MI_FLUSH
    between operations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit c10850c63f9f88fbf08135bc4dcef1e5a2c71ee6
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Nov 30 09:07:57 2009 +0000

    overlay: Fix build after 646b4a9483
    
    The compile cleanup was not without fault... Apparently I don't have
    XVMC enabled anymore and so missed that this variable is actually used.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3f11bbec420080151406c203af292e55177e77d1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 21:39:41 2009 +0000

    uxa-glyphs: Enable TILING_X on glyph caches.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 19d8c0cf50e98909c533ebfce3a0dd3f72b755c1
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 21:16:49 2009 +0000

    uxa: PutImage acceleration
    
    Avoid waiting on dirty buffer object by streaming the upload to a fresh,
    non-GPU hot buffer and blitting to the destination.
    
    This should help to redress the regression reported in bug 18075:
    
      [UXA] XPutImage performance regression
      https://bugs.freedesktop.org/show_bug.cgi?id=18075
    
    Using the particular synthetic benchmark in question on a g45:
    
    Before:
       9542.910448 Ops/s; put composition (!); 15x15
       5623.271889 Ops/s; put composition (!); 75x75
       1685.520362 Ops/s; put composition (!); 250x250
    
    After:
      40173.865300 Ops/s; put composition (!); 15x15
      28670.280612 Ops/s; put composition (!); 75x75
       4794.368601 Ops/s; put composition (!); 250x250
    
    which while not stellar performance is at least an improvement. As
    anticipated this has little impact on the non-fallback RENDER paths, for
    instance the current cairo-xlib backend is unaffected by this change.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit f7540f06090753cba1190aa9e8cdea05a9512077
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 21:12:07 2009 +0000

    Only flush batch during prepare access if it may modify the pixmap.
    
    As we track when a pixmap is active inside a batch buffer, we can avoid
    unnecessary flushes of the batch when mapping a pixmap back to the CPU.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9a2c18fb92659d57741bfdcacbe4f69aab361532
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 21:07:45 2009 +0000

    batch: Emit a 'pipelined' flush when using a dirty source.
    
    Ensure that the render caches and texture caches are appropriately
    flushed when switching a pixmap from a target to a source.
    
    This should fix bug 24315,
      [855GM] Rendering corruption in text (usually)
      https://bugs.freedesktop.org/show_bug.cgi?id=24315
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 285f286597df5af13ac3f3d366f2fc9d0468dafa
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 22:42:03 2009 +0000

    batch: Track pixmap domains.
    
    In order to detect when we require cache flushes we need to track which
    domains the pixmap currently belongs to. So to do so we create a device
    private structure to hold the extra information and hook it up.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2c3aee2b570dadd9270a08d8ff675d07ac405e33
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 20:53:35 2009 +0000

    uxa-glyphs: Stream uploads via temporary bo
    
    Avoid mapping the glyph cache back to the cpu by allocating temporary
    buffer objects to store the glyph pixmap and blit to the cache.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 646b4a9483c01509a7324cc05eaadb72bc940c6d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Nov 29 10:53:36 2009 +0000

    Cleanup a few compiler warnings.
    
    Simple warnings for unused variables and C99-style declarations.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 917f9bb2435ba36bb99ef4d4f7b380d7f265e862
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Mon Nov 23 09:25:05 2009 -0500

    Makefile.am: add ChangeLog and INSTALL on MAINTAINERCLEANFILES
    
    Now that the INSTALL file is generated.
    Allows running make maintainer-clean.

commit eda2bb26783f7e9ef1ae659265930308378206e1
Author: Daniel Kahn Gillmor <dkg@fifthhorseman.net>
Date:   Fri Nov 20 01:52:05 2009 +0100

    Makefile.am: Add missing .g4i to be included in the tar file.
    
    Apparently Debian packages were having to manually add these files
    back in. Distribute them in the first place like we meant to.

commit c5e86453c3ae3709933779a9dd609bbaebe21e8e
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Oct 28 14:41:41 2009 -0400

    INSTALL, NEWS, README or AUTHORS files are missing/incorrect #24206
    
    Automake 'foreign' option is specified in configure.ac.
    Remove from Makefile.am

commit 12c4a22dd0b4de92a9c3d9e0baab029292f118f0
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Wed Oct 28 14:09:09 2009 -0400

    INSTALL, NEWS, README or AUTHORS files are missing/incorrect #24206
    
    Add missing INSTALL file. Use standard GNU file on building tarball
    README may have been updated
    Remove AUTHORS file as it is empty and no content available yet.
    Remove NEWS file as it is empty and no content available yet.

commit ad4030932490f848c8ac21ba5a7a8d734994ed15
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Mon Oct 26 12:54:21 2009 -0400

    Several driver modules do not have a ChangeLog target in Makefile.am #23814
    
    The git generated ChangeLog replaces the hand written one.
    Update configure.ac to xorg-macros level 1.3.
    Use XORG_DEFAULT_OPTIONS which replaces four XORG_* macros
    Update Makefile.am to add ChangeLog target if missing
    Remove ChangeLog from EXTRA_DIST or *CLEAN variables
    This is a pre-req for the INSTALL_CMD

commit bb994ce018ae6c3e3c5548ae7439cfc5e9aa4554
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Thu Oct 22 13:02:04 2009 -0400

    .gitignore: use common defaults with custom section # 24239
    
    Using common defaults will reduce errors and maintenance.
    Only the very small or inexistent custom section need periodic maintenance
    when the structure of the component changes. Do not edit defaults.

commit 67bbda0bddae3e0d39bc8deb7378f467aedfd0e3
Author: Gaetan Nadon <memsize@videotron.ca>
Date:   Thu Oct 22 12:34:17 2009 -0400

    .gitignore: use common defaults with custom section # 24239
    
    Using common defaults will reduce errors and maintenance.
    Only the very small or inexistent custom section need periodic maintenance
    when the structure of the component changes. Do not edit defaults.

commit c180baf43b8a0e407448018f3a7e42491cf974ae
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 13 19:35:23 2009 +0000

    i915: Derive the correct target color from the pixmap by checking its format
    
    Particularly noting to route alpha to the green channel when blending
    with a8 destinations.
    
    Fixes:
    
      rendercheck/repeat/triangles regressed
      http://bugs.freedesktop.org/show_bug.cgi?id=25047
    
    introduced with commit 14109a.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e9064eacb0ad8867e320597453facbb3c376522c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Nov 13 18:35:44 2009 +0000

    uxa: Do not remove repeat from solids for 1x1 composites.
    
    Or else we hit the buggy 1x1 source path and trigger:
    
      rendercheck/mcoords regressed
      http://bugs.freedesktop.org/show_bug.cgi?id=25046
    
    caused by the recent commit e581ceb.

commit 14109abf285866ad4cd99d0cd16b0954a0a73a62
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 10 11:17:23 2009 +0000

    i915: Fix texture sampling coordinates.
    
    RENDER specifies that texels should sampled from the pixel centre. This
    corrects a number of failures in the cairo test suite and a few
    off-by-one bug reports.
    
      Grey border around images
      https://bugs.freedesktop.org/show_bug.cgi?id=21523
    
    Note that the earlier attempt to fix this was subverted by the buggy use
    of 1x1R textures for solid sources -- which caused the majority of text
    to disappear.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit e581ceb7381e29ecc1a172597d258824f6a1d2d3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 10 11:14:23 2009 +0000

    i915: Use the color channels to pass along solid sources and masks.
    
    Instead of allocating and utilising the texture samplers for 1x1R
    solid sources and masks we can simply use the default diffuse and
    specular colour channels and adjust the fragment shader appropriately.
    The big advantage is the reduction in size of batches which should give
    a good boost to glyph performance, irrespective of the additional boost
    from using simpler shaders.
    
    However, the motivating factor behind the switch is that our use of 1x1
    textures turns out to be buggy...
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33cabbfca6acb5149e26f87a538a7cb79f00cad2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 10 11:09:52 2009 +0000

    i915: Check for overflow before overflowing.
    
    As the immediate victim of the overflow would be to overwrite the maximum
    permissible value, the test was optimistic.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 67af5a99253b1295f8dc09b28863eb7dc8b59e1d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 10 11:05:20 2009 +0000

    Check that batch buffers are atomic.
    
    Since batch buffers are rarely emitted by themselves but as part of a
    sequence of state and vertices, the whole sequence is emitted atomically.
    
    Here we just enforce that batches are marked as being part of an atomic
    sequence as appropriate.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 998d6b3d8c549086fbc8a9f0e309694b23398d8d
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Nov 10 11:00:43 2009 +0000

    uxa: Force alpha bits to fill remaining bits
    
    In the case of x8r8g8b8 and similar where the alpha channel is ignored,
    but should be interpreted as being 1, then it is convenient if those bits
    are set appropriately in the colour. In order to do so for these formats,
    where PIXMAN_FORMAT_A() returns 0 we need to compute the alpha channel
    width as the remaining bits instead.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit dbb68168dc909ab2ec1d935322c3fd8581e666f1
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 5 15:40:20 2009 -0800

    Revert "configure: make --disable-dri work even if the server supports DRI"
    
    This reverts commit a851139c2141f6da370186148f2836e18b2acf83.
    It broke the build, and I don't see why we should be supporting this
    anyway.
    
    Conflicts:
    
    	configure.ac
    	src/Makefile.am

commit 4c8e783d84d2c14c8a1638b6a12307c0164d3e31
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 21 13:30:38 2009 -0700

    Fix "Remove flow-control macros for fallbacks in the 2D driver."
    
    I guess this is the sort of failure due to rebase-happiness that makes
    Linus yell at us for rebasing.

commit d0e08fe611681fcc840d1b9ee8d49acdf50f7e58
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Mon Oct 26 13:15:24 2009 +0000

    Kill some more #defines only needed for User-Modesetting
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 8ff2a6496413e6b12fad9352f4bd9b6736bda56c
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 21 13:30:38 2009 -0700

    Remove flow-control macros for fallbacks in the 2D driver.
    
    It's poor style, and has confused new developers.

commit c87585229b36790f883b9b8954ed061e00624df6
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Nov 5 13:33:55 2009 -0800

    Increase stride limit for IGDNG
    
    It can go up to 32k.  Upping this lets me use my 2560x1600 and 1920x1200
    monitors in an extended desktop configuration.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit cbcfb711747e3637f20145aed00ac3d6256d0d1d
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed Oct 28 13:12:46 2009 +0100

    configure: drop some more cruft
    
    DEBUGFLAGS wasn't used anywhere and the configure switch is useless.
    "CFLAGS=-g ./configure" does the same thing and actually works.
    
    PKG_CHECK_MODULES already calls AC_SUBST, no need to do it twice.
    
    Signed-off-by: Rémi Cardona <remi@gentoo.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c0a43b24cc7540cc139beca0ec2e4c202ff5593
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed Oct 28 13:01:32 2009 +0100

    configure: use CWARNFLAGS from xorg-macros.m4
    
    Signed-off-by: Rémi Cardona <remi@gentoo.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit a851139c2141f6da370186148f2836e18b2acf83
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed Oct 28 12:37:38 2009 +0100

    configure: make --disable-dri work even if the server supports DRI
    
    XF86DRI is defined by the SDK so not defining it here just breaks the
    build. Define HAVE_DRI instead to avoid collisions.
    
    Note: DRI2 is still enabled/disabled entirely by SDK defines.
    
    Signed-off-by: Rémi Cardona <remi@gentoo.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 07e0b2cff6107d6c86096c7da4e31b0c976794d5
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed Oct 28 11:45:55 2009 +0100

    configure: group system header checks at the top
    
    Signed-off-by: Rémi Cardona <remi@gentoo.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 0401a4c3143c5b94875cb4c66c94a0d247c32da5
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed Oct 28 11:42:41 2009 +0100

    configure: check for libdrm and libpciaccess earlier
    
    Signed-off-by: Rémi Cardona <remi@gentoo.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 10946118dd3a63f1375a1bfde0b2f0542a93c1c2
Author: Albert Damen <albrt@gmx.net>
Date:   Sun Oct 25 18:02:07 2009 +0100

    Fix crash in uxa_acquire_pattern when pDst is NULL
    
    This avoids a crash when an XRenderComposite call is made with a
    -1 value for width/height, (which apparently compiz's gtk-window-
    decorator likes to do). Fixes bug:
    
    	X crashes in uxa_acquire_pattern when logging in (gdm)
    	http://bugs.freedesktop.org/show_bug.cgi?id=24724
    
    Signed-off-by: Albert Damen <albrt@gmx.net>
    Reviewed-by: Carl Worth <cworth@cworth.org>

commit 751e0a3e4576bbf4bffa56bbd6d4de28f10db98e
Author: Thomas Arnhold <thomas@arnhold.org>
Date:   Mon Oct 19 11:35:30 2009 -0700

    Fix 64-bit compiler warnings in intel_xvmc_dump_render().
    
    Bug #24396.

commit 3e8f2eae3a586aa29be4858698e666e0ec778cea
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 15 13:48:56 2009 -0700

    XVMC: Use XCB DRI2 instead of cargo-culting our own copy of Xlib stuff. (v2)
    
    v2: Incorporate comments from Jamey on device name handling and extension
    detection.

commit 38ab403d7a1c461c8ac65a056bee2dd5c7f2f58e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 15 11:39:32 2009 -0700

    Enable XVMC by default on gen4.

commit f171069608bf174d920921fa102b8619794ed272
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Mon Sep 28 18:35:57 2009 +0800

    i965 XvMC cleanup
    
    Remove bo pin for surface buffer access, and remove access
    attempt for possible unmapped framebuffer. Using xv buffer
    pointer to pass current xvmc surface bo handler, which is
    assigned to src image bo and handle that the same way as in Xv.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    [anholt: Fixed up for conflict against the XV rework.  Not tested, because
    both mplayer and xine segfault with XVMC currently.]
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit aaedeffe00d9414bb03723dbc30b4938a07ce5fa
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Oct 14 18:09:08 2009 +0200

    Xv overlay: fix planar YUV copy for right rotated crtcs
    
    While copying and rotating the buffer, array access was out of bounds when
    rotated to the right (RR_Rotate_270).  My buffer handling changes probably
    made this bug much more likely to actually result in a SIGSEGV.
    
    I've checked the logs and the bug exists since rotation has been supported,
    i.e.  this looks like a candidate for cherry-picking for all supported
    releases.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 703e3326bb41528cc57c0d25003707df209fc714
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Oct 14 15:56:55 2009 +0200

    Xv overlay: further cleanups
    
    Kill some unnecessary stuff. Small code changes, but no functional ones.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 1c2aedfce9e6a7561347e873d125b6889dee7941
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Oct 14 15:56:54 2009 +0200

    Xv: fixup the disabled drmmode overlay code
    
    This code didn't survive the global renaming of vars to saner names.
    Fix it up.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 909990f40a437cbd7026a10e32af1ea120f4c2a7
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Oct 14 15:56:53 2009 +0200

    Xv overlay: remove some more dead stuff from ums overlay support
    
    Mostly unused definitions and variables, but also some strange ums
    debug code. Also kill some now obsolete comments.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 86bc23ab5da34137c82250395c68aa92ecd88a24
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 14 12:04:40 2009 +0100

    debug: Enable cache flushing after every operation
    
    If DEBUG_FLUSH_CACHES is enabled then emit a MI_FLUSH after every
    rendering operation. This is intended to 'fix' cases where we are
    missing a required flush in the middle of a sequence of operations, such
    as switching between 2D to 3D and render to sampler.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 3c0815abf28744e215bea286e71d935cd486955a
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 14 11:29:21 2009 +0100

    conf: Add debugging flush options
    
    Make the following options available via xorg.conf:
      Section "Driver"
        Option "DebugFlushBatches" "1" # Flush the batch buffer after every
                                       # single operation;
    
        Option "DebugFlushCaches" "1" # Include a MI_FLUSH at the end of every
                                      # batch buffer to force data to be
                                      # flushed out of cache and into memory
                                      # before the completion of the batch.
    
        Option "DebugWait" "1" # Wait for the completion of every batch buffer
                               # before continuing, i.e. perform synchronous
                               # rendering.
      EndSection
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2f134b84445d2d0bfe3d81276bc7f6648df062ee
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Sep 30 07:31:57 2009 +0000

    Return failure when the enum-type output property values are not found
    
    Failure to do so causes xrandr to report incorrect property values.
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit fcc2ee48b866b81c79315ff10189b56fc201539d
Author: Albert Damen <albrt@gmx.net>
Date:   Wed Oct 7 21:55:42 2009 +0200

    Drop frontbuffer from crtc in I830CloseScreen
    
    By dropping the frontbuffer from the crtc, the new frontbuffer
    can be properly added to the crtc when the xserver is reset.
    
    Signed-off-by: Albert Damen <albrt@gmx.net>

commit 8a77877f9c2c6a8a1308bc1a3be9e7ad88bc7f49
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Oct 9 14:16:06 2009 +1000

    drmmode: with 1.7 server, set mode major doesn't get gamma setup.
    
    Noticed this on Fedora, where 1.7 server does gamma via the randr
    codepaths however kms doesn't have this call which happens in the
    non set_mode_major path.
    
    probably should be backported to released drivers.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit d8c7678ddadce89ca7fc0edd1b4d9ed3d959e687
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Oct 12 14:02:12 2009 -0700

    DRI2 compat build fix: it's drawable->pScreen not drawable->screen
    
    Fallout from the conversion; DRI2 compat path was broken.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit b37ac9d317ae537d993922976f87072040b04d04
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 12 14:31:06 2009 +0100

    uxa: Refactor create Picture for pixman format
    
    Pull the common methods for creating a Picture given a pixman format
    into its own method, and tidy the surrounding code. The benefit is that
    we can now composite directly to the Picture and so save an intermediate
    copy when creating patterns for gradients.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 7e8f32d0a7279dce1976f87612833d9092554cfe
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Oct 12 14:33:08 2009 +0100

    uxa: Free the ScratchPixmapHeader after its associated Picture
    
    Fixes: http://bugs.freedesktop.org/show_bug.cgi?id=24459
    Intel Driver > 2.8: Cairo rendering bug, triggered in QtCurve GTK engine
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 1556c62e0336ea2fef866722ee44d2d188e318f3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 8 17:34:13 2009 -0700

    Replace dolt and shave with relying on current autotools.

commit 8b2d2ff0d026eea445a071102a62d782f3bbec78
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 7 16:12:25 2009 -0700

    Clean up more i830_memory.c madness.
    
    It was cooking up insane alignment values for buffers that new libdrm was
    justifiably complaining about, but it turns out we don't need the alignment
    values anywhere because the only case they're needed, they're computed
    entirely by the kernel.  Also, the XVMC code was passing a completely unused
    flag in.

commit d525a0e993a59e118ab1e8519b3d73465f8f0169
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 19:05:24 2009 -0700

    Rename pScreen to screen.

commit b6262dcd2754f7e87f27979dcad145133ee3b945
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 19:00:41 2009 -0700

    Rename pGC to gc.

commit fdcfeb822d15cbfe6fccceab002b75458dca3264
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:57:22 2009 -0700

    Rename pDraw to plain old drawable.

commit 7bbf4ac7137ed0e4ec0a75806a396c12f102e779
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:50:54 2009 -0700

    Rename the xv pPriv to adaptor_priv to reflect whose private it is.

commit f309d475241260cf60567100511d5f7c6c487a29
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:38:53 2009 -0700

    Call pPixmaps plain old pixmaps.

commit da0f6616ad63f1581cf91a98104e5287aa44e7ce
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:37:05 2009 -0700

    de-pCamelHungarian the Render pictures and pixmaps.

commit 050a141b7bc94b459061615124b7686a9c331e01
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:30:57 2009 -0700

    Share several render fields between render implementations.
    
    Also, start settling on the cairo naming for things: source, mask, and dest.

commit af27a3a0a5645c6f41f583611bd0f2559dc7cb2f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:24:50 2009 -0700

    Rename the xf86 screen private from pScrn to scrn.

commit cc5d3ba3c331c3b1becf2d19277b24144bf34cfa
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:02:38 2009 -0700

    Rename the screen private from I830Ptr pI830 to intel_screen_private *intel.
    
    This is the beginning of the campaign to remove some of the absurd use of
    Hungarian in the driver.  Not that I don't like Hungarian, but I don't need
    to know that pI830 is a pPointer.

commit 03e8e64f8669263e3cecb79ea57d5a26c0eaee3f
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Oct 7 22:15:37 2009 +0100

    Complete the removal of UMS build support
    
    Eric missed removing the now dead references to the deleted subdirectories
    in configure.ac with commit b9b159c
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 5e44a0fa4209523bee56f513a2029869f96a710a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 18:08:51 2009 -0700

    Remove more dead UMS code.

commit 6a716a25abc84f1c7f766fd3bfa1c2aac91e6ae7
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 17:58:32 2009 -0700

    Remove the reg_dumper code, now that it's been moved to intel_gpu_tools.

commit e9aff787a55d684e3b9c6d5ea8ac2926be952280
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 17:53:59 2009 -0700

    Remove the stepping debug app, replaced by version in intel_gpu_tools.

commit 71b9cdaa86bb9d3deb44f32f47771c33898253c2
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 17:53:21 2009 -0700

    Trim down the hotplug debug app.

commit e95eb483e210def0814bc61fc36d672145da7dff
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 17:51:09 2009 -0700

    Remove intel_idle, replaced by intel_gpu_top in intel_gpu_tools.

commit 8ae0e44e42db645abe6d385f561260d2ae4a1960
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 6 16:30:08 2009 -0700

    Move to kernel coding style.
    
    We've talked about doing this since the start of the project, putting it off
    until "some convenient time".  Just after removing a third of the driver seems
    like a convenient time, when backporting's probably not happening much anyway.

commit b9b159c49854d8d9d2207946bb583537bb0d48d6
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 30 16:29:53 2009 -0700

    Remove UMS support.
    
    At this point, the only remaining feature regressions should be the lack of
    overlay support (about to land), and the need to update the XVMC code to work
    in the presence of KMS.
    
    Acked-by: Keith Packard <keithp@keithp.com> (in principle)
    Acked-by: Carl Worth <cworth@cworth.org> (in principle)

commit d26f4c493721dbb2e2cbf4efcf8d37228d1b1f3b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 5 13:31:31 2009 -0700

    Remove UMS overlay support.
    
    The replacement code is now landed, and the rest of UMS is about to disappear.

commit 33c488e83676d26e69145ea615f75ca52768f400
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 5 10:38:05 2009 -0700

    Remove error state dumping code.
    
    This is replaced by intel_gpu_dump, and would no longer be used once UMS is
    gone.

commit 2370af32fe31bed8e5715639023635bdb3b83b1b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:47 2009 +0200

    Implement drmmode overlay
    
    This does not restore the overlay on EnterVT/disable it on LeaveVT.
    Does not look like this is necessary.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    [anholt: Hacked in avoiding the actual kernel calls with
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 99230864050ea2f26c2412c4c87c50947fc3cbe1
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:46 2009 +0200

    Xv: introduce an overlay hal
    
    This is the last preparatory step for overlay support with drmmode.
    Safe two (specially marked) function calls in the setup code, all
    hw accessing code goes now through these three new functions with
    the ums_overlay prefix.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit bb04e184fdc55325a362ebf291e16a7c112a5f1d
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:45 2009 +0200

    Xv: rework overlay buffer management
    
    The basic idea is to only pin the buffer into the gtt when
    the overlay hw is actually using it. This results in a few changes:
    
    - Unify data copied/buffer handling with textured video. Now offsets
      are always buffer relative and we just use drm_bo_map to access a
      buffer.
    - Implement double buffering using two bo's. This is necessary because
      we can't pin the same buffer to the gtt and map it as normal memory.
    - Kill XV_DOUBLE_BUFFER. With the above changes, overlay video is always
      doubel buffered.
    
    There is still the XvMC passthrough case, which makes the code slightly
    ugly. Unfortunately we can't get at the bo behind this buffer.
    
    Changes since the last review-round:
    - Don't overallocate by a factor of 2.
    - Prevent possible use-after-free issue.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 60462eb5b5c1931beecc1ed2d32f91090f64174c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:44 2009 +0200

    Xv: create xvmc_passthrough helper
    
    This way all thes strange special cases make much more sense.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 71276dff9415322f75792a46c1a1cc0b900588b9
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:43 2009 +0200

    Xv: scrap overlay offscreen pixmap support
    
    The code looks like it's been bitrotting since being copied over
    from the i810 driver. Furthermore painting rgb pixmaps with the overlay
    engine is in these days of modern compositing X an absolute no-go. And
    textured video doesn't support it neither, so its likely never ever
    used by applications.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 99afdf985fa9f763fda4bc49ccd8111960a4ae0f
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:42 2009 +0200

    Xv: small cleanups in I830PutImage
    
    - scrap unused variable overlay
    - scrap an superflous if and attach the code to the preceeding else
    - tiny layout fix.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit d598456f1fe013c250530730c57ad720d38cde3a
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:41 2009 +0200

    Xv I830PutImage splitup: extract i830_wait_for scanline
    
    Also scrap the unecessary variable sync in I830PutImage and the
    accompanying obfuscated logic.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 2ba03fa78197d1cb10d6401ad02cfe9edd2623b3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:40 2009 +0200

    Xv I830PutImage splitup: extract i830_copy_video_data
    
    Just moves the code and passes back allocation failures.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 81fc74cc4ce81b9be8b9ba3bcacf1284c47ce80c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:39 2009 +0200

    Xv I830PutImage splitup: extract i830_setup_video_buffer
    
    Just move the code and pass back allocation failures.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 0bf4cc5130482ee0f3924f34e37fa5fc988119b3
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:38 2009 +0200

    Xv I830PutImage splitup: extract i830_dst_pitch_and_size
    
    Just moves the code.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit c20ef591931b5efc5745d00c06f296c89cf32745
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:37 2009 +0200

    Xv: kill destId in I830PutImage
    
    It's only used to remember that XvMC has ỲV12 as output. is_planar_fourcc
    already takes care of that in all necessary cases.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 5ce944994d57176d0ddf6f6d7c7779fdfcf39cb8
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:36 2009 +0200

    Xv: kill hw double buffering logic
    
    The idea for the hw double buffering support is to program two fixed
    buffers and then only switch buffers in the OCMD register. But the driver
    as-is always programs the new buffer address (in both register sets
    when double buffered). Therefore we gain nothing by using this hw
    capability. Scrap the software support for it.
    
    When double buffered, we now allocate just a buffer of size 2*size and
    switch between the two parts purely in software.
    
    To make reviewing this easier, I'll shortly explain the differences of how
    double-buffering (i.e. tear-free video) is achieved before and after this
    change:
    
    - When double buffer, allocate a buffer twice the size (unchanged).
    - Depending upon the currently shown buffer-half, copy the new frame into
      the other buffer-half. In the old code this is done by using the right
      set of buffer offsets, either *Buf0Offset or *Buf1Offset. The new code
      simply programs the offset for the right buffer-half into the single set
      of offsets. The end-result is unchanged.
    
    Now the big difference in hw-programming:
    
    Old: Programm new buffer offset into both sets of _hw_ buffer offset
    registers. Depending upon the current _sw_ buffer, select the _hw_ buffer
    and program this into the OCMD register. This just complicates matters
    unnecessarly.
    
    New: Just always use the hw buffer 0.
    
    And then it's again the same story in both old and new code:
    
    - Execute an overlay flip (MI_OVERLAY_FLIP) to read in the contents of the
      hw registers into the shadow hw registers (which are actually being used
      by the overlay, not the ones we write stuff into). This is synchronized
      with the respective crtc vblank by the hw.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 232418d72ee967a81e39481b9f2ee379cb685458
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:35 2009 +0200

    Xv: use is_planar_fourcc helper some more
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 219b14310efe49aff5d3d9023d2ba440c9f702c1
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:34 2009 +0200

    Xv: introduce planar memcpy helper
    
    Reduced 3 copies of the same code to one.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b90171f16652d1145fb80a63919f76a804a94cef
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:33 2009 +0200

    Xv: rename i830_display_video to i830_display_overlay
    
    This function only programs the overlay and is never called for textured
    video. Make this obvious.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 857e40a6e00db72401717da3ed79edbf65db31d4
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:32 2009 +0200

    Xv i830_display_video splitup: extract i830_overlay_cmd
    
    This slightly moves around (and simplifies) the OSTRIDE reg programming,
    too.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 50d70e644ea0574752d0fe160ce8d873653c913b
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Aug 11 16:06:31 2009 +0200

    Xv i830_display_video splitup: extract i830_calc_src_regs
    
    Also introduce an is_planar_fourcc helper. I'll use that one later.
    
    In i830_display_video this changeset moves the XVMC case (previously
    obscured as the default case) around. I've figured this default case
    does not make sense, here's why:
    
    XvMC is everywhere else handled as a planar format (e.g. in the register
    programming a few lines down). Furthermore the id variable gets mapped
    to FOURCC_YV12 if IS_I915(pI830) is true in I830PutImage. There's a
    second caller in the offscreen overlay support code.  But I think that
    code is bitrotten and not reliable as an information source.
    
    So we have a different behaviour only for id=FOURCC_XVMC and i965 class
    hw (i830 class doesn't have xvmc). I've crawled through various
    sources/intel documentations. Finally in the textured video implemention
    for i965 class hw (src/i965_video.c) I've found a switch statement that
    puts XVMC into the same case as I420 and YV12. So also in i965 class hw
    xvmc uses a planar format.
    
    In conclusion I claim that this code was bogus and XvMC on i965 class hw
    over Xv overlay was most likely broken.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 2841a4cd8c6c64fdf4b2203ab73b57b38a50f651
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Sep 28 20:03:11 2009 -0700

    Increment version to 2.9.0
    
    And add a reminder to RELEASING that the incremented version number
    needs to be committed, (since I forgot to do this with 2.8.99.902).

commit a790aff4fef7d0c86b7b9c0da4afdc9c0aba6636
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Sep 28 20:02:28 2009 -0700

    NEWS: Add notes for the 2.9.0 release.
    
    Just renamed notes as from 2.8.99.902.

commit a92bbcc94904684e7709b3ddaad82bc04607af26
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 22 17:08:23 2009 -0700

    Increment version to 2.8.99.902

commit ae00a0923717caec6d0dad94527da26397bd12ce
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Sep 22 15:14:38 2009 -0700

    NEWS: Add notes for 2.8.99.902

commit 7e7db7ac530b5282b0841585959597b54fcc633b
Author: Matthias Hopf <mhopf@suse.de>
Date:   Mon Aug 17 19:24:03 2009 +0200

    Add new backlight driver "samsung".

commit 7ae1d0dde6cef3437b67dbc21384cb179616a6c0
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Mon Aug 31 13:51:01 2009 +0800

    Skip setting tv format property if output crtc is NULL
    
    When TV is not connected and X start, after plugging TV cable again,
    system will crash because output crtc is NULL. This patch will return,
    do not handle crtc immediately, meanwhile set value will be effective
    until user really enable output by xrandr command.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 02fe9be695f7e209944bd0f7b67950f93619feee
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Tue Sep 22 10:58:38 2009 +0800

    Check whether the DVI-I/D is connected or disconnected based on EDID
    
    When the monitor is digital type for SDVO-DVI D, there should exist the EDID. If
    there is no EDID, it should be detected as disconnected.
    
    Signe-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 762e406d138ac80854b6a23b1078b52f6581f0d8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Sep 22 01:34:37 2009 +0100

    Revert "8xx: Fallback for any non-affine transformation."
    
    This reverts commit 505025053d66d415e1c23ac858b9238fa8541d37.
    
    In theory, the non-affine paths work -- at least for the stated test case,
    so re-enable them and avoid the slow work-around.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 2cc1f3cb6034dddd65b3781b0cde7dff4ac1e803
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Sep 19 17:30:57 2009 -0700

    i8xx: Format projective texture coordinates correctly.
    
    Projective texture coordinates must be delivered as TEXCOORDFMT_3D
    using TEXCOORDTYPE_HOMOGENOUS. This meant selecting the correct type
    in i830_texture_setup, the correct format in i830_emit_composite_state
    and sending only 3 coordinates in i830_emit_composite_primitive.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    [ickle: tweaked to fix up a couple of use-before-initialised]
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 00e8de212b46a243f243b437b7eb866315ab89b3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Sep 21 22:14:21 2009 +0100

    Check the correct Picture for error during creation.

commit bd817e2d733dfdb1140874b06595ccd1ef39159b
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Sep 21 17:21:17 2009 -0700

    Split i915/i830 composite_emit_primitive into two functions.
    
    The i915 and i830 take similar but different data when emitting the
    primitives, instead of trying to share code here, just split this
    apart and avoid potentially breaking things later on.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 5e80297d088e8cdbf66d765f7d252dab66c8df86
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Sep 18 21:05:23 2009 -0700

    Remove DGA support from the driver.
    
    The xf86DiDGA code required that the scanout buffer always be
    mappable, stay be at a fixed address in the aperture and have a
    constant size. With frame buffer resizing, the latter two are no
    longer true, and with KMS, we'd really prefer to not allow the former.
    
    The only option available to the driver is to completely disable DGA
    as the modes code has internal calls to the xf86DiDGA code when
    fetching new modes from the hardware.
    
    A fix for the DiDGA code will be added to the X server which will
    automatically initialize DGA for mode switching and input, but not
    frame buffer access, and not require any driver cooperation.
    
    Thus, the correct solution is for the driver to not call xf86DiDGAInit
    at all. For old servers, this eliminates a potential catastrophic
    problem where random memory is written by the X server. New servers
    will get the DIX-based behaviour automatically.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 4758311842a16600287c8f9f77ce0af1a31b9264
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Sep 18 20:59:52 2009 -0700

    Remove vestigial internal rotation which broke KMS DGA/VidMode modesetting.
    
    Pre-2.0, the driver supported rotation internally, rather than relying
    on the X server rotation support. The last piece of this dealt with
    rotating the mouse coordinates and also tried to preserve rotation
    across DGA/VidModeExtension modesetting requests.
    
    That latter bit of code broke under KMS as the rotation value was
    never initialized, and when set to zero would create an invalid
    configuration. This would confuse xrandr which would bail before
    making any changes, leaving the user without a way to recover.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 505025053d66d415e1c23ac858b9238fa8541d37
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Sep 21 13:50:09 2009 -0700

    8xx: Fallback for any non-affine transformation.
    
    There are definitely bugs in the 8xx code dealing with non-affine
    transformations. Disable that code for now to get things working.
    
    Fixes bug #22947 ([855GM, xf86-video-intel-2.8.0] "Freeze" when RENDER extension is being used)

commit b4d29452b929a3ef224d3625e4bc66b787c5edb7
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Mon Sep 21 15:28:09 2009 +0800

    More dumps for Arrandale LVDS
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 57fc09cef28bad2e3e8455b93ef2927118f8a3a3
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sun Sep 20 01:02:39 2009 +0100

    Avoid fallbacks for a1 src/mask
    
    Carl Worth did the hard work in identifying that the regression in
    cairo between X.org 1.6 and 1.7 was caused by cairo sending an a1
    mask to the server in 1.7 whereas in 1.6 cairo used local fallbacks
    (as the source was using RepeatPad, which triggers cairo's
    'buggy_pad_reflect' fallback for X.org 1.6). This was causing the driver
    to do a fallback to handle the a1 mask instead, which due to the GPU
    pipeline stall is much more expensive than the equivalent fallback in
    cairo.
    
    Reference:
      cairo's performance downgrades 4X with server master than server-1.6.
      https://bugs.freedesktop.org/show_bug.cgi?id=23184
    
    The fix is a relatively simple extension of the current
    uxa_picture_from_pixman_image() to use CompositePicture() instead of
    CopyArea() when we need to convert to a new format.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 33f98e4056706f4c30bb4327677ac49e82058231
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Sep 17 18:16:02 2009 -0700

    Don't destroy bufmgr at CloseScreen time
    
    Under KMS, the bufmgr is not initialized at InitOutput time and so it
    won't be re-initialized during server regen. Thus we must leave the
    bufmgr running during regen and cannot destroy it in CloseScreen.
    
    Under UMS, each place the bufmgr is initialized, it checks to see if
    it has already happened. Hence, we can safely leave the bufmgr running
    across server regen for UMS too.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ee9ad853574e3ee1a210db6207b84ecd466e08ee
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Sep 17 17:57:40 2009 -0700

    Make sure DRM output properties are freed after we're done with them.
    
    drmmode_output_get_modes was fetching output properties but only
    freeing some of them.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit b8c5c996e888485c3a16d645c8490592534a7882
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 15 19:45:47 2009 -0700

    Eliminate cursor flicker
    
    We can update the cursor without hiding and showing it.  In fact, doing the
    hide/show causes noticable flicker when running in KMS mode.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit c2abfa8e54acab61250dba1e435760e3b1499c8c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 4 17:10:25 2009 +0100

    Avoid fallbacks for compositing gradient patterns
    
    Currently when asked to composite using a gradient source or mask, we
    fallback to using fbComposite().  This has the side-effect of causing a
    readback on the destination surface, stalling the GPU pipeline.  Instead,
    like uxa_trapezoids(), we can use pixman to fill a scratch pixmap and then
    copy that to an offscreen pixmap for use with uxa_composite().
    
    Speedups on i915:
    firefox-talos-svg:  710378.14 -> 549262.96:  1.29x speedup
    
    No slowdowns.
    
    Thanks to Søeren Sandmann Pedersen for spotting the missing
    ValidatePicture().
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit efbcf29dd1a1ca058b7a2a93f0685102c06c9369
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Sep 9 09:32:48 2009 -0700

    Update version to 2.8.99.901 for snapshot.

commit 54fa27fcd97a6735d8eb6073f5ec7d0d40a7327f
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Sep 9 09:27:01 2009 -0700

    NEWS: Add notes for the 2.8.99.901 snapshot

commit 1a77ca74bc829e019a06fe9ad559f013054c27ff
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 9 12:09:05 2009 +0100

    i915: Restore nearest sampling
    
    My recent commit [94fc93] to use the pixel centre for sampling with the i830
    broke the i915. This restores the previous sampling coordinates for the
    i915 whilst preserving the correct coordinates for i830.
    
    Fixes: gnome characters disappear
           http://bugs.freedesktop.org/show_bug.cgi?id=23803
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ce10b5b6fca086eb4af45c1db28352e06ee4ce0b
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Sep 8 00:56:34 2009 +0800

    Add B43 chipset support
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 94fc93d4e2b88565dca17f72903d8991213c9ee8
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 5 09:35:10 2009 +0100

    i830/i915: Set the sample position to the pixel center.
    
    And in particular we apply the nearest sample bias separately for
    src/mask.
    
    Fixes cairo/test:
    	device-offset-scale
    	finer-grained-fallbacks
    	mask-transformed-{similar,image}
    	meta-surface-pattern
    	pixman-rotate
    	surface-pattern-big-scale-down
    	text-transform
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit ced0cc8bb28106c18473777bb184872786325e99
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 5 09:05:36 2009 +0100

    i830: Update comments
    
    i830_composite() is no longer shared with i915 but
    i830_emit_composite_primitive() is.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 8863706e25a73f68993d946e2f1c1040bae0f9c5
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 5 09:03:56 2009 +0100

    i830: Trim composite setup
    
    Remove a couple of redundant NOOPs from the setup and correct the required
    space checking for atomic batch operation.

commit a9b12111f9787950ad6b8f295a70a872c5933c93
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Sep 5 00:57:39 2009 +0100

    i830: remove padding NOOPs from composite
    
    Bumps aa10text up from 249k to 260k!
    
    These NOOPs have existed uncommented since
    04d1584737fd0d14e99608a97281fd7b1549ae0e.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 9c1bf6d01ca307b7a9b91e181ad7f341862e5e1c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Sep 4 23:31:44 2009 +0100

    i830: do not use stale mask transform
    
    Not only were incorrectly falling back if we had non-affine
    transformations, but we made the decision based on a stale transformation
    matrix.
    
    Related bug 22877:
       batch_start_atomic horribly breaks performance after a while
       https://bugs.freedesktop.org/show_bug.cgi?id=22877
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Tested-by: Maximilian Grothusmann <maxi@own-hero.net>

commit e903b3ebad29d943c05ff550940034c3a43e0235
Author: Matthias Hopf <mhopf@suse.de>
Date:   Thu Sep 3 16:34:08 2009 +0200

    Don't set backlight level if going on->on.
    
    Otherwise changed backlight will be reset upon DPMS switch off, because first
    this function is called with DPMSModeOn.

commit 91f26937c1a3a4f33da86aa6b62ab9b288a54e15
Author: Matthias Hopf <mhopf@suse.de>
Date:   Tue Aug 18 18:44:38 2009 +0200

    Use "Backlight" as backlight brightness property.
    
    BACKLIGHT is now deprecated, though still usable.

commit dbc8944ee9e6755ab11dfc7375c3394f531a49ce
Author: Matthias Hopf <mhopf@suse.de>
Date:   Tue Aug 18 18:34:45 2009 +0200

    Add get_property support.
    
    So far only BACKLIGHT is changed.

commit c18fc7955dc2aec878dd3bea1d51aaecf3f08858
Author: Matthias Hopf <mhopf@suse.de>
Date:   Tue Aug 18 18:05:45 2009 +0200

    Don't ignore backlight level change to the same level.
    
    If set externally to a different level, this would result in a no-op.
    OTOH if the display is switched off (DPMS) you do not want the change to take
    place immediately, but rather to be saved and set later when the display is
    active again.

commit fe7693c94a396b9d17bb66a000178750a432ce3a
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Wed Sep 2 22:57:33 2009 +0800

    Make DGA optional
    
    As DGA is optional in xserver, we should check this too instead
    of always trying to init DGA.
    
    Found when update xserver to 6fffcd5825454a7fe58ffbcfb219f007cf38e731,
    but not update xf86dgaproto, which caused X fails to start.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 5812531e08147576de776b2dd64e7f94c08eb851
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 31 11:20:23 2009 -0700

    debug: i830_valid_command: Return invalid for subopcodes with no name
    
    Previously the code would always return the count, before ever looking
    into the _3d_cmds table to see if there was actually a valid command.
    
    Thanks to Alan Coopersmith who reported that the code was confusing
    parfait:
    
    https://bugs.freedesktop.org/show_bug.cgi?id=21666

commit 7c48c21b22bf5862c5a35bda1635753cc5a7197c
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Aug 27 09:47:12 2009 +0800

      set correct value for indirect access check bound

commit 6361c3b9af39265df9222b1f3b6fb9c4197087c1
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 25 19:23:27 2009 -0700

    Fix SHM functions to work with server after 1.6.0
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 2786a66719a6dbb735eb7c551c412475c30ffa51
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 25 18:35:54 2009 -0700

    KMS: allocate one bo per crtc for cursor
    
    The KMS API doesn't provide for sharing a single bo for multiple
    cursor images, so allocate one bo for each crtc to hold the cursor
    image. KMS also only supports ARGB cursors, so don't bother to
    allocate buffers for two color cursors.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit e51126c57132492c664f86981c55b166dbb54c79
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 25 18:34:25 2009 -0700

    Add cursor registers to debug dump output.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 5fa8d04d9c86f343802c05bd3e11c6e733f01b63
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 25 18:33:04 2009 -0700

    Reload cursors as needed when setting new modes.
    
    Cursor images may need rotation, or positions updated when new modes
    are set. The server provides a convenience function,
    xf86_reload_cursors for precisely this purpose. Just call it after the
    new mode is set.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 1fc3f467ab3edd405adc569ac7f629077e6ffb9d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 25 09:46:10 2009 -0700

    Add KMS only build flag
    
    Rather than refactoring all our init code only to have it go away when
    we remove UMS, this patch adds a build time flag to allow the driver to
    assume KMS support.
    
    With this flag active, the driver will not request that I/O or MEM be
    enabled at probe time, which can allow the server (if other drivers also
    cooperate) to run as a non-root user.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 5dccd1be3ab80b642ef2022446f5bdc1656ed943
Author: Wu Fengguang <fengguang.wu@intel.com>
Date:   Fri Aug 21 14:57:11 2009 +0800

    Add HDMI audio registers
    
    Dump some of the audio registers at server startup time.
    
    (II) intel(0):           AUD_CONFIG: 0x00000004
    (II) intel(0):     AUD_HDMIW_STATUS: 0x00000000
    (II) intel(0):       AUD_CONV_CHCNT: 0x00000000
    (II) intel(0):        VIDEO_DIP_CTL: 0x20000600
    (II) intel(0):        AUD_PINW_CNTR: 0x00000040
    (II) intel(0):          AUD_CNTL_ST: 0x00002000
    (II) intel(0):          AUD_PIN_CAP: 0x00000094
    (II) intel(0):         AUD_PINW_CAP: 0x004073bd
    (II) intel(0):   AUD_PINW_UNSOLRESP: 0x80000008
    (II) intel(0):     AUD_OUT_DIG_CNVT: 0x00000001
    (II) intel(0):        AUD_OUT_CWCAP: 0x00006211
    (II) intel(0):          AUD_GRP_CAP: 0x00000004
    
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>

commit 38e97d2366738e83e76c72353b65edb13a9d2c7f
Author: Wu Fengguang <fengguang.wu@intel.com>
Date:   Fri Aug 21 11:31:13 2009 +0800

    Add intel_audio reg dumping program
    
    It can dump HDMI audio registers for G45.
    
    Signed-off-by: "Wang, Zhenyu Z" <zhenyu.z.wang@intel.com>
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>

commit 6955fc7a74edf6034a292c31a304577c35e925e6
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Thu Aug 20 16:48:58 2009 -0400

    kms: Don't use fb offset when using shadow buffer

commit 465a4ab416b2e5ad53b96702720331a44fffa2fe
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 12 19:29:31 2009 -0700

    Align the height of untiled pixmaps to 2 lines as well.
    
    The 965 docs note, and it's probably the case on 915 as well, that the
    2x2 subspans are read as a unit, even if the bottom row isn't used.  If
    the address in that bottom row extended beyond the end of the GTT, a
    fault could occur.
    
    Thanks to Chris Wilson for pointing out the problem.

commit a3962e6f74ddd954ae1390d150a347745d7bdb24
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 18 10:56:50 2009 -0700

    Print block length of backlight table
    
    For debugging VBIOS dumps

commit 320f21669900f99a7daf8f2294f37be9ad71d05f
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 17 15:19:41 2009 -0700

    Dump LVDS backlight info from bios_reader
    
    Add LVDS backlight and power VBT structures and dump from the BIOS reader.

commit a50916530426a662f5ed262892080b860a445da3
Author: Matthias Hopf <mhopf@suse.de>
Date:   Mon Aug 17 15:53:15 2009 +0200

    Add BACKLIGHT property support in KMS case.

commit 376397c21eb9a7e4ea79d349af41da81c1af861f
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Aug 18 10:01:12 2009 +0800

    Fix VGA plane disabling
    
    Only apply on G4X with SR01 bit5 workaround for VGA plane disable, and
    restore behavior back for other chips to make sure other modes got disabled
    too.
    
    For bug #17235, #19715, #21064, #23178
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 926c7e7d30458078f8185d4e0b9b32b40102b3d5
Author: Matthias Hopf <mhopf@suse.de>
Date:   Thu Aug 13 13:59:55 2009 +0200

    Add HP Mini 5101 to quirks list.

commit 713820197755ea53003b36a920922c3c525eeeea
Author: Adam Jackson <ajax@redhat.com>
Date:   Tue Aug 11 14:50:03 2009 -0400

    Fix the chip names printed in the log to be less obnoxious.
    
    Names taken from pci.ids.  Pineview appears to be a platform not a GMCH,
    so use the G/GM convention to distinguish.

commit e8f0763d405a8152c74c28792c52fe12c1d41dd5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 7 18:24:44 2009 -0700

    Fix math in the tiling alignment fix.

commit 222b52ef16895823fbf3a0fc0be4eb23b930ed1b
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 7 18:05:29 2009 -0700

    Align tiled pixmap height so we don't address beyond the end of our buffers.

commit 62494407e529cfa68529b7267155a12d75418f21
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Thu Aug 6 13:52:54 2009 +0800

    Fix typo in bios_reader for invalid pointer cast
    
    Fixed locally for af45482a52999b52bf41468c458808e30c100e35, but pushed
    wrong commit.

commit 79b6851148574419389ac8055b0c31b8bdac3ab3
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 5 12:45:16 2009 -0700

    Fix sampler indexes on i965 planar video.
    
    We only set up one sampler, because all of our sampling is the same.  By
    using a non-zero index for the other two samplers, we'd dereference (likely)
    zeroed data, resulting in using NEAREST filtering.  This was a regression in
    40671132cb3732728703c6444f4577467fa9223f which incidentally switched from
    having 6 samplers to 1.
    
    Bug #22895, #19856

commit f4e4c1a8544e264c5a1da02f4e7990a1beecf71e
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Aug 5 15:00:37 2009 +0800

      It seems that indirect data upper bound check in STATE_BASE_ADDRESS
      is not acting like what bspec told on 965gm.
      G45+ follow bspec, but we have to set it to a large value for 965gm.

commit af45482a52999b52bf41468c458808e30c100e35
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Fri Jul 24 10:44:20 2009 +0800

    Calculate the DVO relative offset in LVDS data entry to get the DVO timing
    
    Now the DVO timing in LVDS data entry is obtained by using the
    following step:
        a. get the entry size for every LVDS panel data
        b. Get the LVDS fp entry for the preferred panel type
        c. get the DVO timing by using entry->dvo_timing
    
        In our driver the entry->dvo_timing is related with the size of
    lvds_fp_timing. For example: the size is 46.
    
        But it seems that the size of lvds_fp_timing varies on the differnt
    platform. In such case we will get the incorrect DVO timing because of
    the incorrect DVO offset in LVDS panel data entry.
    
    Calculate the DVO timing offset in LVDS data entry to get the DVO timing
        a. get the DVO timing offset in the LVDS fp data entry by using the
    pointer definition in LVDS data ptr
        b. get the LVDS data entry
        c. get the DVO timing by adding the DVO timing offset to data entry
    
    https://bugs.freedesktop.org/show_bug.cgi?id=22787
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 50e2a6734de43a135aa91cd6e6fb5147e15ce315
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 28 18:26:25 2009 +1000

    intel: drop RES_SHARED_VGA not needed anymore

commit f3387310f312a4a9e1d691974834c3d290c2fa32
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 28 18:27:10 2009 +1000

    xserver: fix up for stable build
    
    reported by Arkadiusz Miskiewicz <arekm@maven.pl>

commit 9bc0096f9de4b85ca6d6a5db109e49c4364bcee7
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 28 13:55:39 2009 +1000

    intel: since driver depends on newer server don't need to wrap this
    
    drop resource/RAC interactions

commit 9a3b568d62a0b48f4a42ea5377740b2df1af432a
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 28 13:32:30 2009 +1000

    intel: update for resources/RAC API removal

commit 3418c6c16b108e45f67f3c868d28932266f7a0bc
Author: Krzysztof Halasa <khc@pm.waw.pl>
Date:   Tue Jul 28 10:47:44 2009 +0800

    h/v bias in 3DSTATE_DEST_BUFFER_VARIABLES is 4-bits wide
    
    Fixes bug #22370

commit 378445738494663f2ee1615598d4c77b870745af
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Jul 28 10:10:13 2009 +1000

    intel: remove unneeded includes
    
    none of these need the resource includes

commit 8084f76d86f048ca5b82da089fffa9665dbbcdd5
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Jul 26 13:14:05 2009 -0700

    Allow DRM mode setting to include transformations
    
    This removes the explicit transform disabling code in drm_set_mode_major.
    Without a fixed X server, transforms will still be broken, but even a fixed
    X server can't work around this driver bug.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 9a45ace207199eb40e95dc6d2670b3096e66ecd9
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 23 11:09:53 2009 +0800

    XvMC: enable XvMC/XvMC-VLD on IGDNG

commit 043b4a866ab51acffc52d2d71db3475007747571
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 23 11:07:13 2009 +0800

    add compiled shader programs for XvMC/XvMC-VLD on IGDNG

commit 7684adaa370e8b0bd22e6e7dd1d5fa05f6142bab
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 23 10:57:22 2009 +0800

    Check the version of intel-gen4asm tool in configure.ac

commit 7dc95b4f1dfecbeb7e9f4a0c35fda32d020be8fe
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Jul 24 10:39:05 2009 +0800

    XvMC: pin XvMC buffers under KMS.
    
    Under KMS, the buffer allocated by i830_allocate_memory
    isn't pinned anymore. However currently 915 XvMC needs
    static offsets.
    
    Fixes bug #22872

commit 12c5aeca7a3db92d3522d00f5daf338d522e2176
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 16 13:34:09 2009 -0700

    8xx render: Add limited support for a8 dests.
    
    This improves aa10text performance from 74k to 569k on my 855 laptop.
    This also causes my 865 to hang on aa10text like it does on rgb10text,
    thanks to actually hitting render accel.

commit 6b7728491c3b771bcba2c7ffd75330c0a0b37f44
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jul 15 16:38:07 2009 -0700

    Only align DRI2 tiled pixmaps to the DRI2 tiled pixmap alignment requirement.
    
    This should save significant amounts of memory for glyph and other small
    pixmap storage.
    
    Bug #21387

commit 22f7cbc32b70a89d55c79bbea39fb10c50a310ec
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 9 23:56:22 2009 -0700

    uxa: Tell the driver when we're just going to immediately map the pixmap.
    
    This lets the driver allocate a nice idle buffer object instead of a
    busy one, reducing runtime of firefox-20090601 on my G45 from 50.7 (+/- .41%)
    to 48.4 (+/- 1.1%).

commit 5ef3db45e059df136162584d00d4b0b511456a33
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 9 19:24:38 2009 -0700

    uxa: Skip fill of temporary alpha picture that just gets copied over.
    
    This was needed when we were doing the mask computations in this pixmap,
    but now they're done in a temporary and then uploaded later.
    
    This reduces runtime of firefox-20090601 from 52.6 (+/- .96%) to 50.7
    (+/- .41%) seconds on my G45.

commit 6f3fc6b20f3daedab02e31f49678d4d2ff0fa7a3
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Jul 21 12:32:10 2009 -0700

    drmmode_output_get_modes: Replace existing EDID property blob with new one
    
    This synchronizes the X EDID data with the kernel EDID data each time the
    kernel data may have changed. Otherwise, X ends up stuck with the first EDID
    data it sees, failing to accomodate to different monitors.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 840a787a191b31ece5068e10daed04bee70bb1a2
Merge: 0a4c4c5 5d50a94
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 20 23:00:06 2009 -0700

    Merge branch '2.8'

commit 5d50a949b3c5d0ad2bc4cf48ab25da1f707a4f6f
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 20 22:59:37 2009 -0700

    Increment version number to 2.8.0 for release.

commit b12220bd81f3a0509a3746dac3258e53f3879b23
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 20 22:59:02 2009 -0700

    NEWS: Add notes for 2.8.0 release
    
    Many thanks to Gordon for his notes from http://intellinuxgraphics.org/2009Q2.html

commit 0a4c4c5fe8ebad2dd13f5770bd90a194eebb2890
Author: Peter Hutterer <peter.hutterer@who-t.net>
Date:   Thu Jul 16 11:40:15 2009 +1000

    Update to xextproto 7.1 support.
    
    DPMS header was split into dpms.h (client) and dpmsconst.h (server). Drivers
    need to include dpmsconst.h if xextproto 7.1 is available.
    
    SHM is now shm.h instead of shmstr. Requires definition of ShmFuncs that's
    not exported by the server.
    
    Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>

commit 57c7cbade9556e7b21867e61353f0928fd553616
Author: Owain Ainsworth <zerooa@googlemail.com>
Date:   Thu Jul 16 20:38:43 2009 +0100

    accessing a pixmap if prepare_access fails is verboten.
    
    Don't do it, treat this the same as every other prepare access call in uxa.
    
    Reviewed-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Owain Ainsworth <zerooa@googlemail.com>

commit bb3007384298cb57625ec0b3868dff9b23568f3e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 16 12:56:07 2009 -0700

    Really fix i915 render.  Fail at commit --amend.

commit 8dd7ccf37e2de6d80b556e6d18af244cefc1e417
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 16 11:40:51 2009 -0700

    Fix 915-class Render after the 8xx-class Render fix.
    
    The two shared i830_composite.c, so giving i830 atomic batch support
    triggered anger about starting i830's atomic area while in i915's atomic
    area.  Instead, split the emit-a-primitive stuff from the state emission.

commit a1e6abb5ca89d699144d10fdc4309b3b78f2f7a9
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jul 15 14:15:10 2009 -0700

    Use batch_start_atomic to fix batchbuffer wrapping problems with 8xx render.
    
    Bug #22483.

commit e386e7b14b139f15205e14b173e8222bf38d9e18
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 15 09:43:04 2009 -0700

    Reset framebuffer offset when rebinding aperture (22760).
    
    scrn->fbOffset may be changed when binding objects to the aperture during
    server initialization or VT enter. This was accidentally removed when the
    NoAlloc option was eliminated.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit b74bf3f9a65af9e72921d4e9028d9d4d023f8bc6
Author: Barry Scott <barry.scott@onelan.co.uk>
Date:   Mon Jul 13 16:34:20 2009 -0700

    Fix XV scan line calculation when rotated.

commit 82905c7c0b871a97ec435a765c2ca407903ba595
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 13 05:29:49 2009 -0700

    Increment version to 2.7.99.902

commit 925bc6cbd430a00928fac2ef58724dd37c3bc349
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 13 05:27:40 2009 -0700

    RELEASING: Fix typo in instructions

commit 67c0afc7b7446a7b98aa7c65043ddba4c7c72b82
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 13 05:27:06 2009 -0700

    NEWS: Add notes for 2.7.99.902

commit 34c674dd45879b8ba8395b93b16c8a9e7b848f1f
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Jul 11 22:53:42 2009 -0700

    Remove vestiges of NoAccel options from i830_driver.c
    
    The enum and OptionInfoRec weren't removed in the initial patch
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 33d6e7a2355dfb8ad324c4fa28ce61c7e051b435
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Jul 11 22:53:11 2009 -0700

    intel.man: Mark NoAccel option as i810/i815 only
    
    The NoAccel option is not valid for other chips.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ed8a9a94e1a670ca35311c9ed83d0c479530d41a
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jul 10 17:13:14 2009 -0700

    i830_uxa_prepare_access: Flush and wait for idle for non-bo pixmaps
    
    Without kernel support and explicit knowledge about where in the ring the
    last rendering operation for a specific pixmap was, we must synchronize with
    any outstanding rendering before accessing a pixmap which does not have a
    buffer object.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit cb19ac207b784d814f6f389110fd1b21a0f34e8b
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jul 10 14:01:02 2009 -0700

    KMS: Keep screen pixmap devPrivate.ptr NULL during init and resize
    
    The frame buffer only has a valid address between prepare_access and
    finish_access calls, so remove all other attempts to compute an address from
    the driver.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 704b88dd50a7e7e3f362264b86d0401bee8603aa
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 8 13:06:47 2009 -0700

    i830_bind_memory: Under UMS: Bind GEM bos with dri_bo_pin, else through the GART
    
    We only need to get static offsets for objects when not running KMS,
    otherwise the kernel will manage those as needed for us.
    
    Binding objects is done in one of two ways. For GEM buffer objects, we use
    dri_bo_pin. For GART allocated memory, we bind that to the GART.

commit 7b273732f70e91df8b41d5c48e1379271557dd8e
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 8 11:53:13 2009 -0700

    Allocate GTT space for GEM only under UMS
    
    GEM requires GTT space to map objects. Under KMS, the kernel driver has
    already provided all available GTT space to GEM, so the X server need not do
    anything.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 56bfee8705f5d7d965227013b205dbc4c93e220c
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jul 10 14:49:20 2009 -0700

    Always set screen pixmap data pointer at init and resize times
    
    For non-DRM environments, the screen pixmap will be GART allocated memory
    and not a libdrm buffer object and so uxa will only use devPrivate.ptr to
    find the associated memory. Make sure devPrivate.ptr is set each time the
    framebuffer is allocated so that uxa will be able to draw to it.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 98087a0b966d5dc69faf72719153a2c878ba3de1
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 8 11:47:25 2009 -0700

    Make xorg.conf DRI option work under KMS. Fix name of I830AccelMethodInit
    
    KMS mode does not call I830AccelMethodInit as that does the user
    modesetting initialization (yes, it was misnamed), but that means that the DRI option
    was ignored. Create a new i830_check_dri_option function to do the option
    detection, then remove that from I830AccelMethodInit, which is renamed
    i830_user_modesetting_init to reflect what it actually does.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit d655a3ff423e69c19a5dc07140cbf3caaa32cb86
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 8 18:06:40 2009 -0700

    Remove NoAccel support
    
    This removes yet another 'debugging' option that hasn't seen real use in a
    long time, and wasn't supported under KMS in any case.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 4e4b947f0b13f4a62606ccfd5729d5eb26ca0e92
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 9 15:52:16 2009 -0700

    Remove bad comment about 3DSTATE_DRAWING_RECTANGLE size.

commit 9155cfca75a207bce0fad945f32f0cb33eab8c4e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 9 14:16:07 2009 -0700

    Fix lols in trying to figure out whether this is a 64-bit build.
    
    Noticed by:	Michel Dänzer <michel@daenzer.net>

commit 40e7c9505265823786cf730214db84812a5e494e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 6 11:54:50 2009 -0700

    Refuse to allocate giant BOs on 32-bit systems.
    
    The overcommit of address space combined with these buffers hitting SW
    fallbacks all the time means that we're probably better off telling the
    application "no" instead of likely silently failing later.
    
    Bug #22601.

commit 6337cd23e692cae789d07f429442c425c18e1d4f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jul 1 15:54:38 2009 -0700

    Initialize the other argument to drmSetInterfaceVersion.
    
    The kernel ignores it if dd_major is -1, anyway.

commit 216d939858abc924f2e32c95518f937f29ea018e
Author: ling.ma@intel.com <ling.ma@intel.com>
Date:   Tue Jul 7 14:26:02 2009 +0800

    enable sdvo lvds scaling function
    
    Currently we implemented basic sdvo lvds function,
    But except for sdvo lvds fixed mode, we can not switch
    to other modes, otherwise display get black. The patch
    intends to work for all modes whose HDisplay and VDisplay
    are lower than fixed mode.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 0402f4f331148084552bd3963dbcb3fb900be8ea
Author: Simon Farnsworth <simon.farnsworth@onelan.co.uk>
Date:   Thu Jun 18 12:33:47 2009 +0100

    Raise XV limit to 2048x2048 to match hardware limits.
    
    The bigrequests limit isn't present in current X servers (tested using
    textured video on a 965 with both image and window at 2048x2048 on a
    1920x1200 display, and image at 2048x2048, window at 1024x1024).
    
    Remove the artificial limit, enabling full-screen HD video when
    rotated.

commit a66357832388ba9db21a4b3bf8311d9d1f1ab308
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Jul 7 14:13:57 2009 -0700

    non-DRI FB resize failed to assign the screen pixmap devPrivate.ptr (22328)
    
    When not using DRI, the screen pixmap is not in a bo, and so the usual
    enable/disable access functions don't adjust the pixmap devPrivate field,
    leaving it to the frame buffer allocation code to assign this correctly.
    
    During mode setting and fb resizing, FB access is disabled, and the
    screen pixmap devPrivate is stashed away by xf86EnableDisableFBAccess,
    to be restored when FB access is turned back on. This means that we have to
    set the pixmap devPrivate.ptr (in case xf86EnableDisableFBAccess doesn't
    do this), along with storing the address in the scrn->pixmapPrivate field.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit c889b34e432198d5410a068eff3089ff5314ac27
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue Jul 7 18:05:01 2009 +0100

    Check for a valid I830Ptr before closing master.
    
    After failing to become DRM master, the X server dies attempting to close
    the master fd during free:
    
    (EE) intel(0): [drm] failed to set drm interface version.
    (EE) intel(0): Failed to become DRM master.
    (EE) intel(0): failed to get resources: Bad file descriptor
    (EE) intel(0): Kernel modesetting setup failed
    
    Backtrace:
    0: X(xorg_backtrace+0x3b) [0x8133a3b]
    1: X(xf86SigHandler+0x55) [0x80c7945]
    2: [0xb805d400]
    3: /usr/lib/xorg/modules/drivers//intel_drv.so [0xb7b4bfcc]
    4: X(xf86DeleteScreen+0x6b) [0x80d465b]
    5: X(InitOutput+0x548) [0x80b0158]
    6: X(main+0x1cb) [0x807220b]
    7: /lib/tls/i686/cmov/libc.so.6(__libc_start_main+0xe5) [0xb7d107a5]
    8: X [0x8071881]
    Saw signal 11.  Server aborting.
     ddxSigGiveUp: Closing log
     ddxSigGiveUp: re-raising 11
    Segmentation fault
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 705042f497b7b3843c2dcc5c160fb8dfeac1472a
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Jul 6 13:49:31 2009 -0700

    Handle DRI2INFOREC version 3
    
    This DRI2 version does not support the old CreateBuffers/DestroyBuffers
    interface anymore.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 2ebc7d32e47b5edd5b776c39f936ed4e053caac2
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Jul 2 13:13:14 2009 -0700

    Update to multi-API DRI2 interface
    
    The DRI2 interface was changed to support both old and new drivers in an
    API/ABI compatible fashion. This change syncs the intel driver with the new
    version of the DRI2 API.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit f6f79eb629184366b1355743d601129a526da90c
Author: Rémi Cardona <remi@gentoo.org>
Date:   Mon Jul 6 11:01:31 2009 +0200

    remove unused shader program
    
    This file is not even referenced by any Makefile.am
    
    Acked-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 7e722ada533777c5e9ddf44bb4d770bacf8e13bf
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Mon Jul 6 16:25:13 2009 +0800

    Disable FBC on IGDNG
    
    Don't make FBC count for memory allocation.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 74227141923a2f5049592219ab80e8733062a5d9
Author: Barry Scott <barry.scott@onelan.co.uk>
Date:   Tue Jun 23 14:14:50 2009 +0100

    Fix segv for clipped movie window
    
    When playing a movie that is clipped on its left and right edges the Xorg
    server will SEGV sometimes. This is because the intel driver ignores the
    clipping info when it copies the planes out of the XV data.
    
    The check for the optimised copy was wrong to ignore the width required.
    Which leads to too much data being copied by the memcpy. It the source buffer
    happens to end exactly on a page boundary the server will SEGV.
    
    As we reviewed the code we checked the calculation of src1, src2 and src3.
    The patch includes additional comments to make it clear what the elements of
    the calculation are.
    
    This bug exists in git head and we also see it in 2.4.1.
    
    Barry
    
    Reviewed-by: Ian Romanick <ian.d.romanick@intel.com>

commit c1755599db1d9a20954b84ccc07afd892bb6ac9e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Jul 2 13:04:51 2009 -0700

    Clear the bo on the rotate scratch pixmap
    
    Since the scratch pixmap header will be re-used after allocation, we
    need to clear its bo attachment when we stop using it, otherwise a later
    user will use a bogus bo.
    
    Reviewed-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 324b4686204feb3a7370eeecaff8ba44635f73ca
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Jul 2 14:15:37 2009 +0200

    Xv i830_display_video splitup: extract i830_update_scaling_factors
    
    Just moved the code, no other changes.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit c2410addbfb99fcd7069591d9f387c35ed760522
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Jul 2 14:15:36 2009 +0200

    Xv i830_display_video splitup: extract i830_update_polyphase_coeffs
    
    To slightly clean up the implementation of i830_update_polyphase_coeffs,
    introduce the two small helper functions i830_limit_coeff and
    i830_store coeffs_in_overlay_regs.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Ian Romanick <ian.d.romanick@intel.com>

commit 795c11c49cf10525f02127a3629d35378d802fa7
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Thu Jul 2 14:15:34 2009 +0200

    Xv i830_display_video splitup: extract i830_update_dst_box_to_crtc_coords
    
    Just moved the code ouf of line.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 4100abdf5d208bbcbb4ceabad0572c04221443c9
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Jun 30 13:12:45 2009 +0200

    Xv: kill !textured condition
    
    This is in the overlay path and therefore always true.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit b0df0fe91e2b800ed096f369850aa1af4be2f157
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Jun 30 13:12:44 2009 +0200

    Xv overlay: implement GAMMA5 errata
    
    - also ensure that the most significant byte is zero
    - while I was looking at the code, add the Overlay suffix to
    SetPortAttribute like in the textured case.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 5ef4d3cde1335350d82469ebbaed1b547a59552c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Tue Jun 30 13:12:43 2009 +0200

    Xv: kill unneeded indirection
    
    overlay and textured video have the exact same QueryImageAttributes
    function.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 1e4784bf26e3c154f5673f7b5add3ef7af3b1474
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 30 19:52:36 2009 -0700

    uxa: Fix segfault on source-only picture usage with FallbackDebug.
    
    Bug #22107.

commit 7e79fc8aa93df4df37c25cf37ee0ec6c7caca1d9
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Jun 30 15:40:34 2009 +0800

    Fix 945GM VT switch in UMS
    
    Bug #19578. We should set private intel_crtc state according
    to current, as fail to do so pipe A needs active won't be taken
    care of. Also make sure pipe swap operation always set during
    VT switch.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 50392ac8234d643c8a99e1753bdb196c0062a891
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon May 18 13:53:33 2009 +0800

    Load fbcon too if kernel mode setting is checked on
    
    If i915 module has already been loaded and kms check is true,
    it would be nice to load fbcon module too.
    
    Signed-off-by: Zhenyu Wang <zhenyu.z.wang@intel.com>

commit 058ad9e6ab4a00ff66046d94c2129056011ebee9
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 30 16:02:19 2009 -0700

    Don't try to pin buffers in KMS mode
    
    The only things we try to pin in KMS mode are the cursor objects and
    front buffer, and those are taken care of by the kernel anyway, so we
    shouldn't even bother trying to pin them (well, not entirely true,
    XvMC tries to pin as well, but it needs work w/KMS anyway).
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit cec9fc6f6cffce186606f39982d0d78ff7c63bbf
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 30 12:27:59 2009 -0700

    Make KMS set_resource function return TRUE
    
    This is what's expected by the server, and allows the EDID for example
    to be exported in the KMS case.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 53e248af4365232416d2143a791a07c6751f8319
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 30 12:00:28 2009 -0700

    Use DVO timing block instead of fp_timing when parsing LFP data
    
    The KMS side was correct, but the UMS patch was broken.  We need to use
    the DVO timing block of the LFP data to get the timing, not the
    fp_timing block.
    
    Fixes fdo bug #22529.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 362883c2f9a3442f7678e6e815f41b21baaa3f53
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jun 29 16:26:15 2009 -0700

    Add a few error messages for DRM initialization
    
    Makes it easier to see where things go wrong.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit afac333bef4a0ac934f0e4d933dc5053d81ca88c
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Jun 30 11:10:52 2009 +0800

    Remove unused packed yuv sampler shader programs
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 150c9adebc0b502f19c970783f411928e5a5c3b1
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Jun 30 10:42:41 2009 +0800

    Xv: fix domain usage for binding table on i965+ chips
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 7770958e42d60966d95702e75c704e20ae2d90dd
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Tue Jun 30 10:41:26 2009 +0800

    Add XV support on IGDNG
    
    This brings necessary change for IGDNG for texture video support
    from 2D render code.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit f806fe7d675b966680a63406167ce37e4f8a1ae8
Author: Xiang Haihao <haihao.xiang@intel.com>
Date:   Thu Jun 25 15:39:32 2009 +0800

    Enable 2D composite on IGDNG
    
    This patch enables 2D composite on IGDNG. IGDNG requires
    new compiled shader programs for Gen5 and some command changes.
    The most notable is the layout of vertex element has changed,
    but we tried to keep it as origin to not change shader programs.
    Also vertex buffer state requires end address of vertex buffer
    instead of origin max index.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 9fb34012f667e37f480085696ef9c2632d6eb7e1
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Thu Jun 25 15:30:04 2009 +0800

    Add new compiled shader program for IGDNG
    
    Also check intel-gen4asm tool here for new -g option, which is
    required to compile new programs.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 488acc4595bb7f40130afcb8bcb05656ff3ae82c
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Thu Jun 25 14:05:40 2009 +0800

    Move shader programs under its own subdirectory
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 170cae0c8d58fc141de1d8a2f17a4328d39c1263
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jun 29 12:55:43 2009 -0700

    Only get the VBIOS in non-KMS mode
    
    In KMS mode, the kernel takes care of this for us, so don't bother.

commit 6511c082459789cf279e7a4528775a1c821ad8cc
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jun 29 12:53:51 2009 -0700

    Output error info if we fail to get DRM resources
    
    Useful for debugging.

commit 00eb73286c3512a362dce00efdeae740772d0dcd
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jun 29 09:12:28 2009 -0700

    Use swapbuffers_wait control
    
    Commit 1eec83a203c48822400742a1fb184b2cb52c62f7, which added the new
    SwapbuffersWait option, didn't actually include the code which used it.  So
    add a test to DRI2's CopyRegion call, only emitting the scanline wait
    command if the swapbuffers_wait option is set.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit f53b3239dbc0ed723774e386e07ac9d8ce96bb89
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Thu Jun 25 10:22:23 2009 +0800

    Disable XvMC on 915G/GM in KMS
    
    These chips require physical address for XvMC surface, which
    is not available in KMS case. Instead of crashing X, disable it now.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit f0270bbb47baed78a0ff6189ae20d3ac322ec02b
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Jun 24 14:42:08 2009 -0700

    Fix i830_crtc_on to only check outputs associated with the given CRTC
    
    Otherwise we may end up returning a false positive if some other output & crtc
    are on, but not the one in question, again leading to hangs.
    
    Reported-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 5d80e24b5fc6d6028028da6ded35389c08bfce29
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Jun 24 13:12:25 2009 -0700

    Treat disabled CRTCs as "not covering" for scanline wait purposes
    
    Now that swapbuffers does a scanline wait to avoid tearing, it's
    important to take into account the CRTC status to avoid hangs.  If we
    do a scanline wait when the CRTC is off (due to DPMS for example) we'll
    hang the GPU.  So add some code to check the CRTC DPMS status to the
    i830_covering_crtc function, returning NULL if none of the covering
    CRTCs are actually active.  KMS vs UMS logic is hidden in new i830*
    functions, cleaning up both DRI2 & video paths a bit.
    
    Fixes fdo bug #22383.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 6d025e679a99778496576af9a6a6fa8c043ae811
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Tue Jun 23 09:53:14 2009 -0700

    Harden i830 render in case check_composite didn't throw out bad formats.
    
    Fixes a warning in a static analysis program, and the code's a little
    clearer.
    
    Bug #21667

commit 1eec83a203c48822400742a1fb184b2cb52c62f7
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 23 15:05:03 2009 -0700

    Add option to control swapbuffers behavior
    
    Until we get triple buffering, we'll want this so users can avoid taking a
    performance hit on apps that render slower than the refresh rate.
    
    Fixes fdo bug #22234.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit bfeeac6de096256fca82244338bb45d53ee53cbc
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Jun 23 11:31:37 2009 +0800

     i915 xvmc, fix fd.o bug #22103

commit 15af8ea6ab6998bbab9f4eeda227565c409da229
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jun 22 11:11:06 2009 -0700

    Fix LFP data block fetch
    
    Apparently the proper way to do this is to use the LFP data pointer block to figure out the LFP data block entry size, then use that plus the panel index to calculate an offset into the LFP data block array.
    
    Fixes fdo bug #19450.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 534e73ad4f234a04755917f2bf17ba821c27eb52
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Thu Jun 18 09:46:32 2009 +0800

    Don't change the blank/sync width when calculating scaled modes
    
    Don't the change the blank/vsync width while doing LVDS scaled modes.
    And use the border instead of border minus one.
    
    At the same time, make sure the horizontal border and hsync are even for
    the LVDS that works in dual-channel mode. So both horizontal border and hsync
    start are also changed to be even, even for the LVDS in single-channel
    mode.
    
    https://bugs.freedesktop.org/show_bug.cgi?id=20951
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit b5cd2130f97591f4a387db1b98c940c30bc6404c
Author: ling.ma@intel.com <ling.ma@intel.com>
Date:   Tue Jun 16 16:52:25 2009 +0800

    TV: Set correct voltage level override values
    
    We detect TV connect status by setting DAC voltage level override
    values as 0.7 voltage for DAC_A/B/C. The corresponding 2-bits shold be 0x2,
    In order correctly to set last bit as 0, at first we must clean it.
    
    It fixed freedesktop.org bug #21204
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit a6cdcd9fee0164f79075063fd163d142a55fcbc5
Author: ling.ma@intel.com <ling.ma@intel.com>
Date:   Tue Jun 16 16:47:52 2009 +0800

    Set hot plug interrupt to detect HDMI output
    
    We detect HDMI output connection status by writing to HOT Plug Interrupt
    Detect Enable bit in PORT_HOTPLUG_EN. The behavior will generate an specified
    interrupt, which is caught by audio driver, but during one detection driver
    set all Detect Enable bits of HDMIB, HDMIC and HDMID, which generate wrong
    interrupt signals for current output, according to the signals audio driver
    misunderstand device status. The patch intends to handle corresponding output
    precisely.
    
    It fixed fredesktop bug #21371
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 6b93afc564a5e74b0eaaa46c95f557449951b3b9
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Wed May 27 03:40:52 2009 -0700

    add pipe a force quirk for Dell mini
    
    Add quirk to solve issue with black screen and hang occuring after closing the
    lid with attached external monitor, on Dell Mini.
    
    Fixes fdo bug #21960.
    
    Signed-off-by: Bryce Harrington <bryce@bryceharrington.org>

commit eb09014ce10428bbcab04e155186382975545f0a
Author: Li Peng <peng.li@intel.com>
Date:   Tue Jun 16 15:29:57 2009 -0700

    don't wait for vblank on rotated displays
    
    We may hang or wait for the wrong line if the display is rotated, so just skip
    the wait in that case.
    
    Fixes fdo bug #22196.

commit 6c56521bdc0443c0656271caaa795feb13bc1d6b
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Wed May 27 05:18:53 2009 -0700

    pipe-a quirk for thinkpad x30
    
    Fixes freeze when closing lid on ThinkPad X30.
    
    Fixes FDO bug # 21976.
    
    Signed-off-by: Bryce Harrington <bryce@bryceharrington.org>

commit 246cec965958e94babf5377e6f221522b05fb458
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:17:28 2009 +0800

    Fix EDID for LVDS output device to add the default modes
    
    Fix the EDID for the LVDS output device to add the default modes.This is
    similar to what we have done in UMS mode.
    a. When there exists the EDID, either find the DS_RANGES block or replace
    a DS_VENDOR block, smashing it into a DS_RANGES block with open refresh
    to match all the defaults modes.
    b. When there is no EDID, we will construct a bogus EDID and add a DS_RANGES
    block with the open refresh to match all the default modes.
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20801
    http://bugs.freedesktop.org/show_bug.cgi?id=21094
    http://bugs.freedesktop.org/show_bug.cgi?id=21346
    http://bugs.freedesktop.org/show_bug.cgi?id=21417
    http://bugs.freedesktop.org/show_bug.cgi?id=21671
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 5d1dc7677004d445a7a781decd8c1ef9747c14fb
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:17:27 2009 +0800

    Get the LVDS panel limit and check whether the given modeline is valid
    
    When the connector type is LVDS, it will traverse the mode list returned by
    KMS kernel to get the LVDS panel limit. Then it will use the panel limit to
    check whether the given modeline is valid. If the given modeline exceeds
    the LVDS panel limit, it will be invalid.
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20801
    http://bugs.freedesktop.org/show_bug.cgi?id=21094
    http://bugs.freedesktop.org/show_bug.cgi?id=21346
    http://bugs.freedesktop.org/show_bug.cgi?id=21417
    http://bugs.freedesktop.org/show_bug.cgi?id=21671
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 115e28639fbf6a1eba636dafac02fadd83036c75
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:17:26 2009 +0800

    Add the private data for the LVDS connector
    
    Add the private data when the connector type is LVDS.
    We can use the private_data to store the LVDS panel limit.
    For example: Hdisplay, Vdisplay.
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20801
    http://bugs.freedesktop.org/show_bug.cgi?id=21094
    http://bugs.freedesktop.org/show_bug.cgi?id=21346
    http://bugs.freedesktop.org/show_bug.cgi?id=21417
    http://bugs.freedesktop.org/show_bug.cgi?id=21671
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 3da549f5b350dd42516e5cb3576f7fefe012d95e
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:37:03 2009 +0800

    GFX: Initialize the SDVO device based on the valid slave address
    
    When the slave address is found for the SDVO port, the SDVO device will
    be initialzied.
    When the slave address is not found for the SDVO port, it will return
    the slave address by using the following flowchart:
    a. If the SDVO device info is found for another SDVO port, it will return
    the slave address that is not used. For example: if 0x70 is used, then 0x72
    is returned.
    b. If no SDVO device info is found for another SDVO port, it will return
    0x70 for SDVOB and 0x72 for SDVOC.
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20429
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 51b87b9913ba164d4d5de79e558233915b37a0a5
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:37:02 2009 +0800

    parse general definition block to get the SDVO device info
    
    The general definition block contains the child device tables, which include
    the child device info. For example: device slave address, device dvo port,
    device type.
    We will get the info of SDVO device by parsing the general definition blocks.
    Only when a valid slave address is found, it is regarded as the SDVO device.
    And the info of DVO port and slave address is recorded.
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20429
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit 6ba148bbd78783f59eed3d898638c39b950dcd89
Author: Zhao Yakui <yakui.zhao@intel.com>
Date:   Wed Jun 10 11:37:01 2009 +0800

    Dynamically get the number of child device in general definition block
    
    The size of general definition block varies on different platform/machines.
    In such case the number of child device is also different.
    And it will be better to get the number of child device in general definition
    block dynamically.
    
    The number of child device can be calculated by the following formula:
    	(block_size - block_header_size) /
    		sizeof( struct child_device_config)
    
    http://bugs.freedesktop.org/show_bug.cgi?id=20429
    
    Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>

commit cdbf84f20295c8a78624318aa6fdfff3f5c8ce27
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Jun 11 13:57:09 2009 -0700

    intel_batch_init: test have_gem, not directRenderingType
    
    Under KMS, directRenderingType will get set to DRI_NONE during driver
    initialization. When the first batch buffer is allocated, as
    directRenderingType is DRI_NONE, the GEM bufmgr would get trashed as
    intel_batch_init called a fake-bufmgr specific function.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 6d062e9e9fc4ac92a5dc2941b4ed0251a1dc6e11
Author: Julien Cristau <jcristau@debian.org>
Date:   Thu Jun 11 17:15:04 2009 +0200

    Fix xvmc build
    
    If we don't find xext.pc, disable xvmc instead of failing configure
    Also add dependencies on xfixes and dri2proto (src/xvmc/dri2.h includes
    <X11/extensions/Xfixes.h> and <X11/extensions/dri2tokens.h>).

commit 9d3c3b056c1d4da6ef7afd3f71a5994fad810632
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Jun 10 15:30:45 2009 -0700

    Increment version to 2.7.99.901
    
    This is the first release candidate for 2.8.0

commit e2622045155f5aa79bacbec8f81c1231194f3033
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Jun 10 15:30:09 2009 -0700

    NEWS: Summarize new developments for 2.7.99.901

commit e5bfa2702a31566fa94fa75f7289d7cbe9825420
Author: Lukasz Kurylo <Lukasz.Kurylo@gmail.com>
Date:   Wed Jun 10 07:55:31 2009 -0700

    DRI2 copyregion: don't wait for scanlines that won't happen
    
    In some configurations, it's possible to wait for a scanline outside of
    a given CRTC range.  Make sure that can't happen to fix multihead cases
    with dead space.
    
    Fixes fdo bug #22203.
    
    Signed-off-by: Lukasz Kurylo <Lukasz.Kurylo@gmail.com>

commit cda5561716891484aa6f1c4a234be8d88f17f659
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jun 10 16:43:30 2009 +0800

      add missing files for previous commit

commit 6d500be3cdecd7617dc6119b58ae273eea478af7
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jun 10 15:53:24 2009 +0800

      enable MC on g45 for player without vld patch

commit 88da9b48737229b305da4423e9aa43a09ccdcfac
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Wed Jun 10 10:45:51 2009 +0800

    Add new chipset register dumps
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 0d56ef94be0592aec9aa83e4a5e4ff13348640c2
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Fri Jun 5 12:59:07 2009 +0800

    Disable composite on new chipset for now
    
    This depends on updated intel-gen4asm be ready for new chip.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 440ccc44f51d3a5d6f46c28cfcc576cad155fbbc
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Fri Jun 5 12:56:04 2009 +0800

    Add new register definitions
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 0d8a9e2c6f58115b9b8449de52e795699ed032af
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Fri Jun 5 12:51:51 2009 +0800

    Update intel_gtt utility for new chipset GTT check
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit fb524caa3e2f1f516717669642bb4b2244f9e7e4
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Mon Jun 8 10:22:14 2009 +0800

    Remove fixed MMIO size
    
    Use pci resource size instead, which will get the correct MMIO range.
    New chipset uses obviously larger MMIO range.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit 4f40b33ef4b069b18a6a18406da83a23ca6e1127
Author: Zhenyu Wang <zhenyuw@linux.intel.com>
Date:   Fri Jun 5 11:57:57 2009 +0800

    Add new chipsets PCI ids
    
    Desktop and mobile version of new chipsets are added.
    Also do memory config like Intel 4 series chipset.
    
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

commit accdbd23676d812d2345f86d8e3ee62f108841ff
Author: Carl Worth <cworth@cworth.org>
Date:   Fri May 29 15:34:20 2009 -0700

    UXA: Rasterize trapezoids to system memory, not a pixmap
    
    Since we're only doing software rasterization right now, anyway, it
    makes more sense to just rasterize to system memory and then upload
    to a pixmap once complete. This avoids expensive read-modify-write
    cycles.
    
    This results in a 2.4x speedup for a real-world test case that's
    heavy on trapezoids, which is swfdec running on the following file:
    
    http://michalevy.com/wp-content/uploads/Giant%20Steps%202007.swf
    
    Many thanks to Chris Wilson for his cairo-traces repository and
    cairo-perf-trace tool which makes it so easy to measure things
    like this.

commit b5e32c9cf896a0b93d193d797a8e83b4aa4691fb
Author: Carl Worth <cworth@cworth.org>
Date:   Fri May 1 13:51:39 2009 -0700

    Rename i830_exa.c to i830_uxa.c
    
    It was just confusing otherwise, (since the EXA code has all been
    removed now).

commit ee539e58c3bf39766c560d625f6e4158d419e64e
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Jun 8 21:14:14 2009 -0400

    Fall back to fb pixmaps for backing glyph pictures
    
    GEM pads pixmaps to 512 byte stride and backs them with a kernel side
    buffer objects.  We typically don't render out of glyph pictures, so
    we're incurring a lot of overhead per glyph by allocating a GEM pixmap
    per glyph.  By looking at the usage hint, we can fall back to
    fbCreatePixmap for pixmaps backing glyph pictures, which gives us
    a nice tight malloced pixmap.  The fast path for text rendering is
    compositing from the glyph cache pixmap to the destination, which
    shouldn't be significantly affected.
    
    Quick bit of testing:
    (firefox-20090601)
        xlib-rgba-before    384512.49:  1.01x
        xlib-rgba-after     389633.94:  1.00x
    The difference being within the margin of error for the benchmark.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>
    Tested-by: Chris Wilson <chris@chris-wilson.co.uk>

commit 4698b3bd79452ae2066a3d195cf58dd5e30c93f3
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Jun 5 10:43:50 2009 +0800

    xvmc: don't include xf86dri.h

commit 4d9f3a21ab9b2737fe7a5a088c2da1b0c2be7f04
Merge: b8e360b 52054b6
Author: root <root@hdmi.sh.intel.com>
Date:   Thu Jun 4 10:27:41 2009 +0800

    Merge branch 'xvmc-vld'

commit b8e360bf2b77d28559d15a7c0f9c766848eb6ced
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 3 10:12:25 2009 +0000

    Fix segfault in DRI2 vblank syncing if the region isn't onscreen.
    
    Also, fix some weirdness in the checking for whether the target was the
    screen.

commit 5901a67fc85ac80fabfa98b78202a388445275c3
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 3 10:00:50 2009 +0000

    Fix some drawable abuse in i830_dri.c
    
    We were casting pixmaps to drawables even if they weren't pixmaps.  They did
    happen to work out since we only used the drawable record out of them.

commit 5e48146777921b693c828af9566a77422cc4f85f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 3 09:57:10 2009 +0000

    Replace some pixmap-related idioms with inline functions to do so.

commit ea0b00e675281b2914450992501566122f9affe0
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Jun 1 17:13:53 2009 +0800

    Provide mode line from VBT to xorg.
    
    If sdvo get modes function can't find modes from EDID,
    transmit sdvo lvds modes from VBT to xorg.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 9e7ee50bea5f65003f1d70cc06d8c1ace1282548
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Jun 1 17:13:22 2009 +0800

    Fetch mode line from VBT, then keep it.
    
    Parse SDVO LVDS option section, then ﻿according to panel type
    fetch fixed mode line from SDVO LVDS ﻿DTDS section .
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 88f766be008008d76c150e3ac16f09d4ecbb6d53
Author: Ma Ling <ling.ma@intel.com>
Date:   Fri May 15 15:22:11 2009 +0800

    Wait doubled regis to be stable for load pipe detection
    
    We have two approaches for VGA detections: hot plug detection for 945G onwards
    and load pipe detection for Pre-945G. load pipe detection will get one free
    pipe ,and set border color as red and blue, then check CRT status by
    swf register. Because pipe registers in hires mode are double buffered,
    once set force border bit in pipeconf register, we have to wait for
    a vblank until it is effective, otherwise result is unstable.
    
    It fixed freedesktop bug #20463
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 6a635be5ea2b2df9d6b9a8006325244394038474
Author: Ma Ling <ling.ma@intel.com>
Date:   Fri May 15 14:01:18 2009 +0800

    Set activation periods as 64 cdclk sync up with KMS
    
    We use force CRT detect trigger bit(1 << 3) to detect VGA in hot plug mode,
    which triggers a CRT hotplug/unplug detection cycle independent of the
    interrupt enable bit(1 << 9), so keep bit 9.
    And although spec says CRT_HOTPLUG_ACTIVATION_PERIOD_64(1 << 8) is only useful
    for mobile platform, it is also required to detect vga on G4x platform correctly.
    Tested the patch on G45/G43/Q45 platforms with no regressions
    
    It fixed freedesktop.org bug #21120 and part of bug #21210.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit ec2fde7c8250fdc30984f16c8a1d3587d70b0144
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jun 2 16:42:56 2009 +0100

    Sync DRI2 CopyRegion to vertical retrace
    
    Akin to the Xv code, wait for the scanline to be outside the range to be
    copied by the DRI2 CopyRegion hook.
    
    Fixes fdo bug #20664.
    
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 704771f1c595df481d244a6f074e9f5620d4a720
Author: Adam Jackson <ajax@redhat.com>
Date:   Thu May 28 15:03:45 2009 -0400

    Remove useless loader symbol lists.

commit 8e942b70cb9a784b3f1311affd6fc74c4bcf68bb
Author: Carl Worth <cworth@cworth.org>
Date:   Thu May 21 13:12:52 2009 -0700

    Revert "Rely on BO pixmaps being present in acceleration paths."
    
    This reverts commit 4653a7db622ad54a3182d93c81331765d930db34.
    
    Eric was getting a little too ambitious about our brave, new world.
    We do still want the driver to work with old, non-GEM kernels
    after all.

commit 1a039f4371bec455cad43f0fb7b329f2ee09a974
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 17:45:02 2009 -0700

    Fold GEM detection into DRM master open.
    
    We don't have anything to do with the DRM unless it's GEM-enabled, unless
    we were to support GEM-but-not-DRI2, which doesn't seem useful.
    
    Compilation fixes by Carl Worth <cworth@cworth.org>

commit a04a51c9bb6066454e0fda3c7897f97dab436358
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 17:29:36 2009 -0700

    Open the DRM and keep the handle throughout server startup to finish.
    
    This will let us configure the server from start to finish with the
    most pertinent information available (KMS vs UMS, DRI2 vs non-DRI).  Also,
    we now close the DRI2 fd at terminate, which we didn't before.
    
    This duplicates some code from DRI1 for getting a master FD like I'd done in
    DRI2, but given that we weren't loading DRI1 ourselves, this is also a
    bogosity cleanup, and avoids allocating the extra DRI1 private.

commit c3bf8b980134a2761701e4bc18235695a1cb07a4
Author: Eric Anholt <eric@anholt.net>
Date:   Thu May 21 11:05:01 2009 -0700

    Fix backwards logic on whether to sync to vblank or not.
    
    Thanks to Michel Dänzer for catching it.

commit ad2128825ba28551cfef203da017151e2eac32ef
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed May 20 12:32:10 2009 -0400

    Only return FALSE when dri_bo_map() fails
    
    Small typo in the previous commit.

commit 09beee378cecd1079e7a9fa6eee8f084d680d37e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon May 18 18:01:05 2009 -0700

    Don't do GTT maps on objects bigger than half the available aperture size.
    
    The basic problem is that software fallbacks will do single instructions that
    copy from one GTT-mapped BO into another GTT-mapped BO.  If we can't get both
    of them bound simultanously, we fault one in, retry the instruction, fault the
    other in (kicking out #1), retry the instruction, fault #1 back in
    (kicking out #2), etc.
    
    Note that we'll still get into a nasty spot if you do a composite operation
    with a mask where all 3 are big-but-less-than-half-available-aperture, where
    you'll thrash.  It at least means you'll make progress, though, since each
    instruction will only be operating on two BOs at at time, and the situation
    seems unlikely.
    
    Bug #20152 (3/3)

commit 52054b6a4c1ca5117c9750361f71aedd91220c39
Author: Li Shao Hua <shaohua.li@intel.com>
Date:   Tue May 19 16:27:32 2009 +0800

     switch XvMC to gem

commit 34660fd2df5d61b77ed7041d32ac29053fc94f5a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 15 23:21:05 2009 -0700

    Only sync XV to vblank when drawing to the frontbuffer.
    
    This fixes emitting syncs to random pipes with boxes bigger than that
    pipe's vertical, leading to GPU hangs.
    
    Bug #21738

commit b622860429e00d6ab4407980232659c283a8fe8d
Author: Xiang Hai hao <haihao.xiang@intel.com>
Date:   Mon May 18 17:12:30 2009 +0800

     DRI2 for XvMC

commit 50c10ededba15dd0c118f1b65756362061491090
Merge: 13c730e 87332a7
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon May 18 17:11:28 2009 +0800

    Merge branch 'master' into xvmc-vld

commit 87332a7cc16af82aa47e07fbf90da3635b071dbf
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 11 13:52:00 2009 -0700

    Use drm_intel_bo_disable_reuse API to flag scanout and cursor buffers
    
    Buffers referenced by the kernel for scanout or cursor display should not be
    reused by the driver. Use the new drm API to disable reuse of these buffers.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ebe05200df381c0e6ee636f0f83440bfedea9bcb
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri May 15 08:50:17 2009 -0700

    Add --enable-debug flag to configure
    
    Defaults to enabled.

commit 04772b6c09a88f0483c2a7efc48029967c77b9bc
Author: Keith Packard <keithp@keithp.com>
Date:   Thu May 14 16:57:11 2009 -0700

    If DRM can't figure out which pipe to sync on, then don't sync at all.
    
    Syncing to the wrong pipe can wedge the hardware if the exclusion area is
    larger than the vtotal
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 128c1c3b7d57b157604788f82bf9fd389839068f
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 29 14:43:56 2009 -0700

    Use libdrm to lookup pipe for tear-free sync of XV
    
    Previously, the code was trying to examine a driver_private field,
    but those fields are only set by the userland-modesetting code so
    would fail in the case of KMS. This fixes bug #21076:
    
    [945GME] [KMS] XV_SYNC_TO_VBLANK does not prevent tearing of xv video
    https://bugs.freedesktop.org/show_bug.cgi?id=21076

commit 2572fcc6196aff7a2f1095d211fd85d8668647ca
Author: Wu Fengguang <fengguang.wu@intel.com>
Date:   Thu Apr 30 19:51:26 2009 +0800

    README: kill an evil dot
    
    To make copy and paste a more pleasure.
    
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b9462516d18bc57be5f33f57adb6c3e8beede5ff
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 12 18:53:27 2009 -0700

    Remove dead "avail" variable from XAA stuff.

commit 1c68bc376a9cb3c0a010c8e28f69a776755c8f64
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed May 13 13:19:53 2009 -0700

    Add new have_gem flag
    
    Prior to this patch, code that wanted to check whether GEM was present
    would look at pI830->memory_manager.  This turned out to be occasionally
    problematic in the KMS case, since memory_manager didn't always get set
    correctly.  So add a new pI830->have_gem flag to make things clear in
    the various code paths, and set it after GEM initializes or when KMS is
    detected.
    
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Tested-by: Magnus Kessler <Magnus.Kessler@gmx.net>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 52367847087206b92f18c40d356d36ab9ee89d39
Author: Keith Packard <keithp@keithp.com>
Date:   Thu May 7 14:58:02 2009 -0700

    Load i915 and fbcon when checking for KMS
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit ff7494b4c4b1bd8bb6f169402a9edbe9780787bb
Author: Keith Packard <keithp@keithp.com>
Date:   Thu May 7 14:58:01 2009 -0700

    Add DP link and GMCH M and N registers
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit e54a23bff068416ccbdb75d538dc7dcd40a6c95c
Author: Keith Packard <keithp@keithp.com>
Date:   Thu May 7 16:35:19 2009 -0700

    Fallback when VT inactive
    
    While the VT is inactive, pI830->batch_bo will be NULL, so use that as a
    simple check for when to not use the accelerator. The alternative is to
    ignore VT switch and just keep drawing, which would also be fine.
    
    Bug #21468.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    [anholt: Removed extra return FALSE -- I830FALLBACK does that.]
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 660bd745c21c56e330d844fe4c8eaae862a77483
Author: Wu Fengguang <fengguang.wu@intel.com>
Date:   Thu Apr 30 18:42:18 2009 +0800

    Remove the offset parameter from i830_allocator_init()
    
    offset is redundant.  i830_allocator_init() is only called
    in one place with offset=0.
    
    Acked-by: Magnus Kessler <Magnus.Kessler@gmx.net>
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b1f5cc3349f6811ff4d8dc64cc291788d6726372
Author: Carl Worth <cworth@cworth.org>
Date:   Tue May 12 11:45:03 2009 -0700

    RELEASING: Better instructions for where to send announcements
    
    The xorg-announce list doesn't need to hear about development
    snapshots and release candidates. The intel-gfx list is good for
    that.

commit f16ee218845ec48940ea457b921d34896d80a807
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Sun May 10 16:25:24 2009 -0700

    Fix "Unkown" typo in two FatalError messages
    
    Signed-off-by: Alan Coopersmith <alan.coopersmith@sun.com>

commit 8d27247829fe4f55691ce68f9f4b14810fb34b32
Author: Stijn van Drongelen <tinctorius@gmail.com>
Date:   Tue May 5 16:37:06 2009 +0200

    Fix typo in (unused) INTEL_BIOS_32 macro
    
    Debian bug#527062 <http://bugs.debian.org/527062>
    
    [jcristau: fix same typo in bios_reader.c]
    Signed-off-by: Julien Cristau <jcristau@debian.org>

commit a8a771a853478e5f45f71d0eff3c4d55bf24d0ad
Author: Arkadiusz Miśkiewicz <arekm@maven.pl>
Date:   Wed Apr 29 00:21:18 2009 +0200

    Restore CFLAGS after tests.
    
    Reverts single line of broken commit e5133a94dc78411eaef324131ea8056aeb81779e.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 8255cca2c9092f7ecb798944aa8f03fa3efcfa6c
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 18:34:43 2009 -0700

    Split i915 textured video commands to fit into batch buffers.
    
    i915 textured video commands are quite long, but must be contained in the
    same batch buffer as the 3D setup commands. When the number of clip rects
    for the video becomes too large for the associated commands to fit in the
    same batch buffer, this change breaks the sequence into pieces, ensuring
    that each batch contains the necessary setup sequence.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit e5e0fb846bda3e1757b89e50d5244d28457b9fe3
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 12:26:04 2009 -0700

    Call down to lower CloseScreen before shutting down DRM allocator
    
    Lower level functions will destroy objects that are managed by the DRM
    allocator, so make sure those are done before the allocator shuts down.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit cfb98f3da936907945f48dad4c2345930f7beb60
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 12:23:32 2009 -0700

    Revert "Leave allocator running until lower-level CloseScreens are done"
    
    Uh, oops -- the FD used to talk to the kernel is closed before the
    allocator_fini function is called now.
    
    This reverts commit 1872869e6ffcc8e6cab820c508fe5404d7e8ff9c.

commit 11a853bd8e5d907fe7f5bd907453bcdac9032861
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 11:51:13 2009 -0700

    Hold reference to video binding table until all rects are painted.
    
    The optimization of unreferencing the binding table when the relocation is
    posted causes the object to be dereferenced for each box in the clip list,
    causing general chaos in the buffer manager. It's easier to just hold a
    reference to the object until all of the boxes are painted and then drop it.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ed492131c13715b73c14d328d0668120acb58b40
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 11:50:17 2009 -0700

    3D_STATE_VERTEX_BUFFERS takes four 32-bit values, not three.
    
    The spec says this command takes an extra (mbz) 32-bit value, so let's
    provide it with one.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 66d1536a2ecc7a3d44da4c0dbe6c85aaa4e05791
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 11:48:51 2009 -0700

    Don't bother to enable VF statistics during 965 video playback
    
    This was used while bringing up the driver to debug vertext fetches.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 1872869e6ffcc8e6cab820c508fe5404d7e8ff9c
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 11:46:51 2009 -0700

    Leave allocator running until lower-level CloseScreens are done
    
    The lower level close screen functions will free allocated objects, causing
    a crash if the allocator isn't still available.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 1142353b487c155a31011923fbd08ec67e60f505
Author: Keith Packard <keithp@keithp.com>
Date:   Fri May 1 11:44:13 2009 -0700

    intel_batch_start_atomic: fix size passed to intel_batch_require_space (*4)
    
    intel_batch_start_atomic takes an argument in 32-bit units, and so it must
    multiply that by 4 before passing it to intel_batch_require_space, which
    takes an argument in bytes.
    
    We should figure out what units we want to use and use the same everywhere...
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 8232177a005127a0001af4b14c3beb766958ef11
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Apr 30 15:30:05 2009 -0700

    Allow cursors to roam past 2048x2048 limit.
    
    There's no reason to clip cursor positions to an artificial limit; the
    hardware cursor limits always mirror the hardware display limits.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 417f3784b7fae8de3559c7607a2de60661a6a448
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Apr 28 20:42:22 2009 -0700

    Add doltlibtool to DISTCLEANFILES
    
    Otherwise make distcheck fails.

commit bc9a688476f02233450eb05dfb40acbf337d679b
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Apr 28 20:37:13 2009 -0700

    NEWS: Add notes for 2.7.99.1 snapshot

commit a90cab43209bba52d35b953f3d686a19c154fc43
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Apr 28 13:12:55 2009 -0400

    Remove a handful of pointless comments
    
    CVS keywords, comments about how the source was once reformatted,
    and the ad-hoc changelog comment in in i830_driver.c

commit c231b41f3f3eb3ba9c8436d5fd93a30704ed437c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 21 15:55:01 2009 -0700

    Remove checks for xf86RotateFreeShadow, introduced in server 1.4.

commit e5133a94dc78411eaef324131ea8056aeb81779e
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 21 15:49:01 2009 -0700

    unifdef LIBPCIACCESS and XSERVER_LIBPCIACCESS.
    
    Depending on new server means these are always present.

commit 4653a7db622ad54a3182d93c81331765d930db34
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 22:05:54 2009 -0700

    Rely on BO pixmaps being present in acceleration paths.

commit 1784efc1f0c74edda8c78fb1b0cdd989f0a088ad
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 18:25:59 2009 -0700

    Remove XF86DRM_MODE.
    
    We now depend on server 1.6 and current libdrm, so no need to ifdef it.

commit d82ea4372fb74654eb0f37d996977003473846ed
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 13:20:03 2009 -0700

    Replace I830Sync's irq emit/wait code with bufmgr use.
    
    This pre-GEM code was all sorts of broken -- see intel_bufmgr_fake.c for
    the hoops that must be jumped to use that kernel interface successfully.
    Yet we continued to use it even with KMS/DRI2/UXA, which may account for
    some hangs.

commit 612c1f1f1859ce0cef41049d79cc473657d48612
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 16:16:48 2009 -0700

    Remove I830_XV ifdef.
    
    The developers of the driver don't ever run or test without XV.  Don't do it.

commit af6892f2b873dd508994d8bbf3d67e719b535e35
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 16:07:05 2009 -0700

    Replace i830WaitSync with just I830Sync(), as nearly all callers had it wrong.
    
    People were trying to BEGIN_BATCH()/ADVANCE_BATCH() then i830WaitSync on the
    results, which wouldn't necessarily wait and lead to various painful bugs,
    since only EXA called MarkSync and only for certain rendering operations.

commit 393abc15b76804580bfee0760ddbd1fb77e66c02
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 15:58:35 2009 -0700

    Now that video destination pixmaps are always in BOs, no more MarkSync.

commit dc71573292c215f49716f4dc1ebc416c6b172995
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 15:13:34 2009 -0700

    Remove can_resize, which is now always true (except when a bug interfered)

commit 96df22740b2cdc4f82a4a36c0f77663105d9337e
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 15:11:12 2009 -0700

    unifdef I830_USE_UXA.
    
    We only have on acceleration architecture now, and you can always build it
    if you're building the driver.

commit fa81ae1637bfd7b73b43355b78c88a9b84c0393c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 14:01:47 2009 -0700

    Remove EXA support.
    
    UXA has completely replaced EXA at this point.  UXA is the same rendering
    core as EXA, but relying on kernel memory management or a fake bufmgr instead
    of trying to manage memory in the X Server.

commit 1b10745a2528622a32271f64c35fcdb7b7154d11
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jan 23 08:39:59 2009 -0800

    Remove XAA support.
    
    While EXA/UXA aren't completely good replacements (see bugzilla for
    performance and stability problems), we are pretty sure at this point that
    it's the right way to go and that having multiple acceleration architectures
    is getting in the way of producing a stable codebase.

commit 30c226eeb35f034c3ddb881e77454051dc210298
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 22 17:54:49 2009 -0800

    Remove DRI1 support.
    
    This was blocked on wide distribution of X Server 1.6 (now in the current or
    next version of major distributions) and solutions for a couple of significant
    architectural problems (vblank sync and frontbuffer rendering, which we now
    have code or good plans for).
    
    This includes disabling XVMC which is DRI1-only currently.

commit 47591334a183881704a121ae06ebc2fadebe6f73
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 13:54:47 2009 -0700

    Remove pre-server-1.5 support.

commit 3187c7698b93f1d0e07798e9c42ca2877d55e055
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 14:50:54 2009 -0700

    Fix assert at startup with DRI initialiation failure.
    
    In this path, we'd make it to allocator_init -> init_bufmgr without
    GEM and without FbBase being initialized, leading to assertion failure
    to catch this mistake.
    
    Comedy ensued when trying to move just the MapMem up, leading to the rest
    of the commit.  Some day (like tomorrow after I rebase intel-cleanup) I'll
    clean this path up.
    
    Tested with 2 X Servers on 2.6.28 (one gets DRI2, one fails successfully),
    2 UMS X Servers on 2.6.30rc2 (each gets DRI2), and 2 KMS X Servers on
    2.6.30rc2 (success all around).

commit fbaf13c93511547c563129527797fbef8628652e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 16:05:50 2009 -0700

    Don't clear the framebuffer if it isn't currently bound.
    
    This segfault can be triggered in non-KMS memory init before the EnterVT,
    and will happen anyway at EnterVT time.

commit ab878118b9fb46c437a02f824d29f4a206e7fd80
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 16:00:05 2009 -0700

    Don't initialize DRI2 if the fd we get is not master-capable.

commit 385ac2197b64574f30620a203e675d8da0e1472f
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 15:28:21 2009 -0700

    Fix drmSetMaster/DropMaster error messages.

commit 5b05a589efb23b2fc09b06e4271174d922b1ab02
Author: Pierre Willenbrock <pierre@pirsoft.de>
Date:   Sat Apr 25 22:58:20 2009 +0200

    format == 0 means "use default" in I830DRI2CreateBuffer
    
    Reviewed-by: Ian Romanick <idr@freedesktop.org>

commit e55d943126cdd3eac7dfec5f40e794f89dbf038b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 27 11:18:07 2009 -0700

    Don't try to do anything for I830Sync when VT switched.
    
    Fixes a crash with fake bufmgr and UXA.

commit 9748aa5594a8357754c06dd82108b131260b1a71
Author: Shuang He <shuang.he@intel.com>
Date:   Sat Apr 18 11:48:08 2009 +0800

    Free front buffer bo when X exit
    
    It's needed when KMS or DRI2 is enabled, or there will be memory leak.
    Also fixes a segfault at startup with fake bufmgr.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b8ca146b060e6f76bf048f1f6cf6ee89d38d015e
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Fri Apr 24 16:03:27 2009 -0700

    Fix UXA to build with Sun compilers (use __func__ instead of __FUNCTION__)
    
    Signed-off-by: Alan Coopersmith <alan.coopersmith@sun.com>

commit 5d6f4f6eb7a4dcbe1ce5a134d882e56f958ed2ba
Author: Ian Romanick <ian.d.romanick@intel.com>
Date:   Fri Apr 24 12:28:13 2009 -0700

    DRI2: If the SDK supports it, use the DRI2GetBuffersWithFormat interfaces
    
    If DRI2INFOREC_VERSION is defined in the server's dri2.h and has a
    value greater than 1, compile to use the CreateBuffer and
    DestroyBuffer interfaces.  The format parameter parameter to
    CreateBuffer is assumed to be the bits-per-pixel of the buffer.
    
    Signed-off-by: Ian Romanick <ian.d.romanick@intel.com>
    Reviewed-by: Kristian Høgsberg <krh@redhat.com>

commit 106e4b44c5af6552cbd079c4ec34def9dcfb168a
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Apr 24 10:55:09 2009 +0800

    SDVO: switch bus once for i2c transfer
    
    Before sdvo try to get edid by i2c bus, it must do switch control bus to ddc active state from sdvo only state.
    However if current state has been ddc active state, redundant switch operation in our driver will cause error-
    "Unable to write to SDVOCTRL_E for SDVOB Slave 0x70". The patch will do switch control bus only one time during
    whole edid transmission.
    
    It has fixed bug #19937
    
    Signed-off-by: Zhenyu Wang <zhenyu.z.wang@intel.com>
    Tested-by: Ma Ling <ling.ma@intel.com>
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 8f64837e56b2de0fb8a9100d1a844fd3f18d751c
Author: Shaohua Li <shaohua.li@intel.com>
Date:   Mon Feb 23 15:19:25 2009 +0800

    Disable FBC on IGD for UMS
    
    It appears the new chip doesn't support FBC currently.
    
    Signed-off-by: Shaohua Li<shaohua.li@intel.com>
    Signed-off-by: Zhenyu Wang <zhenyu.z.wang@intel.com>

commit 7b01aa5cc41620da5bb48f391ff98d9e82572e52
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 22 09:03:21 2009 -0700

    Revert "fix overflow warning on videoRam"
    
    This reverts commit 08ebde4715b87867184d42b60762cd774e151f5c, which was
    apparently untested and broke KMS.

commit ceb3a2eaf9090d67e4dfcbed188125108ceab78d
Author: Zdenek Kabelac <zdenek.kabelac@gmail.com>
Date:   Tue Apr 21 18:58:23 2009 -0700

    Remember allocated offscreenImages memory for freeing it in CloseScreen()
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    [anholt: renamed the member to match the variable name]
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 701c6bef14b5d464847cc42c5ccb66fdeb157f1a
Author: Zdenek Kabelac <zdenek.kabelac@gmail.com>
Date:   Tue Apr 21 18:53:07 2009 -0700

    free allocated name inside sdvo_destroy
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit fe71217ca86eb7ae8081bf3e26d30f2002d27691
Author: Zdenek Kabelac <zdenek.kabelac@gmail.com>
Date:   Tue Apr 21 18:51:02 2009 -0700

    Unreference allocated bos in i965 render error paths
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b8b6ca830b1fd6956c76a5417462ca55174cb881
Author: Zdenek Kabelac <zdenek.kabelac@gmail.com>
Date:   Tue Apr 21 18:47:03 2009 -0700

    Fix leak of some 965 render state on VT switch.
    
    Signed-off-by: Zdenek Kabelac <zkabelac@redhat.com>
    [anholt: fixed up unneeded != NULL checks]
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit d7ca870e1ce251d42e3689a8e1e7d080ab1325fb
Author: Albert Damen <albrt@gmx.net>
Date:   Sun Apr 5 16:36:35 2009 +0200

    Fix crash with XV with large virtual display
    
    If a virtual display with width > 2048 is used, the first time
    an XV buffer is needed will result in a BadAlloc error message,
    but the next time X would crash.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 04ed92e3db8d9fcf2a1089ed433ab67bf0969655
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 21 15:17:31 2009 -0700

    Remove dead xoffset/yoffset from pre-randr.

commit ab2c988767aec854d3c1702bee1e5a06bd00870c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 21 14:53:45 2009 -0700

    Remove dead monitor detect debugger.
    
    watch xrandr works fine.

commit 928a37041defcca6f57f9452ba62e67524cb4510
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 15:46:11 2009 -0700

    Replace a bunch of #ifdef debug flushing/syncing with a single function.
    
    This removes it from a callsite where it would have just resulted in a
    fatalerror.

commit 1fc93ee184ceefaea9528bb46ae82884c44d9b36
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 14:42:31 2009 -0700

    Staticize a bunch of functions and variables in the driver.
    
    This cleans up findstatic.pl output for the i830+ code, which resulted in
    removing some code.  The only odd part of this commit is the
    if (0) i830_sdvo_dump() in i830_sdvo.c -- it tells the compiler that the code
    is used, without using it since we want the code around while debugging.
    It's also in a likely place to ask for the dump, so I think it's OK.

commit b2d7928f195f6439ecd140e6280b958b8a1f534b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 14:48:59 2009 -0700

    Use a static inline to replace if (0) to an unused stub function.

commit 093f51646b2f2301c907e14d0ad4b1f80ff60a16
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 14:36:52 2009 -0700

    Remove unused i830_output_type_names

commit c774ef282bfb0c594479bbab3527fe5fda2a8559
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 20 14:29:17 2009 -0700

    Remove dead mono cursor load code.

commit 75c531b9652b3919ddbf51f8eec804e6bdbb2331
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 14:03:39 2009 -0700

    Rename EXA rendering functions to UXA, since we're keeping them post-EXA.

commit 40dbba5cf710a6e392afca73965aa48fa3953d1f
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 17 15:15:27 2009 -0700

    Remove some dead i830.h struct members.

commit 84f69081abaeef8b05cafb64d3102eb2abdf9a8e
Author: Julien Cristau <jcristau@debian.org>
Date:   Thu Apr 16 14:27:15 2009 +0200

    Require xserver 1.3
    
    I don't think anyone tests this against an old server anymore.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 08ebde4715b87867184d42b60762cd774e151f5c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Apr 20 09:43:09 2009 +0800

    fix overflow warning on videoRam
    
    Note that pScrn->videoRam is an 'int'.
    
    i830_driver.c: In function ‘I830ScreenInit’:
    i830_driver.c:3019: warning: overflow in implicit constant conversion
    
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>

commit 5a07ab502fe1e58e7e37fe554fb42d8d2c8c53ec
Author: Ian Romanick <ian.d.romanick@intel.com>
Date:   Fri Apr 17 20:59:04 2009 -0700

    DRI2: Respect the src and dst parameters of CopyRegion.
    
    Signed-off-by: Ian Romanick <ian.d.romanick@intel.com>

commit 2e3b95ed0197971e81ab7509245c899e96859d5b
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 18:54:19 2009 -0700

    Increment version to 2.7.99.1
    
    This is the number we want for any development snapshots along
    what will eventually become 2.8.0. (Once we get to 'release
    candidates' we'll bump this up to 2.7.99.901.)

commit c9e174b31ae3b9a138ae696d563420a841062f57
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 18:52:38 2009 -0700

    RELEASING: Note that --with-xserver-source is needed for make distcheck
    
    I was always forgetting this without this reminder.

commit 73c3be1aa033e8c5c7ee777eb2fd43c19668fa86
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 18:18:14 2009 -0700

    README: Fix typos in chipset list, and point to how_to_report_bug web page
    
    Thanks to Gordon Jin for these suggestions.

commit c51dddb724a79a75491369a4c3e8b7b26231e7ac
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 18:07:17 2009 -0700

    AUTHORS: Add Robert Lowery to the authors file
    
    Rob got missed from my first scan since one commit lists his name as
    just 'Rob' and 3 commits don't attribute him as author:
    
    	83d304c61ad5fdc58b0a9309dbd1e5a3f6cd9b01
    	7552d80e367fe38bbc594fe94abd649917fe54d5
    	6eecef4fed8a21dfdabef42eb69fd150b96167b2

commit 4b5edde5da4b3e955eb2d77004de81e47bec7f69
Author: Robert Lowery <rlowery@exemail.com.au>
Date:   Wed Apr 15 18:03:31 2009 -0700

    Fix typo in comment
    
    Thanks to Robert Lowery for the sharp eyes on this one.

commit 3fd5a1ecd1d5140ae07ccc279298bcadd515e97f
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 16:44:11 2009 -0700

    RELEASING: Update instructions to reflect some minor process improvements
    
    We've added a NEWS file now, so that needs to be updated for each release.
    
    We're also now using tag names of just <version> rather than
    xf86-video-intel-<version>.

commit e1cace16a6130dcdd93965d2329a349d49200fa6
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 16:33:12 2009 -0700

    NEWS: Add note about broken PAT code in some kernels
    
    Hoping to cut off some false bug reports here.

commit 9ffd1951d1f2fd2f53273d04ea29de050f07af55
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 16:14:44 2009 -0700

    Add AUTHORS and NEWS to EXTRA_DIST
    
    These new files don't do us much good if we don't distribute them in
    our releases.

commit e4cd9de2933ada3e2a4b43552729ae3a370128bf
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 16:14:03 2009 -0700

    Add a NEWS files with release-notes for 2.7.0
    
    It will be nice to have release-notes under revision control, as well
    being able to document issues in an obviously time-sensitive file,
    (as opposed to README where we were documenting some of this previously).

commit 506c810f8f3db89048dda9777902f142ffeb86aa
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 16:10:52 2009 -0700

    Clarify that the default acceleration is UXA if KMS is available.
    
    Stale documentation considered harmful of course.

commit b9716b836cb2b4569c90b81f344932ac668dc5bf
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 15:39:06 2009 -0700

    Add a new AUTHORS file
    
    This is a sorted list of everyone with more than 2 commits in the git
    revision history. We also list some historical authors mentioned in the
    man page, (with code presumably pre-dating the beginning of revision
    history).

commit 8deb3a3709a9aaa549be404566715a01246354d9
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Apr 15 15:38:11 2009 -0700

    README: Remove almost all time-sensitive information
    
    This was all very stale, and is better convered in intel.man. We replace
    this with a list of pointers to where to get current information, (man
    page, web site, and mailing list).

commit 9b615a52671aacf34666f90ecfff98651ce6afe2
Author: Li Peng <peng.li@intel.com>
Date:   Fri Apr 10 14:39:35 2009 +0800

    Turn on front buffer tiling in KMS.
    
    This code disabled front buffer tiling in KMS. Turn it on since kernel
    handles all tiling now, this improves performance of x11perf -aa10text
    from 97k to 286k on my 945GME.
    
    Should help with #20761, if not totally fix it.
    
    Acked-by: Jesse Barnes <jbarnes@virtuousgeek.org>
    Signed-off-by: Li Peng <peng.li@intel.com>

commit 053432991c812146f6e7c6f13c6ace55385c825f
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Apr 13 14:27:35 2009 +0800

    update manpage for BROADCAST_RGB property

commit 62ba7211fe9b6aada125ebfe34cf7161e817ad6b
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Apr 13 14:24:57 2009 +0800

    set broadcast RGB mode for integrated HDMI output.

commit 69388953ce889080d5f014123d89bf3eb45f3d8d
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Apr 13 14:23:06 2009 +0800

    set broadcast RGB mode for HDMI and TMDS from SDVOX output
    
    Almost all digital TVs accept broadcast RGB values from 16 to 235 for each channel,
    otherwise for those uncompensated videos, when RGB values are set from 0 to 255,
    they will shows black and whiter clamping, which seriously degrades picture quality.
    The patch will enable the broadcast RGB mode for hdtv according to user's setting.
    It fixed bug #14486

commit 6d345c49f693cc5cffaa00b94559d2afcb3a0864
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Apr 10 14:07:14 2009 -0700

    Add a RELEASING file documenting the release process
    
    Thanks to Jesse Barnes for the original recipe.

commit 7e516b6d24d8c0c6549a9a60fcf487e3a1615020
Author: Jesse Barnes <jbarnes@jbarnes-acer.(none)>
Date:   Wed Apr 8 16:38:08 2009 -0700

    Silence warning in i830_dmi_store_field
    
    Just add a dummy ret variable to shut up gcc.

commit 620e97bbd6a811ad69b8ac94df1fe2c9edf65549
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Apr 8 15:49:00 2009 -0700

    Don't enable kernel execbuf fencing w/EXA
    
    If we enable kernel execbuf fence register management, it's best if the
    kernel manages all fence registers.  This works fine if the accel
    method is managing pixmaps or doesn't use offscreen pixmaps.  However
    with EXA, pixmap accesses are done relative to the framebuffer BAR
    mapping (pI830->FbBase) and the Screen pixmap address.  So if we try to
    set the screen pixmap to point at a GTT mapped (and therefore properly
    fenced) address, later calls to intel_get_pixmap_offset() will call
    into EXA, which will use the pseudo-random pixmap addr and the EXA
    offscreen base addr (which is really just FbBase) to calculate the
    offset.  This will fail.  So disable kernel fence reg management in the
    EXA case (this is easier than adding proper EXA pixmap management to
    xf86-video-intel, and makes more sense since we'll be removing EXA soon
    anyway).
    
    Fixes FDO #21027.
    
    Also happens to fix FDO #21029 (as tested by Carl Worth <cworth@cworth.org).

commit 0a0731c11d10392cdc55ecc04e4e3575c8b3fe57
Author: Shuang He <shuang.he@intel.com>
Date:   Tue Apr 7 12:31:07 2009 -0700

    Fix value for MI_WAIT_FOR_PIPEA_SCAN_LINE_WINDOW
    
    Since the change to scan-line based video sync, (rather than vblank-
    based), we've only been getting tear-free video on one of the two
    pipes. This fixes that bug by using the correct constant for waiting
    on PIPEA.

commit 940c2aad4d174b6609bdc49f8c99a4bc37926516
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Apr 6 14:36:33 2009 -0700

    Don't clip video to CRTC in the case of textured video
    
    Since we're not limited by a single overlay plane on a single pipe,
    we want to not clip at all, (so that the correct video appears on
    both pipes).
    
    This fixes bug #20980 which shows a video spanning two pipes
    being rendered incorrectly.

commit 63b4b5efac936c674dedad8125a8dbac4f000908
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Apr 7 10:53:08 2009 +0800

    quirk LVDS on ibase MB890 855GM board
    
    fix bug #19529

commit 5d9d9a2e466474a0508a15b294a91507ccb3ccc1
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Apr 6 14:02:08 2009 -0700

    Fix new video sync-to-blank code for multi-head
    
    We need to account for a non-zero Y offset for the CRTC. Without
    this, we don't sync to the correct region, so tearing becomes
    visible again.

commit 3d4ee3cac1d63dfdf7b54c8ba577f3b77637499f
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Apr 6 11:31:20 2009 -0700

    Remove support for 'auto'(-1) value of XV_SYNC_TO_VBLANK
    
    We previously had a heurstic here where we would only sync to vblank
    for windows that covered more than 25% of the screen. We don't need
    this anymore since the new approach to sync, (WAIT_FOR_SCANLINE_WINDOW),
    is not excessively costly for small windows.

commit bc3312fd7c03d09a231dfebfe390fe668ad15d1e
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Apr 6 11:16:40 2009 -0700

    Use WAIT_FOR_SCAN_LINE instead of WAIT_FOR_VBLANK
    
    Either way, the goal is tear-free video playing. But waiting for
    a scan-line window not only has the advantage of being cheaper
    for small windows, but also avoids hanging the GPU in the case
    of the pipe getting turned off, (by screensaver, for example),
    while a batch is waiting for a VBLANK that will never occur.
    
    This fixes that GPU hang.

commit 6cd914ef315036ce8e91c7b6492994353e8ed2d8
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Apr 3 11:15:18 2009 -0700

    Fix offset in begin_gtt_access case
    
    Don't use bo->virtual in the begin_gtt_access case, use the framebuffer
    mapping and bo offset instead.
    
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 13c730e003e805e19deee0996b2af30f69e54c4d
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Apr 1 15:12:55 2009 +0800

     fix
     1.multiple instance
     2.memory leak

commit fad714c40078d22fff82dc0692a344f66ddf9680
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Apr 1 10:11:35 2009 +0800

    SDVO: fix output flag dumping for unknown type
    
    Found by Hugo Jacques <hugo.jacques@verint.com>

commit 00de1757dd5776962bdd4c8968181878c2ebf4c9
Author: Hugo Jacques <hugo.jacques@verint.com>
Date:   Wed Apr 1 10:10:05 2009 +0800

    SDVO: add composite TV out support

commit 087f72e1f5d7d11b8795ba80a842874f5a9bb01d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Mar 31 07:50:10 2009 -0700

    Match GTT unmap with map in KMS rotation case
    
    Missed this when the GTT unmap call was added.  If we don't do this we
    trigger an assertion in libdrm, since the buffer has never been mapped
    normally.
    
    Fixes bug #20943.
    
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 4f046af760b92c07f59664359453933fb5358e3d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 31 13:49:44 2009 +0800

    Disable LVDS detect methods
    
    Both methods ACPI lid and SWF bit have issues in LVDS detect from
    wider testing. Fallback to origin code.

commit e964d4e53af3a47de6d09c884be1cc0044d03bea
Author: Albert Damen <albrt@gmx.net>
Date:   Mon Mar 30 11:38:02 2009 -0700

    Non-GEM allocations incorrectly force TILE_NONE (bug 20797)
    
    With -intel 2.6.3 performance was very bad when using a non gem enabled kernel
    (2.6.27) and EXA. For example sauerbraten ran with 4 fps and screensaver GLBlur
    with 1 fps. With -intel 2.6.1 performance was good using the same kernel.
    
    Git bisecting led me to commit f1ed73c1ef3e3daa9f695194dcc813167cbcb53d (in 2.6
    branch) "Make i830_allocate_memory take tiling parameters" as first bad commit.
    
    Using gdb I found tiling was set exactly the same in 2.6.3 as in 2.6.1, so that
    was good (TILE_XMAJOR for front, back and depth buffers).
    Looking further I found the line mem->tiling = TILE_NONE; (line 961 in
    src/i830_memory.c) at the end of i830_allocate_memory suspicious, as
    mem->tiling now already gets set via i830_allocate_aperture and some buffers do
    have tiling. Removing that line indeed fixed the performance issue. Now
    sauerbraten runs with 30+ fps and GLBlur runs smoothly.

commit 51cf8a453c2bc2e8604bfc41a649e971c1ba5026
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 30 11:27:56 2009 -0700

    Require libdrm 2.4.6 for GTT unmap support
    
    Need the new functions available.

commit 8dabcc40747bfd478f296728741240241698f165
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Mar 30 09:53:40 2009 -0700

    Tiling fixes, third set
    
    Hopefully this concludes the fixes necessary to deal with the various
    combinations of kernel and user level tiling.  We have several cases to
    handle:
      1) KMS (kernel handles all tiling)
      2) UMS w/memory management + kexec fencing (kernel handles all tiling)
      3) UMS w/memory mangement but no kexec fencing (userland handles tiling)
      4) UMS w/o memory management (userland handles tiling)
    
    For cases (1) & (2) we can use GTT mapping, which will give us good
    performance and take care of allocating fence registers as needed.  It's
    important *not* to have userland set up fence regs in this case, since
    the kernel will be using all of them.
    
    For case (3), we use the begin/end GTT map functions provided by libdrm,
    in combination with pinning and fence register setup in i830_memory.c to
    deal with tiled surfaces.  This also gives us good performance and
    correctness.
    
    For case (4) we use the old style virtual mapping + offset for dealing
    with surfaces; note that UXA doesn't seem to work in this configuration
    regardless of these fixes.
    
    Fixes bug #20803.
    
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

commit 375b2e40fcb17e94538a75392950e2533c1bb031
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Mar 25 11:13:52 2009 +0800

    Disable LVDS config parsing from VBT for now
    
    As wider tests showed that this doesn't work for all VBIOS, so
    disable it for now and reenable it after we get reliable method.

commit defa6971c6b639ab72d9d4c85c4607d5f852b2b0
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Mar 26 15:24:29 2009 +0800

        enable UV half pixel

commit 69c84f2c8204771b68f40ed64e64657237b54546
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 26 13:52:05 2009 +0800

    gitignore intel_lid

commit fe96e517699e37cc990a14dfb48b9611a02254ed
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 26 10:54:02 2009 +0800

    xvmc: add missed vld g4i sources in Makefile and fix distcheck
    
    Don't miss the vld shader programs for dist.

commit 91886f82a1155ca24eb895f77678ea1edfccf9fe
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 26 10:51:05 2009 +0800

    xvmc: move 965 mc media programs to shader/mc directory
    
    Also include some missed g4i files in Makefile.am, fix shader build.

commit ebcb64fdc8a45105f529d5e15c335514ecaf1a05
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Mar 25 16:11:33 2009 +0800

      XvMC VLD extension support for G4X

commit e6af995b24767815ab30364385768867e80605c2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 23 19:19:58 2009 +0800

    KMS: hook up output properties for randr
    
    This gets output properties from kernel, then hook them up
    for randr. So we can control output properties through randr
    like in UMS.
    
    Signed-off-by: Zhenyu Wang <zhenyu.z.wang@intel.com>

commit b5b377806422c9538fa9f846819ad253c1a50846
Author: Ma, Ling <ling.ma@intel.com>
Date:   Wed Mar 25 14:39:46 2009 +0800

    disable center mode for 965GM and G4X platform
    
    When disabling VGA mode, usually we don't need to touch VGA center mode.
    However because of hardware reason, for Cresline, Cantiga & Eaglelake platform,
    we have to disable center mode as well. The patch fixed bug- TV Out strobing regression,
    reported by Robert Lowery in intel-gfx@lists.freedesktop.org mailing list.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 74d0713e002a9781ed00fdd10eb6f75907ae796c
Author: Kalev Lember <kalev@smartlink.ee>
Date:   Fri Mar 20 02:21:41 2009 +0200

    Fix VT switch with XV overlay video enabled.
    
    drm_intel_bo_unpin() was called with NULL argument.
    
    Signed-off-by: Kalev Lember <kalev@smartlink.ee>

commit b345b4e6adf00f8b2626e5c2563fc159e2295cc5
Author: Rémi Cardona <remi@gentoo.org>
Date:   Fri Nov 14 13:55:52 2008 +0100

    clean up man page generation and remove all traces of the i810 driver
    
    The i810 compatibility symlink has been broken since libpciaccess, so just
    let it die.

commit 48b91e066878db63a1558e4cd3e6d12ff9c49197
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Mar 20 12:33:22 2009 -0700

    Don't manage fences part two
    
    Don't try to clear fences that were never installed.  Missed this bit in
    the last fix for #20265.

commit 28319d60aa2d793c209043c1ce2d38b14c66a4be
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Mar 20 13:14:15 2009 +0800

    Add a lid status test program "intel_lid"

commit 636d252f3b1eac687f7b11952e949c383cb86ed4
Author: Jesse Barnes <jbarnes@nietzche.localdomain>
Date:   Thu Mar 19 13:25:29 2009 -0700

    Don't install fences if the kernel is managing them
    
    If execbuffer is setting up fences, it also means that the kernel is
    managing them at pin time, so installing one in the 2D driver in that
    case is an error.  The fence should stick around as long as the buffer
    is pinned (the kernel won't steal these), though it will be freed at
    leavevt and re-allocated at entervt.
    
    On 965+ chips, the pin ioctl will *not* install a fence reg, but that's
    also ok because all 965+ operations include tiling bits, and sw
    fallbacks will be protected by prepare/finish access hooks, which will
    either access the backing store or use the GTT, which will ensure proper
    fencing at fault time.
    
    Fixes #20265.
    
    Acked-by: Eric Anholt <eric@anholt.net>

commit d92e6158c86d7da873913461ef7e828bd411d8c4
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Mar 19 10:06:03 2009 -0700

    Revert the rest of the EXA_VERSION_MAJOR bump
    
    This was mistakenly added in the unrelated change in revision
    fe08b81d0f5d6f96e0124e6286bd24aba6e140ad
    and wasn't completely reverted in the later revision
    78a60e1b66fe2e8449702dd43d9b062d279af8f1

commit 85e6b528582c2397ee9eb2132cd0d05ce12eb43d
Author: Ma Ling <ling.ma@intel.com>
Date:   Thu Mar 19 09:10:19 2009 -0700

    Set SSC frequency for 8xx chips correctly
    
    All 8xx class chips have the 66/48 split, not just 855.
    
    Fixes #18358.

commit bedc894a565ce3c7a50990e3f78953fc2432ad40
Author: Jesse Barnes <jbarnes@nietzche.localdomain>
Date:   Wed Mar 18 20:19:44 2009 -0700

    Re-enable disabled outputs after rotation
    
    The server may have made a DPMS call before doing rotation, so after we
    do the mode set with the rotated framebuffer, we need to re-enable the
    corresponding output(s).
    
    Fixes bug #20573.

commit 6deb26ae7bd796e88a5dd90df5f6c35fbc44e798
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Mar 18 09:36:58 2009 -0700

    Create known output configuration at EnterVT time
    
    Since we added the pipe A force quirk (leaving pipe A on all the time),
    DPMS calls to disable it have silently returned, leaving the pipe on.
    If another driver (like vesafb) has enabled it, we may end up with a bad
    configuration, leading to hangs or blank screens at VT switch time.
    
    Fixes bug #19603.

commit 7c94227dd4fa2164bebb36234958053bf1d26c12
Author: Ma Ling <ling.ma@intel.com>
Date:   Tue Mar 17 10:33:15 2009 +0800

    Use best PLL timing values for G4X platform
    
    construct function to find precise parameters from internal spreadsheet
    table on G4X platform.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 48db5bde9298f1126dfb42f4be8a3d61166abfd8
Author: Ma Ling <ling.ma@intel.com>
Date:   Tue Mar 17 10:41:02 2009 +0800

    Define documented PLL timing limits for G4X platform
    
    These timings on G4X platform were specified by internal spreadsheet from the chipset group.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>

commit 78a60e1b66fe2e8449702dd43d9b062d279af8f1
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 16 08:41:52 2009 -0700

    Revert EXA_DRIVER_KNOWN_MAJOR bump
    
    This was mistakenly added in the unrelated change in revision
    fe08b81d0f5d6f96e0124e6286bd24aba6e140ad

commit 1a6e70cd98abc63f24f710819961c24601afb59b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 16 10:19:39 2009 +0800

    TV: fix contrast and saturation for 945G
    
    Bug #20670.

commit 4e95327323e3d081b565147f7738eb49c28542bc
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 16 09:30:22 2009 +0800

    TV: force TV as connected with TV_Connector option
    
    In order to bypass failure in TV load detect, TV_Connector option
    will always force TV as connected with user specified connector type.

commit d9dbdb325543bd747cd1bfb3e1142ea6daf2b637
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 13 15:48:40 2009 -0700

    Add shave support, enabled by default.
    
    This cuts down build system noise so that warnings are more visible.  The
    old style output can be reenabled for build system debugging using
    "make V=1", or --disable-shave at configure time.

commit c3a82106a1a1a94c9e1e465c7dc0d828c1cbf50d
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 13 15:29:45 2009 -0700

    Move contributed m4 (dolt) to a subdirectory so we can include it with others.

commit e0aba04da0323efc079ce0a2b78139c4d0d49fa5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 13 13:37:35 2009 -0700

    Add DCC register dumping.

commit a57814cc13f4287eccaf1906963b80c9205c680c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 13 13:20:35 2009 -0700

    Add dumping of 915 and 945 fence registers.
    
    The debug dumper functions can now return NULL to indicate no output, so
    we get appropriate results on 915, 945, and 965.

commit 8166a7ff5c2c1e3736dd06a8453c4e4d769d8b75
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 13 13:12:33 2009 -0700

    Add PGETBL_CTL to the debug output.
    
    It's nice to know when it gets stomped on.

commit fe08b81d0f5d6f96e0124e6286bd24aba6e140ad
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 2 07:39:41 2009 -0800

    Use CopyArea to load glyphs from per-glyph pixmap to cache pixmap
    
    With glyphs sitting in per-glyph pixmaps, there's no reason to use the CPU
    to move them to the cache pixmap, and lots of reasons to use the accelerator.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 2026c57cf0a352d9e6f9d208cfb7d4d550614477
Author: Kalev Lember <kalev@smartlink.ee>
Date:   Fri Mar 13 21:32:08 2009 +0200

    Fix Xv crash with overlay video.
    
    Bug #20585.

commit 3ef9d85371a97ea5baee0c47787b3bb3cdaf5135
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Mar 13 12:21:34 2009 -0700

    Use UXA when KMS is active
    
    EXA doesn't support KMS, so force UXA on if KMS is detected.  And warn
    the user if they've specified something other than UXA in their
    xorg.conf.
    
    Fixes bug #20620.

commit dc3ff0b514b609448025680778f0e95e1980a5d8
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 12 16:32:02 2009 +0800

    Revert "SDVO: Switch control bus only before DDC access"
    
    This reverts commit ddedf19f889da2ce6d69a3afce4665e2245682fa.
    
    After i2c STOP, control bus will return back to internal
    registers. So this brings back to origin code that we switch
    to DDC bus before START. But it's ideal to only issue DDC
    bus switch after STOP, not before every START, which might eliminate
    some complains from SDVO device, that will be another patch later.

commit c6b0135d209bdad3dbc641d0e264596eaf6f99d3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 12 16:31:01 2009 +0800

    SDVO: reset privates before output setup
    
    For multifunction encoder, forget to reset these values
    will cause wrong output type in later mode setting
    operations.

commit 28e7f0d71fa09e15a68ab4f0de169474b6235093
Author: Dan Nicholson <dbn.lists@gmail.com>
Date:   Tue Mar 10 20:16:03 2009 -0700

    Fix dist of xvmc sources
    
    The XVMC AM_CONDITIONAL is only needed around the library expression.
    None of the other definitons will cause anything to be built without
    libXvMC, but they're needed for 'make dist'.
    
    Signed-off-by: Dan Nicholson <dbn.lists@gmail.com>

commit 73db44e7ac524e84e5f0fda2d60069a9e954ad1b
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Mar 11 11:10:57 2009 -0400

    Drop Legacy3D option, only use fixed texture space with non-gem.
    
    With this change, we always expect the 3D driver to use GEM textures
    when the 2D driver uses GEM.  When GEM is not available or disabled,
    we fall back to legacy fixed textures.

commit 2fcf4fcccfe7cfa1425985d21a144137eca07f4e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 10 14:21:36 2009 +0800

    SDVO: fix pixel multiplier setting for TV
    
    We should use preferred input timing's clock for correct
    pixel multiplier setting, otherwise we might get inconsistent
    multiplier setting on pipe and SDVO device for some modes.

commit fb6e00f40f713a87c760fc7603159ed11ea9b0d5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 9 20:06:30 2009 -0700

    Fix XV with non-GEM kernels by allocating a larger fake bufmgr.
    
    Ideally we'd not be using the EXA offscreen memory manager and just hand all
    that memory to the fake bufmgr for non-GEM, but the fake bufmgr's too slow for
    that, at least currently.  So compromise and take enough memory that it will
    succeed at XV allocations but hopefully not anger tiny-aperture systems too
    much.
    
    Bug #20563.

commit dc12c4b3eb297b2f225409eacf1f3cd521453ab6
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Mar 7 23:22:54 2009 -0800

    Flip the update_dri_buffers test around to only run when DRI1 is active.
    
    Fixes segfaults at startup with DRI2 and load detection, or with DRI disabled
    entirely.

commit 646e12a9783d1d48ef21841f0909287a876731a4
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Mar 9 10:59:36 2009 +0800

    typo in intel.man

commit 73aa23d9150121a4e4b70a78cab910acd164abf5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 5 13:06:05 2008 -0800

    DRI1: Update sarea (and other information) when CRTC configuration changes.
    
    Bug #14423.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit abb213d933ac0d808fc10d4f8d88d7b8cef76346
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 6 14:33:46 2009 -0800

    Document the UXA AccelMethod.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 568297d327cc321f1186afc54b38d08db3f2914d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 22 17:08:19 2009 -0800

    Don't allocate the render power saving context in KMS mode.
    
    That would be the kernel's job if it chooses to do it.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 4e1144108424a4525bbd97c3d5a56de06760bdd9
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 6 14:30:05 2009 -0800

    unused variable warning fix.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 043a76a040d4576b7a8397dca805466a99bfcdd6
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 6 14:29:22 2009 -0800

    clean up arguments to i830_allocate_framebuffer since zaphod removal.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit b23f57b310b693f56af273526383221a4f8b96f5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 22 17:17:09 2009 -0800

    Use REGION_EQUAL in place of a local implementation.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 6b61f9945f54df7469f2b2d702b621d4d6064c3f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 22 17:19:04 2009 -0800

    nuke unused define.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit c3a747cb54acc1b037b559313e6a2113ae2ac4c7
Author: Dan Nicholson <dbn.lists@gmail.com>
Date:   Wed Nov 26 09:57:24 2008 -0800

    man: Put option defaults on separate indented line
    
    The groff .IP macro is used to put the option defaults in a new indented
    paragraph so they are separated from the explanations.
    
    Signed-off-by: Dan Nicholson <dbn.lists@gmail.com>
    [anholt: hand-applied due to conflicts.  mistakes are my own]
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit d2af21a66d7e1d1dd62c6aa8fb41d3fd6045bcd7
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 23:38:00 2009 -0800

    Remove configurable support for disabling XV.
    
    google shows one instance of this being used a year and a half ago.

commit 755757669f0cad670cfa084d33d7c3e928d27855
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 22:57:15 2009 -0800

    Remove configured SW cursor support.
    
    Any time we actually need SW cursors, it gets enabled automatically.

commit 917b20ead3cacf1e88314f20edde6a02b97b96d7
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 23:01:28 2009 -0800

    Remove StolenOnly support.
    
    We rely on having AGPGART present to successfully allocate video memory as
    we configure it by default.  Admit that fact, and remove support for
    non-AGPGART/KMS setups.

commit 73b7190421132ad73179c3fb7bb0e06c427dce5c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 22:51:22 2009 -0800

    intel: Nuke shared-entity support (zaphod mode).
    
    It's been broken for years now, and KMS offers a much better chance of getting
    this working sensibly without making a mess of the 2D driver.

commit e9d6bbbe0b41e29c58a79844decd81771da85dd4
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 3 16:45:03 2009 -0800

    remove more page flipping leftovers.

commit 1cc9b1423c5df591c615ef9588b6eefd81448f80
Author: Lukáš Hejtmánek <xhejtman@ics.muni.cz>
Date:   Fri Mar 6 14:44:03 2009 -0500

    Fix another VT switch leak
    
    The batch_bo buffer object is reallocated on enter VT, so we need to
    unref it on leave vt.
    
    Signed-off-by: Lukas Hejtmanek <xhejtman@ics.muni.cz>

commit 67fef27f4b76490be085d232aba0ca9cbb3c5e59
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Mar 6 09:40:07 2009 +0800

    Xv: free tearing on textured video
    
    Add an Xv attribute XV_SYNC_TO_VBLANK which has three values -1(auto), 0(off)
    and 1(on) to control whether textured adapter synchronizes the screen
    update to the vblank. The default value is -1(auto).

commit 0d20bbbc2005a51f427a9ae6b6a66dbbb101dbab
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Feb 19 14:24:24 2009 +0800

    SDVO: handle multifunction encoder (try 2)
    
    For SDVO encoder that advertise multiple functions,
    we have to get attached display to determine current
    output, and update output's name according with
    current type.

commit d4c64f01b9429a8fb314e43f40d1f02bb8aab30f
Author: Lukas Hejtmanek <xhejtman@ics.muni.cz>
Date:   Wed Mar 4 17:33:27 2009 -0500

    Fix serious memory leak at Enter/LeaveVT
    
    This fixes huge memory leak at each VT switch (about 600 BOs + 6MB
    of RSS of Xserver).

commit 095a001f755201d3c19335b67a84c57b1d080a83
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Mar 4 17:10:24 2009 -0500

    Use drmSetMaster() and drmDropMaster() in enter/leave VT
    
    This allows multiple X server to use DRI and makes it possible to run
    multiple X servers under KMS.  This requires a 2.6.29 kernel to work.
    On older kernels it will just log a warning and DRI will fail to
    initialize for the second X server.

commit 14bb61e0c2e28725a2f6167d3263649bc845be18
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 2 16:55:45 2009 +0800

    SDVO: only check digital monitor when EDID exists

commit 42e34e90e2e4048b38481cab61cef46f932eada7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 3 22:55:35 2009 +0800

    TV: add property control for TV attributes
    
    This is based on Jesse's origin patch for bug #12763.
    But export integer range to user instead of hardware float
    point format, and fix different real format on 965G and 945G
    for contrast and saturation.

commit aa9da5e393c804019720503fe58bdd247fe1eabd
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 3 20:26:19 2009 +0800

    TV: add option to set TV connector type
    
    This can let user override non-stable driver TV load detect,
    and set connector type manually, e.g for s-video to component
    converter, this patch seems must needed to use HD modes.

commit ab1ef05cc0fd5ba9768c26cc51bc2c7b52baa45f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Feb 19 20:23:02 2009 +0800

    TV: update output and crtc modes when TV format change (try 3)
    
    This is to fix bug #16566, change TV format will cause BadMatch
    error when crtc config apply. Everytime when we change TV format,
    we may generate a new list of modelines as TV clock changed. After
    randr get info request, new modelines will be probed and randr output's
    modes will be renewed too. But crtc's mode failed to be updated,
    as it never can find a matching mode now within new modes list.
    So get info will return an invalid crtc's mode, later set crtc
    config will pass that info, and xserver catches a bad match.
    
    This patch trys to refresh output modes and setup crtc's mode
    with new modelines in TV format change. So get info would be
    sure to turn valid crtc mode that reference in current new modelines.

commit a67a911a93ff3c0b3d2e6f6fb20c0787b9d4d41d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Feb 19 01:00:33 2009 +0800

    TV: sort input mode lines

commit bd360e7517835626bee54bec968cdc78908c6545
Author: Adam Jackson <ajax@redhat.com>
Date:   Mon Mar 2 10:33:35 2009 -0500

    KMS: Wire up output DPMS.

commit 2d0aa553609a0e64fa4b2e755b9b1e244e5c3fa1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 2 15:26:44 2009 +0800

    Skip LVDS config parsing on pre-9xx chips.
    
    855GM laptops seems pretty broken when parsing this block.

commit 55359ef9ab0a2be42a55e0279835f76a191d6c74
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 27 09:02:30 2009 +0800

    Update driver feature block definition for missed fields

commit 38a7683561cee7fffab174c2a166bfd51b51ba27
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 22:55:44 2009 -0800

    warnings cleanup

commit 5bfd73cd31ba197a62f549cdbad1a1270b571027
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 27 19:09:49 2009 -0800

    Only allocate pixmaps aligned for tiling when requested by DRI2 GetBuffers.
    
    This saves massive quantities of memory on pre-965 since the DRI2 tiling
    enable caused the minimum size of any pixmap to be 1MB.

commit f53bdad1412f841075232455837578f00709c6ef
Author: Shaohua Li <shaohua.li@intel.com>
Date:   Mon Feb 23 15:19:23 2009 +0800

    Intel video driver patch
    
    This is the intel video driver patch for a new chip, which is G33-like
    and has some clocking setting related register changes. This patch adds
    the pci id and DPLx/FPx register changes.
    
    The gtt tool should just work to me, as the chip hasn't any changes
    against G33 on this side.
    
    Signed-off-by: Shaohua Li <shaohua.li@intel.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 22dc9a5580d77cc4707bfb8e19474e611a06ae9a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 18:22:20 2009 -0800

    Fix UXA for server 1.4.

commit cb1f7ec0876746c1b52b63cdb508544e9e4e32e3
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 21:23:59 2009 -0800

    uxa: Fix composite fallback debug printing of main memory versus bo info.
    
    It was just printing whether it was a pixmap (it is), instead of whether the
    pixmap was offscreen.

commit 635eaa511f28fb673fe306e46ed5370e78a8a534
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 21:48:11 2009 -0800

    Regard the screen pixmap as suitable for acceleration.
    
    With UXA on the fake bufmgr, the screen pixmap doesn't have a BO and so
    no acceleration was occurring.

commit 70e0261208654c6c875ad462da2734c6aa9eeb96
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 20:54:05 2009 -0800

    Disable fb resizing for DRI1-only server so that DRI1 can initialize.

commit d7aa330db31100b7cb54d8165f9a4b94329ece32
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 20:34:10 2009 -0800

    Fix up i915 composite and common solid/copy code to use check_aperture.
    
    This could fix complaints about binding BOs and resulting failure to render.

commit a625a07022ea7f6757b288fcc2ffb9e27c7f8341
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Wed Feb 25 16:48:22 2009 +0800

    XvMC: fix broken xvmc on 965

commit f6d8ae69b0f97e696c142f06c8038f336ed024f9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 25 09:57:00 2009 +0800

    Use LVDS config in Driver feature BDB for integrated LVDS check
    
    The LVDS config bits in VBT driver feature block is used by vendor
    to identify the board implement of integrated LVDS/eDP or SDVO LVDS.
    And video bios uses these bits for LVDS enabling or not. So check
    these bits for integrated LVDS might eliminate more quirks.

commit 8718551f14e064b461e80a583597f0ea9fb8ca9f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 25 09:54:03 2009 +0800

    Update LVDS config bits definition in driver feature block
    
    ALL_LVDS is actually not defined before and include GM45.
    Embedded DP bit will be used for newer chips.

commit 9d8e5c21a1688b915bf39261d4c3b0bf2906daef
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 24 14:05:15 2009 -0800

    Fix distcheck from drmmode_display.h deletion.

commit f4e2f522a5c5b03ea530b9eb67e9d1a9a96274ce
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Feb 21 20:36:58 2009 -0800

    Don't do AdjustFrame in KMS mode.
    
    This was hit by xv86vm's SwitchMode path, and for that the CRTC offsets
    get set at mode setting time anyway.

commit 170f00e161931fdaa8c2812fc710649e1d6d977a
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Feb 24 14:07:23 2009 -0500

    Remove a handful of unused variable warnings.

commit a6b31f38ebf470c61de0e10b0ce2af0d7ee1684b
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Feb 24 13:58:20 2009 -0500

    Update kms to work with drmModeModeInfo API update.

commit 13ee9402e9822d6f57e3ebcc5ae658ce8322118e
Author: Adam Jackson <ajax@redhat.com>
Date:   Mon Feb 23 15:44:26 2009 -0500

    Limit CRT DAC speed better.
    
    Verified against the public docs for i8xx parts, although not 9xx yet.

commit 668b2352a47bcfba75fe0492a5805726222755eb
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Feb 23 13:31:51 2009 -0800

    Revert "Limit CRT DAC speed better."
    
    This reverts commit 8fd0e46571c7ba15c05f0a759113f8ca842c76a2.
    
    This doesn't even build. Please try again.

commit 8fd0e46571c7ba15c05f0a759113f8ca842c76a2
Author: Adam Jackson <ajax@redhat.com>
Date:   Mon Feb 23 15:44:26 2009 -0500

    Limit CRT DAC speed better.
    
    Verified against the public docs for i8xx parts, although not 9xx yet.

commit 73bc7f113969834d00cd92be8374dbadc62f96a9
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Feb 23 15:16:51 2009 -0500

    KMS: Fix bug that prevented EDID data from getting propagated.

commit ef952760551ad15cb9f63025d1e087645949a227
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Sun Feb 15 22:10:42 2009 -0500

    Use stat() and the dev_t to find the drm device filename.
    
    Simpler and more robust.  Works when we haven't set the device PCI ID,
    ie when not going through the legacy DRI module.

commit 81c652e9a666a7459bcc5217c8a5ec518b6e00da
Author: Helge Bahmann <helge.bahmann@secunet.com>
Date:   Sat Feb 21 10:10:04 2009 -0800

    Move disable_render_standby to EnterVT instead of startup.
    
    Otherwise, with a pre-2.6.28 older kernel the disable would be lost at
    resume time and cause hangs.
    
    Bug #20214

commit 0621ba12a3b694720e67a49b25ca52f0e09b3802
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 18 13:32:44 2009 -0800

    uxa: Ask for BOs ready for rendering for pixmaps.
    
    The assumption is that we're almost always accelerating our drawing to
    new pixmaps (fill, copy, etc.).

commit 5018d0f16cb8b44c743b5b37d194fe806d955568
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Fri Feb 20 15:34:29 2009 -0500

    KMS: Hook up rotated shadow buffers.

commit beca598bc2848093b710bd47828d622205d273df
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Fri Feb 20 11:08:51 2009 -0500

    Access the Xv buffer through the GTT for the non-KMS case.

commit e97e2571703e3d6188bf18f211b793fc50383f9c
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Thu Feb 19 16:41:49 2009 -0500

    Fix i915 textured video to work with the i830_memory -> bo change.
    
    Forgot to update i915_video.c in 872aadc7102bd5131e1582ede081e22672911ba2.

commit 96da26b6813a8c1da8a43036c375aa0d2bb70f16
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Thu Feb 19 16:40:19 2009 -0500

    Dont allocate overlay registers in KMS mode.

commit 872aadc7102bd5131e1582ede081e22672911ba2
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Feb 18 17:26:06 2009 -0500

    Make Xv used a buffer object instead of i830_memory.
    
    We still pin the buffer object in case of overlay, but for textured video
    we're now no longer using i830_memory for Xv anymore.

commit 527e8177cde3abbabbcdccee0dbc0dcc0068a1be
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 18 11:26:58 2009 +0800

    bios_reader: parse driver feature BDB

commit 62ca1c479825ffa0e9cf444b4e25080150faa45b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 18 10:49:00 2009 +0800

    Fix SDVO mulitiplier setting for 945G
    
    Wrong SDVO multiplier setup has been slipped
    in SDVO TV patch. Thanks Michael Fu to point this out!

commit 723b6065093adb56a2d7204bd990ceae41bfafc9
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Feb 17 13:48:04 2009 -0500

    KMS: Hook up crtc::gamma_set.

commit 506bbb8341c052499057834a669b82787454b426
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Feb 16 14:09:49 2009 +0800

    Safely init SDVO found variable
    
    Found by Michael Fu for my last SDVO detect fix.

commit 9d464bd5b0d2724f5edb26e859888ceb6a248f9b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 11:15:48 2009 +0800

    Fix SDVO/HDMI detect
    
    SDVOC detect bit is only valid for HDMIC.
    And for SDVO devices, SDVOB detect bit should be used
    to probe all possible SDVO outputs.

commit 48445d2e939328495b4abe0fb7e579dfcef727bb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 11:11:18 2009 +0800

    SDVO: remove ForceSDVODetect option
    
    Which is just a hack to hide our SDVO detect drawback,
    we will have SDVO/HDMI detect fix later.

commit ddedf19f889da2ce6d69a3afce4665e2245682fa
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 10:09:42 2009 +0800

    SDVO: Switch control bus only before DDC access
    
    Instead of set control bus switch before every i2c start,
    just set once before doing DDC. This should eliminate some
    encoders returning error during that.

commit f1ca56e17d0ecd4f1299061a6b3272bfd289e123
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 10:02:02 2009 +0800

    SDVO: Fix TV support
    
    As SDVO TV uses SDVO_TVClkIn from SDVO encoder for clock reference,
    it needs to generate proper PLL for current input clock. This uses
    fixed PLL table from vbios for this. And possible sdvo mulitiplier
    has to be setup correctly. This makes TV output stable on my 945GCLF2
    board with NTSC-M format.

commit acde0ef683d6ec33d0b478923ffb11bd6785798f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 09:53:57 2009 +0800

    SDVO: fix CREATE_PREFERRED_INPUT_TIMING command

commit 824b2f0c5530c3196901c961757e6677b042caf3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 09:50:45 2009 +0800

    SDVO: fix usage for SET_TV_FORMAT and GET_SDTV_RESOLUTION_SUPPORT command
    
    They both needs parameters.

commit 62c0c2f5549a51c5df209f7353a19ca301f221be
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 13 09:48:34 2009 +0800

    SDVO: fix error in modeline and DTD convert

commit 37c67088a887e6380571e6eec8a8f058e3e24717
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 11 15:15:27 2009 +0800

    SDVO: check EDID info for DVI-I
    
    For SDVO DVI-I, check EDID info for digital output,
    otherwise mark it to be disconnected as analog output
    is driven by VGA then.

commit 38079bc0f1038da77048bbf6e5c10758f9fb8a55
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 11 14:41:58 2009 +0800

    SDVO: Fix for HDMI encode and audio setup (try 5)
    
    SDVO HDMI encode and audio is not setup in detect,
    which fails in hotplug case for HDMI audio. Fix to
    check current encode type and set flag for HDMI audio
    enabling.
    
    Check and set HDMI encode state in get_modes.

commit 3012d85cc5eb58c2447e93c05c39dc14feaae988
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 10 18:47:28 2009 -0800

    uxa: Fix breakage from UXA_FALLBACK conversion from "do {} while (0)" construct.
    
    Thanks to keithp for post-commit review.

commit 5009127de7d9527ae329d1c2fbc7283648bde2e6
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 10 18:23:35 2009 -0800

    uxa: Fix driver against fbDoCopy -> miDoCopy change in the server.

commit b53977f4c53c7c8f562f909e985b8d5a7b2526f3
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 10 18:22:46 2009 -0800

    uxa: Fix failure to --amend in further changes in previous commit.

commit 5212ec6515c6562f66b86fc16928b601bf04e49b
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 10 15:35:20 2009 -0800

    uxa: hook up the fallback debug to the driver's fallback debug option.

commit 3aa8591abfbe8db0f13912910c850fdd748808df
Author: Ma Ling <ling.ma@intel.com>
Date:   Fri Feb 6 09:14:15 2009 +0800

    Don't disable vga centering bit.
    
    commit id b9f5915ce812144ffd9d2aa42e8ba856129c35e,
    which resolved bug #17235, but generate new regression-bug #19715.
    This patch intends to resolve bug #17235, and avoid regression as well.
    We have successfully re-tested it for bug #17235 and #19715 respectively.

commit 9fe5fca3fe761a4f11857d9766138a60f471a9e6
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Feb 4 06:00:39 2009 +0800

    TV quirk for HP Compaq nx6310

commit 5c370091620b38447172ebeffbc6ed3256e86c9d
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Feb 2 12:02:00 2009 -0500

    Fix front buffer memset() for non-KMS case.
    
    Missed the pI830->FbBase condition when removing the KMS hook.

commit 2013799b20599a58de48cb21a5a389e898a58af1
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Feb 2 11:51:47 2009 -0500

    Un-revert the I915_SETPARAM_NUM_USED_FENCES commit reverted by accident.
    
    Oops, my bad.  Reverted 8d4bc36fae50b09a73ba2cfab920adb32141a358
    since my kernel doesn't yet have the new param, committed
    the revert by accident.

commit 127330bfd53ac7571bdd12a551142528b972893f
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Feb 2 11:02:59 2009 -0500

    Fix last-minute "cleanup" that broke the patch.

commit 0cb87ccfe97b0e016e47dcf236fd5ce78dddfc4b
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Fri Jan 30 17:53:03 2009 -0500

    Implement front buffer resize for KMS.
    
    This adds back the resize hook so we can resize the front buffer under
    kernel mode setting as well.
    
    The patch also pulls the drmmode_* structs from drmmode_display.h into
    drmmode_display.c and eliminates the header file.

commit 66bc44e8f9a0505c0b11b8042243ca74079da85f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 27 15:43:58 2009 -0800

    dri2: Use modesetting's master fd instead of opening our own non-master.
    
    This fixes failure to auth DRI2 clients under KMS.

commit 8d4bc36fae50b09a73ba2cfab920adb32141a358
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jan 26 17:14:06 2009 -0800

    Support tiled back/depth on 915-class hardware with DRI2.
    
    Set alignments, tile settings and flags correctly in the 2D driver to support
    tiled rendering.  UXA's create pixmap function currently assumes the worst
    about the alignment constraints; that should probably be fixed.  Some of the
    1M alignment fixes could probably be done more cleanly as well.

commit 6c0ca1676bf60529dd331cc739abdf68fa9e918d
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 21 15:52:02 2009 -0800

    Don't forget the new state bos in check_aperture.
    
    They're tiny so it shouldn't have been a problem, but play it safe.  This is
    another <5% loss on top of the previously reported value, bringing the whole
    series to about 8%.

commit 57a02b50c60c10a25ff0f3cd93af9f37fa0d1b11
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Jan 26 14:58:28 2009 -0800

    Fixup bogus VBT modes when detected
    
    Several VBT modes out in the wild have H or VSyncEnd values greater than
    the H or VTotal value.  This clearly ends up creating a bad mode,
    causing some panels to either ignore the timing or display some sort of
    corrupt image.
    
    Check for these cases and fix them up by default, making things work for
    several Dell and Sony machines.
    
    Fixes FDO bug #17292.

commit e20e1cf76fb00ba4f933a1ed6d1a4896be346c91
Author: Bill Nottingham <notting@redhat.com>
Date:   Sat Jan 24 08:36:20 2009 +0800

    Quirk MSI IM-945GSE-A LVDS, TV outputs.
    
    The IM-945GSE-A claims to have a TV output, and always claims a connected
    LVDS output. It has neither.

commit 05ff561234cc2b93fe1ea2a35041fa2e119a7e38
Author: Vincent Mussard <vmussard@free.fr>
Date:   Sat Jan 24 08:33:16 2009 +0800

    quirk for AOpen MP45

commit fbf003ef2767a1a9f5e4064f04a17992030d8f5c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 5 17:27:13 2008 -0800

    Move i965 render sampler state to BOs.
    
    This eliminates the pinned memory allocation for 965 render state.

commit befd4ad8beae39377f804e06c7cbd926ec4251db
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 20 14:43:08 2009 -0800

    Move i965 render kernels to BOs.

commit 5d705de5d11297f4d6bd5237fb67619e703745bc
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 5 15:30:35 2008 -0800

    Move 965 render unit state to BOs.
    
    This is a first step in a series of changes to avoid requiring a pinned object,
    which gets in the way of doing non-root KMS.  This change appears to result in
    about a 2-6% loss in x11perf -aa10text, which better algorithms in libdrm could
    make up for (it hasn't really had to deal with code this bad before).

commit 64b08ed5ad46ccd76964972e39bfed8721a920aa
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 20 17:13:52 2009 -0800

    Remove 965 render wm scratch space, which was just unused.

commit f126aabdf8952177bb15f392041da7a7094eb31b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 21 12:52:36 2009 -0800

    Fix build with server 1.4.
    
    Debian "unstable" is still stuck with this ancient version.

commit 253b8db298f38676e47dc902534465054f7b58b8
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Jan 21 09:02:13 2009 -0800

    Don't run in KD_TEXT mode even with KMS
    
    Leaving the VT in KD_TEXT mode keeps the kernel's blanking code active,
    so when a DPMS event happens, the fb console is restored rather than X's
    configuration.  On the downside it means the kernel won't print messages
    in the background, which would be visible if a panic or emergency switch
    occurred.  The proper fix here is a new kernel mode, which we can move
    to when ready.

commit 131b414feb2ecabe31b538d65725ac4427a4387a
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Jan 21 09:01:05 2009 -0800

    Tear down batchbuffers unconditionally on LeaveVT
    
    Even if KMS is enabled we should do this, to avoid running batches that
    depend on other state we tear down in LeaveVT.

commit b6f3ce32e295929f461a7bc37e61f126fb51e4aa
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 20 10:45:23 2009 -0800

    Use drm_intel_bo_subdata to put render vb data in.
    
    This improves performance by avoiding repeated map/unmap cycles, which are
    a bit expensive on my machine with lock debugging on in the kernel.  It could
    do much better if we did more than 18 or so floats at a time.

commit 9a8bbb1951ad0ca0a9407a97348fc7fa03127900
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 19:34:50 2009 -0800

    Move i965 render vb setup to use time, and decouple state emit from it.
    
    The require_space had failed since it only checked for the space required
    by the batch emits in the function itself, but not in the
    i965_emit_composite_state() that it called (the state we were concerned about
    having set up for that 12 * 4 dwords to follow!).  This is replaced by
    intel_batch_start_atomic(), which will catch such mistakes in the future.

commit 3d739597c4f5817079efd9067ad5db2f4105f765
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 20 10:37:20 2009 -0800

    Move i965 render transform setup from emit_composite_state to prepare_composite.

commit e20f7278f3abb44a3a151ac91f83c45cf1a2745a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 20:31:31 2009 -0800

    i965: Pull check_aperture out to a separate function and make it dtrt.
    
    Previously it wouldn't count the pixmaps that were about to be used, which
    is pretty much the only purpose of having the pain around.  This also
    eliminates the check_twice confusion with emit_batch_header_for_composite().

commit 013e2adfbf955cb21450b610091542ebd54392c2
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 20:24:20 2009 -0800

    Move filter computation from emit_batch_header to prepare_composite.

commit a340fe5e4227ebea5493e658eb6289624b07ab0b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 19:11:41 2009 -0800

    Use intel_emit_reloc from video to prettify 965 render bind_bo setup.

commit aefe198ca427a5ad69717f49948eb3ede713bb28
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 18:57:01 2009 -0800

    Move i965 render state bo setup back to prepare_composite.
    
    We want the objects to be created once per prepare/done both for efficiency and
    so we can handle aperture checking better.

commit 946c7ef8170e74ac178c83b1465242d57fa86f2e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 14:43:20 2009 -0800

    Do check_aperture_space and batch_start_atomic for i965 video.
    
    This increases the overhead for video in the presence of cliprects, but we
    were already doing nasty things in that case and don't seem to care.  This
    could fix potential bad rendering or hangs with video, particularly with
    DRI2.

commit 7be668179a12918918cad863f6936ced4ab78dbf
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 19 14:29:25 2009 -0800

    Move 965 video setup to a separate function so we can move it around.

commit c7db3201106f07f3228c989014d6db5ace5378f6
Author: Owain G. Ainsworth <oga@openbsd.org>
Date:   Tue Jan 13 18:46:41 2009 +0000

    Remove the pageflipping infrastructure.
    
    It was broken on current kernels, and deprecated anyway.

commit c82adfd0169317efb6c2f9de0f315651f9adbae1
Author: Owain G. Ainsworth <oga@openbsd.org>
Date:   Tue Jan 13 17:09:00 2009 +0000

    Remove triple-buffering support
    
    It never worked with any upstream linux kernel, and is quite heavily
    deprecated. A new solution based around DRI2 will probably be
    forthcoming. Pageflipping itself is next.

commit ada44c1c0edcd3ea9e41ed6b6fdb2bf0e87c9c67
Author: Kshitij Kulshreshtha <kkhere.geo@gmail.com>
Date:   Tue Jan 20 11:35:36 2009 +0800

    Support sysfs backlight control for Sony laptops in xf86-video-intel
    
    The sony_laptop kernel module (since v2.6.23) supports backlight control
    via the sysfs interface:
    /sys/class/backlight/sony
    
    This patch will enable xf86-video-intel to use this backlight control method
    for Sony VAIO Laptops with Intel integrated video.

commit d89de6d60a86105a198d904821853e6ed7de3305
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jan 16 16:59:17 2009 -0800

    Protect i915 textured video against batchbuffer wrapping.

commit 15780c53f5717936ea10ac87aff8a881c172f1dc
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Jan 17 16:23:38 2009 -0800

    Fix i915 batch_start_atomic counting.

commit fc46cb6403387215d13aa28d720f205688ae9d67
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Jan 17 12:47:53 2009 -0800

    Fix libdrm version number requirement regression that got spammed in.

commit 1459f794e2a4b9032807c3794b00a33fa6392837
Author: Dave Airlie <airlied@redhat.com>
Date:   Sat Jan 17 22:14:26 2009 +1000

    intel: fix DRI2 should be DRI_DRI2

commit db43b7870a37ea273941302096a6f00120dfae71
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 15 19:05:52 2009 -0800

    Re-emit i915 composite setup when the batchbuffer wraps.
    
    This also introduces tests to make sure that we asked for enough reserved space
    and that we don't allow wrapping at the wrong time.
    
    This fixes a hang during text rendering with DRI2 and a GL client running,
    but could potentially affect text rendering with GEM in general with an
    exceptional batchbuffer setup.

commit cab5b7a7b0e17414f98b2363b0961c87f32f9c05
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 15 09:31:55 2009 -0800

    Fix invarient state emits for DRI2 (do it per batch, since there's no lock).

commit 9f306193c4b128ec72c5b4db16d07302cee50ab5
Author: Owain G. Ainsworth <oga@openbsd.org>
Date:   Tue Jan 13 18:42:44 2009 +0000

    Fix ioctl type.
    
    I915_EMIT_IRQ is a read/write ioctl, not a write only. Found by OpenBSd's
    kernel code which checks these things a long more strongly than Linux.

commit 1e8588ad5087c69eb77399cfaab8e4ec15eb4da9
Author: Owain G. Ainsworth <oga@openbsd.org>
Date:   Tue Jan 13 17:02:59 2009 +0000

    use ifdef __linux__ where needed.
    
    since modesetting is compiled by default now, ifdef __linux__ the linux
    only includes and ioctls.

commit db9f5915ce812144ffd9d2aa42e8ba856129c35e
Author: Ma Ling <ling.ma@intel.com>
Date:   Wed Jan 14 14:46:52 2009 +0800

    Disable VGA plane reliably
    
    This fixes #17235, VGA random hang on recent G45/43 board.
    From spec, SR01 bit 5 should be set before VGA plane disable through
    control register, otherwise we might get random crash and lockups.

commit a4b023c17b9c3bd65fb9466ddb8a953f60244402
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Jan 13 20:01:49 2009 -0800

    Assign rotation memory dri_bo to rotation pixmap.
    
    As the rotation memory and rotation pixmap are allocated separately (to make
    rotation at startup work), the allocate dri_bo needs to be set in the pixmap
    for acceleration to work. This restores the performance in rotated modes.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit f659cc37e61364a408355b9a6a44d39f4d759935
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Jan 13 16:49:41 2009 -0800

    bios_reader: make mode timing output friendlier
    
    Print out the calculated mode line values (as i830_bios.c uses) and
    check for validity against known problems.

commit c80f1a9c5131721eaf87d12a7a67e603cdfed63b
Author: Bernhard Rosenkraenzer <bero@arklinux.org>
Date:   Tue Jan 13 10:35:19 2009 -0800

    UXA: Declare glyph cache picture as component-alpha when necessary.
    
    Without this, rendering component-alpha glyphs may break without a mask.
    
    Bug #19534.  Ported from fix by Michel Dänzer <daenzer@vmware.com> in
    xserver commit 639f289dcdbe00a516820f573c01a8339e120ed4

commit 3d206f9e46b5237bda7ca3c0f92d64c45ee8bdf5
Author: Ma Ling <ling.ma@intel.com>
Date:   Tue Jan 13 10:26:40 2009 +0800

    set continuous-frequency flag in get modes function
    
    http://bugs.freedesktop.org/show_bug.cgi?id=19247
    Because latest xorg will check whether the display is continuous frequency through one flag in monitor info structure,
    if not it doesn't touch default modes. When laptop failed to fetch edid, We don't set the flag. In i830_lvds.c,
    so currently we can not get default modes except only one mode line from bios.
    In order to achieve default modes from xserver successfully,I set the flag and other EDID features.

commit 3354e660b0744976871683ce226f17e873f26b50
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Nov 26 16:32:12 2008 +0800

    Fix LVDS EDID to match all possible default modes
    
    If the EDID data from the LVDS doesn't indicate support for a wide range of
    continuous frequencies, it will not match any of the default modes although
    our LVDS scaler logic ignores refresh rates when programming LVDS modes. Fix
    this by smashing the compute EDID data to open up the sync rates.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit f1e9ca4e4fb3ddb083252aea79c67c5e5e71f29c
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Fri Jan 9 16:30:15 2009 -0800

    Remove xorgconfig & xorgcfg from See Also list in man page

commit 91c49067abab262edce54d33af8bfc03eee20f2e
Author: Ian Romanick <ian.d.romanick@intel.com>
Date:   Wed Jan 7 21:45:54 2009 -0800

    Prevent redefinitions of CARD8 and friends.  Fixes build.

commit 934008a2cbcec0c790580750c672c0367a9e4c55
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 6 10:55:59 2009 -0800

    Always enable KMS if server's new enough, and remove option.
    
    The API should be stable at this point, and we don't want to allow mistakes.

commit 342120be0956bfc12822d1ffbfbd8aaabf3e922f
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 5 23:21:07 2009 -0800

    Fix pin leakage with EXA GTT-mapping shortcut, and crash with UXA on KMS.

commit 9a5082d2920c1a212fe935b5a093013e8035c321
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 5 23:28:50 2009 -0800

    Disable DRI2 buffer tiling on non-965, as those need fence regs for 2D blits.
    
    This fixes glReadPixels failure on single-channel 915GM, as the software code
    for readpixels was actually the only code in the driver doing tiling against
    these buffers (everything else says "rely on fence registers", since the 2D
    blits don't have a "don't rely on fence registers" option).

commit 7736b65be4fb4d5c59d7aedb1e64da976bb10ae9
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 15 15:49:01 2008 -0800

    FatalError on batchbuffer map failure
    
    Yes, it would be nice to do something other than crash here.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 632f816c72cb4b48b690fd92d1cc1d5a9c9285c7
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 15 15:43:34 2008 -0800

    uxa: handle uxa_prepare_access failure
    
    uxa_prepare_access may fail to map the pixmap into user space. Recover from
    this without crashing.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 90b28a56553d809374fa6d9b9529b7a8b583488c
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 15 15:41:28 2008 -0800

    Handle drm_bo_map failure in 965 video and composite paths.
    
    These two paths allocate a number of objects directly.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 8237faf8f3ca73ecdf0ef009a7d361b318726f6f
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 15 15:35:35 2008 -0800

    Resize framebuffer on screen size change (requires UXA and DRI2)
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 21bd4e8974e4c0e83f5f95adb0fc17290444caf5
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 15 15:19:00 2008 -0800

    Make i830_allocate_memory take tiling parameters.
    
    This eliminates the separate i830_allocate_memory_tiled function which means
    that all memory objects will have tiling parameters set correctly.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 1f61e97904dfe5f8c08bb9f284cfdfe878f7e541
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 31 22:56:57 2008 +0800

    UXA: Fallback to dri_bo_map() if pin failed
    
    This fixes VT switch issue with UXA after Eric's
    aae4008096399a0e84abc7c016b35092caf9db25 on 2D side.

commit 830bf916724afd21b7947f797c22a8c8aab7a0a4
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 13:42:44 2008 -0800

    Don't touch the pipestat regs for detecting FIFO underrun. The kernel owns them.
    
    Since we don't perform any synchronization with the kernel on these regs, we
    could race with the kernel to write stale values and end up not having vblank
    interrupts enabled when somebody was waiting on one.

commit d96f774d1bb39640486c72338fe8b19ee1ceaa23
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 13:57:24 2008 -0800

    warning fix.

commit 59b0fbb9be880d489374b141f818948a2721a2ef
Author: Henry unbongo <henryunbongo@yahoo.com>
Date:   Mon Dec 29 13:54:38 2008 -0800

    Add support for SDVO LVDS.

commit 750d8e105831718d4a44a145fdb87571fa9f9d8e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 12:44:26 2008 -0800

    Fix compile failure after 45f45c73469f1bd46a1b6fb206f2e9e5e4fd66b3

commit 45f45c73469f1bd46a1b6fb206f2e9e5e4fd66b3
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 11:26:11 2008 -0800

    Remove logical context setup.
    
    This should be a noop.  If it wasn't a noop, it means that on pre-g33 chipsets
    we were spamming some data into a page of system memory because we used a
    virtual instead of a physical address.  It was also supposed to not work when
    we submit it from a batchbuffer, as we have been doing for some time now.
    This code has existed since about the beginning of the driver's existence,
    with no justification.

commit 3544bbe22d8cf2640289e1e4febe755a47f26631
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 10:41:02 2008 -0800

    Add PCI write posting to LeaveVT path when we're about to wait on write results.

commit 7b67914b23b54d4d9566190440a3430e40615aa8
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 28 15:51:50 2008 -0700

    Add SDVO LVDS register definitions.

commit 8464fc285d7b22fd45b7af616fd52aa15e16638a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 29 09:51:45 2008 -0800

    Rely on libdrm 2.4.3 and stop checking for xf86drmMode.h.

commit c1dde7ac06ce6470c74198b2560ee67d28fb0aea
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 22 16:49:57 2008 -0800

    Remove old mergedfb includes and defines, which bother spatch.

commit 75799d2834be84b016391ec95b221df32380e3e7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Dec 30 00:55:30 2008 +0800

    Bug #18004: Add Aopen 915GM LVDS quirk

commit cfaaf6af777ad8e56da5a077bdc01f4f2d7bc4d6
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 29 21:17:44 2008 +0800

    Don't count vertex buffer in second aperture size check
    
    With batch flush notify vertex buffer will be unreferenced,
    so don't count it in later aperture check. Also adding
    uninitialized vertex buffer check in batch flush notify.

commit b710a688a7383df320f9d4e765b48331310a4d1d
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 29 12:50:25 2008 +1000

    intel/kms: disable overlay when it needs physical address
    
    We can't do phy address allocations, need kernel support for this.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 649374b88b330838133d78be1953ce8b18ddd2c6
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 29 12:48:11 2008 +1000

    intel: don't call enter/leave VT for KMS enabled systems
    
    Signed-off-by: Dave Airlie <airlied@linux.ie>

commit 408f7139354a942f29334795b5480a0b6bb6142a
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 29 12:47:30 2008 +1000

    exa: fix map gtt call to use current API

commit fcd280b730f86ea54ecd89d3e037e71f8375b5f5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 29 10:05:17 2008 +0800

    Bug #19239: Add a quirk for broken ACPI lid state
    
    For broken hardware/bios with incorrect ACPI LID state,
    there's machine that can not be fixed in ACPI way, customed
    DSDT that reprogram _LID method to read EC state. Although
    this is ACPI issue, this quirk can be used to work around that.

commit 6b9f421b792c701e909d81ae2b6e6a47fb069b0b
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 29 11:51:58 2008 +1000

    modeset: transformPresent is a new API member

commit a320541e51818833a6a445707835fbf70e9babd4
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 29 11:34:51 2008 +1000

    modeset: fix xf86CrtcRotate API change across server versions

commit e38fd84fcccc18284b649a60b4cfd8e24eaf059d
Author: Ma Ling <ling.ma@intel.com>
Date:   Mon Dec 22 10:35:52 2008 +0800

    SDVO: reset pixel repeat in avi frame
    
    For #19115, the root cause  is  avi_if.u.avi.PR in
    i830_sdvo_set_avi_infoframe() belongs to element for
    interlaced mode based on CEA_861B, but currently we
    don't support interlaced mode. So it should be set as 0.

commit d8e89b26ef5ef2c15e5d34162b14d279a7f0bb1c
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Fri Dec 19 09:34:14 2008 +0800

     [965-xvmc] remove the vblank wait code, drm not support mutlple client
    to wait on vblank now.

commit aae4008096399a0e84abc7c016b35092caf9db25
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 17 14:25:22 2008 -0800

    uxa: Do a hack to use the aperture mapping instead of bo_map in sw fallbacks.
    
    Because of how fallbacky the uxa rendering core is, and our inability (without
    wfb in userland or page faulting in the kernel) to tell the kernel just where
    we're going to fall back, the clflush overhead can become outrageous, for
    example with emacs and xcompmgr.  Instead of using drm_intel_bo_map, pin the
    buffer and do the fallback to the aperture mapping.  This gets us the bad old
    performance that fb is designed for, instead of bad new performance.

commit 74bc420940de4ed02705211ddebbc4033c032242
Author: Peter Alfredsen <loki_val@gentoo.org>
Date:   Fri Dec 19 08:10:06 2008 +0800

    xvmc: fix up needed libs

commit 555eea5411cf8c725df5f1b4cb80198fa6a1225b
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Dec 17 13:55:07 2008 +0800

     wait vblank before render to fix tearing

commit ed267072db7c58ee16a458fd3dc24ce3a2d0061d
Author: Robert Noland <rnoland@2hip.net>
Date:   Wed Dec 17 09:27:30 2008 +0800

    Fix drmOpen for non-linux 965 XvMC
    
    drmOpen by name only works on linux after falling back to groping around
    in /proc.  This doesn't work on other OS.
    
    Signed-off-by: Robert Noland <rnoland@2hip.net>

commit ecdd706873c1f990f4a78fbaecf7380411edabcd
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Dec 14 16:09:25 2008 -0800

    uxa: Correctly prepare/finishaccess of stipple in ValidateGC (and only it)
    
    This avoids prepare/finish_access_gc overhead when we're not changing things
    (since GCTile is already handled) and get us the RW flag for the prepare on
    of the stipple pixmap so thing will be synced correctly.

commit e6479f96e5d8da39fcbb5376c4a66a1f924ec4e4
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Mon Dec 15 14:54:20 2008 -0500

    Quiet some KMS warnings.

commit 30fb0ef53e19b759715f1ee14b81b11c81d79045
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Dec 16 00:39:45 2008 +0800

    Revert " [965 xvmc] update dual prime g4b files"
    
    This reverts commit ea2b6b405e4c8b1bfb4bc568d0453a39a9194a8f.
    
    Duplicate with Keith's commit. No idea what's diff target
    of this one.

commit ea2b6b405e4c8b1bfb4bc568d0453a39a9194a8f
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Dec 15 09:19:43 2008 +0800

     [965 xvmc] update dual prime g4b files

commit d917583c19e2eb20a559eddaa100ce71d8fbe48c
Author: Pierre Willenbrock <pierre@pirsoft.de>
Date:   Mon Dec 15 09:08:30 2008 +0800

    closedir only after finishing use of any results from readdir

commit 865735d8408ee6b75be8fb1a8ab32b2a53dd3adb
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Dec 12 11:07:20 2008 -0800

    Dump out fence registers by default, add fence end registers as well
    
    In debugging the frame buffer resize code, I needed to see what the server
    was doing to the fence registers, so I added this debug code. Seems useful
    enough to include it.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit f3e59e59b54696667b127c82327e16b14d7bab22
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Fri Dec 12 11:18:25 2008 -0800

    Update binary versions of the dual-prime kernels
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 80d588e9c49719ec494e705edfc14c78908bbc3f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Dec 12 18:27:29 2008 +0800

    Don't warn on ring enabled in GEM

commit 60c4ee9ece8ea57e61b1590dfeb69d08555e465c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Dec 12 18:00:09 2008 +0800

    Fix directRenderingType check
    
    Don't miss classic texture memory allocation in DRI.

commit edf765155497d89ecac328a5b268ecf60e2f377c
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Dec 11 15:41:59 2008 +0800

     [965-xvmc] fix dual prime kernel, flush issue on G4x

commit 80e2d90139dd99f50beb4f9353599608624b777d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 11 13:45:17 2008 +0800

    Let lid status be unknown if no acpi lid object found

commit 83377b543defdca7226d7c1a7794e4ff3d8b4c84
Author: Bryce Harrington <bryce@canonical.com>
Date:   Thu Dec 11 09:38:27 2008 +0800

    Pipe-A quirk for HP 2730p (bug #18852)

commit 6c4e134a1a30785c2e5c6d57b21fde54a2dd3413
Author: Bryce Harrington <bryce@canonical.com>
Date:   Thu Dec 11 09:34:15 2008 +0800

    PipeA quirk for Quanta/W251U (launchpad bug #244242)

commit 1e974ff6b8446ecd64677b3c9aba60ca850923cc
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 10 10:54:31 2008 +0800

    Try to always probe SDVOC on 965G/965GM
    
    Detect bit of SDVOC is reserved on 965G/965GM, instead of ignore SDVOC
    this trys to always probe it on these chipsets.

commit f5f67e1b54e67b4bfc3db3482b2693211be81d63
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 10 10:36:07 2008 +0800

    bug #17395: Quirk CRT for Sony VGC-LT71DB

commit d8b764fbd27dc9c8b28386093931b8d38855bd19
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Dec 9 21:51:14 2008 -0800

    Add RandR 1.3 panning support by supporting the crtc set_origin function
    
    RandR 1.3 panning support can use the regular mode setting interface, but
    that's really slow. Providing set_origin makes it nice and snappy.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 4d7a95959d8223aec41550eb19f60b3edd7210a1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Dec 9 19:48:11 2008 +0800

    Try to add LVDS detect support
    
    This one trys to use lid status for LVDS detect,
    which works when internal panel is not used as primary
    display alone, or there's no internal panel at all.
    ACPI button driver's lid state interface is preferred,
    and SWF state is also checked if ACPI method failed.

commit 0fe61b0b7e3bbe8ced1b0ad2be72c438d200c64b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Dec 9 19:19:58 2008 +0800

    Remove Cappuccino SlimPRO SP625F 855GM LVDS quirk
    
    It breaks bug #18462 on IBM 855GM with same subdevice ids.

commit bea98cdfd93fc1181a06c51e57fcab227ff4827e
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Dec 5 15:42:53 2008 -0800

    Set vertex_buffer_bo to NULL after unreference.
    
    Which is just being tidy. We initially were looking at this code
    path due to a report of a crash on server shutdown which started
    after this unreference call was added. Setting this to NULL
    apparently didn't avoid the crash, but it's a good thing to do
    regardless.

commit ce7efc2e3676c8f80206415480dda91e5e021396
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Dec 4 11:41:02 2008 -0800

    Don't smash fixed_mode if skip_panel_detect is set.
    
    Without this change, setting LVDSFixedMode to false is not effective
    as i830_bios_init calls i830_parse_panel_data which in turns sets
    a fixed_mode. To fix this we still call parse_panel_data to set
    the various lvds_options but we return before setting fixed_mode.

commit e8b95efbf5d9c3a5b75b2bb8b5b51844b5fcdfbc
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Dec 3 13:49:52 2008 -0800

    i965: Add batch_flush_notify hook to create new vertex-buffer bo
    
    This avoids mapping a buffer object which is being referenced
    by a batch that has already been flushed, (which is a terribly
    expensive operation).
    
    On my machine this brings the performance of x11perf -aa10text
    from 85k back to 150k, (where it was before a recent kernel
    upgrade). Also, before this patch, when I used my X server
    actively performance would drop as low as 15k---hopefully that
    bug is gone with this change.

commit 768f317cf0da4cd6682af2e71e71c3e130e05182
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 8 10:33:13 2008 +0800

    Fix DRI2 compiling warning

commit 95596f51503bb468364719aec9083d59999e34b7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 8 10:30:12 2008 +0800

    Fix TV compiling warning

commit c47b6d1def917fad5ad2b5a3e4167edfd354f2c8
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Sat Dec 6 21:20:52 2008 -0500

    Make sure DRI/DRI2 can initialize properly with KMS.

commit 70af658d4e94cc372f9e9c831611f70b3c1cecab
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Sat Dec 6 19:19:21 2008 -0500

    Simplify crtc preinit a bit.

commit 3ad9c9a82d7b359b9b711070628e6ff07a2aa9f7
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Sat Dec 6 19:17:39 2008 -0500

    Fix KMS compilation.

commit 2e3c098c5ed9a8451713dc754a5f086992249336
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 5 12:21:53 2008 -0800

    uxa: Reject solid/copy to under-8bpp destinations.
    
    EXA wouldn't create pixmaps for under-8bpp, but UXA does.  Fixes
    mis-rendering in xfwm, evolution message compose, firefox link
    drag'n'drop, and I'm sure more.  Big thanks to Pierre Willenbrock for
    debugging the issue!
    
    Bug #18050

commit 261c20a479f6ec1e94c2ba801323072227cc3ade
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 5 12:13:26 2008 -0800

    uxa: Add in EnableDisableFBAccess handling like examodule.c did.
    
    This fixes assertion failures when rendering text while VT switched.

commit caecd6031e416705b1f0a7051535211feaebdedd
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 15:18:08 2008 -0800

    Remove the extra memory allocation for 965 video state now that it's all in BOs.

commit 48c113ade26d5ad64999cd5cc288495c10e02fc4
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 15:10:49 2008 -0800

    Emit proper relocations to pixmaps in BOs in i965 video.

commit ae2cd8b75e41393e072e27064ecefecf1aa1bc6c
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 15:02:12 2008 -0800

    Move i965 video surface state and binding table to BOs.

commit 1b3c3c9d79305abe1785fdaef26a950dafa8890f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 14:30:56 2008 -0800

    Move i965 video vertex data to BOs.
    
    This eliminates extra syncing when clipping is involved.

commit 84825972597042f0aa6784594dace96be96a0234
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 14:26:09 2008 -0800

    Move remaining i965 video programs to BOs.

commit 40671132cb3732728703c6444f4577467fa9223f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 14:20:21 2008 -0800

    Move i965 video wm and sampler state to BOs.

commit 48803eb7463ad14f3109f67fcf4ccff4362baaa2
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 13:22:12 2008 -0800

    Stop allocating unused scratch space for i965 video.

commit f3fe46b557a4dd7e212c2790fb47142d375c1c75
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 13:18:06 2008 -0800

    Move i965 video vs/sf state to BOs.

commit 4b9d3eac57a972c055c4acd7a10dfe8aa918131c
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 13:11:13 2008 -0800

    Move i965 video cc state to BOs.

commit 176e92d89fdfb199780014722feab6ac25836dcc
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 12:53:37 2008 -0800

    Move I965DisplayVideoTextured unit state setup to separate functions.

commit 61929f4c641e2ecb145ad2b22f7092d40e31ae6d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 11:44:35 2008 -0800

    Move I965DisplayVideoTextured surface/sampler setup to separate functions.

commit 73d03cb93ca761ee555b87558882e26bd2f10d91
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 4 11:37:38 2008 -0800

    Move debug code for I965DisplayVideoTextured to separate functions.

commit df01d8f0791bd825c96d9d5e20313d5ffcfeb532
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 4 16:11:33 2008 +0800

    Change master version to 2.6.99.1

commit b156b3165e1aae5df0353737d0335ac2e653f5fd
Author: Julien Cristau <jcristau@debian.org>
Date:   Wed Dec 3 04:35:38 2008 +0100

    Don't unconditionally define DRI2
    
    xorg-server.h will define it if the server has dri2 support.

commit 8d7cbab267e8fbcb2fcf90b18346b60607277266
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 4 18:43:03 2008 +0800

    Fix maxium backlight level restored issue
    
    The origin check for bring back max value for '0'
    backlight level is ok for legacy or combo control method
    as '0' mostly doesn't act in ideal lowest level. But it
    breaks in using kernel control method which should provide
    a reasonable backlight range.
    
    This is tested fine on T61 with thinkpad_acpi module.

commit 32e7d47925b445a85847d77651b258e117aaaffe
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 4 09:24:31 2008 +0800

    Disable XvMC on DRI2 for now

commit 293f6232c6c0ce12802a2123edfab4551d25e266
Author: Dave Airlie <airlied@linux.ie>
Date:   Wed Dec 3 16:51:25 2008 -0800

    uxa: don't call composite routines with no buffer.
    
    We can get a case with gnome-terminal + links, where we get two arrays
    of glyphs all with 0 width and 0 heights in them. If this happens
    we manage to get to this case without any buffer setup and segfault.
    
    (cherry picked from commit 717c7492a0f6ba3fb3eabda33515881eef314155)

commit 457a680afd0d8f835131ea72be0c3c618c2892c7
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 3 13:17:26 2008 -0800

    Enable tiling for DRI2 back/depth buffers.
    
    This results in allocation overhead for small (8x8-128x128 or so) pixmaps with
    DRI2, but we're interested in looking at tiling them in general in the near
    future, anyway.

commit b662ecccb5c036fcc4aa19026642bde0a1ca2ac8
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 3 10:50:33 2008 -0800

    Re-enable composite accel on 965 with UXA.
    
    This was blocked on getting 965 render aware of BO pixmaps, which is happily
    now the case.

commit d426f799f541cb32fab134f2af068c6cd31923d9
Author: Paulo Cesar Pereira de Andrade <pcpa@mandriva.com.br>
Date:   Wed Dec 3 14:59:21 2008 -0200

    Include <X11/Xfuncproto.h> prior to including "edid.h" from the sdk.

commit 07f5a8223187c1abc79c104d2fa5859a54cecd30
Author: Robert Lowery <rglowery@exemail.com.au>
Date:   Wed Dec 3 09:48:23 2008 +0800

    TV: add support to set TV margins in xorg.conf

commit 00ae7a571b6413aa2530e4f1310f8f4646631946
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 2 13:08:23 2008 -0800

    UXA: Add support for tiled front/back/depth by cutting over to the GTT map.

commit 34d54db945c67a2fee0a38cc9eafc463b8413669
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 2 13:01:56 2008 -0800

    Remove DRI_MM defines which are always true now.

commit f7540df184a75a749cabcfa2da8974d3d0714ea6
Merge: 5f34702 ee87f7b
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Dec 1 19:06:09 2008 -0800

    Merge commit 'origin/dri2'

commit 5f347020a52b583e19d333361ea7bf2591255899
Author: Paulo Cesar Pereira de Andrade <pcpa@mandriva.com.br>
Date:   Sat Nov 29 02:35:59 2008 -0200

    Export libIntelXvMC and libI80XvMC symbols.
    
      This is a side effect of adding the visibility flags to XORG_CFLAGS.

commit ec7fd3d1b477928f9bffde1a72d7f3fdea89e629
Merge: d978cd4 baec75a
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Nov 27 10:48:09 2008 +0800

    Merge branch '965-xvmc'
    
    Conflicts:
    
    	src/common.h
    	src/i830_hwmc.c
    	src/i830_video.c

commit d978cd4b453ea588ed2fc2f2cb4ec26856fe00d4
Author: Wu Fengguang <wfg@linux.intel.com>
Date:   Thu Nov 20 00:47:25 2008 -0800

    refresh batch_bo reference after intel_batch_flush()
    
    The call into intel_batch_flush() will invalidate the pI830->batch_bo
    stored in bo_table[0]. Fix it by re-read the refreshed value.
    
    Signed-off-by: Wu Fengguang <wfg@linux.intel.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit ee87f7becc2138348ec0d948829db6e86cee86da
Merge: 3dd7f0f a5b1e62
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Nov 12 16:40:37 2008 -0500

    Merge commit 'origin/master' into dri2
    
    Conflicts:
    	src/i830_dri.c
    	src/i830_driver.c
    	src/i830_memory.c

commit 30c29627c859f1f6780aa652d6de4fa985b63dd0
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Nov 13 12:35:02 2008 -0800

    Make sure DRM library paths are included
    
    We need @DRM_LIBS@ in order to find drm_intel if installed in a
    non-standard path.

commit 42ec6938bdea3a5b065a4248fdca5f031415191e
Author: Ma Ling <ling.ma@intel.com>
Date:   Fri Nov 7 14:23:41 2008 +0800

    enable Intel G35 SDVO HDMI audio output
    
    Set the SDVO_AUDIO_ENABLE bit to enable SDVO HDMI audio output of the
    Intel G35 chipset.
    
    Signed-off-by: Ma Ling <ling.ma@intel.com>
    Signed-off-by: Wu Fengguang <wfg@linux.intel.com>

commit 42b3903c3fda95a7c536cb957d8163d8dc54a9a1
Author: Wu Fengguang <wfg@linux.intel.com>
Date:   Fri Nov 7 14:23:40 2008 +0800

    enable Intel G45 integrated HDMI audio output
    
    Enable audio output for the integrated HDMI of Intel G45 chipset
    by introducing the SDVO_AUDIO_ENABLE bit.
    
    Signed-off-by: Wu Fengguang <wfg@linux.intel.com>

commit 293f4a8b6d1ca8a47d14c4d4b5904b85a8167e12
Author: Wu Fengguang <wfg@linux.intel.com>
Date:   Thu Nov 13 09:50:37 2008 +0800

    introduce i830_hdmi_priv.has_hdmi_sink
    
    HDMI is compatible with DVI, and we've seen many boards that
    use HDMI port for DVI output.
    
    So Zhenyu proposed this flag: i830_hdmi_priv.has_hdmi_sink
    to indicate the presence of HDMI capable monitors.
    
    Signed-off-by: Wu Fengguang <wfg@linux.intel.com>

commit 667923559219429b0c5fec12a0164f7eba1f8f2d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Nov 11 12:55:06 2008 -0800

    Default to FULL_ASPECT panel fitting
    
    Now that 8xx is fixed, we should be able to preserve aspect ratio by
    default.
    
    Fixes fdo bz #18033.

commit 65cd0fbb018b2c18f1571dc0924c7d92eaf794ad
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Nov 11 09:36:50 2008 +0800

    TV: fix contrast and saturation for 915/945G
    
    915/945G uses exponent-mantissa format instead of
    fixed-point format on 965G.

commit a5b1e62337d4e8840347bb186db48697f0690a19
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 7 16:06:26 2008 +0800

    quirk LVDS on Asus Eee box
    
    Reported by Yang Sheng <sheng.yang@intel.com>

commit 9942cfa6dcc70a09ea38f738b1e73e3f005080b9
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Nov 6 15:04:27 2008 -0800

    Use long crt hotplug activation time on GM45.
    
    The GM45 b-spec requires the use of the longer hotplug activation period,
    but does not require looping twice over the detection logic. With this
    patch, CRT detection appears solid on my GM45.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 226efa7c74c0ed8a7b974a3727c5d7322c8ef815
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 29 22:41:20 2008 +0800

    TV: subcarrier fix for NTSC and PAL
    
    Using subcarrier DDA values from spec give more close result to
    standard frequency.

commit 3651341292d90b7ded4c3f013bcb0f46537a113a
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 29 20:41:46 2008 +0800

    TV: fix timing parameters for PAL, 480p, 1080i

commit b404afb755b608b02bcf0be1f8fe8a38d3d7bc1e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 29 20:32:18 2008 +0800

    TV: save serveral TV_CTL register fields in mode set
    
    Driver should keep those fields according with spec.

commit 2ae91f0ffdadfb393d526b94e21914a31aa14232
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 29 20:26:44 2008 +0800

    TV: fix default contrast and saturation modifier
    
    Color knobs was set with higher modifier which caused strong color
    on TV screen. Setting fixed point modifier to default 1.0 makes picture
    on TV look nicer.

commit c4cab00ef7f57fc27776f53263aacec2edf6f959
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 29 20:26:03 2008 +0800

    TV: white space cleanup

commit b130f94f26111e1a12ce869292915504588d0369
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 6 10:14:00 2008 +0800

    SDVO: fix more command definition errors

commit 3ab979da5c867fb862e33a80b973a35d56d56a55
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Nov 3 16:05:28 2008 +0800

    SDVO: add command for set monitor power state
    
    SDVO encoder power state must be higher than monitor's state.
    This only adds command and doesn't enable monitor power state
    setting yet.

commit f558a4972d1cca03785da025170259c61541ee63
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Nov 3 16:01:40 2008 +0800

    SDVO: add GetScaledHDTVResolutionSupport command

commit cd8cbff5d7921d2f4fdac106c3d54414310af94d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Nov 3 15:20:18 2008 +0800

    SDVO: fix sdvo tv format and sdtv resolution request/reply definition

commit 61672b8c458ecf449138c51aeb12cf24dbbd59d9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Nov 3 14:59:53 2008 +0800

    SDVO: add HDMI audio encrypt change bit for GetInterruptEventSource command

commit 45fb04474d0e67643a633dcc3aeb4efe7fd71ea1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Nov 3 14:51:14 2008 +0800

    SDVO: fix wrong order of sdvo version's major/minor

commit 5cbf1e72711e906b5309694045b56933e14dca06
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 6 09:46:54 2008 +0800

    Make IS_GM45 into IS_G4X define
    
    Those are identical that using one define is much clear.
    And it can also apply fixes for GM45 too, which is missing with
    origin define.

commit 78b6cff3b6ec9513ede3e71d81a828967e6c0068
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 5 14:39:19 2008 -0800

    i965: Support render acceleration with pixmaps in BOs.
    
    This required reordering the relocation emits for surface/binding table
    so that we didn't add new relocations to things that had already been
    relocated at (the check_aperture requirement).

commit 801f0eac4f7b0071ed21eb9c68c5a951e1cc409a
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 5 13:29:39 2008 -0800

    Make I830FALLBACK debugging a runtime instead of compile-time option.

commit d828b0802c939cb12664db4dd157a4944a4db01b
Author: Maxim Levitsky <maximlevitsky at gmail.com>
Date:   Wed Nov 5 13:47:09 2008 -0800

    Add an option to make the overlay be the first XV adaptor.

commit 040d9bf9d8748d1ed8f977a6356d198def978b51
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 30 13:55:07 2008 -0700

    Remove the CheckDevices timer.
    
    This was an early attempt to support display switch hotkey.  It never really
    worked, as the events didn't show up when they should.  It also cost a wakeup
    every second to check just in case, instead of taking an interrupt like we can
    now using ACPI.  Additionally, some machines apparently get stuck with the
    event set and end up DDCing checking for new devices every second and
    smashing your video modes.

commit 08914cceda6c57530023cdcdb5ad7e4024f36a6e
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Oct 30 16:46:06 2008 -0700

    Use buffer objects for binding table and surface-state objects.
    
    Instead of having a static array for these and doing an ugly sync
    everytime we recycle the array, we now simply allocate short-lived
    buffer objects for this dynamic state. The dri layer, in turn, can
    take care of efficiently reusing objects as necessary.
    
    On a GM965 this change was tested to improve the performance of
    x11perf -aa10text from roughly 120000 to 154000 glyphs/sec.

commit 47cc3d79da8174ba30ca130b0fb6c7d9c871caed
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Oct 30 16:53:57 2008 -0700

    Unreference the vertex_buffer_bo in gen4_render_state_cleanup
    
    This avoids leaking one buffer object.

commit 88700acf30f9eab8f96c197c7d113ce38c0af6e7
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Oct 27 14:23:02 2008 -0700

    Rename gen4_dynamic_state to gen4_vertex_buffer
    
    We don't actually plan to put any other data in this structure, so it
    doesn't make sense to have a generic name, (since we'll only be using
    it for our vertex buffer).

commit 9e95722763e2379d14a6b46c3750a44713da5135
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Oct 23 15:43:19 2008 -0700

    965: Move composite setup to new _emit_batch_header_for_composite
    
    This function is the new name for _allocate_dynamic_state now that
    it also emits everything to the batch necessary for setting up a
    composite operation. This happens in prepare_composite() every
    time and in composite() whenever our vertex buffer fills up.
    
    It's not yet strictly necessary to be redoing this setup in
    composite() but it will be soon when the setup starts referring
    to buffer objects for surface state and binding table. This
    move prepares for that.

commit fcb2a5a1253c505913e66b08107c0a9f57b07bad
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 17:12:47 2008 -0700

    Use buffer object for vertex buffer (in new gen4_dynamic_state)
    
    This begins the process of separating the dynamic data from the
    static data, (still to move are the surface state and binding
    table objects). The new dynamic_state is stored in a buffer
    object, so this patch restores the buffer-object-for-vertex-buffer
    functionality originally in commit 1abf4d3a7a and later reverted
    in 5c9a62a29f.
    
    A notable difference is that this time we actually do use
    check_aperture_space to ensure things will fit, (assuming
    there's a non-empty implementation under that).

commit 7e68786cf746b6b984b184080578db1947b268ed
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Oct 30 13:40:23 2008 -0700

    Don't modify render standby if kernel mode setting is active
    
    Since we can't bang on registers directly in that case.

commit 87ea531c5dc5b39809395b277c330854aaaaf019
Author: Adam Jackson <ajax@redhat.com>
Date:   Fri Oct 24 14:47:27 2008 -0400

    Quirk: No LVDS on Dell Studio Hybrid

commit 4d5360b1f3666bca4ed44c7f1b9217b8157c74b9
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 16:17:39 2008 -0700

    Use consistent idiom for obtaining static_state
    
    This doesn't make any difference, but it's cleaner to have
    each function follow the same idiom for obtaining these pointers.

commit 36fc53d068673497e77796ba69e010d08c359447
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 15:45:51 2008 -0700

    Rename state_base_offset to static_state_offset in gen4_static_state_init
    
    More cleanup here, and again no functional change.

commit 8fda7df0071046d057eeaf74328668b227af52a9
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 15:28:24 2008 -0700

    Rename gen4_state_init to gen4_static_state_init
    
    This follows naturally from the structure rename.
    
    Also we make things less muddled by having this function
    actually accept a pointer to a gen4_static_state_t rather
    than a gen4_state_t, (and then fetching the desired pointer
    out from that).
    
    Again, no intended change in functionality here.

commit acba4238116f2ead7be88d49c4c56c7cd6d7f3b8
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 15:12:57 2008 -0700

    Rename gen4_state_t to gen4_static_state_t
    
    It doesn't contain only static data yet, but it will soon, so
    this renaming prepares for that. Also, this helps make things
    more clear between gen4_render_state_t and gen4_state_t which
    were muddled before, (particularly because the corresponding
    identifiers were render_state and card_state). The card_state
    identifier is now known as static_state which should be less
    confusing.
    
    This change is strictly search-and-replace with no functional
    changes.

commit c6550fa53d92c21dc677b86ebcd528a4ac640764
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 22 14:51:42 2008 -0700

    Ignore intel_gtt binary
    
    We simply forgot to add this to .gitignore when it was created.

commit ee3df629eaa388f09bec33ad04d443359d63ea7f
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Oct 20 18:46:49 2008 -0700

    Default kernel mode setting to off, add configure flag to enable
    
    Should help avoid unpleasantness.

commit 55cb65c6fdcf932d09e97abfa5374ee574676798
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Oct 19 21:22:37 2008 -0700

    Enable Option "Legacy3D" for 965 as well, and clarify both the docs and code.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>
    Acked-by: Keith Packard <keithp@keithp.com>

commit 28bb056f8cd326770590157412835318863b4134
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Oct 18 19:37:09 2008 -0700

    Use pipes, not planes for sarea geometry data
    
    Vblank in the kernel is far simpler if it deals with pipes instead of
    planes, so we're changing both user and kernel side. This is the user mode
    side. This fixes both i830_crtc_dpms and i830PipeSetBase, the two functions
    which copy geometry from the crtc to the sarea.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 546e2aca5b8b5d9f486d119ea2872ccd2b056054
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Oct 14 14:38:05 2008 -0700

    Reduce incidence of MI_FLUSH usage.
    
    This tracks whether the last command in each batch is an MI_FLUSH command
    and avoids appending another MI_FLUSH in the non-GEM cases.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 9b91cdf7ac88982880c887ffb0811c92157a7945
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Oct 19 14:24:46 2008 -0700

    No need to check for drmCommandWriteRead; we link against libdrm
    
    My checks for DRM enabled were a bit too extensive; drmCommandWriteRead is
    part of libdrm which the driver is always linked against. Only the symbols
    in the DRI module need to be checked here.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit c25437a69490b09acff335a81a38aa540f0822f5
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Oct 19 13:39:04 2008 -0700

    Remove accidental 'return;' left at the top of I830DRIInitBuffers
    
    I was testing the behaviour of the XAA-based DRI buffer drawing code for
    tiled buffers and accidentally left I830DRIInitBuffers disabled.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ae224be27bb4432f25dae851debea6966bf31261
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Oct 14 14:35:36 2008 -0700

    Check for DRI module before initializing GEM mm
    
    GEM requires the DRI extension module currently, so make sure that is loaded
    (by checking for the DRIQueryVersion symbol) before trying to call it. This
    allows the server to start with the DRI extension disabled.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 7ddea0447c8972104d43cd7966f5ce89b4cca20c
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Oct 17 00:07:09 2008 -0700

    Handle differently tiled front/back/depth/third in DRI window management
    
    When moving or clearing the extra buffer contents associated with DRI
    windows, the XAA code needs to see which buffer is being manipulated in the
    Setup functions to program the tiling values correctly. Calling
    I830SelectBuffer and not then calling I830Setup... would result in mis-tiled
    rendering.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit c946383afc644ae7740e3c3146424fdd86c05285
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Oct 17 00:07:08 2008 -0700

    XAA tiling support was mis-computing adjusted pitch (>>4 instead of >>2)
    
    This may well explain why XAA never worked well on tiled front buffers;
    tiled buffers require a different pitch programming on 965 than non-tiled
    buffers, in dwords rather than bytes.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Eric Anholt <eric@anholt.net>

commit 871728a0cbba12579c830e67020cc0c69c1611bb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Oct 16 10:35:17 2008 +0800

    Don't handle irq in GEM mode

commit 2419bce9efbff63529074e64af5ec5c2e62e368b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Oct 16 10:28:16 2008 +0800

    Make GTT dumper work on other 9XX chips

commit 986c8df79e83c369655ad786a6bf6342b53c535d
Author: Adam Jackson <ajax@nwnk.net>
Date:   Thu Oct 16 10:24:04 2008 +0800

    Fix Mac mini crash in DDC mode probe
    
    SDVO on Mac mini trys to get EDID from CRT port, which
    failed with recent DVI-I change.

commit 6707371176147340fabc9ab6f1e3d6d5ac980662
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 15 08:12:11 2008 -0700

    Remove gratuitous flushing in EXA after solid operations.
    
    This snuck in with the UXA rename commit.

commit 3dd7f0f9423bb891bc99cd3b77dc3d57e057a7ef
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Oct 14 23:57:10 2008 -0400

    Update to DRI2 changes.
    
    Implement DRI2CopyRegion and provide drm device filename to DRI2 module.

commit 282f51c3f0e5bc2cedd2f60f458ca2662290d471
Merge: 8a54e3b 4dd0068
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Oct 14 23:13:40 2008 -0400

    Merge commit 'origin/master' into HEAD

commit 4dd00681dd0f9fce8dfd4592b46418edbbd2eeb4
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 14 11:33:33 2008 -0700

    Fix broken stolen memory counting on G4X.
    
    On the GM45 we were assuming too little stolen memory (mostly harmless,
    except when it wasn't, until the AGP fix), and on the G45 we were assuming too
    much stolen memory, which was quite harmful when we touched the page that
    didn't get mapped.
    
    Future stolen memory accounting should use src/reg_dumper/intel_gtt before and
    after enabling AGP on the chipset to confirm that only the GTT entries not
    mapped to stolen are replaced, and that all of the unmapped GTT entries are
    replaced with the constant scratch page.

commit e7e49bed7e254256f8cc0d4afcdfadc6dadf19e6
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 14 10:38:05 2008 -0700

    Add a GTT dumper for G4x debugging.

commit 1c6ea4ab4772453da915306045add8d147d567f2
Author: Julien Cristau <jcristau@debian.org>
Date:   Sun Oct 12 15:10:22 2008 +0200

    Typo fix
    
    Reported by Tomas Carnecky on IRC

commit 6cb4150160bb1e1365773561fb53294ad9248a0e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sun Oct 12 08:07:44 2008 +0800

    Bug #17892: Fix possible crash in CRT probe
    
    Introduced in patch for DVI-I CRT probe, if no EDID
    CRT monitor is connected, origin code destroys default
    DDC bus which causes crash in later get_modes call.
    Change it to setup and destroy DDC bus as needed in
    get_modes, so we always reprobe and get current state.

commit 140451abb41fbd68d5aac4736c1cf1ec2805dd9e
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Oct 9 18:18:34 2008 -0700

    For non-DRM, add NOOPs after BATCH_BUFFER_START to verify completion
    
    In non-DRM mode, the driver waits for the hardware by checking the ring
    pointers; when the ring is empty, it assumes the hardware is idle. However,
    the hardware updates the ring pointers before executing a command, so if the
    MI_BATCH_BUFFER_START is the last command in the ring, the driver will think
    the hardware is idle while it may still be processing the contents of the
    batch buffer. Placing NOOPs after the BATCH_BUFFER_START allows the driver
    to know that the hardware has completed the batch buffer.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit d09d938bf26ea0c44352ff6e7a57ba43f4047fdb
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Oct 9 18:17:13 2008 -0700

    i830 nondrm batch buffer insertion was missing ADVANCE_LP_RING() call
    
    The ring commands to insert a batch buffer to the ring in i830 form were not
    terminated by a call to ADVANCE_LP_RING(). This surely would have caused
    chaos.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit d24010b7b3f2419beb40dc5ae1e8aeb3e04b5a93
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Oct 9 14:29:04 2008 -0700

    Disable frame buffer compression by default for GM965.
    
    We haven't found a way to make FBC work reliably with GM965 yet,
    (it often fails to notice CPU writes). This appears to be a
    specific problem with this device, (as we haven't gotten similar
    bug reports for subsequent devices such as GM45). So FBC is
    now disabled by default for GM965 but can still be enabled with
    the FrameBufferCompression option for experimenting/debugging.
    
    This resolves bug #16257:
    
    	[GM965 EXA] Frame-buffer compression broken for CPU writes (XPutImage)
    	https://bugs.freedesktop.org/show_bug.cgi?id=16257

commit 4128b01ec84ffa0f03c335c36738f383376d9381
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Oct 9 09:19:41 2008 +0800

    Remove Lenovo T61 TV quirk
    
    BIOS already says no integrated TV, and this quirk blocks TV
    on R61i which has the same subdevice id as T61.

commit 74571363539426abeb0a1af11f3bb545d91ed6c2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 8 15:36:10 2008 +0800

    Put forware VBIOS data parsing
    
    i830_bios_init() is called too late after output init, which
    makes bios data mostly useless, and caused all TV init fail as
    tv_present flag is not set.

commit 111dd151dedf535464d638461f9485ec2939780e
Author: Lukas Hejtmanek <xhejtman@ics.muni.cz>
Date:   Tue Oct 7 15:07:08 2008 +0200

    Fix driver build against server master.
    
    Broken by 3a4151b69daa478ac6edf042d604ee41e8429c0d

commit 3a4151b69daa478ac6edf042d604ee41e8429c0d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 6 17:00:08 2008 -0700

    Fix driver build against server 1.4.2.
    
    This disables UXA and DRM modesetting pre-1.5, due to privates handling
    issues.

commit 3621183cf4acef23414e8d69c34b1e587f52ec67
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 6 16:59:16 2008 -0700

    Fix bios_reader build against old servers.
    
    The server's pci_device structure ends up conflicting with libpciaccess's.
    Just don't include the server structure for this non-server tool.

commit 080d36648f92d3b9a559e5458687fa82afab411f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 1 16:13:09 2008 -0700

    Add support for RepeatPad and RepeatReflect to 915 and 830-class Render accel.

commit 5e04b5ad1b618655e201cbf1f5b2585aa6be0c17
Merge: 979bb10 260cbcf
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Oct 6 16:08:12 2008 -0700

    Merge branch 'master' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 979bb109c6d76fe18b9e29f55afb2548f890bbfe
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Oct 6 16:05:46 2008 -0700

    Document more VBIOS functionality
    
    Document a few more VBT structures and comment on VBIOS communication a
    bit.  There should be enough there now for a sufficiently motivated
    developer to start implementing support for hotkeys and other features
    on pre-IGD OpRegion machines.

commit 260cbcfe61868175ba3e649ce07d43f57601f9be
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Oct 6 13:17:59 2008 -0700

    Document and use 'legacy' border color mode
    
    It's very convenient that the hardware supports this non-default
    mode since it's exactly what is specified by the Render extension.
    This provides a more efficient means of fixing bug #16820:
    
            [EXA] Composition result in black for areas outside of source-surface bo
            https://bugs.freedesktop.org/show_bug.cgi?id=16820
    
    without the software fallback we had in the earlier fix,
    (commit 76c9ece36e6400fd10f364ee330faea470e2da64 ).

commit 98ca9e2af1b0a67ed91e10cf661af70dfba44d43
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Oct 6 13:16:37 2008 -0700

    Rename default_color to border_color
    
    This is consistent with the documentation, (and just plain makes
    more sense).

commit 175b30e3828266a89021c2439119545099d72715
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Oct 6 12:48:07 2008 -0700

    Revert "Fallback to software for RepeatNone with transformed RGB-only pictures."
    
    This reverts commit 76c9ece36e6400fd10f364ee330faea470e2da64.
    
    We've learned a new technique that should let us avoid this fallback
    to software. See following commit.

commit 21cce1998a10db520c390eb5061814867564c583
Author: Shuang He <shuang.he@intel.com>
Date:   Mon Oct 6 09:48:21 2008 +0800

    Fix a typo in G965 texture video code

commit 76c9ece36e6400fd10f364ee330faea470e2da64
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Oct 2 20:40:14 2008 -0700

    Fallback to software for RepeatNone with transformed RGB-only pictures.
    
    We wish it wouldn't, but the hardware ignores the alpha in the
    BorderColor we set when the source picture format has no alpha
    in it, (and it uses alpha of 1.0 where we want 0.0). For now,
    fallback for these cases. This gives a correct result, but
    obviously is not as fast as we would like.
    
    This fixes bug #16820:
    
    	[EXA] Composition result in black for areas outside of source-surface bounds
    	https://bugs.freedesktop.org/show_bug.cgi?id=16820

commit f1dbc266ccfe26c6b9a272e40a5bbe9afaa4f2e0
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 2 14:45:12 2008 -0700

    Work around libpciaccess reporting a 0 rom size by guessing.
    
    I required the following patch on top of this to work around libpciaccess
    brokenness.  libpciaccess reports 0 rom size if there's no rom resource,
    even if the rom file exists in sysfs.

commit 8304b405e0dc2f31fd2d2fd82e150ba502ab74e2
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Sep 29 17:37:28 2008 -0700

    Eliminate INT10 call to get BIOS contents
    
    libpciaccess (and the old X server PCI code as well) provides a function to
    get the ROM contents. Code to use that was already present in the driver and
    used if the INT10 function failed. Skip the INT10 and just use libpciaccess
    as that eliminates several module loads and scary use of vm86.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit ab2b70f831314f81a581bfb1e48d059a3a2b0b06
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 1 16:05:16 2008 -0700

    Prefer repeatType field over using both repeat and repeatType.
    
    Eric informed me that the repeat field exists only for backwards
    compatibility with old drivers that weren't prepared for values
    other than 0 or 1 here. Since we are, we can just ignore that
    field and examine only repeatType. So the code's a (tiny) bit
    simpler this way.

commit 128223ee9b7880e640056475462eca9a88415492
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 1 15:29:04 2008 -0700

    Add support for RepeatPad and RepeatReflect.
    
    It's quite simple to support these modes---we simply need to
    turn on the support for them in the hardware.
    
    These changes have been verified with the extend-pad and
    extend-reflect tests in cairo's test suite. However, this
    currently required using a custom-modified version of cairo.
    The issue is that released versions of cairo, (and even
    cairo master so far), don't pass RepeatPad and RepeatReflect
    to Render, (due to various bugs and workarounds in cairo
    and pixman). I do plan to fix those issues in cairo, so that
    in a future release of cairo, (1.8.2 perhaps?), the cairo
    test suite will usefully test these new repeat modes in our
    driver.

commit b7279f1be1b913c1c6ee8ebfb95c97800217a821
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Oct 1 15:26:39 2008 -0700

    Examine picture repeatType as well as repeat field.
    
    The existing switch statement was switching on the Boolean
    repeat field rather than the correct repeatType field. This
    had not caused any problem before as only two possible repeat
    values were supported (RepeatNone = 0 and RepeatNormal = 1)
    so they were always the same as the repeat field.
    
    Soon, however, we'll be supporting more repeat types, so we'll
    need to switch on the correct value.

commit ffcbbb071f1cde90fe0dc4887a05dd66c0e66985
Merge: 1eb46d0 bf8a3ff
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 16:59:35 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch

commit bf8a3ffeaa4df9ecbad7abff9a44d714de2fa104
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 16:59:02 2008 -0700

    Revert "Use -Werror by default"
    
    This reverts commit f315e9d1ad92562195ce42b956d4be6b31e8a13e.  The world
    isn't ready for a warning free build.

commit 1eb46d055b147941fa529ac582c336a114f47892
Merge: 8408995 497b742
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 12:54:27 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch

commit 497b7420c4a76df553ed53322a390a1c754ce30c
Author: Olivier Fourdan <fourdan@xfce.org>
Date:   Tue Sep 30 12:53:11 2008 -0700

    Fix ordering of VGA vs. plane disable
    
    From the Intel 965 Programmer’s Reference Manual, volume 3,
    chapter 2.2.2 "Mode Switch Programming Sequence".
    
    The disable sequence should be:
    
     - Disable planes (VGA or hires)
     - Disable pipe
     - Disable VGA display in 0x71400 bit 31
    
    This patch implements that order plus waits for a vblank at the end.
    
    Fixes bug #17756.

commit a4568740ee296bc392843fd324d2a047e7862187
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 12:48:32 2008 -0700

    Be more verbose about panel data in VBIOS dumper
    
    Dump more panel data, including number of expected entries.  Had to
    refactor things a bit, but now each function should get size information
    so further checking can be added more easily.

commit fa2586a40f20e73ec7420466638e8f595e0da987
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 12:46:20 2008 -0700

    Use VBT LFP info pointers by default
    
    On some machines it appears that the LFP info pointers give us more
    accurate panel info than if we index into the LFP data table using the
    panel type index.  Early reports indicate that using the pointers
    doesn't cause regressions, so switch to them by default to help 8xx
    machines.
    
    Fixes bug 17310 (and hopefully 17658 too).

commit f315e9d1ad92562195ce42b956d4be6b31e8a13e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 12:07:52 2008 -0700

    Use -Werror by default

commit f082e877d54dbafa437fd05e9c07e870cd513be9
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 30 12:06:46 2008 -0700

    Work around gcc uninitialized variable warnings
    
    GCC isn't smart enough to analyze the control flow and figure out that
    these are false positives, but initializing them shouldn't hurt, so work
    around it.

commit 836d24f2cc3836fbd1695cf1f88c2af975b4862c
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Sep 29 19:02:51 2008 -0700

    Use uintptr_t instead of uint64_t to hold pointer value

commit baec75a56d91546443a2e04812face4997bc764b
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Sun Sep 28 11:18:40 2008 +0800

      [965-xvmc] 965q indirect media data workaround

commit 11d304e99c0e11c28901ec28115d9c8b81a2b9cc
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sun Sep 28 10:08:26 2008 +0800

    Bug #16631: add option for SDVO force detect
    
    Some ADD2 card doesn't get SDVO detect status setup right,
    which disabled outputs on those cards. This adds a new
    option "ForceSDVODetect" to probe all SDVO ports anyway.

commit 1cc15ba454fdf54a7dea9da066e0a023a4742fab
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Sep 26 10:01:52 2008 +0800

    Render register clock gating disable fix on 4 series chipset

commit d6b2696f9ac14a81598e0147698209ad428fd45d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Sep 26 09:53:03 2008 +0800

    Do force CRT detect sequence twice on 4 series chipset

commit d8a007b056e3d6c3e132ecac06368b21d2ac4123
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Sep 26 09:44:59 2008 +0800

    Bug #16515: Fix VT switch with DVI on G45
    
    On DVI, centered VGA mode is used instead of native mode VGA, and
    PLL on pipe is used instead of VGA PLL setting. So make sure PLL
    settled down in restore time.

commit a428892b76dba4c55e2ae28933d30e98d9fd646d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Sep 23 12:36:11 2008 -0700

    Update supported hardware list

commit 3c2f7d84785954eb91341f85abb175f299b2797d
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Sep 23 17:15:42 2008 +0800

    	[965-xvmc] IGD support

commit 08ab23bb87563517d5653bddf82763b5ef641bed
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Sep 23 14:57:18 2008 +0800

      [965-xvmc] optimize, pack some payload

commit 8408995ffbf705aa0bc09ab72c58c2e31a4b70c3
Merge: d18b86a afa630b
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 18:38:54 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch

commit afa630b448e5993850433c9f0b129758ec4d37b5
Author: Bryce Harrington <bryce@canonical.com>
Date:   Mon Sep 22 18:38:35 2008 -0700

    Add TV out quirk for HP Compaq nx6110
    
    Adds a TV out quirk for HP Compaq nx6110.  Fixes bz #17683.

commit 204a6281aa59e29027793ba5c84a5d9af7dc9e90
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 18:38:03 2008 -0700

    Revert "Add no TV out quirk for HP Compaq nx6110"
    
    This reverts commit 6a46022df57d09109fc119fedce99c156715a4d4.  It should have
    been attributed to Bryce.

commit d18b86aa7fc9270e24ed9ea861ebbbbb54558fee
Merge: 9a7da65 6a46022
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 18:03:39 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch

commit 6a46022df57d09109fc119fedce99c156715a4d4
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 13:26:58 2008 -0700

    Add no TV out quirk for HP Compaq nx6110
    
    Hopefully we can fix the VBT parsing code so we don't need this, but for the
    time being it seems necessary.  Fixes bz #17683.

commit 10909d9b665864bda2b1654de009d556cd068726
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 13:11:55 2008 -0700

    Add Cappuccino SlimPRO SP625F to no LVDS quirks list
    
    Looks like this platform might contain VBTs that indicate an LFP is present
    even though it isn't.  Intended to fix bz #11368.

commit 9a7da65e624060a37eef989963a9c79f13df30d3
Merge: 043b6e7 2f93cfb
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Sep 22 09:59:52 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch

commit 2f93cfbc7e96acc32efb5e1ca49b817a81cba6e3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Sep 19 15:20:55 2008 +0800

    Fix output detection for DVI-I
    
    For CRT this trys to probe all possible port for EDID and
    detects got confirmed by EDID's d/a type bit.
    For HDMI/DVI, also using EDID d/a type bit to ensure it should
    handle the connect or not.

commit 1fbe4d602816c9dfc5fba917b9fdc257d8d025b0
Author: David Schleef <ds@schleef.org>
Date:   Thu Sep 18 15:37:00 2008 +0800

    Bug #17277: fix upscaling limit
    
    Oh duh (i830_video.c):
    
            /* Clamp dst width & height to 7x of src (overlay limit) */
            if(drw_w > (src_w * 7))
                drw_w = src_w * 7;
    
    	if(drw_h > (src_h * 7))
                drw_h = src_h * 7;
    
    The condition I see in the documentation appears to be src_h/drw_h < 8, that
    is, src_h < 8*drw_h.  It appears this was "fixed" incorrectly in e784e152.
    It seems difficult to believe that this limitation would exist at all for the
    texture unit.

commit bc36608e321e01a2be792688b4b734bb7c0667f7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Sep 18 10:42:33 2008 +0800

    Check display stride limit when allocate front buffer

commit 043b6e71b83eb05339a6f8c4814e6941f8b9695a
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Sep 16 13:21:43 2008 -0700

    Move bufmgr init earlier so it's available at I830DRIDoMappings time.
    
    Fixes a crash with non-GEM mode.  Bug #17540.
    (cherry picked from commit 62b75df84c893bf28e20014cf88ce45064611dc9)

commit 0a2d17f7c2ea9b695df1855aab4ccc519546d8e5
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Sep 16 11:49:39 2008 -0700

    Put back check for pI830->hw_status in setting hws in non-GEM mode.
    
    Fixes crashes on non-GEM systems with physical hardware status page.
    
    Bug #17540
    (cherry picked from commit 188d58dac9a87b56dbc34ec219cd196928bbcf64)

commit 62b75df84c893bf28e20014cf88ce45064611dc9
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Sep 16 13:21:43 2008 -0700

    Move bufmgr init earlier so it's available at I830DRIDoMappings time.
    
    Fixes a crash with non-GEM mode.  Bug #17540.

commit 188d58dac9a87b56dbc34ec219cd196928bbcf64
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Tue Sep 16 11:49:39 2008 -0700

    Put back check for pI830->hw_status in setting hws in non-GEM mode.
    
    Fixes crashes on non-GEM systems with physical hardware status page.
    
    Bug #17540

commit e2743a409a02978ca8e953dbbeeb96f61bbd5ce6
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Sep 12 14:22:48 2008 -0700

    Only BO map render state if kernel mode setting is active
    
    We'll probably end up doing this differently, but avoid this path for now.

commit 95b3e3a65a60aa264fbbfd141df980b534005264
Merge: 94a86fa ec17c88
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Sep 12 13:42:06 2008 -0700

    Merge branch 'master' into xf86-video-intel-2.5-branch
    
    Conflicts:
    
    	configure.ac - resolved version number conflict

commit 8a54e3be5c5057fe8e3c52c03401fdada7978c45
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Sep 12 12:47:13 2008 -0700

    Fix mis-merge of DRI2 changes related to pI830->directRenderingType
    
    The old code had a directRendering boolean, the new one has an enum. A bunch
    of the merges failed to remove the '!' in front of the old name, breaking a
    bunch of 'we don't have DRI' tests.

commit d8d95d8c71f2cd4bab277f44132ece7963714a5b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 11 16:11:46 2008 -0700

    Fix build failures that should have been in the previous merge commit.

commit ec17c88a0ed7c9cf4ad68aa52a7a891946a1c0f4
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Sep 11 16:14:47 2008 +0800

    Add support for G41 chipset
    
    G41 is another 4 series chipset like G45/43.

commit f9c625e1e5ddfff06b38fdd4e596fd8eae5934d5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Sep 11 15:35:27 2008 +0800

    Disable render standby
    
    Render standby is known to cause possible hang issue on some
    mobile chips, so always disable it.

commit 7e8eb6e20b6b1a2a3c1ef28f694fa23c68a15c48
Merge: fba9b5a 58a3817
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 10 14:10:26 2008 -0700

    Merge branch 'master' into dri2
    
    Conflicts:
    
    	src/i830_batchbuffer.c
    	src/i830_display.c

commit 58a3817305ef1455a11be6ead8a8521dfc5875c7
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Sep 9 11:02:49 2008 -0700

    Track move of exec to bufmgr, and restoration of emit/wait funcs for non-drm.

commit f367334c6392a717f6cd2f4ed02200be1c6d356a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Sep 9 11:01:33 2008 -0700

    Track the move of irq emit/wait to fake bufmgr.

commit 0b4f7b630312b148ce4e172cb7cd9f673751b2a3
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Sep 9 10:57:08 2008 -0700

    Track move of bufmgr functions to libdrm_intel.

commit 0f804bfa1e1e972e9b4e3b7c8db61e9877c50f50
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Sep 9 19:17:05 2008 -0700

    Bug #17446: Don't try to manage IRQs in GEM mode.
    
    The kernel told us that it was already doing so, resulting in failure.

commit da63b5adec8555cc7b3e71f33933f4c9dd6f714e
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Aug 31 14:27:29 2008 -0700

    Add some MCHBAR registers for debugging tile swizzling issues.

commit c7aaf0118baa34e583df5f1c29c9dab9a6af6eb7
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Sep 9 18:13:56 2008 +1000

    mode: fix missing comma

commit b9ef0ed7d7b96eca6394cd0d367369ec511d1bcd
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Fri Sep 5 05:02:08 2008 +0300

    i830: Fix timer leak
    
    TimerCancel just cancels the timer: it still leaves the TimerRec intact and
    unfreed.

commit fba9b5aff450d874ef98cafd3ecc0fd85f9597b5
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 3 16:49:07 2008 +0100

    DRI2: Move pixmap pitch alignment for use with depth to pixmap create.
    
    The previous location for pitch fixup would have only worked when depth was
    used with the backbuffer, and no page flipping or other adventures occurred.

commit 71ec627c3a65cfc7bca7353af43c60b18e73230d
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 3 16:37:25 2008 +0100

    DRI2: Emit the MI_FLUSH before flushing batch in swapbuffers.
    
    Should fix issues with swapbuffers flushing to front buffer on 965.

commit daaefd173b4c98d0ebabd43352bfa3a030a62e4b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 3 16:26:27 2008 +0100

    UXA: Re-enable non-965 render.

commit 32bb5fc7db14911d0438aea1504e1551b2c9fc25
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 3 16:19:03 2008 +0100

    Don't set up sarea or drm mappings in DRI2 mode.

commit 4a5e31138115f435be7f8f5999b1b2329a18d669
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Sep 3 16:18:23 2008 +0100

    Fix broken test for DRI1 in DRI2 conversion.

commit fca7a4e9a5c73e1c129e94eeccf8fc795f729931
Author: Stefan Dirsch <sndirsch@suse.de>
Date:   Wed Sep 3 15:32:11 2008 +0200

    Pipe A force quirk for Toshiba Satellite A30.

commit 57ad9cc689724a2f3583eda862250eab0a6798d5
Author: Fabio <fabio.ped@libero.it>
Date:   Mon Sep 1 13:33:50 2008 +0800

    Man page patch to clarify meaning of VideoRam option with i810/i815

commit fd6a9ca5b59a868260eb91272091ea6169091737
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Fri Aug 8 15:36:35 2008 -0400

    Add DRI2 support.

commit a1c802e4a0324386cf7370594a46354c89e3b646
Merge: 3733a1b 808b72f
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Aug 29 09:23:35 2008 -0700

    Merge branch 'master' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 3733a1b54c95aa378f32577f9e996946e8e8e48c
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Aug 29 09:12:05 2008 -0700

    Fix build when using kernel DRM headers
    
    Unfortunate mismatch between kernel and DRM master headers.
    Kernel:
    typedef struct _drm_i915_batchbuffer { ... } drm_i915_batchbuffer_t;
    DRM master:
    typedef struct drm_i915_batchbuffer { ... } drm_i915_batchbuffer_t;
    
    so use the typedef rather than the morphing structure name.

commit bd7ee7fcf51138d21da92a3d8cbaff49871d7188
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Fri Aug 29 11:57:46 2008 +0800

      [965-xvmc] There is some issue with uv half pixel, remove it till fix

commit 973a5fb25652a97e28af03295d430a79557be756
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Fri Aug 29 10:59:17 2008 +0800

       [965-xvmc] some shader optimize

commit e7379d1c48a522f137cf1a06a334748c88471946
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Aug 28 09:49:57 2008 +0800

     [965-xvmc] half-pixel bug fix

commit be49ae6bd683ee9eb778f7ea937aaee4d72c51f0
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Aug 27 11:29:15 2008 +0800

     [965-xvmc] add missing g4a file

commit e813b139b7c353a0930c3e00408700619d3949e4
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Aug 27 11:11:41 2008 +0800

      [965-xvmc] support field prediction and dct type, optimize in GPU

commit 808b72f81454061c815321e51a9b9f925c4bf786
Author: Eamon Walsh <ewalsh@tycho.nsa.gov>
Date:   Tue Aug 26 22:24:36 2008 -0400

    Change uxa private keys to integer variables.
    
    Prepares for a devPrivates system that will store an index.

commit 62ce9e8f9c8cc2014645d58f4249c496aebc36e8
Author: Eamon Walsh <ewalsh@tycho.nsa.gov>
Date:   Tue Aug 26 22:23:06 2008 -0400

    Remove unused exa_pixmap_key.

commit 087ade8e66cf7a34b8a96e1efe438099376cd896
Author: Robert Noland <rnoland@2hip.net>
Date:   Tue Aug 26 16:35:07 2008 -0400

    Fix typo in last commit

commit 6404ac178bf2c32a715a66e7fd6ab0184a05af36
Author: Robert Noland <rnoland@2hip.net>
Date:   Tue Aug 26 15:09:47 2008 -0400

    Check for drm before calling modeset ioctl.

commit c889198ab54336248a03050ad410254912d79bb7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 26 10:12:21 2008 +0800

    Fix X exit crash in NoAccel
    
    NoAccel should still be needed for performance evaluation,
    so don't crash me when exit.

commit 0929a191ae36473acb0244a818098e4acf26d675
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 26 10:01:23 2008 +0800

    Destroy bufmgr after allocation finish
    
    Fixed X exit crash for me, allocation reset will
    unreference bo which still requires bufmgr to be live.

commit 94a86fa51a931f0059ea17728f857ec92cec5b16
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 25 16:59:03 2008 -0700

    Fix UXA build for distcheck
    
    Was missing proper path info in CFLAGS.

commit 1c224f72d5f8fa8b6c4d9a6e06698f2462bb43b6
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 25 16:59:03 2008 -0700

    Fix UXA build for distcheck
    
    Was missing proper path info in CFLAGS.

commit 09a235af0f216052d3101b153c18be1fa75abf15
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 25 16:38:17 2008 -0700

    Update version to 2.4.97 for first 2.5 test release

commit 8e3243b8e5549033aa2f901a3bdd882418f6a69b
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 25 16:37:34 2008 -0700

    Update version to post-2.5

commit 7a5b090abc39c380955489bad5e46d1278f38fee
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 21 09:40:57 2008 -0700

    Hide kernel mode setting EXA code behind XF86DRM_MODE
    
    Prevents compiler warnings in the non-kms case.

commit 4937b98981923c599786f5007ab0580ad08e1909
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 21 09:39:33 2008 -0700

    Fix compiler warnings in VBIOS utils

commit 08326827fdb8abecbff20c7b051537dbad433c40
Merge: 5af5041 0de8ca3
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 21 09:30:38 2008 -0700

    Merge branch 'modesetting-gem'

commit 5af504166f14f4401818f3b7c27ac2ccba7b9ff5
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 20 15:06:36 2008 -0700

    Don't disable planes in i830_update_dsparb
    
    We need to program DSPARB with only one plane enabled at most, and that's
    guaranteed to be the case when we're called during mode set, so just assert
    that case but otherwise leave the planes alone to avoid flicker on active
    displays during output detection for example.
    
    Fixes bug #17050.

commit 7b6f4d22211d71480caf6335a3eacaacff369371
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 20 14:40:29 2008 -0700

    Don't allocate a pipe for hotplug detection
    
    It shouldn't be needed...

commit ba4a4b7887d5c2da21cadfeeed601eaec8515550
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 20 14:39:34 2008 -0700

    Add more panel debugging info to register dump & vbios reader

commit 0de8ca36306c506356e82d500134b4eeb96a6080
Merge: f26bcb9 5eccb5e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 20 12:11:00 2008 -0700

    Merge branch 'master' into modesetting-gem
    
    Conflicts:
    
    	configure.ac

commit 5eccb5ec7ea78b5800f98decd4216d39b9ebe5ec
Author: Julien Cristau <jcristau@debian.org>
Date:   Wed Aug 20 15:33:59 2008 +0800

    Don't skip the checks for DRI headers with --enable-dri

commit 1baebabc3af9f21a5b8084788ecd88dc66ce78de
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 16:02:55 2008 -0700

    Add swf_dumper to .gitignore

commit f26bcb9cb879e2e9ee2b26c95438cf46286c0208
Merge: 67ab546 7a1cc48
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 15:53:18 2008 -0700

    Merge branch 'master' into modesetting-gem
    
    Conflicts:
    
    	src/i830_driver.c

commit 67ab5462527c5ed94ed073421b60e85a213ea267
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 15:46:52 2008 -0700

    Use GTT mapping for EXA PrepareAccess function
    
    Makes software fallbacks *much* faster.

commit 547cf774801bea2177d1224204f7de0dbf6baf3c
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 15:45:26 2008 -0700

    Don't allocate EXA offscreen space if kernel mode setting is active
    
    We'll use GEM alloc & free routines in that case.

commit 2ddd85f8aef5da1aebbfe9fab510858e7a41860d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 15:41:41 2008 -0700

    Bail out if kernel mode setting is active but DRI fails

commit 646bbdc4b6a7b887ee8f0e51fdff5d07c4586329
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 15:05:00 2008 -0700

    Add quirk for pre-915s with working PFIT regs
    
    The regs are undocumented, but on some machines they work fine, so add this
    quirk to indicate it.

commit 7a1cc48276f974d04e1c5ef7c92d98fe5ae9d4fa
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 19 10:44:04 2008 -0700

    Add VBIOS software flags dumper program
    
    Still need to actually print all the flags & test on various platforms, but at
    least the bits are documented now.

commit 385dc85881c56e218e7d17d7e1d022568aa29cfb
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Aug 19 16:27:12 2008 +0800

      Fix from He Shuang(shuang.he@intel.com),
      XvMCDestroyContext to check pointer valid

commit 3147fa775c7e2a933dc74af1372a3318e77d3218
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Aug 19 16:20:16 2008 +0800

      Fix from He Shuang(shuang.he@intel.com),
      XvMCDestroyContext to check pointer valid

commit 078a59dd48ed00a6512d155883956c18752da9ce
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 18 12:53:33 2008 -0700

    Remove unused VBIOS flag defines
    
    We just use the structure definitions now.

commit 7048141254b7c1948fe77b1742b463f8723610d8
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Mon Aug 18 12:51:31 2008 -0700

    Pack bdb_general_definitions block
    
    More correct & consistent with other definitions.

commit 0e6759bb6ad7293b6447bd20e3d7d8fdee46aba7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 19 07:30:01 2008 +0800

    Fix reverted LVDS bios capability dword definition
    
    Issue found by Peter Clifton.

commit 76b5a7ff5c943cfaa254d2fd94b6397c91d1f8e6
Author: Shaohua Li <shaohua.li@intel.com>
Date:   Mon Aug 18 11:13:20 2008 +0800

    [PATCH] avoid duplicate mode set in lvds
    
    xf86SetDesiredModes() already sets lvds to full mode. later when
    xf86CrtcScreenInit() initialized randr12, i830_lvds_set_property will
    recall xf86CrtcSetMode and set mode to full. This patch is to remove the
    duplication. In my test, this can save about 0.2 - 0.4s x startup time.

commit b8ee31cd80a945d1fbbfc45234ffe34a109b5717
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Sat Aug 16 12:18:01 2008 -0700

    Remove last TTM bits
    
    Makes it build again with drm#modesetting-gem.

commit 6eb3e0f2f4e43e436029fc82e458ac8de1f94745
Author: Adam Jackson <ajax@redhat.com>
Date:   Fri Aug 15 15:47:35 2008 -0400

    Don't touch pScrn->monitor->DDC directly.

commit ed7269e0a377b3135b06cacecc59119f06958feb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Aug 15 10:10:43 2008 +0800

    Always check and free driver private in LVDS destroy

commit f4cb9a135dca9279af8186a9b18bf62ef7351019
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Aug 15 10:02:44 2008 +0800

    Make skip_panel_detect clear for its meaning

commit 22918f62c89a4314fb5d01c58f22fee5b9a15a27
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 14 16:02:37 2008 -0700

    Fix pipe A force quirk
    
    Last commit introduced a logic buglet, we went from (foo & BLAH) -> (!foo &
    BLAH) rather than !(foo & BLAH), so fix it up to make my laptop work again.

commit c1687f9ca9ce7b52043272e877e070c810e6599f
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 14 15:48:02 2008 -0700

    Map/unmap render state only when bo is available
    
    Otherwise just use the GTT address.

commit 380c80712f78b3673b64ea07746a8e25e15fba8e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 14 15:39:57 2008 -0700

    Fixup AccelMethod kernel mode setting code
    
    Allow UXA or EXA in the kernel mode setting case, defaulting to EXA.

commit 4475dfb541c988ad19b177e60f31f333e2fb3355
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Thu Aug 14 15:38:07 2008 -0700

    Use pwrite for cursor updates
    
    Don't open code map/memcpy/unmap, let libdrm do that for us if necessary.

commit cb217d4bfd941d0fa9ceae3e483dd1ca1d768e86
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 13 16:55:39 2008 -0700

    Make EXA & UXA share bo getting function
    
    Needed for proper acceleration & batch buffer handling.

commit 1ab7239b73a5e298cadaf44e5605cf05855f08e9
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 18:16:37 2008 -0700

    Map gen4 render state buffer before initializing

commit 603f48e31b021c4dc0bbf7b5efbb2e68aeb421d5
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 18:04:08 2008 -0700

    Don't set tiling (yet) if kernel mode setting is active

commit f744aa8d4b22374e1de6dda4facb673c3c428d4d
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 18:02:21 2008 -0700

    Don't run old accel init code
    
    Had the wrong logic.  Throw in a couple of cleanups while we're there.

commit 2321c865f3da9fd321910236a92b32e0af1aa458
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 17:59:16 2008 -0700

    Don't wait for ring if kernel mode setting is active
    
    We won't have the ring mapped.

commit a1b334a4c8ae090744e802f8d41a36ea631d6c84
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 17:58:29 2008 -0700

    Update DRM based modesetting support
    
    Just a checkpoint, still needs a lot of work to properly handle resize, rotate
    & cursor handling.

commit 5d78cf7cf0d23f60e6d61a92cbc2065b440027d3
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Tue Aug 12 17:56:59 2008 -0700

    Add EXA pixmap management functions for kernel mode setting
    
    Mostly pulled over from the old kernel modesetting code; a few updates were
    necessary.

commit 9ec36e0c8bd8a4bd7c40569412fc1a21219b5af9
Author: Olivier Fourdan <ofourdan@redhat.com>
Date:   Mon Aug 11 12:07:32 2008 -0400

    Fix DPMS off in the presence of the pipe A quirk.
    
    Still turn off the VGA plane, and also handle the DRI path at the end.

commit 445c2e9ef8fc1d49bbb03e07bf36e0339be16a80
Author: Olivier Fourdan <ofourdan@redhat.com>
Date:   Mon Aug 11 11:30:51 2008 -0400

    Apply pipe A quirk to 845 as well.

commit 915c370964d8dbab48ff24ede2c5e78e7b39132d
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Aug 11 15:45:35 2008 +0800

    	[965-xvmc] some fixes for earlier 965 chips

commit 19ebdf1b24184c0a293a698d44c4e0571109d153
Author: root <root@cr-znh.(none)>
Date:   Mon Aug 11 15:31:13 2008 +0800

      [i965-xvmc] bypass copy when put image with xvmc

commit d592eabc806b752053ade3c18e9dd8e0f39b45a3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Aug 11 15:16:44 2008 +0800

    Fix possible spurious interrupts in hotplug detect on 4 series chip

commit d0018a96064ee0adfe87c2d50c341bf7d2e45eb0
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Aug 11 15:16:09 2008 +0800

    Disable display clock gating for 4 series chips

commit 173b909a71955997ed6366e70faebf63fe922a8e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Aug 8 18:11:13 2008 -0700

    Make it actually build the kernel stuff if possible
    
    Fixup the kernel stuff to have a slightly better chance of working.  Still need
    to fixup the EXA pixmap functions.

commit fe90c0522f65f60c4c431787c889b7fb639ab61b
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 8 16:35:25 2008 -0700

    Set lvds_ddc_mode before use to avoid a segfault on mac mini.

commit b1aef6f63c151dcb202fce869e4b80598b4b2052
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Fri Aug 8 11:54:18 2008 -0700

    Initial port of kernel modesetting from old intel-kernelmode branch
    
    Thanks airlied!

commit 91e7b93c12f612e41b04a2d6106ff29b53b22a43
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 7 11:02:19 2008 -0700

    intel_idle: Instead if #if 0, add an ignore flag for unreliable INSTDONE bits.
    
    This lets us produce a decent total value, and still show the unreliable bits
    in case they aren't on your platform.

commit f9504eff31eb3c9c6c6b33dced9875866ff8307e
Merge: f911347 5c9a62a
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 6 12:40:47 2008 -0700

    Merge branch 'drm-gem'

commit 5c9a62a29f62a9ecce37fae98cb01f8217eaba15
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Aug 6 12:39:03 2008 -0700

    Revert "Switch to using a buffer object for the vertex buffer"
    
    This reverts commit 1abf4d3a7a203ff5d6e5ceda29573e7fd69ddf8e.
    
    Conflicts:
    
    	src/i965_render.c - flushing was removed, keep it that way

commit f91134795b545c8baebf218975b261c76a0e5873
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Aug 6 16:19:29 2008 +0800

    Fix SDVO HDMI encoding detect (#16920)
    
    Check return value of get supported encode command and current
    encoding mode, which could be DVI or HDMI.

commit fc3e287e6b6db21b113aa40ec4d397802c067f8b
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 5 22:50:01 2008 -0700

    [uxa] Remove unused pixmap size limits.
    
    All size-related rendering limits should be managed by the driver in the
    pixmap_is_offscreen call. There's no need for uxa to even know these values.

commit 68f0872db6ec4d5dc3b524ee08ecad0aa125acd9
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 5 22:36:03 2008 -0700

    [uxa] Check xalloc returns and deal with failure
    
    Failing xalloc in a rendering function means just dropping the drawing on
    the floor (that's what we've always done).

commit 8f10bfb127bfe73d83d58f1f306fb9a4dfd825d6
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Aug 5 22:34:24 2008 -0700

    Use EXA by default instead of UXA until we have GTT mapping

commit b2d058d80ccd08d9e02ef866ee7a95b58686f6a3
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 23:43:13 2008 -0700

    Rename uxa using _ instead of caps

commit fc4d9c55a7fa8001786c1e4da10f005406c57ece
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 18:17:20 2008 -0700

    Change PrepareAccess to take access mode rather than index

commit c155bb3cb17a3bd3b2e90be52cd1fc90147c4e17
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 04:11:13 2008 -0700

    Add batch flush in i830_uxa_prepare_access

commit 66706718553cd272eab6f817b5a059df3e0a4347
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 04:10:21 2008 -0700

    Add throttling

commit 12df8f40d2fb41f5446db1b49beeb442da18bee2
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 01:43:44 2008 -0700

    Use dri_bo for all object allocations, including pixmaps under uxa

commit 4cc20b7f6e25f4be4598f8edbe0077117126b4ee
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Aug 4 01:42:48 2008 -0700

    Don't call sync on prepare_access -- just let the driver deal with it.
    
    Let the driver do whatever sync is necessary from the prepare_access hook
    rather than forcing a full sync.

commit b0b0998b5d52d105eb1e631f688aa8f1bd55ef39
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Jul 30 16:15:37 2008 -0700

    Make EXA functions work for UXA as well
    
    EXA and UXA have the same acceleration interface, but UXA doesn't provide
    pixmap stride information as it doesn't manage pixmaps. Move all of that
    into the driver structure so that the acceleration functions needn't
    reference the EXA structure.

commit 59774e9aca2d743e82d616bb644d20ff6d60d492
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Jul 29 22:57:09 2008 -0700

    Add UXA - the unified memory acceleration architecture.
    
    This eliminates the cost of EXA migration management while providing full
    pixmap allocation control to the driver. The goal is to make something
    useful for UMA drivers.

commit a21d4794b6812ce05d08f06dc47b26c4fb1c1fef
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Aug 5 13:37:38 2008 -0700

    Reorganize VBIOS code
    
    Make VBT parsing happen at driver init time rather than in each output init
    function, to save time and better separate VBIOS code into i830_bios.[ch].  The
    changes end up touching the output files due to field name changes, and allow
    us to reorder & simplify our LFP mode detection code.

commit c2f0df4dc97c87539b66525a277c7d1e2c421f61
Merge: 4f1f308 750bd0b
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Aug 5 13:03:46 2008 -0700

    Merge branch 'drm-gem' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel into drm-gem

commit 4f1f30854260e18b8b9c4103eebbad5dcf729ce6
Merge: e9e6b47 2aaa207
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Aug 5 13:02:47 2008 -0700

    Merge branch 'master' into drm-gem
    
    Conflicts:
    
    	src/i830_driver.c

commit 1a59cc6b9acf312de1755d67757bf7f1967342e4
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Aug 4 12:18:12 2008 +0200

    Fix up the HP Pavilion ze4944ea quirk
    
    The chip is 855GM, not GM45.

commit 27e9506fda86e90fd67de1715fa32d23aaa8a683
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Thu Jul 31 20:02:21 2008 -0700

    Man page typo fixes

commit da2eb83fb9a52291ea98f3285aee7bee2d55e0ca
Author: Jesse Barnes <jbarnes@eee.(none)>
Date:   Thu Jul 31 19:21:36 2008 -0700

    Update man page
    
    Add example dual head config, add info on bug reporting.

commit 2aaa207db2cea03ba05c439b5074807689f2c5be
Merge: 2049ba2 76eb8e6
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Thu Jul 31 13:10:19 2008 -0700

    Merge branch 'master' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel
    
    Conflicts:
    
    	src/i830_display.c

commit 2049ba211e7cdc383976c09f52c2b43acdd59481
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Thu Jul 31 13:07:20 2008 -0700

    Update DSPARB while planes are still off
    
    This avoids the flickering people reported in the 2.4.0 release.

commit 750bd0bde09adf956c17bbb49c5a6020f12e60a4
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Jul 29 15:22:39 2008 -0700

    Call DRM_I915_GEM_THROTTLE from I830BlockHandler
    
    This prevents the CPU from ridiculously outrunning the GPU.

commit a893f176dda0b64f7dadfda6bf0331240037851e
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 25 15:56:35 2008 -0700

    Add call to intel_bufmgr_gem_enable_reuse
    
    This instructs GEM to reuse buffer objects and improves the
    performance of my favorite 'x11perf -aa10text' from about
    169k to about 188k glyphs/sec.

commit b3c1a148679a4d943e556f996ef6b9004f549a41
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 25 15:18:28 2008 -0700

    Eliminate unnecessary flush from i965_composite
    
    This improves 'x11perf -aa10text' performance from ~144k to ~169k

commit 1abf4d3a7a203ff5d6e5ceda29573e7fd69ddf8e
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 25 14:48:45 2008 -0700

    Switch to using a buffer object for the vertex buffer

commit e5fab0b7681be06a5a3be4bbd769ba5c435e2128
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 25 13:44:29 2008 -0700

    Add OUT_RELOC macro and backing intel_batch_emit_reloc function

commit 76eb8e6f1f0c6962b23550564f4273f392567857
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jul 31 16:59:43 2008 +0800

    Fix SDVO reg definition
    
    Remove wrong set tv resolution command, adding HDMI regs in dump.

commit 77ed3d7600c1d92bf4a3ef4f54405cde8c232986
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jul 31 13:13:45 2008 +0800

    Don't program dsparb on new Intel chip
    
    On new chip, DSPARB is controlled by hardware only.

commit e9e6b4738573ffa3822ae68088bd53a645eedbce
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jul 30 14:15:57 2008 -0700

    intel-gem: Use new getparam to detect kernel GEM support.

commit 42fb06f3f14fbec070350cf48361be4a0be0af04
Author: Tomas Carnecky <tom@dbservice.com>
Date:   Sun Jun 15 14:27:16 2008 +0200

    Reorder visuals reported by the intel driver
    
    The root window visual can not be changed. Neither at runtime nor
    through the configuration file. The xserver simply selects the first one
    that matches the class (usually TrueColor). I need a root window visual
    with stencil buffer because my compiz plugin uses the it for some
    operations. This patch reorders the visuals that the 3D driver reports
    and puts the one with stencil (and depth) bits as first.

commit 1e90c82161789d1fd50b79db50edb7860b934639
Author: Julien Cristau <jcristau@debian.org>
Date:   Sun Jul 27 12:07:21 2008 +0200

    Link with -lm for sin/cos

commit d77d42e543ee82e801a8563a911826521c0ba557
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Jul 26 16:10:05 2008 -0700

    intel-gem: Give a better error message if the kernel rejects the tiling mode.

commit 6ac352f146bafe3b4bb5832340eb0ccb730565d2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jul 23 15:10:07 2008 +0800

    shut up gcc warning

commit 075cf7fce57da4e51acafb3bfd3d61ba1a8096d5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jul 23 15:07:48 2008 +0800

    Fix distcheck for clean doltcompile

commit 29d982c6bf873c6685bd0e395a8b0e5e3b1063e0
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jul 23 11:16:14 2008 +0800

    Fix HDMI output number
    
    Output 33 is confusing.

commit fd060ce89d86f6e8ff742d5b287abe8ecea32927
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 22 15:29:34 2008 +0800

    Bug #16801: fix X crash when NoAccel on 965

commit 577c4d1a0c753fb46d43be05a9781d2e204fac45
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 22 15:14:14 2008 +0800

    only check pipe underrun if vtSema is true.

commit 04bbed2248e3e8f86efd64225abf2db8eb552653
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 22 15:08:57 2008 +0800

    SSC is LVDS only
    
    Fix regression on my 855GM for VGA output.

commit 7defa4f1f0eba82f39e74f96d2ad7ed2481b537e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 22 10:51:01 2008 +0800

    Check underrun on enabled pipe

commit b7765b0837af4cc80f1257ba04495140ef5d536e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 22 09:51:54 2008 +0800

    Thinkpad R60e TV quirk via DMI info

commit 286ff63f83db8ea16514512385e6f8c6875871ef
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 17 17:06:28 2008 -0700

    Don't set up the HWS page in GEM mode now that the kernel manages it.

commit ed0fbd016b8fbcf01eddfd17fd25e745e7af2ba4
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Mon Jul 21 11:48:38 2008 -0700

    Add no LVDS quirk for Transtec Senyo 610 mini PC
    
    Fixes FDO #16757.

commit 62a037b0585d6ecb43daac9d4eb0927a4618a367
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 18 14:50:08 2008 -0700

    Fix distcheck.

commit 3cbfc6c76bcd2bc9194a944092f6ce0881ff9da2
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 18 14:56:18 2008 -0700

    Fix uninitialized-use warning in i830_debug.c ring dumping.

commit 1b1c4975768f63ed0f3933ec384d24c324a383b3
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 18 14:53:26 2008 -0700

    Get prototype for i830_bios_get_tv().

commit 978abf84e8cf3ba3e915774981fe03610e15efeb
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 18 14:50:42 2008 -0700

    Bump version number past the 2.4 stable branch.

commit f4ab1f6ad47b8f9a33d45b35c1cb2ba9610b96a6
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Jul 18 14:31:45 2008 -0700

    Add intel_statuspage to .gitignore

commit c0dce28892d7a31ebcca615f87ba8d4fa6872204
Merge: a6ad504 b8ca1c7
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jul 18 10:49:50 2008 -0700

    Merge commit 'origin/master' into drm-gem

commit b8ca1c747a679c931267363639fc0bc690cae2d6
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 17 14:41:51 2008 -0700

    Choose a split for DSPARB based on the configured modes for both planes.
    
    Previously, we were attempting to give both planes equal space in the FIFO
    to be fair.  However, larger modes require more fifo space, so split it based
    on the relative HDisplay of the modes.  This should resolve some fifo underrun
    issues with differently-sized displays, or single large ones.
    
    Bug #16169.

commit b37a2a8ca82279468e3806dcf77d5fa7bdd0e874
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Thu Jul 17 12:30:57 2008 -0700

    Don't disable pipe A on 855 chips
    
    It needs to stay enabled or we may see hangs when trying to re-enable it (say
    at VT switch time).
    
    Fixes FDO bug #15168.

commit a6ad50402cb879b08de95f94959bb1f59701c1ff
Merge: e9916b9 c4565a9
Author: Carl Worth <cworth@cworth.org>
Date:   Thu Jul 17 00:38:54 2008 -0700

    Merge branch 'master' into drm-gem
    
    Conflicts:
    
    	configure.ac
    	src/reg_dumper/Makefile.am

commit c4565a9811487402d899d0933cc63e27ffe1ff08
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jul 16 10:45:28 2008 +0800

    Only initialize integrated TV encoder for mobile chips

commit bca316863b79148b2f51a97d58b94e52ba3eae9f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 15 13:35:21 2008 +0800

    xvmc: use vector based structure
    
    This is more clear to read MV components.

commit 0c67219d0e6cfc858af2eb375c2f9473d0f6db60
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jul 15 13:29:33 2008 +0800

    move FBC register dump out of display registers
    
    This makes it easier to read.

commit a76ae7cab3001ce6639ae23fb0769c4e46b57e71
Author: lipeng <peng.li@linux.intel.com>
Date:   Tue Jul 15 10:26:33 2008 -0700

    Fix GPIO pin usage for DDC on second HDMI port.

commit 5054a86b1b362f3f63310afb9ef2d37c9f1cfca5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 14 13:43:31 2008 -0700

    Fix DSPARB setting on 845/865, which have only the AEND field and 96 entries.

commit 8ac00ca97995e36514ff593fec3c0f0d316ed138
Author: Julien Cristau <jcristau@debian.org>
Date:   Fri Jun 6 13:40:20 2008 +0200

    Link the driver with -lpciaccess and -ldrm if needed
    
    This makes sure the driver ends up with a DT_NEEDED reference to
    the libraries it's using.

commit d61182511b1520b04133d28480e1ffaacbaeb753
Author: Julien Cristau <jcristau@debian.org>
Date:   Sun Jul 6 12:00:52 2008 +0200

    Fix gen4asm rule to work with a build dir

commit 757c00927a6f5760135136450b8d02d0f999ac1c
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 7 15:58:27 2008 -0700

    Use up to 256 separate vertex buffers
    
    This allows us to only call i830WaitSync once every 128 calls to composite
    rather than on every call. However, we do need to also call MI_FLUSH to
    avoid the vertex cache getting in our way, (since our "separate" buffers
    are all allocated as one contiguous chunk).

commit 0c548cd040d0c5e1812470ccdf6de86b6a2926d7
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 7 14:01:15 2008 -0700

    Allow for multiple vertex buffers (though only use one for now)
    
    Using more than one (in the future) will allow for doing less frequent calls
    to i830WaitSync.

commit cc2249333cd462b4d99d110a12c454ca141b2be8
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jul 7 13:25:42 2008 -0700

    Move VERTEX_BUFFERS setup from prepare_composite to composite
    
    This is in preparation for having larger (or multiple) vertex buffers
    in the future.

commit e9916b9d496fd0b4df717892dda33f81a2e2990a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 11 18:59:05 2008 -0700

    Set tiling state for buffers allocated using GEM.

commit 3c0f2bcc9965155fecab606edae68874427d3423
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Thu Jul 10 12:57:25 2008 -0700

    Add VBIOS based TV connector detection
    
    Now that the VBIOS code supports it, we can use the general features block to
    detect whether a TV connector is present on a given platform.
    
    Reviewed by Nanhai Zou.

commit e00d9435609bcff1afb71aa6638a6b42a64f5178
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Thu Jul 10 12:55:12 2008 -0700

    Improve VBIOS feature detection, add SSC support
    
    Improve the VBIOS feature detection and use it to find whether the platform
    supports spread spectrum clocking.  Use the specified reference clock, but
    disable SSC if multiple heads are active, since it can cause problems in cloned
    configurations.
    
    Reviewed by Nanhai Zou.

commit 7332132a79e5b5c208d43e93dfe0c8b12eb1728d
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Mon Jul 7 10:48:56 2008 -0700

    Improve FBC size checking
    
    In hindsight, this is obvious, since nowhere do we tell the FBC unit how much
    memory it has available.  We need to make sure the compressed buffer is big
    enough to handle the uncompresed buffer, both in terms of vertical size and
    total framebuffer size, or the compressor could overwrite the memory
    immediately following the compressed buffer.

commit f2ec3fd8f2c63b1bc0745802dcf737eda4bb42b6
Author: Stefan Dirsch <sndirsch@suse.de>
Date:   Thu Jul 3 23:12:13 2008 +0200

    Add pipea force enable quirk for another 855GM machine.
    
    Fixes Novell Bug #406123, thanks Christoph.

commit a34a4e3f6420e2b06bbdaa124fe0ccb1bc6a0bd9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jul 3 01:03:14 2008 +0800

    Fix official name for GM45 chipset

commit 6506ac7aa008436158db4f4196802cab462f3446
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jul 2 11:12:54 2008 +0800

    Give asus and eeepc backlight method higher priority
    
    On #16418, Evgeniy Manachkin <sfstudio@mail.ru> reported that
    last asus and eeepc backlight patch is wrong, as acpi_video0 method
    will take priority and doesn't work.

commit 55678c64bc6e3ed613ea6db14c105c18a0cf28ce
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Jul 1 18:51:18 2008 +1000

    intel: fix drm check.
    
    The -mm check is broken now that 2.3.1 is out.. make it 2.4.0, to be fixed
    with GEM etc.

commit 0597d94001afe0a9a34104285ce4dffc75b68071
Author: Roland Test-tools Bär <roland@verifysoft.de>
Date:   Mon Jun 30 10:32:42 2008 -0700

    i810: Remove an effectively unused variable (only used in an incorrect free())
    
    Bug #15401.

commit 37661d916e8384f537d5ed8cbec66a93795c6a05
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Jun 27 11:21:59 2008 +0800

    Fix SDVOC typo

commit 7834a3b118ae4e034f064257762d5c25ada5fe52
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Jun 27 09:54:35 2008 +0800

    xvmc: fix motion_type dump for frame/field picture

commit 989ec9e8a69f909cb64f17e4465982613b4b054d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Jun 27 09:39:02 2008 +0800

    xvmc: Don't copy on xvmc surface in PutImage
    
    As xvmc rendering result has already been in fb, we shouldn't
    do extra copy on it. Although special care is required for i915
    xvmc surface pitch alignment, which must be at least 1KB aligned.
    So video display function should take it into acount instead of
    always setting Y pitch to be double of U/V pitch.

commit 550082070a3fdb951e3cf08974dc56276c0a739c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 26 14:22:34 2008 +0800

    xvmc: enlarge batch buffer size

commit d50cec6ef9e2178ea663e58d548390f0f3da7692
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 26 14:20:05 2008 +0800

    xvmc: only allocate memory requiring physical address on 915G
    
    Later 945-ish chipset can use graphics address instead.

commit d1c34d8c0e7ae2a1d952791343e131837fbfda99
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 26 10:05:21 2008 +0800

    xvmc: init mc render load indirect command once

commit 75e38fa8348198ba151afa37e10be3b0b0b468f8
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 26 09:47:28 2008 +0800

    xvmc: init dest and reference buffer once
    
    Init them right after context create, and only update buffer address
    info later.

commit b4d8ca8b38e495b56bb3b4143e5dfe91ee651f15
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jun 25 14:27:16 2008 +0800

    xvmc: init one-time mc context once
    
    Don't setup one-time mc context everytime, as the content is always
    unchanged. And several structs got packed layout inside to ease static
    state initialization.

commit 54f3f528e4804b958936ac773e7a507b2676f815
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Jun 23 15:51:49 2008 +0800

    xvmc: environ debug option support
    
    export INTEL_XVMC_DEBUG=1

commit 7a705081788bf957409e17baa5f189241589057c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Jun 23 15:49:29 2008 +0800

    xvmc: formalize surface type definition
    
    We should also carefully select surface type id.

commit 0283d22f510ba47dfdac2806a58e46649c26580b
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Fri Jun 27 13:39:31 2008 -0700

    Add pipea force enable quirk for HP Pavilion ze4944ea
    
    Fixes bug #16540, thanks Bryce.

commit 08903abe4dc0295c7ed7d1ff1a22e0e579540c15
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Fri Jun 27 13:37:10 2008 -0700

    Add pipe a force enable quirk for Lenovo T60
    
    Fixes bug #16494.

commit 05df8c0b31721a9ccc7215fb1cda1115758367c7
Author: Hong Liu <hong.liu@intel.com>
Date:   Fri Jun 20 10:57:14 2008 +0800

    Fix SDVO HDMI output.
    
    While some cards had enough initialized at startup to work already, others
    required that the driver actually initialize the required AVI info frame.

commit 59f39e0ea0ad48c52d9b8f7afb6e04ce95db717e
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Jun 24 11:01:46 2008 -0700

    Remove ErrorF debugging from modeset ioctl
    
    Oops.

commit 1056d79809a3765f81113f3988bd948c1f9c673a
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Jun 24 10:44:23 2008 -0700

    Fix back buffer damage handler for 965+ chips
    
    When page flipping is enabled, we need to make sure any changes to the front
    buffer are reflected in the back buffer(s) or corruption might occur at page
    flip time.  So make the damage handler work on 965 by adding appropriate tiling
    flags and pitch adjustments.

commit 65eee25d7d2ca979205f3776d620dbb36bf68a13
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Tue Jun 24 10:41:46 2008 -0700

    Add support for keeping vblank counters sane across mode setting
    
    The DRM supports disabling of vblank interrupts when not in use, but in order
    to function properly it must also be aware of mode setting, which will reset
    the frame counter to 0.  Add code to call into the DRM before and after mode
    setting, so that it can account for any lost vblank events.

commit 277632d8c37cf43c7c1178ae7d5a2e6d5705968c
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Jun 24 16:43:40 2008 +0800

      965 xvmc, current only frame based DCT_type support

commit 9d7929436488969ca4fd1fef4d2e92be5e1a93aa
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jun 20 00:23:45 2008 -0700

    Flush pending batch in block handler
    
    Make sure any pending rendering commands are delivered to the hardware
    before the server goes to sleep.

commit 2f8a0aa8cd24ede824aa52102b45a295f1b6b5be
Author: Keith Packard <keithp@keithp.com>
Date:   Tue May 20 20:29:25 2008 -0700

    Remove some unreliable regs for i915

commit 6b6be2b2a7179c1c9fa12989e16076aae105f4e2
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 19 15:01:00 2008 -0700

    Fix a crash in i830_sdvo_init error paths by setting up dev_priv earlier.

commit 65ad29d78793c7804f133a58de80ffaa0404ca28
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 19 14:27:30 2008 -0700

    Automatically detect the presence of HDMI.
    
    Now, SDVO is only probed if the SDVO detected bit is set.  If the SDVO probe
    fails, but the detect bit is set, assume that it's an HDMI output.

commit ea0d21006ec71bc56acde7291e5f8d28e54b83fe
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 19 14:10:29 2008 -0700

    Fix hdmi POSTING_READ to use the register number instead of the register value.
    
    We won't dwell too long on how this ever worked.

commit 2fa9240a3b685a0c3d0e2644fc144c927b67b6b3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 20 15:14:46 2008 -0700

    Get HDMI output working.
    
    HDMI, despite claiming to have pixel multiply support, actually doesn't
    want it, at least in the way that SDVO did.  Disable it.
    
    Also disable the NULL_PACKETS_DURING_VSYNC bit.  Despite the docs telling us
    to set it, the output doesn't like it when you do that, and the BIOS doesn't
    set it.
    
    Also add a posting read to SDVOx setting.  Without it, half the X starts
    wouldn't get anything on the screen.  (interestingly, it was every other
    startup, not just a chance).

commit dc8ab9d35b261b6105a62949cfb47a3554531d0b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 20 13:49:47 2008 -0700

    Set the sync active bits like we're supposed to, matching the BIOS.

commit af13826ed063b60a1e4179101e8889b4ab7a9d0b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 10 11:51:05 2008 -0700

    Add pixel multiplier support for HDMI

commit 9a05662918223477eb1cf6f80ffac08712721c70
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 10 11:47:15 2008 -0700

    The phase shift its are now reserved, and add HDMI clock limits.

commit beba1dd3561e38573ed9f507328caf7f8fb9f84a
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 6 16:05:17 2008 -0800

    Initial HDMI work.  Not currently hooked up at startup.

commit da58dc3b02999f3244d0eaf77180b828d85bd609
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 6 14:57:57 2008 -0800

    Add DisplayPort registers.

commit 52a414d1158aa7512fb79560dc220e2a78456a2d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 6 14:00:18 2008 -0800

    Remove VGA regs from debug output.

commit b60bbbfd7b7dcf31726ad615a493f34f17cc6309
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 6 13:59:06 2008 -0800

    Add little hotplug detector app.

commit 64fa32e2eba21cb94aa0f8d87a6ee6b7c178a7a5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 19 11:02:29 2008 +0800

    Add backlight kernel method support on Asus and Eeepc
    
    Noted and tested by Evgeniy Manachkin <sfstudio@mail.ru>
    for asus-laptop support, also add eeepc support.

commit 1cfe769c74d1a3a392bf1aaaf5c2dcc8273daf66
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jun 17 12:39:28 2008 -0700

    Add support for Intel 4 series chipsets.

commit 289790c0467d27e96b537598a6589fc6a36da8b8
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jun 17 09:46:12 2008 +0800

    Fix compiling with server master in LVDS backlight patch

commit 66418cc99cfd360e303efcdf74a9ee31d435ff15
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jun 12 14:04:41 2008 +0800

    Fix compiler warning when disable xvmc config
    (cherry picked from commit df0bbdc7cbb6ff357a81ed28d12e56c9c7d643f7)

commit 078d05865884ca5784b532c0a79c8440632002ac
Author: Shuang He <shuang.he@intel.com>
Date:   Mon May 26 09:20:53 2008 +0800

    Fix typo in xvmc block destroy
    (cherry picked from commit 87ace420a34df7425641d089f71830e44fced098)

commit 4c4ef27779aebf4df90b6233de05be2bb972de4c
Author: Lukas Hejtmanek <xhejtman@ics.muni.cz>
Date:   Mon Jun 16 02:49:41 2008 +0800

    Fix maximum backlight issue

commit d775ddc64dc8349b8ef9e85b0be9e93cb1997fea
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 13 10:03:24 2008 -0700

    [gem] Catch -EINTR from blocking GEM ioctl and restart.

commit 02d7141ac395446613edba0f2e2a951e750e4e9f
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Jun 13 11:30:58 2008 +1000

    [gem] remove one more unused bit

commit f07acbdaac95931d184ea2c557edb632e577eb47
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 12 13:47:35 2008 -0700

    Require libdrm 2.4.0 always since we need the bufmgr code.
    
    This lets us remove a lot of conditional compile stuff in the DRI case, as
    if we're doing DRI and have 2.4.0, we can rely on GEM ioctls existing.

commit 754df0aa55c4b5f0c3c415ad97d7612504410229
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 11 14:43:38 2008 -0700

    [gem] Chase move of create ioctl from generic to device-specific.

commit 339f00e340c3a9c8ac8f17147e37906494ef370b
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 10 16:14:06 2008 -0700

    [gem] Don't set up the ring in GEM mode, as that'll be handled by the kernel.

commit e930c0dc5b5f98d256a4167ed70ba813c88924d2
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Jun 7 13:57:59 2008 -0700

    Use bufmgr_gem when available instead of the fake bufmgr.
    
    This is a bit unstable still sometimes.

commit ecf19e1cda60a938d41413075ae6e00f24e0ec1a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 6 15:27:44 2008 -0700

    Change most usage of pixmap offsets to using a reloc macro.
    
    This is based on airlied's RING->BATCH commit.  The 965 code still needs to
    be fixed up for relocations.

commit bade7d7d2505a10a8a7d24b084aff9742e2d6d64
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 6 14:03:25 2008 -0700

    Use the DRM for submitting batchbuffers when available.
    
    There are some concerns with this, as the DRM will be setting the nonsecure
    flag on the batchbuffer, and the server may be submitting some secure-only
    commands.  It appears to work on the 915GM test system currently.

commit 6e94affcc2240e668bcf1aa41f3c8b19929d144b
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 6 14:01:05 2008 -0700

    Avoid needless flush emits in the blockhandler.
    
    The EmitFlush in i830_dri.c was added as a pageflipping workaround, and was
    noted to not even be sufficient then.  There's no reason for it to be there,
    so it's removed.  After that, we just have to not emit an MI_FLUSH if we
    already had, and cursor movement no longer bashes memory manager.

commit b2216e7bc2f1a35f9fc1794bad83208cd5c583d1
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 4 16:31:16 2008 -0700

    Use batchbuffers instead of ring emits for general commands.
    
    The batchbuffers are managed using libdrm and bufmgr_fake, and dispatched from
    the ring from userland.

commit d0fda9d24c5fe4870cdbd2ba0213091165666a8e
Merge: cc98d41 79f94ee
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 10 11:32:49 2008 -0700

    Merge branch 'master' into drm-gem

commit 79f94ee3c4652019395b9c329d94f7779c558571
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 10 11:31:22 2008 -0700

    Set up/restore PWRCTXA from enter/leavevt not server start/exit.
    
    This should improve behavior in the presence of VT switching, but also avoids
    a crash on X exit from writing the register after unmapping mmio.

commit 231a302013981cc597ba09ee89b367c8ab56e8ba
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Tue Jun 10 14:10:39 2008 +0800

    Two more Dell quirks
    
    fd.o #16160

commit cc98d41df63f1ee2561440fab3aa471a80a12920
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 9 12:00:14 2008 -0700

    Add a little program to dump out the first 64 dwords of the status page.

commit 1142be53eb8d2ee8a9b60ace5d49f0ba27332275
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Mon Jun 9 08:52:59 2008 -0700

    Fix TV programming:  add vblank wait after TV_CTL writes
    
    Fxies FDO bug #14000; we need to wait for vblank after writing TV_CTL or followi
    ng "DPMS on" calls may not actually enable the output.

commit 64a8f2433d7774d06119793b57cec6d3be6389c1
Author: Robert Lowery <rglowery@exemail.com.au>
Date:   Tue May 20 21:09:23 2008 +1000

    Fix TV out connection type detection
    
    Make sure we wait for vblank when using the TV DAC to detect the connection
    type.
    
    Fixes FDO bug #14000.

commit a993a8f3ce3a2079c5b5ebaca2ec2564047d7d4e
Author: Tomas Carnecky <tom@dbservice.com>
Date:   Fri Jun 6 10:03:23 2008 +0800

    Fix compile error in LeaveVT

commit 432d07fb175b385715eb3ccf97a303d2ad7bfe11
Merge: 3a967b8 bff180e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 14:57:18 2008 -0700

    Merge branch 'master' into drm-gem

commit bff180e6cac4452ef491c81855eb12bfa03d0bf3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 14:55:23 2008 -0700

    Move debug clock printout from ErrorF to X_INFO.

commit ad459b21b7de4a79552ac155803d5930432fb84b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 14:37:59 2008 -0700

    Remove SVG_WORK_CONTROL init.
    
    The bit set is now reserved -- used to be a workaround for early revisions.

commit e41dc98a0aeec389b221038753056c725ecee1c5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 14:37:26 2008 -0700

    Initialize clock gating from EnterVT and save/restore it appropriately.

commit 8061e5ac27a5f61f940bccc940be922999cc1d3f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 14:09:45 2008 -0700

    Move BIOS scratch register setup to EnterVT instead of PreInit.
    
    We want these to always be set when our driver's in control.  They are
    already appropriately save/restored at leave/entervt.

commit b61cb9283185eb5211e84eb7d8e68beea607c2eb
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 13:57:54 2008 -0700

    Remove gratuitous wait_ring_idle after I830Sync.  Syncing implies that.

commit b65f67b74ff99aea1490d52f170ef4fe80cef6c7
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 13:40:55 2008 -0700

    Move the remaining two lines of SetHWOperatingState to the caller.

commit adb4f5a5e826e584ab212d23fc8d474c3e7bb8e8
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 13:39:08 2008 -0700

    Remove duplicated i830_stop_ring()/SetHWOperatingState() in EnterVT().

commit c2e2fe48113667c683c6e1e9b1237635c41c61c3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 13:21:55 2008 -0700

    Move DSPARB setup into a separate function, and save/restore it at VT switch.

commit 7e51384c973a96366b02ea646392c43574674111
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 11:56:42 2008 -0700

    Replace a couple of wait-for-ring-idles with a single function to do so.

commit 65306cdd71dad71e4ca7229764f81a0880dd70bf
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jun 5 11:26:02 2008 -0700

    Just remove the mprotect kludge.
    
    Besides not being #ifdef __linux__ed as requested, some linux kernels break
    in exciting new ways when you try to mprotect from PROT_NONE back to
    PROT_READ|PROT_WRITE.  Yes, there are bugs in the code we're calling in a
    bug-exploiting bug workaround.
    
    If you want this workaround for the original bug exposed when moving to
    libpciaccess, it's already in libpciaccess.

commit beb72ae5aa053303f5cc419e9c9d7c6db964f160
Author: Hong Liu <hong.liu@intel.com>
Date:   Wed Jun 4 16:58:05 2008 +0800

    Set SDVO sync polarity to default on 965
    
    Fix fd.o bug 15766

commit c7fee208fd46e143965ea173984d284e1eec2a9b
Author: Hong Liu <hong.liu@intel.com>
Date:   Wed Jun 4 16:56:50 2008 +0800

    Fix DSPARB change on 965G
    
    From the spec, only 965GM and IGD_GM have 128 FIFO entries.
    With DSPARB change introduced by commit bd137a, I've got PIPE B
    underrun when dual-headed on G35 platform.

commit 64ccc8a036a1d80fc918e9b124d24ce0d26bdbbb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jun 4 22:30:04 2008 +0800

    xvmc: add render dump function

commit 1729a4f29dd52346a9fa997f818d57884047657f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jun 4 22:25:39 2008 +0800

    xvmc: move block size lookup helper to generic

commit 3cc8876db7ba82fa18e8fab4f267ac6e87964c47
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jun 3 16:15:36 2008 +0800

    xvmc: a little cleanup
    
    Also safe check context size to not exceed surface max.

commit 96955003557686469c7ae9f7d42620d2851e6fad
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jun 3 16:13:52 2008 +0800

    xvmc: remove unused dri drawable

commit bd137a19dc29dd466eac030e040f729ed0807e3f
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Wed May 28 15:47:47 2008 -0700

    Fixup DSPARB for 855 & 945
    
    It turns out 855 has a different DSPARB layout than 915+.  And 945+ have more
    FIFO entries, so we have to allocate things differently.  So on 855 split the
    FIFO evenly again between A & B planes, and do the same on 945, where we have a
    larger FIFO.  Fixes an issue reported by Daniel Stone with the previous default
    value.

commit 3a967b8359bd6c05a10111076cdb02df15cbf2e8
Author: Eric Anholt <eric@anholt.net>
Date:   Mon May 12 13:51:11 2008 -0700

    [gem] Note if pinning a buffer fails.

commit 363ccc3dfbf8ab91608d502e0376a43653581856
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Mon May 26 09:43:40 2008 -0700

    Fixup FIFO comment
    
    What I originally checked in was a bit misleading.

commit 2e1425246ccc75216247b0c2fa6fce2635db472b
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Mon May 26 09:40:10 2008 -0700

    Handle display FIFOs better
    
    Add some debug code to catch FIFO underruns, which are normally bugs (unless
    they occur during mode setting) and remove any plane C FIFO allocations, since
    we don't use that plane at all.  We may eventually need to be a little smarter
    about this on platforms that use plane C for the popup.

commit 89bb53cc7a853d88fc34a0ca65ae2b6227a8dd24
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Mon May 26 09:34:34 2008 -0700

    Fixup power saving registers
    
    Update clock gating disable bits to match docs and allocate a power context
    memory area so that newer chips can save state and power down the render unit.

commit ced4b4bb0c44b55feb5e32ddb860f1c1dc3bbde5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu May 22 22:10:25 2008 -0700

    [gem] Reduce console spam from debugging.

commit 165c0865d849b7d280a3a119fe9ae0ad34637df0
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Wed May 21 14:56:27 2008 -0700

    Define DEFFILEMODE for OS'es that don't have it

commit 71180653825a1b141a08590e4b767d33d9b5d8c1
Author: Jesse Barnes <jbarnes@hobbes.(none)>
Date:   Wed May 21 11:51:55 2008 -0700

    Revert "Disable FBC by default on 965GM"
    
    This reverts commit 53e3693ef13f31f3fc33bcff7286ab2b03b2d430.
    
    Conflicts:
    
    	src/i830_driver.c - default FBC on for 965+

commit 740a73dad1d9a9b0ebf1cc7d6f2a056abad57aaf
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue May 20 08:54:01 2008 +0800

    Revert "Add FIFO watermark regs to register dumper"
    
    This reverts commit 0c00a638ef57aa9d6a3047176b0bfad733f781f0.
    
    Those FIFO watermark regs are 945-ish, and cause problem
    on G35.

commit c81050c0058e32098259b5078515807038beb7d6
Merge: 9c9a5d0 e9532f3
Author: Keith Packard <keithp@keithp.com>
Date:   Sat May 17 23:26:14 2008 -0700

    Merge commit 'origin/master' into drm-gem

commit 9c9a5d0e48c6e911574695fc417d2dc1a0fd1c20
Author: Keith Packard <keithp@keithp.com>
Date:   Tue May 13 12:24:50 2008 -0700

    Add check for GEM, use that to enable driver GEM support

commit e9532f3abf1e0b62b2569d4aae60a5a63add571f
Author: Rémi Cardona <remi@gentoo.org>
Date:   Wed May 14 14:52:37 2008 +0800

    Add glproto to DRI dependencies

commit fe455a38cbac8d47a5c82b3eeb3cc6a59a6e8443
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 13 11:56:10 2008 -0700

    Formatting fixes for intel_idle.

commit 5c1720ecbc5528c40bb48084dc68ef233e9bb43b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon May 12 16:48:05 2008 -0700

    Add i915 support to intel_idle.

commit 089011daf3da8db3bd16d50e1d6a6457da82300e
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 12 12:18:19 2008 -0700

    Track name changes in GEM ioctls.
    
    allocate → create
    unreference → close
    name → flink

commit 10f1d835b8ac7bf3153ac39d295ad2a72c4aa076
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 12 12:15:09 2008 -0700

    Record alignment requirements in mem structure for use by GEM.
    
    GEM needs memory alignment requirements sent at pin time, which is a bit
    after the allocation itself. Store the required alignment in the memory
    object for later use by pin.

commit 5103e5a39a4869a714b8a59da8bf51ecc8c65e4f
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Mon May 12 10:58:24 2008 -0700

    Panel fitting:  fix letterbox modes
    
    In full_aspect mode, we try to preserve the aspect ratio by adding
    either top & bottom or left & right borders.  In the letterbox case (top
    & bottom borders) we were miscalculating the top border which led to
    programming a bad mode.  Fix the calculation and bug #15559.

commit f280c50dd5d29c5717adc6da2368363cb3d0adbb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon May 12 08:57:56 2008 +0800

    Revert last HP 965GM pipe A quirk
    
    Seems not resolve the issue (fdo bug #15885).

commit d91d9e6a2f2ba18b35cb6fd7bc3fe8bc617eb44f
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Sat May 10 07:58:59 2008 +0800

    More Pipe A force quirks

commit 548d4c0f979a72eac5d0c9c76da12f0bd05e64e1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu May 8 12:43:30 2008 +0800

    Fix i965 render getting dest format error
    
    Depend on value returned by function within assert is wrong.
    Fixed weird render corrupt on i965.

commit 9f324860431ff8199a78d19bbaa74046e1476b89
Author: Mike Isely <isely@pobox.com>
Date:   Thu May 8 10:00:17 2008 +0800

    Implement option to ignore external fixed mode settings
    
    The Intel xorg driver tries mightily to determine the native fixed
    panel mode settings for the LVDS output.  It does this through various
    means, including scanning video BIOS tables, and noticing if the pipe
    in question has already been set up by somebody else (and adopting
    those timings).  This strategy works well for say a laptop where the
    LCD panel is an integral part of the machine.  But for other
    applications where the display is unrelated to the system's BIOS or
    other software, then the BIOS will likely have no clue how to
    configure the LVDS output.  Worse still, the BIOS can simply "get it
    wrong", leaving the pipe misconfigured.  Unfortunately the Intel
    driver can potentially notice this, adopt the same settings, leaving a
    messed up display.
    
    All of this complexity normally happens independently, behind the
    scenes, from the mode timings that might otherwise be specified by the
    user.  This driver has a concept of fixed, i.e. "native" mode, and
    then user-specified mode.  If the corresponding resolutions between
    those concepts don't match, then the driver in theory will arrange for
    scaling to take place while adhering to the actual native mode of the
    panel.  Said another way, if the user says 800x600 but the driver
    mistakenly (see above) thinks the native mode is 640x480, then 640x480
    is the mode set with scaling to an 800x600 frame buffer.  If the
    driver gets the wrong native mode, then the result is a miserable mess
    with no way for the user to override what the driver thinks is right.
    
    This patch provides a means to override the driver.  This implements a
    new driver option, "LVDSFixedMode" which defaults to true (the normal,
    probe-what-I-need behavior).  However when set to false, then all the
    guessing is skipped and the driver will assume no fixed, i.e. "native"
    mode for the display device.  Instead with this option set to false,
    the driver will directly set the timings specified by the user,
    providing an escape hatch for situations where the driver can't
    correctly figure out the right mode.
    
    Under most scenarios of course, this option should not be needed.  But
    in situations where the Intel video BIOS is hopelessly fouled up
    related to the LVDS output, this option provides the escape hatch for
    the user to get a working display in spite of the BIOS situation.
    
    Signed-off-by: Mike Isely <isely@pobox.com>

commit 33f033cbf346c13a687e469e8879579fcd5bb2fb
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Wed May 7 14:46:52 2008 -0700

    Save/restore cursor registers
    
    There are lots of good reasons for doing this, one of them is fdo bug #11305.

commit a7188b1f2dd9a69fa7daefe478d283735226f9f3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed May 7 14:21:59 2008 +0800

    Use I830FALLBACK when check pitch for debug

commit 79fde3ad7a949fb7f0dc9907cb6eea6ca9a910ae
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sat Apr 19 08:54:38 2008 +0800

    Check pitch for EXA operation
    
    2D pitch limit applys to all chips. Pre-965 chip has
    8KB pitch limit for 3D. 965 supports max pitch by current
    exa (128KB).
    (cherry picked from commit 8187a5a16f8bd8f0ba5e7f5357f355928b3b8f07)

commit 36ec93300926084fb2951d69b001e4c67bc6ff79
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 6 18:48:20 2008 -0700

    Bug #15807: Fix use of the ring while VT-switched, hit by fast user switching.
    
    The fix for flushing at blockhandler with no DRI on 965 was broken and would
    try to flush the chip even when the driver wasn't in control of the VT.
    Hilarity ensued.

commit 0c00a638ef57aa9d6a3047176b0bfad733f781f0
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Tue May 6 14:38:48 2008 -0700

    Add FIFO watermark regs to register dumper

commit c81a4687fca80bf7367d7f0e9a00a6a09737c5bb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue May 6 13:52:22 2008 +0800

    Only check xvmc lib when xvmc is enabled.
    
    Don't check xvmc lib if user has already wanted to disable it.
    Fix fdo bug #15762.

commit be746a90a87d7a9807fa4243493e7e4d48f7f1c0
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Tue May 6 13:51:46 2008 +0800

    More quirks from ubuntu/dell

commit 417f86d80525d2f5038628afba8f70f8c0fecca3
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 5 13:36:19 2008 -0700

    Move a declaration under #ifndef HAVE_FREE_SHADOW

commit 587dc5bfc4ef32942bd7511f932a3a2e2fcdccb0
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 5 13:35:22 2008 -0700

    Fix up ring dumping code for non-i965

commit 65877d32bb2cd71ccc8d6a66244f029fc3577f69
Merge: b9d12da fff17b9
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 5 12:05:00 2008 -0700

    Merge branch 'master' into drm-gem

commit b9d12da91eb1afb05bd78a40e15f4333e697093d
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 5 10:44:09 2008 -0700

    Use GEM for buffer naming now.

commit 0741020f3725c32c48ad15535b9c0549e4092c23
Author: Keith Packard <keithp@keithp.com>
Date:   Mon May 5 10:17:01 2008 -0700

    Set pin alignment for gem on non-965
    
    non-965 tiled frame buffers have fairly strict alignment requirements, 512K
    on 8xx and 1MB on 9xx, plus they must be aligned to the size of the
    allocation.

commit 271abfd0ec29851273d8ca5241d963be5c64e43c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri May 2 10:06:13 2008 -0700

    Add initial GEM hacks to bring the server up.

commit a0ced923bb793aa22e6bfbeeec0888d3b42ce176
Author: Jesse Barnes <jbarnes@hobbes.lan>
Date:   Tue Apr 29 13:19:02 2008 -0700

    Add a new quirk for BIOSes that reprogram regs at lid close/open time
    
    Dell Latitude D500s seem to have this problem.  At lid close/open, the DSPABASE
    reg gets reset to 0, so we either need to keep the framebuffer at offset 0 or
    make sure we reprogram the CRTCs after the lid opens again.  Since we can't
    make sure the former is always true (buffer resize, etc.), this patch adds a
    quirk to reset the modes at lid open time.
    
    Fixes FDO bug #14890.

commit fff17b9d1b58cb53032d153094826dd306836d59
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 29 10:32:14 2008 -0700

    Use new xf86RotateFreeShadow function to clean up shadow buffers.
    
    This simply moves code from the driver up into the X server; use it where
    available.

commit 1d467a8038946a37844795e8860be113d43219ac
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 23 11:08:38 2008 -0700

    Overlay video doesn't require that the target pixmap be in video memory.
    
    I830PutImage was checking to make sure the target pixmap resided in video
    memory, but this isn't necessary when using the overlay. Test

commit 40e0a03af57d7b3180d7066bcb15e03dcc9ca295
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Apr 21 01:03:22 2008 -0700

    Dump batch buffers found from main ring

commit c8ae3b781f0d8e325876a74c91cd0a685d34454b
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Apr 20 02:11:15 2008 -0700

    Add a bunch of 965 ring stuff to the debug dump

commit 2c135ef8ac40f8e7cd071de7414adfae019f9198
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 16 21:39:58 2008 -0700

    Make the binding table and surface state be arrays to reduce syncing.

commit c3fb62df4e60b63295f94c99b3c5de70dbf94e1c
Author: Keith Packard <keithp@keithp.com>
Date:   Thu Apr 17 10:04:55 2008 -0700

    Add a kludge-around to fix cd/wt bits in fb ptes on linux.
    
    Mmap from /sys/devices/pci* on linux forces the cache-disable and
    write-through bits, which turns our write-combining map into an
    uncached-map, seriously impacting performance. It turns out that a bug in
    mprotect allows us to fix this by disabling access to those pages and then
    immediately re-enabling them.

commit 0ae283582d21776d3317d5fc1c25751d50d562c7
Author: Hong Liu <hong.liu@intel.com>
Date:   Thu Apr 17 10:57:34 2008 +0800

    fix possible segfault in I830FreeScreen
    
    pI830 may point to NULL if I830PreInit fails

commit 7008eac855302fd467e001495483c2dccfddf68f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 16 12:09:41 2008 -0700

    Update dolt from git, fixing fallback to libtool.

commit 23d1df22d177e54bfc46304053d8115047ff85d4
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 16:46:17 2008 -0700

    Abstract surface setup into a separate function.

commit e27ce4238f748d024635835824c120eb298b84b2
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 23:30:21 2008 -0700

    Move the vertex buffer to the state structure as well.

commit 69709fe36cfdb59c140f5cba233dcb606f8dbc85
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 18:34:13 2008 -0700

    Move the binding table for 965 to the state structure.

commit 049d057dfd73b6c191a8ba5d73eddb77cf7748e7
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 17:09:22 2008 -0700

    Move the 965 static variables local to the function they're used in.

commit 092962c962fdf3e33a8d387221448fe7c8c36376
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 14:02:58 2008 -0700

    Make the VS unit state static for 965 render.

commit 4bbdd7096d4927fe48673006fff7df922972f116
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 14 13:53:36 2008 -0700

    Rename some variables in i965_render.c for clarity.
    
    The gen4_render_state is now always called "render_state" (i965_render.c
    bookkeeping) and gen4_state_t is now always called "card_state" (the buffer
    for state used by the chip).

commit 456bb529335c28cf60f3b6e5900b804efa5c185a
Author: Carl Worth <cworth@cworth.org>
Date:   Fri Nov 9 17:24:21 2007 -0800

    Associate one sf_state object with each sf_kernel
    
    (cherry picked from a2b5c23184d19b386fdfd04f578a55566df60132 commit)

commit 90d6b178473ba32cf66e6e654e608cb4374e4a19
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Apr 14 16:31:03 2008 +0800

    Change default panel fitting mode to origin
    
    i8xx currently only works in FULL mode.
    (cherry picked from commit 33ffd781bbca3d0dee8c1b47e7b90be5824b9a4f)

commit c1ad0a1a344a87a537aa5f93f6c774997a3189e4
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Apr 14 10:02:00 2008 +0800

    Remove old sf/wm program from Makefile
    
    Fix distcheck
    (cherry picked from commit 1d8383923bebf38ab8ada6a262cb4fc8c30e074a)

commit 18ef4158e5574bfc6621b268821532f13e261d13
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Apr 13 21:37:49 2008 -0700

    Only use FOURCC_XVMC when INTEL_XVMC is defined
    
    The XVMC code uses a magic FOURCC code to signal frame updates, but that
    code is only defined when the XVMC code is used.

commit 269809030ee9d08b56ad0178a7a9c0194e25785e
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Apr 13 12:47:02 2008 -0700

    Move wm_scratch first to meet alignment requirements

commit 08d3206f3b891e611e3e16c9eb79cfca21ab8a51
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Apr 13 12:35:14 2008 -0700

    Kludge to make planar video work - duplicate sampler state
    
    This patch duplicates all of the surface sampler state needed to read from
    the separate YUV surfaces and then has the planar sampler read from samplers
    0, 2, 4 instead of 0, 1, 2. This appears to make things work, instead of
    having the samplers break at random. I do not understand why this works.

commit 6366e4de540c4713cbc8402c89516464bbdc35b9
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Apr 12 16:39:00 2008 -0700

    Skip copying on FOURCC_XVMC surfaces

commit 0fec42b64ee529eb7ec15febdaa5e4986ec1ab17
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Apr 12 11:01:14 2008 -0700

    Set some mask bits to try and get yuv conversion working

commit 91d3e19786e22061f4b617cf39a3cd713139a2d9
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Apr 12 11:00:51 2008 -0700

    Use compressed instructions for yuv conversion

commit 03836067b77606c134c71b30c7078d09d77c95fa
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Apr 11 12:17:28 2008 -0700

    Fix the offset to sampler default color, and a compiler warning.

commit d3138d9ff0f821fb3adbd27684b0c22a8a910c3e
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Nov 13 12:37:13 2007 -0800

    Enumerate all possible wm_state objects
    
    We have a collection of wm_state objects for each ps kernel,
    (one for each combination of src and mask extend and repeat
    values).
    
    Thanks to Dave Airlie for noticing an errant write through a
    wild wm_state pointer in an early version of this commit.
    
    (cherry picked from 7763706a93d3021907273f9b330750ba110e2fc3 commit)
    
    This cherry-pick required more reformatting than most, due to the
    projective texturing merge.

commit 2293a3677d1dcf294de6a8712bf0d2f65b50dcc3
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Nov 12 16:09:00 2007 -0800

    Enumerate all possible src,mask sampler state pairs
    
    This will eventually allow for the elimination of sampler state
    updates while compositing---and initializing everything in the
    initialization function.
    
    (cherry picked from commit d0874697be8086cd64740c24698df8cd4d31c76f)

commit da85d1b822dcb31698e9c5ab85a7bb27ad745eee
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Apr 11 11:22:29 2008 -0700

    Revert "remove '#line NUM ...' in macro process"
    
    This reverts commit f47486fab3dffcbb03e7ad89f777abba1e887299.
    
    Sorry for failing to push the #line processing changes to intel-gen4asm;
    those are now pushed, so this change should no longer be necessary. Having
    correct file name and line numbers in the error messages is awfully nice
    though.

commit f47486fab3dffcbb03e7ad89f777abba1e887299
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Apr 11 10:12:40 2008 +0800

    remove '#line NUM ...' in macro process
    
    intel-gen4asm doesn't allow '#' line

commit 5c9cde37e769287fb7bf4e08c3600a33c2e92dce
Author: Hong Liu <hong.liu@intel.com>
Date:   Fri Apr 11 09:54:34 2008 +0800

    Bug #14935: Fix i9xx reference clock for spread spectrum.

commit 152a50703aa5e9ebaa9abbe448518742734a5eb7
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 10 16:06:41 2008 -0700

    Fix compiler warning from 24-bit lvds change.

commit baa55ffe3b67ca952e4d1ef7087335d76eb2f24b
Author: Carl Worth <cworth@cworth.org>
Date:   Tue Nov 13 12:56:13 2007 -0800

    Enumerate all possible cc_state objects
    
    We need one for each possible combination of src and dst
    blend_factors. Again, as with recent changes, this eliminates
    state updates from prepare_composite and allows that function
    to instead simply reference an existing object initialized
    within gen4_state_init.
    
    Thanks to Dave Airlie (and git-bisect) for pointing out that with
    gnome-terminal all text was appearing as solid black with an early
    version of this commit. As expected the bug was an alignment issue.
    
    (cherry picked from 0c0ab52c2d100c47f38c7ef826ef585c8b9815e9 commit)
    
    Performance is approximately equivalent on text tests, but may be
    around +2%.

commit d5a80e1e3ab5724d34b20f9ee6f830efd0f5b076
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 16:27:40 2008 -0500

    Single memcpy when pitches align on planar image transfer

commit ac97f2b1487df5574875350a9cded958dae33afa
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 16:27:23 2008 -0500

    Use available symbolic register name

commit f270456e5612cb88933e6aabcd9a816c5c292229
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 10:00:08 2008 -0500

    Remove .g4b files on clean

commit fb6ed8b8b59e9dd18801afef5d7c62042ad176d7
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 09:58:44 2008 -0500

    Update yuv->rgb conversion programs to write to src_sample regs
    
    The YUV->RGB code was written to write directly to the dataport registers,
    but that didn't work for the compositing functions (cause still unknown).
    This change makes that code write RGB values to the src_sample registers as
    with the other sample computation fragments.

commit b01d582e23fc99e32bc47a395e9caa366731372a
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 09:30:35 2008 -0500

    Revert "Compute pixel values directly into data port"
    
    This reverts commit 346cf57deabb4c336612df4c13650a87b5ef6775.
    
    Mixing randr transforms and video caused screen corruption for Render
    operations. No, I don't understand why.

commit 3fc3d1a701bae257b70aa7b7654c722f30e71399
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 02:02:56 2008 -0500

    Remove sync after 965 video put.
    
    The hardware has been marked as needing a sync, so the next video put will
    block waiting for the previous one to complete. Adding a sync here just
    stalls the video playback for no good reason.

commit 825d9e50c59450f07178a54fed2616e551dc0455
Author: Keith Packard <keithp@keithp.com>
Date:   Wed Apr 9 00:09:34 2008 -0500

    Add planer video decode kernel
    
    Support for planar video reduces bus bandwidth by 25% and also reduces CPU
    usage during planar->packed conversion.

commit a03eaaa67b33c57530e92c53d28917e2563b4427
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 8 16:24:55 2008 -0500

    Use shared exa_wm code for packed yuv decode
    
    Eliminate special video sf and ps programs.

commit 32ef98518394d29cb87405005c660278489396bb
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 8 16:21:55 2008 -0500

    Compute pixel values directly into data port
    
    Instead of leaving pixel values in src_sample registers, compute the pixel
    values directl to the data port to save 8 moves. This cannot work when no
    computation is done as there is both no way to wait for the sampler to
    finish and because the sampler returns data in a different order from that
    required by the data port (sigh).

commit b68d9f4245d0ebe3371c179401ff145f1a4d101b
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 8 16:09:00 2008 -0500

    Use symbolic names for channels in YUV code

commit 781be9d47289713b0a8fcd95c769a9c6241d62e9
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 8 16:08:20 2008 -0500

    Rename src/mask/data registers to indicate channel

commit 2871ac8eefd0192080bb0569140c3f5d0e1d9b44
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 10 13:34:13 2008 -0700

    Statically allocate the sampler default color, which we never change.
    
    Performance change is in the noise.  Also from Carl Worth.

commit 80dd784e33847e431403d4659a7b8d8425b2676f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 10 13:24:51 2008 -0700

    Add copyright information for recent editors of this file.

commit b606278db83ec84b1db562a2d65697c50561b169
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 10 13:17:58 2008 -0700

    Keep static copies of the 965 render programs in video memory.
    
    This reduces the CPU overhead of memcpying them in every time, for a speedup
    in aa24text of around 30%.  This is based on work by Carl Worth which is
    in the intel-batchbuffer branch.

commit bd41d2bb858770c109d5013274a4354e8e6ae32d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 10 10:24:48 2008 -0700

    Add dolt to speed up compile time and reduce insanity.
    
    Hopefully some day we can be rid of libtool entirely.

commit 96ae9a9f0abc582e45ff4e17dd213c8739c24cb3
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 9 14:17:29 2008 -0700

    SDVO: Rename output_dtd variable to input_dtd, which is its new job.

commit 72c3995d5158286d20e97296f4552697f32f935f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 8 15:00:18 2008 -0700

    SDVO: Set adjusted_mode in mode_fixup from the preferred input timings for TV.

commit b61178524bece756dc0fd4f798c6c7743b5725db
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 8 14:11:42 2008 -0700

    SDVO: Fix lols TV mode list handling.

commit 5db73f18d2badec37523850024b9aa824e4e6bd8
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 8 13:53:51 2008 -0700

    SDVO: Use the TV reference clock for SDVO TV outputs.
    
    Based on a patch by Will Wiseman.

commit e031cc02e65acfbafb48136dad414751e04425c5
Author: Mike Isely <isely@pobox.com>
Date:   Wed Apr 9 14:15:03 2008 +0800

    Implement support for 24 bit pixel format
    
    The Intel driver appears to be coded to only work with displays
    expecting 18 bit pixels.  However I have an application using a LCD
    display that expects pixel data in 24 bit format.  The difference is
    only 2 bits in a single GPU register.  This patch implements that
    change, controlled by a new driver option, "LVDS24Bit".  The default
    value is false, which is the previous behavior.  When set to true,
    then 24 bit panels should work (at least the one I'm testing here
    does).
    
    Fd.o bug #15201
    
    Signed-off-by: Mike Isely <isely@pobox.com>

commit 79b18980ac9f60b1978abe421352df965aed1681
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Apr 9 14:03:45 2008 +0800

    Include <stdint.h> in i810.h for integer types definition

commit 2b720262e1235f1c9da860ba3e9181f0c377aa5e
Author: Jesse Barnes <jbarnes@virtuousgeek.org>
Date:   Wed Apr 9 17:34:17 2008 +0800

    Fix LVDS regression
    
    Disable panel fitting on 855GM, and fix dither setting.

commit af92f4f885c8eae2211d09080b2289aa5bab9ec1
Author: David Schleef <ds@schleef.org>
Date:   Tue Apr 8 12:43:20 2008 -0700

    Bug #15219: Fix default overlay CSC factors, and use BT709 if available.
    
    Using the updated factors even when BT709 conversion isn't available
    (non-965) should still give us better color reproduction.  Tested on a
    945GM, examining the +/-5% of black bars of videotestsrc.

commit 37bc23660a8c346f1eaa6c93ed2c7a840828f0b0
Author: Bryce Harrington <bryce@bryceharrington.org>
Date:   Mon Apr 7 17:26:49 2008 +0800

    Quirks from Ubuntu/Dell
    
    FD bug #15353. Launchpad bug ID is available for reference.
    (cherry picked from commit 24248097988775d62f6c416f2988e74d31c91cd0)

commit dcbdc901d64d2fab489292ef1c9ca1490bdd1e94
Merge: 0147c1c 13563bd
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Apr 4 19:19:35 2008 -0700

    Merge commit 'origin/master' into projective-965

commit 0147c1c84872f7a109721a53d88a539932d9be81
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Apr 4 19:17:55 2008 -0700

    Forgot to build exa_wm_src_sample_argb.g4b

commit 13563bd65cbbbb3e697dacd814efa3517e1493dc
Author: Hong Liu <hong.liu@intel.com>
Date:   Wed Apr 2 16:05:43 2008 -0700

    SDVO: Fix DDC bus selection based on output priority list.

commit 6ad2d6ba86689674876f5f4c473f11e39243ac38
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 2 15:16:17 2008 -0700

    SDVO: Fix mixups with input and output channels.
    
    The 2-bit input_mask was actually an input count -- in0 is always there, and
    in1 is optional.
    
    The output flags weren't being reported in the log, so I mistakenly took
    controlled_output == RGB0 to mean that the device only reported an RGB0,
    while it actually reported RGB0|SVID0|YPRPB0|misc|other.  Move SVID0 up
    in priority and remove the RGB-is-it-really-TV hack I had just come up with.
    
    Finally, set the input/output mapping at mode set time.  We're always
    supposed to do this, but haven't had to so far as we've never handled
    devices with more than one output.

commit 3a17400dc67534f0eb474ece080f01061469569c
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Apr 2 14:21:23 2008 -0700

    SDVO: Handle RGB outputs that are really TV outputs, and select a TV format.
    
    Still doesn't light anything up.

commit 3c1701797b61afaae826a78455079e2115483053
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 31 10:04:18 2008 -0700

    Add WIP SDVO TV-out support.
    
    Doesn't include properties for selecting TV formats or picture enhancements,
    and totally untested.

commit 9d5ba26fb5c337388920b45eadda85e43bc564fa
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 28 14:28:28 2008 -0700

    Add SDVO TV-out registers.

commit 90886f9a602d58b754e9a8d0f1a9c40803d34fa2
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 1 00:54:13 2008 -0700

    Remove extra flushing

commit 0836373dc6e2f8612f120074980561f7ac11f6f7
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 1 00:16:05 2008 -0700

    Add projective versions of the PS kernels

commit bfd803e085e938866efb45c67a79facef78ec399
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Apr 1 00:06:08 2008 -0700

    Shrink WM thread to 32 registers and 1024 scratch space.
    
    Saving registers means we can run more in parallel.

commit a6492661ae07310128eb73c3ef037c42ce7ab184
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 23:50:20 2008 -0700

    Fix composite with mask using new compositing thread code
    
    Clean up register allocation to never overlap
    Always write 4 values for each texture vertex.

commit f8081178eb6fda0e405967cbacad532561619262
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 12:06:37 2008 -0700

    remove old shader source files

commit 879f8717b09f79156b218ee9cc2107700190d586
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 12:05:56 2008 -0700

    remove old monolithic shaders

commit 6db8faeb754897b21af045d00f50db9640b080bb
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 12:04:00 2008 -0700

    remove old monolithic shaders

commit 6bb92213374f278387c539bbe05b773e87e11b90
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 11:59:14 2008 -0700

    Back to new shaders, fix urb read length

commit 05710145b6fc4ed2c528128b2e6022591a53d050
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 11:31:31 2008 -0700

    Dont set the compr bit on 8-unit sends

commit 08500507284f13ad7084eb231b43e117e9728129
Author: Keith Packard <keithp@keithp.com>
Date:   Mon Mar 31 02:20:43 2008 -0700

    Use m4 to clean up gen4 asm progs. Start adding projective transform support.
    
    Use macros for register names, modularize functions into separate files.

commit 949d73271d7100c1f028fd60f185f4929461304e
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Mar 30 19:19:46 2008 -0700

    Remove rotation sf and wm progs

commit 492ff1494f782240e6ca68919b2d0b9aa400fc53
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Mar 30 19:14:18 2008 -0700

    Fix the sf_mask program to compute and pass corrected uvw cooefficients
    
    sf_mask is the same as sf except that it must compute both src and mask uvw
    cooefficients, which are conveniently adjacent in the same registers, and so
    need only an extended execution width

commit 6304b38423f99190a5e54f1a7dcaa75adfad4f2a
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Mar 30 00:54:51 2008 -0700

    Reimplement wm program for nomask case to handle affine transforms
    
    This involves correctly computing u/v locations based on x/y vectors and
    line constants computed in new sf program.
    
    Also, use fewer instructions to make this go a bit faster (2X for 500x500
    composite).

commit 771a56b1ed0df69345c723cb62a73b6842cd8227
Author: Keith Packard <keithp@keithp.com>
Date:   Sun Mar 30 00:54:07 2008 -0700

    Clarify comment in exa_sf program

commit 4f469189fed541549e5d470b2529275a29cc2f20
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Mar 29 14:28:05 2008 -0700

    Compute du/dv/dw in no-mask SF prog

commit 7dcb6e627449c80cea9812462ce6a3e125bd1240
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Mar 29 14:27:35 2008 -0700

    Disable cursors while switching modes

commit d50264fc7c4e0f80d9cc68dfdf322f68520a0f1e
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 28 15:15:26 2008 -0700

    Add a "total" field to intel_idle output (set when any unit is busy).

commit 1450acd046d47e1739a3ffbd146c73ad2974a935
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Mar 28 13:23:02 2008 -0700

    Use combo backlight control rather than pure legacy
    
    If the legacy bit is set, use both the BLC_PWM_CTL and LBB regs to control the
    backlight, rather than just LBB.  Looks like more platforms want that than what
    the current code does.  Note that kernel provided interfaces will always be
    used if available, so this shouldn't affect users with /sys/class/backlight
    interfaces at all.
    
    Fixes #14721.

commit 49f409fef5e8b04a8595309ba8959ca36b2e41b1
Author: Matthias Hopf <mhopf@suse.de>
Date:   Wed Jan 9 16:31:41 2008 +0100

    Include missing stdlib.h for free()

commit 3414313ac9d0faa95797ee18cc33afa231ec7581
Author: Matthias Hopf <mhopf@suse.de>
Date:   Wed Jan 9 16:08:57 2008 +0100

    Fix obviously wrong verification of DRI_SUPPORTS_CLIP_NOTIFY.

commit c40f195f2dc3467259b4588e087aac9741003ebf
Author: Matthias Hopf <mhopf@suse.de>
Date:   Wed Jan 9 14:40:49 2008 +0100

    Fix obviously stray '(' in non-I830_USE_EXA case.

commit 7bba2c13310ed5ac22a355a3cc0ec8b7afaa79cf
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Mar 28 11:41:24 2008 +0800

    Disable DRI earlier if fb width > 2048

commit b1f358ba97473b792ec2b7ed5170152faebe7262
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Mar 28 11:29:40 2008 +0800

    Disable overlay on new mobile chipset
    
    It's gone, really.

commit 588371ba15afffa9343629f0ea7ce530586eef0b
Merge: 52d6ced c13efdd
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Mar 26 14:53:15 2008 -0700

    Merge branch 'master' into pfit

commit c13efdd3d6d3846078766814b57306a7519bce18
Author: Paulo Cesar Pereira de Andrade <pcpa@mandriva.com.br>
Date:   Wed Mar 26 10:11:36 2008 +0800

    More compile warning fixes.
    
    o Check for RANDR_GET_CRTC_INTERFACE before defining functions that
      are used only if it is defined.
    o Declare a variable before code, and rename it from ret to xvmc_status
      to better describe it.
    o if 0 some static functions not used.
    o Don't declare some unused variables.
    o Declare as static some functions that are used only in the file defining it.
    o Add a default/fallback return True to the Bool function
      src/xvmc/intel_batchbuffer.c:intelInitBatchBuffer().
    o Ansify src/xvmc/xf86dri.c.
    o Add missing prototype to src/xvmc/xf86dri.h and follow pattern of other
      headers by adding "extern" before function prototype.

commit 8cdbd55f8075cd18b563badde35815665d7d053e
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 25 10:06:14 2008 -0700

    Fix 965+ rendering issues with DRI disabled.
    
    The new chips no longer automatically flush the rendering cache, so if we
    don't flush the RC at blockhandler, the last rendering done may not
    appear on the screen.  This was particularly noticable with a bare Xorg with
    some missing root weave, and terminals where the last character wouldn't
    appear until the cursor blinked.  A flush in the DRI blockhandler path had
    hidden this issue for most people.

commit c02ab432dd7058c700c35eecf6215daf5f262c51
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 24 13:48:20 2008 -0700

    Revert "Use mprotect on unbound AGP memory to attempt to catch use while unbound."
    
    While I still like the idea, the mprotect calls themselves are failing on
    Linux and causing more trouble than they're worth.
    
    This reverts commit a1612b7728d4153499fe86b6713a13c8702cc7d9.
    
    Conflicts:
    
    	src/i830_driver.c
    	src/i830_memory.c

commit 552a1b824db31a234d7c5cb71057ed0e0ce64477
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 24 13:25:37 2008 -0700

    Disable a bunch of clock gating disables on IGD_GM, which doesn't need them.
    
    Besides our driver having fallen through to the GM965 path for
    RENCLK_GATE_D1, the BIOS was turning some of these on.  It may be relevant
    for previous platforms as well to zero out the fields that should be zero
    in the other registers.

commit c1a2bc357fc122d3718eca771530367ba2915815
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Mar 24 13:29:24 2008 +0800

    Don't try to build XvMC if DRI is disabled
    
    Instead of failing the build, don't even try unless --enable-xvmc was used.

commit 5fcc002f77ebb66c1dc0f901a377ccf9bbc1d0bd
Author: Maxim Levitsky <maximlevitsky@gmail.com>
Date:   Mon Mar 24 13:24:12 2008 +0800

    Fix crash triggered by dpms low power mode with hardware overlay running
    
    When overlay switch crtc, it ignores current crtc dpms mode which
    might lead to hang.

commit 645980596450ed21c3b8927410a6bfe38a0c55d1
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Mar 21 03:08:24 2008 -0700

    Transformed coord computed using floats. Don't move bilinear composite dst.
    
    The homogeneous coordinate computation in the core server cannot be used for
    many legal matrices as it overflows. Just use floats in the driver; faster
    and avoids troubles.
    
    When compositing with bilinear filter, don't push the dst coordinates around
    as that makes the output blurry when pixels are aligned.

commit bf725b92cf93d74a6f414f81f319dddbc2c78525
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Mar 21 11:50:27 2008 +0800

    xvmc: fix distcheck
    
    Add i915 headers in Makefile.am

commit e8da1a5418ab240ae7b1ef95bfea6bee22f1e0c1
Author: Joerg Sonnenberger <joerg@britannica.bec.de>
Date:   Fri Mar 21 11:41:49 2008 +0800

    Fix DRI config for NetBSD
    
    Reported by Joerg. This does a little more clearn up.

commit 224c36cc14a7552bc5df793ad582f0ea5349eb1e
Merge: 4b9b7b0 03ccffd
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 20 10:31:57 2008 +0800

    Merge branch 'xvmc'

commit 52d6ced652059989e6d9780a149488ccd16e3a22
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Mar 19 11:59:15 2008 -0700

    Fixup backlight control and panel fitting property names
    
    They should be listed as lower case, since that's what you'd pass to xrandr.

commit 4b9b7b007d729f94b01b0031d8ae478134b501da
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Mar 18 14:08:19 2008 -0700

    Handle projective transforms on 9xx for Composite.
    
    Projective transforms require un-normalized texture coordinates and the use
    of the texldp instruction. The coordinates are passed as x/y/z/w (the z is
    unused, but there isn't a vertext format for just x/y/w).

commit f699389818f1f11f3edddcdddcd0a43be21ba4c0
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Mar 18 14:06:47 2008 -0700

    Add i830_transform_is_affine and i830_get_transformed_coordinates_3d.
    
    These are needed to deal with projective transforms in the composite
    operation.

commit a55974b435224fe5726fa44298d051c71e4056a5
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Mar 18 13:47:20 2008 -0700

    Add defines for 9xx S3 word in 3D_STATE_LOAD_STATE_IMMEDIATE
    
    These aren't used at this point, but what the heck.

commit 4f5500abe209b92b39ae1f2d7a1118362ac95034
Author: Keith Packard <keithp@keithp.com>
Date:   Tue Mar 18 13:45:46 2008 -0700

    8xx/9xx can handle textures to 2kx2k. 965 can do 8kx8k

commit b1b173d03b3acd300c3b0f0ceffeddf1a8137839
Author: Julien Cristau <jcristau@debian.org>
Date:   Tue Mar 18 12:02:25 2008 +0100

    Add i8[13]0_ring.h to _SOURCES to fix distcheck
    
    Thanks to Bruno <bonbons67@internet.lu>.

commit 03ccffd5b9b8108166ea143884a1a0a6417f3236
Merge: ac76363 d72e18c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 18 16:54:15 2008 +0800

    Merge branch 'master' into xvmc

commit ac763634069fe070b3afc073ce437959612d39fe
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 18 16:52:29 2008 +0800

    Disable XvMC if DRI is not enabled.
    
    Default XvMC to disabled.

commit d72e18c10995079121eded758a60ed99b5b8ce1a
Author: Paulo Cesar Pereira de Andrade <pcpa@mandriva.com.br>
Date:   Mon Mar 17 16:59:12 2008 +0800

    Compile warning fixes.
    
    Move some declarations and don't declare an extra variable with the
    same name, to fix warnings about mixed declarations and code.

commit 81df48d8d151907c2e9dd33a729860c39aa78175
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Mar 17 10:05:57 2008 +0800

    bug 15060: Dell Latitude X300 needs pipe A quirk

commit ffb5a115cc62ed63110f77815b7f04976f720065
Merge: 05cf070 24e6eb2
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Mon Mar 17 15:19:05 2008 -0700

    Merge branch 'master' into pfit

commit 24e6eb2ae683ed6614ac79c0d7811ac9fe94209f
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Mon Mar 17 14:17:27 2008 -0700

    Add support for new ->get_crtc output callbacks
    
    Using the new interface allows the server to avoid some flicker at startup.

commit 69fbc17441d0f894d17b058e65ae22300cd2a54c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 14 10:04:18 2008 -0700

    Change OUT_RING and similar calls to OUT_BATCH for batchbuffer merge

commit 65f92cfb7a05c9c028cf73ce1221cc0a651b50b3
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 14 10:03:11 2008 -0700

    Remove h0h0 UploadToScreen implementation that used pattern blits.
    
    It never worked and was never that hot of an idea.  Most of the motivation is
    gone with glyph pixmaps anyway.

commit 05cf07071e25f84dec3476a9bed7235ed50cd249
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Mar 13 18:12:00 2008 -0700

    Initial panel fitting changes
    
    Basic support for panel fitting.

commit 402fbd36221d2ed27913850f6bfcce768b970fe8
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Mar 13 16:12:20 2008 -0700

    Remove fbc enable/disable messages
    
    Tired of them filling up my logs.

commit c20d78a7bc512219fa36dfc9707fe65f66ab80f1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 10 17:27:45 2008 -0700

    Add workarounds for 830/845's lack of a8/x8r8g8b8/x8b8g8r8 support.
    
    When we have unset channels (color for a8, or alpha for x8*), force them
    to the appropriate value in the texture combiner rather than relying on getting
    the desired results from teture mapping.  Performance is the same on 865, so
    multiple paths aren't necessary and we can use the less friendly texture
    formats everywhere.

commit f425181695b1b3864373e1919cf651229f19fa69
Merge: f4cfc98 1c0e495
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 13 23:58:56 2008 +0800

    Merge branch 'master' into xvmc

commit f4cfc98ab038af4d5d52af12e4d60ded62cf4a6e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 13 23:56:48 2008 +0800

    nuke unneed error_base and event_base

commit f269c69b4e7be076dc9838d0e0801c940ccdba08
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 13 23:41:22 2008 +0800

    remove unused init/fini hooks for xvmc driver

commit 1c0e4958564588162bc22a980567436dfc9d1e56
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 13 10:15:55 2008 +0800

    Always bind memory after agp aperture allocation
    
    This fixed the crash appearing for Xv buffer memory, which appears
    allocation and free happening in stolen memory. We should always
    try to bind for stolen memory for correct protect setup, otherwise
    we might get fault that stolen memory protect reverted to non-r/w
    after previous free and unbind.
    
    Credit goes to Lukas Hejtmanek to identify the real problem of Xv
    crash!

commit 2e2372912ed9bc0d86e8960653ef0bfce5cf99ab
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Mar 12 11:38:56 2008 -0700

    Eliminate local variables defined in i830 BEGIN_LP_RING().
    
    This lets us get better sanity asserts, and avoid mysterious braces when you
    do two BEGIN_LP_RING()s in a single function.  Potential minor performance
    loss isn't too exciting, as ring access is about to become a compat path
    anyway.  This change also removes the requirement for ring emits to be aligned
    to dwords.

commit abf11a274e14535630742fe4c41cc0ae92555293
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Mar 12 11:03:26 2008 -0700

    Separate i810 and i830 ring macros out into separate files.
    
    I want to hack on i830 for changing it into a compat path for batchbuffer
    without having to worry about the i810 stuff getting broken.

commit e04908853db74dc76718f6bc0dfb23b5ab3c5837
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Mar 12 15:44:58 2008 -0700

    Add sysfs backlight support for Fujitsu laptops
    
    Tested by Dan Williams.

commit 907399660b83b3939aab3dc7d0697197441e4ec8
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Wed Mar 12 12:33:36 2008 -0700

    Add stdint.h to DVO drivers
    
    Fixes the build for me (just following the git development guide on a
    new machine).

commit 8563effc96195116c96f89a801c1de6ab982630a
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Mar 12 11:14:17 2008 -0700

    Add stdint.h to i830_bios.h
    
    Needed for new uint* usage.

commit c82d8e51c6ff9522ad0deb33399d13f3d6fef19d
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Mar 12 11:13:50 2008 -0700

    Add pipe A force quirk for Thinkpad R31
    
    Fixes #15036.

commit a8f4108bea0966406b0fcae8d062ae1cfb4afbb3
Author: Hong Liu <hong.liu@intel.com>
Date:   Wed Mar 12 21:55:56 2008 +0800

    Fix rotation mem with kernel memory manager in VT switch
    
    Unbind and bind a DRM BO may change the buffer offset, thus
    crtc may reference a wrong rotated memory after a VT switch cycle.
    Destroying it here will cause its reallocation when entering VT.

commit cd73c6a5a78eac726b14ef242b8452c559c4c003
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Mar 12 20:37:41 2008 +0800

    Pass default visual in dri context create

commit 21580add63307ca68790bf911243b8675f5f7c64
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Mar 12 20:37:17 2008 +0800

    disable memory alloc debug

commit 5f272471878c896038b2c3f2bf704655d908828d
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 11 12:14:51 2008 -0700

    Nuke more CARD* types from i810 driver.  Untested.

commit 9a62d3b598cca3c28fa8b6313bba82983cc29ecf
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 11 12:07:52 2008 -0700

    Remove i830+ driver's use of CARD*/INT* types for great justice.
    
    Several uses are actually left, which are determined by the X Server
    interfaces we're implementing.

commit 15f17aa682129c57d3864a355834edff06e91540
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 11 11:27:10 2008 -0700

    Cleanse DVO drivers of CARD* types.

commit 642ba6278876ec945ad687c2b9624e532cd3f629
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 11 09:59:16 2008 -0700

    Add support for brightness control to i915 textured video output.

commit ecdb5963ef6873ab82998dca6ca5186644666ec8
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Mar 11 11:08:25 2008 -0700

    Add pipe A force enable quirk for Toshiba Portege R205-S209
    
    Fixes #14944.

commit 4ea67e9b853e9ed61557780b87bd184fc81fd731
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Mar 11 13:54:33 2008 -0400

    Crack down on warnings.
    
    Fix printf formatting warnings, wrap a couple of long lines, nuke
    unused variables, add missing #include <unistd.h>.

commit 9fd13e6773371c82b9799a5bda7c96ffa5cafe8c
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Mar 11 13:48:07 2008 -0400

    Silence warnings about possible uninitialize use of dst_format.
    
    Whoa, gcc got a lot smarter about warnings.  If iXXX_get_dest_format()
    doesn't support the picture format passed in it won't initialize the
    uint32_t pointed to by dst_format and return FALSE.
    
    What gcc now can detect is if dst_format is used without checking the
    return value, it might be used uninitialized.  This patch makes sure
    we always check the return value before using dst_format.

commit 31654f52b084ebb32f69854dfb1c342c9da07928
Merge: a03aca1 02c0ffb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Mar 11 14:37:41 2008 +0800

    Merge branch 'master' into xvmc
    
    Conflicts:
    
    	man/intel.man
    	src/i830_driver.c

commit 02c0ffb1d8112a6fb03f9c8eae9ec1a1fca123ef
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Mon Mar 10 11:51:37 2008 -0700

    Add pipe A force enable quirk for Dell Latitude D500
    
    Fixes #14888.

commit a1cd37f94cb8efbde84ba0a46839fb8735dd3595
Author: Dave Airlie <airlied@clockmaker.usersys.redhat.com>
Date:   Mon Mar 10 14:43:24 2008 +1000

    quirk: add DVO ivch quirk

commit f2b9f387af7f618ad083b1ec8bee513ff2157d06
Author: Matthieu Herrb <matthieu.herrb@laas.fr>
Date:   Sat Mar 8 23:36:56 2008 +0100

    Makefile.am: nuke RCS Id

commit bf6d59ee98127ac6447848c4202c54d861a510d4
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 7 14:26:22 2008 -0800

    Avoid setting reserved bits in SDVOx on everything 965-class.
    
    This will likely fix SDVO outputs on G35 hardware.

commit 5915c75422c5277d530e7f8ecbdfe94654706efd
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Mar 7 13:18:09 2008 -0800

    Enable hardware overlay on 965
    
    Based on Maxim Levitsky's patch for the same.  Many thanks to Maxim for
    discovering that this features still works in recent hardware!

commit 13ae79b415d944891cfdc2cd2d5397fec36a4e8e
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Mar 7 08:04:37 2008 +1000

    fixup pciaccess version detect

commit be08b61540e1edbb7673f0b6add0f1e32b136b3c
Author: Jesse Barnes <jbarnes@jbarnes-t61.(none)>
Date:   Thu Mar 6 13:55:13 2008 -0800

    Implement new get_property feature for backlight control
    
    This should keep the backlight value reported by xrandr --prop & xbacklight
    consistent with changes by other software in the system (like the hotkey driver
    or kernel backlight driver).

commit 502e41f6dff91393cfeaf08c9ba312781d1b7267
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 6 19:32:29 2008 +0800

    remove extra dri checking
    
    And directRenderingDisabled already has config check result.

commit ea58d66cf778c0477c30e5bfe3142b64e8b971d5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Mar 6 19:31:33 2008 +0800

    No ring, no sync

commit c823fb00a20f523f50a2779c36aa1c014ba01535
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Mar 6 19:29:22 2008 +0800

    Pull chipset detection out of PreInit into its own function

commit 6b16cee0786b636dc849826193b26e898832a73c
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Mar 6 19:27:42 2008 +0800

    Account for FBC LL cache in memory reservation
    
    When we reserve memory (memory that won't be managed by the kernel) make
    sure to reserve space for the FBC LL cache as well.

commit 6f04d02471f1cebc76eab637a9a78c4004fd3cc9
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Mar 6 19:27:07 2008 +0800

    Move MTRR fixup to its own routine

commit 750beb9232b51223d8e650878ce8dad071f0d0b3
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Mar 6 19:24:47 2008 +0800

    Refactor memory allocation into a separate function
    
    This simplifies the memory allocation code and fixes a number of bugs.
    Prior to this change, some flags may have been set after memory
    allocation occurred, meaning they had no effect.  It should also make
    the allocation logic clearer.

commit d466b25d09bbe85abe84d9d7714ffb65fafe7593
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Mar 5 13:38:58 2008 +0800

    Really print adjusted_mode for mode debug

commit d767eabe534be7f7bdcbf00614a8901124ac911f
Author: Hong Liu <hong.liu@intel.com>
Date:   Thu Feb 28 13:51:18 2008 +0800

    Fix DPLL programming in CRTC mode set
    
    The following patch fixes the display problem on internal development machines.
    The code in commit 3c22ed633be2ac96eea7bc533839e956f1f31b84 (Jesse's force pipe
    A enable patch) broke DPLL programming.  Moving the DPLL set back up in the
    function solves the problem.
    
    Fix for internal bug #309.

commit 4936e097028b91f4bdc2d9101dc49f6fe586e718
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Mar 4 08:52:40 2008 -0800

    Change FBC idle mode back to default
    
    Use the "immediate idle" mode for FBC.  Rather than waiting for the current
    compression pass to finish before signalling to the CPU that it's idle, this
    mode should stop any current compression pass and tell the CPU that the GPU is
    idle right away.
    
    Seems to fix #13326.

commit 02a3b80ee8341968dbce5b7cb871b187db5ff805
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 29 11:13:34 2008 +0800

    Bug 14591: comment out MI_DISPLAY_POWER_DOWN as for 965GM only

commit ea7c7d088e0a3c3b7ab2bdd0475aa13379764bf4
Author: Peng Li <peng.li@intel.com>
Date:   Wed Feb 27 11:56:55 2008 +0800

    HP Compaq 6730s has no TV output

commit fdc25cb0ca7d479051cee66a032f9ee1b68db98a
Author: Mark Kettenis <mark.kettenis@xs4all.nl>
Date:   Tue Feb 26 17:26:50 2008 -0800

    Bug #14649: Fix build if pciaccess headers are not with other xorg headers.
    
    We failed to include the pciaccess header flags in our build.  Even if the
    server was to include those flags for us, it would leave us broken for the
    tools-only case, and it's easier to just put the flags everywhere so we avoid
    future copy'n'paste mistakes.

commit e55d86f654aa9dd4951b441636c8ca4b37786daf
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 26 12:26:23 2008 -0800

    Fix SDVO I2C access on Mac Mini in EFI mode.
    
    The GMBUS was being left in SDVO pin access mode, which blocked our bit-banging
    access to those pins.  Thanks to Peter Jones for quick debugging turnaround
    in getting this fixed.

commit 6935c732c351585f31e2094c4201a00e3d5529b3
Author: Julien Cristau <jcristau@debian.org>
Date:   Mon Feb 25 14:47:02 2008 +0100

    Look for src/{modes,parser} in $srcdir, not in objdir
    
    This makes the detection work in case configure is run from another directory.

commit 66cdccb021a4748b2af41e415c36ed58ca808df6
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Feb 25 14:29:09 2008 +0800

    Fix overlay rotation
    
    Track current covered crtc rotation in port's private,
    and fix overlay rotation transform to be against crtc mode
    coordinate.

commit 975d7833bc844485c7043538336bddcba7f7f90e
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Feb 22 11:41:25 2008 -0800

    Add quirk for DVO channel selection
    
    Some machines want DVOA, some DVOB.  We can use this quirk to differentiate
    them until we come up with a better solution.  Patch from Hong Liu.
    
    Fixes #13722.

commit 33802b6ee3c298bae4d2b6f464ee5cc730a58506
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Feb 21 08:43:34 2008 -0800

    Add pipe A force enable quirk for ThinkPad X40
    
    ThinkPad X40s need this quirk or they'll crash frequently.
    
    Fixes #14521.

commit 444984a578aae92ff55c06da897ea1d23679e706
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Feb 21 08:37:42 2008 -0800

    Remove side effects from VGA debug code
    
    The VGA register dumping code was leaving ARX in data mode rather than index
    mode, which could cause problems for later software accessing AR* registers.
    Fix it to make sure it's in index mode when we're done.
    
    Fixes #14434.

commit 28049540d8a9f79401fcfeb90784f5a528e7b34f
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Feb 20 13:08:27 2008 -0800

    Fix DSP*CNTR restoration
    
    When checking which pipe a given plane was associated with, we weren't properly
    masking the pipe selection bits.  Fixes #14481 and should allow the driver to
    work with vesafb again.

commit 293120bfc40a5b828567551954d8312639e73578
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Feb 19 21:13:45 2008 +0800

    Don't leak memory if no DMI info is provided by kernel

commit cdc5cb7c3d24f36a30fb931b43ec6df8294709e2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Feb 19 08:51:53 2008 +0800

    Fix last 8XX clock's p2 value commit
    
    My fault to change Hong's origin patch reversely.

commit be0591880f20bdcbae159d5ab47113b6cc6fbffe
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Feb 18 14:35:06 2008 +0800

    Fix Lenovo X60 TV quirk
    
    Z61 has same subsys ids with X60, but does have one S-video
    TV out. Use DMI info instead to quirk TV on X60, X60s.

commit d5e564c5f24b0d9320bc4908693d37e7e6d68bc6
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Feb 18 14:32:32 2008 +0800

    Add DMI info for i830 quirks
    
    Linux kernel has CONFIG_DMIID to export dmi info
    through sysfs.

commit 4a42b01f5ee5a673716d6959dfe0e693b037eb48
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Feb 16 18:16:12 2008 -0800

    Decode DSPCLK_GATE, dump PIPE*STAT, MI_MODE, MI_DISPLAY_POWER_DOWN, MI_ARB_STATE, MI_RDRET_STATE, ECOSKPD

commit 663313559873208c00c3d3748b99d837949ecdf2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Feb 15 13:20:22 2008 +0800

    Bug #14440: fix stolen mem size mask on i830M
    
    For i830M stolen mem size mask should always be 0x70.
    Use 0xF0 for later chipsets should be ok, so behavior is
    identical to kernel agp.

commit 8c8ca16120927fc2d3cf8bcd5212a4227a280708
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 8 11:34:04 2008 -0800

    Add a little program to output the stepping information for several chipsets.

commit f5896dcd1f5a964dce024ab8887ac8a79f7093a1
Author: Jesse Barnes <root@nietzche.virtuousgeek.org>
Date:   Thu Feb 7 11:56:28 2008 -0800

    Add CACHE_MODE_0 register to dump output

commit d59eaa8b1e6eeb9775c9d21c7a5fd28f25b2bc3a
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Feb 6 09:35:43 2008 -0800

    Only disable FBC if registers are available
    
    The call to disable FBC should only occur if the FBC feature is actually
    present or we may end up hanging on a read from a non-existent register.

commit 83a071e2c01eb71462273f25d86d77159ac51114
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Feb 5 17:09:19 2008 -0800

    Fix build warnings on 64 bit
    
    Use PRIx32 for printing CARD32 types, and PRIx64 for portably printing uint64_t
    types.  Requires the addition of a new include, inttypes.h, to work.  Hope C99
    is ok with everybody...

commit abf4b0cafa038e97bd7a6e5ba107b822117b9ccc
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Feb 5 13:30:51 2008 -0800

    Only enable FBC if one pipe is active
    
    Some chips can't support FBC if multiple pipes are active.  So if more than one
    pipe is on or we're going from one->two pipes enabled, make sure FBC is
    disabled.
    
    Intended to fix 13418, 13326, 13152.

commit f79a585d57c61fbe9af5684a336918e1fe3e8416
Author: liuhong <liuhong@devlinux-hong.sh.intel.com>
Date:   Tue Feb 5 11:04:34 2008 +0800

    xf86-video-intel: fix ivch using wrong dvo register
    
    We use the wrong DVO output register for ivch which is used for DVO LVDS.
    Vbios enables DVOB and driver never touches it, so everything seems
    working correctly now.

commit cabed67b6a0e4dd408eeb8d2083269100a65933c
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Feb 5 11:36:24 2008 -0800

    Program FBC fence offset register
    
    Just a partial fix for some of the FBC issues people have been seeing.  The
    other half is to disable FBC if both pipes are running.

commit 332587081fb05d284864aabe608dd9988eee3d44
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Feb 5 10:34:55 2008 +0800

    Fix last commit on i8xx debug p2 value

commit 2d18a299cf39f2ecf9bd3ba8407f892566b2edcc
Author: Hong Liu <hong.liu@intel.com>
Date:   Tue Feb 5 09:10:48 2008 +0800

    Fix PLL reference clk debug dump

commit 9536515d7717969795edc1b80d6e6a36820dd575
Author: Hong Liu <hong.liu@intel.com>
Date:   Tue Feb 5 09:06:14 2008 +0800

    Allow non-strict free order for bo_list

commit 11de831cb706025c003e98fef6d666d273192bcd
Author: Hong Liu <hong.liu@intel.com>
Date:   Tue Feb 5 08:58:44 2008 +0800

    Bug 10584: Mac Mini EDID data assigned to TMDS output
    
    EDID data for TMDS output got from crt should be applied
    to TMDS output on mac mini.

commit 95327571134d8ebb9d936d80b70c2f642393aa9f
Author: Hong Liu <hong.liu@intel.com>
Date:   Mon Feb 4 17:14:23 2008 +0800

    Bug 10773: fix i8xx pll p2 value in i830_crtc_clock_get()
    
    Also fix debug dump, slightly modified to use macro instead.

commit be1b568bc2379856c3eaaed365002512bebc218c
Author: Paulo Cesar Pereira de Andrade <pcpa@mandriva.com>
Date:   Thu Jan 31 22:47:18 2008 -0200

    Make sure symbols used by other modules are public.
    
    These symbols must be explicitly exported, otherwise if compiled with
    hidden symbols, LoaderSymbol (and dlopen) will fail to find them.

commit cc1031a834b81aa6f835c282ad86deddabe229a0
Author: Mark Kettenis <mark.kettenis@xs4all.nl>
Date:   Thu Jan 31 21:02:48 2008 -0800

    Bug #14246: Fix biuld on OpenBSD.

commit b1e1c7cd993ab4f1935d750eb8852e74be757e53
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 30 23:01:04 2008 -0800

    Add detail on different units to intel_idle.

commit aa3ac79759581b5eb05293a8cbcf89eb5b76712c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jan 31 18:26:46 2008 +0800

    Don't crash if SW cursor
    
    In case of device option or hw cursor allocation fails.

commit 2e43bec8731ba1b172f7a0bf867bbb5c1adbda2d
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Wed Jan 30 18:59:12 2008 +0800

    Frame buffer compression support on new chipset

commit bf629466a46c4037ec7b7cc5ee16be947618bd68
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 30 18:55:20 2008 +0800

    hardware status page initialization rework
    
    Order hardware status page setup more reasonable after
    all memory bound, in case new chipset requires non-stolen
    page and that could be bound then.
    
    Also clean up drm irq handler install function, and put
    first install in starting stage later than status page setup,
    so we won't make device cry for uninitialized status page.

commit 04032dad28baab80131edbe8fe58aade8149bb71
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 30 18:52:32 2008 +0800

    Wrap up chipsets which needs graphics address for status page
    
    Also add support on new chipset.

commit b9c3fa79d9fd48c34536f92e6c1c70fe3a619410
Author: Keith Packard <keithp@keithp.com>
Date:   Fri Jan 11 15:51:00 2008 -0800

    Add intel_idle to measure GPU load ratio.
    
    Samples GPU idle register to detect when the GPU is busy; prints out the
    number of busy samples per 100 total samples once per second.

commit 5d9e67aec3ce458d22b7febd3819542abb360534
Author: Erik Andren <erik.andren@gmail.com>
Date:   Fri Jan 25 11:06:01 2008 +0800

    Clevo M720R has no TV-out

commit 6bf53eb48f40ad0c8ea9679ee634447410821b4f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Jan 25 16:59:13 2008 +0800

    Set vtSema before EnterVT
    
    Which was missing in our ScreenInit and initial EnterVT.
    This not only causes failure in initial rotation with TTM,
    as we won't bind in rotate_mem alloc in this case, and hide
    another bug that we call randr12 function in I830LoadPalete
    before we call xf86RandR12Init.

commit 94a18fa1f8141837bdab32e545da7a7aed1cc396
Author: Julien Cristau <jcristau@debian.org>
Date:   Thu Jan 24 15:24:40 2008 +0100

    Don't build reg_dumper if we don't have pciaccess 0.10.0
    
    The pci_device_map_range() function was added in libpciaccess 0.10.0, and
    is used by the reg_dumper tool.  Don't try to build it if we have an older
    libpciaccess.
    Also make sure that util-macros >= 1.1.3 is available when running autoconf,
    because it's required for the PACKAGE_VERSION_* macros.

commit d341e41c863f1212bf2c6b84782a7e472b6612a1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jan 24 10:40:18 2008 +0800

    Clear shadow memory after allocation

commit 88a1041c5361964d37107c22d77feaa1b2160656
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jan 24 10:36:06 2008 +0800

    Fix i830 block handler wrap
    
    which was observed in rotation crash with stack overflow.

commit db0a7c569e383436a2725e1e74f35fb426da1196
Author: Andreas Stawinoga <a.stawinoga@gmx.de>
Date:   Thu Jan 24 08:51:09 2008 +0800

    Samsung Q45 has no TV output

commit f54bba7600647c76fe3bd2d0133edc06dbea6a05
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Jan 22 00:48:23 2008 +0800

    Add missing i830M and 845G pci ids info

commit 633dbd28218fd8a746c1735fd44a14f35bd07faa
Author: Julien Cristau <jcristau@debian.org>
Date:   Thu Jan 17 22:34:21 2008 +0800

    Bug 14032: i810, set default depth to 16
    
    X fails to start without an xorg.conf on i810, because the default depth set by
    the server (32) is not supported by the driver.  I think the driver should
    default to 16 bits (it supports 24, but when I tested it that didn't seem to
    work very well, and dri is disabled at 24 bits depth anyway) instead of letting
    the server use 32 and failing later on.

commit 4fec18e07f2b23306e885d63c74661ae0e4b04d9
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jan 11 10:28:59 2008 -0800

    Turn on backlight when LVDS panel is powered up
    
    In some configurations, the LVDS may be off at startup along with the
    backlight.  So when turning the LVDS on for the first time, we may also need to
    set the backlight to a non-zero value.  So try to use the saved value if
    possible, but if it's zero, make the backlight full brightness when turning on
    the LVDS.
    
    Note that this is slightly sub-optimal for configurations where zero is a valid backlight brightness.
    
    Fixes fdo bz #13958.

commit b5cf8faf8102e6313c23de87a680cc327ac95478
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Jan 10 14:25:18 2008 -0800

    Remove unnecessary quirk code in CRT probing
    
    Since we return early in the CRTC DPMS code, keeping the pipes & clocks
    enabled, this code is no longer necessary.  As an added bonus, VGA connections
    should be reported correctly even when the pipe A quirk is active.
    
    Updates fix for fdo bz #11432.

commit 3c22ed633be2ac96eea7bc533839e956f1f31b84
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Jan 9 09:47:38 2008 -0800

    Add pipe A force enable quirk
    
    On some platforms, the firmware may read & write GPU registers on lid close,
    suspend/resume time or during various SMM events.  If one of the graphics pipes
    is disabled at that time, the GPU may hang due to the programming dependencies
    of the various registers.
    
    This patch adds a quirk to force the driver to keep pipe A enabled if
    necessary, through user configuration in xorg.conf or via a platform specific
    quirk.  Leaving the pipe enabled comes at a power cost however, so the quirk
    should only be enabled when strictly necessary.
    
    Fixes https://bugs.freedesktop.org/show_bug.cgi?id=11432.

commit d3b41bcf231a6ffd289c128c06aa619f554a776c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 9 21:28:25 2008 +0800

    Disable frame buffer compression on new chipset now.

commit 2f0c0427dc4113bac64cda07c6365df1f0637697
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 9 21:27:42 2008 +0800

    Update PIPELINE_SELECT instruction and surface state format for new chipset

commit 139e9affdd49dcbe08e260a0a2bd001de16566e6
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 9 21:26:57 2008 +0800

    GTT access change for new integrated graphics device

commit 4f288ff2d1e7d28bf49167f073fbce21492a7c32
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 9 21:25:47 2008 +0800

    Add new integrated graphics chipset ids

commit f089942689df622b1af00569eade4883a84eb7a3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Jan 3 11:28:18 2008 +0800

    Change origin i965G_1 to chipset market name G35.

commit 71143200ed66cb9dcc1f9edf98128be80b05619c
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Jan 4 15:01:25 2008 -0800

    Don't modify low bit of BLC_PWM_CTL when using combo backlight control
    
    On some platforms, the low bit of BLC_PWM_CTL is wired as a 'max brightness'
    flag, rather than a regular part of the backlight duty cycle.  So when in the
    combo mode, divide the total number of backlight levels available by two
    (tossing one bit) and adjust the programming in the set_brightness routine.
    
    Note that platforms with this behavior may need quirks added so that they work
    by default.

commit b434bf4029d1a405216454629bcea717c779ae5a
Author: hulifox008 <hulifox008@163.com>
Date:   Fri Jan 4 02:46:54 2008 -0800

    Fix copy'n'paste-o in unused airlied i2c code.

commit f2ffc0f6e038357dda268363e52c11ada1d0b810
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Jan 3 11:16:15 2008 -0800

    Fix compilation error when not using DRI
    
    This patch complements 88f8b688e2316ae4a1f7485f0010ce90de54783a which
    added uint64_t typed variables to avoid unsigned long overflows in
    32-bit architectures but didn't include <stdint.h> with the required
    definition.
    
    When XF86DRI and _XF86DRI_SERVER_ are defined this header gets
    indirectly included through "i830_dri.h", thanks to "i830_common.h"
    which masquerades this problem as released in 2.1.0 and that manifests
    with :
    
    In file included from i810_driver.c:88:
    i830.h:137: error: expected specifier-qualifier-list before 'uint64_t'
    i830.h:240: error: expected specifier-qualifier-list before 'uint64_t'
    
    Patch from Carlo Marcelo Arenas Belon <carenas@sajinet.com.pe>

commit a03aca101d4d51ed2279a99d1137ce3b7ef364e2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 2 14:11:31 2008 +0800

    xvmc: setup driver info for XvMCGetDRInfo request
    
    User don't need to have XvMCConfig file then, if ld.so can
    find libIntelXvMC.so in ld path.

commit 0fd769b5882058e5ebf17ee1c1e35b4a3d46e6b0
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Jan 2 13:57:23 2008 +0800

    xvmc: add context id info in debug/trace

commit 83d304c61ad5fdc58b0a9309dbd1e5a3f6cd9b01
Author: Nanhai Zou <nanhai.zou@intel.com>
Date:   Wed Jan 2 10:50:44 2008 +0800

    TV: fix 576p refresh rate

commit a2bb2afd24c95e056b801c85dc12daeac54b37f0
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Dec 28 15:52:12 2007 +0800

    xvmc: move drmOpen earlier
    
    remove wrong comments

commit 96246c27cb836bae8ee02c46c68a1f2102efd14b
Author: Joakim <elupus@ecce.se>
Date:   Thu Dec 27 17:09:02 2007 +0800

    Aopen Minipc 965GM LVDS quirk

commit 666e01bd426a553f23eeb5040ecbc28b4abb87da
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 26 09:51:09 2007 +0800

    xvmc: add info in intel.man

commit e75d0c20e3b02f649b62ac9da7f41bb43d0f3d80
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 26 09:37:34 2007 +0800

    xvmc: make XvMC default on

commit ed9ff6f30fff33fe2d60715f1b503047f8e1ef01
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Dec 25 08:32:47 2007 +0800

    xvmc: consolidate put surface interfaces
    
    Make surface list track like context list, and move
    generic PutSurface code out of i915. So MC driver just
    needs to fill specific the command params, and we can
    get one single type of intel xvmc command to issue,
    ddx driver's put_image_size got removed.
    
    Fix last commit with missing XvMCContext assignment.
    
    Fix priv_data free with apropriate X11 XFree.

commit f0ced5edaeec3e7741828eab728417843326d56f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 24 10:53:57 2007 +0800

    xvmc: store XvMCContext pointer instead of context_id in internal ctx list

commit 216ad7398742f2f80b5477e89f827acb351b4d72
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 20 13:39:32 2007 +0800

    xvmc: add disable xvmc build support
    
    Move xvmc source files under XVMC config

commit a811ca30659e8c477027ea9c91fb9fc516fdabc7
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 20 13:08:07 2007 +0800

    xvmc: handle surface create/destory in generic code

commit 5f961f28310a1cd19967df2034b0452bf4446394
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Dec 20 12:51:06 2007 +0800

    xvmc: move dri context handling to generic code
    
    Use XvMCContext's context_id for dri context handling instead
    of driver private id. Remove unnecessary field for i915 private
    structs.

commit 73827e78357ab3f30a21f159ecdfb26dd0ea889b
Merge: 3cf8627 f69b48f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Dec 19 22:47:02 2007 +0800

    Merge branch 'master' into xvmc

commit f69b48fe24ef94dac44b8123884ca71df675be4b
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Dec 18 18:10:33 2007 -0800

    Unconditionally restore pipe configuration
    
    This is a partial fix for #13196, which covers both leaving pipes disabled at
    server exit time and problems with restoring the pipe configuration on certain
    chipsets.  It restores the pipe configuration unconditionally (previously we
    made sure the PLL was running and we weren't in VGA mode) but also adds some
    additional PLL settle time to the PLL register write paths.

commit 4757a218d733af12d04674455fc6e1fad48a1cd0
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Dec 18 19:37:46 2007 +0100

    Always set pPriv->buf to NULL after freeing the memory it pointed to.
    
    Fixes https://bugs.freedesktop.org/show_bug.cgi?id=13108 .

commit 5cbb4110116f6d4187fd27660a78203caa1da46b
Author: Adam Jackson <ajax@redhat.com>
Date:   Thu Dec 13 15:10:43 2007 -0500

    i830_sdvo_mode_valid: Fix return values to match what we actually check.

commit e03bc385e924222d3d5f3c9a8d65e1ef63b858dc
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Dec 11 13:28:01 2007 -0800

    Add cscope files to .gitignore

commit e720ae4476c3f986f623ce0f0ab9775b8b9b7e05
Author: Jesse Barnes <jbarnes@jbarnes-mobile.amr.corp.intel.com>
Date:   Mon Dec 10 13:00:14 2007 -0800

    CRT hotplug detection improvements
    
    Patch from Hong Liu.
    
    Fixup CRT detection by making sure the pipe is enabled before CRT
    detection actually occurs.  Fixes bugs Hong was seeing on G35 and other
    machines.

commit d9df93578b74785c08ba860b4c9aa23b0c89c91c
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Dec 10 16:41:24 2007 +1000

    ivch: fails on address mismatch as I seem to get this on my 865 system

commit cd6f83519c69f72f146fea59afbd6a3542da783a
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Dec 10 05:49:58 2007 +0800

    Fix tv quirk for Dell Latitude X1
    
    which is actually 915GM, reported by
    Andreas Schildbach <andreas@schildbach.de>

commit 13ec9c8141a9f794258869a04a6bab59dac5eefa
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sun Dec 9 00:52:13 2007 +0800

    exa: fix rendering issue on some 855GM laptops
    
    This trys to initialize more 3d states on i830 like mesa
    code, which fixes exa rendering failure for some 855GM users.

commit e2d9fd6425584119f28768d85c4b7d106ecf8742
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Dec 7 16:30:46 2007 -0800

    Describe output properties in more detail
    
    Add descriptions for LVDS and TV output properties and also mention the EDID
    property a new output configuration section.

commit 6f92200db39a790c95c1fac64baf0bd41a70e481
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Dec 5 08:10:17 2007 -0800

    Fix backlight setting save/restore
    
    We need to save the current backlight value at LVDS init time, as well as when
    we change the DPMS setting.  Also, since 0 is a valid backlight value, don't
    set the backlight value to maximum at startup if the value happens to be zero.
    
    These fixes should make the backlight user experience much more consistent and
    hopefully less frustrating.

commit 4c1fa5235555c9ef3de1eebd006c4e91283362bf
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Dec 4 18:27:24 2007 -0800

    Add BCM_ to backlight control method enums
    
    Avoids polluting the global namespace with such generic terms.

commit 30d74f1b1f30e751d2c47aa63a4a2043e71467dc
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Dec 4 18:23:44 2007 -0800

    Use "LEGACY" backlight method if backlight control is such
    
    This may regress the user experience a bit (fewer backlight levels) on machines
    where both the LBB and native registers work, but it's better that it work for
    everyone than work extra well for some and not at all for others.

commit 0e554e6dd4da56be24d2f971ff4cd4d585936724
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 4 10:32:45 2007 -0800

    Remove extra have_libpciaccess=no that broke tools build with old servers.

commit 3cf862717688aa679b5e667cd041ddd6f5db0b58
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 29 23:12:16 2007 +0800

    xvmc: add "XvMC" option, default is false.

commit 6da4b7a80cdf730018435fe84485ecdad62bc860
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 29 22:56:13 2007 +0800

    xvmc: move batch buffer init/fini code into generic

commit 75ef3e669dac1259d282dcc8f54b197fc19f22b3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Nov 28 22:13:55 2007 +0800

    Replace ALLOCATE_LOCAL/DEALLOCATE_LOCAL with xalloc/xfree

commit df47b7ba57f3e7dc8bac1898679186d9d48639ac
Merge: df718a7 7f9ceff
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Nov 27 01:13:43 2007 +0800

    Merge branch 'master' into xvmc

commit 7f9cefffbf44a2d07b51cc13aaf2d54fcd8f2f22
Author: Alan Hourihane <alanh@tungstengraphics.com>
Date:   Fri Nov 16 15:56:08 2007 +0000

    vendor is CARD8

commit df718a77c854c9110a81c2bc2a32a9aac85850f2
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 16 16:08:06 2007 +0800

    xvmc: add xvmc decoder type string

commit a03a758db0df615fbb44dae1ab6910bfeaeb54f9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 16 15:49:10 2007 +0800

    xvmc: move some i915 context destroy code to generic function

commit 7bfbcb4dc7806ae7543f230373e67f35ba30668d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 16 15:43:04 2007 +0800

    xvmc: clean batch buffer finish

commit a6e8f4ef0481c66fda4f22fcc4bb0ef9c000f0cd
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 16 13:51:44 2007 +0800

    xvmc: remove i915 drm map type

commit 4a2b0f340357c4ca58dc9586fad1337b83966362
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 15 18:36:54 2007 -0800

    Fix typo in 1920x1080 resolution entry

commit 6c68fcc93917565712b6a9386df54d0204e4ea8f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 16 10:04:46 2007 +0800

    xvmc: more i915 xvmc cleanups

commit 04b60b6d3436fb57163c23acf335364f0ea2f79c
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 15 11:49:53 2007 -0800

    Bump version to 2.2.0

commit 6eecef4fed8a21dfdabef42eb69fd150b96167b2
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 15 10:10:59 2007 -0800

    Adjust default TV out paramaters
    
    According to several users, a default brightness of 0 results in much better TV
    output.  Improved control of these parameters will be provided by Randr1.3,
    which will standardize several output properties across various chips.

commit 7552d80e367fe38bbc594fe94abd649917fe54d5
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 15 10:07:34 2007 -0800

    Add 1920x1080 mode to TV out
    
    Allows users to use 1080p modes on TV out, see bug #13034.

commit e56c166ceb8c1ceddd5020e8de2d0b9d51f535a4
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 18:34:18 2007 +0800

    remove unnecessary i830_reg.h includes
    
    i830_reg.h only contains 3d engine cmds for 8XX chips.

commit 6f3de19159cd7a2d73ed212add909edb3aedce9c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 18:33:27 2007 +0800

    Move fb compression reg definition into i810_reg.h
    
    where we put MMIO control reg in, and shared with intel_reg_dump
    program.

commit 1ff97991a4954d508cc260dda82b7678010d13c9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 17:01:31 2007 +0800

    xvmc: intel_xvmc.c cleanups

commit 1cfdf192882b856bfc93b735cfb9cb813cac3fdb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 16:38:21 2007 +0800

    xvmc: remove unused SAREAPTR macro

commit d9ea2fbdcce3c7c91428846eff43b65ac340f38d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 15:25:35 2007 +0800

    xvmc: i915 rename files

commit 06c0579df8d45f7f04b96956353d5f86cf59148f
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 15:01:56 2007 +0800

    xvmc: some code clean up

commit 4983e3401390654098dbf99dcfb45bab060b068c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 13:56:24 2007 +0800

    xvmc: move locking code into generic place

commit bcd656c8dfe7309a5cf02ce1da8bc747ccd6e21c
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 11:18:38 2007 +0800

    xvmc: oops, should first map batch buffer before init

commit 0464af581b0fcfc4d1c7fec8160d812262086177
Merge: 2256519 e56c166
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 11:05:44 2007 +0800

    Merge branch 'master' into xvmc

commit 22565198b360826ba10e7ca05d272c419054dc08
Merge: 619044b e64f492
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 18:53:22 2007 +0800

    Merge branch 'master' into xvmc

commit e64f4929690a57701241334fbca17e95b39ba3d4
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Wed Nov 14 16:44:34 2007 -0800

    Backlight fixes
    
    Open the "actual_brightness" file as read only, since we only read from it.
    Also set an initial backlight_duty_cycle at init time so we don't set the
    brightness to 0 at startup.

commit 53e3693ef13f31f3fc33bcff7286ab2b03b2d430
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 16:24:56 2007 -0800

    Disable FBC by default on 965GM
    
    Several people have reported that they see frequent FBC related display
    corruption on 965GM, so disable it for now.  Users wanting to enable it can use
    the driver option "Framebuffercompression" to override the default.

commit b2726899bc6ebd108aa4a5dd66fe1d881bb778b3
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 15:49:41 2007 -0800

    Add more FBC regs
    
    Needed for the new debug code

commit b7bc694c6b98dac17763426d905a22d3ae17a018
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 15:46:57 2007 -0800

    Fix kernel get_brightness function
    
    We need to look at "actual_brightness" rather than "brightness".  The former
    contains the brightness value the kernel driver has actually set, while the
    latter is merely what the user requested.

commit 9ee96ed02aacd953ab58288fddf0fa60f60b668e
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 15:44:56 2007 -0800

    Correct FBC debug message
    
    To be consistent, it should say 'plane' rather than 'pipe'.

commit 675b9471d84059496ca41d427a4f95d419f82be9
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 15:17:05 2007 -0800

    Add FBC registers to register dump output
    
    Just for completeness.

commit a2a0821e74a61f53cc7f0c41ce629644ad712114
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Wed Nov 14 11:30:20 2007 -0800

    Don't stop ring before restoring hw state
    
    Some of the hw state restoration callbacks may want to use the ring for various
    things like stopping video playback, so leave the ring enabled until we get
    back from RestoreHWState.  Also rename the functions so that their purpose is
    clearer and remove a couple of redundant lines.

commit 619044b242d4abf605b42cfff538b63f445fe709
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 02:23:07 2007 +0800

    xvmc: move batch buffer init/fini to intel_batchbuffer.c

commit ae805ac379ccfdae9ee272896665e73f5bc7d2cf
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 15 02:13:07 2007 +0800

    xvmc: take out batch buffer handling code

commit ad3bc0158d37e98fcbbe6a8e31413c142a260424
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Nov 14 22:46:46 2007 +0800

    Don't enable fbc with XAA or tiling is off.
    
    This slightly reworks my last fbc patch. We don't
    support tiled front buffer with XAA now, so also
    disable fbc on it. If tiled alloc failed, disable
    fbc too.

commit 26194e19e1c80615697016e25640d4c8c244353f
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Tue Nov 13 22:26:40 2007 -0800

    Review PLL spreadsheet and update register ranges.
    
    The PLL spreadsheet makes the precise register ranges allowed for each mode
    quite clear, and shows a few inaccuracies in the b-spec. In particular, the
    N register value may range from 1 to 6 instead of 3 to 8. This should close
    the gap we've seen in the reachable frequencies.

commit 581509321e51becb8ee6ddcfaa15a2a713c9ef8e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Nov 14 22:16:04 2007 +0800

    Remove one redundant line.

commit 8cea3c8cfa86600b5f2c3e1f21c19d4b2a320fd4
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Nov 14 22:13:30 2007 +0800

    Don't setup fb compression if fb is not tiling

commit 539b669d6e23833a917a9b0d3a355d4283e0b76a
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Tue Nov 13 17:59:54 2007 -0800

    Remove harmless error message
    
    This really isn't an error in general.  If vblank pipe setup really fails for
    some reason, it'll be obvious enough when the user tries to use vblank events
    for something.
    
    Patch from Hong Liu.

commit e8db8584ae4860aa991c916126335b287a972d5b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Nov 14 00:11:20 2007 +0800

    xvmc: attempt to move batch buffer code out of i915 private

commit 11c0e0dbef42f1ae77a77d534870d3e9821fb017
Merge: c838f72 43fbc54
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Nov 13 22:44:06 2007 +0800

    Merge branch 'master' into xvmc

commit 43fbc547786cf26514f95bce79fab58a66c291bf
Author: Jesse Barnes <jbarnes@jbarnes-mobile.amr.corp.intel.com>
Date:   Mon Nov 12 12:23:41 2007 -0800

    Improve backlight control
    
    This commit fixes backlight support for several platforms.
    
    Except on recent machines supporting the IGD OpRegion specification,
    backlight control is rather platform specific.  In some cases, we can
    program the native backlight control regsiters directly without any
    trouble.  On others, we need to use the legacy backlight control
    register.  On still others, we need a combination of the two.  And on
    some platforms, none of the above will work, so we go through the
    kernel backlight interface, which provides a platform specific driver
    for backlight control.

commit 10988c5e6ec0f3c40d56bbf209b7976627cca706
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Mon Nov 12 09:19:22 2007 -0800

    Fix typo in PLL enable check
    
    Check against DPLL_A instead of DPLL_B before writing PIPEACONF.
    
    Thanks to Colin Guthrie for his sharp eyes.

commit ab2055ebb20aa6de121fa377e488ce91913035ae
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Fri Nov 9 13:55:46 2007 -0800

    Add 'ret' variable to i830_allocator_init
    
    Needed in the XF86DRI_MM case.

commit 24280edbdf54e9559b26ea27c1b005eea73f51bc
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Fri Nov 9 13:53:58 2007 -0800

    Fixup warnings
    
    Remove unused 'ret' variable, move pI830 under #ifdef XF86DRI_MM in
    i830_allocate_memory.

commit 4fe507957bf826d81a71cd63af17c5547d1023a1
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Fri Nov 9 13:51:11 2007 -0800

    Remove unused 'palette_enable' variable

commit 62404a9c9c0d98efb69ac96209dea17331e0489c
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Fri Nov 9 07:55:01 2007 -0800

    Update man page to reflect EXA by default

commit c838f7297f675ea9d82678ed37715955cb0a8a78
Merge: a9449ff 6f53568
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 9 19:37:07 2007 +0800

    Merge branch 'xvmc' of git+ssh://zhen@people.freedesktop.org/~zhen/xf86-video-intel into xvmc

commit a9449fff4be8e6b3cc82914376420e3a66b960f5
Merge: a470f6b 177924e
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Nov 9 19:36:25 2007 +0800

    Merge branch 'master' into xvmc

commit 177924e879564b7e9e70fd607141978bfd053fff
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Nov 8 18:16:48 2007 -0800

    Bump driver version to 2.1.99 in preparation for 2.2 release

commit cb4e5796f0537ea5e0e646d473930c7b826c85d8
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Nov 8 18:13:47 2007 -0800

    Default to EXA
    
    If EXA is compiled into the driver, default to using it for acceleration.
    Hopefully we can remove XAA entirely one day.

commit 43a59ab26b09fcc24de1ed7bd770bb622f899ceb
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 8 16:52:41 2007 -0800

    Clear current video crtc on DPMS off
    
    When calling the video DPMS off function, make sure we zero out the current
    crtc so that it will be properly re-set up next time video is turned on.
    
    Fix from Peter Clifton with changes by Keith Packard.

commit e784e152a8e84b6e447b55a5c7019e7b47e17621
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 8 16:37:53 2007 -0800

    Fix overlay destination clamping
    
    The overlay width & height scaling clamp check was reversed.  Fix that and
    update the comment.

commit b8770f710729d616b3ac72544aa522161a78f819
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 8 16:19:01 2007 -0800

    Setup 3D state at EnterVT time
    
    In the absence of full suspend/resume support in the kernel, we have to
    save/restore state in Enter/LeaveVT.  For 8xx chips, 3D state may be lost
    during suspend/resume, so re-emit the basic setup at EnterVT time.
    
    Patch from Peter Clifton.

commit 5f92b4c2db9712496b829ee239468e3d14e27d2f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 8 13:31:51 2007 -0800

    Bug #12059: Add ch7019 to the list of supported devices for ch7017.
    
    While I'm here, fix the chip description to be LVDS instead of TMDS in i2c
    device.

commit eecd3ccedee6c4acf101591f7e60673660379e62
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Thu Nov 8 09:31:08 2007 -0800

    Check DPLL status before writing PIPEnCONF regs
    
    If the DPLL isn't enabled or is in VGA mode, writing the PIPEnCONF registers
    may cause a hang or crash.  So ensure the DPLL is in the proper state before
    writing them.
    
    Another excellent fix from Peter Clifton.

commit b434c1a437c407de88396b219560649c2dae82b2
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Thu Nov 1 12:06:07 2007 -0700

    Framebuffer compression fix: front buffer may not be at fence 0
    
    Fix a long standing bug in the framebuffer compression code (thanks to
    Pierre Willenbrock!) that prevented FBC from working correctly if the front
    buffer was anywhere but fence register 0.

commit 50d3693a6862028e50bc5ba8c788e7ea573c3eb8
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Nov 1 22:22:27 2007 +0800

    Fix allocation reset for really not free BO allocator

commit ecd995d533d28b622afc71a20504d47c33ff5b8d
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Tue Oct 30 18:20:49 2007 -0700

    Fix builds without DRI

commit 7c88b58a93fce9fda59b6344acb87af16336e287
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Tue Oct 30 18:20:15 2007 -0700

    Clear compiler error: "void functions cannot return values"

commit a470f6b2ca291e305979dd9223885a50dc0b334b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Oct 26 22:40:47 2007 +0800

    try to move some fields to xvmc driver structure
    
    Still a lot of things to move include batch buffer, lock, context,
    surface resource handling, etc.

commit 6f53568cd2aeeec6bd8c1f1d9f9c5ecadc5c62f9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Oct 26 14:58:43 2007 +0800

    Fix DRI context creation for XvMC

commit d2c78f82c20f33fc9c22cab8a7ca161e57a34bf8
Author: Thomas Hellstrom <thomas-at-tungstengraphics-dot-com>
Date:   Wed Oct 24 19:34:12 2007 +0200

    Adapt to DRM Lockfree and setStatus changes.

commit 78aaec0ffc711742bf8ad77757ed8c15cc3f7a9f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 24 11:50:54 2007 -0700

    Fix typo in my hand-application of rglowery's patch.

commit 021265fbec9fd4ee31bdc9767c0c0453479ea22c
Author: Rob <rglowery@exemail.com.au>
Date:   Wed Oct 24 11:06:53 2007 -0700

    Fix a crash in TV mode handling by initializing the prev field of modes.

commit ce9802edd25255f6c9c11e512b2ef905384b914d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 24 00:31:53 2007 +0800

    fix xvmc return values
    
    Use values defined by xvmc lib spec

commit 9c84543eb0fde4643eb7529eb6b08eacf57c12d0
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Oct 23 22:16:55 2007 +0800

    add missing license header for new files

commit 87345e820d20f1a98216c52e156c2e18c15ffa44
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Mon Oct 22 14:22:37 2007 -0700

    intel_reg_dumper - dump VGA AR registers too
    
    Add a VGA AR dumping function so we can debug text mode problems too.

commit 90e4eafdf59edd966ed626107c3909b24737da8d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 22 17:09:15 2007 +0800

    revert xvmc memory allocation hacks

commit 167c56bcf82f0a6d72151b202e6d56f6e0d627f6
Merge: fc9368c 78e251d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Oct 23 00:12:22 2007 +0800

    Merge branch 'master' into xvmc

commit fc9368ce7dacd52ef222559d20188ddcf2a85df5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Oct 23 00:09:06 2007 +0800

    split xvmc user lib chipset drivers

commit 78e251db671e21bc859c9b505d391b70babee2dc
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 19 15:04:10 2007 -0700

    In the clock graph, draw the VCO as erasures in the lines representing clocks.
    
    This shows one of the reasons for the gaps: with the other settings, the VCO
    is too low inside the gap.  However, it also points out another issue: we
    aren't using the high end of the VCO range due to some other limits being hit.

commit 9f9b888525b274036d301d6e06351583d0415f9e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 18 11:25:24 2007 -0700

    Warn in the log if we choose a PLL clock that's way out of line.

commit 1f8bf110394cc1df66aae9acf5c818145ae19b52
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 18 11:17:38 2007 -0700

    Add some nickle scripts for looking at PLL issues.
    
    While here, move similar nickle scripts under src/scripts/

commit 79636b8c776ae024518103c9fa137c8498c21d48
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 17 17:10:24 2007 -0700

    Bump pciaccess version requirement for  new API usage.

commit c824c45e72908b5b3fa832fec91c7b47f305180c
Author: Dave Airlie <airlied@optimus.(none)>
Date:   Wed Oct 17 16:35:29 2007 +1000

    intel: make block handler hook happen no matter what video is in use
    
    This shouldn't make a difference now, but for upcoming EXA/batch changes it
    will be more useful

commit aa88d23e615e7f154cf850927a0a7bb9fbb0d2f9
Author: Rob <rglowery@exemail.com.au>
Date:   Wed Oct 17 09:19:19 2007 +0800

    AOpen 965GM mini pc has no LVDS

commit 38900f55e2b50ea383f78adb016e3a02c3bd17ad
Author: Kyle McMartin <kyle@freedesktop.org>
Date:   Tue Oct 16 16:38:28 2007 -0400

    toshiba satellite u300 has no tv out

commit 74ac5de14ebb77aeb39d698e9e8d188c9d9abd76
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Oct 16 15:08:26 2007 +0200

    Adapt to libdrm buffer object API changes.

commit d66e924680a3504aa1feb9c228145a95d1a16b1e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 15 11:31:51 2007 -0700

    In update_front_offset(), set pScrn->fbOffset even at EnterVT during init.
    
    Failure to do so led to the memset() at EnterVT being done to an invalid
    offset.

commit cc892d1ba1d87d08bdd04f857efc6b8f64620018
Merge: b52ce0b fd97edb
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 15 22:09:14 2007 +0800

    Merge branch 'xvmc' of git+ssh://zhen@people.freedesktop.org/~zhen/xf86-video-intel into xvmc

commit c94cdfd6ddbc580523737f596e97b96a7ce100b9
Author: Jesse Barnes <jbarnes@jbarnes-mobile.amr.corp.intel.com>
Date:   Sat Oct 13 15:57:45 2007 -0700

    Fix palette save/restore
    
    When restoring the palette, we weren't checking to make sure the
    associated pipe was enabled before writing the registers.  In some
    configurations, this led to a driver crash.  Add new routines to handle
    palette save/restore and verify that the pipes are on before we touch
    the registers (could easily be changed to enable/disable the pipes
    around the save/restore as well).

commit e04333a6352040bc883655d606923c912d005981
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 12 12:42:45 2007 -0700

    Fix failure in tiling setup on non-power-of-two allocations on pre-965.

commit a1612b7728d4153499fe86b6713a13c8702cc7d9
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 12 12:42:06 2007 -0700

    Use mprotect on unbound AGP memory to attempt to catch use while unbound.
    
    This doesn't help with the most common use-while-unbound cases, which are
    from the hardware side.

commit 3af442ba52550a9d183e215d49cc12dac0cb9e4b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 11 11:56:06 2007 -0700

    Don't double-free the memory manager allocation.

commit 6c485ff5bd25e9aa6a3c1eb669843e6b969d94df
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 15:52:56 2007 -0700

    Update memory manager sizing for the current set of LIFETIME_FIXED bufffers.

commit d47cf148776d74f9035863b23eefdc2b5893af08
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 15:45:51 2007 -0700

    Move tiling fence register setup to bind time instead of allocate time.
    
    This allows us to allocate tiled buffers in buffer objects.  In the process
    I removed the fence division that we had for tiled buffers on pre-965.  If we
    resurrect that code, it should probably be managed by just dividing all the
    objects in roughly half and fencing those halves (to reduce the alignment
    requirement), instead of using giant fences until we run out of space and then
    trying to deal with scarce space on the last (or not) buffer.  Halving
    our tiled objects would use 6/8 of our fence registers on that hardware.

commit a6dc81a0864f9ab2f6fc1aa31002c0191f674ceb
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 12:37:19 2007 -0700

    Allow front/back/depth to move over the lifetime of the server.

commit 132dce7565feeea1055899f8c1627766fe84c88c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 12:12:06 2007 -0700

    Delay SAREA and mapping setup until EnterVT when using the memory manager.
    
    Otherwise, we would use uninitialized offsets in the early setup.

commit 4ca3550fb7d488741f8dc1ba3c8722393277c3b8
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 4 17:02:15 2007 -0700

    Rework DRI buffer mappings and sarea setup to allow for moving buffers.
    
    While this has been a desired feature for some time, to allow for reallocation
    of the front buffer, it was made more necessary by the desire to avoid
    requiring a NO_MOVE buffer type in TTM because buffer objects may not be left
    pinned over VT switch.  This is a step towards making those buffers
    movable and resizable.

commit f393a12d21eed668cf4771f022beded9a4c547c7
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 4 13:03:14 2007 -0700

    Move drmMMLock to after we have unbound our (pinned) buffers.
    
    There are still issues due to the fact that we're allocating
    NEED_LIFETIME_FIXED memory as buffer objects, which we refuse to unpin because
    we have no way of pinning it back in the same location.

commit 8fc4e3078210f726c7c375faa2f2fd8d05017c09
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 11:51:55 2007 -0700

    Refuse to allocate LIFETIME_FIXED objects in buffer objects.
    
    We can't guarantee the offset will stay the same using the current DRM
    interface, but the correct solution is fixing our code to allow these objects
    to move.  Breaks TTM mode of the DRI driver for now.

commit 0de747f7d219a56434dad49a8a6d1d9d4c251ca7
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 11 10:36:01 2007 -0700

    In i830_allocate_memory_bo, bind if we control the VT, not on lifetime-fixed.

commit 0040bb95445e800af80ca9fa1b92f5db33f1b4ac
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 10 16:48:12 2007 -0700

    Fix potential use-after-free in XV overlay code on video stop.

commit 56ae767180da4a8bd4b7a4c35b92e019ab67d753
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Oct 11 10:09:29 2007 +0800

    Revert "Fix G33 GTT stolen mem range"
    
    This reverts commit 2a8592f2ebcba86b1127aa889155d58a3dc186ca.
    
    This causes compat issue between ddx and kernel apggart version.
    Revert it as it shouldn't hurt normal people's default GTT size,
    but if you change it to 1MB in bios, it's supposed to be broken now.

commit 5faee02e97b7543b41bb1f8e3751558c48802833
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Oct 10 13:55:30 2007 +0800

    EXA: fix tiled dest rendering on i8XX chips

commit 5bbe9f09fda1238da04e6b584813d40fc646f49d
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Wed Oct 3 00:18:25 2007 -0700

    Include xf86mm.h if using XF86DRI_MM
    
    This header file doesn't appear to be getting automatically included for
    some reason.

commit 41dacf97ec1d4ba6f54057f4fcc7bb76033a454e
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Wed Oct 3 00:17:41 2007 -0700

    Quirk for Samsung Q35 which has no TV output.

commit b52ce0bd178c268d20334e2be8fad46037e47499
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 8 22:56:44 2007 +0800

    use field name to initialize i915 xvmc driver

commit e0fb228401b10ea4281eee48497bf1d584999705
Merge: 84d7b2b 9e770bf
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 8 22:45:11 2007 +0800

    Merge branch 'master' into xvmc
    
    Conflicts:
    
    	src/i830_driver.c

commit fd97edb62463e50a1860290d54684a68d5490bdc
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 8 16:13:26 2007 +0800

    move some definition out of i915 specific header

commit 3a2b5222341b37322b788e329c2b9006dc14ecfd
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Oct 8 15:46:11 2007 +0800

    Temp work around ttm allocation for xvmc, which should be fixed later.

commit 9e770bf69edaa8944048049e11266dbe1ef145e5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 4 14:31:37 2007 -0700

    Replace setting of LIFETIME_FIXED on cursors with just updating the offsets.

commit c9d6e90c2523096c45d330552f471e6bf1752704
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 4 14:27:07 2007 -0700

    Don't set overlay registers LIFETIME_FIXED. It always uses the current offset.

commit 1cc6bec4628a4ca04a68919a84148a1e6312072f
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 4 14:23:48 2007 -0700

    Revert setting of exa_965_state as LIFETIME_FIXED.
    
    The current offset is used every time in render setup.

commit dfa22df8ce7713b491c4766ce6ce652db91b5f90
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 12:53:07 2007 -0700

    Don't leak buffer object allocations in i830_reset_allocations().

commit 7db9d706a1bc9da7afc4823cee92b23e96ae55b8
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 12:40:48 2007 -0700

    Warning cleanup.

commit bf33c4e2d91172efd08690fadda7b3743dd3de62
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Oct 5 12:40:37 2007 -0700

    Fix formatting of error message.

commit 04e936935f0b0045600241424f1d04a6721a2432
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 17:29:35 2007 -0700

    Bring the CH7017 driver closer to spec.
    
    This is also closer to what my hardware is programmed with, except for some
    very confusing off-by-one bugs in an unexpected direction.

commit 263d48ad93a0fb7100729d0c6e0443797c20c80a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 16:23:30 2007 -0700

    Fix probing of the sample CH7017 device I found by allowing GPIO overrides.
    
    It may be that the LVDS chips need to be DVOA and GPIOB only on mobility
    devices with them, and DVOC/GPIOE on non-mobility like this 845.  But until
    more examples are found, just make this one device probe.

commit 219354af212c7b68c20df689692c55331e36a705
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 16:09:13 2007 -0700

    Restore building of pciaccess-based tools even if the server doesn't use it.

commit 1b83e5e589105d05c1b78032fa47eecee478cb99
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 14:32:28 2007 -0700

    Remove more DVO probing noise.

commit 29d3188ee9676f697f6fcb859c7f680f5df30318
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 13:45:09 2007 -0700

    Suppress I2C failure error messages during DVO device detection.
    
    Otherwise, errors would be printed for every chip probed which wasn't present
    on the system.

commit 6dd8228a386334d05836353672aae9f8c456e435
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 12:07:22 2007 -0700

    Enable CH7017/7018 DVO driver by default.
    
    On hardware containing one of these chips (generally single pipe with an LVDS
    connected), it's probably better to try to enable it and fail in some cases
    than to not probe the output at all.

commit 994ee6721d9f1650ad37e21198b86848352b73af
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 1 12:01:16 2007 -0700

    Disable TV/VGA output on the CH7017/7018 devices.
    
    We don't support those outputs on this chip yet, so turn them off if the BIOS
    had set them on.

commit 0e5574e842eeaac75271ccd50027d3e54c57722d
Author: Regis Prevot <regis@myrix.net>
Date:   Sat Sep 29 16:21:08 2007 +0200

    Ignore detection of TV output on Panasonic CF-Y7

commit 84d7b2b955107264b67526a04028a8b79d8804e3
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sat Sep 29 19:41:15 2007 +0800

    rename xvmc init function names

commit 1845e7c6e9caf7a9ad7f46a8fbfa321ddec69a1e
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Sep 28 10:12:11 2007 -0700

    Go back to using old drm_i915_flip_t field name
    
    This field shouldn't have been renamed in the first place.  Go back to using
    the old name so that the tree is backward and forward compatible again.

commit f3d92ab474de11babe507b0e3c15aca146b6cb66
Author: Kyle McMartin <kyle@freedesktop.org>
Date:   Fri Sep 28 10:17:55 2007 -0400

    Dell XPS 1330 has no TV out

commit bbf69c7446aa9748dacecccfe0b63d803f865b00
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Thu Sep 27 17:37:19 2007 +0800

    Pin cursor, overlay(no physical) and exa state buffers
    
    And cursor mem counting for dri mem manager is not relate
    to overlay.

commit 64188246bb25e95a916ebb8a50a09298e56d91d9
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 15:48:19 2007 +0800

    clean up old i915 xvmc function declare

commit 320b7f08f457455f1d16b4c36d149bdc3f6ceead
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 15:02:33 2007 +0800

    Revert to origin xvmc setup steps
    
    We have to grab xvadaptor's PutImage earlier than
    xv init, otherwise no chance to do that..

commit 1e0ff38f44e3b5a8b4a5d509c7faa266270d522c
Author: Hong Liu <hong.liu@intel.com>
Date:   Thu Sep 20 11:28:52 2007 +0800

    Fix pixmap offset
    
    Use consistent interface for counting pixmap offset.

commit 85e4bd109464a4d90856e17bc960872eeaebc2ad
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 14:32:46 2007 +0800

    Log xvmc driver name

commit e58b76a24a29e0a502650807de81e650e5dc184d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 14:40:04 2007 +0800

    clean up err report
    
    Still need to clean up return value for XvMC API

commit b10a9668dc50d10489b2ae531d89c8ab7c408170
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 14:01:57 2007 +0800

    fix i915 xvmc devPrivate reference

commit f12eaaf385e7a0b85524588a5d865d1cc3f1a0cf
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 13:49:55 2007 +0800

    comment out i965_xvmc_driver for now

commit 513e8a2f8abde1b11b8058e94a650796fd51779b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 26 13:45:42 2007 +0800

    Create xvmc driver interface
    
    convert i915 to new xvmc driver interface

commit ca67fa767dc762dac369e84b27a7ef15673d527c
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Sep 24 11:12:22 2007 -0700

    Remove logic for supporting i915tex_dri.so vs. i915_dri.so.
    
    There can be only one.

commit 130f79613bfe6a8cfa7f431c8cce06cbb93cc91a
Merge: b73235f 1260316
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 21 17:14:44 2007 -0700

    Merge branch 'buffer-objects'
    
    This branch changes i830_memory.c's allocator to use TTM when available to
    allocate memory, which also allows TTM to control almost the entire aperture.
    As a result, our front/back/depth buffers are created as real buffer objects,
    which may be used by the DRI driver instead of the fake buffer type in TTM.
    The updated DRM with bo_set_pin ioctl is required, to allow us to pin and
    unpin our buffers as needed.

commit 126031655c3c1db9881ad17d712461533eb59632
Merge: c343835 bda3c69
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 20 08:57:58 2007 -0700

    Merge remote branch 'origin/master' into buffer-objects
    
    Conflicts:
    
    	src/i830.h
    	src/i830_driver.c

commit b73235f40497cfb10792ba191d4f6eac3a5df009
Author: Hong Liu <hong.liu@intel.com>
Date:   Thu Sep 20 11:28:52 2007 +0800

    Fix pixmap offset
    
    Use consistent interface for counting pixmap offset.

commit 798448e4641acf241b7cbae0d6c243ae383da9f4
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 19 13:29:31 2007 +0800

    Add media state definition on i965
    
    This adds VFE state and interface descriptor struct define.

commit 36b81ba20d20e7b235cb701c5135cbf3f3eedb12
Merge: 02ad9ce bda3c69
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 19 11:44:41 2007 +0800

    Merge branch 'master' into xvmc-i915
    
    Conflicts:
    
    	src/i830.h
    	src/i830_memory.c

commit bda3c69a7a044869ea63514b97f8aa9260d6b5a7
Author: Dmitry Babrovich <dmitry.babrovich@densitrongaming.com>
Date:   Tue Sep 18 09:34:34 2007 -0700

    Bug #12457: Let the ch7xxx driver probe the 7301
    
    Looking at the 7304, this chipset likely requires slightly different
    programming.  However, this change allows for at least some functionality.

commit 445a59d262b93bd9d2c16cee9934ce77a103776b
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Wed Sep 12 09:32:41 2007 -0700

    Remove unused plane->pipe mappings from SAREA private
    
    Turns out we can get away without this, so remove it, fix a crash, and only
    swap planes/pipes if the DRM can support it.

commit d02336290bea30de3c390b8121046c38fd6b0f62
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Tue Sep 11 04:28:14 2007 -0700

    Fix plane/pipe mapping compat code
    
    Move plane->pipe mapping adjustment to ScreenInit so we can check
    against the DRM driver version accurately.

commit d9f2b3c0d2d08a4b7fad865dab7deb6224b57999
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Mon Sep 10 23:49:34 2007 -0700

    Fix crash in ScreenInit
    
    Use pScreen directly when getting at the SAREA private, since
    pScrn->pScreen may not be initialized yet.

commit 4c7542ef43a5267e470ca1608a2ae57abf9783ec
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Mon Sep 10 23:30:50 2007 -0700

    Only swap planes and pipes if DRM supports it
    
    We want to associate plane A with pipe B on pre-965 mobile chips, since that's
    the only way to get framebuffer compression on the builtin LVDS on those
    platforms.  However, if we do this swapping and DRM isn't aware of it, we may
    end up requesting vblank events for the wrong pipe, or setting up SAREA buffer
    swap state incorrectly.
    
    This mod checks whether DRM supports the new plane->pipe swapping behavior, and
    only enables the swapping if so.  This should fix the bugs Lukas found and
    debugged.  Reviewed by Michel Danzer.

commit 286f5df0b62f571cbb4dbf120679d3af029b8775
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Thu Sep 6 14:31:55 2007 -0700

    Switch to pci_device_map_range/pci_device_unmap_range APIs.
    
    With the libpciaccess change that added these new APIs, use them
    for all mapping.

commit 2a8592f2ebcba86b1127aa889155d58a3dc186ca
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Sep 5 14:52:56 2007 +0800

    Fix G33 GTT stolen mem range
    
    G33 GTT table lives in seperate stolen mem with
    graphics data stolen mem.

commit 7fd9a98178cdebda4213796fdc452a8a265a1197
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Tue Aug 28 16:00:01 2007 -0700

    Don't set supported TV formats until after RandR initialized.
    
    The TV format property cannot be configured until RandR has been
    initialized.

commit c6e637cd683dc60567b3b4f69b7f2b4c338c89ea
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Tue Aug 28 12:17:15 2007 -0700

    Limit TV formats to those supported by current connection

commit ddd6053987b9ca9bd3722ddbdfd412a3d8d252cf
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Tue Aug 28 12:30:46 2007 -0700

    Add register defines for hw binning

commit 3fbbd0afde49c53a5a8661f75c8c8c4be3020c30
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Aug 28 17:48:20 2007 +0200

    Fix build against pre-pci-rework xserver.

commit 0fdbf64b34e4114c2b89d696b268b9c7464f1efd
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 28 21:56:21 2007 +0800

    Fix i915 a8 color buffer blending
    
    From spec, i915 engine uses green channel when reading from 8bit
    color buffer for blending, and also writes back green channel.
    Fix blend factor in dest alpha case by using dest color instead.
    Now rendercheck can pass a8 tests.

commit 3411eb0dbae470b910af3116a4ab960c821b9b20
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 23:09:01 2007 -0700

    i830_driver.c changes for libpciaccess.
    
    Change to use libpciaccess APIs, including computing and using BAR indices
    for various mapping activities.

commit 387fed6daa7426e4a85d30ba7cf608b5f41d24bb
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 23:06:57 2007 -0700

    i810_driver.c changes for libpciaccess.
    
    This includes new probe code (intel_pci_probe) and changes for i810 to
    use BAR indices to refer to suitable portions of the device mappings.

commit 2c794192052ca55c3263e27e13d16aafe8caa92c
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 22:46:19 2007 -0700

    Mechanical API conversions for libpciaccess.
    
    Uncomplicated API transistions for libpciaccess usage:
    
    	Legacy xf86 API		libpciaccess API
    	---------------		----------------
    	xf86ReadPciBIOS 	pci_device_read_rom
    	pciReadWord 		pci_device_cfg_read_u16
    	pciWriteByte 		pci_device_cfg_write_u8
    
    And, more use of the API-independent DEVICE_ID/SUBVENDOR_ID/SUBSYS_ID macros
    to pull PCI identification data from the underlying structure.

commit 70e8e5957200401474967a467663ae049e9080f2
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 22:40:25 2007 -0700

    Change DRI interface to fill in PCI data from new libpciaccess structure.
    
    The DRI interface requires bus identification for each DRI object; pull that
    data from the libpciaccess structures as necessary.

commit 5516cc781bd488c936af225123812a61ed5874b8
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 22:37:38 2007 -0700

    Add libpciaccess declarations to I810Rec and I830Rec.
    
    Using libpciaccess requires a different type for PciInfo (struct pci_device
    instead of pciVideoPtr) and it requires knowing which BAR each memory region
    needs to be mapped from. Add these definitions to the driver private record
    along with the includes necessary to use libpciaccess.

commit daada59b5f8c2294b524a4b5920dc6b1c213642f
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 22:32:39 2007 -0700

    Change IS_Ixxx tests to work with or without libpciaccess.
    
    libpciaccess has a new structure that holds the PCI identifier data; borrow
    macros from the mga driver to work with either the old xf86-specific
    structure or the new libpciaccess structure.

commit 3d3bf493a3973f4067433d27a4d7ddfecaa18f1c
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 22:27:34 2007 -0700

    Intel driver configuration (only) changes for X server libpciaccess usage.
    
    Detect whether the target X server uses libpciaccess, using it in the driver
    compilation as necessary. This change means that utilities that used to use
    libpciaccess will not do so unless the driver itself uses libpciaccess. Yes,
    that could be fixed, but it doesn't seem that important.
    
    This patch does not include any code changes necessary to actually have the
    driver build against an X server using libpciaccess.

commit 5faf9cc6afe1c30fa88bc6446088a6fa47fc5d0b
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sun Aug 26 09:34:06 2007 -0700

    Sort quirk table, add Dell Latitude X1

commit a9e1d42a47cef79d8bbde2afd89d26aed964e344
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sat Aug 25 12:54:11 2007 -0700

    Lenovo 201a is x60s, not x61s

commit ffc2907f7f2eb039004eff0014c5563a01463fb0
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Sat Aug 25 12:31:21 2007 -0700

    Thinkpad X61s has no TV out

commit 0c20fbabd18c19b2753cb60280f89e240ce5645f
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Fri Aug 17 22:21:47 2007 -0700

    Make sure XV_PIPE is used whenever possible.
    
    The code was not consistently using XV_PIPE when the desired crtc contained
    any portion of the video output.

commit e443f83dd6f110156743c93f7d793cdddb8195a1
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 17 18:13:49 2007 -0700

    Tune acceleration architecture allocator sizes down.

commit bd874b11bbfe582aebd3115771f90807e75afc31
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 17 17:49:21 2007 -0700

    Replace AA allocator usage with i830_memory.c for RandR rotation.
    
    This requires EXA 2.2 (server 1.3) for rotated performance with EXA, because
    the i830_memory.c allocation may not fall within what EXA considers the
    offscreen area, so the PixmapIsOffscreen hook is needed.

commit 9ad33dd65a79277ef75a6e95373614852725f5a9
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 17 16:46:48 2007 -0700

    Use i830_memory.c instead of the AA's allocator for XV buffers.
    
    This should fix issues with XV being allocated into XAA's tiled pixmap
    cache and resulting bad rendering.  Its also brings us closer to being able
    to shrink the size of the pixmap cache on XAA, which is of limited utility.

commit 3655a1ecb62f6c387a16fa87cf6f00bf7835dce4
Merge: e5c336e 2231cdc
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Aug 16 12:04:20 2007 -0700

    Merge branch 'master' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit e5c336eaa32be8f9379a2c1dd51006b85bc8b270
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Aug 16 12:04:02 2007 -0700

    Disambiguate plane and pipe mapping, use plane A on pipe B on pre-965 LVDS
    
    Add a new 'plane' field to the intel_crtc private structure for tracking
    planes separate from pipes.  This allows pre-965 chips to use plane A
    on pipe B, enabling framebuffer compression for builtin LVDS displays.

commit c3438356d6b7b63ad9d0086efb084be8e048980e
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 16 11:34:02 2007 -0700

    Add tiling information to BO layout description.

commit 0c9e4aeea84e20a18e3b76d8cf8e802af004df57
Merge: 79d9a30 2231cdc
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 16 11:30:16 2007 -0700

    Merge branch 'master' into buffer-objects
    
    Conflicts:
    
    	src/i830_dri.c
    	src/i830_memory.c

commit 2231cdcd8f1ee81b3e59cc5e3a325c22ee0f40e4
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Aug 16 17:15:54 2007 +1000

    i915: add support for render to a8

commit a69db6f7fe1703b473e5c1d1e0088ccc203f4d5a
Author: Dave Airlie <airlied@redhat.com>
Date:   Wed Aug 15 18:28:50 2007 +1000

    intel: don't setup texOffsetStart unless using EXA

commit 5126a71f82767b9e23cd590453718f3364789740
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 14 13:54:55 2007 +0800

    Fix seg fault introduced in tiling patch when TV detect
    
    When TV does load detect, fb hasn't been setup, so we should check
    that in i830_display_tiled(). Caught by Nanhai.

commit d9f89a1af7e7ff4056727060cdf2e35c15a4dcdd
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Fri Aug 10 17:59:33 2007 -0700

    Save/restore tile-mode offset registers DSPATILEOFF and DSPBTILEOFF
    
    Now that the driver sets these registers, they must be saved and restored.

commit 5bc194d3d3c87bb0128d9ac10f090f031345eb37
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Fri Aug 10 17:54:32 2007 -0700

    Set DSPATILEOFF/DSPBTILEOFF to handle 965 tiled frame buffers.
    
    DSPATILEOFF and DSPBTILEOFF replace DSPASURF and DSPBSURF when the frame
    buffer is in tiled mode.

commit 64b943c79cf957a4c54482720195d7f27b7f0c0d
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 10 15:48:05 2007 -0700

    Add #if 0-ed fence debugging code.  It's noisy, and of little use to most.

commit ba9a503ba2099025e393f3382bb453985ef23497
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 10 15:06:58 2007 -0700

    Don't force tiling on if it is disabled in configuration but fbc is possible.

commit b7751c7d1d6bcf310824295c3bab4ff36760c791
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 10 17:42:09 2007 -0700

    Fix stack-smashing in the last commit.

commit cb36635a053d4ac3971fea05060d31dbd3d382d2
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 10 14:16:59 2007 -0700

    Attempt to fix several front buffer tiling failure cases.
    
    Front buffer tiling is now disabled with G965 and XAA.  Some of the acceleration
    that i830_xaa.c does can't be supported on tiled buffers.
    
    Adds a tiling field to struct i830_memory, and uses it instead of separate
    variables for each potential tiled buffer.

commit ed1b106fabf3a18489bdb3083326f27387a9cb72
Author: Keith Packard <keithp@koto.keithp.com>
Date:   Fri Aug 10 14:31:16 2007 -0700

    Clean up tv mode name allocation and copy.
    
    TV mode names used to contain the signalling standard along with the pixel
    size. The signalling has been moved to the TV_FORMAT property, but the
    allocation and initialization of the mode name was left a bit messy as a
    result.

commit f71b9358b4157a8cfdc694ddef8ca3f98926ca91
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 10 15:53:04 2007 -0400

    Cleanup tiling and FBC driver output.
    
    Remove an extra "FBC enabled" message from i830_memory.c (only report errors
    if they occur), and don't print the "forcing FBC on" message if tiling was
    already enabled, as it's redundant and confusing.

commit e6746d0f286ef9d9a87f748d40e5421c268f2f7d
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 10 15:48:15 2007 -0400

    Enable tiling by default on 965.

commit e0fcf645a228094620b8f7fdd580963611bdd6ef
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 10 15:43:06 2007 -0400

    Tiling fixes for 965
    
    This should be close to the last set of tiling fixes for 965 chipsets.
    Prior to this commit, the 965 composite hook didn't take tiling into
    account, nor did 965 textured video, which caused display corruption.
    However, there seems to be at least one last bug to squash--on occasion,
    a configuration with tiling enabled won't properly display text.  This
    is likely another tiling related problem with the composite hook.

commit 02ad9cee330fb5fb0008ad6f74e74e8d8a1fc36e
Merge: 105f8a1 7b143e5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Aug 10 16:45:56 2007 +0800

    Merge branch 'master' into xvmc-i915

commit 105f8a183eb64623d9a9e2833dbe27156a551f69
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Aug 10 16:44:46 2007 +0800

    disable subpicture initial
    
    until we really implement it, OSD can't work for now.

commit 7b143e5c8397da077c0e02455c21c5a99cf50942
Author: Dave Airlie <airlied@redhat.com>
Date:   Thu Aug 9 12:14:44 2007 +1000

    i965: increase composite vertex buffer size and alignment to be safe

commit 14691b24da5aa29d8c41ac7b7c61828e3cd9eab7
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Aug 9 09:41:32 2007 +1000

    i965: fix memcpy of the sf_kernel when a mask is needed

commit 5e18c6af9051da654d2a6a97553ef4fe777bb61e
Author: Carl Worth <cworth@cworth.org>
Date:   Wed Aug 8 11:13:37 2007 -0700

    Allow 965 composite acceleration to A8 destinations.
    
    Note that this is a slowdown in text rendering due to the high overhead of our
    compositing setup, but appears to be correct according to rendercheck.

commit b0ec670cdb0b6ca6fc0f4f165fa3ee5a20d7c985
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 8 11:03:51 2007 -0700

    Bug #11593: Remove dead struct vch_bdb_20 which was angering the sun compiler.

commit 87cc72ef509b85635bf0e84c47dfed6b7242170b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Aug 8 09:39:55 2007 +0800

    check early if we have slot left for new context or surface

commit fec6744b763f2b85b4e592c51326b9ee979bef5d
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Aug 8 09:26:10 2007 +0800

    I missed to remove port attributes wrapper

commit 76c084d41999f13497b80d4ac6799cb974adaa03
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Aug 8 09:22:42 2007 +0800

    explicit say "unsigned int"

commit cfc614b1f9143ed1407733aaa81c4a980c613a63
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Wed Aug 8 09:06:47 2007 +0800

    remove xvmc attributes
    
    We don't have extra attributes than Xv port.

commit 92af2f4bbcb395cbde097776718449d99843ad67
Merge: da82a47 e0be352
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Aug 7 15:18:17 2007 -0700

    Merge branch 'origin'
    
    Conflicts:
    
    	src/i830_exa.c

commit da82a47a558597f3653e2b33bc6adbab18574b57
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Aug 6 17:01:37 2007 -0700

    Fix EXA rendering with tiled front buffer on pre-965.
    
    The 915 and earlier appear to respect the fence registers, while only the 965
    requires the per-operation tiling setting and pitch shifting.  This will also
    fix issues with rendering on the 965 involving multiple cliprects, where the
    pitch would get divided repeatedly.
    
    This removes the offset < 4096 fallback, which essentially resulted in no
    acceleration to tiled buffers, hiding the issues.

commit e0be352f5017f0e645a4ff8a40961d9c2b98863a
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Tue Aug 7 12:37:25 2007 -0700

    Fixup pitch in Prepare* functions, since actual hooks may
    be called many times for the same pixmap, and we don't want
    to keep dividing the pitch by 4.

commit b29a932bec2a3cc5a38e9c09c012cfdc1b6209c1
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Tue Aug 7 16:47:13 2007 +0800

    code cleanups
    
    and put wrap function in driver xvmc priv instead of per xv port priv

commit 7431abee5fb971d1f8bc7ac4bea137f6ece9418b
Author: Brice Goglin <bgoglin@debian.org>
Date:   Tue Aug 7 09:13:00 2007 +0200

    Define INTEL_VERSION_MAJOR/MINOR/PATCH using PACKAGE_VERSION_*

commit 9e1914270a0978ec4dfae757d3dd57ca7ffe17e5
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Mon Aug 6 17:55:00 2007 -0700

    Remove 4k offset checks from Copy & Solid hooks.
    Reading the docs too literally can cause you to hide bugs with false fixes...

commit 3510d5728fa972b36d022b4f9189d46ff98d7b16
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Aug 6 16:44:39 2007 -0700

    Fix accumulated whitespace nits in i830_exa.c

commit 5ff05dffe229e35da7619762628fdd0f125585e8
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Mon Aug 6 16:01:10 2007 -0700

    More tiled rendering fixes: - check for tiling, not just offset in PrepareSolid - combine pI830->tiling and frontbuffer checks into new exaPixmapTiled function for readability

commit ba90d944329dd8c79a757c38128964fbbe4ab898
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 3 16:46:09 2007 -0700

    Add the file mode for bios_dumper output so it doesn't have 000 permissions.

commit 322a163cfbda885adc6bb09c1f976d36617ea83b
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Aug 3 10:46:39 2007 -0700

    Quirk away the nonexistent TV connector on the Panasonic CF-Y4.

commit ffbab2ee5dc227b2a8a5ffd1717ae00e8e37f956
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 3 21:27:52 2007 -0700

    Limit Solid & Copy offsets to 4k when rendering to tiled targets

commit 019dbfda294aaafb28d8bea0fe2f5dadc2ea3e0b
Merge: 3d3c0e8 15f71ed
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 3 20:45:14 2007 -0700

    Merge branch 'master' of ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 3d3c0e8c55f639a501c0756948b518abd903d7d0
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Aug 3 20:40:45 2007 -0700

    Tiled rendering & fbc fixes:
      - actually enable tiling in DSP(A|B)CNTR if needed
      - add logic to EXA routines for tiled case (still needs work)
      - enable/disable fbc on DPMS events (meant moving functions higher in file)
      - fix fence register pitch programming (use correct pitch instead of kludged value)

commit 79d9a309b19e22561e000a47b732c67479c2e6d4
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 2 15:50:42 2007 -0700

    Mark DRI buffers as shareable, and pass their buffer handles through the SAREA.

commit 0da4f2b0cd7203377ad10407928a367b8c6d310e
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Tue Jul 31 16:22:36 2007 -0700

    Legacy backlight changes:
      - add support for 965GM
      - make sure legacy enabled systems don't reduce the range of backlight values we can present to the user

commit 15f71edba37738f8ba279fa07452fda10cc65298
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Sat Jul 28 17:43:29 2007 +0800

    Update Lenovo TV quirk info

commit 857b4a7bcb69ca43b866b4283fe075abbafb1d22
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 27 18:03:12 2007 -0700

    Pin some buffer objects at creation time, which can't be moved yet.
    
    A number of other interfaces of ours don't allow buffer offsets to be updated
    after screeninit.  This attempts to catalog why for each one, so that they
    can be fixed one by one.
    
    This happens to restore the EXA offscreen allocator for now, as a fixed-offset
    object.

commit d7b5b595ad29ae0ac3adbd3a176be3fe7ffa6474
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 27 12:48:08 2007 -0700

    Delay the first screen pixmap update to CreateScreenResources.
    
    The return value of GetScreenPixmap before CreateScreenResources is not, in
    fact, a pixmap.

commit 2b1ec0f51479c1d7e5e62803c68feca29375519d
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jul 27 10:00:35 2007 -0700

    Use the dontMapFramebuffer option available with DRIINFO 5.4.
    
    If not available, AIGLX init will fail.  While here, simplify DRIINFO tests
    since we refuse to init with a version queried less than the version we
    compiled against, anyway.

commit f403a50afbcef1e54f554481c72037338bd5357c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 27 09:24:24 2007 +0800

    Add another Lenovo TV output quirk
    
    From issue report http://lists.freedesktop.org/archives/xorg/2007-July/026644.html

commit 34c82ad7ce83394db47588693b578cf91991bf1c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 27 09:14:13 2007 +0800

    Add quirk support
    
    This one trys to use a flag for possible quirks. It adds a quirk
    for my Lenovo T61 TV output, and ports some origin LVDS quirks to it.

commit 1a585d03972394cb97dec2462937b0104bdf4de2
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jul 26 10:46:35 2007 -0700

    Use new drmBOSetPin interface instead of NO_EVICT/NO_MOVE buffers.
    
    To do this, we have to deal with buffer offsets being set at EnterVT time
    instead of screen init time. We've wanted to move this direction for a long
    time, but there are repercussions.  The EXA offscreen memory manager has to
    be disabled, because it can't be moved.  That will be replaced by BO-backed
    pixmaps soon.  Also unresolved is whether our moving
    front/back/depth/texture buffers will break the classic-mode DRI driver.
    
    This code doesn't actually work yet.

commit 0fd3ba0518b3cde9ca0e4e2fc1854c00d8a43d5c
Author: Brice Goglin <Brice.Goglin@ens-lyon.org>
Date:   Wed Jul 25 20:11:32 2007 +0200

    Fix typo in intel.man
    
    Reported by A. Costa" <agcosta@gis.net> in
    http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=432061

commit 18c707a8c13ac5fffdd30d55e6f5926a68b367df
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jul 25 10:11:16 2007 -0700

    When TTM is available, use it instead of manual AGP allocations when possible.
    
    This is a step towards being able to expose buffer objects through the screen
    private to DRI clients, instead of having them have to use the fake buffer
    object type.
    
    This fails in two ways.  First, the kernel memory manager is not currently
    suitable for doing the physical allocations we need, so we still use AGP for
    those.  Additionally, the DRI lock can't be initialized early enough for us, so
    these buffer object allocations fail.  This will be fixed by improving the
    DRM interface.

commit c4deefa80a6349db968e25bd6778cdf7a514ca7f
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jul 23 10:35:32 2007 +0800

    only enable xvmc for 915/945/G33

commit 45962eed51120ff77326c29d72cf8b6cd8a934b5
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Mon Jul 23 09:50:17 2007 +0800

    Fix a typo in i915 render
    
    Fence setting is in mapstate actually. This fixes rotation in
    tiled fb case, thanks Keith to report this.

commit a52c53b8603495ab05e07e3da5092fe122fcb6f2
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Jul 20 17:10:27 2007 +0800

    don't initialize XvMC if xv is disabled.

commit b1af2c0e01c54ef1d40fd0ca1ede29a1dd7ed97b
Author: Zhenyu Wang <zhenyu.z.wang@intel.com>
Date:   Fri Jul 20 15:18:48 2007 +0800

    Fix device id info for 945GME, 965GME
    
    which do have new host bridge ids

commit 6b4d43dbf4bbb86d479d8fca480c8bec39e2714b
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Fri Jul 20 09:59:40 2007 +0800

    lock display when creating context

commit 42e91c7092f9cf7f5c0b98e9ae3d92a5b30821bf
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 19 17:30:54 2007 +0800

    move i830_allocate_xvmc_buffer out of  #if/#endif

commit 36ea26f2779d951fa173da785aca100564e5ecf8
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 19 17:21:05 2007 +0800

    add copyright

commit 9d03873423c0968b2d6700b7d8d44c7e23b8d7f3
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Thu Jul 19 10:03:19 2007 +0800

    block some signals within critical section to avoid
    
    dead lock.

commit 25658f838bd1bcd7559d7a032d127c626833fb7c
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jul 16 13:03:58 2007 +0800

    1. The pitches for y/u/v surfaces are 1024bytes aligned.
    
    2. clean code

commit 8f316a4584d0676e5dae051698bde0831f018cc4
Author: root <root@xhh-bl32.(none)>
Date:   Thu Jul 12 16:24:03 2007 +0800

    1. clean code
    
    2. fix an error in map_state

commit 4844254431695158287167e3b0fad25d9efb7a6c
Author: root <root@xhh-bl32.(none)>
Date:   Tue Jun 26 16:32:30 2007 +0800

    a fix for 945G/945GM

commit 8c249765ce788f8adb0325a8e3016a0eae74b13b
Author: root <root@xhh-bl32.(none)>
Date:   Mon Jun 25 14:07:01 2007 +0800

    1. using batch buffer
    
    2. implement macroblock_ipicture instruction
    3. 16bit INTRA block

commit 2b20b395541f786e4009211e4c56042257b8d114
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:43:49 2007 +0800

    fix a bug related to display surface

commit 6e47601ac7427390fa4cb6e228dfb566ff95db09
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:40:08 2007 +0800

    fix some bugs

commit d038ffdfffb846e22f360faac5d469c8e59795ad
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:37:12 2007 +0800

    Release resource allocated for surface/subpicture

commit a9bf7e28b91692c7c7a4915cdf9603cd2ef025ea
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:33:35 2007 +0800

    fix some bugs

commit ccac60bf035bb54661c13f306031def81e105a32
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:23:28 2007 +0800

    fix some bugs

commit 934da9f2b83716bb37d0719a61b8e6b179fff2cd
Author: Xiang, Haihao <haihao.xiang@intel.com>
Date:   Mon Jun 25 10:17:08 2007 +0800

    enable XvMC for i915

commit c7920a0e819308762fca3d6fc7ab194bd565b06a
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Jul 19 15:09:54 2007 +1000

    strip out remainder of drmmm code in driver

commit 37652b68880f1881b90bd22218cfe86eca7e5974
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Jul 17 14:03:21 2007 +1000

    intel: oops I commited pixman local workaround - undo it

commit e40f6a4923d1323702406266e90eae3218a8a44e
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Jul 17 09:20:07 2007 +1000

    intel: actually 2.3.1 should be good enough

commit 1e169be25b2e4ab34afd4b8ae8ae0041f6069125
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Jul 17 09:17:31 2007 +1000

    intel: don't try and use TTM memory manager with old libdrm interface
    
    I probably need to release a libdrm with this interface in it now..

commit ff2be3995d33f9e4b7f63b380f166b6168c9b9c6
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Jul 13 12:47:18 2007 -0700

    Remove hard-coded CRT blanking frobbing for load detection.
    
    CRT blanking needn't be adjusted to perform load detection on 9xx chips, and
    the 8xx load detection path now adjusts blanking just during load detection.
    Adjusting the blanking interval turned out to cause many monitors to fail to
    sync.

commit 00f4587025a3879626623135b0a153fcdb906719
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Jul 13 10:58:06 2007 -0700

    Ensure pipe/output active before doing load detection.
    
    If the pipe or output have been set to DPMSOff, then load detection will not
    work correctly. Also, share the load detection configuration code between
    crt and tv outputs.

commit 6f18300aed1340348c6d395f326061b5315be643
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jul 9 21:29:55 2007 -0700

    Eliminate bogus (and harmful) blanking adjustment for load detect.
    
    Instead of always adding blanking to mode lines, use the FORCE_BORDER option
    on i9xx hardware where it works, and dynamically add a bit of border if
    necessary on i8xx hardware to make load detection work. This may cause
    flashing when a usable crtc is not otherwise idle when load detection is
    requested.

commit 04130ac6b705aa49161fb6dae83ad0bdd76e89d9
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jul 11 11:42:56 2007 +0800

    Fix i915 rendering for tiled buffer
    
    Make it to check fence register for dest buffer.

commit 88f8b688e2316ae4a1f7485f0010ce90de54783a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 9 12:56:13 2007 -0700

    Fix some physical address handling for >4GB addresses.
    
    The upper bits would have been inappropriately dropped on G33-class hardware,
    and on G965-class hardware in a 32-bit environment.  The only use of physical
    addresses on these should be for FBC, though, and FBC requires addresses
    below 4GB.  This is unresolved.

commit bf831117b4659cc4f2774098dee938505f780a9b
Author: Jesse Barnes <jbarnes@hobbes.virtuousgeek.org>
Date:   Sat Jul 7 10:15:32 2007 -0700

    FBC fixes:
      - allow FBC and Tiling to be forced off if configured to do so
      - only touch FBC registers if pI830->fb_compression is true

commit b426866fe1be2ad3861559beff69186379a6afad
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 20:48:40 2007 -0700

    Fix manpage to reflect default behavior.

commit 377c58373daa6bef5d37ead2b6f9a769a905b6fa
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 20:39:19 2007 -0700

    Fix naming of FBC plane enable bits (mistakenly called them pipes earlier).

commit 9c0388dc8d4c6495fae21af6da644b34e20173d1
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 20:38:41 2007 -0700

    Update man page with current behavior.

commit cecbc71fdc9af832cef23427696f6f654f7d6104
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 16:36:34 2007 -0700

    Fix debug output in fbc enable/disable routines.  Add logic to make sure fbc
    isn't enabled twice on two different pipes.

commit 4359df9419d2d02a2f9d9adc7f5a49ecf07ddd30
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 16:17:45 2007 -0700

    Fix tiling and fb compression defaults for 965 (not yet fully supported).

commit ca593a5219549df94a6d234ebbcf9e7c44723c9b
Author: Jesse Barnes <jesse.barnes@intel.com>
Date:   Fri Jul 6 16:10:52 2007 -0700

    FBC and tiling changes
      - change framebuffer option name to "FramebufferCompression"
      - add new "Tiling" option (controls all tiling, not just front buffer)
      - add debug message to fb compression enable/disable routines
      - update man page with new options

commit 8798ef11321ee6957919279076758d47ad956cf3
Merge: 8919b22 3c552af
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 5 12:21:31 2007 -0700

    Merge branch 'master' into fbc

commit 8919b2292147add41a1c1c6e5e673257cb6c6c6e
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 5 12:21:06 2007 -0700

    Re-add tiling kludge, but only for 965.

commit 407b124af8f7bb42abe4eecc87476c4c3e555cd0
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 5 11:31:34 2007 -0700

    Remove tiling kludge.  May need more fixes for 965.

commit 7a87b9d2a2eb4d281dce67586756ff5653b2805a
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 5 11:23:06 2007 -0700

    Revert discard alpha change, requires other fixes to work.

commit fecf964534f5ba6d40480cb13adc89094946a51e
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Thu Jul 5 10:59:23 2007 -0700

    FBC fixes:
      - properly check several FBC enablement constraints
      - don't use alpha discard if FBC is in use

commit 60ee7b6a91b2b8c447130c60cd8b19eb68119777
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Tue Jul 3 14:20:34 2007 -0700

    Fixup line length buffer padding, add kludge for front buffer tile
    pitch.

commit 3c552af65d28fafec1d09484a8914b690b961349
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 2 18:33:47 2007 -0700

    Update documentation and bump driver version to 2.1.0.

commit f02036aedcd7866c567a6adc070eda3dad872105
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Mon Jul 2 15:42:02 2007 -0700

    Framebuffer compression changes:
      - move FBC register definitions to i830_reg.h
      - add fix from Arjan for 965 depth buffer tiling
      - add VT switch and clear-at-server-start code for FBC registers

commit 2b9961eb9ce8734565ecdb01cb11610714d7f610
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 2 15:16:33 2007 -0700

    Fix reversed LVDS dither enabling logic on GM965.

commit 3d9ee8b2991ec0da8cc21b8455ff7f00fd0335b5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jul 2 14:38:28 2007 -0700

    Bug #11365: Disable the panel fitter unless it's needed for the chosen mode.
    
    The automatic panel scaling appears to choose bad sampling on some GM965
    hardware for 1:1 mapping modes, and there's no real sense in having it on
    if we just want 1:1.

commit b384c608978dcd3d2ea6c0018179673cb4735f4c
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Mon Jul 2 09:32:28 2007 -0700

    Enable framebuffer compression (use Option "FrameBufferCompression"
    "true" in your xorg.conf).  Should save ~0.5W during typical 2D usage.

commit 1e2e301348b4168aeed38b3fdc6b0e43d5678a86
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Sat Jun 30 12:45:24 2007 -0700

    Fix load detection to use border region instead of blanking.
    
    Make sure there is some border area to use by changing how the pipe is
    configured, then pick a scanline in the middle of the border for load
    detection. This lets the load detect code use an active pipe instead of
    requiring an idle one.

commit 11862c2e1f23b77b56d7bd8b384579b5e3ae377b
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Thu Jun 28 23:31:28 2007 -0700

    Add *~ to .gitignore to skip emacs & patch backup files

commit 6503eb45023d0db9a94cb9d1e14a26af07a6628d
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Thu Jun 28 23:30:35 2007 -0700

    Add AM_PROG_CC_C_O to configure.ac
    
    Clears automake-1.10 warning: src/bios_reader/Makefile.am:8: compiling
     `bios_dumper.c' with per-target flags requires `AM_PROG_CC_C_O' in
     `configure.ac'

commit 5257e36f502676fd6a44bbb8e747d9138ed3bc5c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Jun 28 15:29:52 2007 -0700

    Handle dual-channel LVDS on i855.
    
    Just as with i9xx LVDS, the i855 LVDS can operate in dual-channel mode with
    a modified P2 divisor value (7 instead of 14). Just using the existing 9xx
    code for 855 appears to work fine.

commit 16bfcb8042519f24b4494fd621814f39949ceeb6
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Jun 28 15:27:56 2007 -0700

    Decode PLL registers in LVDS mode a bit better in debug code.
    
    LVDS mode changes how the PLL works in fairly dramatic ways; the debug code
    wasn't properly accounting for those differences resulting in fairly bogus
    debug output.

commit 9675ccb30818bf831ac4c634751ab4bfe35f7bfe
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jun 27 09:23:33 2007 +0800

    EXA: fallback mask transform on i965
    
    It needs to fix shader programs which hasn't been done yet.

commit 7a2300c88ae59f5b7c3ce89d33147e3f0ca23c18
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jun 27 09:19:22 2007 +0800

    EXA: don't have to check offscreen size
    
    DDX will check it for EXA_OFFSCREEN_PIXMAPS flag

commit fff4a3b58fa18ee2ad91f998d190e90b77c051ab
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:15:58 2007 -0700

    Use local structures for vs_state, sf_state, and wm_state

commit 0a8a4afd3c59011d6b1f5b39aedfb9bce0e55c48
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:12:23 2007 -0700

    Use local structure for src_sampler_state and mask_sampler_state

commit 499166a60fcbf16021bd9ec233790ba55803aa44
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:09:17 2007 -0700

    Use local structure for mask_surf_state

commit a418ef7316808b239884a90c3fe890220bcc0242
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:07:19 2007 -0700

    Use local structure for src_surf_state

commit 0e3c0b17826b7b5a21ee2c1d789b084fc167f1ed
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:05:50 2007 -0700

    Use local structure for dest_surf_state

commit 41a2c0f15446d59678461648f476fa71d40d44e0
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 23:03:47 2007 -0700

    Use local structure for cc_state

commit 59f2150caca7eb374a2db43a472ba85f50d23274
Author: Carl Worth <cworth@cworth.org>
Date:   Mon Jun 25 11:28:57 2007 -0700

    Remove redundant i830WaitSync from i965_prepare_composite
    
    There were two calls to i830WaitSync, and between them no state was
    being changed---just offsets were being computed.

commit 66aa0e61e1e8d2216a9c0555be5be004ed0a3192
Author: Dave Mueller <dave.mueller@gmx.ch>
Date:   Fri Jun 22 16:45:27 2007 -0700

    Bug #11171: Add support for the Ti TFP410 DVO TMDS transmitter.

commit f8d7cbc6e1322acad3351591336cefcfba7d9aaf
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Jun 22 16:29:21 2007 -0700

    Move the ivch's fixed panel mode support to i830_dvo.c for other LVDS drivers.
    
    This also results in removal of the setup hook, which was being called
    unconditionally and breaking non-ivch dvo drivers.

commit ec236c76b93aea5f2ee1e8b8509cde4625974fcb
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Jun 22 16:32:46 2007 +0100

    I830 needs to have plane/pipe/pll started in mode_set.
    
    The patch for the i855 to stop enabling plane/pipe/pll in mode_set broke the
    i830. Revert that just for the i830, leaving it enabled for the i855.

commit d957c6b8e1dde8e11c1db3431e0ff58c5d984880
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Jun 22 01:32:02 2007 +0100

    Increase vblank wait timeout from 20ms to 30ms. 49.6Hz < 20ms.
    
    The x40 LVDS mode has a 49.6Hz vertical refresh. Waiting for only 20ms can
    sometimes cause the driver to start programming the hardware before the
    vblank has occurred, which will lock up the i855 chipset. Extend this to
    30ms (the maximum timeout used by the BIOS) to ensure this doesn't happen.
    
    Detecting actual vblank occurance using the various status registers should
    also be possible but isn't yet working.

commit a67c2965385001bcb8987265f698ff0f5809cd11
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Jun 21 23:59:38 2007 +0100

    Follow BIOS configuration for Legacy Backlight Brightness.
    
    The backlight control in the LVDS controller can either operate in 'normal'
    mode or 'legacy' mode. In legacy mode, it uses the PCI config space register
    0xf4 which can range from 0 to 0xff. In normal mode, it reads the range and
    current value from the BLC_PWM_CTL register.

commit d6e46f67ab3af1ad3bfa72acb0efd9fe79dbf1dc
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Jun 21 20:16:36 2007 +0100

    Eliminate some uninitialized variable warnings

commit 9d104634cf03bea82d1467f01e577cb8d2e4b554
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Jun 21 01:15:39 2007 +0100

    Add 3DSTATE_CLEAR_PARAMETERS bits

commit 3bbf313ba541526a893915f8b6c64b1eccf325e0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Jun 19 09:33:50 2007 +0800

    Fix left G33 issues
    
    Be sure to check G33 chip type in:
    - sdvo output
    - Y-major tile
    - crt detect
    - and xaa composite
    Sorry for that I should have fixed them very earlier...

commit acef342c870f3b5b781e48c8bf44739aa5ee8ffa
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 18 11:57:48 2007 -0700

    Bug #11295: Disable textured video on i915 with framebuffer width too large.

commit fbbb41bc5e03478cb46ee8f64ef68b23ff3fc14b
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Jun 17 14:59:24 2007 +0100

    Let DPMS functions enable plane/pipe/output on 8xx hardware.
    
    On 855, letting crtc_mode_set enable the plane and pipe will occasionally
    hang the chip. Instead, wait for crtc_enable to light things up. For 9xx,
    leave things alone.

commit d5ca000ece145a35fd6df0dcf3fb3460bd2d64e3
Author: Rémi Cardona <remi@gentoo.org>
Date:   Sat Jun 16 13:17:54 2007 +0100

    Include stdint.h to get uint64_t

commit 6b2ae93506d6795f87d6993bebfcb4e6632508ee
Author: Dave Airlie <airlied@linux.ie>
Date:   Fri Jun 15 23:30:04 2007 +1000

    sdvo: add support for RGB outputs on SDVO
    
    This lights up my monitor VGA-1 - it doesn't look the best though

commit 671ba03befebfdd7256855858987aabc28b2e8cd
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 13 16:30:26 2007 -0700

    Fix and enable the 915-class planar textured video path.

commit 6c29e0bae5f1e7cee02b678418394abb971594eb
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 13 13:40:39 2007 -0700

    Improve the drm_i915_flip_t check.

commit 420e41e7921d3cc07c784fd17936ec8a675f3b20
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jun 13 13:34:26 2007 -0700

    Revert "Replace failure-prone configure test for fresh libdrm with a simple ifndef."
    
    This reverts commit c2b130354aecffbeb2a2d23c7371461feaf5766a.
    
    Sadly, a non-working DRM_IOCTL_I915_FLIP already existed.

commit 51612e5ac3ddfb2bb172c58f2dfff9631093b69c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 12 16:09:54 2007 -0700

    On hang, dump up to the head pointer, not just up to the tail.

commit ceb6dd72443c094212b0281c42cbe92e9a29f682
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 4 16:37:53 2007 -0700

    Fix context switching between DRI and X.
    
    Now, all 3D pipeline consumers in the driver just call
    IntelEmitInvariantState(), which handles basic state setup, the caching of that
    state setup, and notifying DRI clients.  This also removes a mistaken idle
    wait in the Render code which was papering over the brokenness in the context
    switching.

commit c2b130354aecffbeb2a2d23c7371461feaf5766a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jun 12 08:49:21 2007 -0700

    Replace failure-prone configure test for fresh libdrm with a simple ifndef.

commit 0e1deb607f94e4aa3ec4b9df8ff7a07a1c95e31d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 11 17:33:33 2007 -0700

    Fix a typo in _3DSTATE_DEPTH_SUBRECT_DISABLE definition.
    
    This is already fixed in the definition in the 3d driver.

commit 8d7a0ccd4f674659eb781def2cfdc3a6e5a219ce
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 11 17:33:07 2007 -0700

    Clean up some nits in i915_video.c setup.
    
    - The screen dimensions were used for the clipping despite drawing being done
      to any pixmap, not necessarily the screen.
    - One piece of state setup was not documented anywhere, and isn't used in other
      3d hardware paths that also work.
    - A 3DSTATE_MODES_1 command (830-class only) was issued even though it no
      longer exists.

commit 15caa64a497dcc0eacb0f91166d9b70206a8db35
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Jun 8 18:44:28 2007 -0700

    Add description for how to use the frame and pixel counter registers.
    
    The 24-bit frame and pixel counters were not described in detail and
    will be useful for DRM.

commit 404fd47573f855b0442d49a383542fc093825ad0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jun 6 11:01:48 2007 +0800

    Enable overlay on G33 class chipsets
    
    Which have to use gfx vm offset fot setup overlay regs.

commit f4c05973d391bdb0a9b0eadb155548310baa98fd
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Jun 5 11:07:41 2007 -0700

    Add support for the G33, Q33, and Q35 chipsets.
    
    These chipsets require that the hardware status page be referenced by an offset
    in the GTT rather than a physical memory address, so the X Server allocates it
    rather than the DRM.

commit 36fcaeb2ef94db5399071540bba106dec3db81d5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jun 4 15:58:31 2007 -0700

    Fix misplaced merge of 1280x768 panel fixup.

commit 8a19e7d57bc23dd163b45e0ab7deca4f074c934d
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Tue Jun 5 00:09:57 2007 -0700

    Always ensure the pipe A is lit when activating overlay on pipe B.
    
    Ok, so moving video from pipe A to pipe B still requires that pipe A be
    active during the transition. Instead of trying to be fancy, just ensure
    that pipe A is running on each transition to pipe B.

commit e986f6cb62f8644c5fa835bd7dfb7b014c2677c5
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Mon Jun 4 23:52:23 2007 -0700

    Automatically switch overlay when crtcs are reconfigured.
    
    As crtcs are disabled and enabled, make sure the automatic crtc selection
    mechanism drives overlay configuration at each request to display an image.

commit 0984c1fc0963f1ebab31f5b8fce5ad4c387fbd2c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 31 10:17:26 2007 +0800

    Add pci ids for 945GME

commit 88ee25ebad78e54d243d728b775a69365359b5fb
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 31 10:13:30 2007 +0800

    Add pci ids for 965GME/GLE chip

commit 92e4deb50e049cc83cbde4995ba0b901feceb15a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed May 30 11:49:07 2007 -0600

    Extend XV_PIPE range to include new -1 value

commit 888a4a5f469bf955e3ee3e184b628808ae8a4498
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed May 30 14:42:35 2007 +0800

    Fix i965 render's draw clip rectangle
    
    Use scrn's virtual size is not correct in rotation rendering.
    This fixes initial rotation problem on i965.

commit 516fb73ffee0aea7cf892e6703d37f8ecf52b812
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 29 10:22:25 2007 -0700

    Remove README statement that 830M panels are unsupported.

commit 72462568da589054828b72ace83232a71636ee73
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 29 10:21:12 2007 -0700

    Expand manpage description of outputs supported.

commit 906b974bfeeed18d79c244ad3db4f5d30e13e4c8
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 29 09:49:08 2007 -0700

    Add a fixup to LVDS panel mode detection for 1280x768 panel from text mode.
    
    Apparently some BIOSes will program a small mode with large blanking instead of
    using the pannel fitter.

commit 4b2781291844b61b397e257a0fdb43e964e5f603
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat May 26 10:09:11 2007 -0700

    Mark IVCH as connected when detected

commit 2a365eab0178c28782fba97bdd22365f30ce8963
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Sun May 27 12:35:55 2007 -0700

    On i830, Pipe B cannot be lit the first time unless Pipe A is running.
    
    I don't understand it, but just like the video overlay, if Pipe A is not
    running, Pipe B will not turn the first time it is activated. This
    patch restructures the code used for the video overlay to share it
    with the crtc commit function.

commit ff8c8cb869a3c780dbd826f7c94f06e4f3fda6af
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Fri May 25 20:29:59 2007 -0700

    Compute and clip to crtc before call to xf86XVClipVideoHelper.
    
    By clipping to the crtc ahead of time, xf86XVClipVideoHelper will
    correctly clip to the bounds of the crtc, eliminating the need for any
    custom crtc clipping.
    
    Also, replace the broken xf86XVFillKeyHelper with a private version that
    doesn't end up stuck with the wrong clip list when the root window changes
    size.

commit 33f635d79fe891079558fd909d564f3cf424c482
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Fri May 25 17:32:06 2007 -0700

    Ensure Pipe A is active when enabling overlay the first time.
    
    The overlay on the i830 appears to be clocked by Pipe A when being enabled.
    If pipe A is not running, it will freeze the overlay and blank the screen.
    Setting a random mode on the Pipe and turning it on fixes this problem
    nicely.

commit ff0ac8ea63dd6e55573652c5826c482881da0d62
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Fri May 25 17:26:15 2007 -0700

    Xv does not require directRendering

commit 109e5d597b76f7414601cb39c07b133ebf1b0e61
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Thu May 24 11:40:50 2007 -0700

    Clean up CRTC selection. Remove more overlay blocking.
    
    Create separate CRTC selection function, use ints instead of floats for
    coverage measurement. Remove pipe stalls waiting for overlay update.

commit dfb1ec9a07f74125cb1724d41ed4342c4714e12b
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Thu May 24 11:23:44 2007 -0700

    Eliminate blocking for video overlay.
    
    No need to block for the overlay; just use the idle buffer.  This will
    always work because the buffer switch occurs at vblank time, so there is
    always plenty of time to get the next buffer contents in place before it
    starts getting scanned to the screen.

commit d172344599585e11388e59659dc9aaa86d7a31c1
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Wed May 23 20:00:16 2007 -0700

    Reformat i830_video.c to four-space indents.
    
    Yes, I can't stand it anymore. it's a huge patch, but
    git-diff -w shows no changes.

commit 02935ced3fba598a01d908ae49ccc30cbcc765a8
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Wed May 23 19:24:25 2007 -0700

    Clean up overlay management.
    
    Create separate on/continue/off functions for overlay.
    Manage overlayOn boolean within those functions.
    Eliminate redundant management code in other routines.

commit 08753f9b79f3f09879a18b552d90d88dbf52d4be
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Wed May 23 18:59:10 2007 -0700

    Use FLIP_CONTINUE with ~OVERLAY_ENABLE to turn overlay off.
    
    This makes the overlay work on i830 with the modesetting driver. I don't
    know why the pre-modesetting driver worked without this, but it did.
    A more 'correct' fix would be welcome, but this does seem to do the trick.

commit aa187186dc4f2d770a642060fe54f547ea8952b3
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Mon May 21 10:49:08 2007 -0700

    Automatically select crtc based on coverage.
    
    By default, select crtc based on which one covers more of the video output.
    pipe property can be used to override selection when both have partial
    coverage.

commit f5017a06a271bba0ace3c5415b78e78bc0c96f22
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Sun May 20 17:25:33 2007 -0700

    Use CRTCs instead of pipe indices for video pipe selection.
    
    Replace pipe indices with crtc indices and store references to the xf86Crtc
    objects in the video private structure.

commit 2df87256df755e972eb884bc742832038a020b2c
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Sun May 20 17:23:26 2007 -0700

    Dump pending ring on crash.
    
    When the hardware locks up, dump the pending commands in the ring for
    analysis.

commit 9971fac87622c93503540196e1756fded3d4869e
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue May 22 10:46:39 2007 +0200

    i830: Provide new DRI texOffsetStart hook when available with EXA.

commit 5390a2e2611950d3f48cc735df4a0c37bc5377a5
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri May 18 17:51:36 2007 +0200

    Update vblank pipes when a pipe gets disabled.

commit 4120a20626998272424225261f2cf7960b7ec0ca
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri May 18 10:10:34 2007 +0800

    EXA: add render enter helper function
    
    That notify mesa rendering is smashing the state, and check last 3d
    operation to do sync after we're swapped in or others.

commit 8db28aeaa6e908017b40bd9180f144a2972f6278
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri May 18 09:54:34 2007 +0800

    Fix ring debug code
    
    Use proper unsigned type for timer variables, and try to dump 965G state.

commit 16e50a91dd8b3676e8ce06052c549ab27e6843b7
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri May 18 09:53:36 2007 +0800

    EXA: remove a flush cmd in i915 render code

commit 12a9fcfe1b25cee850380d8ce11ef11cde9aaacb
Merge: b930bb9 e89d5f2
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu May 17 15:11:29 2007 -0700

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit e89d5f275442915cc7777e75d3fcf7e7ed0f2084
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Thu May 17 15:00:12 2007 -0700

    Make each output control clones/crtcs. Split DVO into LVDS, TMDS, TV.
    
    Move clone/crtc config into each output where it's easier to understand (no
    need for a switch statement in I830PrepareOutputs. Also, split DVO into
    three sub-types (TMDS, LVDS, TVOUT) as those have different cloning
    abilities.

commit a441954630c6cdabbf463bfc3404160f97a04b4f
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Thu May 17 14:11:49 2007 -0700

    Enable panel fitter on ivch DVO.
    
    Using BIOS source code as a guide, set up the panel fitter on the ivch. This
    involves setting the pipe to the panel fixed mode, the DVO to the source
    size and assigning vertical and horizontal scaling factors in the ivch
    itself.

commit c0daa0a982e7074af4b50653b4a45b0a6352b43d
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Wed May 16 14:02:00 2007 -0700

    Change DVO module interface to pass more state across. Fix IVCH display.
    
    The DVO module interface reflected most of the xf86Output API to the
    underlying functions; finish that work given the changes that have since
    occurred in the xf86Output API.
    
    Move the LVDS-specific code into the IVCH module and make that work on the
    Thinkpad X30 (an i830-based laptop). Panel scaling does not work yet.

commit b28817a87a1608e849e4a9a736dda43533a84b0c
Author: Keith Packard <keithp@dulcimer.keithp.com>
Date:   Wed May 16 13:59:36 2007 -0700

    Add i830_bios_get_aim_data_block to read AIM data from BIOS
    
    Add-in modules have per-module data in the BIOS which contains configuration
    information which cannot be entirely discovered.

commit b31bef1a8effa9acb6de7edd206b9d8c48d88144
Author: Keith Packard <keithp@work.jf.intel.com>
Date:   Sat May 12 20:04:31 2007 -0700

    Deal with i830 CRT load detection which cannot use FORCE_BORDER.
    
    Chips newer than the i830 can force the border color for the active period
    of the screen, allowing the load detection to easily see the right data. In
    addition, newer chips appear to have more sensible load detection hardware
    which either ignores inactive periods on the screen or performs some
    longer-term averaging. The i830 appears to provide unfiltered samples of the
    detected load.
    
    For the i830, then, emit a border at the bottom of the screen and, for load
    detection, simply turn it purple and wait for the current line to be within
    the border. Sample an entire scanline, counting the number of times the load
    detection sees a monitor. In my testing, the presence of a monitor will
    cause the detection to succeed every time, while the absense will cause it
    to fail about 75% of the time. The code here, checks for presence at least
    75% of the time, which should be adequate.
    
    Also, as the new mode configuration code has already taken care to enable
    the CRT output, eliminate much of the load detection code which is simply
    duplicating functionality from the general mode setting code. This should
    result in faster load detection as this code will now run in no more than
    one frame time. It does burn the CPU the whole time though, polling the
    displayed scanline register.

commit b930bb9d6da8c24dbe0949afb7bb2aa4bcb24687
Author: Eric Anholt <eric@anholt.net>
Date:   Thu May 3 13:44:12 2007 -0700

    Disable vblank interrupts when no DRI clients are running.
    (cherry picked from commit 6621dd71ada839f4c1742e9e5b272e924cee21d9)

commit 3b769af53e0ef6ef9b56afd679446c73a0e63ea5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu May 3 13:44:12 2007 -0700

    Disable vblank interrupts when no DRI clients are running.

commit 775fc125aa7ecd0f054959ef210be2df4dc54345
Author: Dave Airlie <airlied@airlied2.(none)>
Date:   Thu May 3 20:58:50 2007 +1000

    i810: be a bit more verbose about disabling DRI

commit 34f362d099d255f8f0bb34e9de30f953ee770163
Author: Eric Anholt <eric@anholt.net>
Date:   Wed May 2 15:40:49 2007 -0700

    Fix typo s/i/index/ in LoadPalette for depth 16.
    
    Reported by:	Haihao Xiang <haihao.xiang@intel.com>

commit f850d4727a2ad55c2116d0788f6684b2a0192d24
Author: Eric Anholt <eric@anholt.net>
Date:   Wed May 2 14:16:21 2007 -0700

    Make up a fixed panel timing for DVO LVDS, and use DVOA for DVO LVDS.
    
    The fixed panel timing will only be available when the LVDS is already on
    at X startup.
    
    So far, our only mostly-working LVDS driver is for the i830, and on i830 the
    LVDS is always on DVOA, so use that for all LVDS chips.  This may need to
    change if we support the ch7017 I've seen used on embedded i845, for example.

commit f3168e3b0c5664a322ca6bb1c81fc94844cb30ab
Author: Eric Anholt <eric@anholt.net>
Date:   Wed May 2 14:08:30 2007 -0700

    Disable non-working GTT decoding on i830, and fix map/unmap of GTT.

commit 1fc630f24f8ad9e304cb0761f9cacca2224203c4
Author: Eric Anholt <eric@anholt.net>
Date:   Wed May 2 13:29:21 2007 -0700

    Add DVO[ABC] register debugging.

commit d0ec37e9c0ceab1080700cd7be4a7cc58552d465
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 1 15:56:37 2007 -0700

    Make the DVO output name LVDS if it's an LVDS chip.

commit 490d05f99d2b62dd612d514d9ae0badbac9285ce
Author: Eric Anholt <eric@anholt.net>
Date:   Tue May 1 15:47:01 2007 -0700

    Fix typo in previous commit with s/XF86_DRI/XF86DRI/

commit c7bb34e83d7c459d932d01070cfeffbbf6c703ac
Author: Dave Airlie <airlied@linux.ie>
Date:   Wed May 2 14:25:39 2007 +1000

    disable all outputs on EnterVT
    
    This disables all outputs on EnterVT as the SDVO output can confuse
    the VGA output if the BIOS has enabled it on the same pipe but X
    isn't going to use the SDVO.
    
    Worked out on irc with keithp

commit cae0ae237b79fa7d3a82dfc8d3fb595ccb6c63e1
Author: Samuel Thibault <samuel.thibault@ens-lyon.org>
Date:   Tue May 1 12:41:18 2007 -0700

    Bug #10714: Fix build without DRI.

commit 6748d620fbf39dd98982856c09256bdec0fc82a1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 30 17:27:23 2007 -0700

    Ignore VideoRam now that its original purpose is obsolete.
    
    It had been necessary to allow more than a small amount of memory to be
    allocated, but now those old small allocations people had configured are
    getting in the way.

commit a4f1a7872f6f959bb4bc6568face710bee3589de
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 30 17:13:09 2007 -0700

    Allow physical-memory allocations within stolen memory.
    
    Because stolen memory happens to be a contiguous block of high system memory,
    we can just read the GTT entries for it to get physical addresses for our
    allocations there if needed.  This reduces fragmentation of the aperture space,
    and will often reclaim up to 7 MB of memory that had been left unused since the
    simplified aperture manager was put in place, but without reintroducing the
    complexities of the old aperture manager.

commit 7d0d34cfdcc67d07e7667e13a9413743853134f8
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 30 10:39:54 2007 -0700

    Disable some clock gating functions documented to work incorrectly.

commit 138ac8f36cb4e4b3776f313955372522646acbb2
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Sun Apr 29 14:43:19 2007 +0800

    Alloc state mem buffer on 965G for xaa rotation
    
    965G needs state mem buffer to setup render pipeline.
    Thanks Barry Scrott for report this.

commit 0cd524e5411e35c8483c02ecc5062625809e6fc6
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Apr 25 18:09:10 2007 -0400

    Implement the custom I2C protocol used by the ivch DVO.
    
    The ihch DVO uses a modified I2C addressing scheme as described
    in section 5.2 of the data sheet.  Implement this by over-riding
    the I2C read and write word routines.

commit 880314aabe6326ed56517034940f0e10fb16e866
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Apr 24 11:37:08 2007 -0700

    CRTC Rotation under XAA wasn't hitting accelerated path.
    
    The server rotation code is now using the root window in IncludeInferiors
    mode rather than using the screen pixmap. Change the XAA Composite code
    to check for this case now.

commit b23eae55c8cdd73e0aba1bf7ced283d402ee6470
Merge: 31bf269 cebdb8b
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 20:38:18 2007 -0700

    Merge branch 'origin'

commit 31bf269afed0a830e79cbbd9d4b1ee9843af326c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 20:03:41 2007 -0700

    Update version to 2.0.0

commit cebdb8bfc6170a0fb441039f4422917fd0c77e70
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Apr 20 10:54:34 2007 +0800

    EXA: set enabling bits properly for i830
    
    This was found when debug exa on a 865GV, we should set
    pipeline state bits properly, otherwise the engine will hang.

commit 60e891915af7d0f522c9c3f966599fa07779f7aa
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 14:02:23 2007 -0700

    Eliminate LinearAlloc option and code.
    
    With the fixes to the 2D frame buffer allocation that allows up to 65536
    lines of 2D frame buffer in XAA mode, the old linear allocation hacks are no
    longer necessary.

commit cca389769001c657435f056e1f1c26b0f52a48bd
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 13:15:23 2007 -0700

    Clean up 1.2 xserver build support.
    
    Convert relative X server source path to absolute.  Check for local copies
    of needed header files before building, rather than requiring server source.
    Remove extra duplicate -I elements in AM_CFLAGS in sub directories.

commit 07797fee88d6be0dfb30394a419dd86f8a3c9095
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 13:01:37 2007 -0700

    Fix mismatching braces when XF86DRI_MM is not defined.
    
    A closing brace was left inside #ifdef XF86DRI_MM while the matching
    open brace was outside.

commit 163c565527e8cda1f5a47c7fd63f04c80feaf3c7
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Apr 19 13:00:03 2007 -0700

    Use I2C delay function instead of usleep.
    
    usleep isn't always available, and we have an existing delay mechanism
    available to use.

commit 378ceea3d9ddbec7a08ac2f07f9a8cd9cf3cef36
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Apr 19 17:30:28 2007 +0800

    Fix mem list order and remove extra unbind call when free memory

commit db4b9e18810990e8900bdf54aa3091b876ea2658
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Apr 18 13:52:08 2007 +0100

    Fix return status

commit 3f5111940e35989d334aa99cd1b0eb26293ebf1b
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Apr 18 13:27:59 2007 +0100

    Update read_response to include the try on PENDING status
    
    and remove it from get attached displays call.

commit 902388fa06f85486fe8010807ab53e4926cc979a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 17 14:21:25 2007 -0700

    Don't try to init the XAA linear region unless we allocated memory for it.
    
    Reported by JM Ibanez

commit 8abecae202b609375b6754dbd5ecce3d59036daf
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 17 12:28:43 2007 -0700

    Fix i852 EXA Composite acceleration setup.
    
    Reported by JM Ibanez.

commit 2dbe8d678b02b724c4f06255383f49bb4c2708b0
Author: Timo Aaltonen <tjaalton@cc.hut.fi>
Date:   Mon Apr 16 14:14:19 2007 -0700

    Fix build against xserver 1.2.

commit a089ac11beb4c801928c17780401e913bc0d5257
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 17 11:01:05 2007 -0700

    Add all the possible ivch slave addresses (still commented out).

commit 37ee68a95ca8c86ebe9abafaaf55b060dd2a2f73
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 17 10:50:02 2007 -0700

    Bug #10438: Fix 965 XV when sourcing from less than the full image.
    
    Bob deinterlacing in MythTV, and the zoom options in totem would result in
    attempting to source from outside the video instead of scaling appropriately.

commit ac9181c014638dbeb334b40b4029d0ccb2b7a0fc
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Apr 17 16:30:17 2007 +0100

    Check for the PENDING message when reading the attached
    displays. Ensures the command has completed before continuing.
    
    (probably need to check PENDING in other SDVO calls too)

commit ab5bdee8a62c842ae32aaef57eb841ebcb644d2b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Apr 17 16:23:46 2007 +0800

    EXA: fix i830 render
    
    Fix tex blend pipeline in case that src/mask pict has no
    alpha. Unmask color buffer write disable bits. These make
    rendercheck run fine on 855GM.

commit 1a29750b8dba1371d7d0802744cdf2f3bfa83c13
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Apr 16 16:21:39 2007 +0800

    EXA: fix 830/845G pict format
    
    Fallback in 830/845G when pict format is a8, x8r8g8b8 or
    x8b8g8r8. The hw doesn't support them.

commit 3a634bbd198650c1597dec4306d99928374c30f3
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Apr 16 15:14:49 2007 +0800

    EXA: Add i830 supported pict format XRGB8888, XBGR8888

commit 3bcb9a0b4ba7f3df346b5708617a7aafcbe2490a
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Apr 16 14:27:49 2007 +0800

    EXA: i830 render misc fix and cleanups
    
    Try to map texture stream when setup texture map, and use
    correct order in load_immediate_1 cmd, which fixed crash on
    845GV. Also remove some flush cmds.

commit 64c30cf896f8bde3ee74c92b970132ab91b418cd
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Apr 16 13:58:50 2007 +0800

    Update intel.man with 965GM chipset support

commit b67adb6de34cede0e31f02f26cd5ec7b1adfa586
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Apr 13 22:34:52 2007 +0800

    Fix crash on G965 XAA with LinearAlloc option
    
    We should alloc xaa_linear mem in LinearAlloc case, otherwise
    we get crash when initializing xf86 fb manager.

commit b5b243e4120d6a048fb6bbe8814fe3184271e9d9
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Apr 12 12:34:23 2007 -0700

    Add license headers to 965 programs.

commit 08cd5f9b0f086e51112008d50de48556372899f9
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 10 11:26:46 2007 -0700

    Bug #10520: i810 manpage not installed despite users expecting it to be there.
    
    Install it as an alias to intel.4x, since we're letting people load the driver
    as "i810" still.

commit bf9771e9711361632afe3abeeedca7ce03497005
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 9 15:26:05 2007 -0700

    Don't use extended regexps in sed when not necessary.
    
    Some seds require a flag to enable extended regexps.

commit 656fbd952542ba5ddc9b018071008ceb38b1bd19
Author: Brice Goglin <brice.goglin@ens-lyon.org>
Date:   Mon Apr 9 13:06:46 2007 -0700

    Bug #10515: Fix module version number with more than one digit per field.

commit aa850d3c633a510d787ee59e538e26e5c3acbf4a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 9 11:44:25 2007 -0700

    Turn off ALWAYS_SYNC in EXA.
    
    This slipped in as a debugging aid, and never got turned off.  The driver
    appears to work fine without it on an i915 system, and for the non-default EXA
    option, we'd rather see issues found than continue running with debugging aids
    and hiding them behind bad performance.

commit d2e75d8acde2541b85a0050d9e47182c1db7fc2c
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 9 11:34:57 2007 -0700

    Avoid a magic number and correct a (currently harmless) ifdef in ResetState().

commit 9ed446e12bd21b7c8222c6e63a03a8e2ec6b97e2
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 3 11:39:48 2007 -0700

    It's 2007 now.  Didn't I get the memo?

commit d9d05b553ca1f98efc230ef13f34576122311ac1
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Apr 3 00:15:02 2007 -0700

    Bump version to 1.9.94 for 2.0 RC4.

commit eb45315b07624cb0506d539f523728a651efb798
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 2 18:20:33 2007 -0700

    Move README to being a plain old text file.

commit 9b78208f1ef1a8ee98f2aa139956659169e234ab
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 2 18:20:15 2007 -0700

    Move a bunch of debugging verbosity under Option "ModeDebug".

commit 9ea83d440d6b9e30d4627e34168226a6b4b2a841
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 2 11:39:27 2007 -0700

    Update README source for new release notes.

commit c6d0bf9fb6033339159d98dc2b9fe44759ad9de5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Apr 2 10:09:43 2007 -0700

    Remove long-stale TODO file.

commit c59e5895a0ea1f219c8f63a02b429a024bd1ed66
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Apr 2 07:18:04 2007 +1000

    make warning info only so ppl don't go reporting stupid bugs

commit e119eaabb2ad1ffc1d83f18199f49c52ec71b0fe
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 30 17:09:18 2007 -0700

    Warnings cleanup in ch7xxx.

commit fd98e88d1a6e0e8d35bda868e7afcb78d2d11524
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 30 17:07:29 2007 -0700

    Finish off some function renaming that was missed before.
    
    Thanks to alanc for catching this.

commit 274b99e5e750228eba9a67773725a40ebaa9bf56
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 30 17:06:43 2007 -0700

    Don't forget the warnings CFLAGS in subdirectories.

commit aa6a9abb34e93780c07563ab5b21d8c064ea0a1c
Merge: 670c852 107ac12
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Mar 30 12:10:17 2007 -0700

    Merge branch 'crestline-qa'

commit 670c8521f18f01b9ea899ceb68d2a3dbb884b199
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 29 13:43:31 2007 -0700

    Add missing file for old server compatibility build.

commit 89c84f939f2dbed1d03a5f0e1daae23a229e47bc
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 29 13:40:52 2007 -0700

    Whitespace cleanup in Makefile.

commit 6cd3b2c2de4596886aab85988b16cf63e8887add
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 27 15:34:32 2007 +0800

    EXA: i830 fix blend action
    
    i830_get_blend_cntl() has already added S8 offset.

commit 35b3dd881a333569ce20ddf36b915b095757a1ba
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 27 15:33:43 2007 +0800

    EXA: fix i830 componentAlpha support
    
    Pick fix from i915 render, change tex blend pipeline for CA.

commit df96d9a11d038ad64673022ce14c24223b3bd34c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 27 15:32:53 2007 +0800

    EXA: fix i830 texture setup
    
    Use LOAD_IMM_2 helper cmd for tex setup. Enable RepeatNormal
    support. Fix A8 format, i830 can support it now.

commit aa78e67553ffe8ca986330f0ee49b5414c71a71f
Merge: 768821b 2191634
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 26 22:00:36 2007 -0700

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 107ac12867eda6b86212159db15c640d3490f2da
Merge: 6548817 2191634
Author: Nian Wu <nian.wu@intel.com>
Date:   Tue Mar 27 12:51:45 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 768821bd3832aad01e44856199e60c6b7726a83b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 26 21:27:54 2007 -0700

    Bump version to 1.9.93 for 2.0RC3.

commit 2191634dd67b3219bb88f365bcf951d5a58140e8
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Mon Mar 26 14:58:41 2007 -0700

    Add Solaris to list of OS'es with agpgart in man page

commit 1c809f92467f97b098bcc89d66e60f6f88d9bade
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 26 13:03:28 2007 -0700

    Update .gitignore.

commit f7befe50af4c13554d1f7aee6b05848ac312411b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 26 13:01:11 2007 -0700

    Power on the LVDS B-channel pairs only when we've chosen dual-channel mode.
    
    It was basing off of the clock rate, but we have an override to use the
    existing dual channel state when we can detect it, so the two settings were
    conflicting.

commit 827dc457a4fd0b97c95ec696ec9c3cd2f4a4becb
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 26 12:45:23 2007 -0700

    Update manpage to remove Rotate option and point at xorg.conf instead.
    
    While here, update a few other bits as well.

commit 654881794ae1ad7214e85091b9015ae0fbdc5ddc
Merge: 6de3edc d572771
Author: Nian Wu <nian.wu@intel.com>
Date:   Mon Mar 26 17:00:11 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit d5727717c9141be28a69b1154ccd23c23207f8f6
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sun Mar 25 23:44:59 2007 -0700

    Switch TV_FORMAT property to format XA_ATOM
    
    This allows the driver to report the set of valid formats in the property
    data.

commit 6de3edcb52e6258f1af75e4f4bef73de1698445d
Merge: d874aa3 1e6e675
Author: Nian Wu <nian.wu@intel.com>
Date:   Sat Mar 24 17:00:13 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 1e6e675524461ef0eb1983de89e2877426571a55
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Mar 23 23:42:52 2007 -0700

    Eliminate calls to RRPostPendingProperty.
    
    RRPostPendingProperty has been removed in favor of RRPostPendingProperties,
    and that call is now managed outside of the driver.

commit 28da6f4e307880326dd553f50fe3fff3b9be9f4f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Mar 23 14:36:42 2007 -0700

    Record 3D state loss at EnterVT in last_3d value.
    
    last_3d set to LAST_3D_OTHER indicates that the 3D hardware has unknown
    state.

commit ab19439cf4592e4607dc0bfc602aba3d56645a42
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Mar 23 14:34:27 2007 -0700

    Don't call AdjustFrame on EnterVT.
    
    AdjustFrame is strictly for legacy compatibility; calling it on EnterVT
    wrecks crtc positions.

commit d874aa31599da4777438cc51469afe9b66601f55
Merge: 94dbc37 26f32ef
Author: Nian Wu <nian.wu@intel.com>
Date:   Fri Mar 23 17:00:12 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 26f32ef680a19e63af4b7c8c84141fe32263f298
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Fri Mar 23 01:17:58 2007 -0700

    Property size is in units, not bytes.
    
    Several places were using byte lengths instead of unit lengths for
    properties.

commit f48dc501fbf74e0ac348f0b77750016597849ef4
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Fri Mar 23 01:08:08 2007 -0700

    TV output properties: TV_FORMAT, LEFT, TOP, RIGHT, BOTTOM.
    
    Remove TV format from mode name, instead use an explicit output property and
    split the input resolution from the tv format. Add properties to set the
    blank area on all four sides of the image.

commit 94dbc3725358d63fe0ac8e6749489c993d24ede2
Merge: 28af380 20b2685
Author: Nian Wu <nian.wu@intel.com>
Date:   Thu Mar 22 17:00:15 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 20b26854abdacb6dc45cba2d81d515b2e47e25f1
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Mar 22 10:33:15 2007 +0800

    EXA: don't smash vertex header in G965
    
    Originally we smashed vertex header to store texture
    coordinates, this is working as we only use sf/wm kernel
    and disable all other stages on pipeline. But better to
    not do this. This also cleans up vertex elements state
    and makes vertex buffer order looks "normal".

commit 28af380ab133eb14d21dc650c77bdbab66576255
Merge: 300e893 e06c5f7
Author: Nian Wu <nian.wu@intel.com>
Date:   Wed Mar 21 17:00:04 2007 +0800

    Merge branch 'crestline' of git://otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit e06c5f727fb2e2de111ac9e691a877c56d2ca1b4
Merge: 0202399 3025fa0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Mar 21 15:04:21 2007 +0800

    Merge branch 'master' into crestline

commit 02023998663cc7f0735fadfb1719d93dc2e5a112
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Mar 21 00:00:56 2007 -0700

    Whitespace and symbolic reg names cleanup in i830_panel_fitter_pipe().

commit 3e9ec78b4f54defb9986e11e6f2ac3475755849d
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 20 23:58:48 2007 -0700

    Set the panel fitter to the right pipe on Crestline.

commit 3025fa0fb2bf5ace7076796e45e2560fe8410e8d
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Mar 21 14:50:45 2007 +0800

    EXA: try to enable rotation for G965
    
    The new sf/wm should handle the texture sampling only in
    rotated case. Also fix possible hole in VUE slot.

commit a50009604152bf9237c40bd098b3b1da3d018929
Merge: 0a612e7 2239448
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 20 23:32:19 2007 -0700

    Merge branch 'master' into crestline
    
    Conflicts:
    
    	src/i810_reg.h
    	src/i830_display.c

commit 300e893cec19dca48e00ee25014b8714dc13b278
Merge: 96e8699 0202399
Author: Nian Wu <nian.wu@intel.com>
Date:   Wed Mar 21 08:55:50 2007 +0800

    Merge branch 'crestline' of git://otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit 223944878cf38f86580df5a7d3102d86cfc061b9
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 20 14:33:53 2007 -0700

    Attempt to fix single/dual-channel issues on i9xx LVDS panels.
    
    - Use the existing single/dual-channel state when available, as changing it
      doesn't appear to work out.
    - Set the power state of the CLKB and B0-B3 pairs according to whether
      choose to go dual-channel or not.
    - Restore the LVDS register at the appropriate point (before DPLLs are
      re-programmed.

commit 96e86994f3d1b4938e99a751454ee99bebfe40d3
Merge: f465c23 0a612e7
Author: Nian Wu <nian.wu@intel.com>
Date:   Tue Mar 20 13:11:09 2007 +0800

    Merge branch 'crestline' of git://otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit 0a612e7115ff993bb8e9a00df13c0b0d20122fd6
Merge: 8bb6778 4c4faf2
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 20 11:34:40 2007 +0800

    Merge branch 'master' of git://proxy.ims.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline
    
    Conflicts:
    
    	src/i830_display.c
    
    Change LVDS output and postread like upstream. This might
    need to be retested on 965GM LVDS.

commit 4c4faf260eb4dad1b1919c6168fa9ef477b98a39
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 19 13:36:37 2007 -0700

    Set the CURSOR_SIZE register when present.
    
    Failure to do so gets you a lot of pretty colors.

commit 64c14204453bea3f98d19861c450612e718e6c69
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 19 13:35:43 2007 -0700

    Print the mode actually being set per pipe.

commit 3ce802414a20ca8af128a00e6925a099dd90ceb4
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 19 11:35:11 2007 -0700

    Add debug output for ADPA.

commit c21b88d838fda1f00f6f6bcfe7855d32543c6f3f
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 19 10:45:58 2007 +0100

    Fix build when DAMAGE is not defined.

commit 991719c21a6cc1b5d9b7cbe30d4b333718b3e686
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Mar 18 23:05:33 2007 -0700

    Make i830_sdvo_write_sdvox write everything twice.
    
    For some reason, certain chips don't correctly enable the SDVO hardware when
    this register is written only once. We're following what the BIOS code does
    and writing it twice now, but with extra posting reads to boot. Yes, this is
    cult-and-paste, but it fixes problems found on deployed hardware.

commit 9118122a232d4cf7760bcb0874fe970c25251378
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Mar 17 21:34:03 2007 -0700

    Allocate 4 separate buffers for HW Cursors on Linux.
    
    Linux cannot allocate a large fixed buffer for the HW cursors as needed for
    FreeBSD; instead, allocate four separate buffers. The code now prefers to
    allocate one buffer (less overhead) and falls back to separate buffers only
    when necessary.

commit 62a5399d70ac3f8579441d617f8d80c94942a32a
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Mar 17 21:32:36 2007 -0700

    Elide I830DRIClipNotify for older DRI versions.
    
    I830DRIClipNotify is passed to newer versions of DRI; don't include it in
    the server when building against older versions.

commit 05e0021147a89254182c277007236448f315231c
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Mar 17 21:31:04 2007 -0700

    Cast ARGB cursor address to CARD32 * to eliminate warning.
    
    While we're just doing a memcpy, it's nice for the two argument types to
    match.

commit d05bb5362e986c9d27bc03c7e1a939ba28824810
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Mar 17 20:21:59 2007 -0700

    Increase DDC I2C RiseFallTime to handle older monitors
    
    Changing this value slows the entire I2C bus down, making it far more
    reliable on older monitors. Note the same change has been made in the core X
    server code; this change is included here to ensure that older X servers
    work reliably with this driver.

commit 44d1b544cec2e75735d2e27d66a9240317b962c2
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Mar 17 17:15:43 2007 -0700

    Build fix for pre-XF86DRI_MM environments.
    
    Misplaced brace broke builds with older DRM libraries.

commit a58befe9d243bd562cb4b2f08ec5c9f754148c20
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Mar 17 17:12:37 2007 -0700

    Remove extra (and incorrect) I2C ByteTimeout setting.
    
    Setting the value correctly and then immediately breaking it caused many I2C
    transactions to timeout with slow monitors. Oops.

commit 9d6d9ace4bd3180a4484321c3b96a83bc4adaf84
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 16 19:41:54 2007 -0700

    Move vendor ID check in the utils to after pci_device_probe.
    
    Even current libpciaccess seems to require this.

commit a117bc9e3eb824f2056ee6416859ea3ab1fdcc30
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 16 19:39:34 2007 -0700

    Add the (afaict) correct ch7017 I2C slave address.

commit 29446cdb4f72e12c5249b0d4b79ea56d9fe19934
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 16 19:18:37 2007 -0700

    Fix compile failure due to needed types being in inttypes.h on Linux.

commit 213394fbaaf353404cbb3aaa4c20860f48ee1079
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 15 19:13:28 2007 -0700

    Fix crashes and other failures when a cursor allocation fails.
    
    Now, we allocate one single block of memory for cursors, and either succeed or
    fail once, rather than trying to support partial fallback modes that generally
    resulted in pain due to being untested.  In particular, this fixes cursors on
    FreeBSD, which only allowed one large physically-contiguous allocation.

commit 316ee682d342556b65cbd60409201591e916aac5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 15 18:53:55 2007 -0700

    Don't reload the cursors if we haven't set up the screen yet.
    
    This avoids a crash during preinit if we set a mode for load detecting.

commit 8b06ab50bbd79dfaf4c90a6f76116ace64b85b77
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 15 10:12:14 2007 -0700

    Fix sparse warnings about using 0 for NULL.

commit 8ae6ad93329e2842c6f2d5b20ffeb0c14d10c0de
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Mar 15 00:00:51 2007 -0700

    Use new driver-independent CRTC-based cursor layer.
    
    This eliminates all of the cursor rotation code and other cursor management
    infrastructure, leaving a fairly simple hardware layer in its place.

commit 9fbef2de9edbbed9c2f6a80c4074b9b245547c45
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Mar 14 12:34:34 2007 -0700

    Bump to 1.9.92 for RC2.

commit 555b801a75cafa082808bc9bb683e700fc97d79a
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Mar 14 11:41:50 2007 +0100

    Make sure the legacy texture area is there when needed.
    
    This currently only matters when the DRM memory manager is not available and
    Option "Legacy3D" "off" is specified, but that hasn't always been the case and
    might change again in the future.

commit 66fdb08c83d353fbe4e917900c54b555c869eb80
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 17:07:10 2007 -0700

    Refine the i855 LVDS clock code.  In particular, p2 is always 14.
    
    This gets correct clocks detected on most harware.  The SSC is always assumed
    to be 66Mhz, which may not be true, but we'll fix that when we find example
    hardware.

commit 44708bdd9ebfef0328302c9a964b80deb46e57c6
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 16:55:38 2007 -0700

    Get SDVO DPMS working on the Mac Mini by writing SDVOB and SDVOC together.
    
    Also, add code for setting the encoder power state like the BIOS does, but this
    doesn't appear to work.  We do much more than the BIOS does in powering things
    down, so perhaps that's interfering somehow.

commit 5135b3a79f9c30ebce78c84c49846bba83607fed
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 10:21:06 2007 -0700

    Use a POSTING_READ(reg) macro instead of using the (void)INREG(reg) pattern.

commit 578da7ca705c5a58c0bd397b0831e2f95140f8ae
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 10:11:29 2007 -0700

    Add PCI write posting protection to i2c putbits.

commit cf33abe43bd95c9437fad8e6201a24084ff96cb8
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 10:08:57 2007 -0700

    Add write posting protection for the SDVO DPMS-on path.

commit 9d30f0007203157e6b82fa0ffc57324490eb2ca0
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 10:04:06 2007 -0700

    Replace #if 0ed LVDS register setting with updated comment.

commit 9c17c6e9c63563cad5edff837519a73fe0afe313
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 09:55:49 2007 -0700

    Add write posting protections to relevant register writes in the mode-set path.

commit 2824ec7ccbf44ba413a6133f735f4a548c73b3cd
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 13 09:53:35 2007 -0700

    Fix uninitialized string use in SDVO non-TMDS case.

commit f465c23750adf908c0ea874f95aad98ebd2f1015
Merge: d33e8da 1ed3843
Author: Nian Wu <nian.wu@intel.com>
Date:   Tue Mar 13 17:00:44 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 1ed3843f73a0d8efa405daff3483ebe70bf6134f
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 12 17:47:32 2007 -0700

    Make the 965 use Y-major tiling for the depth buffer, as required by the spec.
    
    An example of the failure can be seen with the reflect demo when set to
    depth buffer mode.
    
    Reported by:	Haihao Xiang <haihao.xiang@intel.com>

commit 7aa257154685bd2520649ce87a3a84e55644d02c
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 12 19:00:14 2007 +0100

    Fix build against released libdrm.

commit 7c561956a28e90667fef140bc3cfa0edca464f15
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 12 18:55:27 2007 +0100

    Defer flipping pages back to normal until the end of the DRI block handler.
    
    Doing it earlier can result in the wrong page being visible, giving the
    appearance of a frozen X server.

commit fe59ab9f562fd10118563d80eb3351a4d3b48b3f
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 12 13:03:47 2007 +0100

    Disable page flipping if the DRM is older than 1.9.
    
    Older versions don't support the functionality we need.

commit ba55ff15df974197bebd871e28bb96d817ae41c7
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 12 13:01:00 2007 +0100

    Fix attempt to flip pages back to normal when the last 3D window disappears.
    
    When this succeeds, 2D rendering does not have to be synchronized to back
    buffers until the next 3D window appears.

commit c4a23c5ef8ce56ee0fe547fbc7c6623c021f801b
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Sat Mar 10 16:15:33 2007 +0100

    Remove unused have3DWindows from pI830.

commit d33e8daa6874ced978d2a1f687c48922555f2524
Merge: 58aeb87 797aa6f
Author: Nian Wu <nian.wu@intel.com>
Date:   Mon Mar 12 09:03:52 2007 +0800

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 797aa6fcb1231587bde1efb47bc8430c4c8d8110
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Mar 11 12:58:50 2007 +1100

    fixup missing assert includes

commit 43a80ef9094efcb49027c83f0e726f907fecfbb2
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Mar 11 12:58:26 2007 +1100

    fixup brace alignment for older X.org

commit 0d33fd3d03cef3a7e63d88ae441354390b37a937
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Mar 11 12:58:02 2007 +1100

    add XMODES flags to the i2c drivers

commit 3c2d6e07bdf8daef6486b594aef0d22460eb2585
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Mar 9 23:49:46 2007 +0100

    Don't crash when the SAREA pointer is NULL.

commit 7518b8959ee7598f3526365a83ea7e143a5d6a4e
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Mar 9 19:50:03 2007 +0100

    Revert change accidentally included in previous commit.

commit 1991a90ae90b388c914985d20d6f8c3637856e9a
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Mar 9 19:47:13 2007 +0100

    Update SAREA pipe sizes in i830_crtc_dpms instead of i830PipeSetBase.
    
    This allows setting the size to 0 when a pipe gets disabled.

commit aef161853033907c6916337cebe88c8f111dd542
Merge: 1b54ee4 14ee919
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Mar 9 15:14:48 2007 +0100

    Merge remote branch 'origin/master' into i830-pageflip

commit 1b54ee493fb96f944aa81e56fa6f00a8067f87fc
Merge: e972265 81722a2
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Mar 9 15:13:50 2007 +0100

    Merge remote branch 'origin/master' into i830-pageflip
    
    Conflicts:
    
    	src/i830_dri.c

commit 14ee9195d203192d3f613919f230b20b900ffdba
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Mar 7 13:00:03 2007 -0800

    Bug #10157: Fix cursor corruption on server regen.

commit 58aeb87f2e335d15eba73ce9dd1982e867c52403
Merge: a4e7e81 81722a2
Author: Nian Wu <nian.wu@intel.com>
Date:   Wed Mar 7 16:02:03 2007 -0500

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit a5f0522b1d34236278861fe15bac2df099f0a2c7
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Mar 7 15:49:47 2007 +0000

    Add some additional checks when XAA is enabled.

commit 81722a21d232fa6cfb11fbe3d984abab50e89bcc
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Mar 6 23:16:53 2007 -0800

    Remove usage of 'shadow' module. Use xf86CrtcScreenInit.
    
    With the new mode setting code, rotation is handled outside of the driver,
    so the old usage of the 'shadow' module is no longer needed. Code to
    initialize the crtc structures has been moved out of the driver and into the
    modes code.

commit 04f50961e2f1610c39e7e4b45811f2a6b517cad6
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 6 14:23:06 2007 -0800

    Bug #9898: Fix a crash with NoAccel set.

commit b07dfbba5df7728232b38211c623185116dcea5c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 6 13:59:14 2007 -0800

    Remove leftover code that was disabling tiling after we set it up.

commit 94c37f35872487c04136fb659526bffefd9c46ad
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 6 13:57:04 2007 -0800

    Make the depth buffer X tiled instead of Y, and fix a Y tiling nit on 945.
    
    The previous code claimed to set the depth buffer up as Y tiled, but due to
    lack of implementation in SetFence, it ended up being X tiled.  Actually
    setting the Y tiling flag in the new version broke the depth buffer, so just
    switch the depth buffer to X tiling, which appears to work fine.

commit a4e7e814a24dbe30a33e6ad45baeb41d190a2724
Merge: 862088b 4042b27
Author: Nian Wu <nian.wu@intel.com>
Date:   Tue Mar 6 16:01:40 2007 -0500

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 30bb719ca0abc2599ffb89e59f297fa9a0a00c3c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Mar 6 12:23:43 2007 -0800

    Continue to allocate the legacy texture pool by default.
    
    This is a partial revert of 7358642e64ab6d13bc1dc1a44703ee66d715ff61
    
    If we don't allocate it now, when the DRM version is too low there won't be any
    memory allocated and DRI will fail.  Instead, waste the memory in the i915tex
    case for now, and leave fixing it right (check DRM version up front and decide
    which memory manager to set up) to later.

commit e972265261c421268e4fb806e587378d0adec577
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 16:54:16 2007 +0100

    Fix build failure.
    
    Not sure how I missed this before... Thanks to Todd Merrill for reporting.

commit 862088ba6a91d3e7cf8d37126b1d9f4ee03a1f73
Merge: 11e9158 d717d9d
Author: Nian Wu <nian.wu@intel.com>
Date:   Tue Mar 6 07:43:16 2007 -0500

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 1e1b45fa6ed1683cba4ae73ac98933e74c3ab9d6
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 10:28:41 2007 +0100

    Fix reduced DRI memory manager size.
    
    pI830->mmSize is in kB.

commit 3c08bc7d6974a1a6cf5f9cb81898617032966c52
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 10:14:47 2007 +0100

    Fix some conditionals related to triple buffering.
    
    Guard code that dereferences pI830->third_buffer with tests for that instead of
    pI830->TripleBuffer. It could happen that we want to enable triple buffering
    but (temporarily) can't because the third buffer couldn't be allocated.

commit c25cfafbe1eb380b58b5fc16e94f5cc6f422f0cd
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 10:00:12 2007 +0100

    Unify allocation of back buffers.

commit e787d7b698d320a7c45df35d58c5113413561fe2
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 09:35:42 2007 +0100

    Remove warnings about potential artifacts with page flipping and mixed 2D/3D.
    
    The artifacts only seemed to occur when EXA was falling back to software for
    the front buffer.

commit 6c299aea8e87e72c68c96c03594706c976601ede
Merge: 3308152 4042b27
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Mar 6 09:28:52 2007 +0100

    Merge remote branch 'origin/master' into i830-pageflip
    
    Conflicts:
    
    	src/i830_display.c
    	src/i830_driver.c

commit 4042b27f01fdb94e7fc0d4e991e054fff88479ea
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Mon Mar 5 22:32:52 2007 -0800

    Move EnterVT mode setting code to xf86SetDesiredModes.
    
    Make the application of crtc desiredModes generic code instead of
    per-driver by creating xf86SetDesiredModes from the code that was in EnterVT
    and calling it.
    
    Also, move the frame buffer clear until just before mode setting to make
    sure things are mapped correctly.

commit 55ee46aebbf1ec1a8ce914fbd0c8894fc857db8f
Merge: 5c72014 50aa094
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 6 12:45:08 2007 +0800

    Merge branch 'master' of git://proxy.ims.intel.com:9419/git/xorg/driver/xf86-video-intel

commit 5c720147e2b86ca4046b7c3812c1ca6b0fb78c9d
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Mar 6 12:44:04 2007 +0800

    EXA: try to always alloc exa i965 state buffer in stolen mem
    
    I think this is a safe way to work around any possible chip
    error.

commit 11e91586169b4f4bf2b41c0e0e620a69670c2f07
Merge: a24962a 0150270
Author: Nian Wu <nian.wu@intel.com>
Date:   Mon Mar 5 16:00:20 2007 -0500

    Merge git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit a24962af9ed39fabca0152cae1265a29fe6237d3
Merge: 35e9310 8bb6778
Author: Nian Wu <nian.wu@intel.com>
Date:   Mon Mar 5 16:00:11 2007 -0500

    Merge branch 'crestline' of git://otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit 50aa09425f54c4eeca7f8b0fae9579209b10b9c4
Merge: d717d9d c2c6255
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Mar 5 11:28:46 2007 -0800

    Merge branch 'modesetting'

commit c2c62559e702e7de1fa2ef309fa647ab13564dc3
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Mar 3 23:12:54 2007 -0800

    Move single mode setting code to X server.
    
    Code to drive the global configuration from a single mode setting operation
    (from RandR 1.1, XFree86-VidModeExtension or XFree86-DGA) has been included
    in the X server now, so remove it from this driver.

commit 35e9310ef59873877422dcaf9a65b38789fc8ad6
Merge: c8e6f0b b27fa2c
Author: Nian Wu <nian.wu@intel.com>
Date:   Mon Mar 5 09:01:55 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 8bb677889d3f71cde671f17a3589939acad2c3b3
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 5 05:08:51 2007 -0800

    Fix 965GM SDVO by not setting fields in SDVO[BC] which have new meanings.

commit 330815251dee808754b328cd2fd60db39f2460eb
Merge: 50ba1ff 0150270
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 5 13:05:20 2007 +0100

    Merge remote branch 'origin/master' into i830-pageflip
    
    Conflicts:
    
    	src/i830.h
    	src/i830_dri.c
    	src/i830_dri.h
    	src/i830_driver.c
    	src/i830_memory.c
    	src/i830_xaa.c

commit d717d9d566fe3c0866b06840114e1c1990bd7be0
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 5 12:57:21 2007 +0100

    Fix DRM memory manager initialization.
    
    It takes the offset and size in pages, not bytes.

commit a0c83af3430b6705ab2ecae59085d1c74e890c19
Merge: c0f99b4 bc20b54
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Mar 5 03:37:53 2007 -0800

    Merge branch 'modesetting' into crestline

commit 7358642e64ab6d13bc1dc1a44703ee66d715ff61
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 5 11:53:09 2007 +0100

    Fix handling of new vs. old texture pools.
    
    Only one of them can be active.

commit 50ba1fff886a7f51b178ac6d3a1ba79a3014b214
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Mon Mar 5 10:22:07 2007 +0100

    Be more verbose when page flipping can't be enabled for various reasons.

commit 015027034e970f1e3bb6ab239f7e0119235e404f
Merge: 9a51064 bc20b54
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Mar 4 21:49:00 2007 -0800

    Merge branch 'modesetting'
    
    Conflicts:
    
    	configure.ac
    	src/i830_driver.c
    	src/i830_modes.c
    	src/i830_video.c

commit af565872a49a1a464ee4154c27136660b184c4c1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Mar 4 21:20:33 2007 -0800

    Set version number to 2.0 RC1 (1.9.91).

commit bc20b54c34088356a277beaebcc90bb4a7063e19
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Mar 4 19:35:44 2007 -0800

    Support new CRTC/Output prepare/commit hooks.
    
    New hooks replace explicit invocation of DPMS functions to manage mode
    setting sequencing.

commit b27fa2c257ccc49c6f29a20a3e672ebaaf58e7aa
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Mar 4 17:15:45 2007 -0800

    Fix a crash with XAA and DRI disabled after the allocation rework.

commit fc7d43c2b6b98be597152fbd88024273edd931d0
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Mar 4 17:14:30 2007 -0800

    Use -f for ln of server source. Otherwise, changing paths didn't take effect.

commit b7b6063e62927dd135e118c433f48b4d0b5fe246
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Mar 4 15:53:50 2007 -0800

    Add a little BIOS dumper program.
    
    This isn't actually tested yet as libpciaccess doesn't do rom access on
    non-linux yet.

commit 6aeb855b9d4e03d458773240a9c0c9c1edd3e403
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Mar 4 17:11:40 2007 -0800

    Shadow pixmaps use fixed offset of 0.
    
    Shadow pixmap contents are copied from the main frame buffer and contain
    only the bits displayed by the crtc, not the whole frame buffer. The crtc
    origin is always interpreted by the shadow copying code, the frame buffer
    itself doesn't move.

commit c8e6f0bac13e0e407f9771b1bbf126f023c1511b
Merge: 0ed5a2f c0f99b4
Author: Nian Wu <nian.wu@intel.com>
Date:   Sun Mar 4 09:00:12 2007 -0500

    Merge branch 'crestline' of git://otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit 7d08f720a95499e8d00dcd7174f06731de420017
Merge: dd24d2a 435d355
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Mar 3 23:13:03 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 435d35558d8135a2c1724dfd813fb4a9a4e14178
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Mar 3 22:46:31 2007 -0800

    Update for Aaron's xserver changes.
    
    Add xf86CrtcConfigFuncs to xf86CrtcConfigInit
    Add canGrow option to xf86InitialConfiguration

commit c0f99b4962553e560a5cb882a5060d95db5477a4
Author: Keith Packard <keithp@gamba.jf.intel.com>
Date:   Sat Mar 3 22:36:46 2007 -0800

    LVDS dither control moved from PFIT to LVDS register for Crestline
    
    The LVDS register now contains lots of new controls for dual-channel LVDS control
    along with dither enabling. The PFIT register has a lot fewer controls as a result.

commit 0fa3d4f51b5ee0dba3882fd74b6ac4e7da708f8f
Merge: 10655c4 fd52d63
Author: Keith Packard <keithp@gamba.jf.intel.com>
Date:   Sat Mar 3 21:02:17 2007 -0800

    Merge branch 'modesetting' into crestline

commit 0ed5a2fdcfe9674175aa9af155c20695ef41cadc
Merge: 7ba80cc fd52d63
Author: Nian Wu <nian.wu@intel.com>
Date:   Sat Mar 3 09:00:20 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit fd52d635603b7093c5a2b7fa9c987cf59f9be27c
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 2 13:44:57 2007 -0800

    Add a WIP UploadToScreen implementation.  This almost displays right.

commit ca0fa875e8bb5cb778d4db7d8053ec0a5ae34ef4
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 2 11:46:45 2007 -0800

    Move EXA offscreen memory back after framebuffer to avoid fallbacks.
    
    Without this, the EXA code decides that the framebuffer is not in video
    memory because it's not located between the start of video memory and the end
    of EXA allocator memory.  We should either have EXA let the driver decide if a
    pointer is in video memory, or add a new field for "end of video memory" (not
    just end of EXA offscreen allocation), but this fixes things for now.

commit 5a73624b9bcce0004e5b72c74667c9dd504b9c3e
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Mar 2 11:03:16 2007 -0800

    Fix a crash when an ARGB cursor allocation had failed.

commit 7ba80cc3a5e0f469e3ee55c7537fdc952cd85911
Merge: 9796cb7 d5df52b
Author: Nian Wu <nian.wu@intel.com>
Date:   Fri Mar 2 09:01:46 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit d5df52be59a7dd950e73336ce5698e73480108b0
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Mar 1 08:35:13 2007 -0800

    Actually add the files for reg_dumper.

commit 9796cb7ac4bd74d5336986bb194ff5875b028121
Merge: 42deb1e 1f5d166
Author: Nian Wu <nian.wu@intel.com>
Date:   Thu Mar 1 09:02:22 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 1f5d1666c8386ca4597c6f2c1ec239f9d821da4c
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 28 16:27:55 2007 -0800

    Add a non-installed command line tool using libpciaccess to dump registers.
    
    This reuses the i830_debug.c code, so we can run that from the console or from
    the BIOS-based X server to debug some remaining issues.

commit cd1d4b398ec91d551bdaaa26c769e5e6a9442df1
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 28 09:47:38 2007 -0800

    Many fixes to mode_get, mode_set, clock limits, and register dumps on i855.
    
    This should fix a number of issues with i855s, particularly with integrated
    LVDS panels.

commit 36cad3fcb65e3dcd88e58e301cd60adb121cb96b
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Feb 28 17:52:42 2007 +0100

    Update vblank pipe setup when setting a mode.

commit b5316fb2623e9630cbd58020e0a7c95bf354c587
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Feb 28 17:50:56 2007 +0100

    I830DRIClipNotify: Fix initialization of crtcBox[1].[xy]2.

commit 42deb1e10fc445d152b74e2b225daeaee2abb3d1
Merge: 76aac38 3e8e75e
Author: Nian Wu <nian.wu@intel.com>
Date:   Wed Feb 28 09:00:24 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 76aac382659bc1dab7dca078f703b9cf48b4ad74
Merge: 42fc06c 1ac83f5
Author: Nian Wu <nian@tinderbox.sh.intel.com>
Date:   Tue Feb 27 14:42:42 2007 -0500

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 3e8e75e5d83a2fa7e9fc6e9a3fbb07dac548ea5a
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Feb 27 16:48:48 2007 +0800

    Revert "EXA: enlarge 965 exa state buffer size"
    
    This reverts commit 1ac83f51ee46d65237eae1b5c767e106ac9e29bc.
    oops, current exa state + kernel program size + scratch space
    is actually ~36KB.

commit 1ac83f51ee46d65237eae1b5c767e106ac9e29bc
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Feb 27 13:58:47 2007 +0800

    EXA: enlarge 965 exa state buffer size
    
    Origin size seems break all render, be sure to assign enough
    mem. 80k works fine for me.

commit acd9f3e28fcf5e91e09d8bdca4cc58681b1fc92a
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Feb 27 13:56:31 2007 +0800

    Fix typo when assign overlay reg mem pointer

commit 5b765065c0bdf671b60d8a2fe512f6307f753eab
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 17:25:57 2007 -0800

    Consolidate shared structure allocation to the start of ScreenInit.
    
    Previously, the structures would get allocated unnecessarily once, and
    wouldn't get reallocated in time at server regen.

commit 6ed28c5aa34ff1d8b99a8d4721ddac7b9cac41ed
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 17:12:44 2007 -0800

    Fix XV issues on 965 after the allocation rework

commit 36bfeb890aeb17a8ee058790dd69b4e9aba644a1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 16:58:33 2007 -0800

    Move the initial EnterVT to after we've set up acceleration.
    
    This fixes a crash with initial rotation and EXA due to EXA not being
    initialized in time for the shadow pixmap setup.

commit 732885c08daaf17034da8f4855d0b957ec3df9d7
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 15:04:56 2007 -0800

    Bug #9604: Align the sizes of allocations to page increments as well.
    
    Without this, the 965 DRI driver fell over when pitch * height wasn't
    page-size aligned.  Since the allocator only allocates at page-aligned offsets
    anyway this shouldn't hurt us at all.

commit 0bfaeaab2838184827236c5c0fcc17f06d9e1372
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 11:11:56 2007 -0800

    Fix physical memory allocations, including description in log.

commit 5732dd7221b7bb24bf21e16066f014a0c7cb6b2a
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 09:54:04 2007 -0800

    Fix some texture memory allocation issues.

commit aeeae1b40fc012bcc01fcd2243d4993de819b7cf
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Feb 26 09:13:17 2007 -0800

    Fix a crash in startup monitor detect.

commit 10655c4674cdac8a231c50dd9afc5d43fe43b4bd
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Feb 26 09:23:14 2007 +0800

      for merge with external tree

commit 9417af8630fce0476273b693ebac12129415e0cf
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Mon Feb 26 08:02:50 2007 +0800

      fix conflict with external branch

commit 42fc06c85a0c487cfa26b9d4aa396402dbc4c2fe
Merge: 10655c4 3bce8bf
Author: Nian Wu <nian@graphics.(none)>
Date:   Sun Feb 25 12:53:47 2007 -0800

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 84a7429730ddd29072d696accb9fdd8fea40731a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 23 14:59:24 2007 -0800

    Always allocate logical_context, since we use it in emitting invariants.

commit 7bb725dee9ef0ccdc478ed4931dc267bcb80203f
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 23 14:56:58 2007 -0800

    Improve logging of memory allocation passes, and clean the code up a bit.

commit 54198b26e87baa180208932b97f10b27d9c0fddc
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 23 14:17:07 2007 -0800

    Move memory allocation to ScreenInit rather than PreInit.
    
    This lets us do memory allocation just once rather than having several passes
    (as long as things succeed), avoids trouble with zaphod mode, and will let us
    do better automatic sizing of allocations soon.

commit 828deff6453872ef0f9fa35c08c9f95f464b1785
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 23 13:16:02 2007 -0800

    Fix fence allocations on 965.

commit d3ac440e127c8a7716062852cd3b5e7943e289e4
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 22 10:41:09 2007 -0800

    Rework the video memory allocation.
    
    The previous allocator worked in multiple passes, with (at least) one of
    setting up allocations, another to attempt to adjust those for tiling, and
    then a pass to set up the offsets and fix them in memory.
    
    The new allocator is simpler, allocating memory immediately if possible,
    setting up tiling up front, and choosing offsets immediately.  AGP memory
    is only allocated to back actual memory used, saving some memory that would
    have been allocated for padding previous. It will also allow dynamic freeing
    and reallocation of memory, which will be useful for framebuffer resizing.

commit a61a6b1db610a07060d0dcca54b66a4b2b3686cc
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Feb 21 09:43:24 2007 -0800

    Reformat to 4-space indents, no trailing whitespace, and 80 columns.
    
    I'm in the process of rewriting this file, and wanted to separate my whitespace
    changes.

commit dd24d2a082b41abc466391c37a9b3d066586dc55
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 22 11:46:44 2007 -0800

    Remove copied X server headers from driver.
    
    These two headers were copied during mode setting development; as that code
    is now inside the server, these files are no longer needed here.

commit 681966ce6548c6f47b087eb7e369674b7ddbaade
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 22 11:45:43 2007 -0800

    Disable unused functions after configuring the remaining resources.
    
    This eliminates an unsightly flash of the hardware cursor during X server
    startup.

commit f5ab9e0ad3a65c972861dd53be6e33e1aac13191
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Feb 22 18:57:23 2007 +0100

    I830DRISwapContext: Some cleanups.
    
    Also call I830EmitFlush() when entering/leaving the server context. Doesn't
    seem to help for artifacts with page flipping and mixed 2D/3D unfortunately.

commit 8cce74f195e5ef6ce5599ecd52f35bcfcb0d7913
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Feb 22 18:27:59 2007 +0100

    Do not sync DRI windows between pages when possible.

commit f346549183a407a4bff6521ec2450dacb97442e9
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Feb 21 09:19:54 2007 +0100

    intel.man: Fix typo.

commit 3bce8bf0e95e5842399959a5d6f6413e96f03adb
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Feb 20 23:10:17 2007 -0800

    Pre-965 hardware had fixed pipe 1 for panel fitter.
    
    The pipe mode setting code needs to disable the panel fitter when using the
    pipe for things other than LVDS output. The driver was checking for panel
    fitter conflicts using bits that the 965 chipset defines for selecting which
    pipe the panel fitter is connected to. However, on pre-965 hardware, the
    panel fitter works only with pipe 1 and those bits returned 0.
    
    The result was that when pipe 1 was using the panel fitter, configuring pipe
    0 would disable the panel fitter.
    
    The fix provided uses a model-specific test for the panel fitter pipe.

commit 0bee64f4bc7581de7ab28ca438581d215e85c610
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Feb 20 19:09:37 2007 +0100

    Add support for triple buffering using a third static buffer.
    
    Need to bump the DRI DDX version minor for the added SAREA fields.

commit 2212baa8454abb4c7948c3f2e20e337f831d1b86
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Feb 20 18:39:13 2007 +0100

    Don't mark page flipping as active when it really isn't.

commit fac8f2eb49de22abd853ca75f3c985d4d94e3633
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Feb 20 18:38:40 2007 +0100

    Document Option "PageFlip".

commit 5a1a04649c62aa4b1c0617560b813642ce0c67b5
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Feb 17 17:01:04 2007 -0800

    Make distcheck fixes. Distribute all sources needed even for older servers.
    
    Always allow (but do not require) link to server sources so that needed
    files can be included in the generated tar files.
    
    Add remaining .g4a files and assembly output to distributed file lists.

commit 0ca926e63c7fa9122a8cba1424ce4cdee1c7b215
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Fri Feb 16 02:19:10 2007 -0800

    Check for presence of xf86Modes.h file.
    
    xf86Modes.h file signals the availability of the new modes API in the
    server; use that instead of counting on X server version numbers.
    Also, finish eliminating use of local copies of those header files.

commit 972f1109d23c0a3f821fa573e2aa40cd17ce2795
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Fri Feb 16 01:07:20 2007 -0800

    Remove common code that has moved to xserver/hw/xfree86/modes

commit 20e146a09e3b4907a6800588ebfa787bfc5b0d89
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Fri Feb 16 00:57:44 2007 -0800

    Change rotation pixmap creation API to permit start-time rotation.
    
    Start time rotation requires that the pixmap be created after the server has
    initialized the screens. Delay the pixmap creation until the first block
    handler invocation.

commit 17e38e39a49b2a96e31cca4a0b922631c5f7879e
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Feb 15 23:09:43 2007 -0800

    Enable mode setting function renames from shared code.

commit 8e7bc4b1f95f5d62ff18cd94f14f5e3949ef6a29
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Feb 15 11:17:53 2007 -0800

    Use server sources for crtc/output generic code.
    
    As sources for these have been merged to the server, use them from the
    server source code instead of keeping copies in this driver.

commit 6e33c4c44030e05d6d07ca9274cfe4d6df2c0387
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 15 09:54:43 2007 -0800

    Print the correct meaning of bit 30 of pipeconf for 965 in debug output.

commit 4541150cdce3f2f83b8530d0863aecf28c6610a9
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 15 09:51:04 2007 -0800

    Detect core clock frequencies, to avoid double-wide mode when possible.
    
    Additionally, don't attempt to set double-wide on the 965, where there is
    no such thing any more (not that we'd ever see modes high enough to trigger
    it).

commit d1be0dc4e9d443dcbd218a083cfb21a0b5d634ee
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Feb 15 11:03:12 2007 +0800

    EXA: fix i965 default color (0,0,0,1.0) -> (0,0,0,0)
    
    (0,0,0,1.0) is actually black...

commit c010d28f0a91a9831d366ea490878ef3d958021f
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Feb 15 11:00:06 2007 +0800

    EXA: mask componentAlpha support
    
    we're getting load of multiple sf/wm programs for i965, might
    need to be cleanup in future.

commit ec55dd16c4c5f7612d33ae22a6249b3b1c60e2b6
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Feb 14 14:37:02 2007 -0800

    Global namespace cleanups, filename fixes.
    
    Ensure all xf86 symbols created here are protected with XF86NAME.
    Remove accidentally exported symbols from namespace.
    Make all to-be-DI files prefixed with i830_xf86.

commit 22a271555a46267c40448fa926d45692498ef7c6
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Feb 14 14:17:14 2007 -0800

    Create driver-independent DGA hooks, remove i830 DGA code.
    
    As RandR needs to poke at DGA code, and we want the RandR code to be
    driver-independent, it seemed easier to just make the DGA code
    driver-independent as well.

commit a7c64d5e28f608d54c94fa7a5c92bd5b471179c7
Author: root <root@guitar.keithp.com>
Date:   Wed Feb 14 10:20:28 2007 -0800

    WIP DGA generic support.

commit 55c7b017ed718107b9b11467030addf225728b84
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Feb 14 16:45:22 2007 +0100

    Use new DRI ClipNotify hook to track page flipping per CRTC when available.

commit 3bd8edb95fcbbb49e97a1a2bdd5c8eae4f83d3a8
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Fri Feb 2 17:41:18 2007 +0100

    Revive i830 page flipping support.
    
    Use the damage layer directly instead of via shadowfb.

commit 1d22bad33b634aaf61976907cb2ceeec8a9ebe4d
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Feb 14 12:57:12 2007 +0100

    Update SAREA pipe fields in i830PipeSetBase.

commit 0df490938af10d3a748221e2fb5467b0f244f9eb
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Dec 21 11:27:28 2006 +0100

    If the DRM can handle it, enable vertical blank interrupts for both pipes.

commit 1623b47c4863f5362587cdac855e3e11c109b007
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 17:37:56 2007 -0800

    Switch the RECTLIST vertex order to (x2, y2), (x1, y2), (x1, y1).
    
    This is the documented correct ordering, and while the previous ordering
    (reversed) worked on some hardware, it failed on others.
    
    Reported by:	Wang Zhenyu <zhenyu.z.wang@intel.com>

commit 4bd4058dfdca84d6ebab82a1dfba99adf3852c9c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 14:29:52 2007 -0800

    Bug #9941: ViewSonic VX2025wm sync polarity quirk to fix mode distortion.

commit 0ec4ffcb4e8e5e707e68bef1b13a324677f19f8f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 13:18:15 2007 -0800

    Fix double free in the case of LVDS disabled through quirks.

commit 699fa88d2570de6173e2d866e11b7437f4842d74
Merge: 681b919 6641aec
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 13:10:08 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 6641aec0a1cbc869fba1956c556cdd204631545a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 10:21:12 2007 -0800

    Attempt to detect panel fixed mode from EDID or current programmed mode.
    
    These two sources are placed in higher priority to the BIOS data when
    available, since the BIOS data has proven unreliable.  The BIOS data is still
    read, and warnings printed if it doesn't match what we probe.  The BIOS data
    remains useful for the situation where we want to turn on LVDS but there is no
    EDID available and no current mode programmed (i.e. booting with VGA or TV
    connected).

commit 991439d4c78cf5b2a8f6bb8f5b36fffbfcc4e4fc
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Feb 13 10:07:47 2007 -0800

    Remove dead #if 0-ed structure.

commit c3aed56d46baba057d83dc6ea12c6b4e705e54ba
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 9 13:16:37 2007 -0800

    Fix comments on 965 pitch alignment restrictions.

commit 98318dfcc99264fb7b7ef34568712812aa6300b6
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Fri Feb 9 16:20:57 2007 +0200

    add missing files to fix distcheck
    A bunch of files were missing from _SOURCES, and the build was also broken
    for missing files (from EXTRA_DIST) when building without gen4asm.

commit fce4390c4f1a76c65423114bb479814787612cd7
Author: Zou Nan hai <zhenyu.z.wang@intel.com>
Date:   Fri Feb 9 11:32:22 2007 +0800

     TV Enable

commit 00dadaa115951c36de9caf2a9d78909811ef34bc
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Fri Feb 9 11:14:50 2007 +0800

      set DPLL before detect

commit 10712c7a781e50475ee7e8ccd5bfd2d820f863e2
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Feb 8 08:56:42 2007 +0800

    EXA: i965 pixmap pitch align
    
    This seems like a typo, which causes screen artifacts.

commit 44eacf2323454e26b535cc5a4f0789cb0ff0e7fb
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Feb 7 17:30:51 2007 +0800

    EXA: fix render issue with i965
    
    Fix SF kernel with corrent coeffient work, and correct
    VUE storage in multi texture case.

commit 920aeaf8478f706ab3b1de4f20f5d351e64a0197
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Feb 7 13:15:52 2007 +0800

      Make TV code same with external tree.
      Fallback to old filter table.
      4 spaces indent reformat.
      Auto scaling seem to not work well on some low res interlace mode when input width > 1024, filter those modes.
      Fix some subcarriar number

commit 6d9757e466863594300c83f3806fd4376bea0504
Author: Zou Nanhai <nanhai.zou@intel.com>
Date:   Mon Feb 5 14:59:53 2007 +0800

    Fix hang when TV is not connect.

commit 681b91924c364a1c00732f548539f2767929ba0e
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 2 17:40:34 2007 -0800

    Add subpixel offsets to fix accelerated rotated rendering on i915.
    
    This fixes the rendercheck "transformed src/mask coords 2" tests. Previously,
    the source pixels chosen would be off by one in some cases.
    
    The particular values were taken from Mesa, which uses .125 offsets (except
    apparently broken for y), but the signs are changed.  I would be happier if
    I had better justification for why this worked.

commit 76a4f2eea826036e2ac16b7e8c61ab946038c120
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Feb 2 17:34:41 2007 -0800

    Fix bad offsets in "right" rotation of the CRTC in cursor and update handling.

commit 785a59ead0e8d1d681b2cb6827ee58ad2c51f8c6
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 1 22:48:44 2007 -0800

    Rename driver from i810 to intel. Permit old name for compatibility.
    
    Driver installs as intel_drv.so with symlink to i810_drv.so to ensure
    existing configurations continue to work. Updated manual page to reflect
    name change and add attributions for recent work.

commit 1dde7a15a3a42b881c57ece95feceffadf412cff
Merge: 16f30b2 1ba45a3
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 1 21:31:27 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 16f30b2e6c72e228c66946ff9efadd7278379745
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 1 21:30:19 2007 -0800

    Add "Ignore" option to per-output monitor, removes output from server.
    
    Setting option "Ignore" "Yes" will cause the server to pretend as if the
    specified output does not exist at all. It will not be listed by the
    RandR1.2 extension, and the server will not attempt to detect monitors at
    startup time.

commit b3633506dcd4fd58f0f9519cd67f6e75d6fb2042
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Feb 2 11:35:44 2007 +0800

    Add Intel 965GM chipset support

commit 380129a17c61c783d77a87685ad5333e8b1c253c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Feb 2 11:33:46 2007 +0800

    Revert original crestline pci id patch

commit f7489bbec150349bf03bea8d9d55451dbc92bfc2
Merge: f1285ec ae6d358
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Feb 2 11:26:57 2007 +0800

    Merge branch 'modesetting' into crestline
    
    Conflicts:
    
    	src/i830_display.c
    	src/i830_tv.c
    	src/i830_xf86Crtc.c

commit ae6d3585a4d96aa4dc05ca8563cebfa7796324ef
Merge: 6d549ed 1ba45a3
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Feb 2 11:21:59 2007 +0800

    Merge branch 'modesetting' of git://proxy.ims.intel.com:9419/git/xorg/driver/xf86-video-intel into modesetting

commit 9f0acf1eb01ad8320f4da4cc5e498af25c0ecc5e
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Feb 1 15:44:18 2007 -0800

    Check for rotation change in xf86RandR12CrtcSet.
    
    xf86RandRCrtcSet was ignoring changes to only rotation, so the screen would
    be left incorrectly rotated.

commit 1ba45a3fcd40aaf4d373447fb9f252ca053f9105
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 1 13:26:38 2007 -0800

    Improve register debugging output.
    
    This includes not reporting some fields on hardware where those bits are
    reserved, correcting one of the hardware error bit numbers, and reducing
    the severity of the debugging output warnings.

commit 9bfeadbd5b37acb56cb646009239a94727ec52bc
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 1 12:04:58 2007 -0800

    Remove some more dead options.

commit d6bc03c379c46842676f640b8edb13ea828bf20c
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Feb 1 11:28:34 2007 -0800

    Bug #9819: Add two headers that are apparently necessary on older X Servers.

commit 351866b0328b1d7afdc6b414c77d9ab4da4bd085
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 15:48:52 2007 -0800

    Sync before overwriting Render acceleration state on the 965.

commit 96783a458957ca280ebb6275fa692dd415df6931
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 15:48:02 2007 -0800

    Fix copy-and-paste-o in the render code cleanup that broke XAA.

commit 5238ff9c80718f9f8baa06123aa1bb6e3193fce6
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 14:01:41 2007 -0800

    Naming and formatting cleanup in Render acceleration code.

commit c47210d94ed17ad9e8e489a1e1886732e6dc7220
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 12:50:31 2007 -0800

    Move the render code to non-EXA-specific filenames.

commit 72ea0e514dcbebd009833c21f40e9bfb84074628
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 12:43:38 2007 -0800

    Remove custom accelerated rotation code now that it's all done through Render.

commit e62751db8b1a631c22ba0f77c932be4ab39ba741
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 31 12:15:38 2007 -0800

    Add an accelerated path for rotation Render operations in XAA.
    
    The now-generic (kind of) EXA code will be cleaned up and moved to generic
    files in a later commit.

commit f1285ecb72e807ac10db398fa983bf69d4154d97
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jan 31 14:58:08 2007 +0800

      tune

commit 0620a7650f758652d05a0c25d159587f641aaf3e
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jan 31 11:21:11 2007 +0800

      fix

commit 12441e217a1968dea3a6b0646b6c5d0e2ede0e7e
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jan 31 11:20:23 2007 +0800

      add 720p@50Hz,
      however 720p in this freq seems to not support src width,
      hactive > 800, so skip those inputs.

commit 726c7dd89627409820ee5cf9bf657d5a926b3648
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jan 31 10:34:39 2007 +0800

       TV fixes.

commit 4cd552e8f4851e029e43bf778cd8340f6c2c4881
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 30 16:34:50 2007 -0800

    Fix accelerated Render transformations.
    
    Previously, we tried to use 2 points instead of 3 to describe the source
    rectangles, which mostly just worked for scaling.

commit 6a628ae12b0568d656059891c5bca4415d8a735f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 30 14:19:05 2007 -0800

    Simplify EXA acceleration transform handling.

commit c8581254cb811f76aa6eae49d74489b543b3eb05
Merge: 9da1791 d329fa1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jan 29 21:25:13 2007 -0800

    Merge branch 'modesetting-rotation' into modesetting
    
    This adds reasonably driver-independent rotation support to the common
    layer. The piece required in the driver is to allocate and redirect the crtc
    to a shadow frame buffer. The driver uses Render to perform the actual
    rotation operation (which leaves us free to do fun projective transforms at
    some point in the future :-).

commit 9da1791eeca446cd59e2e7d0803e8a7920dbbea5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 29 17:10:14 2007 -0800

    Restore a few important lines from 89ace3e81fe72075b1709b073c05532f13b7f0d1
    
    Typical results were failure to sync, and a black screen.

commit 67c6a490e63f6997f8198bc3ab180a1af097fe86
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 29 09:53:58 2007 -0800

    Remove dead code to undo the damage of xf86SetModeCrtc() blank limiting.

commit 89ace3e81fe72075b1709b073c05532f13b7f0d1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 29 09:43:35 2007 -0800

    Bug #9680: Remove bogus blank length limiting in xf86SetModeCrtc().
    
    Our modes typically come from EDID or default modes, and when the monitor
    asks for a specific mode, deciding to tweak it usually results in incorrect
    display.  And if the user is specifying a mode by hand, tweaking it then is
    still pretty rude.
    
    Reviewed by: ajax

commit 6eb69e737864d06dc6d4fbb4cd85a027cbb7643a
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Jan 28 19:40:12 2007 +1100

    ch7xxx: actually power up the chip around connection detection

commit d329fa121b2401cadb991c2854e077cfa68e15e8
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Jan 27 18:36:15 2007 -0800

    Fetch from root window instead of screen pixmap during rotation.
    
    The XAA Composite wrapper doesn't check for sourcing from the root pixmap
    when deciding whether to sync the hardware drawing. Fix the rotation code to
    reference the root window in IncludeInferiors mode to avoid reading without
    correct synchronization.

commit 20419d664c77e9a1a2de82987838b45f44774b47
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Jan 27 18:34:12 2007 -0800

    Paint ARGB cursor data to ARGB cursor memory space in frame buffer.
    
    When converting from global cursor to per-crtc cursor, the ARGB cursor data
    was accidentally painted to the wrong location, overwriting some critical
    data and causing the hardware to lock up. (along with generating a garbage
    cursor image from uninitialized data).

commit 00decd3b6cea0de22c88b9504dbe26d680e8ab16
Author: Krzysztof Halasa <khc@pm.waw.pl>
Date:   Sat Jan 27 12:29:31 2007 -0800

    Don't zero out mode structure after setting name field.
    
    Instead of using memset to zero the structure (at the wrong time, no less),
    use xcalloc to gather pre-initialized memory.

commit 7a5f17087bda2833e84fa7e7ff0cb168943b89b6
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Jan 27 00:11:21 2007 -0800

    Mark crtc region as damaged when rotation is set.
    
    When shadow frame buffer is allocated for rotation, it needs to be
    initialized by copying from the frame buffer. Do this by simply marking the
    entire screen as damaged which will force an update.

commit 2d95cb6f041653f7e530b1f32cf007929c23ef3b
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sat Jan 27 00:04:13 2007 -0800

    Make rotated pixmap size of mode, not rotated mode. Update only damage.
    
    Rotated pixmap should match size of displayed mode, not the rotated version
    of that size.
    
    Take damaged region, rotate each box and display them instead of displaying
    the whole screen after each damage update. This exposes a bug where the
    screen is not correctly damaged after rotation.

commit 5c1e27cdd243dc24dd2bfdeb46d757bbef6ba6af
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 25 15:31:22 2007 -0800

    Make rotated shadow buffer allocation dynamic.
    
    For EXA, this requires version 2.1 of EXA to do rotation, as the VT switching
    issues were too complicated otherwise.

commit 5a67f3d3690903a181ca854d060cfa8b4c2aca26
Merge: 3cc583e 9811059
Author: Nian Wu <nian.wu@intel.com>
Date:   Thu Jan 25 13:40:50 2007 -0800

    Merge branch 'crestline' of /git/xorg/driver/xf86-video-intel into crestline

commit 3cc583ec8e79ec65103308220dd6047a4a7acddf
Merge: 566e1d3 effe579
Author: Nian Wu <nian.wu@intel.com>
Date:   Thu Jan 25 13:37:05 2007 -0800

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into crestline

commit 6d549ed280d3fcf3fe611b095d9f8adc0196bfb6
Merge: 75f4df2 effe579
Author: Nian Wu <nian.wu@intel.com>
Date:   Thu Jan 25 13:36:33 2007 -0800

    Merge branch 'modesetting' of git://proxy01.pd.intel.com:9419/git/xorg/driver/xf86-video-intel into modesetting
    
    Conflicts:
    
    	src/i830_driver.c

commit 83cc4601b27d871484a2408f31154e9387064b9e
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 24 16:52:22 2007 +0800

    Fix a possible failure to misalign video allocation in XAA.

commit e21332419581eff1d7651741bae0b640c84d0ecd
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 24 12:32:38 2007 +0800

    Warning fix.

commit effe579e691b044e3ce59b41b5c0eaaac4368dda
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Jan 21 20:23:13 2007 +1100

    ch7xxx: fix output detection as per datasheet, have no DVI to test this.

commit c68dae2705d6e5b05dba7d40b6da112b98b926b4
Author: Dave Airlie <airlied@linux.ie>
Date:   Sun Jan 21 20:22:39 2007 +1100

    fix building with 7.1 server by hiding stuff inside RANDR_12_INTERFACE

commit 8eb861fb61fda78e6c142ffa66c586357aaa2e44
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 22 15:50:14 2007 +0800

    Replace the custom SaveScreen function with a generic function calling DPMS.
    
    With this, additional power saving occurs with the core screensaver, for
    example by turning off LVDS backlight.

commit 7161e824e89a6a69f1277e510f2344ad31721f62
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jan 19 15:15:19 2007 +0800

    Fix DRI issue when EXA enabled
    
    tell DRI we are smashing the context state.

commit 74ebff6732b9bfcf8c865b52cbebfd9bf6b73eb2
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 14:26:21 2007 -0800

    Allocate separate cursor memory per CRTC and rotate cursors appropriately.
    
    Also, add bind/unbind of the shadow rotate buffers, which was missed in a
    previous commit.

commit 8759f4d89a141f7d69f1894ec3059ba6bd1cf86b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 13:13:25 2007 -0800

    Partially deal with cursor rotation.
    
    The remaining issue is having a cursor image per CRTC so that the cursors can
    be rotated on the independently rotated CRTCs.

commit b296cd9b8f63ab80e8fe46fcfcdba2e9af846468
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 13:02:26 2007 -0800

    Fix transformation matrices for rotation at 90 and 270 degrees.

commit d2ae2e2ccc3a8e7dc84745c235836cba150754d8
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 11:37:14 2007 -0800

    Update CRTC values first so they can be used by the driver in mode setting.
    
    With this, the screen now gets rotated, though there are major issues.

commit 92b0f3d2013c32d94fe57fe674da1b195288f347
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 11:23:22 2007 -0800

    Disable the clipping for now, since it won't work.

commit 14d265a02312e9cda7a21614d77525c7140c0ca8
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 11:21:58 2007 -0800

    Store fixed values, not integers, in the transformation matrix.
    
    Also, add a bit more error checking.

commit cc09dc3efe7279bf67512babb0f6cdaeba654772
Merge: 53e765d 3094100
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 18 10:20:36 2007 -0800

    Merge branch 'modesetting' into modesetting-rotation

commit 53e765d1cf5016961c25a798a27f0fe09bd1f237
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 17 16:56:06 2007 -0800

    Fix broken last-minute change in determining whether we're rotated or not.

commit f256243fff195f73bc8aa72e8dd2c6f7b33446cf
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 17 16:01:18 2007 -0800

    Allocate per-crtc rotation buffers and hook up RandR 1.2 per-CRTC rotation.
    
    It currently displays garbage.

commit d17c386aee55bd223297adf78cf0fc1db43baf2d
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 17 15:49:08 2007 -0800

    Fix some segfaults: crtc->rotatedPixmap not set and dangling damage pointer.

commit 67a152c43cb7231695b99030c952c52d4edd1e65
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 17 14:35:31 2007 -0800

    Set all CRTCs' allowable rotations when xf86RandR12SetRotations() is called.

commit 98110591001dfaf2b8b5ac440bea0c38456da718
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Jan 17 10:45:59 2007 +0800

      enable all TV modes

commit 3094100cdd04560af1b098bbe8024ae5270a10f4
Author: Gary Wong <gtw@gnu.org>
Date:   Tue Jan 16 13:25:24 2007 -0800

    Bug #9550: Add a quirk for too-high clock from EDID on the EN-7100e.

commit 66c6427cc83e5e381932b0c10743cba4cb9ac883
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 16 12:54:29 2007 -0800

    Add a settable backlight property for LVDS.
    
    This extends the output funcs to have a callback for when it's time to
    configure properties, and another for when the server has changed a property
    whose value isn't pending a mode set. (Pending properties are to be picked up
    by the driver at mode_set time).

commit a52df90ffcb19e7c0a3b8018db3cd1391a3ec343
Merge: 37946c9 45696aa
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Jan 16 12:20:26 2007 +1100

    Merge branch 'modesetting' into modesetting-rotation
    
    Conflicts:
    
    	src/i830_driver.c
    	src/i830_randr.c
    
    Just a few sync changes.

commit 37946c9c8a4afa4a4fc1fe9864a8eec1c4571d2c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Jan 16 12:14:55 2007 +1100

    Interim work on rotation support with new xf86 code.
    
    Yes, there are lots of bits tied together here, and we should split this
    patch apart.
    
    Move I830 mode setting to xf86 mode setting.
    
    Make mode setting function also set the base address. This should fix
    problems where the base gets set incorrectly at times.
    
    Add driver-independent rotation support, requires driver-specific hooks for
    shadow pixmap allocation, otherwise it uses Render for painting.

commit 9a5106401a65c90df32cb71987fca7126dc22e81
Author: Emilio Scalise <emisca.ml@gmail.com>
Date:   Mon Jan 15 17:22:27 2007 +0000

    patch to control mergedfb options, bug #9664

commit bfeda3bfc59d309772398f688d29452ba97f3973
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jan 15 08:05:32 2007 +1100

    Convert I830PipeSetMode to xf86CrtcSetMode. Add rotation structures.
    
    Makes the mode setting logic device independent.
    Magic rename hooks allow multiple drivers to provide the
    generic code without name conflicts.
    Rotation code requires special pixmap creation hook, and uses
    Render to perform the actual rotation.

commit 319be199ba657d2b82ba034edf3581aea6dcc3f0
Author: root <root@jetpack.demon.co.uk>
Date:   Sat Jan 13 21:34:00 2007 +0000

    Tweak to bug #9639

commit 85de57947570de6b3dc9197647be3e9237480880
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sat Jan 13 19:18:24 2007 +0000

    Fix bug #9639, i810 XvMC needs linking against libdrm.

commit 45696aa29124e2852f94880642e70bb2e0cee827
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 4 12:34:47 2007 -0800

    EXA: Use PRIM3D_RECTLIST instead of TRIFAN so we don't get diagonal tearing.
    
    A side effect is the reduction in vertex dispatch, which is nice.

commit 6874a6f25ac87783d3770f77b9192e2d36d083a3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 11 12:34:38 2007 -0800

    Restore legacy overlay size limits, due to card hangs at larger sizes.

commit c288aea40775a9cf561fda9912187c3cb5baa419
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 11 10:39:00 2007 -0800

    Bug #8845: Unify all our XV ports to 1920x1088 maximum size.
    
    This increases the "legacy" size, but that was checked against the 845
    documentation which claims support for 2048x2048 as well.  It decreases the
    textured video size, which was running into the limits of the bigrequests
    extension.  The new limits should fit within bigrequests while still supporting
    HD videos.

commit f5d528f8ea27de31054e7f1843e34d8379f811ea
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 11 10:36:33 2007 -0800

    Don't limit cachelines to a vertical of 2048, and increase default allocation.
    
    The cachelines are used for two things: XAA pixmap cache and XV memory.
    Only XAA pixmap cache is referred to using an offset pointing at the
    beginning of the front buffer in rendering, and XAA only uses the 2d BLT
    engine, which actually has a vertical limit of 65536.  So, pixmap cache is now
    limited to that much vertical.
    
    Additionally, the previous cachelines allocation was too small for our
    advertised XV limits, so video at the limits would fail with BadAlloc.  Now,
    XAA allocates the same approximate amount of offscreen memory as EXA:
    3 times the screen size, plus one packed HD video.

commit d13bc016c0723f1df633ddaf5610ad73003b7c96
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Jan 10 15:06:56 2007 -0800

    Correct x/y/pitch limitations in several cases, and detail them in i830_exa.c.
    
    This reduces max framebuffer width and increases max framebuffer height on
    965, reduces max X/Y on pre-965 EXA (could have caused mis-rendering), and
    increases max X/Y on 965 EXA (would have prevented acceleration).

commit fa383289ac8a6dd1cb359e6f1991cc42beb6ff02
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Jan 4 14:12:45 2007 -0800

    EXA: Wait for sync before we set up new state in our static state buffers.

commit 5857b4a1693085b8b42dd9560a7c4f5c3c82f862
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jan 10 15:09:47 2007 +0800

    Formalize sync interface
    
    We should just call i830MarkSync/i830WaitSync in places we need,
    which care for both XAA and EXA.

commit efb75f56053ee06f1dbd4edfaea9986b27162afb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jan 9 14:05:43 2007 +0000

    Bump to 1.7.4

commit 33c0fac6d63d9a509a24c7a5e5a46a0d6ee4dc5d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jan 9 14:02:47 2007 +0000

    Fix bug #8536, i915 BIOS fails when restarting Xserver.

commit ee52c0ec4e95fa6e5f35c9cd75005a0c0003fd97
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Jan 8 16:53:07 2007 -0800

    Correct typo resulting in a crash with ivch.  = != ==.

commit 566e1d397744d0b477de4da6a206919906176f49
Merge: b13d638 da6a00f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jan 8 12:37:49 2007 -0800

    Merge branch 'modesetting' into crestline

commit da6a00f787e4d13e6b75768c1976f1c44ae5bf72
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jan 8 12:36:54 2007 -0800

    Move EXA function declarations from source to header.
    
    Several new global functions were not put into the header file leading to
    potential mismatches between declaration and definition.

commit 66546d8a8006e1c828e18ccab850214fd8d56b63
Merge: 0fd2752 40af0ee
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jan 8 10:14:24 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit b13d6386dfb3a00bd9d21ac0695cdce9f812d1f3
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Jan 7 22:56:37 2007 -0800

    Back out rotation changes for RandR 1.2 which won't work.
    
    RandR 1.2 requires a new rotation structure for per-CRTC rotation.

commit 7473e7d5297f94164e0f35822166713fb21a11bd
Merge: cdde9e7 a87801f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Jan 7 22:50:27 2007 -0800

    Merge branch 'crestline-otc' into crestline

commit cdde9e7f4a0645ab1ee3e124de54433c1a250097
Merge: 3110630 0fd2752
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Jan 7 22:50:12 2007 -0800

    Merge branch 'modesetting' into crestline

commit 0fd2752f199928f846fe03c9087f7b6d48cc28d9
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 14:35:55 2007 +0800

    minor fix on last exa mem binding commit

commit 3110630e04f37e184609c91494fa7f9f4d59b93f
Merge: be9b635 736d82a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Jan 7 22:44:36 2007 -0800

    Merge branch 'modesetting' into crestline
    
    Conflicts:
    
    	src/i830_rotate.c
    
    Pull in upstream changes to crestline branch leaving only
    the PCI-IDs as local changes.

commit 40af0ee6ba4ab7596fbc7fcc3ad04d109746ca6f
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Jan 6 18:19:34 2007 -0800

    Numerous symbol scope issues.
    
    I830EntityIndex is shared between 810 and newer driver.
    Move most EXA rendering state into I830 structure.
    Declare shared variables in shared header files rather than .c.

commit 736d82a6b43f174cb95b425faacd4b0b889916fa
Merge: 53b42f5 4c790f6
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Dec 4 15:48:04 2006 +0800

    Merge branch 'modesetting-origin' into modesetting

commit 53b42f5bc7a58d02106436486e5bb56e56dbbfa1
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Sat Jan 6 14:59:14 2007 -0800

    support NTSC 480i M-J, PAL 576i for 640x480-1280x1024 sizes
    
    I still have problem with non-interlace mode and Hi Res mode.
    also I don't know how to pickup those mode in xorg.conf

commit 71946bcdc3c68c220996afac944698eea1974a36
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Jan 3 22:37:32 2007 -0800

    [PATCH] Add rotation support for 965.

commit 35cebed70827999812f8343ac97ad0dffda20786
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 16 15:12:43 2006 -0800

    [PATCH] Replace broken PCI resource size detection with pciGetBaseSize() call.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 33e912aca08fa11ef588eb386e16ba5f9ea13727
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 11:25:31 2007 +0800

    [PATCH] Fix EXA mem binding
    
    We should check if EXA is really enabled.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit fa54a3c08301e59558ab0493b3d22324f4162496
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Dec 6 13:24:44 2006 +0800

    [PATCH] fix Makefile.am
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 2f2c443e971faa54ffcf751b6acb444e8e7875ce
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Dec 6 10:43:29 2006 +0800

    [PATCH] Formats fixes
    
    We should use card_fmt for src/mask picture, and use dest color
    buffer format helper. Also fix wrong name for G965 texture formats,
    and pict_x1r5g5b5 isn't supported by sampler engine.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 0bf04fe78a8a915310ef8a90f5c7872be7476e2e
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Dec 4 15:48:04 2006 +0800

    [PATCH] set correct default border color
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 5c461063cde68092e778c44ac6abd9129cd8019e
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Dec 4 15:47:31 2006 +0800

    [PATCH] fix typo in ps kernel
    
    fix corrupt in some subspans
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 89a42d489bd370b89e5ff4e01f026b4d64723cd8
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:16:46 2006 +0800

    [PATCH] shut up warning
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 01bfa4fa6fc0ceec8581676e5d72c68dd71efa96
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:14:55 2006 +0800

    [PATCH] fix alpha blending state
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 79018bb47c43510d59c592592f06204189bd12dc
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:05:32 2006 +0800

    [PATCH] Add in sf/wm program for mask picture without CA
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit a5b9b438469f171b002fa0b99d8cab83e51ec968
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:52:44 2006 +0800

    [PATCH] misc cleanup for G965 vs/sf/wm states
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit b7c1e1656f45e43ea2f9a47f1a487050c0884c22
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:40:15 2006 +0800

    [PATCH] WM kernel needs scratch space
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit db9cfaa35adaf79ea57bc06b27c7e37935d3e1a7
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:37:06 2006 +0800

    [PATCH] Setup default border color for our samplers
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 70276e4e9a8a5026ec436d2be5bf5eab868aa178
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:30:53 2006 +0800

    [PATCH] fix vertex buffer size
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit e8a4cbdeff4125e28d807d0a563efc0606d21a75
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:24:24 2006 +0800

    [PATCH] clean up issue cmd to ring buffer
    
    Make it easy to track different part of ring state, and
    use rectlist primitive instead.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 42534474fd2556e5987205626cca8f30e25855a8
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:04:16 2006 +0800

    [PATCH] remove wrong scale_units
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 05e8a7989db1b8b9dfa7b688629af65d9910cc53
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:02:16 2006 +0800

    [PATCH] Rename exa sf/wm program files
    
    Also fix some minors in wm program.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 1329c86f2a4b3664920ded970a984a745a530da4
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 15:47:19 2006 +0800

    [PATCH] EXA state mem for G965
    
    Not split offscreen mem for exa, but alloc a dedicated one
    for G965 states.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 4c790f614ecba1f6468e51779cfaf0e36b6b17ad
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Sat Jan 6 08:21:36 2007 -0800

    More sparse cleanups:
      NULL vs. 0
      make some variables static
      remove redundant variables
    
    There are only a few sparse warnings left now: some bitfield warnings
    and a few 'mixing code and declarations' warnings from the ring macros.

commit a87801f73a73e53524237be7835b8cd8b3eb282c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 14:47:48 2007 +0800

    Fix TV load detect
    
    Actually load TV, otherwise we don't have expected
    reg state to probe.

commit 9cf759a2cb2580c4ac5f8cdc983389642f3cfce0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 14:35:55 2007 +0800

    minor fix on last exa mem binding commit

commit f9c3ef40100acb85fca6e49c5c0e98f5c9ac97ca
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Oct 10 15:50:10 2006 +0800

    [PATCH] Mark current ps kernel is experimential with little test.
    
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit ef2f25e5c6ce04c202698c5122bc8627130073c0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Oct 10 14:11:35 2006 +0800

    [PATCH] Use sf_prog.h instead
    
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit ca608028c5301700444d39a1c631cc0d5648e1a2
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 13:55:52 2006 +0800

    [PATCH] Fix picture's transform checking
    
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 848368d5d0b90e03d3ec447cb5bd39fc87aea8df
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 11:15:33 2006 +0800

    [PATCH] Fallback in mask picture for now
    
    Do it later after finish wm kernel program.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit df23624eebe938fa444c80cbedcd61919ec1aeda
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 11:09:52 2006 +0800

    [PATCH] Fix compile, add wm header file.
    
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit fc944859b1b9605c748162bad1c93a6303c84aae
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 10:36:00 2006 +0800

    [PATCH] Add simplest wm kernel program for no mask picture composite
    
    This is a try to use new gen4asm language, and will finish
    composite program for mask picture with or without CA case later.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit acdc2da77b445e9347a4c6e53e35c81763cbb0b8
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Sep 27 16:48:43 2006 +0800

    [PATCH] Add mask sampler state
    
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit 926d7fb09aaaabf050949ce7c6127c68441c8801
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Sep 27 13:54:14 2006 +0800

    [PATCH] change some src sampler states
    
    sampler for mask should also be set up, and fix
    default border texel.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit ed73bbaf5c2e9d555c884037a249cf03e7f60fa0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Sep 25 14:35:51 2006 +0800

    [PATCH] Add file for i965 exa composite
    
    This does not include ps program, which will be added
    in g4a form.
    
    Signed-off-by: Keith Packard <keithp@neko.keithp.com>

commit be9b635b82c0c77ccc0555f178f94de6e5338e27
Merge: 9e48808 5a793b0
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Jan 3 22:15:53 2007 -0800

    Merge branch 'modesetting' into crestline

commit 5a793b0dcf2d5de408b55073858fcfba6d99f994
Merge: f188525 394124c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Jan 3 21:54:05 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit f188525030a8fac59e41520449b1aec9b123e4ea
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Jan 3 21:53:07 2007 -0800

    Add interlace defines for pipeconf regs

commit 9e48808fccf5b153c2fb4027f9a09944574fdace
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 11:25:31 2007 +0800

    Fix EXA mem binding
    
    We should check if EXA is really enabled.

commit ebd636dbd62cb69ed7defbd86f297c6bc7dac5dd
Merge: 75f0033 3d9ea6f
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 10:13:55 2007 +0800

    Merge branch 'modesetting' into crestline
    
    Conflicts:
    
    	src/i830.h
    	src/i830_randr.c

commit 3d9ea6f3c8a274f930d286fc15d3665dfaa8327a
Merge: 75f4df2 394124c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jan 4 10:12:50 2007 +0800

    Merge branch 'modesetting' of git+ssh://zhen@git.freedesktop.org/git/xorg/driver/xf86-video-intel into modesetting
    
    Conflicts:
    
    	src/i830_driver.c

commit 394124ceaadb46d976ad5c3bdeb1b77d351c57f6
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Jan 2 16:57:33 2007 -0800

    Add per-CRTC gamma control support for RandR.
    
    This makes the CRTCs now always run in gamma-enabled mode, rather than having
    flaky logic for switching modes.  Also, it should clear up issues with the LUTs
    being uninitialized when outputs are first brought up.

commit 69f250af60220a875f4a04c6d682bffa352281e4
Merge: 232e209 d960dea
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Jan 3 00:39:15 2007 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 232e2094321dbcdd6a67ef230eb50494a1c7d6df
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Jan 3 00:38:34 2007 -0800

    Allow initial position to be set in config file. Increase 965 max size.
    
    Add relative and absolute position configuration code, using per-output
    monitor sections. Options include:
    
    	PreferredMode	selects a preferred mode for this output by name
    	Position	absolute position, x and y in a single string.
    
    	Below		relative positions; argument names other monitor.
    	RightOf
    	Above
    	LeftOf
    
    	Enable		force the monitor to be disabled by setting
    	Disable		enable to no or disable to yes.
    
    	MinClock	Set valid clock ranges
    	MaxClock
    
    Monitor sections can also include sync ranges, physical size and mode lines
    as documented in xorg.conf(5).
    
    Monitors are associated with outputs through options in the Device section:
    
    	Option "monitor-VGA" "My VGA Monitor"
    
    Output named 'VGA' will use monitor section "My VGA Monitor".

commit 58e797b2caa6effa5455fc1f13dc4c58d0658744
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Jan 3 00:04:58 2007 -0800

    Sync dspbase/dspsurf registers by re-reading them.
    
    This seems to eliminate base/surf value confusion during EnterVT.

commit d960deab39eef91fb82b9f23118323aeb4c9c63e
Author: Jesse Barnes <jbarnes@nietzche.virtuousgeek.org>
Date:   Tue Jan 2 20:23:37 2007 -0800

      Various sparse cleanups:
        NULL vs. 0
        remove redundant pScrn in I830DRISwapContext
        make I830DRISwapContext static

commit 5057769d3a7c1b3a94f49bbff47b9697f368d975
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Jan 2 19:25:08 2007 -0800

    Use correct variable to initialize DVO I2C bus.
    
    intel_output->pI2CBus isn't initialized until the output is all happy and
    running, so using it before that is rather unlikely to do much good.

commit 2bb9bb951e664d704bdf7a808edbe8b2f50c4366
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Jan 2 14:04:10 2007 -0800

    Typo disabled new DRI MM on all chips.
    
    Detection for new DRI MM wasn't converted to #define correctly because of a
    typo.

commit 5080307230d534b84090bfefc13ac437d53f915d
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Jan 2 00:16:41 2007 -0800

    Fix driver to build on RandR 1.2 systems again.
    
    Changes to move initial config code to RandR 1.1/1.2 common path broke
    code required only for RandR 1.2.

commit 237847007afb5a429a50b6aa0b1acc239326571b
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Jan 2 00:09:35 2007 -0800

    Make driver build and run on Xorg 7.1. Delay DSP*BASE setting until last.
    
    Autodetect libdrm version, disable new memory manager on older libraries.
    Move new M_T_ defines from i830.h to i830_xf86Crtc.h. Add many system
    headers to define functions. Use i830PipeSetBase at end of mode setting
    code to set DSP*BASE and flush changes. Don't duplicate PipeSetBase call
    from screen init function. Make initial RandR configuration code usable on
    older versions of extension so the server doesn't start in a panning mode.
    Use xfree instead of free in i830_tv.c.

commit 25d5a892319b02dc6eb81390dea29cd88a1e7da4
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sun Dec 31 15:39:20 2006 -0800

    Elide identical modes from reported list.
    
    Where two modes would produce precisely the same crtc settings and have the
    same name, remove the latter mode from the mode list.

commit feeefc92e450e9de58da51147325300ffabd2059
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Dec 31 14:22:53 2006 -0800

    Replace author-specific license with generic license.
    
    This file retained the old MIT license with the embedded author name.
    Replace that with the version that uses generic 'copyright holders' instead.

commit 5e456251f0d6c8bef3241267f6c1b3bca4670c0d
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Dec 31 14:21:12 2006 -0800

    Replace author-specific license with generic license.
    
    This file retained the old MIT license with the embedded author name.
    Replace that with the version that uses generic 'copyright holders' instead.

commit 75f0033ec41a34bbe695cfd4a9bc9aa60e919c99
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Sun Dec 31 15:16:59 2006 +0800

    Issue current virtual size to mode valid.
    
    Revert change in rotation patch.

commit 2330b341c925e60bc2c991b4ca8450badbc459a4
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Dec 30 22:47:58 2006 -0800

    Prune default modes to EDID clock limit.
    
    Pick out the EDID max clock value and use that to elide default modes which
    are too fast.

commit c70e7bc701cba3092acfdd66ed4d63487ac8ff9f
Merge: 8b6c456 4ed79a2
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Dec 30 21:58:36 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 8b6c456e16c81f719bb68178e3e4d26f4108a9c2
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Dec 30 21:57:42 2006 -0800

    Detect in ProbeModes. Let get_modes set edid. Prune interlace/dblscan.
    
    Move output connection status detection from RandR code up to ProbeModes so
    it is done before mode sets are built. Otherwise, the mode building code
    will elide all modes the first time through as it ignores outputs that are
    disconnected.
    
    Most get_modes functions fetch EDID data; make sure that any
    EDID changes are used in the ProbeModes filtering of default modes.
    Otherwise, stale EDID data will be used.
    
    Allow outputs to advertise support for interlaced and double scan modes;
    prune such modes from the default mode list when outputs do not support them.

commit 4ed79a2ba6250354ffc24fa1f7a21ca914ad157e
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 29 12:19:41 2006 -0800

    Relax tiling requirements on G965.
    
    For the 965, we can tile with the pitch at any integer multiple of a tile size
    (128 or 512B), up to 128KB.

commit b8692e646227e56c9ae4f72b9aaa75457b4c0f5f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 22:23:16 2006 -0800

    Lack of configured monitor implies no configured modes.
    
    Missing check for missing monitor configuration would result in segfault.

commit 973da654219ea43916b0b44acfa09a415bed3d7a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 22:22:22 2006 -0800

    Sync ranges from EDID/default should not limit configured modelines.
    
    Limit the effect of sync ranges so that sync ranges found via EDID will not
    eliminate modes explicitly added by the user. Limit default sync range to
    eliminating only default modes, not configured or EDID modes.

commit f7b1d4c1f7d17a811e17c6a17861ff70be9fbdd7
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 22:18:57 2006 -0800

    Belinea 10 15 55 monitor quirk - override preferred mode with largest @60Hz
    
    Belinea 10 15 55 model monitor reports a preferred mode of 640x350, when in
    fact it wants a 1024x768 mode @ 60Hz. Add an edid quirk that selects the
    largest size mode, preferring those closer to 60hz among equal sized modes.

commit fbd3f588f0d412c20cc3f86dfad73700734a9a76
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Dec 29 10:47:52 2006 +0800

    rotation support for randr-1.2
    
    This patch trys to resolve rotation regression with randr-1.2.
    Tested with Crestline VGA output. See bug 83.

commit a1796bfb51d90fd545973909404e1a77ad27c9cc
Merge: 84915ac fabfccd
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Dec 29 10:10:26 2006 +0800

    Merge branch 'crestline' of git+ssh://zhen@otc-graphics.jf.intel.com/git/xorg/driver/xf86-video-intel into crestline

commit bedab1654e2dfcf7800bd0101e6991800a544019
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 28 16:34:40 2006 -0800

    Remove 8MB/32MB default VideoRam limits.
    
    With modern monitors and increased XV and EXA memory requirements, these small
    limits were resulting in DRI and other initialization failures because we
    wouldn't allow them enough memory.  Instead, allow each piece of the system
    (DRI, EXA, XAA, etc) to request as much memory as it wants, and choose the
    actual videoRam to be used for laying out the memory afterwards.
    
    With this change, in the absence of a VideoRam option, 32MB will be allocated
    for textures.

commit 4cc5dcf6d7423239f0181f246638366edcb8be87
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 16:43:39 2006 -0800

    Oops, dont use symlinks for stolen xf86 header files

commit 86da0d05e4e338e7f4c841577002eb1ba9f6b2ac
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 16:40:54 2006 -0800

    Add stolen xf86 header files to driver source

commit 2b0a997e5b4b51267fa4f6725f8a965093392434
Merge: bb238a8 9cfbf1c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 16:34:38 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit bb238a8fc234a8e5e86cd2f42c58c9816a15732c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 28 16:27:22 2006 -0800

    Configuration support: per-output mode lines, preferred mode.
    
    Add the modelines specified in the per-output monitor and all of the default
    modes to the list to each output. Prune the resulting list to specified sync
    limits and virtual sizes. Sort the resulting mode list on
    preferred/size/refresh.

commit 9cfbf1ceda8f153438df1ba4b1712c55cc872017
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 28 12:59:23 2006 -0800

    In EXA mode, force backing pixmaps into memory when doing XV to them.

commit e889bde13dcc2438181a03319e204ae7b9235a78
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 28 12:49:24 2006 -0800

    Draw textured video to the backing pixmap in the composited case.
    
    Currently, when the backing pixmap is not in framebuffer, we just BadAlloc
    rather than drawing garbage to the front buffer.  This can be fixed with EXA.

commit c7083a6f30fdf1859f60beba4c352bd790af4773
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 28 11:53:33 2006 -0800

    Add WIP CH7017 LVDS driver.  This is disconnected because it's untested.

commit 778db49616b233f5a2f4f007ceb62a1a878a6e25
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 28 11:36:15 2006 -0800

    Add WIP IVCH (i82807aa) driver.
    
    It is not currently hooked up as it hasn't been tested.  The hardware that this
    was written for decided to stop working.

commit 5806f670eb3a5171ffb0b75701640d5311b34c80
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 21 16:22:14 2006 -0800

    Reformat the DVO drivers table to be a bit more normal style.

commit b928cef9cd5b3f88dc0880f406300d246a59e0fe
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Dec 21 16:21:28 2006 -0800

    Move dvo driver detection into i830_dvo_init(), and use GPIOB for LVDS drivers.
    
    The documentation states that GPIOB is (generally) used for devices on DVOA
    on the motherboard, which appears to be the case on the laptop we have with
    LVDS on the motherboard.
    
    This patch is probably not entirely accurate, as there was apparently an LVDS
    DVO card sold that could be put in desktop machines, which would likely be on
    GPIOE like other ADD cards.  Given that we couldn't find one of these cards for
    purchase, I'm not worrying about it.

commit fabfccd3d8a55a83138d361f66c53cb7e6d371a8
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Dec 28 14:48:54 2006 +0800

      Fix

commit ddefce4f02eb3272ad37e890350f73f03eff73c9
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Dec 28 14:45:53 2006 +0800

     support NTSC 480i M-J 1280x1024 1024x768 800x600 640x480
     PAL 576i 1280x1024 1024x768 800x600 640x480
    
     I still have problem with non-interlace mode and Hi Res mode.
     also I don't know how to pickup those mode in xorg.conf

commit c87462ded20904dbc6c6cbdb9547523b75fe5471
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 19:14:14 2006 -0800

    Remove the nasty #define away of ErrorF in i830_video.c.
    
    Every new person touching this file hits this trap, so it's now removed.

commit 6dc3387219b2b31e0c7dbaa88b568fbd54d72878
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 18:58:40 2006 -0800

    Fix operator precedence issue that stuck 965 t-v state into the front buffer.

commit 210f30bd75529d0064bc46af15464a2a47f9d4c6
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 18:57:50 2006 -0800

    debugging for location of various 965 textured-video state.

commit 82738e60769a4798d7425ffc67882d1f74043b76
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 18:35:35 2006 -0800

    Fix discrepancy between XAA/EXA linear allocations that broke EXA XV.
    
    The XAA allocator returned an offset from the beginning of the frontbuffer
    allocation (where the linear allocations come from), while EXA returned one
    from the start of framebuffer.  Now, both of them use the start of framebuffer
    as the reference.

commit 8165e043670f6a7fee5e7e8f33644adda5757591
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 18:17:37 2006 -0800

    Bump the size of the extra space for 965 so it actually fits.

commit f830c55e5f4efc97451240f8f18b49f46e8bce0f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 18:14:59 2006 -0800

    Make the assert() in i965_video.c actually work and expose an error.

commit a75b416c91085df1db4027a25eafcd04fef1e57c
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 17:58:57 2006 -0800

    Replace XAA mark/waitsyncs with the XAA/EXA wrappers.

commit 150010d2f20f4a57f8507eba8762e36966b0f426
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 17:57:34 2006 -0800

    reformat i965_video.c to 4-space indents, 80 columns, no trailing whitespace.

commit 05066632b068ae91d7be77e3a199ea0d337d975b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 17:41:45 2006 -0800

    Move 965 textured-video out to a separate file.

commit 46df75ccd4647ea033583130253a2a2218b34a20
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 27 13:45:06 2006 -0800

    Bug #7524: Major improvements to EXA/XAA static memory allocation.
    
    With this, we no longer allocate XV through the XF86 linear allocator in the
    EXA case.  We also no longer allocate extra space for the XF86 2D allocator
    that we don't use in EXA mode, or space for the EXA allocator in XAA mode.
    The EXA offscreen allocator now gets enough space for several screenfuls of
    pixmaps plus one 1920x1088 movie.
    
    A large duplicated section of code for allocating each framebuffer in the old
    dual-screen mode was also factored out.

commit 84915ac8afeb4bbc03df8f94ab3ba351788d6501
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 23:42:53 2006 -0800

    If DDC detailed modes are missing physical size, pull from features.
    
    Monitors without detailed modes, or those which do not bother to set a
    physical size in their detailed modes may still have physical size in the
    global data.

commit 1e9105395a7900521206b28bae4bb4f85669a0cd
Merge: df9ecf8 c237e93
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 23:34:30 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit df9ecf8ab93f0aeffde11d438513d41220ba75cb
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 23:32:35 2006 -0800

    Change belinea edid quirk to cover the 10 20 30W model as well.
    
    This larger model reported different (but still incorrect)
    sync polarities, so instead of flipping them, just set them to the right
    value.

commit c237e930615f1b048895efe988d28503f5d67c37
Author: Keith Packard <keithp@ukulele.keithp.com>
Date:   Thu Dec 21 23:30:37 2006 -0800

    Use Vesa DDC timeouts for all I2C busses.
    
    The default I2C timeouts are very short, and while most
    modern monitors have no trouble responding at that rate,
    some older ones cannot manage.

commit d8c5dba4d797fc50d7b2b5855f34e2d2e2ad3e4f
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 21:20:43 2006 -0800

    When cleaning duplicate modes, make sure ->Last is reset correctly.
    
    When removing the very last mode for a monitor, move the ->Last pointer to
    the previous list element.

commit fab9a6b6210daea423b609208ef57fa26571f5d3
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 21:19:32 2006 -0800

    Add EDID quirk support for broken EDID data.
    
    For EDID with known errors, add a quirk mechanism to automatically
    compensate. The first quirk is for a Belinea 1440x900 monitor which
    incorrectly specifies sync polarities in the detailed mode.

commit d9b27667e6cc6c7e171b0f513d40be7658cf4574
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 21:17:03 2006 -0800

    PLL computations missed one possible 'm2' value.
    
    m2 was ranging from min <= m2 < max instead of <= max resulting in
    inaccurate PLL frequencies for some modes.

commit c5205595f2abacc9f736e1f53666302ec551cbc4
Merge: b8f3ec7 4c0c1aa
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 21 02:51:33 2006 -0800

    Merge branch 'modesetting' into crestline

commit 4c0c1aa882cfec77b2183baec93cbc4cfaf4abe0
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 02:33:39 2006 -0800

    Computed corred color conversion values.
    
    Extract correct color conversion values for all video formats from
    documentation. Use those, with appropriate conversions, for the color
    conversion register values.

commit 98fd44d681220aa31200e4262f1a7ec952a09530
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Dec 21 01:24:24 2006 -0800

    TV subcarrier was computed from wrong clock value.
    
    The constants provided in the documentation for the subcarrier DDA values
    assumed the clock was programmed to precisely 108MHz, but the PLL can't hit
    that value exactly (or our PLL computation can't, in any case). The
    result was an incorrect subcarrier frequency which resulted in synthetic
    subcarrier phase shift and a lovely rainbow effect on the screen.
    
    Unfortunately, the documentation didn't exactly describe the function
    performed by the subcarrier clock hardware, so a bit of detective work was
    needed. New constants were computed using the code in tv.5c and those, along
    with lots of other values from the documentation were inserted into the
    necessary tables.
    
    The result appears to generate stable NTSC video on the svideo connector.

commit b8f3ec77104882fc755ddc88f2583cd5d15387a4
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Thu Dec 21 10:46:17 2006 +0800

      This fix should be better, I830SetMode will call i830_sdvo_dump,
      if the sdvo is not initialized, X will crash. So any application which
      SetMode will crash X if there is no SDVO output.

commit b83cbec34a8d1ff39bd303fcd27fc03dcdb1d6c3
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Wed Dec 20 17:32:05 2006 +0800

    fix null pointer reference,
    I hit this when running doom3-demo

commit 4ba72fc408e7fab7c384aff5e73f0cfb8fd86cf3
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 22:39:57 2006 -0800

    Reinitialize DGA mode list whenever we update the global list.
    
    DGA has a copy of the current mode list (yes, this is broken).
    Regenerate it whenever the ddx mode list changes.

commit 07d3f141712e2abf704cb68a59cd5d5c3390e2ca
Merge: 0cd1a11 c28075e
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Dec 19 22:01:02 2006 -0800

    Merge branch 'modesetting' into crestline

commit c28075e1d70c98b39fc9829a6a01da171a9b9426
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 21:53:10 2006 -0800

    TV output I830OutputPrivate had wrong type (crashed in SetMode).
    
    TV output private type field was set to I830_OUTPUT_SDVO instead of
    I830_OUTPUT_TVOUT. When DGA mode setting occurred, the sdvo output debug
    code would be invoked and attempt to dereference sdvo-specific bits of the
    private structure leading to a segfault.

commit 2ef4c5e8f6444aad192304e5a2f7a0c77bfb917d
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 16:45:39 2006 -0800

    Re-initialize physical screen size only if -dpi was passed.
    
    Physical screen size from the config file or DDC will already
    be set correctly in the screen structure, unless it was computed from the
    virtual size using the -dpi command line option. Recompute physical size as
    we reset the screen size if the -dpi option was used.

commit b00951a5c87ca8c596ee9cc73d96d598eec60751
Merge: 05cd921 c0a0ddc
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 16:22:04 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 05cd921140fae2746c3421715d7f18248a66735a
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 16:21:46 2006 -0800

    Align textured video dither matrix to window

commit c0a0ddc0ce69b60ac3a58d45cb32ccd0e0bfb0c9
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 19 16:06:13 2006 -0800

    Bug #9382: Save the CRTC's desired mode in the old RandR 1.0 mode set path.

commit 3c86fdda1d09fd22d4c15a8e412611db4cea7dcf
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 19 15:53:07 2006 -0800

    Turn on dithering for 915 textured video

commit 293ad158ece941eeb9894f5af4d663464b9954e5
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 19 14:35:51 2006 -0800

    Remove 8k framebuffer stride restriction on 965.
    
    Also, clean up the message if the limitation is hit.

commit ff1223142aedcf888665de6e4d7d5d03a55b2688
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 19 12:49:55 2006 -0800

    Only erase curMode in i830DisableUnusedFunctions when the CRTC is disabled.
    
    This bug resulted in broken xinerama, among other issues.

commit 3b5703c7fa08e63f2a31be7496ded9c70015946d
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Tue Dec 19 09:49:49 2006 -0800

    Respect the srcdir.

commit d89e211b12ff715d7475421af69157b102accaca
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 15 14:39:14 2006 -0800

    Disable configure-disabled outputs before mode setting.
    
    We're not supposed to turn off pipes/planes/dplls with outputs attached, which
    we could have done before this.

commit 3fc9feec7b29e0b908e3b90e0f6634117d66ba6d
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 15 14:38:23 2006 -0800

    Simplify i830DisableUnusedFunctions() by using the CRTC dpms routines.

commit 7b8056e3e347b15b37be0116315d7d3a23aef99f
Author: Keith Packard <keithp@ukulele.keithp.com>
Date:   Tue Dec 19 01:32:54 2006 -0800

    Writing 1 to I2C line means to tristate the bus so others can manipulate it.
    
    We were forcing bus lines to 1 which was breaking DDC for some monitors.
    Instead, make the PutBits function just tristate when writing 1 bits.

commit 0cd1a11d4493ef4a2d05ccf8aadec743504dba5f
Author: Zou Nan hai <nanhai.zou@intel.com>
Date:   Tue Dec 19 14:03:19 2006 +0800

      fix for bug #108

commit eedef7adc53dd8337d27c02551c5778fb43bae05
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 15:57:44 2006 -0800

    Add a detect() function for DVO chips, and implement it on sil164.

commit 8983845f91cacf8110c70121e0f5f293fe443e6d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 15:57:08 2006 -0800

    Fix crash in xf86SetScrnInfoModes when pScrn->modes ends up empty.

commit fa4642048b183134544fc5ee47558446d27f6194
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 15:32:35 2006 -0800

    Clean up i2c_vid interface, including de-StudlyCapsing and removing dead code.
    
    The old Init() function is removed and the previous Detect() function is now
    init().  This leaves us room in the namespace for a detect() like other
    outputs have ("is the monitor connected?").  Also, Power() became dpms(),
    taking a DPMSMode*.  In general, the mode setting path now matches the intel
    internal path, except for the lack of mode_fixup().

commit dcb069a1da6b3300b0772843dd9b67efdf319637
Author: Dave Airlie <airlied@linux.ie>
Date:   Tue Dec 19 10:29:56 2006 +1100

    ch7xxx: add lookup table for name
    
    Don't load if we don't match name

commit 0305298405bd7018e5c520bdd5ea46a75be09f37
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 14:49:01 2006 -0800

    Limit modes to 165Mhz on CH7009, according to spec.

commit 23114fbccad849249b4b7200e3d085a9ac0e2e99
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 14:47:44 2006 -0800

    Align the driver to the CH7009[AB] spec.
    
    With this, the driver works at 640x480 and 1280x1024 on my panel.

commit 633d718f6fb019844304228a81c84a8605da004f
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 13:59:17 2006 -0800

    Clean up a bunch of log noise from ch7xxx startup.

commit 3167bc6b24bd74c50ca4c4d361b14aa24d77cfa3
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 13:45:55 2006 -0800

    Fix DVO mode valid function to not throw out all modes.

commit 4ca92da5b93b07f0bff51843f8fb5d04a2a29443
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 13:45:34 2006 -0800

    Add save/restore to ch7xxx to avoid segfaults on server start.

commit 31849edb3b503ade659981dfa36babf5ad8757c5
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 13:32:21 2006 -0800

    Move the ch7xxx code to the style I've been settling on for output code.

commit 1975fa5b010100196af201e40f43b30a149b7750
Author: Eamon Walsh <ewalsh@tycho.nsa.gov>
Date:   Mon Dec 18 14:08:55 2006 -0500

    Revert "Convert callers of LookupWindow() to dixLookupWindow()."
    
    This reverts commit 08575331ac75783c9910cfb6e78db701a29983ac.

commit 2d0ca2202cb0d780bb4387bbe04e5caa6512e3b1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 18 10:37:33 2006 -0800

    Bug #8786: Treat pictures with no color data as non-component alpha.
    
    This is an un(der?)-documented part of the render protocol: If the mask is
    alpha only, then the component alpha flag is ignored on it.

commit 65cd18b97bc533b24031d6eb882fd3074779ceba
Merge: bf43f8c 6823ca8
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Dec 17 17:32:24 2006 -0800

    Merge branch 'modesetting' into crestline

commit 6823ca87f3b1ef3b28ed167254dcfce2a80467df
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Dec 16 21:12:47 2006 -0800

    Follow mode setting order in RestoreHWState.
    
    Add delays after output and CRTC disable. Restore panel fit register before
    PLLs are restarted. Move all VGA restore code last. Shuffle various register
    writes around and add delays to match PipeSetMode code.

commit 86558cc622b516b568cc26efdf9b64d4b660f50f
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Dec 16 21:09:31 2006 -0800

    Prefer earliest CRTC when mapping to outputs.
    
    For some reason, the code was preferring the last possible output when
    mapping outputs to crtcs. Use the earlier CRTC instead to make the i830
    driver consistent with BIOS usage.

commit 8e6ab99b3195325f9fe5432725fe328591c0c7e2
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Dec 16 21:06:36 2006 -0800

    Not restoring active outputs. Wait for input sync before enabling outputs.
    
    Oops--looks like a typo to me; the code was callint set_target_output
    instead of set_active_outputs.
    
    BIOS loops waiting for the SDVO input to sync before enabling outputs, this
    makes sense to me.

commit bffd611b0a1cb05868e0f93e6ff9357a3116eaa6
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Dec 16 21:03:15 2006 -0800

    Follow BIOS order in writing DPLL/DPLL_MD registers.
    
    965 BIOS writes DPLL and then DPLL_MD.
    945 BIOS writes DPLL twice.

commit 9b1a1b170befae2e705c23ce295837d0d13b60c0
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sat Dec 16 16:53:49 2006 -0800

    reorder restore writes for 965 VGA

commit 08575331ac75783c9910cfb6e78db701a29983ac
Author: Eamon Walsh <ewalsh@tycho.nsa.gov>
Date:   Fri Dec 15 17:44:44 2006 -0500

    Convert callers of LookupWindow() to dixLookupWindow().

commit 60411bc4d0b3c53850c73b7246d5f7ed5c2d4084
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Thu Dec 14 18:36:44 2006 -0800

    Follow BIOS PLL write protocol (disable,enable,enable).
    
    This gets VGA output and text restore working, but SDVO is still not working.

commit 082519f34b468d0c5aa08db74ff2b51cf411d743
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Thu Dec 14 16:51:48 2006 -0800

    Turn pll/pipe/plane on in crtc_set_mode
    
    Instead of delaying pll/pipe/plane enables to the dpms function, turn them
    on right away in the crtc_set_mode function. To avoid rewriting these
    registers in the subsequent dpms function, check each register written there
    to see if the enable bit is already on and don't rewrite.

commit 55e7a32096a58f7bb2380b04df6b3dd9dc8e5b6a
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Thu Dec 14 16:50:26 2006 -0800

    Respect Virtual in xorg.conf
    
    Instead of growing virtual to fit our desired sizes, if it is set in the
    config file, use the value as the virtual size and make the default
    configuration fit within that size (if possible).

commit d4142abc68888178a8f6c54fdcece91e898bc9f5
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 14 13:49:08 2006 -0800

    Set frame buffer size ranges in xf86_config.
    
    Initialization and default configuration code needs to know the range of
    legitimate sizes for the frame buffer.

commit 2b5a5542ad7d1c558d1684a0a69b66bab6e9d001
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Dec 14 13:43:50 2006 -0800

    Change TV modes from Preferred to Driver.
    
    This avoids having the artificial TV mode size drive overall screen size.

commit 3fe802453a85183a69c36a098639895f49b17df1
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 13 13:15:14 2006 -0800

    Move xf86CrtcConfig to ScrnInfo private.
    
    Pull xf86CrtcConfig out of the driver private structure and allocate a
    ScrnInfo private index for it. Also, make the arrays of outputs and crtcs
    dynamic instead of fixed.

commit 0f6addc8a6aeb9bd041d0f8e8e5850e76764ba51
Merge: 001e272 3fa5b39
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 13 12:10:31 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 001e272437a0247ffbc4b9ff8a3f2b437cf4c533
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 13 12:08:58 2006 -0800

    Auto-detect working TV output by checking TV regs functionality.
    
    We can't figure out which chips are supposed to have TV out, so instead we
    prod the TV_DAC register to see if it will hold the value written to it, if
    not, we assume the chip doesn't have TV out.

commit 3fa5b3998353518c40e2fb0c28b425ee22c8d625
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 13 11:54:36 2006 -0800

    Add magic double-write of the dpll register to fix mac mini cold boot.

commit e27372e85a007d8a7e31678dbdb62755c22918bf
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 13 00:26:27 2006 -0800

    Add some caution with PCI write posting and DPLL delays to i830_crtc_dpms.
    
    While it doesn't specifically help/hurt my test case, we've seen enough
    mysterious behavior that caution is probably warranted.

commit df0a5a25aa72563a33731f8063602dd7faad8459
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 13 11:38:18 2006 -0800

    Rename outputs to TMDS-1/TMDS-2, LVDS, TV and VGA.
    
    These names are reasonably short and describe the connector rather than the
    target media, but we don't appear to have any way to determine what is on
    the other end of the wire. More importantly, they're all unique now.

commit e3604fc63243ab0f31673a923d20e23131b607f6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Dec 13 15:42:53 2006 +0000

    Delete ChangeLog

commit 4cdcaac26b3f425ec8fcc2fd3eaa9bfb7a137422
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Dec 12 23:26:00 2006 -0800

    Write dpll_md register while updating dpll as that appears to be required.
    
    SDVO multiplier on 965 is in the dpll_md register; for some reason, that
    needs to be written along with the dpll value or the multiplier doesn't get
    set correctly.

commit 9dd1520421dcb8c7f36a684f3d2ffb6b42a6671a
Merge: d57a258 63bf484
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 12 22:52:59 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit d57a25815398ae83eae8bdcb3a1b607760aa30b6
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Tue Dec 12 22:48:21 2006 -0800

    Elide duplicate modes in pScrn->monitor.
    
    xf86DDCMonitorSet dumps all of the DDC-discovered modes
    into the monitor mode list without checking to see if they
    are already present. This provides an ever-changing list of
    modes for outputs which have no DDC and which simply duplicate the monitor
    mode list.

commit 63bf48481d4e5e285fdfe7037ea4150283163a54
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 22:42:41 2006 -0800

    Correct typo in mac mini hack, and return modes when the hack is unnecessary.

commit 41444183b59ed84c09749ca89afbef036d42ec5f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 18:08:57 2006 -0800

    Replace custom, partially broken DPMS implementation with a generic one.

commit 7ed1b05922c07ff45a5794a992fd3d59ab55aa73
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 16:03:52 2006 -0800

    Fix mac mini SDVO output: write the SDVO[BC] enabled register state twice.

commit 9776f6c68b3cdd5585e58e677c1b1318d9aedaf4
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 16:02:47 2006 -0800

    Flush the plane changes in i830_crtc_dpms()
    
    Otherwise, the changes may not have taken effect.

commit 54823ac39ce9666099d69196694643f04123cb4d
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 14:38:08 2006 -0800

    Move the SDVO sync detection to after we've turned the port on.

commit ec45d7274333cccd20ad080facc8e995ad7b26b0
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 13:54:49 2006 -0800

    Extend the error state reporting to cover ESR and decode PGTBL_ERR for 945.

commit 838af10b85ee8c085c6d2c4fbe18fd90b2be9d3f
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 13:45:41 2006 -0800

    Move PrintErrorState and CheckInheritedErrors code to i830_debug.c.

commit 668ae6ce3c3c4b93a58749fd44ef32451adb6f9c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 12 11:39:40 2006 -0800

    Set the SDVO port to on before sending the SDVO output on command.

commit 91a538beadc17155be395ea2c8109a0958a969bd
Author: Eric Anholt <eric@anholt.net>
Date:   Sat Dec 9 15:58:47 2006 -0800

    More debugging output for SDVO.

commit ce54538b905eb329f45c1b9b15e95ddce4a7927f
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 8 08:26:30 2006 -0800

    Add a hack for DDC on my Mac Mini.

commit c8c1fb64ccecfb88f9923ad65c9898aa44692260
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 11 16:02:29 2006 -0800

    Move the overlay mode switch status updates to when we enable/disable crtcs.
    
    This should help if we mode switch with randr during video playback, and also
    simplifies the code by moving the protection all to one place.

commit 3f3791ba2ece8e8a7aa3a5676f5f6361862a292c
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 11 15:20:15 2006 -0800

    Remove remnants of old savedCurrentMode hack.  Man, that was gross.

commit c21baa5a3044eb66f2518b018dae07eadb989aa1
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 11 15:15:01 2006 -0800

    Remove dead remnants of old clone mode support.

commit b3865f34669319f449f2da8f87a4eef6ec8e7804
Author: Joshua J. Berry <des@condordes.net>
Date:   Mon Dec 11 14:46:20 2006 -0800

    Include i830.h to get M_T_* compat defines for older X Servers.
    
    Not duplicating the defines ensures that we won't let the compat bits slip
    into the X Server when we move this code over there.

commit 24d9521c7ae72e146025f10ea85b07ebd7041716
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Dec 11 09:34:50 2006 -0800

    Add error messages for previous silent DRI initialization failures.

commit bf43f8ce736d91659c2757fb39b13e63bc5891a4
Merge: 684ea26 9452321
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Dec 8 14:17:43 2006 +0800

    Merge branch 'modesetting' into crestline

commit 94523215127a3458a28d0f1217224a27c8870884
Merge: 75f4df2 fde52de
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Dec 8 14:15:06 2006 +0800

    Merge branch 'modesetting' of git+ssh://zhen@git.freedesktop.org/git/xorg/driver/xf86-video-intel into modesetting

commit 684ea26b740d07ec8f6b0d223c1171e70c073bfa
Merge: 64269de 6b977f0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Dec 8 14:03:10 2006 +0800

    Merge branch 'exa-i965' of git+ssh://zhen@git.freedesktop.org/git/xorg/driver/xf86-video-intel into crestline

commit 99f6f84076b25af69dc226e6d4704c74d207e657
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Dec 7 09:47:34 2006 +0000

    Bump to 1.7.3

commit fde52de870c84821ab457e17634c334a10cf71ab
Merge: 7dbe6c3 85de8a0
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Dec 6 23:40:13 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 7dbe6c378d1bc0c06ed6be4c1f9ca38ac31a5571
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Dec 6 23:39:14 2006 -0800

    Move vga restore to end of RestoreHWState.
    
    I was having consistent system lockups when the vga restore
    was first. Moving it to the end has reduced them to an infrequent
    occurrence (but, alas, it has happened once since). This does not
    make me happy.

commit 28c7002b1cf81e286a083384575d53021d3ce906
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Dec 6 23:35:15 2006 -0800

    Use DOUBLE_WIDE mode on all hardware.
    
    DOUBLE_WIDE mode is needed when the pixel clock is > 90% of the core
    clock rate. The code guesses what the core clock rate is based on
    the bus (AGP -> 133MHz, PCI-E -> 200MHz).

commit 85de8a05804eaebcd61430793ef5406f196f9a95
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 20:26:53 2006 -0800

    Include render.h to get SubPixelUnknown define.

commit 64269de3c34db047e78b788dc5681abdc009f8aa
Merge: 8ddbc26 182d2f5
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Dec 6 18:09:28 2006 -0800

    Merge branch 'modesetting' into crestline

commit 182d2f503a7a1be90d93a4a15059585a564fd3ce
Merge: 677c454 6777d80
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Dec 6 17:18:58 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 6777d8044d5cc063698e05afb7a93a58a7a3b64a
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 17:10:06 2006 -0800

    Harmless warning fix.

commit c6ce8a3c3355e8a56e86856caa56baf1cd3c0231
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 17:07:48 2006 -0800

    Reduce dumpregs to X startup, after a mode set, and LeaveVT.
    
    While here, remove some other register dumping that is better done by
    i830DumpRegs().

commit b23dec37b28a76433ad5d537ab508294e843cabe
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 16:58:24 2006 -0800

    Save/restore registers around calls in PreInit with register side-effects.

commit d3c21c09e3904b3d32aca7563044194b061ac2fa
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 16:50:52 2006 -0800

    Remove stale i830_tv_pre_set_mode. Replaced by generic dpms hook call.
    
    Also replaced by not spamming unrelated ADPA register.  At least, it had sure
    better not be related.

commit 9c3e733aaa2068fcb0164577237ed70d177e9b5a
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 16:36:42 2006 -0800

    Save/restore more TV registers.

commit d5ec9d2160f47f21a6015c1cc05b57274cbb0471
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 6 14:44:40 2006 -0800

    Cannot modify DPLL register in output mode_set function.
    
    DPLL register contains clock setup, so it cannot be written
    from the output mode_set function or 'bad things' happen.

commit 5d345c13a949caef384a63769d7185885de6d26d
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 6 13:19:58 2006 -0800

    Clean up SDVO multiplier debug output

commit 6ee63364f5fabbc5578bcc9ded38c778595f5a6d
Merge: 56f7119 b75ecdb
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Wed Dec 6 12:53:22 2006 -0800

    Merge branch 'modesetting' into nonrandr-setup
    
    Also, fix buffer overflow in i830_debug.c

commit b75ecdb48309a15eb7c52b279c7f8523a95bcd48
Merge: 1cb6311 b3bb10e
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 11:59:33 2006 -0800

    Merge branch 'generic-mode-set' into modesetting

commit b3bb10e33e44c78f132d239e30931f97065a9fd6
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 11:53:40 2006 -0800

    Fix LVDS: Don't change bits in LVDS other than port enable/pipe select.
    
    This behavior matches what we did before when LVDS worked.

commit 47d07b1073c162ec00a8b173b8b6389dc4adbe88
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 10:56:38 2006 -0800

    More LVDS fixed mode fixing: use the EDID DTD's blank length.

commit 727bf1cbf72362edcbdd68001a3558fd2b2b4eca
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 10:12:49 2006 -0800

    Add missing newlines to new debug output.

commit 236c53be5d94798d55219651a6885fee32ce175b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Dec 6 10:10:27 2006 -0800

    Fix LVDS fixed mode code after generic-mode-set.

commit 1cb6311c1182fe98d2b8d237cef42509c3178f9a
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Dec 6 16:31:00 2006 +0800

    fix typo in checking xf86CrtcScreenInit return

commit 56f71194157ef929b62fe34a89c840bd59e56301
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Dec 6 00:13:57 2006 -0800

    Use xf86 structures for default config instead of RandR.
    
    To avoid requiring RandR 1.2 in the X server, use the
    xf86 Crtc and Output structures as the basis for the default configuration
    computation (and, eventually, the config-file based configuration as well).

commit 6b977f0eca388a295ca7348f5960bd8e0192cf1d
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Dec 6 13:24:44 2006 +0800

    fix Makefile.am

commit ffd8aacbe7c72b696ff7257609e3c1d45c057609
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Dec 5 19:48:39 2006 -0800

    new server APIs are not in server-1.2 (version 7.1.99.2)

commit a73649611414cb92697575efa90addfc3cf91cf9
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Dec 5 19:47:04 2006 -0800

    Capture VGA registers sooner so checks are more informative

commit 62fba80d3ea9c185ec8ae1e06c099c02bf844d8b
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Tue Dec 5 19:43:41 2006 -0800

    fix up misleading comment in i830_crt.c about border register

commit 041f0029c78620ca1b50e7e5d11f5d022e189641
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Dec 6 10:43:29 2006 +0800

    Formats fixes
    
    We should use card_fmt for src/mask picture, and use dest color
    buffer format helper. Also fix wrong name for G965 texture formats,
    and pict_x1r5g5b5 isn't supported by sampler engine.

commit 1d94ec7de3387b70815679977cfc5d88200efa99
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 18:22:59 2006 -0800

    Fix ordering of PIPE[AB]SRC debug output to be (x, y).

commit eee23fdd0dadd38a2b80525ec886120150f91077
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 18:19:49 2006 -0800

    Fix copy'n'paste-o of the ordering of h/v fields in DSP[AB]SIZE.

commit 58c247c6de56508b00eadf77b4c145c94134270d
Merge: 0b4c3e7 2e8c927
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 15:28:21 2006 -0800

    Merge branch 'modesetting-origin' into modesetting
    
    Conflicts:
    
    	src/i830_display.c

commit 0b4c3e7bff790e1e99ace5036a41e96046335b04
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 14:39:47 2006 -0800

    Add a bunch of per-register debug code to i830DumpRegs().

commit 7844e576e71c004ed495bbc31f7bbe890d18b8d9
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 14:39:09 2006 -0800

    Move reg dump from i830PipeSetMode to after we set up the modes with RandR.

commit e777d38ce98d7220621b049b09df1deca5a5df42
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Dec 5 10:01:31 2006 -0800

    WIP code to move mode set sequencing to XFree86 handlers.
    
    It compiles.  It definitely doesn't run.

commit 2e8c927f9308069a82f25b65bb0c62bc5a156832
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Mon Dec 4 14:02:30 2006 -0800

    Re-create RandR Crtc/output structures on server regen.
    
    RandR structures must be re-created when the server reinitializes,
    but the driver PreInit function is not re-invoked. Recreate them
    manually in this case during ScreenInit.

commit 583619cdb2b6a469299dd5bf658bf5b51ee999fe
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Dec 4 15:48:04 2006 +0800

    set correct default border color

commit f28d5fc30ccf60d72d5832bb6542522dc7f1c463
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Dec 4 15:47:31 2006 +0800

    fix typo in ps kernel
    
    fix corrupt in some subspans

commit 677c454469a6223460778033758e384e989cea47
Merge: 16f9a56 8fcf9a8
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Dec 2 23:28:38 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 8fcf9a81179ee8577ddab5e904c58fbfd14cf59c
Author: Keith Packard <keithp@ukulele.keithp.com>
Date:   Sat Dec 2 22:58:31 2006 -0800

    DOUBLE_WIDE mode for high pixel clock 8xx. Rewrite PLL search.
    
    High pixel clock modes on pipe A of an 8xx chip require
    DOUBLE_WIDE mode. It's supposed to be modes > 180MHz or so,
    but the board I have requires DOUBLE_WIDE mode for clocks > 108MHz
    or so. The limit is related to the core clock speed of the chip, which
    can be found indirectly through PCI config space. None of the possible
    values explain why this board needs this mode for these relatively low
    clock rates though.
    
    Also, create tables of data for the PLL computation and use them
    instead of code. I think it's cleaner looking. It is also untested on
    9xx. It'll work. Really.

commit 81dde11d419c8f9198ab3502d9813d66d0bc6d6d
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 1 10:37:19 2006 -0800

    Fix copy'n'paste-o from restructure-outputs that resulted in crashes.
    
    Our driver private is stored in the bus that we set up, not the DDC device
    that xf86 code does.

commit a504e31f0fefdec802ae403573f52fac3d577b65
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 1 12:49:43 2006 -0800

    Don't try to write the read-only PP_STATUS register.
    
    Also, don't bother reading the PP_CONTROL register to try to get LVDS status --
    that's what PP_STATUS is for.

commit f21230d3e1cc5470e8f88404b5d9f1702bec44bb
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Dec 1 12:48:57 2006 -0800

    Add the [ax]4r4g4b4 source picture formats.

commit 8ddbc26b276016b922487f7b1e8997998b655a7d
Merge: 93975a5 16f9a56
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Dec 1 10:57:16 2006 -0800

    Merge branch 'modesetting' into crestline
    
    Use new TV output condition (all 9xx except 915g)

commit 16f9a56070a01c7ada8e566d9b73fcf7900136e0
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Dec 1 10:50:27 2006 -0800

    TV output exists on all 9xx chips except for 915G

commit 93975a526086432cdeb8d7ead721a862d632c1e7
Merge: 08b6569 e603cd0
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Dec 1 10:28:58 2006 -0800

    Merge branch 'modesetting' into crestline

commit e603cd0c73344ef137d3276b5cfcbcf4df340778
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Dec 1 10:08:36 2006 -0800

    Leave detected TV status alone when no free CRTC is available.
    
    Yes, this means not detecting TV hotplug when two outputs are
    already running. An alternative would be to turn off one of the other
    outputs temporarily, but that would cause flashing. Something to consider.

commit ec30356d950199903978265076b8a4e3960cf84f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Dec 1 10:06:29 2006 -0800

    Do output detection before any crtc allocation.
    
    Some output detection requires a crtc for load detection, perform all of the
    output detection before allocating any crtcs so that there will be a free
    crtc for any load detection. Avoids losing TV detection when two monitors
    are connected.

commit 7642da82781826cb3b45078750cc54d8f592893a
Author: Keith Packard <keithp@ukulele.keithp.com>
Date:   Thu Nov 30 23:21:39 2006 -0800

    When CRTC is disable through RandR, the mode is NULL. Don't dereference it.
    
    Correctly interpret mode == NULL as CRTC disable, make sure the CRTC is
    disabled in this case.

commit de50ca9ed9e78c17be1badec62e35ed5e4d62b05
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 30 17:56:47 2006 -0800

    Tristate the clock/data pins during GPIO when released while getting values.
    
    While the register is laid out suggesting that you can read a low value while
    driving the output high, and the I2C spec seems to indicate that you should be
    able to as well, and on some hardware this works successfully, on the i865 and
    perhaps some other chips it doesn't.  So, if we're not holding the clock or
    data pin low during GetBits, tristate the pin so that we can successfully read.
    
    This fixes i865 analog (VGA) DDC so it successfully sees slave acks.
    
    Also, improve the I2C bit-banging debugging.

commit 8c44556408601db2be799b5ac5c4da1d92886d31
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 30 15:56:52 2006 -0800

    Preserve some GPIO bits that the docs tell us to.

commit 28401b25cc5c1afb272e506cef196ba3a1258bd3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 30 15:45:13 2006 -0800

    Add debug code for the bit-banging I2C implementation.

commit ff64bc7397cafbec94e388e1625b3a1999f1aca7
Merge: b94b7c4 16e01b1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 30 14:09:31 2006 -0800

    Merge branch 'restructure-outputs' into modesetting.
    
    Outputs and Crtcs now have a driver-independent representation which should
    permit generic code to control RandR 1.2 and startup configuration.

commit 16e01b117bb7ae90b150dd4f25a887dd895cf473
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 30 11:55:29 2006 -0800

    Oops. Don't try to use xf86RandR names, use xf86RandR12 instead.
    
    Attempts to override functions in core server fail, so use
    new names instead.

commit bcf206ff17c6eca8212db72dd86fcd8fdc0162da
Merge: 27ca1c1 2c8c310
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 30 11:39:56 2006 -0800

    Merge branch 'restructure-outputs-origin' into restructure-outputs

commit 27ca1c17aab30670dd1d07e0809fd58cdecfc3b6
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 30 11:39:37 2006 -0800

    Rename I830 randr functions to xf86 as they are becoming generic.
    
    Change function names, create separate i830_randr.h header file
    to contain definitions.

commit b94b7c4bcfdb7ba59ed818f72309b5060a2ab7ee
Merge: b6fc8df 25e6e49
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 30 09:15:30 2006 -0800

    Merge branch 'exa' of ../xf86-video-intel into modesetting
    
    Conflicts:
    
    	man/i810.man
    	src/Makefile.am
    	src/i830.h
    	src/i830_driver.c
    	src/i830_rotate.c
    	src/i830_video.c

commit b6fc8df9a52f5fe1b4d26ae06bc4d48235b44a67
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 29 15:06:32 2006 -0800

    Properly detect the GTT size on the G965.
    
    In the past, the GTT has always been sized just large enough to map the whole
    graphics aperture.  However, apparently on the G965 that isn't the case, and
    it is actually 512KB on hardware with a 256MB aperture.  This resulted in X
    not bothering to allocate memory for 256KB that it thought was already mapped
    into stolen memory, and thus garbage rendering (particularly visible in large
    video modes that displayed this unallocated memory).  The kernel happens to
    get the right answer by hardwiring a 512KB GTT size already, but that may not
    be true on future hardware.
    
    Instead, we use a convenient field in PGETBL_CTL that's specifically for the
    GTT size rather than the aperture size, which gets us the answer we want.

commit 359dc81c07901665da0f86c573c096fa1661cdd2
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 29 15:01:39 2006 -0800

    Revert "Don't allocate stuff in the first 256K of video memory (GATT?)"
    
    This reverts commit 997e8c9bb4235cab1fff4738387df9afcbea0a03.
    
    The GTT is definitely located at the end of stolen memory.  This commit
    apparently worked around mis-estimation of the GTT size.

commit db391e8e4c4d87bfe3ccad0de14dd5b47b69b8fe
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:16:46 2006 +0800

    shut up warning

commit 290f15cd4cda97727ebcaadacbbbf7650278934b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:14:55 2006 +0800

    fix alpha blending state

commit 3d4edd325f3859c749ee42df102bb4239eac5287
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 17:05:32 2006 +0800

    Add in sf/wm program for mask picture without CA

commit a704120b15efae47344a90d972e7f3da64a202a6
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:52:44 2006 +0800

    misc cleanup for G965 vs/sf/wm states

commit e3c70c68e39183226e498271c44e98ef1b96a681
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:40:15 2006 +0800

    WM kernel needs scratch space

commit aa515c54f0cfd9025fc38dc4b7938ff17a8a13fb
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:37:06 2006 +0800

    Setup default border color for our samplers

commit b6eba96584bcd2c024f6443d9f3728eb65b234fb
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:30:53 2006 +0800

    fix vertex buffer size

commit 453842c9ff733af45fa665d9db6a35164f45c60a
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:24:24 2006 +0800

    clean up issue cmd to ring buffer
    
    Make it easy to track different part of ring state, and
    use rectlist primitive instead.

commit 18ad7d5cf04081d89a9f978ccc7794116f7c498b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:04:16 2006 +0800

    remove wrong scale_units

commit 3d5bd0c14eea7951540f7a12eee257428f78e2d1
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 16:02:16 2006 +0800

    Rename exa sf/wm program files
    
    Also fix some minors in wm program.

commit a06beb5f80f097fac3b718e742742bb32f1c1194
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Nov 29 15:47:19 2006 +0800

    EXA state mem for G965
    
    Not split offscreen mem for exa, but alloc a dedicated one
    for G965 states.

commit 9e4e7d4fa25a64a2494e7531967599142e60e716
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 28 16:36:09 2006 -0800

    Conditionally compile old-server compatibility code in.
    
    This also replaces calls to compat code with the real names of the functions,
    and slips #defines to an i830-namespaced version in when doing compat.
    The current server version (7.1.99.2) is still left as requiring compat code,
    since the version hasn't been bumped yet.
    
    This also fixes some failures to call the compat code, and some failures to
    actually compile the compat code.  Oops.

commit 8d9ba2405d1f1e58a0cfb570e83e9206af8525b5
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 28 15:44:06 2006 -0800

    sparse cleanups (use NULL instead of 0 for pointers)

commit dbb8135e10e943a4d4e65f95853eeccc764ccf24
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 28 13:21:31 2006 -0800

    Remove printing of the XFree86 screen mode list, and some other detritus.

commit e8fb40ab1063b18372be2b5996257eb69d3f15c4
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 28 11:17:21 2006 -0800

    Replace custom DDC mode list code with a copy of the X Server's.
    
    The X Server now has most of the mode helper functions we want, and we can
    start removing compilation of our copies when the server is new enough.

commit 2c8c310bd8a105dbeda5c989dca31cc766eb6bb8
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Mon Nov 27 22:18:59 2006 -0800

    Driver-independent code tracks num_crtc itself, don't do it in driver.
    
    Now that driver-independent code manages array of crtcs, let it track
    the count and just have the driver compute how many there are in
    a separate variable.

commit c421724d8151d1d4578468abdbe8fe1120e373ca
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Mon Nov 27 22:15:40 2006 -0800

    Move #include "randrstr.h" from i830.h to i830_xf86Crtc.h
    
    As part of the separation of driver-dependent from driver-independent code,
    the interactions with RandR are moving entirely out of the driver, which
    means the driver shouldn't even know about RandR, while the
    driver-independent code does.

commit e8d1db326388c9a112f2b8e2eff5a81210b8d6e4
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Nov 27 12:01:47 2006 -0800

    Move crtc/output config to sub-structure.
    
    Place crtc/output in separate structure at head
    of driver private structure. Use this from the config code
    to make it driver-independent. Still lots of effectively driver
    independent code that continues to use driver dependent stuff,
    but that will change.

commit 72692ba2e0254460c4f5a8cd476f5748383390ae
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 27 11:23:55 2006 -0800

    Postpone SDVO DDC bus creation until we've detected the SDVO device.
    
    This reduces log noise for those of us with no SDVO devices.

commit 5f38bc3e2a685da5c03efa8103a353f79c842aa7
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 27 11:06:50 2006 -0800

    Reduce the severity of many informational log messages.

commit 85f404bc67d5ab54175c19e75aad406abfcf2133
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 20 09:32:26 2006 -0800

    Re-indent ch7xxx driver.

commit a0518f5a440630365b1d935b7c2d0725f326ad51
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Nov 26 19:44:38 2006 -0800

    Remove mode setting from load detect CRTC allocation.
    
    To share load-detect CRTC allocation with TV driver,
    move it to the output driver

commit a47c549df036990e29f05bc3df80e1a2ab9f3b3c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Nov 26 18:26:26 2006 -0800

    Clean up reworked data structure code so the server actually starts.
    
    Use i830GeLoadDetectPipe again (instead of missing xf86AllocCrtc).  Actually
    create new Crtc structures. Fix a few other NULL pointer dereferences.

commit 2529863a1ade782819d76be2d0dc16e89028c1e3
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sun Nov 26 16:44:17 2006 -0800

    Start output/crtc restructuring work. It compiles.
    
    Outputs and Crtcs are now split between 'generic'
    and 'driver specific' pieces in the hope that more code
    will be able to migrate to the xf86-generic layer.
    
    Right now, the code remains tangled together, significant
    work remains to tease the pieces apart. First the code
    needs to be made to actually work as-is though.

commit 9aca4e207440119f4280b78199a221f85d50c511
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Nov 22 15:52:32 2006 -0800

    Remove custom configuration code (which was #ifdef'd out).
    
    Multi-screen configuration is moving to generic code.

commit 850e3652f4d5bb57f3c4ccb9cf29e2c75fecba9d
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Nov 22 15:36:43 2006 -0800

    Note which pipe has failed to be configured for VBlank interrupt

commit 659e3db925de91954421f7f33c072576dfefcc4a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Nov 22 15:35:59 2006 -0800

    Set up maximum screen size for clone instead of panorama.
    
    This avoids heading past the 8Kbyte stride limit of DRI so
    that 3D will be available by default.

commit 03c12f866529230df7a1503de61954cd5ade242e
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Nov 22 15:34:03 2006 -0800

    Limit DRI use to cases when pitch < 8Kbytes, not 4096 pixels.
    
    3D rendering pipeline is limited to pitch of 8Kbytes and not 4096
    pixels, which rather makes a difference at 32bpp.

commit 6781575f734f05547d7d5ceef4116fc157bba44d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Nov 22 16:49:57 2006 +0000

    Be a little more verbose when rejecting modes.

commit e065324661ad08b3b359136f48090232f6138959
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Nov 22 16:49:36 2006 +0000

    update port attributes immediately when overlay is on.

commit a0a9d1ea2ac9a0c665e5a1de5b8b8358dee3b9b4
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Mon Nov 20 17:25:00 2006 -0800

    Set configured values for screen virtual size and initial frame.
    
    Computation for virtual size and initial frame origin is quite
    broken in xf86 common code.

commit d6a0f917e601ea36643c6ad857756e19d24ecd73
Author: Keith Packard <keithp@bouzouki.jf.intel.com>
Date:   Mon Nov 20 15:17:32 2006 -0800

    Enable second SDVO channel.
    
    Rework SDVO support so that it can deal with two channels correctly,
    also save/restore all connected output timings.

commit 08b6569dc663ddf38cb36a6875de6d4ab55acac9
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Nov 19 16:15:45 2006 -0800

    Enable TV output on Crestline (untested).

commit 05202cabbd23f15330b811ae6b8d708ad042bc40
Merge: ee502dd b945a65
Author: Eric Anholt <eric@anholt.net>
Date:   Sun Nov 19 16:14:18 2006 -0800

    Merge branch 'modesetting-origin' into crestline

commit b945a650e952f98c2d101b71bd3ec0f390478da5
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sun Nov 19 00:54:30 2006 -0800

    Fix TV color key.
    
    Subcarrier defines were incorrect in header file leaving one of the
    DDA phases disabled.

commit 28224af3d90a1a08d54a865dfaf20184330fe8a4
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Sun Nov 19 00:40:46 2006 -0800

    Preliminary 945 TV output. Color key is broken. Fixed mode.
    
    TV output is generating video with this patch, but the color burst
    signal is incorrect somehow.

commit ee502dd92a3dfccdc2efcfb76fc652694bc89e3b
Merge: 15ff17c 2fe6107
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 17 14:57:41 2006 -0800

    Merge branch 'crestline-origin' into crestline

commit 15ff17c756e42f392306820e3f7ffbdcc56b9892
Merge: 9cc2f33 816fc1a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 17 11:48:53 2006 -0800

    Merge branch 'modesetting' into crestline
    
    This works for analog, but SDVO output appears to not work yet.
    
    Conflicts:
    
    	src/i830_driver.c

commit 816fc1a76a5ac738e41b172ba8f43137c1521328
Merge: 9948d83 7a7bb33
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 17 00:05:53 2006 -0800

    Merge branch 'modesetting-origin' into modesetting

commit 7a7bb331e10498e5b8ccec58130bb23334d36562
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 16 21:19:20 2006 -0800

    Don't dereference null DisplayModePtr on disabled output.
    
    During initial configuration, outputs which are disabled have null
    modes.

commit 2fe6107ac68e86ed183d8602436633348340678d
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Nov 17 13:11:36 2006 +0800

    Rotation support for 965GM

commit c4508c1cadf323e9ef1d0e69dd77d5e841a6a978
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 16 21:09:23 2006 -0800

    RandR-based initial output configuration.
    
    Using pre-init computed RandR information, make reasonable
    default choices for the output configuration at startup time.
    Either some preferred size or a size which yields 96dpi is chosen,
    from which other monitors are set to a similar size. The largest
    size sets the screen size.
    
    This needs to be extended to respect config file settings, but
    those have not been defined yet.

commit 9948d8377d70e898260c12210151b952b3fb8bf1
Merge: 45a27f8 b649f95
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 16 19:47:24 2006 -0800

    Merge branch 'master' into modesetting
    
    Conflicts:
    
    	src/i830.h
    	src/i830_cursor.c
    	src/i830_dri.c
    	src/i830_driver.c
    	src/i830_video.c

commit 9cc2f3313d77487dea372e6ab32d6d9c06617ae3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 16 15:12:43 2006 -0800

    Replace broken PCI resource size detection with pciGetBaseSize() call.

commit 45a27f80e1c783627f570c309e7a853dcc9af0c1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 16 13:38:35 2006 -0800

    Remove output options. Let outputs be connected to other crtcs.
    
    Output options will be replaced by properties.
    Permits outputs to be connected to arbitrary CRTCs (within hardware limits).
    No cloning yet.

commit 9aea79d1e954fe4fb5c101edcb7c2d0f706a5c4c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Nov 16 11:40:26 2006 -0800

    Inverted boolean sense when selecting pipe for CRT detection.
    
    Pipes are available when they are not in use.

commit 4889b9f33336c92f07aac86d75f50316db6ef81a
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 15 15:26:31 2006 -0800

    Enable the LVDS if we find it and assign it to a pipe (oops).

commit 854ff826c0031a44e874239c0b0a3533f4d9e14b
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Nov 14 09:14:24 2006 -0800

    Disable setup of the second SDVO device until we fix it.

commit d51555fba4e57c059fd184c1e54822d7e5b62a2f
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 10 14:40:40 2006 -0800

    Fix clock range for single-channel LVDS.

commit dd1dcfab0ab0f2d0c25077fa663209e2762f26e8
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 10 11:08:02 2006 -0800

    Fill in some of the high bits of mode timings for SDVO.

commit 3955f044cfe1d592bcb36c43c539fb4a75840b8d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 9 20:28:46 2006 -0800

    Expose the DDC-probed EDID data as the EDID_DATA output property.

commit 0f5886689d7ef7dbbef6425d5c855ac6b67d3350
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Nov 8 23:19:59 2006 -0800

    Create RandR 1.2 objects in I830PreInit.
    
    Creating the objects early will allow the driver to use
    randr structures to select a reasonable configuration.
    That part has not been done yet.

commit 679c7bd82639a09cdce133becb8a08629ce3a4e9
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Nov 8 21:39:28 2006 -0800

    ignore edited man page

commit 81b7b489afa2cab4d8614c64f4906be627f1d07e
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Nov 8 21:38:00 2006 -0800

    Adapt to RandR updates that split object creation from screen association.
    
    RandR DIX code is preparing for xf86 drivers that want to allocate RandR
    objects at PreInit time. This patch adapts to that change without taking
    advantage of it.

commit 81bace0c316c3ed80201a34eca533254d12cd193
Merge: 713c5b0 beb8916
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Wed Nov 8 20:23:20 2006 -0800

    Merge branch 'modesetting-keithp' into modesetting
    
    Conflicts in PipeSetMode were resolved to use the keithp changes
    that pushed more modesetting stuff into the per-pipe function.
    
    Switched availablePipes to num_pipes.
    
    Used modesetting default output configuration.

commit 713c5b0899428edfea7cea0780244488115dbe1d
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 8 19:55:31 2006 -0800

    Change the output and pipe "is it on/off" field name to "enabled".

commit ff77e9d84f2037b99a8e4ac55da0b0ac92ed6b9b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 8 19:53:31 2006 -0800

    Clean up i830_crt_detect_load() a bit more.
    
    ADPA might not have been set right in some cases (DPMS-off monitor, for
    example), and a wait for vsync that the bios does was missing.

commit 9b267014b55f49d9362c1d432d6ba19ddd0ad95d
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 8 19:39:18 2006 -0800

    Go back to only setting up outputs that have a display connected.

commit 35ab689bbde5f74752598cd743d735640486b639
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 8 19:35:49 2006 -0800

    Fix i830DisableUnusedFunctions after pipe structure change.
    
    Using "pipe" instead of the index "i" meant pipe(3) got referenced instead of
    a nice small integer.  Oops.

commit b649f95ea6fd3555d073fdbf8f2f035dfe1afd33
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Nov 8 19:01:25 2006 +0000

    Disable some debug message

commit 75f4df278e9db360967d77cdba4756cbde622d56
Author: root <root@localhost.localdomain>
Date:   Wed Nov 8 13:56:32 2006 +0800

    855 fix

commit f1ff01e31eb8e9dc05190bf1a8b318d4f587f64a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Nov 4 00:46:18 2006 -0800

    Eliminate operatingDevices member and PIPE_* values.
    
    operatingDevices and MonType1/MonType2 duplicate information already stored
    in the device structures. Eliminate them and replace uses with direct
    references to the appropriate other data.
    (cherry picked from 3ab7f9693217d8fe993bdc94c376b219b0082961 commit)

commit 0b2d36d4f038c4e8fa08632b6f1368627f010392
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 23:29:12 2006 -0800

    Use pI830->availablePipes instead of MAX_DISPLAY_PIPES everywhere
    (cherry picked from e4bcec796e80e9fd66ab0c36394f5946915531f1 commit)

commit d0ef9e99acb9e999e1b6d3eb76edc6355555043b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 6 18:30:46 2006 -0800

    Restore PFIT_CONTROL before turning the LVDS back on in the restore method.

commit 94a3731c2b4f2ea2e696a8c87dccc0d214d41e8e
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 6 18:26:48 2006 -0800

    Move PFIT_CONTROL disable for G965 up before post_set_mode.
    
    Also, remove setting of some other random registers that appears to have
    been spammed in at the same time, and don't try to disable on the I830, before
    this register existed.

commit beb89163d73376e70870e6e2a6b19863f3a058b1
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sun Nov 5 19:06:45 2006 -0800

    DSPSURF must be page aligned. Place intra-screen offset in DSPBASE.
    
    DSPASURF/DSPBSURF can only take page aligned values, ignoring
    the lower order bits. So, place the offset for the output
    within the frame buffer in the DSPABASE/DSPBBASE registers instead.

commit 997e8c9bb4235cab1fff4738387df9afcbea0a03
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sun Nov 5 18:56:33 2006 -0800

    Don't allocate stuff in the first 256K of video memory (GATT?)
    
    Letting the ring buffer or other objects be allocated within the lowest
    portion of memory appears to trash some memory mapping data; I'm assuming
    this is the GATT table on the 965. Just marking this out of bounds for
    allocation fixes this problem.

commit 5a355c72614ed77f2000e5ede45f3ff5990c79d9
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sun Nov 5 18:51:28 2006 -0800

    Fix CRT output on 965 chipset.
    
    A few more register settings are needed to get CRT output working on the
    965 chipset, in particular the the SDVO/UDI clock multiplier register
    needed to get set to the default value (3). No, I really don't know what
    this does, but it does get the CRT running at a wide range of sizes.

commit 49a6bea7d969dbfd1dd542c0c3e02abc330d6850
Merge: 64447c7 fbb376b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Nov 6 10:25:23 2006 +0800

    Merge branch 'master' into crestline

commit 68c3185046b27ab936ca6c92b924b443b3cd6fce
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sun Nov 5 13:30:32 2006 -0800

    Avoid crashing when disabling sdvo output. XXX

commit 15ef08046bcc3e746453301379f7c5d1bf929ee1
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Sun Nov 5 13:29:56 2006 -0800

    Move remaining pipe mode setting logic to i830PipeSetMode

commit 7fcb555735a58e19ccc10875b211402983170a87
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Nov 4 00:52:21 2006 -0800

    Rename availablePipes to num_pipes

commit 3ab7f9693217d8fe993bdc94c376b219b0082961
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Nov 4 00:46:18 2006 -0800

    Eliminate operatingDevices member and PIPE_* values.
    
    operatingDevices and MonType1/MonType2 duplicate information already stored
    in the device structures. Eliminate them and replace uses with direct
    references to the appropriate other data.

commit e4bcec796e80e9fd66ab0c36394f5946915531f1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 23:29:12 2006 -0800

    Use pI830->availablePipes instead of MAX_DISPLAY_PIPES everywhere

commit b7262a9a9110dac66e1a92c39dcb3ab59d95d081
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 23:24:07 2006 -0800

    Finish removing persistant vbe data

commit 4625073244d4f521a07e12adcf0609e85658acbe
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 23:23:38 2006 -0800

    Oops, martian memset of randr modes pointer

commit 719ad68515be9b996a6314de5448843de1146b88
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 19:41:41 2006 -0800

    Use VBE only temporarily to fetch BIOS rom image
    (cherry picked from 6a9386651785afc70a29e355255e8295b321f28e commit)

commit 27df2ff7908ea7ea2943a5f3445e12dbc24d97c9
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 15:55:10 2006 -0800

    Report pipe status (and status mismatches) in i830DescribeOutputConfiguration()

commit ecbe73b940b2d642115de4b73c2f757eb46ff956
Merge: 561af00 9681602
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 15:59:59 2006 -0800

    Merge branch 'modesetting-origin' into modesetting
    
    Conflicts:
    
    	src/i830_display.c

commit 561af007974b8cdad1eea907fb73ed9d430c21ac
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 15:26:14 2006 -0800

    Add support for load-based CRT detection.

commit e416b426d83de031441ada7a77b6bd66cec8b5c9
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 15:25:41 2006 -0800

    Print out modelines as info, not error (which had been used for debugging).

commit 282a9e073ea985cbf0d0f3f296d593af1426bad5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 13:46:09 2006 -0800

    Don't memset the modes pointer on init, which was dereferencing NULL.

commit 9681602177124e84a817a1e1d428f1779f2a45c9
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Nov 3 12:55:25 2006 -0800

    Create I830PipeRec to hold pipe-specific data. Remove unused I830 members.
    
    I830 contained six parallel arrays for pipe-specific data; these
    have been moved to a I830PipeRec structure instead.
    
    I830 also contained several unused members:
    
       unsigned int bios_version;
       Bool newPipeSwitch;
       Bool fakeSwitch;
       int fixedPipe;
    
    These have been removed, along with the code that set them.

commit 0510671a6c5233468ac20f0ec8096e084df03ce6
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Nov 3 10:58:23 2006 -0800

    Fix a pasteo in I965 register restore.

commit 2c9ab6e0594769274f2dbcdf7c00fe297fc385d5
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 13:44:55 2006 -0800

    set the v_sync_off_high to zero. XXX should check docs

commit 56f6d4f1bb67f447500af3f4f7fa557c3e887baa
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 13:42:17 2006 -0800

    Disable the panel fitter when not using it. Cleans up SDVO DVI output.
    
    The panel fitter appears to exist on the 965 hardware (at least) and
    causes troubles with DVI output over SDVO when enabled. This patch
    checks to see if the panel fitter is pointing at the pipe being configured
    and disables it unconditionally in that case. The LVDS driver will configure
    it correctly if necessary afterwards.

commit f22d9bcc25aea19ba38d35282367b591fd1b7ca0
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 13:34:45 2006 -0800

    Add another couple of new registers

commit a9eac38bcdb49df2ce1122b49bd8b1eb19e8cae5
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 2 13:24:54 2006 -0800

    Remove duplicated register defs that were just added.

commit 7887c76062b7c79e14fb8e4f13486aa592dcbce8
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 2 12:27:21 2006 -0800

    Add airlied's I2C code, ifdeffed out.
    
    I've gone back to compare our behavior to it several times, so I'll just keep
    the code in tree for now.

commit 87b15cfbf762468d4b8728b3e7a39c76654017de
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Nov 2 11:30:21 2006 -0800

    Remove dead specifiedMonitor field.

commit 2636d68663a02f6d9eaf36971706b67036ebf56c
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 11:57:11 2006 -0800

    Dump more registers for debug purposes

commit 786ec54c4c1540f4aced63ef21d567c3b9f3282e
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 11:56:50 2006 -0800

    Add a few more registers from the 965 spec

commit 85e32ad2dadcce1134fcadb14ece8ff30f3925f2
Author: Keith Packard <keithp@mandolin.keithp.com>
Date:   Thu Nov 2 11:56:12 2006 -0800

    ch7xxxSaveRegs receives real type instead of void *

commit ffbd6ca09bc2300bf967d7c248a559d85b8706e0
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 1 13:05:44 2006 -0800

    Remove dead VESARec struct.

commit 97c3a1b2421031e41f0b2b1630fde1dc4262d264
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 1 13:04:08 2006 -0800

    Remove the refresh rate appended to some mode names.
    
    This gets the SDVO and CRT outputs I have to have at least 1 common mode
    according to RandR.

commit 7971c401554c218c84a8c45335c9b31bbccfece7
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 1 12:42:56 2006 -0800

    Attempt to pull monitor physical size information out of DDC EDID data.

commit fb94c1210966f7875e5f034f10ea31c06c502c3a
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 1 12:23:50 2006 -0800

    Move mode lists from per-pipe to per-output.
    
    This should let RandR do the right thing in exposing the modes to userland.
    
    As a side effect of getting this working, the SDVO pixel clock range code
    was fixed and the mode valid tests for various outputs got extended.  Also,
    LVDS grew a get_modes for the fixed panel mode.
    
    Note that we now no longer do automatic enabling of outputs at xrandr -s 0,
    hotkey, or VT switch.  That will be left to generic RandR code later.  Also,
    generic modes and user-defined modes are once again not validated into the
    lists, so this is a regression there.

commit f30d7f912f36b110c3af7dc795e35456593781ab
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Nov 1 11:50:51 2006 -0800

    Update for the move of RandR phyiscal size information.

commit 64447c7a059775e7ea8649f4714df7565e932c60
Author: Zou Nanhai <nanhai.zou@intel.com>
Date:   Wed Nov 1 14:36:20 2006 +0800

    walk around to VBIOS bug in Crestline B0

commit 7195dfabd56239f08cdd8175a2ef3a66ef9600de
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 17:10:08 2006 -0800

    Give each output a get_modes function and expose those modes through RandR.
    
    The get_modes should return the probed modes only.  The driver should then
    append to the list (for example, compatible modes listed in other outputs,
    or standard VESA modes) to create the list to expose through RandR.  That
    isn't done yet.

commit cc3728be2481637dda321d3bc2e4e89a220699cd
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 15:00:36 2006 -0800

    Add compat definitions for M_T_PREFERRED and M_T_DRIVER for older X Servers.

commit a71f283650e8cb7b760e5a53c4db79202c4cc5c4
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 14:46:23 2006 -0800

    Connect output detection up to RandR.

commit 68cef9f4e028755bbf3e1862da2ef47d46ddaa6a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 14:32:00 2006 -0800

    Move output connection detection to a per-output method.
    
    This will be used by RandR, and should let us clean up some of the initial
    display configuration, hopefully.
    
    Also, analog hotplug-based detection is now enabled on G965.

commit 9fd719fce27f916ab5120f6e1234affa14eaed9d
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 14:29:44 2006 -0800

    Move SDVOB_PRESERVE_MASK next to SDVOC_PRESERVE_MASK.

commit 4f5d4d8870fc2784192f95a561163cf4fc8737ac
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 13:37:23 2006 -0800

    i830SetLVDSPanelPower is now a static function in i830_lvds.c, so remove it.

commit 49bbdf16c02107c08169f8d2b6e9c6dbd7d8cd95
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 10:44:45 2006 -0800

    Fix many inconsistencies in the SDVO code compared to the spec.
    
    Also, fix some struct padding  so that the right bits are sent out.

commit e7d546cac06767ec58325396a3bb5780b2257c53
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 11:24:43 2006 -0800

    Remove some dead code from BIOS modesetting.

commit 2ca57040b0cd24ad3dbe693789091e28be4e69f8
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 11:19:19 2006 -0800

    Remove GetBIOSVersion().
    
    This info hardly useful now that we don't use the BIOS for mode setting.

commit 837b2f632062bc29268f109895a577bd90cabd6d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 11:17:55 2006 -0800

    Warning fix.

commit bca9e6ccbd14eb8f2f103e8e64b28a623113d494
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 11:17:27 2006 -0800

    Remove SetPipeAccess and now-unnecessary VBE reinit.

commit 819a47b27cd4728feb269a08be32403304993ffa
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 09:50:33 2006 -0800

    Use the new fields for SDVO pixel multiply on the G965.
    
    This should fix display at resolutions/refresh rates in a different multiplier
    class than the console display (generally, high resolution modes).

commit 71545db4614cfc4650acc4325912474e777c3b36
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 09:46:10 2006 -0800

    Return and use valid status bits for i830_sdvo_get_trained_inputs().

commit c357eca10ca1c535d305e1f3028471a912ae4102
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 30 09:44:55 2006 -0800

    Clean up whitespace in i830_randr.c.

commit fbb376bd1a4daad4c86e349df98438989ce173f1
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Oct 30 14:15:12 2006 +0800

    Bug 8594: Fix Xv hang with G965

commit c0ee50c4ee5ff2c594fdf60c9cb8b952e25644de
Author: Thomas Hellstrom <thomas-at-tungstengraphics-dot-com>
Date:   Fri Oct 27 19:13:33 2006 +0200

    Add support for the new DRM memory manager.
    Some code are duplicated with the new libdrm.
    Once this code has been released with xserver,
    it can be removed.
    
    See the man page for new options and backwards
    3D driver compatibility.

commit 25e6e497824a23eb231fc6fd6e483f601d612cee
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 26 15:47:49 2006 -0700

    Major cleanup of 3D invariant state, fixing hangs with rotation and render.
    
    Now, the generic invariant state is always set while the X Server is active,
    and happens automatically when the X Server grabs the DRI lock.  More 3D state
    is moved to the generic code.
    
    Then, the 3D consumers (video, rotation, render) set last_3d to their enum
    entry, and can update their own invariant state when another consumer was
    active.

commit 0bdcce2e4541c6e441c44aad49254ad3093cedb2
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 26 14:30:46 2006 -0700

    Note alignment requirement for i915 3D (texturing).

commit c3666a968b1cfac61b7867874d5fbe2acd894720
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 26 14:30:25 2006 -0700

    Don't write unused values beyond the end of scale_units array.

commit 3ab9f5a4a8cd62c8a8c2a09d3d105adbe815a83d
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 24 00:26:09 2006 -0700

    Move vbeInfo out of the driver struct to the one place it's used.

commit df14838eb5d0a056f663d9f12bd8b5c25cf97330
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 24 00:18:33 2006 -0700

    Remove dead memsize reporting.
    
    The calculation no longer made sense, as we don't use the BIOS for mode
    selection.

commit 3a6104ab89b159241845314ccf88fa62da14cf7d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 23 19:15:30 2006 -0700

    Remove disabled I830DetectMonitorChange().
    
    This used to be called when switching back in to X.  It might make some sense
    to detect monitors at this time (it happens to occur at resume time, when
    monitors are likely to have changed), but it should probably live in either
    userland policy with RandR 1.2 or RandR 1.2 XFree86-DDX generic code.

commit 88c12f577f80fa132ec45cdf456d8060f2ece4fd
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 23 18:57:57 2006 -0700

    Move LVDS initialization and blacklisting damage to the LVDS support file.

commit 2631014e9d5b2e64908ea413729eb5fd819b17fc
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 25 12:21:44 2006 -0700

    Clean up the SDVO code.
    
    The main change is to send SDVO commands using data passed into the send
    command function, and receive responses into memory passed into the read
    response function, rather than stuff things in/out through dev_priv->sdvo_regs.
    This lets us use structures to represent some arguments, which results in a
    nice cleanup (and 100% fewer arguments named magicN as a side effect).
    
    Also, the mode set path is changed to not do any preferred input timing
    work.  We weren't doing anything legitimate with the results, since we didn't
    modify the CRTC timing appropriately, so now we just stuff the CRTC timing into
    both and hope for the best.  This should probably be revisited later.

commit ddb986e54f5320359abac06f512f2d3f446872db
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 24 17:47:58 2006 -0700

    Nuke trailing whitespace in SDVO code not already cleaned up.

commit cd2f0d948a6cae61b0d77d2c7184ed8d695be8c3
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 24 17:47:47 2006 -0700

    Clean up SDVO code, moving the private structure internal and cleaning up caps.
    
    All the SDVO code should now be in lower case rather than StudlyCaps.
    
    This also adjusts the I2C setup to create a bus per SDVO output we set up.
    The previous setup with shared buses was failing in some circumstances, which
    is probably due to the lack of refcounting in xf86i2c.c.

commit cd9c6e29146e1debaba4b0b9ad0d241f07bdbc14
Merge: c5cca4c eec5580
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Oct 24 16:53:46 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit eec5580cefffc293bf547372ab63b2fedaef4a83
Merge: 53c28b3 a91c0cb
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 23 14:52:55 2006 -0700

    Merge branch 'overhaul' into modesetting

commit a91c0cbab5de51885bfce7c7dce76f82c1b19553
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 23 14:30:38 2006 -0700

    Add work-in-progress integrated TV-out support.
    
    This is the TV connector on board for the 915GM and 945GM.
    
    It is currently not hooked up to output initialization as it's entirely
    untested.  However, I think this is a reasonable starting point for getting
    TV-out actually working.

commit 7d67324fa3a5b5cf0227550316c366752fe4abfb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 23 17:29:17 2006 +0100

    Add some MergedFB checks for accelerator limitations

commit 20d263805a365be548279758bc39d027d6e56d63
Merge: 8548fa5 5ac927d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 23 14:24:41 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 8548fa53746c9886eccfb67d022136471d8f3316
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 23 14:23:29 2006 +0100

    Fix manpage to report 8160 instead of 6144 for LinearAlloc.

commit 5ac927d6f05ba6f9608d7e758cbac66e8b3a9db1
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Tue Oct 17 13:27:40 2006 +0200

    Don't crash if SetCursorPosition is called with pScrn->currentMode == NULL.
    
    This allows the driver to work with servers that don't have the fix for this
    that was only recently pushed to git.

commit 8149681f2eac0af3b70a9457c5204e17da56142b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 16 16:51:04 2006 -0700

    Add a per-output mode-valid method.
    
    This is currently disconnected, but will be used in more overhaul work.
    This should be where any output limitations, such as clocks, resolution,
    scaling limits, or other options, are validated.  Other limitations, such as
    chipset resolution limits, CRTC clock limits, etc. should be elsewhere.

commit c5cca4c20ae6b519e3b021a9d90809c1b3d1facb
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Oct 13 15:31:43 2006 -0700

    Advertise textured video adapter first

commit adae75ef2f8a655a699e982ca8f26b934dbe950a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 17:10:27 2006 +0100

    Make VIDEO_DEBUG into a configure option

commit 1d4cfaa391ac41099de11b8f3b21e5eb56543909
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 13:55:10 2006 +0100

    Bump to 1.7.2

commit cd9e51cd3ab0b36d2f97dfc6d8850dafe169c221
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 13:54:31 2006 +0100

    Ugh. Turn off debugging.

commit 334aa062c333f2c59bc40e1b9239d3ea71c88a8f
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 12:59:30 2006 +0100

    Bump to 1.7.1

commit 8045a7a0af1b276cd7f46ce99d034fd5d503e67c
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 12:53:53 2006 +0100

    Fix bug #8553 & #8542 - suspend/resume regression from 1.5 driver

commit 6596333b077a692c669f8cb4ae32e145f8da6731
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 13 12:48:16 2006 +0100

    Fix some warnings

commit 1838671476875e9f5b3dde235eacf9fb43afb66c
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 10 12:41:01 2006 -0700

    Only disable the output when marked disabled.
    
    Also, remove a couple of dead variables.

commit 4198f1216eb13b30d1e92d4395e98861f4324c38
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Oct 10 15:50:10 2006 +0800

    Mark current ps kernel is experimential with little test.

commit d485c1f2de11db92b515690fbe38b6aeb6207605
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Oct 10 14:11:35 2006 +0800

    Use sf_prog.h instead

commit 2591c1fcf15608d96031be4760cf08534461ca34
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 9 14:20:49 2006 -0700

    Fix LVDS restore path, and move pipe assignment for outputs to the right place.

commit 09e3d10b0ff69d180467fa9099d12da08e4f681b
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 9 13:09:18 2006 -0700

    Add a function for describing the output connection configuration.

commit 317cc119c575650c1aa8bf992a0f42bdfffcd7ba
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 9 11:49:18 2006 -0700

    Move per-output mode setting code to per-output methods.
    
    This is not a very clean interface, as a number of outputs require tweaks to
    the DPLL registers.  When possible, the DPLLs are just adjusted in the
    per-output post_set_mode, which happens just after the DPLL is enabled.
    However, this seems better than the previous method of having all outputs
    programmed in the same function.

commit 53c28b3980d2682de830e8f86553ccad71527ac1
Author: Adam Jackson <ajax@benzedrine.nwnk.net>
Date:   Sat Oct 7 11:18:26 2006 -0400

    Expand the check for AOpen Mini-PC.
    
    Just match on subsystem vendor, don't bother inspecting the subsystem device
    ID, since apparently they're all busted.

commit bf3820f1f505649ac0730add23d97d6de3f6d22c
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Oct 6 21:57:26 2006 -0700

    Compute LVDS resolution from server DPI and native panel size.
    
    I was unable to find the native LVDS panel physical size in the BDB
    information. I would prefer to report accurate information through RandR if
    possible though.

commit c7a23908a0ef45b14b438f656a5f15582bfcbc1c
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Oct 6 13:35:39 2006 +0100

    Fix server regeneration problem mapping the aperture

commit d649fb0d964a9b40b8e04314b5fc14bbbfd41bc3
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Thu Oct 5 22:46:07 2006 -0700

    Don't require MonitorLayout when two monitors are plugged in.
    
    With randr12 working, we can just leave the second monitor off for now.

commit 9bb7736ab36f172db58703c4664bb1b0cd7f80c3
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 5 16:02:02 2006 -0700

    Remove checks for output privates in various bits of code.
    
    Now, the output is only set up if it fully initializes, so it will never exist
    if the private it requires doesn't.

commit ada8f62da263d1e93e22df4e0b1149bf1dbe24d4
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Oct 5 15:55:07 2006 -0700

    Give each output type an init method in its file, making other methods static.

commit 0a5504e59f90abecedd81a8435b88a60fe098f29
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Oct 5 09:11:29 2006 -0700

    Fix DPI at startup in RandR 1.2 code.
    
    Use requested monitor resolution to compute the appropriate screen size when
    resizing the screen during RandR initialization.

commit 4ac81d58b7e0fbffbb4981deffe6a576be821a9b
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Oct 4 23:22:52 2006 -0700

    Remove mode origins, add preferred mode count.
    
    Just tracking changes in the 1.2 protocol spec.

commit 103b4edce7859ddf58f3e1fadeb427a5e85c7acd
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Oct 4 15:00:19 2006 -0700

    Move the save, restore, and DPMS per-output settings to per-output files.

commit 16988b27258acfe3d56fc2415aa9ade1ae8d03a9
Merge: cc4148e 5a06000
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Oct 4 18:44:43 2006 -0700

    Merge branch 'modesetting-guitar' into modesetting

commit 5a060002487e16c53dc96e32af72cd1bfcf6a227
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Oct 4 18:43:07 2006 -0700

    Add mode origins for randr

commit 07cdc60be8ebe5d0c21149f3cd2aeb8fed05022a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Oct 4 11:05:30 2006 +0100

    Fix bug #5795, VT switching fails because of a bad test on some platforms.

commit 8da10d15f84ccc992b828546af5ba0d848e7263e
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Oct 3 22:00:14 2006 -0700

    Enable XV_PORT attribute even when not in Clone mode.
    
    As Clone mode is now something that can change after server startup, always
    enable the XV_PORT attribute as we cannot change the list of reported
    attributes.
    (cherry picked from 1bc1cedbcdf6ea4d2a3e8b07b553ac50b3c126f4 commit)

commit cc4148e25dc226cb1365e090db21f01b77cb3cbe
Merge: 1bc1ced 3e6f81f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Oct 3 22:00:41 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit 1bc1cedbcdf6ea4d2a3e8b07b553ac50b3c126f4
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Oct 3 22:00:14 2006 -0700

    Enable XV_PORT attribute even when not in Clone mode.
    
    As Clone mode is now something that can change after server startup, always
    enable the XV_PORT attribute as we cannot change the list of reported
    attributes.

commit 33629ed304b64e45d5640397bd1807c5a98907d1
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Oct 3 09:39:22 2006 -0700

    Always register list of modes for outputs, even when disabled.

commit 3e6f81f70f65a5ba6b5c3a4e0eeaf67776a5f54d
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Oct 2 09:53:57 2006 -0700

    Move cursor base address register setting to a separate function.

commit f337eea9e73cbf5c71d07df50d2e5b661a1f34cf
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 2 11:16:42 2006 +0100

    silence warning

commit 2b9bdd8a4021231e4b5f4c5831a46c9ff1e38081
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 2 11:12:23 2006 +0100

    bump to 1.7.0

commit eca082ca0fec12973a4dbb0106b841136b5b6cdb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sat Sep 30 13:44:43 2006 +0100

    Missing gamma bit

commit cece9a455b54ab184a3277c164ee6dfa65b70f48
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sat Sep 30 13:27:27 2006 +0100

    Fix issues with Xv locking up the engine. bug #7915.

commit 2013b839de3733fd12becb2cc3c1daadde329eb4
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Sep 28 13:49:44 2006 +0200

    Always call I830UpdateXineramaScreenInfo() unconditionally, and document why.

commit 92c5020bbd31e02c7224798a8f094d237afa19a0
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 13:55:52 2006 +0800

    Fix picture's transform checking

commit 518802843284973f1f86132afd805c0e662e1ba6
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 11:15:33 2006 +0800

    Fallback in mask picture for now
    
    Do it later after finish wm kernel program.

commit 25ff5baad95c205c7c690da72fc0f252b3ed9289
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 11:09:52 2006 +0800

    Fix compile, add wm header file.

commit c3a49b5123d094280b5ff358ceef961958319ce4
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Sep 28 10:36:00 2006 +0800

    Add simplest wm kernel program for no mask picture composite
    
    This is a try to use new gen4asm language, and will finish
    composite program for mask picture with or without CA case later.

commit 6ea16bf6b06c8b3aed4d2c98679ab28304d1b56c
Merge: fdb6de6 b970166
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 27 16:38:01 2006 -0700

    Merge branch 'master' into modesetting
    
    This reverts most of the mergedfb code.  This will instead be done in device-
    independent RandR code.
    
    Conflicts:
    
    	src/Makefile.am
    	src/i810_driver.c
    	src/i810_reg.h
    	src/i830.h
    	src/i830_cursor.c
    	src/i830_driver.c
    	src/i830_modes.c
    	src/i830_video.c

commit fdb6de663579d3b9f31bf9e8a93430b8505ca73f
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 27 13:59:41 2006 -0700

    Re-disable broken load-based CRT detection.

commit 1407a42c7378706644fd8be554b43b0e7b581011
Merge: 25890ec 4bd3b89
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 27 13:33:23 2006 -0700

    Merge branch 'randr-1.2' into modesetting

commit 25890ecda9fd00fad9bc53dea83fc58e0013fcdf
Merge: 965609f 117ff04
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 27 13:33:17 2006 -0700

    Merge branch 'acpi-hotkey' into modesetting
    
    Conflicts:
    
    	src/i830.h
    	src/i830_driver.c

commit 117ff04b504578a24dff70659e2db1b81aaa1177
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 21 17:03:34 2006 -0700

    Attempt to make the ACPI hotkey support a little more modesetting-compatible.
    
    Previously, we watched for the BIOS to have changed the layout, and repaired
    the resulting configuration.  Now, we request that the BIOS make no changes,
    but leave a note in a register for when the key has been pressed.  When we
    notice this, we reprobe monitors and turn on/off the things we find.
    
    This is a temporary solution until we can get the hotkey hooked up as an
    input key to external applications to control the change using RandR 1.2.  It
    is also untested as neither of my laptops do anything with the hotkey.
    However, this code does result in many fewer BIOS calls.

commit fe691953f08b4d299295f91450412404ba42810b
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Aug 31 18:35:10 2006 +0200

    Store viewport limits of both pipes in SAREA.
    
    This allows DRI clients to determine which pipe they should synchronize buffer
    swaps of each window to.

commit 06c5f7bd076e9ba4b925e061a40b837714bc8267
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Wed Aug 30 19:45:33 2006 +0200

    If the DRM can handle it, enable vertical blank interrupts for both pipes.

commit 89cbc6e215a5f313ccc17370424c35630cf75892
Author: Michel Dänzer <michel@tungstengraphics.com>
Date:   Thu Aug 24 10:30:27 2006 +0200

    Only enable the IRQ after DRIFinishScreenInit.
    
    This makes sure we've been assigned a context ID, so the interrupt context
    won't mess things up if it grabs the HW lock.

commit 185df8a18102eea79b8c8e11304dfee148ac2002
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Sep 27 16:48:43 2006 +0800

    Add mask sampler state

commit 1422d4f04ac2d57899eee91f6522f8670f7263da
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Sep 27 13:54:14 2006 +0800

    change some src sampler states
    
    sampler for mask should also be set up, and fix
    default border texel.

commit 6614b4bda2e079fd1e56e0825894481b80e2df58
Merge: d6ca9fe b3ddcf3
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Sep 25 12:04:01 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit d6ca9feb78a9211758510751bbf47013caabff49
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Sep 25 12:03:27 2006 +0100

    Fix bug #7943 where video flickers when changing
    attributes. This code was a leftover from testing lockups
    and shouldn't be needed anymore.

commit 52a4f2a02b8f38108bfa866bf74b1596b8125512
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Sep 25 14:35:51 2006 +0800

    Add file for i965 exa composite
    
    This does not include ps program, which will be added
    in g4a form.

commit f272f0d811f9ee059e8f8617a516e6c8bff917a1
Merge: ff202f8 b3ddcf3
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Sep 25 14:15:21 2006 +0800

    Merge branch 'master' into exa

commit 4bd3b89c73b6c5aa9b0eb553ad5d553ee0e8a489
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Sep 23 16:41:38 2006 +0100

    Oops, duplicated CRT-redetect code.

commit c34490bbda6604a21809d15c798607806fa6c725
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Sat Sep 23 12:00:43 2006 +0100

    Construct default monitor description for hotplug non-DDC monitor.
    
    When detecting a monitor that doesn't support DDC, construct a default
    monitor with "sensible" values instead of using whatever the builtin LCD
    screen uses. Clearly we need a way to set the monitor parameters when we
    cannot detect them.

commit 965609f6fa63e28e5a28128f5bc44f8c4d7b9f68
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 09:51:45 2006 -0700

    Restructure i830_bios.c so we don't leak a copy of the BIOS per generation.

commit c52242c22779a51aa12b18a7a589080ce44c8484
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 09:41:07 2006 -0700

    Remove some dead code related to clock ranges.

commit c2446be9b444b16c95f78dab17bf130f9f491ee2
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 09:38:11 2006 -0700

    Remove the GetDevicePresence BIOS call which just printed BIOS information.
    
    Because we aren't using the BIOS to set modes any more, what the BIOS thinks is
    present is probably even less important than before.

commit b6ba268d0d5f22c6a18ce45416452fce83438620
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 09:31:37 2006 -0700

    Remove the no-longer-connected VBERestore option.

commit 20956a5d6f1eb518717a680e58938f31461ca5e4
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 09:27:30 2006 -0700

    Remove unused display{Attached,Present} fields.

commit 2cd28be71472d67956f47c7d49283ebabefa089a
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 22 08:55:55 2006 -0700

    Remove empty SAVERESTORE_HWSTATE code.

commit ff202f8e2ae4117b464c94047001023d5d0531cc
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Sep 22 15:02:19 2006 +0800

    Fix a typo to mark sync for XAA.
    
    This should fix the scrolling screen corrupt in
    XAA method.

commit d87d1f5bb0475c6f651fcb7e2cab2a7d46edcc69
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Sep 22 02:20:35 2006 +0100

    Remove BIOS from non-BIOS related names.
    
    Lots of names included BIOS for no apparent reason; as we try to eliminate
    BIOS calls from the driver, these only serve to confuse us.
    (cherry picked from 8e5d280d94ad3d3ba3c75871c17abec9da62ed34 commit)

commit b3ddcf3348365873aed4a2b8b2750b330fb4cf26
Author: A Costa <agcosta@gis.net>
Date:   Thu Sep 21 23:18:43 2006 +1000

    Typo fix in man page (Debian bug #364559).

commit 4820caf46e050761d9b347b8a440381e1b1f4727
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Sep 21 01:47:27 2006 -0700

    Make planeEnabled track pipes controlled by randr.
    
    Also add code to deal with disabling pipes.

commit c11c445bdeac34253b48192a5d406b55ff8b2be7
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Sep 21 01:23:10 2006 -0700

    Consistently use Cursor A on Pipe 0 and Cursor B on Pipe 1.
    
    Mixing random cursors and pipes didn't work very well. I'm left wondering
    whether the palette stuff will work on pre-9xx series hardware though; it is
    special cased everwhere else.

commit 4a8b9515e914369e1faf1dca6b11204b233c73ee
Merge: 18a510b bdca869
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Sep 20 22:46:55 2006 -0700

    Merge branch 'modesetting' into randr-1.2

commit bdca8697cc6ac5a98e0548b2ce2e0032e9bcfa52
Merge: d9db5ec daade50
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Sep 20 22:46:42 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit 18a510bf9af2f288c0e94359f672775d6e9c9ab2
Merge: f6500e9 d9db5ec
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Sep 20 22:45:48 2006 -0700

    Merge branch 'modesetting' into randr-1.2

commit f6500e94fec0d6db8c1f1350bee1d137bf06a09e
Author: Keith Packard <keithp@guitar.keithp.com>
Date:   Wed Sep 20 22:38:55 2006 -0700

    Update driver for RandR 1.2 X server API.
    
    This is not entirely what I'd like to see, but it's at least functional.
    
    Limitations:
    	Can't disable/enable crtcs
    	Can't move outputs on/off crtcs
    
    But, it does handle monitor hot-plug, detecting changes in VGA and SDVO
    status on-the fly. Which makes for good demo material.

commit daade50ca271d1cdf236bbe84afade85d4111ac9
Author: Linus Torvals <torvalds@osdl.org>
Date:   Wed Sep 20 12:07:09 2006 -0700

    Add standard C headers to fix build on some systems after xf86_ansic.h removal.
    
    This appears to have been hidden for others by header pollution in X Server
    headers.

commit 1681fe6bb041385e5aefb11baa9afd1f614abc5b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed Sep 20 09:36:02 2006 +0800

    Revert "fix default tex wrap mode with clamp"
    
    oops, we've set border color to all zero, which should
    give us transparent in RepeatNone case.

commit d9db5ec6866555ec13ba3ddabb1516eb45637afa
Merge: cbaf3cf e3f4caf
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Sep 19 16:03:04 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit 5adb05f0b82ee3a168142d803ab3434f75cf15a3
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Sep 19 17:14:05 2006 +0800

    fix default tex wrap mode with clamp
    
    we don't set any 'default' border color,
    default tex wrap mode should be clamp to edge.

commit e3ab89b0327ef6ff790ab53bba29c721aef032cd
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Sep 19 10:27:36 2006 +0800

    shader program fix for component alpha set
    
    If CA is set and blend op needs src alpha, the src
    value is not needed and should be (src.A * mask.X).
    This is found in handling exa magic two pass composite.

commit 37429c3ecb97df8faf0f3f56128d7a2b22eb8a5e
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Sep 19 10:08:31 2006 +0800

    misc cleanup

commit e3f4caf40708478ef327b029d0a75944c51ea905
Author: Adam Jackson <ajax@benzedrine.nwnk.net>
Date:   Fri Sep 15 13:51:18 2006 -0400

    Add model-specific tweaks for some funky 945GM boards.
    
    For the Aopen Mini-PC, ignore the claimed attached 800x600 LVDS panel.
    Likewise for the Apple Mac Mini, but done slightly differently since it
    shares PCI IDs with the Macbook Pro.

commit bd758030a6a59af32f9d73655cb691e018e94a7d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 14 11:12:03 2006 -0700

    Add a compile flag to enable syncing after each operation in EXA.
    
    This replaces other debug sync options sprinkled around the EXA code.  It
    doesn't change the mis-rendering of text on the 915.

commit f46c70e877a3432ba23696e1a16d5906183876af
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 14 10:05:51 2006 -0700

    Add a note on maxX/maxY for the 2D rendering.

commit ce00db054bf0b7f62ff0be312d7e3470141922dc
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 14 10:00:06 2006 -0700

    Replace a couple of mis-uses of the screen's bpp when the pixmap's was needed.

commit 71c2dd63361be9616c77db80a93445307d63dd41
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 14 09:54:19 2006 -0700

    Replace duplicated sync code in exa with a call to I830Sync.
    
    The I830Sync version has additional code for the 965.

commit 564c830a91afda76706a8c4c2f3287d0b8d514e9
Merge: bf49084 b970166
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Sep 13 16:34:10 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit bf49084ad700f064b732bf39a163209eee1d6845
Author: root <root@jetpack.demon.co.uk>
Date:   Wed Sep 13 16:32:39 2006 +0100

    bump max Xvideo height to 1088 to cope with some players.

commit 59ce4180b95270432540624a1fdf7ae8dd18a7f3
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Sep 11 22:57:23 2006 +0800

    reimplement Solid function
    
    Replace COLOR_BLT_CMD with XY_COLOR_BLT_CMD, by which
    device would care for direction and provide a (x,y) coord
    interface. This fixes pixmap artifacts even in no composite
    case.

commit 2b9c87bbf8ee5f7f56631114eb98303cd80e4a48
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 8 11:14:05 2006 -0700

    Remove xf86_ansic.h usage.

commit b970166eab95ac024ff481b0f5fd9aaf3644aabf
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 8 11:09:19 2006 -0700

    Fix a compile failure from the last commit.

commit 2b7602847aa7ae9b4e88fbea070710695d2cb8a4
Merge: e4cdc42 b45f4b5
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 8 11:02:41 2006 -0700

    Merge branch 'exa-origin' into exa
    
    Conflicts:
    
    	src/i915_exa_render.c

commit e4cdc42a98dd1be74e5c2bf5d9566f7449523b14
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 7 10:32:02 2006 -0700

    Remove another debug printf.

commit 099be52a3bb52516fb5e8d56c154a4d6b6707e09
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 7 10:28:09 2006 -0700

    Re-remove xf86_ansic.h, and move copyright to the top of the file.

commit 4ad577f83f7190df4d64e66fbf7c515ee6f411ce
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Sep 7 10:24:23 2006 -0700

    Remove the UTS/DFS implementations that just match the fallback versions.

commit 8b9d7a5f8560ee55ca5cb5376517a4246cd79fb9
Merge: 6500a3a 1e6e288
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Sep 7 17:45:57 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 6500a3aa134e11a75b7ddaf7fff253003b223241
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Sep 7 17:45:28 2006 +0100

    When in MergedFB mode, fix offscreen memory allocation.

commit c378328ece701756ddca966eb108e2b1f5c3ed6c
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Sep 6 11:15:17 2006 -0700

    Remove a debug printf.

commit 1e6e288b8826789f3b2520d12426ff7852a67ccd
Author: Eric Anholt <eric@anholt.net>
Date:   Fri Sep 1 16:47:17 2006 -0700

    Add a check for intel-gen4asm, and rules to compile {wm,sf}_prog.h using it.
    
    This adds assembly source for the two programs used in the textured video
    implementation on the 965, which should make them easier to modify in the
    future. The compiled versions are also included, so that intel-gen4asm isn't a
    build requirement for people that aren't modifying these programs.
    
    There are minor differences in the compiled versions of these programs compared
    to their previous versions which were compiled with a different tool.  I
    believe the changes should be harmless, and video continues to work on my
    system.

commit cbaf3cf74bd420533d299c4113761ec536097e33
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Thu Aug 31 18:25:21 2006 -0700

    verbose debug message for panel sync data

commit 1feb733eb8b09a8b07b7a6987add5149c53b0157
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 29 14:54:15 2006 +0100

    Fix bug with probing info of DFP2 and LFP2 connected
    devices (Aaron Ridout)

commit 26e6c074c17b2d4e9b9f165468ad45a3b0ecc0ef
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 28 11:55:38 2006 +0100

    Fix SetVBlank to operate all the time

commit b45f4b54b189a496255ddae12af38fc4c4408a51
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Aug 25 16:23:18 2006 +0800

    Making render log a little quiet in normal

commit 6f0d352b83fc9f39dd86edbda9af83243b50c764
Author: Ross Burton <ross@burtonini.com>
Date:   Thu Aug 24 18:16:42 2006 -0700

    Bug #7957: Fix distcheck.

commit cc79b3ec19a7e858972228a270ef774041eb8946
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Aug 24 10:28:59 2006 +0800

    Current 915 render operations for 915G/945G only

commit 078af29fa65653c5322b006404f7ad29aec24cce
Merge: 7458a6a ea63e82
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Aug 24 10:23:22 2006 +0800

    Merge branch 'master' into exa
    
    Conflicts:
    
    	man/i810.man
    	src/Makefile.am
    	src/i830_accel.c
    	src/i830_dga.c
    	src/i830_driver.c

commit ea63e82ef417a9918e7d7105910a8ddeba2994f6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 22 16:40:08 2006 +0100

    fix typo

commit b7e57deebbda527e878326cf3e6358c0a48d7817
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Aug 22 19:38:13 2006 +0800

    pci id update for Crestline
    
    The "Crestline" banner should be replaced with official
    name later.

commit dc4128ea0781124984dee0cb41e7b6ee87e362a1
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 21 12:13:42 2006 +0100

    remove GL* usage

commit dad0e7fc09fa7794f20278d9d99abd96a21b691e
Merge: 361c49a 43daaec
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 21 12:08:01 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 361c49ad3cfe58b9ab98dfb6e95de505c0d63730
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 21 12:07:29 2006 +0100

    Fix bug #7930, i810 doesn't compile without DRI
    (Samuel Thibault)

commit 43daaec63929c1f0e54a5125375d8147629da4b9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 17 15:57:31 2006 -0700

    Bug #7905: Mark DRI state as dirty in 965 textured video, fixing hangs with 3d.

commit cdcc6f23e8cad797e6cfd57e2ff454ec8509b5ba
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Aug 16 17:16:28 2006 +0100

    Disable device check when mergedfb in operation.

commit a94c96abf90c691faecbebf0c8d08f8010bc67ef
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Aug 16 17:15:26 2006 +0100

    Fix bug #5150. Disable LVDS usage on i915G, i945G and i965G.

commit 2a4e486d2990af433e915cfa26dc57cae02e01b7
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Aug 11 11:07:08 2006 +0800

    Fix undefined alloc type for agp memory
    
    This shuts up the nonfatal warning that type 3 for alloc agp
    memory is undefined for intel-agp.

commit 4cfed93df6b23903704348cafe050a6546e84479
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 10 15:41:32 2006 -0700

    Bump to 1.6.5 for release.

commit 38e7e48418cd48a46e48f5bc8a6547721db8f76d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 10 15:38:14 2006 -0700

    Fix README typos from in the generated file.

commit 975e60261088dee124b329d28c64e508bce1f90b
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 10 13:49:43 2006 -0700

    Bug #7829: Fix reported driver version.
    
    The driver now reports itself as the PACKAGE_VERSION from autoconf.  The DRI
    DDX -> client interface version is dissociated from this so that we can do
    appropriate major/minor versioning of the interface that's not tied to the
    package version.  Bumped the i830 ddx dri version patchlevel to note the
    fix in the previous commit.

commit 820e9a22fdb759cbdaac4a488322825bc0908b0d
Author: Eric Anholt <eric@anholt.net>
Date:   Thu Aug 10 13:37:18 2006 -0700

    Bug #7835: Restore unused fields in I830DRIRec to avoid i915 DRI breakage.
    
    As it was, 1.6.4 broke compatibility with the released DRI driver.

commit caa3b35cd772fc75d65a7ff791f00addbb39a764
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 9 16:11:30 2006 -0700

    Correct typos in README source.

commit 2a7426cf138e518a5eafb40f478359160a7ec98b
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 9 15:47:09 2006 -0700

    Clean up warnings.

commit 24e59a0daa20b7c3e5028c9ca7972052801d02a1
Merge: bb60807 32f1199
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 9 14:19:06 2006 -0700

    Merge branch 'textured-video', bringing in fixed-up i915 textured video.
    
    Conflicts:
    
    	src/i830_video.c

commit bb6080735efc40e103e92b65d0c2f1f729156632
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 9 12:21:16 2006 -0700

    Bump to 1.6.4 for release.

commit 3ca14275d13b1261b69b0e3fda90a112cb567472
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Aug 9 10:35:57 2006 -0700

    Add missing headers to i810_drv_la_SOURCES

commit 309374f78df35207b1398e14bba986fb891f3643
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Aug 9 10:30:41 2006 -0700

    Use double quotes to avoid sgml syntax error

commit dca9f856ca21e63abeb87e4ef2c40944c26d4429
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Wed Aug 9 10:29:59 2006 -0700

    Reformat README

commit b19ea222727ed47b69d28a03242c09d3a6ab2673
Author: Eric Anholt <eric@anholt.net>
Date:   Wed Aug 9 10:01:29 2006 -0700

    Update the README.sgml file for the upcoming release.

commit f8b47f607297e0591b63e5f25296af07ee74f433
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue Aug 8 16:19:51 2006 -0700

    Update manual page to include i945 and later details.
    (cherry picked from 7833d0733bc146cf1ae7f588516c49797886b396 commit)

commit d150b53d102c511f3c9245ef1f6fd36c12b01ca3
Merge: bb65a4d bc5f565
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Aug 8 15:51:58 2006 -0700

    Merge branch 'i965', adding i965G support.
    
    Conflicts:
    
    	src/i830_cursor.c
    	src/i830_driver.c

commit bc5f56568021d8c63313e2b6bf30710e7516c04a
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Aug 8 15:48:04 2006 -0700

    Intel bug #49: Fix video output at 32bpp by using B8G8R8A8 instead of B8G8R8X8.
    
    While here, don't overallocate video memory for the i965G state.

commit c3b3d479788fcea7e543f29acf83c85b8b148fbe
Author: Alan Hourihane <alanh@tungstengraphics.com>
Date:   Tue Aug 8 15:28:14 2006 -0700

    Intel bug #35: Fix accelerator syncing with DGA.
    
    Fixes glitches seen with Mark Vojkovich's "texture" demo.

commit bc12208f6e145ec29c3ebe38ae04dc2ebca1b4cc
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Aug 7 13:27:00 2006 +0800

    Disable error register dumping in dri TransitionTo2d. This's for
    debug which might confuse QA.

commit bb65a4dc55b416437d61ccbee8b6056fe8e08357
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 14:51:18 2006 +0100

    bump to 1.6.3

commit 37644293da751bfc7268c9fc74ecda1044607dee
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 14:42:32 2006 +0100

    check for xineramaproto

commit 3661d4df86db012682ab4b393287aa02e9fc8453
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 12:25:03 2006 +0100

    Re-enable monitor detect after a few fixups.

commit 995b142f510d1daab3914d336f3c0d017a043b41
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 12:01:39 2006 +0100

    Disable detecting of new monitors on VT switch.
    It's doesn't always work. The modesetting
    branch will deal with hotplug displays correctly.

commit 8e5844bbf9c8880c9eb6eff29b6db2db06b01933
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 11:43:10 2006 +0100

    bump to 1.6.2 to indicate mergedfb support

commit 421b415e23c1ddc78837cd222167d6ed71a3ef88
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 11:28:42 2006 +0100

    Fix a build problem.

commit e4f63eaf5efb654121db148f2f8e32cc3b23b6b5
Merge: 633a683 e26f3e3
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 11:07:56 2006 +0100

    Merge branch 'master' of git+ssh://xorg.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 633a683a4adcb9a44a54519fd7ff66aab2d12f97
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 8 10:23:29 2006 +0100

    Ensure palette is updated in mergedfb & clone modes

commit 71e3e2d4e3b2a2c538fe6f1cea41f442fdb8d756
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Aug 4 20:39:50 2006 +0100

    Fix a problem creating the I2C bus for the SDVOC
    interface, due to a name match with SDVOB.
    
    Bus names must be unique.

commit 0fd4831fdcf4c8f43d80c66e43eff8942f89b324
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Aug 4 00:21:53 2006 -0700

    Disable dynamic front buffer mapping on i965.
    
    Moving front buffers should only be necessary for rotation.  Currently, the
    server isn't ready for it, and the method attempted to work around it caused
    crashes with DRI.  Since i965 doesn't support rotation yet, this should be
    harmless for now.

commit 8d0a5138503586cbf980eb9464f2db91b72509c7
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 19:16:59 2006 -0700

    Add parenthesis so that IS_I965G doesn't make the test pass for 8-bit.

commit aa69018c01d2fa963fb940718dbd653d6ca2c9eb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 19:12:15 2006 -0700

    Turn off video debugging now that it appears to work fine.

commit d15f87110807111ab7d71f1254ebe3dfef1fee80
Merge: a79aa0d d56ffa5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 19:08:34 2006 -0700

    Merge branch 'broadwater-video-rehash' into i965
    
    The previous merge wasn't done on a synced-up tree, and missed necessary
    changes.

commit a79aa0d7b27b0b9b032472776d7dda410fd66a98
Merge: 760021e f9e94c1
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 17:58:56 2006 -0700

    Merge branch 'broadwater-video-rehash' into broadwater
    
    Conflicts:
    
    	src/Makefile.am
    	src/common.h
    	src/i810_driver.c
    	src/i810_reg.h
    	src/i830.h
    	src/i830_accel.c
    	src/i830_cursor.c
    	src/i830_dri.c
    	src/i830_dri.h
    	src/i830_driver.c
    	src/i830_memory.c
    	src/i830_rotate.c
    	src/i830_video.c

commit 760021e3983f7783900075b8c9603bd4fbe7e0a2
Author: Alan Hourihane <alanh@tungstengraphics.com>
Date:   Thu Aug 3 17:08:39 2006 -0700

    Add current Tungsten Graphics code drop for i965 support.

commit d56ffa5f35e3cf4262d66469052b2122fdb24027
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 16:03:50 2006 -0700

    Bump PS_MAX_THREADS to 32 now that the program doesn't fail.

commit 4525379d95ff292d7322e1a7a516c0bedd1f7543
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 16:03:15 2006 -0700

    Make the sampler's payload be the WM payload rather than uninitialized data.
    
    The sampler's payload happens to be in the same format as the WM payload,
    though most of the fields are ignored.
    
    This appears to fix the program in the presence of multiple PS threads.

commit ad2c70b4121121f1fb53190ea49edf2323c804a9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Aug 3 12:47:19 2006 -0700

    Remove some stale XXX-prefixed comments.

commit f9e94c17c55e4c75802d8574c908744e286e7843
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 21:18:19 2006 -0700

    Set the WM scratch space that we had already allocated.
    
    It appears to be required, even if the kernel doesn't use any scratch space.

commit aefa6fdfc5300546caeb64ace14a7854d3dc7dae
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 21:14:14 2006 -0700

    Clean up GRF allocation (which was wrong at 16-register boundaries).
    
    Also use PS_MAX_THREADS rather than hard-coding 1 thread, and remove the dead
    SF_KERNEL_NUM_URB macro.

commit 7a64e14624514ef31f6fa9f15e8804c45f930212
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 20:48:13 2006 -0700

    Crank down the SF allocation and comment on why this is a fine lower limit.

commit bc6a2bb7576a7c1e7971f6d1e0b893b2ada1aaa3
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 20:34:57 2006 -0700

    Remove the clip URB allocation.
    
    Previously, the VS was misconfigured and exceeding its allocation, which the
    (unused) clip was providing padding for.

commit defe2795429484ffe4c1438bafb86bb5e5469ba9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 20:32:41 2006 -0700

    Correct the VS setup, and allocate a correct, minimal number of URB entries.
    
    The VS number of URB entries and URB entry size are always used, even when
    the VS is disabled.  Similarly, the cache enable bit is always used.

commit b57ccb682cb3dea3e26c6f1b0c709e63dfde0d31
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:46:15 2006 -0700

    Replace the SF max threads setting with a define for easier tweaking.
    
    Tweak it to 1 for now.

commit 82037a12758c41a304f2e0bbd033d3345cccbe1a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:33:28 2006 -0700

    Remove CS URB allocation since we don't use any constants.

commit 1d45668d7a42bfa5d7f5bfb68d8bae38bda0936b
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:18:20 2006 -0700

    We only need 3 vertices to fit in the URB, since we only dispatch 3.

commit a076d35bed6f13cf943a0f8948176aa0c999e2da
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:16:03 2006 -0700

    No GS URB allocation is necessary when the function is disabled.

commit befa655168fb8dcb6806592eb44f7ac49f191822
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:11:38 2006 -0700

    Reduce URB_VS_ENTRY_SIZE to 1 as our vertices are under 8 floats.

commit 33acbdca0a0f82725e5bf7887b325726403a6ffd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 19:09:19 2006 -0700

    Remove the VS kernel and binding table.
    
    The VS URB entries have to remain as they're used to store the VF output which
    isn't modified by a VS program.

commit aafa48cb85cd03c735fb968a4275c19e1a68cd02
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 18:26:26 2006 -0700

    Fix wm prog to correct the ordering of the Cr and Cb channels.

commit bc2c842d93de04d48c7de60482814db346bd0b78
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 18:10:01 2006 -0700

    Allocate space for the 965's state at the end of the video buffer.
    
    Fixes corruption in the first few lines of the video.
    
    Based on 1b506798d98d911be733543da2c40cb451a28912

commit 524460ea1f02bb6e8e2239d7763334666012cec4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 17:47:55 2006 -0700

    Updated WM kernel to load video and do colorspace conversion.

commit ba896c779c697e1d7458028798ec49013bd9da9f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 17:47:37 2006 -0700

    Updated grf/urb state for WM.

commit e5c572f841b626b8b6f21a6966a33956d3b0b35b
Author: Adam Jackson <ajax@benzedrine.nwnk.net>
Date:   Wed Aug 2 20:47:12 2006 -0400

    Fix a braino in mode list pruning.
    
    Interpreting the size of the display in centimeters as the size in pixels,
    and then clipping the modes list based on that, rarely does what you want.

commit 21b62df7c34217be5dd95985c35e33be11c25846
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 17:36:49 2006 -0700

    Move the WM kernel to a separate file.

commit 5d3424492f9586a4c5a28962a9757f48f2c12e83
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Aug 2 17:34:12 2006 -0700

    Replace SF kernel with the one from broadwater-video HEAD.

commit 7458a6adb5ea62f56bb3d4ab19ad7d1aa6ad2d19
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 31 10:09:17 2006 -0700

    Move MAPSURF_XBIT settings into the texture formats structure.

commit 7ea74843bbdbf54b6804727be9b41d26832c8f76
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 31 10:06:34 2006 -0700

    Whitespace cleanup.

commit e71108f1e05b7a8d8edd174eb64edd6cccacbcdc
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Jul 28 10:32:12 2006 +0100

    Fix DGA with MergedFB
    Turn off rotation support when MergedFB enabled

commit a91a4f95c664f6905fef61dab251707bf2548bb8
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jul 27 16:11:48 2006 +0100

    Fix pipe reversal for Xv

commit ac3ad32f667b306e771617d784648f7111743f1a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jul 27 15:28:42 2006 +0100

    Calculate allowable refresh rates on the private
    mode data for each independent screen in mergedfb.
    
    Lots of other fixes too.

commit 30952e58ed83e2e18d1007f662d2cc9a773c876c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 26 13:42:12 2006 -0700

    Limit drawing to the destination pixmap's boundaries, not the screen's.
    
    This shouldn't matter, as miComputeCompositeRegion shouldn't giving us
    anything that would draw outside the bounds, anyway.

commit cffd2cd36d0437b38ac8164d66ea71be50b19330
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 26 13:22:51 2006 -0700

    Fix hangs when compositing with a mask.
    
    The modify bits in the mask field for sampler/map state appear to actually
    be enable bits.  So, prepare the state values in I915TextureSetup,
    then write the sampler/map state out all at once in PrepareComposite.

commit 96754b822df7ac110a70b2d08dda2ebb299772be
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 26 13:19:12 2006 -0700

    Fix a couple of typos from code review.

commit e786e2f9f3a4df31702736db6f68a44c9ebba546
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jul 26 16:45:38 2006 +0100

    When detecting new monitors in mergedfb renew the modepool.

commit 8e6e990db34d63174670512f494fa9adb44786f5
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jul 26 10:48:47 2006 +0100

    Update Xvideo to deal with MergedFB modes.

commit e26f3e30b30a57ab4aad0267d689a9a5d7a5e877
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jul 26 09:17:52 2006 +0100

    Fix a build problem

commit b919db75d2f6dc1019f981534b0d5d87c6029727
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jul 26 09:07:19 2006 +0100

    Bump to 1.6.1

commit 9c93d1498fa2363c52ef7fbe97d781560f67acf5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 25 21:17:05 2006 -0700

    Oops, partial revert of last commit.  Some were obviously not NOOPS.

commit 38d1a5e0dbe059f5c01bd5120a108a386ff10718
Author: Eric Anholt <anholt@leguin.anholt.net>
Date:   Tue Jul 25 21:09:12 2006 -0700

    Replace some OUT_RING(0)s with OUT_RING(MI_NOOP) to remind me why they're there.

commit fd19b12793f09b6714468556ace875ef36ed9e1c
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 25 11:14:11 2006 +0100

    Add mergedfb support to the intel driver with
    additional pseudo-Xinerama support.

commit aec88cf4c66833f89afa5f8fa4f8bcf30b2b6b4b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Jul 24 15:46:19 2006 +0800

    remove crap blit in UploadToScreen, we should find a more
    efficent way and implement blit correctly.

commit 32f1199937e92b9100aba52cbbb97157014e3182
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon Jul 24 15:42:15 2006 +0800

    remove an extra '-'

commit 02c5c4cd1dd44058d80ec23cccfd45a13bc3bb2c
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 21 12:54:06 2006 +0800

    add copyright info

commit 4f0ad337098eb0bacb1c11bc61d780ac18041e1d
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 21 11:59:04 2006 +0800

    fixup segfault in xaa when xaa not initialized in i830WaitSync.

commit 914327f40d07a3f7c069752ce005bf8e21352b03
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 17:58:07 2006 -0400

    Disable drawing to PICT_a8, and turn on support for non-extended repeats.
    
    We don't know what COLOR_BUF_8BIT does, so it's disabled for now while we're
    stabilizing the code.
    
    The non-extended repeats appear to be working according to the rendercheck
    tests on a8 and a8r8g8b8 sources.  Masks continue to hang the card, as before
    this change.

commit 45cb032e2b7ac1e4c765fc29a2e4dd0cef19066d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 17:34:50 2006 -0400

    Use MT_8BIT_A8 so PICT_a8 expands to (0,0,0,a) not (a,a,a,a)

commit fd6d825ae0780f3daf436f4224bf5f177cb8630e
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 17:25:31 2006 -0400

    Move ss6 setting with other immediate state, and ensure that stencil is off.

commit d6d6a44c66446f34b57394e5ea9a8e32917f7569
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 11:23:05 2006 -0400

    Try to fix up the basic RepeatNormal and RepeatNone support.
    
    With RepeatNone, access outside of the drawable should return 0 alpha values,
    which is done by using the border color.  For RepeatNormal, we use the wrap
    mode (which requires that we use normalized texture coordinates).

commit 2b2173c618c080b1678990d65fe49b52bd8001b4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 11:15:18 2006 -0400

    The pixmap's drawable x/y coordinates are always 0, so don't bother using them.

commit 9f1cec83e0aef36c7d3482e62e8f01595f1fd076
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jul 20 11:05:49 2006 -0400

    The vertex data are all floats, so write the dest coords as floats.

commit 4737955a62c39177e7a7ce7749a2f20e111afc68
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 21 01:02:38 2006 +0800

    move i830 default coord set into I830EmitInvarientState

commit a7e30bb051bc03063fe699473610a57054a64973
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 21 00:56:58 2006 +0800

    Take from i915, blend ctl code cleanup.

commit ac34a37cb60d763cbd99b6e2f6fdcb639592b99b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 21 00:52:59 2006 +0800

    Take instruction fixes into i830, with indent changes.

commit 3e86bf4273241daa23645f5a8104913e4205a74b
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jul 20 13:43:27 2006 +0800

    remove i915 default ctx setup.

commit 5c945bf9eb9f5bedd34d98dcc7abc3f1ea3cb962
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu Jul 20 13:40:39 2006 +0800

    Revert "Fix several size error with STATE3D_LOAD_STATE_IMMEDIATE cmd."
    
    This reverts commit 433cb6ba82698676f6f72e09834aba4d64611d54.

commit d5243d1b35ab1db608c81889819e4d4d87048154
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 19:27:53 2006 -0400

    The height and width of texture maps are one more than the programmed values.

commit 13e372c2095fde94ae41bea959fba0ad95a59c08
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 16:42:57 2006 -0400

    Fix the texture map pitch setting as documented, and as used by the 3d driver.

commit da5efb09d55291ce5bcabff7db8d1490bb5e838b
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 16:36:52 2006 -0400

    Fix the alignment padding fix (didn't bump BEGIN_LP_RING count).

commit 36aa43bf73ee1268f0a250788eb637a4123f08eb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 16:22:46 2006 -0400

    Force texture alpha channels to 1 if not present.

commit adce6bd0fc9533156da09da7d029ba0d76606b4f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 16:21:49 2006 -0400

    Add a trailing MI_NOOP to frag shader output for alignment if necessary.

commit 4e409ea44180f7ef2780d70c9d2f54629bbd0fc3
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 15:57:09 2006 -0400

    The map bits per pixel must come from the drawable, not the visible screen.

commit 449e4be503c8b938d5bd46ee810244f8bcf54ceb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 13:34:06 2006 -0400

    Correct the DWORD count of several 3D instructions.

commit f1b62d890ca22e12d61f7ef67bc4e35d68cde019
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 13:02:24 2006 -0400

    Replace hand register setting with new i915 fragmet program API.

commit 76a316d0cec92a04c8735926a76e76c21f960d7e
Merge: 433cb6b 8480516
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 19 12:31:36 2006 -0400

    Merge branch 'master' into exa
    
    Conflicts:
    
    	src/Makefile.am

commit baf65ce98abcdd21dff2531a43bb9c5044732c28
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 18 19:42:37 2006 -0400

    Re-convert i915 video to new fragment shader API.
    
    Although in the history of this branch it had happened before, this time it's
    for real.

commit bb81e8d6c777a5e16b8193c07667fbee8e21203e
Merge: 2a1b3cf 8480516
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 18 19:23:21 2006 -0400

    Merge branch 'master' into textured-video
    
    This moves the i915 textured video implementation into i915_video.c to avoid
    conflicts in register definitions with i830_reg.h when we use i915_reg.h.
    This also means that i810_reg.h's i915 3D regs definitions are removed and
    replaced with i915_reg.h usage.
    
    Conflicts:
    
    	src/i830_rotate.c

commit 84805167ab8a422966355b9753bfcb4dad802413
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 18 18:27:10 2006 -0400

    Convert i915 rotate code to the new fragment program API.

commit 5176d62ba58c100c87f75a4f333d00129d780c99
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 18 16:18:18 2006 -0400

    Add an API for programming i915 fragment programs.

commit 148ef9bdd9e0ef3e7ac86b56a8662b53a3ea9168
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 17 22:32:25 2006 -0700

    Convert magic numbers to symbolic names in i915 rotate code.
    
    This doesn't cover the fragment shader yet, which we need to make a sensible
    set of macros for (at least the basic bits).
    
    Reviewed by:	md5

commit 433cb6ba82698676f6f72e09834aba4d64611d54
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Jul 18 17:00:50 2006 +0800

    Fix several size error with STATE3D_LOAD_STATE_IMMEDIATE cmd.
    Issue texture coord set with proper scale value.

commit 855a9f13cb7fd4f6c489ff280bf389475bbd9bbe
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Jul 18 10:02:47 2006 +0800

    fallback in 'repeat' case for now

commit a6d438ebe3cf141a0331e0cd55eb9b5e137a5e37
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jul 17 14:11:19 2006 -0400

    Disable spread spectrum clock usage.
    
    The spread spectrum clock generator that improves EMI characteristics for
    laptop screens lives in an external chip that is programmed over an i2c bus.
    Without correct programming, attempts to use this mode for the LVDS can
    result in a DC signal being sent to the panel.
    
    Until we find programming information for this external chip, we should
    leave this mode disabled.

commit 16d6263e6518a4a05562e2842ff2d0fdb4710304
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sun Jul 16 20:39:52 2006 +0100

    whoops, reverse part of that.

commit 2f50f6d1b1b3fa4fbec98bd8fa5818df890070e7
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sun Jul 16 20:17:38 2006 +0100

    move ContextMem out of XF86DRI

commit c7083a267209c93b2a91ef00dea2ca840400d160
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Jul 14 13:23:40 2006 -0700

    Bug #7404: Only save/restore VGA fonts and not other VGA regs.
    
    This fixes a hang on the i945 during restore.  It appears that saving/restoring
    the VGA registers is not important, as we're correctly saving/restoring the
    registers we touch within the driver anyway.

commit 49b827605628d3e1a6d4d41447cf46c5f38cc0c2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Jul 14 14:23:04 2006 -0700

    Add a register restore implementation so we don't crash on LeaveVT.
    
    We shouldn't ever need to save/restore the hi/lo frequency regs, as they're
    read-only.

commit 6a92a779646ec03a03a3b1f45170b2e705ce8934
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Jul 14 14:20:41 2006 -0700

    Don't try to probe on more pipes than we really have.

commit 04d1584737fd0d14e99608a97281fd7b1549ae0e
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri Jul 14 16:14:18 2006 +0800

    Current exa render implement for i830 and i915, test on
    865GM and 915G. There is issue in picture 'repeat' support.
    And also stop recursive behavior in I830WaitLpRing to allow
    server to abort instead of system hang.

commit de470aaf5c47f4d2b0f477ac678039ef43af773d
Author: Adam Jackson <ajax@benzedrine.nwnk.net>
Date:   Thu Jul 13 19:10:11 2006 -0400

    In I830xf86SortModes, catch cases where two modes are equal in only one
    dimension, by comparing the areas of the modes.  Otherwise, 800x600 would
    sort before 1024x600 if it was added later.

commit 22843830ebdd14247aa76d19f89494a56e2ac887
Author: Adam Jackson <ajax@benzedrine.nwnk.net>
Date:   Thu Jul 13 17:20:17 2006 -0400

    Fix a thinko; would only inject the FP native mode if a mode list was already
    found, which is never the case when there's no xorg.conf.

commit 05bcbadd130524694e11e372d54cb419cea566cc
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 11 14:05:38 2006 -0700

    Avoid NULL dereference if cursor position changes during a mode change.

commit b65f18b05a5fba506b71293b495cab95197037ac
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 11 13:29:57 2006 -0700

    Bug #7443: Respect the user's Modes configuration, and make it more useful.
    
    Now, mode names generated by DDC get names of the form "WIDTHxHEIGHTxREFRESH".
    The matching for user Modes lines takes the user Modes as the prefix that
    needs to match, rather than an exact string match or "WIDTHxHEIGHT" match.  So
    one can, for example, specify "1024x768" to get any old 1024x768, or
    1024x768x60 to get one of the modes named 1024x768x60.

commit 5a2e04bd1b700a8a6e26136b8831ef5e4d11b565
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jul 11 10:21:51 2006 -0700

    Fix crash with DDC when there are no user modes to add.

commit f9499a68da0ce459fed0b29b998678fd81898a51
Author: Luká\u0161 Hejtmánek <xhejtman@mail.muni.cz>
Date:   Tue Jul 11 10:13:18 2006 -0700

    Make gamma settings apply to the cursor as well, and fix clone-mode gamma.

commit 7068468ac1951bfca0071bb9b1a99df4f37368a0
Author: Luká\u0161 Hejtmánek <xhejtman@mail.muni.cz>
Date:   Tue Jul 11 09:51:26 2006 -0700

    Add support for adjusting saturation value of overlay video.

commit b1c2ea653502dd8547079e7014b698f241433dff
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 11 08:13:30 2006 +0100

    whoops, revert some unnecessary changes

commit 8a44a7acfcadbba2410dca750afc9d32bc83706e
Merge: 584b544 e7723a4
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 11 07:41:27 2006 +0100

    Merge branch 'master' of git+ssh://git.freedesktop.org/git/xorg/driver/xf86-video-intel

commit 584b544987be5cf23dce29ddaf3130e59cfe6fa8
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 11 07:40:40 2006 +0100

    Add an additional check before rotating

commit b912bf5673e38e03b0b25c2f5d05fe7e26994ba1
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 18:35:20 2006 -0700

    Clean up warnings in sil164 module.

commit d75490701cdbf2ab6eab82eaa078790a5fe0aea0
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 18:21:04 2006 -0700

    Hook up SiI164 mode setting (just a matter of turning the chip on).
    
    Also adds register dumping in case this turns out to not be enough, and fixes
    a couple of prototypes.

commit 426d26ea446d646fa8f561ea0e03c8e4a2c0c315
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 18:19:51 2006 -0700

    Fix prototype for SaveRegs.

commit 8d7987d00242020d29a2574ac0c8b6e55cc22112
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 17:34:57 2006 -0700

    Move to 4-space indents in sil164.

commit f5a01a2ef02125611d5fb74c20d53d52e544701a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 17:17:51 2006 -0700

    Make DVO code light up my sil164-based DVI output, when already set up by BIOS.

commit 23a0ee73bce12f9e0b881af420413aeec4c0517f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 17:16:18 2006 -0700

    Fix modelist with a configured monitor to not begin with all unvalidated modes.

commit 48ba9273ddfb36d3525e19238b94b18c56667c4d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 15:01:51 2006 -0700

    Fix validation when the first mode is thrown out, and print hsync in modelines.

commit 3924ffb7d7b71cb9c6ab9eeb12d0f1b2c26244c0
Merge: 5a8f6a4 f76f94a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 12:12:38 2006 -0700

    Merge branch 'dvo-merge' into modesetting
    
    Conflicts:
    
    	src/i830_driver.c

commit f76f94a743505da16e121992eb789c1f74eb7673
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 10 12:04:09 2006 -0700

    Supply proper NULL-terminated symbol lists to avoid crashing.

commit 5a8f6a486d79f50d2d659e615283289d59f9caa4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sat Jul 8 15:26:19 2006 -0700

    Improve output bus setup to include LVDS setup for pre-i915.

commit df333cc9a848bc2299a52a7613fe4ffdff8038a2
Author: Eric Anholt <anholt@leguin.anholt.net>
Date:   Fri Jul 7 13:41:33 2006 -0700

    Initial add of DVO support code.  Probes my sil164.
    
    This is a mostly-untested merge of airlied's work.  The I2C modules are intended
    to be moved into the core server or a separate driver module when they're
    functional and we're happy with the API.

commit e1064f52b0ff69ea7937897b8c951cc3e32cd752
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 5 16:00:03 2006 -0700

    Don't try to probe modes on an SDVO device with NULL sdvo_drv.

commit ffa6ecc18bc54151061d9956f1d12575fc057da3
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jul 5 14:41:08 2006 -0700

    More fixes to "choose closest mode for the pipe" code to select correct refresh.

commit dfd7fef457c048c9f0d826e37d91453d9e1485b9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 3 12:01:57 2006 -0700

    Bug #7375: Don't double-free the current XF86 mode after a randr reprobe.

commit 5d07ebdf4f23e16fb8f60eafeadc947701e7877c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jul 3 11:59:21 2006 -0700

    Only override display size with the XFree86 mode's for actual panel scaling.

commit 48f27ac62128251640a9b1ca54f63376676b47eb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 28 15:07:01 2006 +0200

    Replace i830InjectModes with i830DuplicateModes usage.
    
    The remaining functionality of DuplicateModes was OBE, and the name was bad.

commit ce5bd108c55d2378db072617c380514a39672603
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 28 14:21:49 2006 +0200

    Validate and insert user and VESA standard modes for DDC or configured fallback.
    
    This isn't really tested because I lack a good CRT to test against currently.

commit 367f69f8e7710e53dcd286f1b62506a3276e80f9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 28 13:10:02 2006 +0200

    Replace xf86ValidateModes usage with a set of custom validators and pruning.
    
    This moves us to maintaining MonPtrs per pipe instead of using the EDID
    structure "xf86MonPtr", which is closer to what we want to be looking at when
    doing validation.  The new validation isn't enough yet -- particularly, we
    aren't importing and validating the custom modelines to the pipes when
    applicable, but this will be easier than (for example) trying to make flat
    panel modes pass xf86ValidateModes through various gross hacks.
    
    Hotplug turn-on/off also happens at SwitchMode time now, instead of at randr
    probe time.

commit 9fbd3d8f4befb75ed6f6bd9a9ffe0175626e8785
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 27 23:31:40 2006 +0200

    If the panel power registers are all zeroes on Mobile parts, disable LVDS.
    
    This is the case on the Mac mini, which is an i945GM but has no LVDS attached.
    Powering on with the power timing registers zeroed would probably be a bad idea,
    even if there was a panel attached.

commit 56f7aedd0ad1f5645a90a5509b1263ec6b7b7ee1
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 27 00:37:56 2006 +0200

    Fix randr current mode reporting and mode loss/mis-configuration on re-randr.

commit b85f268051a785f90e4c55bd1cac80d673388f16
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 16:26:58 2006 +0200

    Fix remaining warning.

commit 6a3f89f4b6035534c7b93a4c05fd704305349785
Merge: 3cdc537 e7723a4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 16:25:58 2006 +0200

    Merge branch 'master' into exa
    
    Conflicts:
    
    	src/i830.h

commit 3cdc53797bf6fdbfbcb53e07b269a5071f5ec97d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 16:23:55 2006 +0200

    Fix build with new EXA headers.

commit e7723a4e5725147d3bd9ba22c5a3314b0556e440
Merge: 5111b88 dae9cb7
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 16:04:33 2006 +0200

    Merge branch 'origin'

commit 7104b915da412a26661bab7b5a940e935e8cbc8a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 15:11:13 2006 +0200

    Clean up warnings.

commit 21dc3edfc41987bb8cf0f8d265fba9775cbe8cdb
Merge: f113e90 5111b88
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 15:06:42 2006 +0200

    Merge branch 'master' into modesetting
    
    Conflicts:
    
    	src/i830.h

commit 5111b883480a5a9cc82200f2684cba67b515aa73
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 14:53:10 2006 +0200

    Turn on extra warning flags for GCC, and clean up the resulting fallout.

commit f113e9002cf53510e30984f816d44b06f1e71216
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 12:54:30 2006 +0200

    Fix the plane/pipe disabling and turn off missing outputs when no longer DDCed.

commit 0e5cda3796ba0164496f0814eb57d1dfa7ab9257
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 10:30:46 2006 +0200

    Fix FP scaling by using the desired mode to get at the real [HV]Display.

commit 51d14f803aae6d0a738520c3cad110289ee444db
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 10:21:23 2006 +0200

    Add a function to turn off unused outputs, DPLLs, planes, and pipes.

commit d2c18d8d79596513149273e4a0d322f04bf27e80
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 10:15:11 2006 +0200

    Fix DDC probing after last (untested) commit.

commit 6d1d105d68d9c25890c3fd2ebad1367529c2a991
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 10:14:27 2006 +0200

    Unset pipe current mode on EnterVT, so we reprogram the mode for sure.

commit 52e8231a19f28bd4744f983aee2197a18c20aa3a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Jun 26 07:46:28 2006 +0200

    Major cleanup of mode reprobing:
    - Don't mess with pScrn->monitor->Modes, and instead make our own availModes.
    - Don't re-program the pipe with the same values (no flicker at xrandr)
    - Move a bunch of stuff that should be exposed through the public API (probably)
      to i830_xf86Modes.c
    - Use a table with established modes plus GTF to come up with modes from EDID,
      instead of trying to walk and find one in pScrn->monitor->Modes.  I think
      this is correct.
    - Reset clone state if we've detected new pipes, which should turn on the
      cursor.

commit f5e5f8aeddb3e0d6d073471aeff6176fb54576e2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Jun 23 23:29:55 2006 -0700

    WIP to allow re-probing and validation of modes for new heads at "xrandr" time.
    
    Now, DDC modes always end up being preferred to custom modelines, even if
    smaller.  This should probably be fixed by inserting custom modelines into
    the probed mode list if they're valid according to the probed parameters of the
    monitor.
    
    Too much code is lifted from static functions in xf86Mode.c, and those should be
    made unstatic if possible.  Using xf86ValidateModes is also rather hacky, and
    I want to break the function down, but this is a first step.

commit 89791914d2a78f19f4f60ca370d387e5b1ccfb46
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Jun 23 18:21:17 2006 -0700

    Split probed modes out per pipe, and union them into the available modes.
    
    This is the first stage of getting runtime monitor attachment.  The old i830
    GTF code is returned to use to provide suitable modelines for xf86ValidateModes
    in the LVDS case, even though the LVDS doesn't care about the modeline and just
    always programs its fixed values.

commit dae9cb7712d5d8f88697ca83808c59af08364c0e
Author: Alan Coopersmith <alan.coopersmith@sun.com>
Date:   Thu Jun 22 15:07:16 2006 -0700

    Provide definitions of __FUNCTION__ for non-gcc compilers

commit bb4810521633b6c3db2fc7d01ddc71325583d265
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Jun 22 09:38:27 2006 -0700

    Move FP mode validation next to other mode validation code.

commit 66d9a1be302ad34573de98de21cbdf6419592092
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 21 17:11:54 2006 -0700

    Detect SDVO display presence at startup and default to displaying to it, too.

commit 72e25a7488c2eabcc92e9e0769a89dee687f52fd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 21 16:04:18 2006 -0700

    Fix SDVO output at low pixel clocks.
    
    I had interpreted the docs as saying that the multiplier setting would further
    divide the clock and stuff dummy bytes in.  Instead, we have to set the DPLL at
    the higher clock rate, and the pixel multiplier just controls the stuffing of
    dummy bytes.  Also, we have to set the multiplier both in the graphics chip and
    on the SDVO device on the other side.

commit 726443309d72134341cff1f6db978aa1d6e3ce52
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Jun 21 15:38:19 2006 -0700

    Add decoding of SDVO command names for debug output.

commit 5a1b68993f3a3a2e8dcd428a7118e29c36703cd6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jun 21 08:41:16 2006 +0100

    Fix build without DRI

commit 16b310823bacab6be4947da234b3a081b0a3cd62
Author: Matthieu Herrb <matthieu@deville.herrb.com>
Date:   Wed Jun 21 00:12:27 2006 +0200

    Fix build without DRI

commit 896ffe78fe96469cdd3ade77c8e68e1503967223
Merge: 89c2c4b 52243d4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 15:10:35 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit 89c2c4bc40b8c032915ccb3ed4f3c143c3d8db12
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 15:10:19 2006 -0700

    Add #if 0-ed code I've been using for CRT detection debugging.

commit be08661e3126907c50c54485042fcde00b0da2b4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 14:48:03 2006 -0700

    Only default to enabling CRT or LVDS output if they're actually detected.
    
    Still, if we haven't detected any outputs automatically (including CRT through
    DDC), default to CRT anyway.

commit b454c9601f005c69c11556a558150403378d34d9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 14:32:40 2006 -0700

    Add support for CRT detection using DDC.
    
    This method is slower (~5ms), but works on older chipsets.  Also, load-based
    detection is disabled, as it can be fooled by other outputs on the pipe being
    active, such as LVDS.

commit 0b76646666e9d330e77c6f81af8b91e34623be92
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 13:57:26 2006 -0700

    Add CRT detection function by testing for load, and clean up hotplug version.

commit e4584a4f44a70d746396ed48b8e40033504d68b2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 10:39:28 2006 -0700

    Remove dead DisplayInfo option.

commit ab60e34dcfc52ab5f22a82145d5b4db51b4c62c5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Jun 20 10:07:47 2006 -0700

    Add debugging info for pipe/display plane size.

commit 8a6edba33213911cc2210b5e903428b81d45862f
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jun 19 13:47:28 2006 -0700

    Set vblank interrupt configuration to match pipe configuration
    
    New i915 drm ioctl (in version 1.5) allows the X server to select
    which pipe drives vblank interrupts. Use this to drive from the 'preferred'
    pipe. Yes, per-window vblanks would be nice in a shared fb environment.
    Maybe someday.
    (cherry picked from 2fb375b665f4802819b89f2277fd6154006c11ee commit)

commit 52243d407cad93283956660de4771097ac0b4b2d
Merge: 2fb375b 34f6a82
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jun 19 13:28:09 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit 2fb375b665f4802819b89f2277fd6154006c11ee
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jun 19 13:24:57 2006 -0700

    Set vblank interrupt configuration to match pipe configuration
    
    New i915 drm ioctl (in version 1.5) allows the X server to select
    which pipe drives vblank interrupts. Use this to drive from the 'preferred'
    pipe. Yes, per-window vblanks would be nice in a shared fb environment.
    Maybe someday.

commit b5acc6b3a3a3a109014d6b971f4722d0f0a4c29a
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Jun 19 13:22:17 2006 -0700

    Add backlight control to DPMS logic.
    
    Turn backlight on and off in response to DPMS state changes.

commit d7e5d996aa123e52857362fa8a1e69f709bfe218
Merge: 89a5a00 a73ab7f
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Jun 20 01:22:53 2006 +0800

    Merge branch 'master' into exa

commit a73ab7f0e6e3b0462e05c0031ffd602ed3e2bcd4
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 19 11:35:42 2006 +0100

    additions for rotation fixes

commit 1fe3dd38eb613475d62140850e64767defed7d34
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 19 11:27:28 2006 +0100

    Set some invarient state, cures some problems with
    rotation at startup.
    
    This mimicks the 3D drivers setup.

commit 89a5a0024a7e077a0726ffe1427e573df3bcbef5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sun Jun 18 00:25:34 2006 -0700

    Fix crash with EXA during randr, when XAA structures were being accessed.  EXA
    shouldn't have any issues with there also being pixmaps in framebuffer while
    rotation is active.

commit f2ab3aa3199e1c4b0edec72b5acea6d725cc514a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sun Jun 18 00:32:01 2006 -0700

    Fix DRI in EXA mode: Don't attempt to use XAA symbols (use the driver's internal
    ones for EXA support when available).  Also, add an abstraction of XAA/EXA
    MarkSync and WaitSync functionality so we don't need to sprinkle the ifdefs all
    over, and correctly use them.

commit 3592b432b48d51d2273c1e1064f85e656fbba130
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jun 13 21:42:53 2006 +0100

    fix 8bpp & 16bpp rotation modes for i8xx
    series chips

commit a50610b7719bfe800c3496c17d0ba77739167b35
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 12 13:53:20 2006 +0100

    Use 800x600 mode to double check

commit f02268b2091c9a785d26e82bcb35a8b713463072
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 12 12:16:58 2006 +0100

    Don't rely on register check to find out
    if we're resuming - it's not reliable.
    
    But then, neither is the BIOS, but it's
    the best we can hope for until Eric's work
    is complete.
    
    Try setting another mode to cater for some
    broken BIOS' too.

commit 672c3d18dbb405095e465126053ff887d891409e
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 12 10:02:06 2006 +0100

    Only mark rotation flags after initial screen setup.
    Fixes bug #7053

commit 34f6a8204f1edec015283fc6b5f196e47897e3de
Author: Keith Packard <keithp@mactel.(none)>
Date:   Sun Jun 4 00:15:06 2006 -0700

    Get sDVO output working on mac mini.
    Add lots of register debugging to track delta from BIOS settings.
    Fix various mode settings to mirror BIOS sDVO values.
    Disable analog/lvds output on pipe with sDVO.
    Borrow Dave Airlie's I830xf86ValidateDDCModes code.
    Fix various sDVO I2C messages to mirror Dave's code.

commit 6812b5382077e5d3f421aceeeb2f337e9b3f570e
Author: Dave Airlie <airlied@linux.ie>
Date:   Fri Jun 2 12:22:14 2006 +1000

    intel: fix VT switch DRI locking
    
    The DRI locking is incorrect at VT switch, due to reference counting
    inside the driver. Just call the DRI directly.

commit 3f158fd610a3363a23daa7205bcd9f213686cf1c
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Mon May 29 18:05:57 2006 -0700

    Nice texture coordinate gradient, broken slightly in y

commit bb0ad04d46eba2fed57a888ff960d2436ec7d70d
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sun May 28 22:59:58 2006 -0700

    Ok, finally something sensible up on the screen.
    Replace PS kernel with constant data source (pink).
    Dodge g0/g1 so URB data doesn't land on top of thread data.
    Flip source/dest coordinates (dunno why they're fetched this way).

commit ddf3e5b2737399dca6d401f91db51a51f93b6373
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sun May 28 21:03:39 2006 -0700

    Using tiny rectangle, still locks up in pixel shader program somehow

commit 2e16c79dc2f24b0a04111aa6236a44870c6c64df
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sun May 28 20:31:23 2006 -0700

    Lots more debug code. Appears to execute pixel shader thread now though. hurray!

commit 79a514412bda7e38e018c105a603970c4a9d758a
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sun May 28 16:09:59 2006 -0700

    dump out piles of debug. Create VS thread just to see how it works

commit 9c111d89fe19f1773af2eefb000e1c2389b4b6e1
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sat May 27 19:52:13 2006 -0700

    Push all of the obvious Mesa state setting into the video code

commit 01101196b16010ac3dadab647bfe7000a53fa94d
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sat May 27 01:05:09 2006 -0700

    flesh out cc state. set cull mode to none. enable sf kernel

commit 462a860af89ed855fe2b718342fcaf9c169af3fb
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Sat May 27 00:17:25 2006 -0700

    Rename BRW instructions, check video instruction generation. Doesnt lock up, but doesnt display anything either

commit 9ec7cf22e3f03c13524bb2d15711699dfcc02984
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Fri May 26 21:30:55 2006 -0700

    Use broadwater video code on broadwater hardware. Pad ring to even length. compute state base as address rather than offset

commit f5fe700b9a943c956bcfcc3a0d2de13c23b978bc
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Fri May 26 13:47:39 2006 -0700

    Prepare real SF kernel and fake WM kernel

commit 1549accb6f52498fef3dcbd87bb72d89fcd5bccd
Author: Keith his master's voice Packard <keithp@bw.jf.intel.com>
Date:   Thu May 25 16:10:31 2006 -0700

    Scale video source vertices. Allocate space for kernels

commit c1c46f882f9a11c383c8d1d1ce393be8fda55ed0
Merge: 1e2da24 f2967a2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 22 10:42:24 2006 -0700

    Merge branch 'master' into modesetting
    
    Conflicts:
    
    	man/.gitignore

commit 1e2da2450d7213c0aa4d4bd1fba5723dcda13ddf
Author: Lukáš Hejtmanek <xhejtman@mail.muni.cz>
Date:   Mon May 22 09:48:09 2006 -0700

    Replace VBE call to do DPMS with native code, and fix screensaver in clone mode.

commit 2a1b3cfccb7de53f7ce8f9e4816e4278afb1fcab
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 22 10:32:13 2006 -0700

    Use RECTLIST instead of TRIFAN for video so we get horizontal shearing instead
    of diagonal.  Also remove the unnecessary vertex elements that were being
    emitted.

commit bc42dbe07cbd61b357d8eed02608e026c4cf4485
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Mon May 22 11:22:03 2006 +0800

    fix a typo

commit bce209cd3f60cb5d51aadc5fc8ec1a4151435ec3
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 19 17:13:37 2006 -0700

    Put in code for idling accelerator on subsequent cliprects.

commit 3640117bd9f2073ff54dc474f0cdefff49742584
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 19 17:10:04 2006 -0700

    Set up the state buffer in framebuffer.

commit e70d99d51edc39ea53536c2f4d62ac622ba3e0d9
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Fri May 19 15:47:19 2006 +0800

    revert wrong setting for memorySize, which should
    be at the range of pI830->Offscreen.

commit de06cd70a9edb8b56d05d3f505137f7c7f083c2f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu May 18 18:27:11 2006 -0700

    Checkpoint for filling out more 3D state.

commit ad7ec6a24b436d5492d38e4fa56845b229cf5fb8
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu May 18 15:26:28 2006 -0700

    Checkpoint of BW textured video work, filling out vertex submission stuff and
    some more other state.

commit 291770efc691a02650e3c580ca40c2f9fce3896c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu May 18 10:43:07 2006 -0700

    Start laying out some of the bits that need to be done for BW textured video.
    Headers taken from TG code drop.

commit b3d79ad9ecc70e9f841092fc75b7e23576b685dd
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 18 16:31:40 2006 +0800

    oop I830FALLBACK define error

commit 1bc2a8f7a20b2ea9251e93157c0f2342fdbb951c
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu May 18 16:58:22 2006 +1000

    fixup I830SDVOGetActiveInputs to use return values not args

commit 33ad959323f70f76c494c66ec35a04d7d839f612
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 18 11:32:59 2006 +0800

    Add DEBUG_I830FALLBACK for easier tracking

commit 52af679c94a25c0c6e5df5f3647f62fdd256c826
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 18 11:31:14 2006 +0800

    Check alignment require in PrepareSolid, noticed by Eric,
    as pixmap offset align set is violated in Solid.

commit fdb52a8c6da0f3d3f4cfbf1583b2dc4d91f7e933
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Thu May 18 11:24:46 2006 +0800

    Solid planemask in PrepareSolid/Copy might be 0xffffffff
    or bits up to the depth. This should save some fallback
    case, noticed by Eric.

commit bc51d6525a12c748d0a293b7e560f6dcea33eecb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed May 17 13:42:51 2006 -0700

    Turn off overlay video on BW until we have stable PCI IDs so we can know whether
    the hardware supports overlay.

commit f97895efd5532cca145b6f224f9615739b1e8f26
Author: Dave Airlie <airlied@linux.ie>
Date:   Wed May 17 14:46:37 2006 +1000

    fixup chipid override
    
    This makes the ChipID override work so that we actually override the pci id
    that gets used everywhere in the driver.

commit 011a1c99d49c1c69b5fa81ade6a2ed73e84276ae
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Wed May 17 11:16:00 2006 +0800

    Fix memorySize to enable offscreen mem manage.

commit b0ac5303f33f75dc607cf0c705c23db1da836983
Merge: 4c72725 c2cd10e
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 16 15:21:17 2006 -0700

    Merge branch 'textured-video' into broadwater-video
    
    Conflicts:
    
    	src/i830_video.c

commit c2cd10e1fba0e75c0ed3db5d17211bddf7ab1e33
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 16 10:08:58 2006 -0700

    Flag the 3D state as dirty when we draw textured video, which should help
    
    rotation (I have other issues with rotation anyway).

commit 63a72e46fa20a4a4ba74efed386f6c3c167be5b5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 16 08:54:43 2006 -0700

    Turn debugging back off.

commit 01c043de0393170e98515169f8239fef4d3e2053
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 16 08:53:40 2006 -0700

    Use linear min/mag blending.

commit db3683907d15959e79adfb8f0cd94e861fae5c36
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 16 08:40:53 2006 -0700

    For textured video, disable double buffering and sync before uploading new video
    
    data.  Allows more videos to play simultaneously.

commit 29a8e88ed01c9e15a2ceba5eb62b19773e14c1f8
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 15 17:19:33 2006 -0700

    Relax the alignment requirements for textured video.

commit c9be11459bc2198b435c97c5a3432425246c4d2d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 15 17:04:27 2006 -0700

    Enable overlay and/or textured video at runtime according to hardware
    
    capabilities.  Sets up 16 textured-video ports.  Left in one hack (disconnected
    but advertised BRIGHTNESS and CONTRAST atoms) which may actually not be
    necessary.

commit f268979a0c779641c84e8d5b763acbda131474cf
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 15 10:05:19 2006 -0700

    Correct drawing issues with planar formats when top or left != 0, and Y didn't
    
    get its offset.

commit b09fd42d7088ead6c23e040ac4b71114f62de82b
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 15 09:29:43 2006 -0700

    Fix the planar formats to display correctly in textured mode. Still has issues
    
    with clipping, and some sampling differences between ximagesink and xvimagesink.

commit dd48790f4600a880fc4907c6e3b1cd51e9c0f0b7
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 13:27:33 2006 -0700

    Divide width by 2 in planar-to-packed conversion loop, since each pass through
    
    the loop writes two source pixels.

commit eec5e996ec9361099bf81d8d3b66933d5981c5a8
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu May 11 20:26:26 2006 -0700

    Merge textured-video-wip to textured-video-planar-full.

commit 4154a2f74811b91c0ef5bef32a919d6f8baf1a70
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed May 10 12:09:00 2006 -0700

    Experimental work to use a full pixel shader for planar to YUV conversion, which
    
    also doesn't quite work.

commit 3e0a9c9082942eb6f52612235d84b8408e1e03e9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 9 16:57:19 2006 -0700

    Do a separate BEGIN/ADVANCE_LP_RING set in the planar vs packed blocks, so I
    
    can adjust the planar code more easily.

commit 3af4a967e73b367bb531f2760b4803db1388bcf9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 9 16:50:48 2006 -0700

    Add a couple of macros to simplify writing of video pixel shaders.

commit 06e62ec521ed3f7ed232ace8e188891bedb53097
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue May 9 12:04:58 2006 -0700

    Commit a WIP implementation of the planar video shader that does the
    
    planar-to-packed conversion for us.  Unfortunately the documentation is unclear,
    and I haven't managed to get any implementation of it working correctly.

commit b1090a42b200710628dd8b0c7ced15db7bbe71a1
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 8 14:22:00 2006 -0700

    More magic number reduction in rotation code.

commit 3a2d8af214a79591322ce6e5546f856a1ee41736
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 8 09:42:40 2006 -0700

    Add initial textured XV support for i915, which can do YUY2 and UYVY, but fails
    
    on I420 and YV12 currently, doesn't support the composite extension, and should
    break XV support on non-i915.

commit 66875c1559bc20b531ab72e5d6b921d9f50b29f3
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 5 10:15:23 2006 -0700

    Convert magic numbers in i915 rotation 3D state to symbolic names.

commit 4c727254da354cfd6f35148a334d046d67a50e99
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 16:26:58 2006 -0700

    Remove the local, renamed copy of lnx_agp.c.  The diff between lnx_agp.c and it
    appeared to be removal of bugfixes.

commit a115c4b872a385530dcf94b7e7f2fa9b3b7e3155
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 16:11:29 2006 -0700

    Remove the code that changes our behavior based on whether a magic file exists
    with magic contents in /tmp (created by some install script).

commit 0cb251fadca1cbb3d4c5b97982cd0d8c2fc3e840
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 16:10:02 2006 -0700

    Do a couple of reverts to get the DRI code building.  At this point, the whole
    driver builds.

commit 78b95386b630039864b31954ebcd02ec8829b0c8
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 16:09:40 2006 -0700

    Remove intel_randr.c and stick with the previous code.  Broadwater shouldn't be
    changing our randr, and the new version didn't compile.

commit 2e58aa401dfbab438752038a9034df571c8f8bde
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 15:54:37 2006 -0700

    Make the intel_acpi.c code non-modular and make it compile.  I think we'll end
    up nuking this code anyway, as keithp (and I, as well) disagree about how ACPI
    should be handled, but the goal is to compile at the moment.

commit 2cd6c8fa2321ca217ef89db1027dbe9e716ad7aa
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 15:37:44 2006 -0700

    Revert internal shadow module changes back like master, along with RandR
    initialization.  RandR initialization retains the no-rotation setting for BW.

commit 88558ebeed12d6cefd73bba0ddac3c043861ac89
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 15:00:17 2006 -0700

    Start fixing up the build and remove a regression from master (I think) in
    rotation.

commit 9e387ef92be9b38c68bda8a6a28b0d9eb98d53a4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 13:41:38 2006 -0700

    Re-add authorship note in i830_driver.c accidentally left out of last commit.

commit af2432322ba1d561057c34ab185561a8e799e8cd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri May 12 13:32:38 2006 -0700

    First pass of integrating the Tungsten Graphics driver for Broadwater.  This
    patch is based off of diffing from the branchpoint to the supplied code, but
    with many chunks containing reversions of commits removed.  Won't work yet.

commit fbba4312e7cb326fdcf6a71194c4fc4a7a9b5488
Author: Dave Airlie <airlied@linux.ie>
Date:   Fri May 12 18:44:27 2006 +1000

    add sdvo capability reading support
    
    This reads the SDVO cap bits and uses them to figure out the input/output
    to save/restore

commit f2967a2f5f47b636b2445fa69dbc3ec79e065c90
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue May 9 13:51:25 2006 -0700

    Video overlay gamma bounds checking must be done bytewise.
    Also, pend bound computations to register writes to allow
    updates to individual values that are 'out of spec' so
    the client can update multiple values.
    (cherry picked from 190f9ad0606e96e684e0b028d576d822dc9aa3cf commit)

commit 190f9ad0606e96e684e0b028d576d822dc9aa3cf
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Tue May 9 13:51:25 2006 -0700

    Video overlay gamma bounds checking must be done bytewise.
    Also, pend bound computations to register writes to allow
    updates to individual values that are 'out of spec' so
    the client can update multiple values.

commit fb10966e9f43f44488097b0daf2fbe10c6a804dc
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu May 4 18:52:08 2006 -0700

    Use xf86int10Addr() when calculating an address to read the video BIOS from, out
    
    of int10's copy.  Fixes a crash on FreeBSD.

commit a66f2c01f7d557d860883346671fb864807dbdca
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon May 1 12:35:21 2006 -0700

    Stop doing the BIOS memory size tweaking now that we don't ask the BIOS about
    what modes are available.

commit 99b0e53244aa49f4e7461a1c96aba69453b3516f
Author: Matthieu Herrb <matthieu@reactor.herrb.com>
Date:   Mon May 1 10:47:09 2006 +0200

    Fix non-dri build.

commit 86f0119f47d8be975016ffdea850f0227e32eebc
Author: Matthieu Herrb <matthieu@reactor.herrb.com>
Date:   Mon May 1 10:41:10 2006 +0200

    Fix non-dri build.

commit fcec956807038a2e90287850df8b4410b1f8b3c2
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Sat Apr 29 10:55:25 2006 +0800

    Save initialize EXADriverPtr, and free it in failure.

commit 0be9bc604420e4433697cc31e8ac58c9f36185e1
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Sat Apr 29 10:54:02 2006 +0800

    I830CheckDevicesTimer() sync should be in I830_USE_XAA case.

commit a00a3d198aee7c173c2c36858f4447e13c86eb7f
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Sat Apr 29 10:52:45 2006 +0800

    fix I830BIOSAdjustFrame() sync in I830_USE_EXA case, use exaWaitSync() helper.

commit c94cc67bcc507e8256ae4b51b84dfe3f4aa12ab5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Apr 28 15:33:57 2006 -0700

    Update to EXA 2.0 API.

commit a4a4ced50cc235e79013ce8dd78e35c6eb4c98ca
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Apr 28 14:59:52 2006 -0700

    Get it to compile.

commit 941a49f91eac02e256706d8821a2cb069ff7ffef
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Apr 28 14:57:03 2006 -0700

    Commit what applied from Jesse Barnes's i830-exa-latest.patch.

commit a555e28e5afc81969ef7b28482e654cc26b3a446
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 16:55:44 2006 -0700

    Correct some SDVO-related register definitions.

commit cc70e6b789a1901bbe4e3501b6b654542d3cdc20
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 16:49:48 2006 -0700

    Save/restore the output's SDVO reg.  Note that we might be programming the other
    SDVO reg instead of the one assigned to the output.  When trying to fix that, I
    ended up getting no output at all.

commit b498d2b1d1170123595ada65353428578b59a361
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 15:42:46 2006 -0700

    Start trying to save/restore SDVO state on VT switches.

commit 56c1f8b0de9b6acc50f51561caf14d3e6bac09ec
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 14:10:20 2006 -0700

    Clean up some argument passing, and remove extra SetTarget{In,Out}Puts that had
    no effect.  Note that we are currently trying to program both outputs of any
    SDVO device the same way.

commit 9ba5319b36e7286e33cf0dcdd804dfc0458a81f5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 13:55:05 2006 -0700

    Only write out as many arguments as the commands need, and fix up the numbers in
    some cases.  Pretty-print the return status.

commit d32514aee4b00b035652830e8b5e6c0b43cf159c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 12:21:45 2006 -0700

    Start trying to implement DDC over SDVO.  It's slightly tricky because the
    control bus will reset from DDC mode to internal-registers mode after every
    Stop afer a Start on the DDC bus.  The xf86 DDC code causes multiple Start/Stops
    in one probe.  So, we create a wrapper bus that does the control bus switch at
    every Start.  It's not working yet on my hardware, but I'm pretty sure this is
    the right way to go.

commit effab21c3d108fac7a4e28ae4dabb0b5f74a5380
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 11:42:24 2006 -0700

    Set displayWidth to a sufficient value for the modes we come up with for LVDS.
    
    Reported by:	Lukáš Hejtmánek

commit bcb441225d1365435bc3373901180de944298e86
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 10:54:45 2006 -0700

    Simplify the i2c code by using the GetBits/PutBits interface rather than
    reimplementing it.

commit 47bd9059431eadfd8824e496eb91bb50efa0e282
Merge: 729c373 32a0ad5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 24 10:36:24 2006 -0700

    Merge branch 'lukas-resume'

commit 1dbb19059f5dd5cd2ad386c4f73498095987b943
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Apr 20 10:43:19 2006 +0100

    fix bug 6365

commit 729c373121ce2bbb0d813cc923f1254e8b37a025
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Apr 20 13:34:55 2006 +1000

    move sdvo output setting
    
    we have to set the sdvo register a lot earlier in order for them to sync
    properly otherwise my monitor doesn't sync unfortunately, also
    disable the sdvo while tweaking the PLLs.
    
    This also comments out a setting that seems to break my system here for
    Eric to look at later.

commit 0ba7b13fb4410c6a48b2fb098d2033e040eca6d2
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Apr 20 12:29:06 2006 +1000

    fix type 0 instead of O

commit 2991d81a3b643161babab6b8f44c057aaaf351c3
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Apr 20 12:27:47 2006 +1000

    correct height parameter in sdvo packet

commit b5f099e03a9f58b6b99933fb06526bce4db72bd3
Author: Dave Airlie <airlied@linux.ie>
Date:   Thu Apr 20 09:50:36 2006 +1000

    cleanup sDVO for device on C only
    
    This destroys the i2c device properly if the device isn't detected,
    and allows sDVO to work on GM chipsets, and doesn't initialise
    the i2c bus twice for sDVO.

commit 2909802de63756972b38651a496b4ff1b36ac8a2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 19 16:29:06 2006 -0700

    Clean up SDVO initialization, include config.h, and make it check the right
    slave address on the first device as well.  This gets me to the point of
    bringing up some modes on my device.

commit 32a0ad570d9c010e7d26d980830f719782d9f2f3
Author: Lukáš Hejtmanek <xhejtman@mail.muni.cz>
Date:   Wed Apr 19 19:43:45 2006 -0300

    Add  more registers to save/restore. Save/restore palette as well

commit 132dc0599cf44389c4cc03919f1da8d3a0762b44
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 19 15:04:17 2006 -0700

    Whine if SDVO I2C device init fails, rather than be silent.

commit 88bb4b578857588f34ac84b7a20577139eccab6d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 19 14:23:45 2006 -0700

    Add more SDVO code.  It's taken from airlied's driver, but with magic numbers
    replaced by symbolic names in many places.  I tried to restrain myself from
    functional changes in airlied's code in this pass.

commit d8f7dfac769d7b03f069306b1296bb2e1e08b009
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 19 10:45:13 2006 -0700

    Start bringing in some SDVO code, mostly from airlied.

commit a371a04a57620b7128e3c4395bc7c2ac55effe19
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 17 14:10:50 2006 -0700

    Use the IS_I9XX macro intead of >= i915G, since by PCI ID number, 855GM > 915.

commit 33413a3cf34b06e3207fe1cdb733d586d55a4337
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 17 13:42:57 2006 -0700

    Remove some dead code and one particularly useless debug printf.

commit a85be820033af8bf30d1fec4a899349af35a6ef6
Author: Ian Romanick <idr@localhost.localdomain>
Date:   Mon Apr 17 12:52:30 2006 -0700

    Add missing new-line character in log message.

commit 365b4a53ee965002a5452e6f6016b528e51cee69
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 17 01:12:28 2006 -0500

    Disable the BIOS dump-to-file since it's a trivial local DOS, and I can just ask
    people to turn it on and recompile when I need to.

commit ee7be006b63b6b1ce7f786b045fb8f26d337433c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sun Apr 16 13:13:42 2006 -0500

    Bug #6589: Use alternate offsets to successfully get at the panel data for
    some broken video BIOSes.

commit 786ee3df1726f08953167d05f7fa1930452703bb
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sun Apr 16 13:05:35 2006 -0500

    Add a standalone program for parsing VBT.

commit 62652127cd12f5a0fc9364285b81d2661372148a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Sat Apr 15 12:16:46 2006 -0700

    Check for LVDS BIOS tables exactly once at startup.  While there, dump the BIOS
    data to /tmp/xf86-video-intel-VBIOS, for offline debugging.

commit 830fa81792a613fe2127a2b89a3eaa326f56114c
Author: Alan Hourihane <alanh@jetpack.demon.co.uk>
Date:   Wed Apr 12 21:55:31 2006 +0100

    fix typo

commit 3c9bc19db63a317db9e2d67a5bc15b1de1a1060a
Author: Alan Hourihane <alanh@jetpack.demon.co.uk>
Date:   Wed Apr 12 21:54:50 2006 +0100

    fix typo

commit d6edffee7d987ef551e1a94d9fac21beb72a9598
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 12 12:16:51 2006 -0700

    Initial support for pre-i915 PLL programming. Untested.

commit 59f88955f57cf0f98458b57418dae25cf53ca180
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Apr 12 11:11:14 2006 -0700

    Automatically enable clone mode if we detect two active outputs.

commit a797a6626a8117cd16456a206ed96300e4a0ceeb
Author: Wang Zhenyu <zhenyu.z.wang@intel.com>
Date:   Tue Apr 11 16:44:42 2006 -0700

    Fix a broken test that resulted in page flipping always being enabled, not just
    when the user enabled it.

commit 66d216da3bfe7c143d681b610130e6daf6dfa52f
Author: Eric Anholt <anholt@leguin.anholt.net>
Date:   Tue Apr 11 16:37:10 2006 -0700

    Replace .cvsignore with .gitignore.

commit 185b5251419724fa9377421d67981daa674908c8
Author: Eric Anholt <anholt@leguin.anholt.net>
Date:   Mon Apr 10 20:25:13 2006 -0700

    Add missing MIT copyright licenses, which should have been on all versions.

commit c0a2dc608d95f92b0f5a151c623745f09df3afc5
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Apr 10 20:09:37 2006 -0700

    Save/restore PFIT_CONTROL. Eliminate compiler warnings

commit 498abf474b90b04bc4085397a209cc493d98d15c
Merge: c26f073 3de82ff
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Apr 10 19:41:50 2006 -0700

    Merge branch 'modesetting-origin' into modesetting

commit c26f0737e2c0f000f67f21ef6007b351160036a4
Merge: 11ad8a5 692a4a4
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Mon Apr 10 19:41:41 2006 -0700

    Merge in master to modesetting

commit 3de82ff3938c6559c90079be0c28dc507d62f79e
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 10 15:10:15 2006 -0700

    Improve LVDS modes when outputting a CRT+LVDS combo at larger than the LVDS's
    panel size.  This is a hack until we get better clone mode, but it correctly
    displays a subset of the root on the LVDS by using a correct pixel clock and
    pipe/display size.

commit 692a4a4bafd4cab197b761cda22368581b78f996
Author: Adam Jackson <ajax@freedesktop.org>
Date:   Mon Apr 10 11:27:25 2006 -0700

    Bump to 1.6.0.

commit 43c93057c044f33c20b1dd639eaeabefc0901589
Author: Aaron Plattner <aplattner@nvidia.com>
Date:   Mon Apr 10 11:26:33 2006 -0700

    Add a DrawablePtr argument to the XV functions to pave the way for redirected
    video.

commit 39bdfbb4c23c9ba2a44888f22330a892c4becedc
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Apr 10 11:26:06 2006 -0700

    x86_64 warning fixes

commit 11ad8a590d65849be00e1be4e9dd52c1159a4f24
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 10 09:39:24 2006 -0700

    Remove the int10 POST on EnterVT.  It has been reported to cause crashes now,
    and I believe it is the responsibility of the kernel to bring the device back to
    a mostly-sane state on resume anyway.

commit 4217ce18cec257cad435adf9ddc9258a3c8164ec
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 10 09:37:02 2006 -0700

    Warnings cleanup.

commit 334512e0604c208ffec914374a76d85720c1dcf9
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 10 09:32:45 2006 -0700

    Don't try to use LVDS by default on chipsets that won't have an LVDS attached.
    The BIOS tables may still exist, so we can't rely on their presence to indicate
    LVDS attachment.

commit 69083a2fc3ca4a3d06c1985c8a630d5628c1110c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 16:29:14 2006 -0700

    Remove BIOS save/restore code, fixing VT switching. Removes some other dead
    code, too.

commit 2e5d85fb83def483ab1fd96877aae4a89a962b7f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 16:27:24 2006 -0700

    Turn off the VGA plane when we're setting our native modes.

commit ceb08d28f4a4e9f42c9417938b8541bf1b4e8245
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 15:32:41 2006 -0700

    Remove the hacky-looking Set640x480. I'll be removing things it depends on
    (setpipe), and I suspect we'll end up with different hacks for resume, anyway.

commit 1f0ba458d02f7d4777c1669aae02138f3a6628c1
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 15:28:47 2006 -0700

    Remove more BIOS stuff, particularly Get/SetDisplayDevices. Now, if there's no
    hardcoding in the config file, we default to LFP if we detect it from BIOS, and
    LFP or CRT if we can get EDID out of them.

commit b20b466aaed54708ae9e4676623c8c394a6f00d5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 14:28:55 2006 -0700

    Remove the now-unused displaySize and pipeDisplaySize.

commit d960c3ca1512a58a53b5c24702cb5c97124817ee
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Apr 3 14:12:29 2006 -0700

    Remove more BIOS modesetting stuff.

commit 4e3a4827007d624aa3da1a9f5a299837bd601a33
Author: Keith Packard <keithp@neko.keithp.com>
Date:   Fri Mar 31 14:05:46 2006 -0800

    autodetect LVDS dither. Fix 16bpp depth selection

commit 8d27f8246ed5a73f7a78043e128b47be784186c0
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Mar 28 13:49:41 2006 -0800

    Clean up (and I believe fix a couple of bugs in) the divisor selection code.

commit e45581cd073b23a62719f20783d617bd35316fec
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Mar 28 13:40:32 2006 -0800

    Fill in clock information from VBT table, so that a good clock value gets
    requested for choosing divisors.

commit 33977d23830b5f9bb7d9e2e9c141f91cb127b7de
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Mar 27 18:50:53 2006 -0800

    Port code from radeon driver for panel mode validation, which will hopefully get
    the right mode chosen on the VAIO.  Untested.

commit febdfa967dbe1df487db71ba5f677ef37450bf7a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Mar 27 15:19:52 2006 -0800

    Remove some VBE DDC code that I believe is OBE.

commit f86892c9163473a683ab591adeb9fb1c0be2ef99
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 24 16:00:30 2006 -0800

    Make auto panel fitting work by pulling LVDS timing EDID info out of the static
    BIOS table, and always using that.

commit f6a3243f40074aee471ec1cda2cc8e5f05116284
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 24 13:49:10 2006 -0800

    Add more VBT reading, so we find the panel size.

commit 64756e215016730b5cc2e174f08d47c0288c0ba4
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 24 11:55:01 2006 -0800

    Start interpreting VBT information with the goal of pulling out LVDS timings
    for panel fitting.

commit c2d554be671f5368bd98867b8ecf9428e4560a81
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 23 14:33:04 2006 -0800

    Save/restore a couple of important VGA plane registers, and have vgahw
    save/restore everything it knows about.  Also moves the save to just after the
    other reg saves, above the VBE save stuff which may have side effects.

commit 8411c126ae66239f8b3a2261e338a723c36aa44f
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 23 11:31:24 2006 -0800

    Update to newer airlied DDC code, and do some cleanups as well. Now tries DDC
    on LVDS, though my current LVDS gives no results.

commit 6414ad89b9d368a032adf2358a65404f5443ef35
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 23 09:48:18 2006 -0800

    Add enough of airlied's DDC/I2C work to pull EDID info from my CRT.

commit 5215e19af58f5c2746c8d281e33ecee86e55f0a5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Mar 13 10:29:51 2006 -0800

    Add some register information for VGACNTRL, and do the reg-debug thing on it.

commit b77bdc2c15640a3b15233f2190179d66bc8b2a4b
Author: Eric Anholt <anholt@debian-sony.jf.intel.com>
Date:   Wed Mar 8 15:08:06 2006 -0800

    Move the PFIT enabling before the enabling of the pipe, as the specs say we
    should.  This doesn't work yet, as we apparently need to adjust the pipe to
    output at the full resolution of the panel, not the displayed image size,
    because PFIT controls scaling between the display planes and the pipe.

commit de4a9e4a7891daa1488d17bf4c22283759f97373
Author: Eric Anholt <anholt@debian-sony.jf.intel.com>
Date:   Wed Mar 8 12:54:14 2006 -0800

    Add a couple more bits to panel auto-fitting, though it isn't working yet.

commit 02341aa68cf2171e037196019f2553f0d1b1bd0d
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Mar 6 13:23:29 2006 -0800

    Make the reg-snapshot code work, add a couple more registers, and use it on VT
    switching to hopefully help point out where we aren't restoring enough.
    Currently doesn't reveal anything.

commit 2b6fc7ddb020a5511f6f599a2f5c37db27eddbcc
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 3 15:42:15 2006 -0800

    Add missed save/restore of DSP*SIZE registers.

commit 12ce799818722473dde2f82739d50ba4ec7f6ecd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 3 15:38:31 2006 -0800

    Add some untested debugging code to for helping figure out VT switch issues.

commit 585cc5f256b8e91460414a26409d0e484a86718c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Fri Mar 3 10:37:26 2006 -0800

    Add more integrated LVDS support code.

commit 33c62e8e654fa2228bc3fd31ec0fe010703f363a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 17:53:38 2006 -0800

    Change the order of reg writes for restore, possibly increasing chances of
    success.  Also save and restore ADPA.

commit 7f4dc09dcafc7f0423b7f3e970a0b19fbbf515dd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 15:55:18 2006 -0800

    Remove some dead VBE code.

commit f3ec8653ab4c9b26d249bcf4393326de37ac8321
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 14:31:39 2006 -0800

    Include config.h, fixing many issues with reading from pI830.

commit 84fc3971d76f78546a0bb7dd57dba52dd893a921
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 13:35:40 2006 -0800

    Turn off panel power before poking pipe B, and turn it back on if we're doing
    LVDS.  Also, refuse to do LVDS on pipe A, as the docs say you can't.

commit aca0f942f377d997c5c0b5be790ee7f255d6e046
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 13:31:51 2006 -0800

    Fix prototype for i830DetectCRT.

commit df6347139bc9de22af981f776d711ac9d44fad1c
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 12:52:19 2006 -0800

    Use DISPPLANE_32BPP_NO_ALPHA for depth 24, else the empty alpha channel results
    in a black display plane.

commit 8e819ced8397f0330fd44efa60fef89bd10ff70e
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 11:55:00 2006 -0800

    It appears from the specs that you have to wait for vblank after disabling the
    plane, not the pipe.

commit ee2410b965321e3d9d64fc500fdcfa6d6dc3a039
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 11:43:41 2006 -0800

    Move display base setting to a separate function and use it from both mode setup
    and AdjustFrame.  Rename AdjustFrame to reflect the fact that it doesn't touch
    the BIOS.

commit 980fb78e759b752a6cae3c87d188c50ab131ba80
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 10:49:31 2006 -0800

    Correct capitalization of i830SetMode.

commit 2b842c7ee3f9c33cabf16561f11bf1c3a2502d4a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 10:08:20 2006 -0800

    Start implementing support for setting modes for multiple output devices,
    particularly LVDS.  Untested.

commit a09d9cf27af7016bbd9e562c7b1c338154fd3d40
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Mar 2 09:05:13 2006 -0800

    Replace I830VESASetMode with simpler i830SetMode, which is all native and
    doesn't have BIOS-setup workarounds.  Multihead behavior may be wrong, and it is
    all untested.

commit 7edb25789bd13f26134e8f5bf493897c8df322e0
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 14:02:51 2006 -0800

    Start making i830SetMode aware of multiple pipes.

commit b5915ac77a3887cd3aa4ce0bb77b8a36e1aa5a1b
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 13:12:25 2006 -0800

    Clean up a couple of warnings.

commit c20e15fbe4daeb7288f5c56cf5467eed13686080
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 13:08:38 2006 -0800

    Disable I830VESASetVBEMode on restore, since I've removed that code. Note that
    this means that VT switching is broken.  We're fine with that for now, but at
    least now we get a bad display rather than X crashing about an undefined symbol.

commit 7d37c5036956609d0c7ae874d0dc1c616f76f849
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 13:06:04 2006 -0800

    Re-disable chatty debug code.

commit 2538cbeb5014e40280a3ae782a755512b1dc85fa
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 13:01:52 2006 -0800

    Enable -Wall on GCC, and do a cleanup of existing warnings.

commit 7746da3b346968ab8d2534fc158d026da67cc7b5
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Wed Mar 1 12:49:06 2006 -0800

    Move LVDS panel power state setting to a separate function, and reduce magic
    numbers.

commit 142bc4f91a5d776e7ab44cc5fb2328e3f7267557
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Feb 28 18:50:57 2006 -0800

    Write the ADPA (CRTC) register on mode setup. Obtained from airlied.

commit 6877f532c5f41a445d41eb6a9982bf6bcf691bf2
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Feb 28 15:56:06 2006 -0800

    Add untested CRT detection code.

commit a085813714818a23aa8d326804f642cd699e0f17
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Tue Feb 28 15:16:59 2006 -0800

    Add adjustments of PLL divisor limits for "Almador".

commit 2d4415ff1729554537b20be2b6c878444485e406
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 16:57:43 2006 -0800

    Remove the hacked local xf86SetModeCRTC now that xf86SetCrtcForModes is taking
    effect on all of our modes.

commit 611264ab9b82bca6648a9b27e5ba4b7457c46aa6
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 15:44:11 2006 -0800

    Remove more VBE stuff and start using xf86ValidateModes. Guessed some params to
    xf86ValidateModes.

commit 9838f639911e8c165ab615fdd9a00e02fa4b3f8a
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 14:12:50 2006 -0800

    Always ErrorF output debugging info when doing BIOS calls, including file/line.

commit 767944e3782f9941e9fc72a6705cc3115a6e24ac
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 13:08:46 2006 -0800

    Replace a few magic numbers with symbolic names. Reviewed by md5.

commit 4955cd267e7f8ed70e90b2a3de6f93de2ef859c8
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 09:37:47 2006 -0800

    Add untested save/restore code, and starting on not using VBEValidateModes

commit 73496b765c9783a8a271b4774a44fa263dd47684
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Mon Feb 27 09:26:51 2006 -0800

    Change an if statement to a more obvious but equivalent case statement.

commit 9fe316da7390918dd88940087567314b6f253981
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Feb 23 13:49:31 2006 -0800

    Add the manpage's possible names when generated.

commit 1555229f29fa7479d6a7a51f451d04a5ef3460bd
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Feb 23 13:48:26 2006 -0800

    Move .cvsignore to .gitignore

commit 139d33ac807fb0fc35c37c3689a6e80238199442
Author: Eric Anholt <anholt@FreeBSD.org>
Date:   Thu Feb 23 13:46:30 2006 -0800

    Initial add of native CRT modesetting code.

commit 35e4756645891bfc85f25f1ab60c287eba9ef749
Author: Dave Airlie <airlied@linux.ie>
Date:   Wed Apr 5 07:12:00 2006 +0000

    Fix some argument inversions in xf86DrvMsg function calls

commit 6e5f9b026372eea295c390b18fc41f7018e0e797
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Tue Apr 4 18:22:32 2006 +0000

    Add more missing #include's, in particular assert.h.

commit fdfce49c54dabf0f6b0d20aa7e5eeb62b5b57eda
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Wed Mar 22 23:24:03 2006 +0000

    Drop libc wrapper; don't include xf86_ansic.h and add includes now missing.

commit 58817c9909ba659d0070afab0ff7f4e26f722403
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Mar 10 13:07:00 2006 +0000

    Enable gamma for hw cursor when ARGB cursor in use (Lukas Hejtmanek)

commit ab4c2f3bf4b26fdd597ea7b7a726ae77778617b2
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Mar 3 16:27:37 2006 +0000

    Check the version of shadow being used and turn off rotation if it isn't the
    right one.
    Bump the Xvideo resolution support from 1920x1080 to 1920x1088.

commit be6216cd8c6a47dd053240f7a5d1445b61f79038
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Feb 20 03:25:50 2006 +0000

    Fix a rotation problem when DRI is disabled

commit 073c4a6a18e98e2dde114756b5d787b13bb2b7a5
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Feb 20 03:22:26 2006 +0000

    Fix a rotation problem when DRI is disabled

commit 7cca2ae73e0114a9df2152ed5ed5b66fc44f65dd
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sun Feb 19 00:04:49 2006 +0000

    fix another build problem

commit 2e01277da0be55687ca901efadcaf5c919826824
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Feb 17 16:16:10 2006 +0000

    fix build failure

commit 86fa25369353471dc9a1041df74e66e9029863a7
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Feb 15 18:31:22 2006 +0000

    a little more of a workaround until we unplug the frontbuffer from libdri

commit 32f97e02ac3611fd5e3870826dedf701f3b69a51
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Feb 10 21:59:37 2006 +0000

    temporary workaround until DRI frontbuffer mapping code is removed from
    libdri.a

commit 50e5c2696389cb4d5907a822aa79d5e0e03cee8c
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jan 26 09:55:15 2006 +0000

    update Changelog

commit 91d2ba5743041077754de3bd3565df930b036c7d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jan 26 09:05:50 2006 +0000

    add changelog

commit 076971b95ed3b89e1a333adbffceab1c2a5b7743
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jan 25 22:22:42 2006 +0000

    When going dual head only take a portion of memory for the second head
    instead of doubling the requirements.

commit 77d1c579f3031789031dd203175d3c9555226f79
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jan 25 22:17:00 2006 +0000

    Fix a glitch in a dual head fix from #3105

commit d8d749080923e88376db1aa18ae2ad722d5113d9
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jan 24 15:20:34 2006 +0000

    Bump version to 1.5.0.0
    Add Intel 945GM support
    Add RandR rotation support (full 3D acceleration, HWcursor & Xvideo rotated too)
    Remove shadow framebuffer rotation code
    Add a new LinearAlloc option to allow more offscreen memory to be allocated
    for XVideo applications. This allows HDTV movies to be played via Xvideo.

commit 919d36b6717e9a7d930c5120309778da7b0fe16c
Author: Kevin E Martin <kem@redhat.com>
Date:   Wed Dec 21 02:30:00 2005 +0000

    Update package version for X11R7 release.

commit 92962f32fccac6df751268190928d8becb558b64
Author: Adam Jackson <ajax@nwnk.net>
Date:   Mon Dec 19 16:25:53 2005 +0000

    Stub COPYING files

commit d2ef609211306b6bd3861c0e5f6d3a9af3e145fb
Author: Alan Coopersmith <Alan.Coopersmith@sun.com>
Date:   Mon Dec 19 09:07:50 2005 +0000

    Typo fixes, mailing list & url updates, and other changes to prepare for
    X11R6.9 & 7.0 releases.

commit 1c51ff5c652690d66d1f7cba803c0bb26208b509
Author: Kevin E Martin <kem@redhat.com>
Date:   Thu Dec 15 00:24:17 2005 +0000

    Update package version number for final X11R7 release candidate.

commit c5007a4b46ffb66f5d98abe8bcae6df8c6eb1b31
Author: Kevin E Martin <kem@redhat.com>
Date:   Tue Dec 6 22:48:35 2005 +0000

    Change *man_SOURCES ==> *man_PRE to fix autotools warnings.

commit 15df4215347854604fd3f6795ac5f971444cf39d
Author: Kevin E Martin <kem@redhat.com>
Date:   Sat Dec 3 05:49:33 2005 +0000

    Update package version number for X11R7 RC3 release.

commit c50cd5a7f5af7d45550f25f173b512eb89bf41c5
Author: Kevin E Martin <kem@redhat.com>
Date:   Fri Dec 2 02:16:08 2005 +0000

    Remove extraneous AC_MSG_RESULT.

commit da2c00c0e85a284e3fbd237f3a77212f9647da37
Author: Adam Jackson <ajax@nwnk.net>
Date:   Wed Nov 30 18:47:54 2005 +0000

    Bump libdrm dep to 2.0.

commit ca36f1da4e254c779b38df30fd655533e548a294
Author: Adam Jackson <ajax@nwnk.net>
Date:   Tue Nov 29 23:29:59 2005 +0000

    Only build dlloader modules by default.

commit 0b337390d6919e9a3d31ca654c8bc44b30756862
Author: Alan Coopersmith <Alan.Coopersmith@sun.com>
Date:   Mon Nov 28 22:04:09 2005 +0000

    Change *mandir targets to use new *_MAN_DIR variables set by xorg-macros.m4
    update to fix bug #5167 (Linux prefers *.1x man pages in man1 subdir)

commit 159bea027893ce5996a452a6f493372792e95122
Author: Eric Anholt <anholt@freebsd.org>
Date:   Mon Nov 21 10:49:14 2005 +0000

    Add .cvsignores for drivers.

commit e62939e30e664592085ce394680fd8e7f3d31339
Author: Kevin E Martin <kem@redhat.com>
Date:   Sat Nov 19 07:15:38 2005 +0000

    Update pkgconfig files to separate library build-time dependencies
    from application build-time dependencies, and update package deps
    to work with separate build roots.

commit 08f03e4237ce9a54f0dffa37307af402b0bd2e55
Author: Kevin E Martin <kem@redhat.com>
Date:   Wed Nov 9 21:31:20 2005 +0000

    Bump version numbers for X11R6.9/X11R7 RC2.

commit a600e89a1547908f2018de96b5ecb814e2427b34
Author: Kevin E Martin <kem@redhat.com>
Date:   Wed Nov 9 21:15:15 2005 +0000

    Update package version number for X11R7 RC2 release.

commit f73c23b4c588c2f5dbc3c36a2f43b8bbb1e0f36a
Author: Kevin E Martin <kem@redhat.com>
Date:   Tue Nov 1 15:08:53 2005 +0000

    Update pkgcheck depedencies to work with separate build roots.

commit 25a63bfefda420f85b3cba89bdae4b35ef80c84f
Author: Adam Jackson <ajax@nwnk.net>
Date:   Fri Oct 21 18:40:19 2005 +0000

    Bug #4829: Remove some useless DRI symbol checks.

commit 53c122fa162709f618be26d5940e3488c0cbbafa
Author: Kevin E Martin <kem@redhat.com>
Date:   Wed Oct 19 02:48:03 2005 +0000

    Update package version number for RC1 release.

commit 4b97a544cac9fb507b4a2a7c8017607ea2cac1bb
Author: Alan Coopersmith <Alan.Coopersmith@sun.com>
Date:   Tue Oct 18 00:01:53 2005 +0000

    Use @DRIVER_MAN_SUFFIX@ instead of $(DRIVER_MAN_SUFFIX) in macro substitutions
    to work better with BSD make

commit c7b7ece6330561b3745f0e1136b57575eadec5ad
Author: Adam Jackson <ajax@nwnk.net>
Date:   Mon Oct 17 22:57:33 2005 +0000

    More 1.7 braindamage: define EXTRA_DIST in terms of @DRIVER_NAME@ instead of indirectly

commit 0586dbe1c5d0432e8d8da2f3576ac2ccbe139919
Author: Alan Coopersmith <Alan.Coopersmith@sun.com>
Date:   Mon Oct 17 00:09:03 2005 +0000

    Use sed & cpp to substitute variables in driver man pages

commit 1317f2d1f35241969dcf376abd106ffe3f918432
Author: Søren Sandmann Pedersen <sandmann@daimi.au.dk>
Date:   Tue Oct 4 20:01:03 2005 +0000

    Check in generated README files

commit bd48e0531a16bdf27fc8549826cc1123ba12d5bd
Author: Søren Sandmann Pedersen <sandmann@daimi.au.dk>
Date:   Mon Oct 3 21:22:07 2005 +0000

    - For all drivers that have a <driver>.sgml file, add code in their build
      system to build the README file at make dist time
    
    - in util/macros/xorg-macros.m4, add a new XORG_CHECK_LINUXDOC macro that
      will check if the required tools and files exist, and if so set a
      conditional.
    
    - util/modular/symlink.sh
      - Link all the <driver>.sgml to xf86-video-<driver>/README.sgml
      - Add all the README.<driver> to the list of excluded files
    
    - xc/programs/Xserver/hw/xfree86/doc/sgml/SiS.sgml: Various changes
      to make it spew less warnings when the text file is built.

commit 6fda4e886c30669e346f7f30a38b93a77004a7f6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Oct 3 09:39:17 2005 +0000

    Bug #4353: Fix lockup when suspend and resume when playing video.
    Shutdown the overlay on LeaveVT.

commit 154724cc4be1e951649c29e4abdbde964a8c112e
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Sep 27 08:58:23 2005 +0000

    Put back the print code to display the DDC information, and remove some bogus
    DDC messages.

commit 2174848266940e1896970c12717e106a4742dcbc
Author: Adam Jackson <ajax@nwnk.net>
Date:   Sat Sep 24 18:45:45 2005 +0000

    Disable the {Open,Close}FullScreen DRI protocol.
    Remove empty FullScreen stubs from drivers, comment the non-empty ones.

commit b6443515e9d485b1ab8ee266c5b21750d2a5a551
Author: Alan Coopersmith <Alan.Coopersmith@sun.com>
Date:   Thu Sep 22 01:58:17 2005 +0000

    Don't build xvmc module if DRI support is not present

commit 76033c2c885524c2116ccf0bdd30c89fa2636150
Author: Eric Anholt <anholt@freebsd.org>
Date:   Thu Sep 15 06:04:59 2005 +0000

    Bug #4458: Check for the xvmc proto package, since it's required to build these.
    (Joshua Baergen)

commit 50f0bf51a67c89bf445a682f8fec34c52ff909a8
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Sep 8 14:51:40 2005 +0000

    fix another possible crash

commit 521e357c1846960b48e83fb97f77025f6f91e638
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Sep 8 09:31:04 2005 +0000

    Fix a crash situation

commit e8c46c897564f038744b9274949482568d654ecc
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Sep 6 10:31:33 2005 +0000

    Fix DirectColor visual colormap issues at 16bpp in the i830 driver.

commit bf6fef41935ebf624cc1ae6faa084dfa0a7eee72
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Sep 6 10:23:57 2005 +0000

    Sync the accelerator before calling AdjustFrame to avoid lockups.

commit 5fc5f02d76e077b09bf3ab1c7deeb1263033d57a
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Aug 29 12:06:13 2005 +0000

    Add i810 XvMC support, it passes distcheck for me.

commit 86e6935bd50b129519b24ee3d694a3f75b8d4f1c
Author: Dave Airlie <airlied@linux.ie>
Date:   Mon Aug 29 12:02:29 2005 +0000

    Fix include paths for i810 XvMC add config.h to driDrawable.c

commit 6f1406753da102ccce1898b3f160d6eaaccc9b7c
Author: Kristian Høgsberg <krh@redhat.com>
Date:   Fri Aug 26 15:32:40 2005 +0000

    Added i830_io.c, which just includes i810_io.c with BUILD_FOR_I830 set.

commit 219beaca91b88dabfe05b8e756d558269f7a5148
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Sun Aug 21 06:26:33 2005 +0000

    Fix typo in debug ErrorF.

commit fdc6997f2edf4dfdcfd877152028bff2a0306999
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Thu Aug 18 09:03:47 2005 +0000

    Update autogen.sh to one that does objdir != srcdir.

commit 461d43be78f49e6cb965b7a206c77f6fe1622601
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 15 07:30:05 2005 +0000

    Egbert's 64bit fixes for mixed 32/64bit clients

commit 95bd8dbee69b4b35e4c37e19d15e0449c38726b6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Aug 12 21:23:59 2005 +0000

    add missing i830_shadow.c

commit 7476d0413f161ddb3f3cc4a77c3f2a2912d17e60
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Aug 8 09:17:06 2005 +0000

    Enable gamma correction bit even for 8bit modes.
    
    The pipeconf register handles the real enablement.

commit a89f89a2423aecb199d5f4af2e9430e180aa1131
Author: Ian Romanick <idr@us.ibm.com>
Date:   Fri Aug 5 23:04:33 2005 +0000

    I have resolved this by making all the "Direct rendering disabled" messages
    X_WARNING and all the "Direct rendering enabled" messages X_INFO.  Ideally,
    we need to factor some of this stuff out to common code.  There is a *LOT* of
    duplication among the *_dri.c files under programs/Xserver/hw/xfree86/drivers.
    
    I'm trying to clean up as much low hanging fruit as I can and got tired of
    waiting for ajax. :P

commit fd6d7d7f7ea03961c5ecf7db029f12ece93d414a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Aug 2 16:22:42 2005 +0000

    Adjust newPipe code for BIOS's starting at 1200

commit da7b85176fc061995e1b04fa22dc736b6c9353e6
Author: Adam Jackson <ajax@nwnk.net>
Date:   Sun Jul 31 17:19:29 2005 +0000

    Post-merge fixups:
    - Disable building the gamma driver
    - Fix numerous Imakefiles to get header paths and subdirs right
    - Symlink client-side GLX lib source from Mesa
    - Add new shader subdirs to the Mesa core build
    - Tweak the DDX drivers to not ask for "xf86dri.h"; they don't need
      it, since they don't generate protocol, and it was breaking the
      build.

commit 1561ec3ca4f0d774f2664e9354d537061a0102d1
Author: Kevin E Martin <kem@redhat.com>
Date:   Fri Jul 29 21:22:43 2005 +0000

    Various changes preparing packages for RC0:
    - Verify and update package version numbers as needed
    - Implement versioning scheme
    - Change bug address to point to bugzilla bug entry form
    - Disable loadable i18n in libX11 by default (use --enable-loadable-i18n
      to reenable it)
    - Fix makedepend to use pkgconfig and pass distcheck
    - Update build script to build macros first
    - Update modular Xorg version

commit d165b7dc4ec3793e921363cdeb1ad41c0a3653d6
Author: Søren Sandmann Pedersen <sandmann@daimi.au.dk>
Date:   Wed Jul 27 21:23:29 2005 +0000

    Add xf86driproto to dependencies for drivers with DRI support. Patch from
    Donnie Berkholz

commit 0cd371c6e57f899c34c4d2e2a8531ef7ce3967a4
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 26 21:55:42 2005 +0000

    Bump the DDX version to 1.4.0 to indicate the removal of drmAddress.
    Thus allowing 32/64bit clients to cohabit.

commit adef005c2f96395d396834f2173125f0c06d40cb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 26 08:07:37 2005 +0000

    Bug #3850: <https://bugs.freedesktop.org/show_bug.cgi?id=3850>
    Fix non-DRI builds.

commit 09e871b1b4a67cfe818613bc012d72965b449f1c
Author: Søren Sandmann Pedersen <sandmann@daimi.au.dk>
Date:   Tue Jul 26 00:41:42 2005 +0000

    Build system for i810

commit ac920dae7c22ed3956e4f31a0d3baf1909762b76
Author: Adam Jackson <ajax@nwnk.net>
Date:   Mon Jul 11 02:29:51 2005 +0000

    Prep for modular builds by adding guarded #include "config.h" everywhere.

commit f90f661652e5fe0986eb804f8dff3eeffe0af820
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Sat Jul 9 21:19:11 2005 +0000

    Copy mode strings upon mode copy

commit 8fced5b648b0666ca88221e37bc1131ab5c2072d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jul 5 09:25:03 2005 +0000

    Fix Xvideo when operating in one line mode and video is pushed off the top of
    the screen. Also some fixes for Xvideo skew in certain resolutions.

commit 68bc259fa1082f7780e524fc703e926a27fc7f9a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jul 4 20:45:39 2005 +0000

    NULL check

commit 83c3e3ee49a0aa3ceaf52e2408cc253fc5dc8af4
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jun 28 16:13:02 2005 +0000

    Add support to check the in-built VESA mode list.

commit 0d64e9e1f5494cff633a1499545d55a0edd0d92e
Author: Adam Jackson <ajax@nwnk.net>
Date:   Sat Jun 25 21:16:55 2005 +0000

    Bug #3626: _X_EXPORT tags for video and input drivers.

commit 67174d67e740b9082ed0a65a79f08b5df3b4fcfb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 13 12:15:25 2005 +0000

    commit missing piece from resume patch

commit ddab0558d584fb906cc0dfb383cc0e7a122d5336
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jun 9 09:26:03 2005 +0000

    Bug #3496 <https://bugs.freedesktop.org/show_bug.cgi?id=3496>
    Remove a bogus check for DRM 1.2 for resume functionality as it's
    been present since 1.1

commit 7f49513afe9d4490bdfdac182d50383c089875e0
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed Jun 8 17:50:32 2005 +0000

    Fix the mode validation such that using function 5f05 to set the refresh rate
    works again.

commit f8de9b4b9a5ce2756652c6b9ec1e84aedbc3519a
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jun 7 18:54:10 2005 +0000

    Fix text restoration when display switching has been activated and we could be
    potentially on a different display than the initial one.

commit 1f538007e9da7d4ad30ec4d4d281fb07ef300ddb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 6 09:47:29 2005 +0000

    missed a hunk

commit d8a32bf4274ad91cc2b9ca425f5b0a017c2dd293
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jun 6 09:40:23 2005 +0000

    Bug #3436 <https://bugs.freedesktop.org/show_bug.cgi?id=3054>
    Fix some offset, pitch and overlay scaler size problems with
    the video overlay. Solves various spontaneous lockups.

commit 005d121d280ff4502f4d6e3d3d585ff0175367bb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue May 31 20:29:01 2005 +0000

    and another. sheesh.

commit 27f86d693c32e550d9ebf4d6ff05c2d827754c8b
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue May 31 20:27:24 2005 +0000

    missed hunk

commit 27feb0f3474c1e21557225e10b13558e002c0ebf
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue May 31 17:58:26 2005 +0000

    Add Intel(R) 945G support

commit 2d10e8dc8184b0514e8ac9f835a06b85d609bb1b
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Wed May 25 09:10:44 2005 +0000

    Change the sequence on how refresh rates are set in the i830 driver. This works
    much better with custom modelines.

commit 89ec4ac201c09329d5d732323bdce6250b8592fe
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri May 20 15:24:02 2005 +0000

    Bugzilla #3292: https://bugs.freedesktop.org/show_bug.cgi?id=3292
    Add shadowFB support to the Intel driver (Dima Dorfman)

commit df0964ea8f92c6b278dd87b95380dbc3ada625e5
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri May 20 13:24:02 2005 +0000

    Bugzilla #2339: https://bugs.freedesktop.org/show_bug.cgi?id=2339
    Bugzilla #1064: https://bugs.freedesktop.org/show_bug.cgi?id=1064
    Bugzilla #3055: https://bugs.freedesktop.org/show_bug.cgi?id=3055
    Much better display switching support for mobile chipsets using
    the Fn+F? combination keys.
    Add DirectColor support.
    Add gamma correction support.

commit b99ef9cd59fce0e02e8829210c7cb8aadb6a3499
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri May 20 11:56:45 2005 +0000

    Bugzilla #2585: https://bugs.freedesktop.org/show_bug.cgi?id=2585
    Support the Intel E7221 server chipset.

commit 3b87fac327b5549678f91a9c961b9fe5c0bf8a37
Author: Adam Jackson <ajax@nwnk.net>
Date:   Wed May 18 17:47:35 2005 +0000

    Bug #3163: Create new DRIINFO_*_VERSION macros to indicate the
    version number of the DRIInfoRec, disambiguating it from the XF86DRI
    protocol version number.  Modify DRIQueryVersion to return the libdri
    version number, which all DDXes were requesting implicitly.  Fix the
    DDXes to check for the DRIINFO version they were compiled against.

commit 72100ac7cff7485db3e869f1331caddb0bc21a24
Author: Daniel Stone <daniel@fooishbar.org>
Date:   Wed Apr 20 12:25:28 2005 +0000

    Fix includes right throughout the Xserver tree:
      * change "foo.h" to <X11/foo.h> for core headers, e.g. X.h, Xpoll.h;
      * change "foo.h", "extensions/foo.h" and "X11/foo.h" to
        <X11/extensions/foo.h> for extension headers, e.g. Xv.h;
      * change "foo.[ch]" to <X11/Xtrans/foo.[ch]> for Xtrans files.

commit c813bf655908cd72049f346919abbdff8365b944
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Apr 14 22:55:01 2005 +0000

    Fix initial DDC parameters when validating modes.

commit e637630908f40f42367c94344d44918b6cdb0eb2
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Fri Apr 1 14:17:24 2005 +0000

    Check the VESA BIOS scanline requirements and adjust the displayWidth
    accordingly. Fixes an assumption that the screen width was always used as the
    displayWidth.

commit 5090c8ba6778091aa4ce24b16b058d534ba78dc7
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Mar 21 21:20:39 2005 +0000

    a one line fixup to the UseDDC code

commit 8bc9b0d7da5de9a3294687f450afb50452898c7d
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Mar 21 18:57:39 2005 +0000

    Fix some bad alignment problems when allocating memory from
    the end of AGP space.
    Bugzilla #2764 (https://bugs.freedesktop.org/show_bug.cgi?id=2764)

commit 50a105e88cfdfc22fef8cfd2397fc5e9fae17663
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Mar 15 13:10:23 2005 +0000

    LFP's may exist on Pipe A in older i830's. Check that case so that Panel ID can
    be obtained and Xvideo is correctly setup for panel fitting.

commit eb8b5df739e7be4509423c2bf757a7df35ce02f6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Mar 15 11:32:10 2005 +0000

    Enforce DDC monitor ranges usage if we have them and reject bad
    modes. Use NoDDC option to override DDC timings. We currently
    only use DS_RANGES, but could use other DDC information, as does
    the common layer, to deduce the h/v ranges.

commit 49dcbacf7fa7f29d18c18eec7e2f99e859bf4c7e
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Mar 3 18:01:51 2005 +0000

    Limit the maximum refresh rate to 85Hz and remove the bogus
    100Hz and 120Hz settings as they don't match close enough and
    are really unsupported.

commit 7eaf88d00d7539fde68422ae6566f23993aa2633
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Mar 1 19:53:28 2005 +0000

    Fix an off by one error when scaling which caused occasional
    overlay color lines at the far right and bottom of the window.

commit 28d65bceaec3ef636f0f5bdd03b38fd76f87c8c6
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Feb 10 13:16:08 2005 +0000

    Fix unaligned YV12 videos that caused skew when playing.

commit 6352e65b9cd635e9f266e0e9ed64c5beae9e5c44
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Feb 10 10:41:20 2005 +0000

    Fix pixmap cache corruption when Xv was in use due to a memory allocator
    calculation problem.

commit f691f959213d3eb5c365edaf5a5a53fa96300491
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Feb 8 20:13:33 2005 +0000

    Setup the Xv atoms correctly.

commit 31a4191a97f538b2c6d4b8036796f06443f783c1
Author: Egbert Eich <eich@suse.de>
Date:   Mon Feb 7 11:56:31 2005 +0000

    Check the pixel clock choosen for a specific refresh rate
    against the maximally allowed pixel clock when choosing
    mode lines for VBESetVBEMode() and VESA BIOS version >= 3.0
    (Bugzilla #2486).

commit a103496e08f699b609be875827ecf1f3afa45e68
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Feb 1 19:47:32 2005 +0000

    Check return value of i830InitDma() and fail to initialize the DRI
    if that fails.
    Also, check the DRM module name that it matches i915 and not the
    older i830 driver which some people were still trying to use
    and was causing Dma Initialization failures and lockups.

commit 7ff7cec9220815eb5f74cfd95860aaa5f1f263bd
Author: Egbert Eich <eich@suse.de>
Date:   Mon Jan 24 15:02:17 2005 +0000

    Unmap XCursor AGP memory on VT switch to prevent system from lockup
    (Matthias Hopf).

commit d4c87adf6792ae9af641b9824c547d18cdd1e521
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Mon Jan 10 11:29:02 2005 +0000

    Revert some changes to TweakMemorySize

commit 076c5116ae5eda1822da70184cbcc8942b470541
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Thu Jan 6 14:43:14 2005 +0000

    Add:
    - Intel i915GM support to 2D DDX and 3D Mesa drivers.
    - PanelID identification
    - DRI suspend/resume support
    - Detection of monitor changes on VT switches
    - Support custom video modes if available in the Video BIOS
    - 3D enhancements:
    	* GL_ARB_texture_cube_map
    	* GL_EXT_blend_equation_separate
    	* GL_ATI_blend_equation_separate
    	* GL_ARB_point_parameters
    	* GL_NV_blend_square
    	* GL_EXT_cull_vertex
    	* GL_ARB_depth_texture
    	* GL_SGIX_depth_texture
    	* GL_ARB_shadow
    	* GL_EXT_shadow_funcs
    	* GL_3DFX_texture_compression_FXT1
    By Tungsten Graphics, Keith Whitwell & Alan Hourihane.

commit edb9b6fde0948bb1121a8456500ef9f55f734376
Author: Adam Jackson <ajax@nwnk.net>
Date:   Mon Jan 3 16:03:56 2005 +0000

    Bug #1488: Fix crash on i830 during startup.  (Eric Anholt)

commit 59cecb714b78f7f384c24bf159bd39c81e9c7ee1
Author: Markus Kuhn <Markus.Kuhn@cl.cam.ac.uk>
Date:   Sat Dec 4 00:43:09 2004 +0000

    Encoding of numerous files changed to UTF-8

commit c24b0e04f3a1b064412e0bea44c4af546ec9fb77
Author: Egbert Eich <eich@suse.de>
Date:   Tue Nov 2 08:54:53 2004 +0000

    Fixed KGA handling for i810. KGA handling for chips derived from C&T chips is
    slightly different. The changes make the code consistent with the C&T (chips)
    and i740 drivers.

commit 7ce4898ee319d149cf86e938e7257ea7490d327f
Author: Egbert Eich <eich@suse.de>
Date:   Wed Oct 27 09:52:15 2004 +0000

    Removing vtSema shilding of accel sync - should have been '&&' instead of '||'
    anyway.

commit 88714c3b2274fcfe50837631b1d38a7cd96f692a
Author: Egbert Eich <eich@suse.de>
Date:   Tue Oct 12 19:13:43 2004 +0000

    Change order of SetDisplayDevice(), HWRestore(), UnbindGART() and
    RestoreBIOSMemSize() to be exactly opposite to the Save procedure in EnterVT()
    (Matthias Hopf, Alan Hourihane).
    Fixed server crash on reset when a structure allocated in PreInit() was freed on
    CloseScreen().
    Fixed ring buffer lock ups that happened because the structure that contained
    ringbuffer data was not zeroed after allocation.
    Fixed numerous warnings due to signed unsigned comparisons.

commit 687298daed40aaade44e61342a9abe984088541b
Author: Egbert Eich <eich@suse.de>
Date:   Mon Oct 11 09:58:04 2004 +0000

    Checking if server isn't switched away before calling sync.
    Sanity check for possible bugs in aother areas of the code.
    Fixing default amount of of allocated video memory from AGP for i810: Use 16MB
    if less than 192MB are installed else use 24MB (Matthias Hopf).

commit d2866271b8d42a0d44b65e30667adab96ac8fd54
Author: Adam Jackson <ajax@nwnk.net>
Date:   Wed Sep 22 04:38:03 2004 +0000

    Bug #1252, #1253, #1255, #1256: Various typo fixes from Dave Jones.

commit 88fd270d23ed1a1761cfdb98367c89ca89735b12
Author: Adam Jackson <ajax@nwnk.net>
Date:   Fri Sep 17 03:04:51 2004 +0000

    Bug #1192: Remove cfb support from drivers where its use is an option.
    Delete xf24_32bpp, as s3virge was the last user.  Fix up some comments
    to refer to fb rather than cfb.

commit 9e8e19c6fde15fe5b9bb7532316dedeeca54b8d9
Author: Kevin E Martin <kem@redhat.com>
Date:   Mon Aug 30 03:19:08 2004 +0000

    Fix ARGB cursor problem on i810 (Bug #1195, Alan Hourihane).

commit 15c61546ea1a64d6c7dd60764164143ea7174123
Author: Kevin E Martin <kem@redhat.com>
Date:   Thu Aug 26 05:10:56 2004 +0000

    Fix i810 compilation without Xinerama (Bug #1180, Simon Schubert).

commit 828c0fb8050dcbed8026365cbcb17d4d4330c268
Author: Kevin E Martin <kem@redhat.com>
Date:   Wed Aug 25 00:30:41 2004 +0000

    Fix i810 driver startup on Sony VAIO laptop (Bug #1084, Dave Airlie).

commit c4626af83d760c2a6aae90ad478430eac1c4f4ea
Author: Egbert Eich <eich@suse.de>
Date:   Fri Jul 30 21:36:40 2004 +0000

    Do I810EmitFlush() during screen init to make sure 2D engine is in a sane state
    (Peter Kunzmann).

commit e0e01b7d6188a83c7539256ac1710ace04ce132a
Author: Egbert Eich <eich@suse.de>
Date:   Fri Jul 30 20:38:27 2004 +0000

    add i845 to the list of chips that allow memory size tweaking.

commit 199620cdc924e6aa98683e305843ea91c7e1771d
Author: Adam Jackson <ajax@nwnk.net>
Date:   Fri Jul 30 20:30:52 2004 +0000

    Bug #400 (partial): Driver fixes for the dlloader.  When using
    dlloader, all framebuffer formats except cfb and the overlay modes
    should work, and r128 and radeon need to be loaded from the ati
    driver (both issues to be fixed soon).  Tested on i740, s3virge,
    mach64, tdfx, vesa, and vga drivers.  elfloader users shouldn't be
    affected.

commit 54e644ffbb63290b7e2ec51b041f5b2df26e164b
Author: Egbert Eich <eich@suse.de>
Date:   Fri Jul 30 19:04:14 2004 +0000

    Removed bugs on TweakMemorySize() which prevented it from working at all.
    Initialized last element of BIOS version number string to 0 to avoid random
    problems.

commit 3a3b00f18ac5edd7dfef06a96342c95f3cb97f79
Author: Kevin E Martin <kem@redhat.com>
Date:   Fri Jul 30 04:44:13 2004 +0000

    Fix "DoLoadableServer NO" build

commit 986bc24892e7ce3784fc723fda54b1f89dd75b66
Author: Egbert Eich <eich@suse.de>
Date:   Tue Jul 6 14:37:47 2004 +0000

    Increase default video RAM size to 16MB when DRI is enabled and more than 128MB
    are available (Egbert Eich).
    Fixed lockups during mode switch. Problem was introduced when attempting to copy
    the behavior during LeaveVT()/EnterVT() but but forgetting to call
    I810DRILeave() before I810DRIEnter(). The entire DRILeave()/Enter() scenario has
    been commented out as it didn't seem to be necessary (Egbert Eich).
    Fix TweakMemorySize() (tested with i855/i865) (Egbert Eich).

commit b7310758e60956a7de14dcf968bb713dfc56738f
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jun 22 15:12:42 2004 +0000

    add CmdBuffer

commit 5ed7e6f8424236dd57d83f6ab1282693260969cb
Author: Alan Hourihane <alanh@fairlite.demon.co.uk>
Date:   Tue Jun 22 14:28:46 2004 +0000

    i915 support
    Dual Head support for i830, i855, i915.
    ARGB cursor support (including i810) for all chipsets.

commit a46e95722d3c2b9dfb9eacf9a390a7c47d427773
Author: Eric Anholt <anholt@freebsd.org>
Date:   Wed Jun 16 19:16:54 2004 +0000

    Mop-up from the DRI 20040613 import, taking care of some drm.h
    header location and type changes, and update the ChangeLog.

commit 35a5cf103e9e41d178f980f685307f8c8063a006
Author: Eric Anholt <anholt@freebsd.org>
Date:   Wed Jun 16 09:44:00 2004 +0000

    Merge DRI-trunk-20040613 changes in programs/Xserver/hw/xfree86/drivers, with
    the following notes:
    
    - Savage and Mach64 (= ati/ati*.[ch] changes) DRI not merged due to insecurity.
    - VIA driver converted to new drmContext and drmHandle names.
    - Radeon driver merge conflicted in many places, and MergedFB at least could
      probably use some checking at this point.

commit bec47f9369b6f02ce4537ab1ac547ba933609edc
Author: Eric Anholt <anholt@freebsd.org>
Date:   Wed Jun 16 09:26:18 2004 +0000

    DRI trunk-20040613 import

commit c5b1972b50a6dbe57c67d3cc88ae010386b908a6
Author: Eric Anholt <anholt@freebsd.org>
Date:   Wed Jun 16 09:23:18 2004 +0000

    DRI XFree86-4_3_99_12-merge import

commit 41eba03d0d62fe03a7b437c9c4914016c3125141
Author: Egbert Eich <eich@suse.de>
Date:   Fri Apr 23 19:35:55 2004 +0000

    Merging XORG-CURRENT into trunk

commit e27494f2a9262b6310c2f1e0a40c406f578fc693
Author: Egbert Eich <eich@suse.de>
Date:   Sun Mar 14 08:33:22 2004 +0000

    Importing vendor version xf86-4_4_99_1 on Sun Mar 14 00:26:39 PST 2004

commit 5ece535dc7f77185cc8c327a57ae3c02c8b9f918
Author: Egbert Eich <eich@suse.de>
Date:   Wed Mar 3 12:12:19 2004 +0000

    Importing vendor version xf86-4_4_0 on Wed Mar  3 04:09:24 PST 2004

commit ba904078dd22e013f4112479e7c2669c33e708a8
Author: Egbert Eich <eich@suse.de>
Date:   Thu Feb 26 13:35:53 2004 +0000

    readding XFree86's cvs IDs

commit 13ea363db30dc0010cd09df29df90074db77f646
Author: Egbert Eich <eich@suse.de>
Date:   Thu Feb 26 09:23:19 2004 +0000

    Importing vendor version xf86-4_3_99_903 on Wed Feb 26 01:21:00 PST 2004

commit 64b129e800d915f0d82a67ce0f8b1850e67012fc
Author: Egbert Eich <eich@suse.de>
Date:   Thu Jan 29 08:08:35 2004 +0000

    Importing vendor version xf86-012804-2330 on Thu Jan 29 00:06:33 PST 2004

commit 64d7bbf0ac060a57761aa2ecf21ddbe8169674c0
Author: Kaleb Keithley <kaleb@freedesktop.org>
Date:   Fri Dec 19 20:55:10 2003 +0000

    XFree86 4.3.99.902 (RC 2)

commit 418eaaee109acd3ea178b147dd29f90318d159f9
Author: Kaleb Keithley <kaleb@freedesktop.org>
Date:   Thu Dec 4 22:03:17 2003 +0000

    XFree86 4.3.99.901 (RC 1)

commit 72063c52b82faf80a0183f66d2fd5789def76d8f
Author: Kaleb Keithley <kaleb@freedesktop.org>
Date:   Tue Nov 25 19:28:37 2003 +0000

    XFree86 4.3.99.16
    Bring the tree up to date for the Cygwin folks

commit e04a1a8f862eb63b546fb74e73ee602fefb82e00
Author: Kaleb Keithley <kaleb@freedesktop.org>
Date:   Fri Nov 14 16:48:55 2003 +0000

    XFree86 4.3.0.1

commit 3ad0d9a73bc0a4f3edb858d5f3a7c36827b7a429
Author: Kaleb Keithley <kaleb@freedesktop.org>
Date:   Fri Nov 14 16:48:55 2003 +0000

    Initial revision
